---
adytownr:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(251, 100));
  talk_p_proc: |
    if (global_var(251) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if (global_var(613) == 2) then begin
        float_msg(self_obj, message_str(251, random(113, 119)), 0);
      end
      else begin
        float_msg(self_obj, message_str(251, random(101, 112)), 0);
      end
    end
  critter_p_proc: |
    variable LVar0 := 0;
    LVar0 := global_var(340);
    if ((((game_time / 10) - LVar0) >= 10) and (tile_distance_objs(self_obj, dude_obj) <= 4) and (global_var(251) == 0)) then begin
      if (global_var(613) == 2) then begin
        float_msg(self_obj, message_str(251, random(113, 119)), 0);
      end
      else begin
        float_msg(self_obj, message_str(251, random(101, 112)), 0);
      end
      LVar0 := game_time / 10;
      set_global_var(340, LVar0);
    end
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(251) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(251, 1);
      critter_add_trait(self_obj, 1, 6, 49);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(251, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
      critter_add_trait(self_obj, 1, 6, 49);
    end
  pickup_p_proc: 'set_global_var(251, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      if (obj_is_carrying_obj_pid(self_obj, 41) == 0) then begin
        item_caps_adjust(self_obj, random(1, 10));
      end
      if ((global_var(613) == 9103) or (global_var(613) == 9102)) then begin
        critter_add_trait(self_obj, 1, 6, 0);
      end
      else begin
        critter_add_trait(self_obj, 1, 6, 49);
      end
      critter_add_trait(self_obj, 1, 5, 6);
      add_timer_event(self_obj, game_ticks(random(3, 5)), 1);
      if (local_var(4) == 0) then begin
        set_local_var(4, tile_num(self_obj));
      end
      Initialize := 0;
    end
  timed_event_p_proc: |
    variable LVar0 := 0;
    LVar0 := tile_num_in_direction(local_var(4), random(0, 5), random(1, 5));
    animate_move_obj_to_tile(self_obj, LVar0, 0);
    add_timer_event(self_obj, game_ticks(random(3, 5)), 1);
agatha:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 23);
      initialized := 1;
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(3) == 1) then begin
      display_msg(message_str(663, 102));
    end
    else begin
      display_msg(message_str(663, 100));
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  talk_p_proc: |
    set_local_var(3, 1);
    start_gdialog(663, self_obj, 4, -1, -1);
    gsay_start;
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      call Agatha14;
    end
    else begin
      call Agatha08;
    end
    gsay_end;
    end_dialogue;
  map_update_p_proc: |
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      animate_move_obj_to_tile(self_obj, 16523, 0);
    end
    else begin
      animate_move_obj_to_tile(self_obj, 16131, 0);
      if (anim_busy(self_obj) == 0) then begin
        anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), 16131));
      end
    end
  Agatha01: |
    gsay_reply(663, 104);
    giq_option(-3, 663, 105, Agatha02, 49);
    giq_option(5, 663, 107, Agatha03, 50);
    giq_option(4, 663, 108, Agatha05, 50);
  Agatha02: 'gsay_message(663, 109, 49);

    '
  Agatha03: |
    gsay_reply(663, 110);
    giq_option(6, 663, 112, Agatha04, 50);
    giq_option(5, 663, 113, Agatha02, 50);
  Agatha04: |
    gsay_reply(663, 114);
    giq_option(5, 663, 115, AgathaEnd, 49);
  Agatha05: 'gsay_message(663, 116, 50);

    '
  Agatha06: |
    gsay_reply(663, 117);
    giq_option(4, 663, 142, AgathaEnd, 50);
  Agatha07: 'gsay_message(663, 118, 50);

    '
  Agatha08: |
    gsay_reply(663, 119);
    giq_option(-3, 663, 120, Agatha09, 50);
    giq_option(4, 663, 121, Agatha10, 50);
    if (get_critter_stat(dude_obj, 34) == 1) then begin
      giq_option(5, 663, 122, Agatha13, 50);
    end
    else begin
      giq_option(7, 663, 123, Agatha13, 50);
    end
    giq_option(4, 663, 124, Agatha09, 51);
    if (global_var(26) == 1) then begin
      giq_option(4, 663, 152, Agatha01, 50);
    end
    if (global_var(26) == 2) then begin
      giq_option(4, 663, 153, Agatha06, 50);
    end
    if (global_var(26) == 3) then begin
      giq_option(4, 663, 154, Agatha07, 50);
    end
    giq_option(4, 663, 134, AgathaEnd, 50);
  Agatha09: 'gsay_message(663, 125, 50);

    '
  Agatha10: |
    gsay_reply(663, 126);
    giq_option(4, 663, 127, Agatha11, 50);
    giq_option(6, 663, 129, Agatha12, 49);
    giq_option(4, 663, 128, AgathaEnd, 50);
  Agatha11: |
    gsay_reply(663, 130);
    giq_option(4, 663, 145, Agatha21, 50);
  Agatha12: |
    call UpReact;
    gsay_message(663, 131, 50);
  Agatha13: 'gsay_message(663, 132, 50);

    '
  Agatha14: |
    gsay_reply(663, 133);
    giq_option(-3, 663, 134, AgathaEnd, 50);
    giq_option(4, 663, 135, AgathaEnd, 50);
    giq_option(6, 663, 136, Agatha15, 50);
  Agatha15: 'gsay_message(663, 137, 50);

    '
  Agatha21: |
    gsay_reply(663, 150);
    giq_option(4, 663, 151, AgathaEnd, 50);
    giq_option(4, 663, 124, Agatha09, 51);
  AgathaEnd: "[]"
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
agathbed:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(117, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(117, 102));
airgrd:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 46);
    end
    else begin
      if (script_action == 14) then begin
        if (global_var(245) == 0) then begin
          set_global_var(245, 1);
        end
      end
      else begin
        if (script_action == 11) then begin
          call do_dialogue;
        end
        else begin
          if (script_action == 4) then begin
            HOSTILE := 1;
          end
          else begin
            if (script_action == 22) then begin
              if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
                call combat;
              end
            end
            else begin
              if (script_action == 12) then begin
                if (HOSTILE) then begin
                  HOSTILE := 0;
                  attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
                end
                if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 6)) then begin
                  if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
                    if (Weapons == 0) then begin
                      Weapons := 1;
                      again := 1;
                      dialogue_system_enter;
                    end
                  end
                  DISGUISED := 0;
                  if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
                    if (metarule(16, 0) > 1) then begin
                      DISGUISED := 0;
                    end
                    else begin
                      DISGUISED := 1;
                    end
                  end
                  if (DISGUISED == 0) then begin
                    again := 1;
                    dialogue_system_enter;
                  end
                  if (again == 0) then begin
                    again := 1;
                    dialogue_system_enter;
                  end
                end
              end
              else begin
                if ((script_action == 21) or (script_action == 3)) then begin
                  script_overrides;
                end
                else begin
                  if (script_action == 18) then begin
                    if (source_obj == dude_obj) then begin
                      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                        set_global_var(156, 1);
                        set_global_var(157, 0);
                      end
                      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                        set_global_var(157, 1);
                        set_global_var(156, 0);
                      end
                      set_global_var(160, global_var(160) + 1);
                      if ((global_var(160) % 6) == 0) then begin
                        set_global_var(155, global_var(155) + 1);
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      if (metarule(16, 0) > 1) then begin
        DISGUISED := 0;
      end
      else begin
        DISGUISED := 1;
      end
    end
    if ((map_var(1) == 1) and (global_var(231) == 1)) then begin
      call airgrd00;
    end
    else begin
      if (DISGUISED) then begin
        if (Weapons) then begin
          jumpcode := 1;
          call dialog;
        end
        else begin
          if (first == 0) then begin
            first := 1;
            jumpcode := 2;
            call dialog;
          end
          else begin
            if (first == 1) then begin
              call airgrd08;
            end
          end
        end
      end
      else begin
        if (Weapons) then begin
          call airgrd15;
        end
        else begin
          jumpcode := 3;
          call dialog;
        end
      end
    end
  dialog: |
    set_local_var(3, 1);
    call get_reaction;
    start_gdialog(673, self_obj, 4, -1, -1);
    gsay_start;
    indialog := 1;
    if (jumpcode < 2) then begin
      call airgrd01;
    end
    else begin
      if (jumpcode == 2) then begin
        call airgrd03;
      end
      else begin
        if (jumpcode > 2) then begin
          call airgrd09;
        end
      end
    end
    indialog := 0;
    gsay_end;
    end_dialogue;
  airgrd00: 'float_msg(self_obj, message_str(673, random(102, 104)), 2);

    '
  airgrd01: |
    gsay_reply(673, 105);
    giq_option(-3, 673, 106, airgrd02, 51);
    giq_option(4, 673, 107, airgrdtim, 50);
    giq_option(4, 673, 108, airgrd02, 51);
    giq_option(4, 673, 109, airgrdtim, 50);
  airgrd02: |
    gsay_message(673, 110, 51);
    call combat;
  airgrd03: |
    gsay_reply(673, 111);
    giq_option(-3, 673, 112, airgrd02, 51);
    giq_option(4, 673, 113, airgrd04, 50);
    giq_option(4, 673, 114, airgrd03a, 50);
    giq_option(4, 673, 115, airgrd02, 51);
  airgrd03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call airgrd06;
    end
    else begin
      call airgrd08;
    end
  airgrd04: |
    gsay_reply(673, 116);
    giq_option(4, 673, 117, airgrd04a, 50);
    giq_option(6, 673, 118, airgrd04b, 50);
  airgrd04a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call airgrd06;
    end
    else begin
      call airgrd05;
    end
  airgrd04b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -15))) then begin
      call airgrd06;
    end
    else begin
      call airgrd05;
    end
  airgrd05: |
    gsay_message(673, 119, 51);
    call combat;
  airgrd06: |
    gsay_reply(673, 120);
    giq_option(4, 673, 121, bluff_end, 50);
    giq_option(4, 673, 122, airgrd07, 51);
    giq_option(4, 673, 123, bluff_end, 50);
  airgrd07: |
    gsay_message(673, 124, 51);
    call combat;
  airgrd08: |
    if (indialog == 1) then begin
      gsay_message(673, random(125, 127), 50);
    end
    else begin
      float_msg(self_obj, message_str(673, random(125, 127)), 2);
    end
    call bluff_end;
  airgrd09: |
    gsay_reply(673, 128);
    giq_option(-3, 673, 129, airgrd10, 51);
    giq_option(4, 673, 130, airgrd10, 51);
    giq_option(4, 673, 131, airgrd11, 51);
    giq_option(4, 673, 132, airgrd02, 51);
  airgrd10: |
    gsay_message(673, 133, 51);
    call combat;
  airgrd11: |
    gsay_reply(673, 134);
    giq_option(4, 673, 135, airgrd02, 51);
    giq_option(4, 673, 136, airgrd12, 51);
  airgrd12: |
    gsay_reply(673, 137);
    giq_option(4, 673, 138, airgrd13, 51);
    giq_option(6, 673, 139, airgrd14, 51);
  airgrd13: |
    gsay_message(673, 140, 51);
    call combat;
  airgrd14: |
    gsay_message(673, 141, 51);
    call combat;
  airgrd15: |
    gsay_message(673, 142, 51);
    call combat;
  bluff_end: |
    if (local_var(4) == 0) then begin
      set_local_var(4, 1);
      temp := 750;
      display_msg(message_str(673, 200) + temp + message_str(673, 201));
      give_exp_points(temp);
    end
  dialog_end: "[]"
  airgrdtim: 'add_timer_event(self_obj, game_ticks(10), 1);

    '
  combat: 'HOSTILE := 1;

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
airlock:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if (local_var(0) != 1) then begin
          if (get_critter_stat(dude_obj, 4) > 8) then begin
            display_msg(message_str(60, 100));
          end
          set_local_var(0, 1);
        end
      end
    end
alanfoll:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(0) == 0) then begin
      display_msg(message_str(968, 100));
    end
    else begin
      display_msg(message_str(968, 101));
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 46);
      critter_add_trait(self_obj, 1, 5, 33);
      initialized := 1;
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(256) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: 'set_global_var(256, 1);

    '
  talk_p_proc: |
    start_gdialog(968, self_obj, 4, -1, -1);
    gsay_start;
    call alan00;
    gsay_end;
    end_dialogue;
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(256, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  alan00: |
    if (get_critter_stat(dude_obj, 34) == 1) then begin
      gsay_reply(968, 105);
    end
    else begin
      gsay_reply(968, 102);
    end
    if (global_var(133) == 1) then begin
      giq_option(4, 968, 109, alan06, 50);
    end
    giq_option(-3, 968, 104, alan01, 50);
    giq_option(4, 968, 108, alan01, 50);
    giq_option(4, 968, 113, alanend, 50);
    set_local_var(0, 1);
  alan01: |
    gsay_reply(968, 110);
    giq_option(4, 968, 111, alan03, 50);
    giq_option(4, 968, 112, alan02, 50);
    giq_option(4, 968, 113, alanend, 50);
  alan02: |
    gsay_reply(968, 115);
    giq_option(4, 968, 116, alanend, 50);
    giq_option(4, 968, 117, alan08, 50);
  alan03: |
    gsay_reply(968, 119);
    giq_option(4, 968, 121, alan04, 50);
  alan04: |
    gsay_reply(968, 124);
    giq_option(4, 968, 122, alan05, 50);
  alan05: |
    gsay_reply(968, 125);
    giq_option(4, 968, 126, alanend, 50);
  alan06: |
    gsay_reply(968, 118);
    giq_option(4, 968, 120, alan07, 50);
  alan07: |
    gsay_reply(968, 123);
    giq_option(4, 968, 113, alanend, 50);
  alan08: |
    hostile := 1;
    set_global_var(256, 1);
    float_msg(self_obj, message_str(968, 128), 2);
  alanend: "[]"
alex:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 49);
      sleep_tile := 14275;
      home_tile := 11300;
      wake_time := 2030;
      sleep_time := 730;
      night_person := 1;
      if (obj_is_carrying_obj_pid(self_obj, 41) == 0) then begin
        item_caps_adjust(self_obj, random(0, 20));
      end
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      else begin
        if (local_var(0) == 0) then begin
          if (tile_distance_objs(self_obj, dude_obj) < 12) then begin
            dialogue_system_enter;
          end
        end
        if (tile_distance(tile_num(dude_obj), 10700) > tile_distance(tile_num(dude_obj), 11900)) then begin
          if (global_var(128) < 2) then begin
            hostile := 1;
          end
        end
      end
    end
    else begin
      call sleeping;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    if (local_var(0)) then begin
      script_overrides;
      display_msg(message_str(670, 100));
    end
  talk_p_proc: |
    if (global_var(128) == 2) then begin
      float_msg(self_obj, message_str(670, 101) + proto_data(obj_pid(dude_obj), 1), 0);
    end
    else begin
      if (local_var(0)) then begin
        call Alex01;
      end
      else begin
        start_gdialog(670, self_obj, 4, -1, -1);
        gsay_start;
        call Alex02;
        gsay_end;
        end_dialogue;
      end
    end
  Alex01: 'float_msg(self_obj, message_str(670, 102), 0);

    '
  Alex02: |
    set_local_var(0, 1);
    gsay_reply(670, 103);
    giq_option(4, 670, 104, Alex03, 50);
    giq_option(4, 670, 105, Alex05, 51);
    giq_option(4, 670, 106, Alex06, 50);
    giq_option(-3, 670, 114, Alex06, 50);
  Alex03: |
    gsay_reply(670, 107);
    giq_option(4, 670, 108, Alex04, 50);
    giq_option(4, 670, 106, Alex06, 50);
  Alex04: 'gsay_message(670, 109, 50);

    '
  Alex05: |
    gsay_reply(670, 110);
    giq_option(4, 670, 106, Alex06, 50);
    giq_option(4, 670, 111, Alex07, 50);
  Alex06: 'gsay_message(670, 112, 50);

    '
  Alex07: |
    hostile := 1;
    gsay_message(670, 113, 51);
  sleeping: |
    if (local_var(1) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(1, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(1, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(1, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(1, 1);
          end
        end
      end
    end
allnone:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(782, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    variable LVar0 := 0;
    call Get_Stuff;
    call get_reaction;
    if (((game_time / 10) - local_var(4)) > (60 * 60 * 24 * 3)) then begin
      set_local_var(4, game_time / 10);
      set_local_var(5, random(1000, 1500));
      LVar0 := item_caps_adjust(self_obj, local_var(5));
    end
    else begin
      LVar0 := item_caps_adjust(self_obj, local_var(5));
    end
    start_gdialog(782, self_obj, 4, -1, -1);
    gsay_start;
    call Merchant00;
    gsay_end;
    end_dialogue;
    set_local_var(5, item_caps_total(self_obj));
    LVar0 := item_caps_adjust(self_obj, -1 * local_var(5));
    call Put_Stuff;
  destroy_p_proc: |
    move_obj_inven_to_obj(Mitch_Box_Ptr, self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    variable LVar0 := 0;
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 41);
      critter_add_trait(self_obj, 1, 5, 50);
    end
  Merchant00: |
    gsay_reply(782, 101);
    giq_option(4, 782, 102, Merchant01, 50);
    giq_option(4, 782, 103, Merchant02, 50);
    giq_option(4, 782, 104, Merchant03, 50);
    giq_option(-3, 782, 105, Merchant04, 50);
  Merchant01: |
    gsay_message(782, 106, 50);
    gdialog_mod_barter(0);
    call Merchant05;
  Merchant02: |
    gsay_message(782, 107, 50);
    gdialog_mod_barter(0);
    call Merchant05;
  Merchant03: "[]"
  Merchant04: 'gsay_message(782, 108, 50);

    '
  Merchant05: 'gsay_message(782, 109, 50);

    '
  Get_Stuff: 'move_obj_inven_to_obj(Mitch_Box_Ptr, self_obj);

    '
  Put_Stuff: 'move_obj_inven_to_obj(self_obj, Mitch_Box_Ptr);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
alya:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 6);
      critter_add_trait(self_obj, 1, 5, 21);
      initialized := 1;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(143, 100));
  talk_p_proc: |
    if (global_var(116) == 1) then begin
      float_msg(self_obj, message_str(136, random(102, 106)), 8);
    end
    else begin
      call do_dialogue;
    end
  timed_event_p_proc: |
    if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
      call combat;
    end
  pickup_p_proc: 'HOSTILE := 1;

    '
  critter_p_proc: |
    call Critter_Action;
    if (HOSTILE) then begin
      HOSTILE := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    set_global_var(254, 1);
    set_global_var(611, 0);
    set_global_var(115, global_var(115) - 1);
  damage_p_proc: |
    if (global_var(116) == 0) then begin
      set_global_var(254, 1);
    end
  do_dialogue: |
    set_local_var(3, 1);
    call get_reaction;
    start_gdialog(143, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4) == 5) then begin
      call alya10;
    end
    else begin
      set_local_var(4, local_var(4) + 1);
      call alya00;
    end
    gsay_end;
    end_dialogue;
  alya00: |
    gsay_reply(143, 101);
    if ((global_var(103) == 1) and (global_var(218) == 1)) then begin
      giq_option(4, 143, 102, alya01, 50);
    end
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      giq_option(4, 143, 103, alya02, 50);
    end
    giq_option(4, 143, 104, alya03, 50);
    giq_option(4, 143, 105, alyaend, 50);
    giq_option(-3, 143, 106, alya05, 50);
  alya01: 'gsay_message(143, 107, 50);

    '
  alya02: |
    gsay_message(143, 108, 50);
    call combat;
  alya03: |
    gsay_reply(143, 109);
    giq_option(4, 143, 110, alya04, 50);
    giq_option(4, 143, 111, alya09, 50);
    giq_option(4, 143, 112, alyaend, 50);
  alya04: |
    gsay_reply(143, 113);
    giq_option(4, 143, 114, alya06, 50);
    giq_option(4, 143, 115, alya08, 50);
    giq_option(4, 143, 116, alyaend, 50);
  alya05: 'gsay_message(143, 117, 50);

    '
  alya06: |
    gsay_reply(143, 118);
    giq_option(4, 143, 119, alya07, 50);
    giq_option(4, 143, 120, combat, 50);
    giq_option(4, 143, 121, alyaend, 50);
  alya07: |
    gsay_message(143, 122, 50);
    call combat;
  alya08: |
    gsay_message(143, 123, 50);
    add_timer_event(self_obj, game_ticks(15), 1);
  alya09: 'gsay_message(143, 124, 50);

    '
  alya10: 'gsay_message(143, 125, 50);

    '
  alyaend: "[]"
  combat: |
    if (global_var(116) == 1) then begin
      critter_add_trait(self_obj, 1, 6, 87);
    end
    HOSTILE := 1;
  Critter_Action: |
    variable LVar0 := 0;
    if (global_var(26) == 2) then begin
      set_global_var(254, 1);
    end
    else begin
      if (global_var(116)) then begin
        set_global_var(254, 0);
        if (tile_distance_objs(self_obj, dude_obj) < 3) then begin
          LVar0 := tile_num_in_direction(tile_num(self_obj), random(0, 5), 3);
          if (tile_distance(tile_num(self_obj), LVar0) > 2) then begin
            if (random(0, 9) == 0) then begin
              float_msg(self_obj, message_str(136, random(102, 106)), 8);
            end
            animate_move_obj_to_tile(self_obj, LVar0, 0);
          end
        end
      end
      else begin
        if (global_var(213)) then begin
          set_global_var(254, 1);
        end
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          if (global_var(214)) then begin
            set_global_var(254, 1);
          end
        end
        if (map_var(2) == 1) then begin
          set_global_var(254, 1);
        end
      end
    end
    if (global_var(254) and obj_can_see_obj(self_obj, dude_obj)) then begin
      HOSTILE := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      HOSTILE := 0;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
amber:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 46);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (global_var(129) == 2) then begin
      kill_critter(self_obj, 59);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(272, 100));
  talk_p_proc: |
    script_overrides;
    if (global_var(132) == 1) then begin
      call Amber18;
    end
    else begin
      if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
        call Amber0;
      end
      else begin
        set_local_var(0, local_var(0) + 1);
        start_gdialog(272, self_obj, 4, -1, -1);
        gsay_start;
        call Amber1;
        gsay_end;
        end_dialogue;
      end
    end
  Amber0: 'float_msg(self_obj, message_str(272, 101), 0);

    '
  Amber1: |
    gsay_reply(272, 102);
    giq_option(4, 272, 103, Amber2, 50);
    giq_option(4, 272, 104, Amber3, 50);
    giq_option(7, 272, 105, Amber17, 50);
  Amber2: 'gsay_message(272, 106, 50);

    '
  Amber3: |
    gsay_reply(272, 107);
    if (not(local_var(1))) then begin
      giq_option(4, 272, 108, Amber4, 50);
    end
    giq_option(4, 272, 109, AmberEnd, 50);
    if (local_var(2) == 0) then begin
      giq_option(4, 272, 110, Amber3a, 50);
    end
    giq_option(5, 272, 111, Amber16, 50);
  Amber3a: |
    if (local_var(0) < 6) then begin
      call Amber9;
    end
    else begin
      if (local_var(0) == 6) then begin
        call Amber10;
      end
      else begin
        call Amber15;
      end
    end
  Amber4: |
    gsay_reply(272, 112);
    giq_option(4, 272, 113, Amber5, 50);
    giq_option(4, 272, 114, Amber8, 50);
    giq_option(5, 272, 115, AmberEnd, 50);
  Amber5: |
    gsay_reply(272, 116);
    giq_option(4, 272, 117, Amber6, 50);
    giq_option(4, 272, 118, Amber7, 50);
  Amber6: |
    variable LVar0 := 0;
    set_local_var(1, local_var(1) + 1);
    gsay_message(272, 119, 50);
    gfade_out(800);
    gfade_in(800);
    LVar0 := 3600 * 9;
    game_time_advance(game_ticks(LVar0));
    critter_mod_skill(dude_obj, 17, 15);
    gsay_message(272, 120, 50);
  Amber7: 'gsay_message(272, 121, 50);

    '
  Amber8: |
    variable LVar0 := 0;
    set_local_var(1, local_var(1) + 1);
    gsay_message(272, 122, 50);
    gfade_out(800);
    gfade_in(800);
    LVar0 := 3600 * 7;
    game_time_advance(game_ticks(LVar0));
    critter_mod_skill(dude_obj, 17, 15);
    gsay_message(272, 123, 50);
  Amber9: 'gsay_message(272, 124, 50);

    '
  Amber10: |
    set_local_var(2, local_var(2) + 1);
    gsay_reply(272, 125);
    giq_option(4, 272, 126, Amber11, 50);
    giq_option(4, 272, 127, Amber12, 50);
    giq_option(4, 272, 128, Amber13, 50);
    giq_option(4, 272, 129, Amber14, 50);
  Amber11: |
    variable LVar0 := 0;
    gsay_message(272, 130, 50);
    LVar0 := 3600 * 10;
    gfade_out(800);
    gfade_in(800);
    game_time_advance(game_ticks(LVar0));
    critter_mod_skill(dude_obj, 8, 12);
    critter_mod_skill(dude_obj, 9, 10);
    critter_mod_skill(dude_obj, 10, 8);
    critter_mod_skill(dude_obj, 11, 8);
    gsay_message(272, 131, 50);
  Amber12: |
    variable LVar0 := 0;
    gsay_message(272, 132, 50);
    LVar0 := 3600 * 10;
    gfade_out(800);
    gfade_in(800);
    game_time_advance(game_ticks(LVar0));
    critter_mod_skill(dude_obj, 3, 10);
    critter_mod_skill(dude_obj, 0, 8);
    critter_mod_skill(dude_obj, 5, 8);
    critter_mod_skill(dude_obj, 4, 6);
    gsay_message(272, 133, 50);
  Amber13: |
    variable LVar0 := 0;
    gsay_message(272, 134, 50);
    LVar0 := 3600 * 10;
    gfade_out(800);
    gfade_in(800);
    game_time_advance(game_ticks(LVar0));
    critter_mod_skill(dude_obj, 17, 10);
    critter_mod_skill(dude_obj, 8, 8);
    critter_mod_skill(dude_obj, 5, 8);
    critter_mod_skill(dude_obj, 11, 6);
    gsay_message(272, 135, 50);
  Amber14: |
    variable LVar0 := 0;
    gsay_message(272, 136, 50);
    LVar0 := 3600 * 10;
    gfade_out(800);
    gfade_in(800);
    game_time_advance(game_ticks(LVar0));
    critter_mod_skill(dude_obj, 15, 10);
    critter_mod_skill(dude_obj, 14, 8);
    critter_mod_skill(dude_obj, 16, 8);
    critter_mod_skill(dude_obj, 4, 6);
    gsay_message(272, 137, 50);
  Amber15: 'gsay_message(272, 138, 50);

    '
  Amber16: 'gsay_message(272, 139, 50);

    '
  Amber17: |
    gsay_reply(272, 140);
    if (local_var(2) == 0) then begin
      giq_option(7, 272, 141, Amber10, 50);
    end
    giq_option(7, 272, 142, AmberEnd, 50);
    if (not(local_var(1))) then begin
      giq_option(6, 272, 143, Amber4, 50);
    end
  Amber18: 'float_msg(self_obj, message_str(272, 144), 0);

    '
  AmberEnd: "[]"
andrew:
  start: "[]"
  combat_p_proc: |
    if (fixed_param == 4) then begin
      round_counter := round_counter + 1;
    end
    if (round_counter > 3) then begin
      if (global_var(247) == 0) then begin
        set_global_var(247, 1);
        set_global_var(155, global_var(155) - 5);
      end
    end
  critter_p_proc: |
    if (global_var(247) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if ((map_var(1) == 1) and ((game_time / (10 * 60 * 60 * 24)) > map_var(5))) then begin
        if (jail_door_ptr != 0) then begin
          obj_unlock(jail_door_ptr);
          use_obj(jail_door_ptr);
          moving_flag := 0;
          rm_timer_event(self_obj);
          add_timer_event(self_obj, game_ticks(5), 1);
        end
        set_map_var(1, 0);
        float_msg(self_obj, message_str(172, 101), 3);
      end
      else begin
        if (map_var(3) == 1) then begin
          set_map_var(3, map_var(3) + 1);
          float_msg(self_obj, message_str(172, 116), 2);
        end
        else begin
          if (map_var(3) == 3) then begin
            if (jail_door_ptr != 0) then begin
              obj_unlock(jail_door_ptr);
            end
            hostile := 1;
          end
          else begin
            if (moving_flag == 1) then begin
              if (tile_num(self_obj) != local_var(1)) then begin
                animate_move_obj_to_tile(self_obj, local_var(1), 0);
              end
            end
            if ((global_var(247) == 1) and obj_can_see_obj(self_obj, dude_obj)) then begin
              dialogue_system_enter;
            end
          end
        end
      end
    end
  look_at_p_proc: |
    if (local_var(0) == 1) then begin
      script_overrides;
      display_msg(message_str(172, 100));
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (global_var(247) == 1) then begin
      float_msg(self_obj, message_str(172, 102), 2);
      hostile := 1;
    end
    else begin
      start_gdialog(172, self_obj, 4, -1, -1);
      gsay_start;
      call Andrew01;
      gsay_end;
      end_dialogue;
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      obj_close(jail_door_ptr);
      rm_timer_event(self_obj);
      add_timer_event(self_obj, game_ticks(10), 2);
    end
    else begin
      if (fixed_param == 2) then begin
        moving_flag := 1;
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  destroy_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_carrying_pid_obj(self_obj, 1);
    if (LVar0) then begin
      rm_obj_from_inven(self_obj, LVar0);
      destroy_object(LVar0);
    end
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  map_enter_p_proc: |
    if (global_var(15) == 1) then begin
      kill_critter(self_obj, 49);
    end
    critter_add_trait(self_obj, 1, 6, 12);
    critter_add_trait(self_obj, 1, 5, 17);
    if (local_var(1) == 0) then begin
      set_local_var(1, tile_num(self_obj));
    end
  Andrew01: |
    gsay_reply(172, 103);
    giq_option(4, 172, 104, Andrew02, 50);
    giq_option(4, 172, 105, Andrew03, 50);
    giq_option(4, 172, 106, Andrew04, 50);
    giq_option(-3, 172, 113, Andrew06, 50);
  Andrew02: |
    set_local_var(0, 1);
    gsay_reply(172, 107);
    giq_option(4, 172, 105, Andrew03, 50);
    giq_option(4, 172, 106, Andrew04, 50);
  Andrew03: |
    gsay_reply(172, 108);
    giq_option(6, 172, 109, Andrew05, 50);
    giq_option(4, 172, 110, Andrew04, 50);
  Andrew04: 'gsay_message(172, 111, 50);

    '
  Andrew05: |
    gsay_reply(172, 112);
    giq_option(4, 172, 110, Andrew04, 50);
  Andrew06: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(172, 114, 50);
    end
    else begin
      gsay_message(172, 115, 50);
    end
aradesh:
  start: |
    if (initialized == 0) then begin
      initialized := 1;
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 25);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(33, 100));
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(246) == 1) then begin
        hostile := 1;
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
      hostile := 1;
    end
  destroy_p_proc: |
    set_global_var(604, 1);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  pickup_p_proc: |
    pickup_attempt := 1;
    dialogue_system_enter;
  talk_p_proc: |
    variable LVar0 := 0;
    call get_reaction;
    if (pickup_attempt) then begin
      pickup_attempt := 0;
      LVar0 := random(1, 2);
      if (LVar0 == 1) then begin
        call aradesh45;
      end
      else begin
        call aradesh46;
      end
    end
    else begin
      if (global_var(246) == 1) then begin
        float_msg(self_obj, message_str(33, 277), 2);
        hostile := 1;
      end
      else begin
        if ((local_var(9) > 2) or hostile) then begin
          display_msg(message_str(766, 170));
        end
        else begin
          start_gdialog(33, self_obj, 4, 13, 9);
          gsay_start;
          if (global_var(26) == 1) then begin
            set_local_var(4, 1);
            if (global_var(103) == 0) then begin
              call aradesh39;
            end
            else begin
              call aradesh37;
            end
          end
          else begin
            if ((game_time_hour >= 2100) or (game_time_hour < 600)) then begin
              call aradesh48;
            end
            else begin
              if (local_var(4) == 1) then begin
                if (local_var(5) == 1) then begin
                  call aradesh46;
                end
                else begin
                  if ((global_var(26) == 2) and (local_var(8) == 0)) then begin
                    call aradesh43;
                  end
                  else begin
                    if ((global_var(43) == 2) and (local_var(10) == 0)) then begin
                      set_local_var(10, 1);
                      call aradesh31;
                    end
                    else begin
                      if (global_var(26) == 1) then begin
                        if (global_var(103) == 0) then begin
                          call aradesh39;
                        end
                        else begin
                          call aradesh37;
                        end
                      end
                      else begin
                        if ((global_var(26) == 2) and (global_var(43) != 2)) then begin
                          call aradesh30a;
                        end
                        else begin
                          if (global_var(26) == 2) then begin
                            call aradesh35;
                          end
                          else begin
                            if (local_var(1) < 3) then begin
                              call aradesh18;
                            end
                            else begin
                              call aradesh17;
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
              else begin
                set_local_var(4, 1);
                call aradesh01;
              end
            end
          end
          gsay_end;
          end_dialogue;
        end
      end
    end
    if (local_var(7) == 1) then begin
      animate_move_obj_to_tile(self_obj, 32945, 0);
    end
  aradeshend: "[]"
  aradesh01: |
    if (local_var(1) >= 2) then begin
      if (local_var(1) >= 3) then begin
        gsay_reply(33, 101);
      end
      else begin
        gsay_reply(33, 102);
      end
    end
    else begin
      gsay_reply(33, 103);
    end
    giq_option(5, 33, 104, aradesh02, 50);
    giq_option(4, 33, 105, aradesh01_2, 51);
    giq_option(4, 33, 106, aradesh10, 51);
    giq_option(4, 33, 107, aradesh01_3, 50);
    giq_option(4, 33, 108, aradesh14, 51);
    giq_option(5, 33, 109, aradesh07, 51);
    giq_option(-3, 33, 110, aradesh15, 50);
  aradesh01_2: |
    set_local_var(9, local_var(9) + 1);
    call DownReact;
    if (local_var(1) >= 2) then begin
      call aradesh05;
    end
    else begin
      call aradesh06;
    end
  aradesh01_3: |
    if (local_var(1) >= 2) then begin
      call aradesh13;
    end
    else begin
      call aradesh11;
    end
  aradesh02: |
    gsay_reply(33, 111);
    giq_option(4, 33, 112, aradesh02_2, 50);
    giq_option(4, 33, 113, aradesh01_2, 51);
    giq_option(5, 33, 114, aradesh02_4, 51);
    giq_option(5, 33, 115, aradesh02_5, 50);
  aradesh02_2: |
    if (local_var(1) >= 2) then begin
      call aradesh03;
    end
    else begin
      call aradesh08;
    end
  aradesh02_4: |
    if (local_var(1) >= 2) then begin
      call aradesh09;
    end
    else begin
      call aradesh06;
    end
  aradesh02_5: |
    if (local_var(1) >= 2) then begin
      call aradesh04;
    end
    else begin
      call aradesh09;
    end
  aradesh03: |
    gsay_reply(33, 116);
    giq_option(4, 33, 117, aradesh04, 50);
    giq_option(4, 33, 118, aradesh01_2, 51);
    giq_option(5, 33, 119, aradesh07, 51);
    giq_option(4, 33, 120, aradesh07, 51);
  aradesh04: |
    gsay_message(33, 121, 50);
    call aradeshend;
  aradesh05: |
    gsay_reply(33, 122);
    giq_option(5, 33, 123, aradesh06, 51);
    giq_option(4, 33, 124, aradesh04, 50);
    giq_option(4, 33, 125, aradesh07, 51);
  aradesh06: |
    set_local_var(9, local_var(9) + 1);
    gsay_message(33, 126, 51);
    call aradeshx1;
  aradesh07: |
    set_local_var(9, local_var(9) + 1);
    gsay_message(33, 127, 51);
    call aradeshx2;
  aradesh08: |
    gsay_reply(33, 128);
    giq_option(4, 33, 129, aradesh08a, 49);
    giq_option(5, 33, 130, aradesh08b, 51);
  aradesh08a: |
    if (local_var(9) > 0) then begin
      set_local_var(9, local_var(9) - 1);
    end
    call UpReact;
    call aradesh04;
  aradesh08b: |
    set_local_var(9, local_var(9) + 1);
    call DownReact;
    call aradesh06;
  aradesh09: |
    gsay_reply(33, 131);
    giq_option(0, 33, 132, aradesh09a, 50);
  aradesh09a: |
    gsay_message(33, 133, 50);
    call aradeshx;
  aradesh10: |
    gsay_message(33, 134, 50);
    call aradeshx;
  aradesh11: |
    gsay_reply(33, 135);
    giq_option(4, 33, 136, aradesh12, 50);
    giq_option(5, 33, 137, aradesh11a, 50);
    giq_option(4, 33, 138, aradesh11b, 51);
  aradesh11a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call aradesh02;
    end
    else begin
      call aradesh14;
    end
  aradesh11b: |
    set_local_var(9, local_var(9) + 1);
    call DownReact;
    call aradesh14;
  aradesh12: |
    gsay_reply(33, 139);
    giq_option(5, 33, 140, aradesh02, 50);
    giq_option(4, 33, 141, aradesh13, 50);
    giq_option(4, 33, 142, aradesh05, 50);
  aradesh13: |
    gsay_reply(33, 143);
    giq_option(4, 33, 160, aradesh19, 50);
    giq_option(4, 33, 151, aradesh24c, 50);
    giq_option(-3, 33, 156, aradesh36, 50);
  aradesh14: |
    gsay_reply(33, 144);
    giq_option(4, 33, 146, aradesh04, 50);
    giq_option(5, 33, 145, aradesh06, 51);
    giq_option(4, 33, 147, aradesh07, 51);
  aradesh15: |
    gsay_message(33, 148, 50);
    call aradeshx;
  aradesh16_2: |
    if (global_var(43) == 0) then begin
      call aradesh28;
    end
    else begin
      if (global_var(43) == 1) then begin
        call aradesh30a;
      end
      else begin
        if ((global_var(43) == 2) and not(global_var(26) == 2)) then begin
          call aradesh31;
        end
        else begin
          if (global_var(26) == 2) then begin
            call aradesh35;
          end
          else begin
            call aradesh26;
          end
        end
      end
    end
  aradesh17: |
    gsay_reply(33, 152);
    giq_option(4, 33, 153, aradesh19, 50);
    giq_option(4, 33, 154, aradesh17_2, 50);
    giq_option(5, 33, 155, aradesh17_3, 51);
    giq_option(-3, 33, 156, aradesh36, 50);
  aradesh17_2: |
    if (global_var(26) == 2) then begin
      call aradesh44;
    end
    else begin
      call aradesh20;
    end
  aradesh17_3: |
    set_local_var(9, local_var(9) + 1);
    call DownReact;
    if (global_var(26) == 2) then begin
      call aradesh27;
    end
    else begin
      if (local_var(1) >= 2) then begin
        if (local_var(1) >= 3) then begin
          call aradesh27;
        end
        else begin
          call aradesh21;
        end
      end
      else begin
        call aradesh22;
      end
    end
  aradesh18: |
    if (local_var(1) >= 2) then begin
      gsay_reply(33, 157);
    end
    else begin
      gsay_reply(33, 158);
    end
    giq_option(5, 33, 159, aradesh23, 50);
    giq_option(4, 33, 160, aradesh19, 50);
    giq_option(4, 33, 161, aradesh17_2, 50);
    giq_option(-3, 33, 162, aradesh36, 50);
  aradesh19: |
    if (local_var(1) >= 2) then begin
      gsay_reply(33, 163);
    end
    else begin
      gsay_reply(33, 164);
    end
    giq_option(5, 33, 165, aradesh25, 50);
    giq_option(4, 33, 166, aradesh16_2, 50);
    giq_option(4, 33, 167, aradesh24c, 50);
  aradesh20: |
    if (local_var(1) >= 3) then begin
      gsay_message(33, 168, 50);
    end
    else begin
      if (local_var(1) >= 2) then begin
        gsay_message(33, 169, 50);
      end
      else begin
        gsay_message(33, 170, 50);
      end
    end
    call aradeshx;
  aradesh21: |
    gsay_message(33, 171, 50);
    call aradeshx;
  aradesh22: |
    gsay_message(33, 172, 50);
    call aradeshx1;
  aradesh23: |
    if (local_var(1) >= 2) then begin
      gsay_reply(33, 173);
    end
    else begin
      gsay_reply(33, 174);
    end
    giq_option(4, 33, 175, aradesh23_2, 50);
    giq_option(5, 33, 176, aradesh25, 50);
    giq_option(4, 33, 177, aradesh17_2, 50);
  aradesh23_2: |
    if (local_var(1) >= 2) then begin
      call aradesh24;
    end
    else begin
      call aradesh24b;
    end
  aradesh24: |
    gsay_reply(33, 178);
    giq_option(0, 33, 179, aradesh24a, 50);
  aradesh24a: |
    gsay_reply(33, 180);
    giq_option(4, 33, 181, aradesh19, 50);
    giq_option(4, 33, 182, aradesh24c, 50);
  aradesh24b: |
    gsay_reply(33, 183);
    giq_option(4, 33, 184, aradesh19, 50);
  aradesh24c: |
    if (global_var(26) == 2) then begin
      call aradesh44;
    end
    else begin
      call aradeshx;
    end
  aradesh25: |
    if (local_var(0) < 2) then begin
      gsay_reply(33, 185);
    end
    else begin
      gsay_reply(33, 186);
    end
    giq_option(4, 33, 187, aradesh19, 50);
  aradesh26: |
    gsay_reply(33, 188);
    giq_option(7, 33, 189, aradesh27, 50);
    giq_option(6, 33, 190, aradesh19, 50);
    giq_option(6, 33, 191, aradesh24c, 50);
  aradesh27: |
    gsay_reply(33, 192);
    giq_option(8, 33, 193, aradesh25, 50);
    giq_option(5, 33, 194, aradesh16_2, 50);
    giq_option(5, 33, 195, aradesh24c, 50);
  aradesh28: |
    gsay_reply(33, 196);
    giq_option(4, 33, 197, aradesh28a, 50);
  aradesh28a: |
    gsay_reply(33, 198);
    giq_option(4, 33, 199, aradesh29, 49);
    giq_option(4, 33, 200, aradesh28b, 51);
    giq_option(4, 33, 201, aradesh28c, 51);
  aradesh28b: |
    set_local_var(9, local_var(9) + 1);
    call DownReact;
    call aradesh30;
  aradesh28c: |
    set_local_var(9, local_var(9) + 1);
    call DownReact;
    call aradesh19;
  aradesh29: |
    gsay_message(33, 202, 50);
    set_global_var(43, 1);
    call aradeshx;
  aradesh30: |
    gsay_reply(33, 203);
    giq_option(5, 33, 204, aradesh30b, 49);
    giq_option(4, 33, 205, aradesh19, 50);
  aradesh30a: |
    gsay_message(33, 206, 50);
    call aradeshx;
  aradesh30b: |
    if (local_var(9) > 0) then begin
      set_local_var(9, local_var(9) - 1);
    end
    call UpReact;
    call aradesh29;
  aradesh31: |
    gsay_reply(33, 207);
    giq_option(4, 33, 208, aradesh19, 50);
    if (global_var(28) == 2) then begin
      giq_option(4, 33, 209, aradesh32, 50);
    end
  aradesh32: |
    gsay_reply(33, 210);
    giq_option(4, 33, 211, aradesh19, 50);
    giq_option(4, 33, 212, aradesh17_2, 50);
  aradesh33: |
    gsay_message(33, 213, 50);
    set_global_var(103, 1);
    call aradeshx;
  aradesh35: |
    gsay_reply(33, 214);
    giq_option(5, 33, 215, aradesh25, 50);
    giq_option(4, 33, 216, aradesh16_2, 50);
    giq_option(4, 33, 217, aradesh24c, 50);
  aradesh36: |
    gsay_message(33, 218, 50);
    call aradeshx;
  aradesh37: |
    gsay_reply(33, 219);
    if (global_var(26) == 3) then begin
      giq_option(5, 33, 220, aradesh38, 50);
      giq_option(4, 33, 221, aradesh37a, 50);
      giq_option(-3, 33, 222, aradesh37a, 50);
    end
    else begin
      giq_option(4, 33, 223, aradesh38, 50);
      giq_option(5, 33, 224, aradesh19, 50);
      giq_option(-3, 33, 225, aradesh38, 50);
    end
  aradesh37a: |
    gsay_message(33, 226, 50);
    call aradeshx5;
  aradesh38: |
    gsay_message(33, 227, 50);
    call aradeshx;
  aradesh39: |
    set_global_var(218, 1);
    gsay_reply(33, 228);
    giq_option(4, 33, 229, aradesh39a, 50);
    giq_option(-3, 33, 230, aradesh33, 50);
  aradesh39a: |
    gsay_reply(33, 231);
    giq_option(4, 33, 232, aradesh39b, 50);
    giq_option(4, 33, 233, aradesh41, 50);
    giq_option(4, 33, 234, aradesh39c, 50);
  aradesh39b: |
    if (local_var(9) > 0) then begin
      set_local_var(9, local_var(9) - 1);
    end
    call UpReact;
    set_global_var(103, 1);
    call aradesh40;
  aradesh39c: |
    set_local_var(9, local_var(9) + 1);
    call DownReact;
    call aradesh42;
  aradesh40: |
    variable LVar0 := 0;
    gsay_reply(33, 235);
    set_global_var(103, 1);
    LVar0 := create_object_sid(7, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    giq_option(4, 33, 236, aradesh40a, 50);
  aradesh40a: |
    gsay_message(33, 237, 50);
    call aradeshx;
  aradesh41: |
    gsay_reply(33, 238);
    giq_option(4, 33, 239, aradesh40, 50);
    giq_option(4, 33, 240, aradesh42, 50);
  aradesh42: |
    gsay_message(33, 241, 50);
    call aradeshx3;
  aradesh43: |
    variable LVar0 := 0;
    if (local_var(8) == 0) then begin
      set_local_var(8, 1);
      LVar0 := create_object_sid(41, 0, 0, -1);
      add_mult_objs_to_inven(dude_obj, LVar0, 500);
    end
    if (local_var(9) != 0) then begin
      set_local_var(9, 0);
    end
    call TopReact;
    set_global_var(103, 2);
    gsay_reply(33, 242);
    giq_option(4, 33, 243, aradesh19, 50);
    giq_option(4, 33, 244, aradesh44, 50);
  aradesh44: |
    gsay_message(33, 245, 50);
    call aradeshx;
  aradesh45: |
    set_local_var(9, local_var(9) + 2);
    call BigDownReact;
    float_msg(self_obj, message_str(33, 246), 7);
    call aradeshx;
  aradesh46: |
    set_local_var(9, local_var(9) + 2);
    call BigDownReact;
    float_msg(self_obj, message_str(33, 247), 7);
    call aradeshx;
  aradesh48: 'gsay_message(33, 249, 50);

    '
  aradeshx: "[]"
  aradeshx1: 'world_map;

    '
  aradeshx2: 'world_map;

    '
  aradeshx3: "[]"
  aradeshx5: 'set_local_var(7, 1);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
armor:
  start: |
    bonus := 0;
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 6) then begin
        call use_p_proc;
      end
      else begin
        if (script_action == 4) then begin
          call pickup_p_proc;
        end
        else begin
          if (script_action == 8) then begin
            call use_skill_on_p_proc;
          end
          else begin
            if (script_action == 7) then begin
              call use_obj_on_p_proc;
            end
          end
        end
      end
    end
  use_p_proc: |
    if (source_obj != dude_obj) then begin
    end
    else begin
      display_msg(message_str(936, 101));
    end
  pickup_p_proc: 'call use_p_proc;

    '
  look_at_p_proc: 'display_msg(message_str(936, 100));

    '
  use_skill_on_p_proc: |
    use_skill := action_being_used;
    call try_skill;
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 75) then begin
      bonus := 10;
      use_skill := 13;
      call use_skill_on_p_proc;
    end
    else begin
      display_msg(message_str(936, 105));
    end
  chance: |
    Test := roll_vs_skill(dude_obj, 13, bonus);
    if (is_success(Test)) then begin
      call fixed;
    end
    else begin
      call failure;
    end
  try_skill: |
    if (use_skill == 13) then begin
      if (global_var(304) > 1) then begin
        if (global_var(304) == 3) then begin
          if (has_skill(dude_obj, 13) < 75) then begin
            script_overrides;
            display_msg(message_str(936, 103));
          end
          else begin
            call chance;
          end
        end
        else begin
          call chance;
        end
      end
      else begin
        script_overrides;
        display_msg(message_str(936, 102));
      end
    end
    else begin
      script_overrides;
      display_msg(message_str(936, 105));
    end
  fixed: |
    script_overrides;
    set_global_var(304, 4);
    display_msg(message_str(936, 104));
    create_object_sid(3, 22475, 0, -1);
    temp := 500;
    display_msg(message_str(936, 107) + temp + message_str(936, 108));
    give_exp_points(temp);
    destroy_object(self_obj);
  failure: |
    script_overrides;
    set_global_var(304, 3);
    display_msg(message_str(936, 106));
artifact:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      if (global_var(108) != 0) then begin
        display_msg(message_str(333, 100));
      end
      else begin
        display_msg(message_str(333, 106));
      end
    end
  use_p_proc: |
    script_overrides;
    if (local_var(0) == 1) then begin
      display_msg(message_str(333, 101));
    end
    else begin
      set_local_var(0, 1);
      display_msg(message_str(333, 102));
      set_global_var(161, 1);
      display_msg(message_str(766, 103) + "100" + message_str(766, 104));
      give_exp_points(100);
    end
assblow:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(135, 100));
  talk_p_proc: |
    if ((global_var(247) == 1) and (line166flag == 0)) then begin
      call Guard18;
    end
    else begin
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) and not(local_var(4))) then begin
        call do_dialogue;
      end
      else begin
        if (sneaking) then begin
          call do_dialogue;
        end
        else begin
          if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
            call do_dialogue;
          end
          else begin
            if (local_var(8) == 0) then begin
              call do_dialogue;
            end
            else begin
              call guard02a;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (global_var(247) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if (hostile and not(local_var(4))) then begin
      hostile := 0;
      set_local_var(4, 1);
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        if (global_var(247) == 1) then begin
          if (line166flag == 0) then begin
            dialogue_system_enter;
          end
        end
        else begin
          if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) and not(local_var(4)) and (global_var(36) == 0) and (global_var(104) == 0)) then begin
            if (not(weapon_checked)) then begin
              weapon_checked := 1;
              rm_timer_event(self_obj);
              add_timer_event(self_obj, game_ticks(5), 1);
              dialogue_system_enter;
            end
          end
          else begin
            if (using_skill(dude_obj, 8) and not(sneak_checked)) then begin
              sneaking := 1;
              sneak_checked := 1;
              rm_timer_event(self_obj);
              add_timer_event(self_obj, game_ticks(5), 2);
              dialogue_system_enter;
            end
          end
        end
      end
      if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
        if (((tile_num(dude_obj) / 200) < 125) and ((tile_num(dude_obj) % 200) < 131) and not(local_var(5)) and not(warned)) then begin
          set_local_var(5, 1);
          set_local_var(7, 1);
        end
        if (tile_distance(tile_num(dude_obj), 27106) > tile_distance(tile_num(dude_obj), 25905)) then begin
          if (local_var(5) == 0) then begin
            if (tile_distance_objs(self_obj, dude_obj) < 12) then begin
              if (not(warned)) then begin
                if (not(using_skill(dude_obj, 8))) then begin
                  warned := 1;
                  dialogue_system_enter;
                  rm_timer_event(self_obj);
                  add_timer_event(self_obj, game_ticks(3), 4);
                end
              end
            end
          end
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
      set_local_var(6, 1);
    end
  destroy_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_carrying_pid_obj(self_obj, 1);
    if (LVar0) then begin
      rm_obj_from_inven(self_obj, LVar0);
      destroy_object(LVar0);
    end
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  map_enter_p_proc: |
    if (global_var(15) == 1) then begin
      kill_critter(self_obj, 59);
    end
    critter_add_trait(self_obj, 1, 6, 12);
  pickup_p_proc: 'hostile := 1;

    '
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
        hostile := 1;
      end
      else begin
        weapon_checked := 0;
      end
    end
    else begin
      if (fixed_param == 2) then begin
        sneak_checked := 0;
      end
      else begin
        if (fixed_param == 3) then begin
          hostile := 1;
        end
        else begin
          if (fixed_param == 4) then begin
            if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
              if (tile_distance(tile_num(dude_obj), 27106) > tile_distance(tile_num(dude_obj), 25905)) then begin
                if (local_var(5) == 0) then begin
                  if (not(using_skill(dude_obj, 8))) then begin
                    hostile := 1;
                    set_global_var(247, 1);
                  end
                end
              end
              else begin
                warned := 0;
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    if ((game_time_hour >= 1900) or (game_time_hour < 600) and (local_var(7) == 1)) then begin
      if (local_var(5) == 1) then begin
        float_msg(self_obj, message_str(135, 167), 0);
      end
      else begin
        float_msg(self_obj, message_str(135, 168), 2);
      end
    end
    else begin
      start_gdialog(135, self_obj, 4, -1, -1);
      gsay_start;
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) and not(local_var(4))) then begin
        call guard00;
      end
      else begin
        if (sneaking) then begin
          call guard06;
        end
        else begin
          if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
            call guard00N;
          end
          else begin
            if (local_var(8) == 0) then begin
              call guard10;
            end
          end
        end
      end
      gsay_end;
      end_dialogue;
    end
  guard00a: 'move_to(dude_obj, 28106, 0);

    '
  guard02a: 'float_msg(self_obj, message_str(135, random(169, 174)), 0);

    '
  guard00: |
    gsay_reply(135, 110);
    giq_option(4, 135, 111, guard01, 50);
    giq_option(4, 135, 112, guard00i, 51);
    giq_option(4, 634, 105, guardend, 50);
    giq_option(6, 135, 113, guard00ii, 49);
    giq_option(-3, 135, 114, guard05, 50);
  guard00i: |
    call BigDownReact;
    call guard02;
  guard00ii: |
    call BigUpReact;
    call guard04;
  guard01: |
    gsay_reply(135, 115);
    giq_option(4, 135, 116, guard02, 50);
    giq_option(4, 135, 117, guard01i, 50);
  guard01i: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call guard03;
    end
    else begin
      call guard02;
    end
  guard02: |
    gsay_reply(135, 118);
    giq_option(4, 135, 119, guardend, 50);
    giq_option(4, 135, 120, guard02i, 51);
  guard02i: 'hostile := 1;

    '
  guard03: |
    set_local_var(4, 1);
    gsay_message(135, 121, 50);
  guard04: 'gsay_message(135, 122, 50);

    '
  guard05: 'gsay_message(135, 123, 50);

    '
  guard06: |
    sneaking := 0;
    gsay_reply(135, 124);
    giq_option(4, 135, 125, guard07, 50);
    giq_option(5, 135, 126, guard06i, 50);
    giq_option(-3, 135, 127, guard07, 50);
  guard06i: |
    variable LVar0 := 0;
    times_caught_sneaking := times_caught_sneaking + 1;
    LVar0 := -5 * times_caught_sneaking;
    if (is_success(roll_vs_skill(dude_obj, 14, LVar0))) then begin
      call guard08;
    end
    else begin
      call guard07;
    end
  guard07: |
    if (times_caught_sneaking > 3) then begin
      gsay_message(135, 129, 51);
      add_timer_event(self_obj, game_ticks(10), 3);
    end
    else begin
      gsay_message(135, 128, 51);
    end
  guard08: |
    gsay_reply(135, 130);
    giq_option(5, 135, 131, guardend, 50);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      giq_option(5, 135, 132, guard08i, 50);
    end
    else begin
      giq_option(5, 135, 133, guard08i, 50);
    end
  guard08i: |
    if (random(0, 1)) then begin
      call UpReact;
    end
    else begin
      call DownReact;
    end
  guard10: |
    set_local_var(8, 1);
    gsay_reply(135, 135);
    giq_option(4, 135, 136, guardend, 50);
    giq_option(5, 135, 137, guard12, 50);
    giq_option(6, 135, 138, guard15, 50);
    giq_option(-3, 135, 139, guard11, 50);
  guard11: 'gsay_message(135, 140, 50);

    '
  guard12: |
    gsay_reply(135, 141);
    giq_option(5, 135, 142, guard12i, 50);
    giq_option(5, 135, 143, guard14, 50);
  guard12i: |
    if (is_success(roll_vs_skill(dude_obj, 14, 15))) then begin
      call guard13;
    end
    else begin
      call guard14;
    end
  guard13: |
    gsay_reply(135, 144);
    giq_option(5, 135, 145, guardend, 50);
    giq_option(5, 135, 146, BigDownReact, 51);
  guard14: 'gsay_message(135, 147, 50);

    '
  guard15: |
    gsay_reply(135, 148);
    giq_option(5, 135, 149, guardend, 50);
    if (get_critter_stat(dude_obj, 34) == 1) then begin
      giq_option(5, 135, 150, guard16, 50);
    end
  guard16: 'gsay_message(135, 152, 50);

    '
  Guard18: |
    float_msg(self_obj, message_str(135, 166), 2);
    rm_timer_event(self_obj);
    add_timer_event(self_obj, game_ticks(5), 3);
  guard00N: |
    set_local_var(7, 1);
    gsay_reply(135, 156);
    giq_option(4, 135, 157, guard02N, 50);
    giq_option(4, 135, 158, guard00a, 50);
    giq_option(5, 135, 159, guard00Na, 50);
    giq_option(-3, 135, 160, guard01N, 50);
  guard00Na: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call guard03N;
    end
    else begin
      call guard02N;
    end
  guard01N: 'gsay_message(135, 161, 50);

    '
  guard02N: |
    gsay_message(135, 162, 50);
    move_to(dude_obj, 28106, 0);
  guard03N: |
    set_local_var(5, 1);
    gsay_message(135, 163, 50);
  guardend: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
avery:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 73);
      critter_add_trait(self_obj, 1, 5, 4);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      float_msg(self_obj, message_str(554, 101), 2);
    end
    else begin
      float_msg(self_obj, message_str(554, 102), 2);
    end
    call combat;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(554, 100));
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
barfly:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      call flee_dude;
    end
    call sleeping;
    if ((game_time_hour > (wake_time + 20)) or (game_time_hour < sleep_time)) then begin
      if (tile_num(self_obj) != home_tile) then begin
        animate_move_obj_to_tile(self_obj, home_tile, 0);
      end
    end
    if (global_var(628) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        call flee_dude;
      end
    end
  map_enter_p_proc: |
    if (global_var(15) == 1) then begin
      destroy_object(self_obj);
    end
    night_person := 1;
    wake_time := random(1610, 1640);
    sleep_time := random(310, 340);
    sleep_tile := 7000;
    home_tile := 20675;
    critter_add_trait(self_obj, 1, 6, 16);
    critter_add_trait(self_obj, 1, 5, 5);
    if (map_var(2) == 1) then begin
      destroy_object(self_obj);
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: 'float_msg(self_obj, message_str(473, random(100, 106)), 0);

    '
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(628, 1);
      set_global_var(247, 1);
      set_global_var(155, global_var(155) - 5);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  sleeping: |
    if (local_var(0) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(0, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(0, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(0, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(0, 1);
          end
        end
      end
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
barracus:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 69);
      Only_Once := 0;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        if (local_var(4) == 1) then begin
          display_msg(message_str(397, 100));
        end
        else begin
          display_msg(message_str(397, 101));
        end
      end
      else begin
        if (script_action == 18) then begin
          if (source_obj == dude_obj) then begin
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
              set_global_var(156, 1);
              set_global_var(157, 0);
            end
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
              set_global_var(157, 1);
              set_global_var(156, 0);
            end
            set_global_var(160, global_var(160) + 1);
            if ((global_var(160) % 6) == 0) then begin
              set_global_var(155, global_var(155) + 1);
            end
          end
        end
        else begin
          if (script_action == 4) then begin
            hostile := 1;
          end
          else begin
            if (script_action == 12) then begin
              if (hostile) then begin
                hostile := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call weapon_check;
    call get_reaction;
    start_gdialog(397, self_obj, 4, -1, -1);
    gsay_start;
    if (armed) then begin
      call Barracus04;
    end
    else begin
      if (local_var(4) == 1) then begin
        call Barracus03;
      end
      else begin
        if (get_critter_stat(dude_obj, 34) == 0) then begin
          call Barracus06;
        end
        else begin
          if (get_critter_stat(dude_obj, 3) > 6) then begin
            call Barracus07;
          end
          else begin
            call Barracus06;
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
    set_local_var(4, 1);
  social_skills: |
    call get_reaction;
    dialogue_system_enter;
  weapon_check: |
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      armed := 1;
    end
    else begin
      armed := 0;
    end
  Barracus00: |
    variable LVar0 := 0;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(397, message_str(397, 106));
    end
    else begin
      gsay_reply(397, message_str(397, 107));
    end
    giq_option(0, 397, 104, BarracusCombat, 50);
  Barracus01: |
    gsay_reply(397, 108);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus02: |
    gsay_reply(397, 109);
    giq_option(7, 397, 110, Barracus08, 50);
    giq_option(7, 397, 111, Barracus09, 50);
    giq_option(4, 397, 112, Barracus10, 50);
    giq_option(4, 397, 113, Barracus11, 50);
    giq_option(4, 397, 114, Barracus12, 50);
    giq_option(4, 397, 115, BarracusCombat, 50);
    giq_option(-3, 397, 116, Barracus13, 50);
  Barracus03: |
    gsay_reply(397, 117);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus04: |
    variable LVar0 := 0;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(397, message_str(397, 120));
    end
    else begin
      gsay_reply(397, message_str(397, 121));
    end
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus05: |
    gsay_reply(397, 122);
    giq_option(7, 397, 123, Barracus05a, 50);
    giq_option(7, 397, 124, Barracus16, 50);
    giq_option(4, 397, 125, Barracus17, 50);
    giq_option(4, 397, 126, Barracus18, 50);
    giq_option(4, 397, 127, Barracus19, 50);
    giq_option(-3, 397, 116, Barracus20, 50);
  Barracus05a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Barracus14;
    end
    else begin
      call Barracus15;
    end
  Barracus06: |
    gsay_reply(397, 128);
    giq_option(7, 397, 123, Barracus05a, 50);
    giq_option(7, 397, 129, Barracus20, 50);
    giq_option(4, 397, 130, Barracus21, 50);
    giq_option(4, 397, 131, Barracus22, 50);
    giq_option(4, 397, 132, Barracus23, 50);
    giq_option(4, 397, 133, Barracus24, 50);
    giq_option(-3, 397, 116, Barracus13, 50);
  Barracus07: |
    gsay_reply(397, 134);
    giq_option(7, 397, 123, Barracus05a, 50);
    giq_option(4, 397, 135, Barracus25, 50);
    giq_option(4, 397, 136, Barracus26, 50);
    giq_option(4, 397, 131, Barracus22, 50);
    giq_option(4, 397, 137, Barracus27, 50);
    giq_option(-3, 397, 116, Barracus13, 50);
  Barracus08: |
    gsay_reply(397, 138);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus09: |
    gsay_reply(397, 139);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus10: |
    gsay_reply(397, 140);
    giq_option(4, 397, 141, Barracus28, 50);
    giq_option(4, 397, 142, Barracus29, 50);
    giq_option(4, 397, 143, Barracus30, 50);
    giq_option(4, 397, 144, BarracusCombat, 50);
  Barracus11: |
    gsay_reply(397, 145);
    giq_option(7, 397, 146, Barracus10, 50);
    giq_option(4, 397, 147, Barracus31, 50);
    giq_option(4, 397, 148, Barracus30, 50);
    giq_option(4, 397, 149, BarracusCombat, 50);
  Barracus12: |
    gsay_reply(397, 150);
    giq_option(7, 397, 146, Barracus10, 50);
    giq_option(4, 397, 151, Barracus31, 50);
    giq_option(4, 397, 148, Barracus30, 50);
    giq_option(4, 397, 149, BarracusCombat, 50);
    giq_option(4, 397, 152, BarracusCombat, 50);
  Barracus13: |
    gsay_reply(397, 153);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus14: |
    gsay_reply(397, 154);
    giq_option(7, 397, 155, Barracus14a, 50);
    giq_option(7, 397, 156, Barracus33, 50);
    giq_option(4, 397, 157, Barracus46, 50);
    giq_option(4, 397, 158, Barracus47, 50);
    giq_option(4, 397, 159, Barracus21, 50);
  Barracus14a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Barracus32;
    end
    else begin
      call Barracus15;
    end
  Barracus15: |
    gsay_reply(397, 160);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus16: |
    gsay_reply(397, 161);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus17: |
    gsay_reply(397, 162);
    giq_option(7, 397, 163, Barracus05a, 50);
    giq_option(7, 397, 164, Barracus34, 50);
    giq_option(4, 397, 165, Barracus30, 50);
    giq_option(4, 397, 166, Barracus35, 50);
    giq_option(4, 397, 167, Barracus10, 50);
  Barracus18: |
    gsay_reply(397, 168);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus19: |
    gsay_reply(397, 169);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus20: |
    gsay_reply(397, 170);
    giq_option(7, 397, 123, Barracus05a, 50);
    giq_option(4, 397, 171, Barracus36, 50);
    giq_option(4, 397, 131, Barracus22, 50);
    giq_option(4, 397, 172, Barracus37, 50);
  Barracus21: |
    gsay_reply(397, 173);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus22: |
    gsay_reply(397, 174);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus23: |
    gsay_reply(397, 175);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus24: |
    gsay_reply(397, 176);
    giq_option(7, 397, 123, Barracus05a, 50);
    giq_option(4, 397, 171, Barracus36, 50);
    giq_option(4, 397, 131, Barracus22, 50);
    giq_option(4, 397, 172, Barracus37, 50);
  Barracus25: |
    gsay_reply(397, 177);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus26: |
    gsay_reply(397, 178);
    giq_option(7, 397, 179, Barracus26a, 50);
    giq_option(4, 397, 180, Barracus25, 50);
    giq_option(4, 397, 181, Barracus26, 50);
    giq_option(4, 397, 182, Barracus39, 50);
    giq_option(4, 397, 183, BarracusCombat, 50);
  Barracus26a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Barracus38;
    end
    else begin
      call Barracus25;
    end
  Barracus27: |
    gsay_reply(397, 184);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus28: |
    gsay_reply(397, 185);
    giq_option(7, 397, 186, Barracus40, 50);
    giq_option(4, 397, 187, Barracus41, 50);
    giq_option(4, 397, 188, Barracus42, 50);
    giq_option(4, 397, 189, Barracus29, 50);
    giq_option(4, 397, 190, Barracus43, 50);
    giq_option(4, 397, 191, Barracus19, 50);
  Barracus29: |
    gsay_reply(397, 192);
    giq_option(7, 397, 193, Barracus44, 50);
    giq_option(4, 397, 190, Barracus43, 50);
    giq_option(4, 397, 194, Barracus31, 50);
    giq_option(4, 397, 195, Barracus45, 50);
  Barracus30: |
    gsay_reply(397, 196);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus31: |
    gsay_reply(397, 197);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus32: |
    gsay_reply(397, 198);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus33: |
    gsay_reply(397, 199);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus34: |
    gsay_reply(397, 200);
    giq_option(7, 397, 123, Barracus05a, 50);
    giq_option(4, 397, 171, Barracus36, 50);
    giq_option(4, 397, 131, Barracus22, 50);
    giq_option(4, 397, 172, Barracus37, 50);
  Barracus35: |
    gsay_reply(397, 201);
    giq_option(7, 397, 202, Barracus35a, 50);
    giq_option(4, 397, 203, Barracus36, 50);
    giq_option(4, 397, 204, Barracus22, 50);
    giq_option(4, 397, 205, Barracus21, 50);
  Barracus35a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Barracus48;
    end
    else begin
      call Barracus15;
    end
  Barracus36: |
    gsay_reply(397, 206);
    giq_option(7, 397, 207, Barracus49, 50);
    giq_option(7, 397, 208, Barracus15, 50);
    giq_option(7, 397, 209, Barracus50, 50);
    giq_option(4, 397, 210, Barracus51, 50);
    giq_option(4, 397, 211, Barracus52, 50);
    giq_option(4, 397, 212, Barracus53, 50);
  Barracus37: |
    gsay_reply(397, 213);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus38: |
    gsay_reply(397, 214);
    giq_option(7, 397, 215, Barracus38a, 50);
    giq_option(4, 397, 216, Barracus39, 50);
    giq_option(4, 397, 217, Barracus25, 50);
    giq_option(4, 397, 218, Barracus19, 50);
  Barracus38a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Barracus54;
    end
    else begin
      call Barracus55;
    end
  Barracus39: |
    gsay_reply(397, 219);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus40: |
    gsay_reply(397, 220);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus41: |
    gsay_reply(397, 221);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus42: |
    gsay_reply(397, 222);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus43: |
    gsay_reply(397, 223);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus44: |
    gsay_reply(397, 224);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus45: |
    gsay_reply(397, 225);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus46: |
    gsay_reply(397, 226);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus47: |
    gsay_reply(397, 227);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus48: |
    gsay_reply(397, 228);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus49: |
    gsay_reply(397, 229);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus50: |
    gsay_reply(397, 230);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus51: |
    gsay_reply(397, 231);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus52: |
    gsay_reply(397, 232);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus53: |
    gsay_reply(397, 233);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus54: |
    gsay_reply(397, 234);
    giq_option(0, 397, 104, BarracusEnd, 50);
  Barracus55: |
    gsay_reply(397, 235);
    giq_option(0, 397, 104, BarracusEnd, 50);
  BarracusCombat: 'hostile := 1;

    '
  BarracusEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
barry:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 79);
      set_local_var(1, 0);
      init_teams := 1;
    end
    else begin
      if ((script_action == 11) and (global_var(35) < 1)) then begin
        if (global_var(306) == 0) then begin
          call do_dialogue;
        end
        else begin
          display_msg(message_str(61, 104));
        end
      end
      else begin
        if (script_action == 21) then begin
          script_overrides;
          display_msg(message_str(61, 101));
        end
        else begin
          if (script_action == 4) then begin
            Hostile := 1;
          end
          else begin
            if (script_action == 12) then begin
              call Critter_Action;
            end
            else begin
              if (script_action == 18) then begin
                set_global_var(35, global_var(35) + 1);
                if (global_var(35) > global_var(551)) then begin
                  set_global_var(155, global_var(155) + 3);
                  set_global_var(29, 2);
                  set_global_var(225, game_time / (10 * 60 * 60 * 24));
                end
                if (source_obj == dude_obj) then begin
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                    set_global_var(156, 1);
                    set_global_var(157, 0);
                  end
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                    set_global_var(157, 1);
                    set_global_var(156, 0);
                  end
                  set_global_var(160, global_var(160) + 1);
                  if ((global_var(160) % 6) == 0) then begin
                    set_global_var(155, global_var(155) + 1);
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      call mutant01;
    end
    else begin
      call mutant02;
    end
  mutant01: |
    float_msg(self_obj, message_str(61, 102), 3);
    call combat;
  mutant02: 'float_msg(self_obj, message_str(61, 103), 3);

    '
  combat: 'Hostile := 1;

    '
  Critter_Action: |
    if ((global_var(35) > 0) and obj_can_see_obj(self_obj, dude_obj) and (global_var(306) < 1)) then begin
      Hostile := 1;
    end
    if (Hostile > 0) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if ((global_var(306) == 1) and (tile_num(self_obj) != 15507)) then begin
        animate_move_obj_to_tile(self_obj, 15507, 0);
      end
      else begin
        if ((global_var(306) == 1) and (tile_num(self_obj) == 15507)) then begin
          set_global_var(306, 2);
        end
        else begin
          if ((global_var(306) == 2) and (tile_num(self_obj) != 12536)) then begin
            animate_move_obj_to_tile(self_obj, 12536, 0);
          end
          else begin
            if ((tile_num(self_obj) == 12536) and (global_var(306) == 2)) then begin
              set_obj_visibility(self_obj, 1);
            end
          end
        end
      end
    end
barter:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(3, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(3, 101));
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 6);
    end
  critter_p_proc: |
    if (global_var(246) == 1) then begin
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
    end
  talk_p_proc: |
    variable LVar0 := 0;
    call Get_Stuff;
    gdialog_set_barter_mod(-10);
    if (((game_time / 10) - local_var(1)) > (60 * 60 * 24 * 3)) then begin
      set_local_var(1, game_time / 10);
      set_local_var(2, random(38, 62));
      LVar0 := item_caps_adjust(self_obj, local_var(2));
    end
    else begin
      LVar0 := item_caps_adjust(self_obj, local_var(2));
    end
    start_gdialog(862, self_obj, 4, -1, -1);
    gsay_start;
    call Node000;
    gsay_end;
    end_dialogue;
    set_local_var(2, item_caps_total(self_obj));
    LVar0 := item_caps_adjust(self_obj, -1 * local_var(2));
    call Put_Stuff;
  Node000: |
    gsay_reply(3, 102);
    giq_option(4, 3, 103, Node001, 50);
    giq_option(4, 3, 105, Node002, 50);
    giq_option(-3, 3, 108, Node001, 50);
    giq_option(-3, 3, 107, Node999, 50);
  Node001: |
    gsay_message(3, 104, 50);
    gdialog_mod_barter(-10);
    gsay_reply(3, 109);
    giq_option(4, 3, 110, Node999, 50);
    giq_option(-3, 3, 107, Node999, 50);
  Node002: 'gsay_message(3, 106, 50);

    '
  Node999: "[]"
  Get_Stuff: 'move_obj_inven_to_obj(Barter_Box, self_obj);

    '
  Put_Stuff: 'move_obj_inven_to_obj(self_obj, Barter_Box);

    '
beca:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 47);
      critter_add_trait(self_obj, 1, 5, 27);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj) and (global_var(136) < 41)) then begin
      hostile := 1;
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    set_global_var(136, global_var(136) - 1);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    if ((global_var(135) == 2) or (get_critter_stat(dude_obj, 6) > 6)) then begin
      call show_true_name;
    end
    else begin
      if (get_critter_stat(dude_obj, 6) < 4) then begin
        call show_false_name;
      end
      else begin
        if (get_critter_stat(dude_obj, 4) < 5) then begin
          call show_false_name;
        end
        else begin
          if (random(0, 1)) then begin
            call show_false_name;
          end
          else begin
            call show_true_name;
          end
        end
      end
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (get_critter_stat(dude_obj, 4) < 4) then begin
      display_msg(message_str(766, 175));
    end
    else begin
      set_local_var(0, 1);
      if (global_var(135) == 2) then begin
        call Beca02;
      end
      else begin
        start_gdialog(281, self_obj, 4, -1, -1);
        gsay_start;
        call Beca00;
        gsay_end;
        end_dialogue;
      end
    end
  show_true_name: |
    script_overrides;
    if (local_var(0)) then begin
      if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
        display_msg(message_str(281, 100));
      end
      else begin
        display_msg(message_str(281, 101));
      end
    end
    else begin
      display_msg(message_str(281, 104));
    end
  show_false_name: |
    script_overrides;
    display_msg(message_str(281, random(105, 111)));
  Beca00: |
    gsay_reply(281, 112);
    giq_option(4, 281, 113, BecaCombat, 50);
    giq_option(4, 281, 114, BecaEnd, 50);
    giq_option(4, 281, 115, Beca01, 50);
  Beca01: 'gsay_message(281, 116, 50);

    '
  Beca02: 'float_msg(self_obj, message_str(281, 117), 2);

    '
  BecaCombat: 'hostile := 1;

    '
  BecaEnd: "[]"
bguard:
  start: |
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if (script_action == 12) then begin
        if (hostile) then begin
          hostile := 0;
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
      end
      else begin
        if (script_action == 4) then begin
          hostile := 1;
        end
        else begin
          if ((script_action == 21) or (script_action == 3)) then begin
            script_overrides;
            display_msg(message_str(4, 100));
          end
        end
      end
    end
  do_dialogue: |
    variable LVar0 := 0;
    rndx := random(0, 6);
    if (rndx == 0) then begin
      LVar0 := message_str(4, 101);
    end
    if (rndx == 1) then begin
      LVar0 := message_str(4, 102);
    end
    if (rndx == 2) then begin
      LVar0 := message_str(4, 103);
    end
    if (rndx == 3) then begin
      LVar0 := message_str(4, 104);
    end
    if (rndx == 4) then begin
      LVar0 := message_str(4, 105);
    end
    if (rndx == 5) then begin
      LVar0 := message_str(4, 106);
    end
    if (rndx == 6) then begin
      LVar0 := message_str(4, 107);
    end
    float_msg(self_obj, LVar0, 0);
billy:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 62);
      critter_add_trait(self_obj, 1, 5, 51);
      Billy_ptr := self_obj;
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (Runaway == 0) then begin
      if (global_var(280) == 1) then begin
        call BillyRunAway;
      end
      if ((game_time_hour >= 600) and (game_time_hour < 700)) then begin
        if (SetDayNight != 1) then begin
          add_timer_event(self_obj, game_ticks(10), 1);
          SetDayNight := 1;
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      call Billy11;
    end
  talk_p_proc: |
    call get_reaction;
    if (local_var(6) == 1) then begin
      call Billy10;
    end
    else begin
      if (obj_can_see_obj(self_obj, Dan_ptr) or obj_can_hear_obj(self_obj, Dan_ptr)) then begin
        if (map_var(0) != 2) then begin
          set_map_var(0, 1);
        end
      end
      if (local_var(4) == 1) then begin
        if (map_var(1) == 1) then begin
          call Billy21;
        end
        else begin
          if (map_var(0) == 2) then begin
            call Billy14;
          end
          else begin
            call Billy23;
          end
        end
      end
      else begin
        call Billy00;
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(158, global_var(158) + 1);
      set_global_var(155, global_var(155) - 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(556, 100));
  combat_p_proc: 'set_local_var(6, 1);

    '
  timed_event_p_proc: |
    if (Runaway == 0) then begin
      if ((game_time_hour >= 600) and (game_time_hour < 700) or ((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
        if (Sleeping == 1) then begin
          reg_anim_func(2, self_obj);
          reg_anim_func(1, 1);
          reg_anim_obj_move_to_tile(self_obj, 13889, -1);
          reg_anim_func(3, 0);
          add_timer_event(self_obj, game_ticks(60 * 5), 2);
          Sleeping := 0;
        end
        else begin
          if (fixed_param == 1) then begin
            call SendToStart;
          end
          if (fixed_param == 2) then begin
            call SendToRight;
          end
          if (fixed_param == 3) then begin
            call SendToLeft;
          end
          if (fixed_param == 4) then begin
            call SendToLower;
          end
        end
      end
      else begin
        call SendToSleep;
      end
    end
  Billy00: |
    set_local_var(4, 1);
    start_gdialog(556, self_obj, 4, -1, -1);
    gsay_start;
    gsay_reply(556, 101);
    giq_option(4, 556, 102, Billy04, 50);
    giq_option(4, 556, 103, Billy01, 50);
    giq_option(4, 556, 104, BillyEnd, 50);
    giq_option(-3, 556, 105, Billy06, 50);
    giq_option(-3, 556, 106, Billy06, 50);
    gsay_end;
    end_dialogue;
  Billy01: |
    set_local_var(11, 1);
    gsay_reply(556, 107);
    giq_option(4, 556, 108, Billy02, 50);
    giq_option(4, 556, 109, Billy03, 50);
  Billy02: |
    set_global_var(106, 1);
    gsay_message(556, 110, 50);
  Billy03: 'gsay_message(556, 111, 50);

    '
  Billy04: |
    set_local_var(10, 1);
    gsay_reply(556, 112);
    giq_option(4, 556, 113, Billy12, 50);
    giq_option(4, 556, 114, Billy05, 50);
  Billy05: |
    gsay_reply(556, 115);
    giq_option(4, 556, 116, Billy08, 50);
    giq_option(4, 556, 117, Billy07, 49);
    giq_option(4, 556, 118, BillyEnd, 50);
  Billy06: 'gsay_message(556, 119, 50);

    '
  Billy07: 'gsay_message(556, 120, 49);

    '
  Billy08: |
    gsay_reply(556, 121);
    giq_option(4, 556, 122, BillyEnd, 50);
    giq_option(4, 556, 123, Billy09, 49);
  Billy09: 'gsay_message(556, 124, 49);

    '
  Billy10: |
    if (Once_Which_One == 0) then begin
      Once_Which_One := 1;
      float_msg(self_obj, message_str(556, 125), 8);
    end
    else begin
      float_msg(self_obj, message_str(556, random(126, 129)), 8);
    end
    animate_move_obj_to_tile(self_obj, 15890, 1);
  Billy11: |
    if (local_var(5) == 0) then begin
      set_local_var(5, 1);
      float_msg(self_obj, message_str(556, 130), 8);
    end
    else begin
      float_msg(self_obj, message_str(556, 131), 8);
    end
  Billy12: |
    gsay_reply(556, 132);
    giq_option(4, 556, 133, Billy13, 50);
    giq_option(4, 556, 134, BillyEnd, 50);
  Billy13: 'gsay_message(556, 135, 50);

    '
  Billy14: |
    if (local_var(7) == 1) then begin
      float_msg(self_obj, message_str(556, 142), 8);
    end
    else begin
      set_local_var(7, 1);
      start_gdialog(556, self_obj, 4, -1, -1);
      gsay_start;
      gsay_reply(556, 136);
      giq_option(4, 556, 137, Billy15, 50);
      giq_option(4, 556, 138, Billy14a, 50);
      giq_option(4, 556, 139, BillyEnd, 50);
      giq_option(-3, 556, 140, Billy06, 50);
      giq_option(-3, 556, 141, Billy06, 50);
      gsay_end;
      end_dialogue;
    end
  Billy14a: |
    if (item_caps_total(dude_obj) > 50) then begin
      item_caps_adjust(dude_obj, -50);
      item_caps_adjust(self_obj, 50);
      call Billy19;
    end
    else begin
      call Billy20;
    end
  Billy15: |
    gsay_reply(556, 143);
    giq_option(4, 556, 144, Billy15a, 50);
    giq_option(4, 556, 145, Billy18, 51);
    giq_option(4, 556, 146, BillyEnd, 50);
  Billy15a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Billy16;
    end
    else begin
      call Billy17;
    end
  Billy16: 'gsay_message(556, 147, 50);

    '
  Billy17: 'gsay_message(556, 148, 51);

    '
  Billy18: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(556, 149, 51);
    end
    else begin
      gsay_message(556, 150, 51);
    end
  Billy19: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(556, 151, 49);
    end
    else begin
      gsay_message(556, 152, 49);
    end
    call BillyRunAway;
  Billy20: 'gsay_message(556, 153, 49);

    '
  Billy21: |
    if (local_var(8) == 1) then begin
      float_msg(self_obj, message_str(556, random(158, 164)), 8);
    end
    else begin
      set_local_var(8, 1);
      start_gdialog(556, self_obj, 4, -1, -1);
      gsay_start;
      gsay_reply(556, 154);
      giq_option(4, 556, 155, Billy22, 50);
      giq_option(4, 556, 156, BillyEnd, 50);
      giq_option(-3, 556, 157, Billy06, 50);
      gsay_end;
      end_dialogue;
    end
  Billy22: 'gsay_message(556, 165, 50);

    '
  Billy23: |
    if (local_var(9) == 1) then begin
      float_msg(self_obj, message_str(556, random(172, 178)), 8);
    end
    else begin
      set_local_var(9, 1);
      start_gdialog(556, self_obj, 4, -1, -1);
      gsay_start;
      gsay_reply(556, 166);
      if (local_var(10) == 0) then begin
        giq_option(4, 556, 167, Billy04, 50);
      end
      if (local_var(11) == 4) then begin
        giq_option(4, 556, 168, Billy01, 50);
      end
      giq_option(4, 556, 169, BillyEnd, 50);
      giq_option(-3, 556, 170, Billy06, 50);
      giq_option(-3, 556, 171, Billy06, 50);
      gsay_end;
      end_dialogue;
    end
  BillyRunAway: |
    Runaway := 1;
    animate_move_obj_to_tile(self_obj, 9858, 1);
  SendToStart: |
    if (random(1, 10) >= 7) then begin
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_obj_move_to_tile(self_obj, 13889, -1);
      reg_anim_func(3, 0);
    end
    else begin
      animate_move_obj_to_tile(self_obj, 13889, 1);
    end
    add_timer_event(self_obj, game_ticks(120), 2);
  SendToLeft: |
    if (random(1, 10) >= 7) then begin
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_obj_move_to_tile(self_obj, 13889, -1);
      reg_anim_func(3, 0);
    end
    else begin
      animate_move_obj_to_tile(self_obj, 13889, 1);
    end
    add_timer_event(self_obj, game_ticks(60), 4);
  SendToRight: |
    if (random(1, 10) >= 7) then begin
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_obj_move_to_tile(self_obj, 12072, -1);
      reg_anim_func(3, 0);
    end
    else begin
      animate_move_obj_to_tile(self_obj, 12072, 1);
    end
    add_timer_event(self_obj, game_ticks(60), 3);
  SendToLower: |
    if (random(1, 10) >= 7) then begin
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_obj_move_to_tile(self_obj, 13872, -1);
      reg_anim_func(3, 0);
    end
    else begin
      animate_move_obj_to_tile(self_obj, 13872, 1);
    end
    add_timer_event(self_obj, game_ticks(90), 1);
  SendToSleep: |
    if (Sleeping == 0) then begin
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_obj_move_to_tile(self_obj, 16285, -1);
      reg_anim_func(3, 0);
      Sleeping := 1;
      SetDayNight := 0;
    end
  BillyEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
bitsbob:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(891, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (global_var(305) == 4) then begin
      start_gdialog(891, self_obj, 4, -1, -1);
      gsay_start;
      call Bob51;
      gsay_end;
      end_dialogue;
    end
    else begin
      if (local_var(5) == 0) then begin
        if (local_var(1) == 1) then begin
          start_gdialog(891, self_obj, 4, -1, -1);
          gsay_start;
          call Bob04;
          gsay_end;
          end_dialogue;
        end
        else begin
          start_gdialog(891, self_obj, 4, -1, -1);
          gsay_start;
          call Bob05;
          gsay_end;
          end_dialogue;
        end
      end
      else begin
        if (local_var(5) == 1) then begin
          if (local_var(6) <= (game_time / (10 * 60 * 60 * 24))) then begin
            if (do_check(dude_obj, 0, 0) or do_check(dude_obj, 3, 0)) then begin
              start_gdialog(891, self_obj, 4, -1, -1);
              gsay_start;
              call Bob00;
              gsay_end;
              end_dialogue;
            end
            else begin
              start_gdialog(891, self_obj, 4, -1, -1);
              gsay_start;
              call Bob01;
              gsay_end;
              end_dialogue;
            end
          end
          else begin
            start_gdialog(891, self_obj, 4, -1, -1);
            gsay_start;
            call Bob02;
            gsay_end;
            end_dialogue;
          end
        end
        else begin
          call Bob03;
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 19);
      critter_add_trait(self_obj, 1, 5, 50);
    end
  map_update_p_proc: |
    if (global_var(305) == 3) then begin
      move_to(self_obj, 23065, elevation(self_obj));
      anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), 22662));
      inven_unwield;
      move_obj_inven_to_obj(self_obj, Beth_Box_Ptr);
      set_global_var(305, 4);
    end
  combat: 'hostile := 1;

    '
  BobStandardQuestions: |
    giq_option(4, 891, 231, Bob11, 50);
    if (global_var(101) != 2) then begin
      giq_option(4, 891, 232, Bob18, 50);
    end
    if (global_var(219) == 1) then begin
      if (global_var(203) != 0) then begin
        giq_option(4, 891, 233, Bob23, 50);
      end
      else begin
        giq_option(4, 891, 233, Bob19, 50);
      end
    end
    if (global_var(305) == 1) then begin
      giq_option(4, 891, 234, Bob20, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 891, 235, Bob21, 50);
    end
    giq_option(4, 891, 237, Bob25, 50);
    giq_option(4, 891, 240, BobEnd, 50);
    giq_option(-3, 891, 238, Bob11, 50);
    giq_option(-3, 891, 241, BobEnd, 50);
  BobBlackmailQuestions: |
    giq_option(4, 891, 102, BBQa, 50);
    giq_option(4, 891, 103, Bob06, 51);
    giq_option(4, 891, 104, Bob07, 50);
    if (global_var(219) == 1) then begin
      if (global_var(203) != 0) then begin
        giq_option(4, 891, 233, Bob23, 50);
      end
      else begin
        giq_option(4, 891, 233, Bob08, 50);
      end
    end
    giq_option(4, 891, 106, Bob10, 50);
    giq_option(4, 891, 240, BobEnd, 50);
  BBQa: |
    if (is_success(roll_vs_skill(dude_obj, 14, -15))) then begin
      call Bob09;
    end
    else begin
      call Bob13;
    end
  Bob00: |
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, local_var(7));
    set_local_var(6, (game_time / (10 * 60 * 60 * 24)) + 5);
    gsay_reply(891, 101);
    call BobBlackmailQuestions;
  Bob01: |
    gsay_reply(891, 108);
    giq_option(6, 891, 109, Bob01a, 50);
    giq_option(4, 891, 110, Bob01a, 50);
    giq_option(4, 891, 111, Bob14, 50);
    giq_option(4, 891, 112, Bob15, 50);
    giq_option(4, 891, 113, Bob16, 50);
    giq_option(4, 891, 114, BobCombat, 50);
  Bob01a: |
    if (local_var(7) > 250) then begin
      call Bob13;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
        call Bob12;
      end
      else begin
        call Bob13;
      end
    end
  Bob02: |
    gsay_reply(891, 115);
    call BobBlackmailQuestions;
  Bob03: 'float_msg(self_obj, message_str(891, 116), 2);

    '
  Bob04: |
    gsay_reply(891, 117);
    giq_option(4, 891, 236, Bob22, 50);
    call BobStandardQuestions;
  Bob05: |
    gsay_reply(891, 118);
    call BobStandardQuestions;
  Bob06: |
    gsay_message(891, 119, 51);
    call BobCombat;
  Bob07: |
    set_local_var(5, 3);
    gsay_message(891, 120, 50);
  Bob08: |
    gsay_reply(891, 121);
    giq_option(4, 891, 106, Bob10, 50);
    giq_option(4, 891, 107, Bob11, 50);
  Bob09: |
    gsay_reply(891, 122);
    giq_option(4, 891, message_str(891, 123) + (local_var(7) + 25) + message_str(891, 124), Bob09a, 50);
    giq_option(4, 891, message_str(891, 123) + (local_var(7) + 50) + message_str(891, 124), Bob09b, 50);
    giq_option(4, 891, message_str(891, 123) + (local_var(7) + 75) + message_str(891, 124), Bob09c, 50);
    giq_option(4, 891, message_str(891, 123) + (local_var(7) + 100) + message_str(891, 124), Bob09d, 50);
  Bob09a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0)) or is_success(do_check(dude_obj, 3, 0))) then begin
      set_local_var(7, local_var(7) + 25);
      call Bob46;
    end
    else begin
      call Bob47;
    end
  Bob09b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -15)) or is_success(do_check(dude_obj, 3, -1))) then begin
      set_local_var(7, local_var(7) + 50);
      call Bob46;
    end
    else begin
      call Bob47;
    end
  Bob09c: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30)) or is_success(do_check(dude_obj, 3, -3))) then begin
      set_local_var(7, local_var(7) + 75);
      call Bob46;
    end
    else begin
      call Bob47;
    end
  Bob09d: |
    if (is_success(roll_vs_skill(dude_obj, 14, -45)) or is_success(do_check(dude_obj, 3, -4))) then begin
      set_local_var(7, local_var(7) + 100);
      call Bob46;
    end
    else begin
      call Bob47;
    end
  Bob10: 'gsay_message(891, 125, 50);

    '
  Bob11: |
    gsay_reply(891, 142);
    giq_option(4, 891, 129, Bob27, 50);
    giq_option(4, 891, 131, Bob28, 50);
    giq_option(4, 891, 130, Bob30, 50);
    giq_option(-3, 891, 203, Bob27, 50);
    giq_option(-3, 891, 204, Bob28, 50);
    giq_option(-3, 891, 133, Bob30, 50);
  Bob12: |
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, local_var(7));
    set_local_var(6, (game_time / (10 * 60 * 60 * 24)) + 5);
    gsay_message(891, 134, 51);
  Bob13: |
    set_local_var(5, 2);
    gsay_message(891, 135, 51);
  Bob14: |
    set_local_var(5, 2);
    gsay_message(891, 136, 51);
  Bob15: |
    set_local_var(5, 2);
    gsay_message(891, 137, 51);
  Bob16: |
    set_local_var(5, 2);
    gsay_message(891, 138, 51);
  Bob18: |
    gsay_reply(891, 148);
    giq_option(4, 891, 149, Bob32, 50);
    call BobStandardQuestions;
  Bob19: |
    set_global_var(219, 1);
    gsay_reply(891, 150);
    giq_option(4, 891, 152, Bob33, 50);
    call BobStandardQuestions;
  Bob20: |
    gsay_reply(891, 153);
    giq_option(4, 891, 154, Bob20a, 50);
    giq_option(4, 891, 155, Bob34, 50);
    giq_option(4, 891, 156, Bob35, 50);
    giq_option(4, 891, 157, Bob36, 50);
  Bob20a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 20))) then begin
      call Bob36;
    end
    else begin
      call Bob34;
    end
  Bob21: |
    gsay_reply(891, 239);
    call BobStandardQuestions;
  Bob22: |
    gsay_reply(891, 158);
    call BobStandardQuestions;
  Bob23: |
    gsay_reply(891, 159);
    call BobStandardQuestions;
  Bob25: |
    if ((global_var(203) != 0) and (ToldRumor1 == 0)) then begin
      ToldRumor1 := 1;
      set_global_var(219, 1);
      gsay_message(891, 160, 50);
    end
    else begin
      if ((global_var(221) == 1) and (ToldRumor2 == 0)) then begin
        ToldRumor2 := 1;
        gsay_message(891, 161, 50);
      end
      else begin
        if ((global_var(111) == 2) and (ToldRumor3 == 0)) then begin
          ToldRumor3 := 1;
          gsay_message(891, 162, 50);
        end
        else begin
          if ((global_var(107) == 2) and (ToldRumor4 == 0)) then begin
            ToldRumor4 := 1;
            gsay_message(891, 163, 50);
          end
          else begin
            if ((global_var(112) == 2) and (ToldRumor5 == 0)) then begin
              ToldRumor5 := 1;
              gsay_message(891, 164, 50);
            end
            else begin
              gsay_message(891, 165, 50);
            end
          end
        end
      end
    end
    gsay_message(891, 166, 50);
    call BobStandardQuestions;
  Bob27: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (item_caps_total(dude_obj) < 20) then begin
      gsay_message(891, 169, 50);
    end
    else begin
      LVar1 := item_caps_adjust(dude_obj, -20);
      LVar0 := create_object_sid(81, 0, 0, -1);
      add_obj_to_inven(dude_obj, LVar0);
      gsay_message(891, 170, 50);
    end
    call BobStandardQuestions;
  Bob28: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (item_caps_total(dude_obj) < 8) then begin
      gsay_message(891, 173, 50);
    end
    else begin
      LVar1 := item_caps_adjust(dude_obj, -8);
      LVar0 := create_object_sid(103, 0, 0, -1);
      add_obj_to_inven(dude_obj, LVar0);
      if (local_var(5) > 0) then begin
        gsay_message(891, 171, 50);
        giq_option(4, 891, 172, Bob38, 50);
      end
      else begin
        gsay_message(891, 174, 50);
      end
    end
    call BobStandardQuestions;
  Bob30: 'gsay_message(891, 175, 50);

    '
  Bob32: |
    gsay_reply(891, 180);
    call BobStandardQuestions;
  Bob33: |
    set_global_var(219, 1);
    gsay_reply(891, 182);
    call BobStandardQuestions;
  Bob34: |
    set_local_var(5, 2);
    gsay_message(891, 183, 51);
  Bob35: |
    gsay_reply(891, 184);
    giq_option(4, 891, 185, Bob42, 50);
    giq_option(4, 891, 186, Bob43, 50);
    giq_option(4, 891, 187, Bob44, 50);
  Bob36: |
    gsay_reply(891, 188);
    giq_option(4, 891, 189, Bob42, 50);
    giq_option(4, 891, 190, Bob43, 50);
    giq_option(4, 891, 191, Bob44, 50);
  Bob38: 'gsay_message(891, 194, 51);

    '
  Bob42: 'gsay_message(891, 207, 50);

    '
  Bob43: |
    gsay_reply(891, 208);
    giq_option(4, 891, 209, BobCombat, 50);
    giq_option(4, 891, 210, Bob45, 50);
    giq_option(4, 891, 211, Bob44, 50);
  Bob44: |
    gsay_reply(891, 212);
    giq_option(4, 891, message_str(891, 213) + message_str(891, 214) + message_str(891, 219), Bob44a, 50);
    giq_option(4, 891, message_str(891, 213) + message_str(891, 215) + message_str(891, 219), Bob44b, 50);
    giq_option(4, 891, message_str(891, 213) + message_str(891, 216) + message_str(891, 219), Bob44c, 50);
    giq_option(4, 891, message_str(891, 213) + message_str(891, 217) + message_str(891, 219), Bob44d, 50);
    giq_option(4, 891, message_str(891, 213) + message_str(891, 218) + message_str(891, 219), Bob44e, 50);
    giq_option(4, 891, 220, Bob48, 50);
  Bob44a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 20)) or is_success(do_check(dude_obj, 3, 2))) then begin
      set_local_var(7, 50);
      call Bob46;
    end
    else begin
      call Bob13;
    end
  Bob44b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0)) or is_success(do_check(dude_obj, 3, 0))) then begin
      set_local_var(7, 75);
      call Bob46;
    end
    else begin
      call Bob13;
    end
  Bob44c: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10)) or is_success(do_check(dude_obj, 3, -1))) then begin
      set_local_var(7, 100);
      call Bob46;
    end
    else begin
      call Bob13;
    end
  Bob44d: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30)) or is_success(do_check(dude_obj, 3, -3))) then begin
      set_local_var(7, 150);
      call Bob46;
    end
    else begin
      call Bob13;
    end
  Bob44e: |
    if (is_success(roll_vs_skill(dude_obj, 14, -60)) or is_success(do_check(dude_obj, 3, -6))) then begin
      set_local_var(7, 200);
      call Bob46;
    end
    else begin
      call Bob13;
    end
  Bob45: |
    gsay_message(891, 221, 51);
    set_global_var(305, 2);
    display_msg(message_str(696, 182));
  Bob46: |
    if (local_var(5) != 1) then begin
      give_exp_points(500);
      display_msg(message_str(766, 103) + 500 + message_str(766, 104));
    end
    set_local_var(5, 1);
    set_local_var(6, (game_time / (10 * 60 * 60 * 24)) + 5);
    set_global_var(155, global_var(155) - 2);
    gsay_message(891, message_str(891, 222) + local_var(7) + message_str(891, 223), 50);
  Bob47: |
    gsay_reply(891, 224);
    giq_option(4, 891, 225, Bob49, 50);
    giq_option(4, 891, 226, Bob50, 50);
    giq_option(4, 891, 227, Bob13, 50);
  Bob48: 'gsay_message(891, 228, 51);

    '
  Bob49: 'gsay_message(891, 229, 51);

    '
  Bob50: 'gsay_message(891, 230, 50);

    '
  Bob51: 'gsay_message(891, 116, 50);

    '
  BobEnd: "[]"
  BobCombat: 'call combat;

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
blade:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(279, 100));
  talk_p_proc: |
    if (global_var(253) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if (global_var(613) == 2) then begin
        float_msg(self_obj, message_str(279, random(101, 115)), 0);
      end
      else begin
        float_msg(self_obj, message_str(279, random(101, 111)), 0);
      end
    end
  critter_p_proc: |
    variable LVar0 := 0;
    LVar0 := global_var(345);
    if ((((game_time / 10) - LVar0) >= 10) and (tile_distance_objs(self_obj, dude_obj) <= 4) and (global_var(253) == 0)) then begin
      if (global_var(613) == 2) then begin
        float_msg(self_obj, message_str(279, random(101, 115)), 0);
      end
      else begin
        float_msg(self_obj, message_str(279, random(101, 111)), 0);
      end
      LVar0 := game_time / 10;
      set_global_var(345, LVar0);
    end
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(253) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  timed_event_p_proc: |
    variable LVar0 := 0;
    LVar0 := tile_num_in_direction(local_var(4), random(0, 5), random(1, 5));
    animate_move_obj_to_tile(self_obj, LVar0, 0);
    add_timer_event(self_obj, game_ticks(random(3, 5)), 1);
  pickup_p_proc: 'set_global_var(253, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      if (obj_is_carrying_obj_pid(self_obj, 41) == 0) then begin
        item_caps_adjust(self_obj, random(10, 100));
      end
      critter_add_trait(self_obj, 1, 6, 47);
      critter_add_trait(self_obj, 1, 5, 27);
      add_timer_event(self_obj, game_ticks(random(3, 5)), 1);
      if (local_var(4) == 0) then begin
        set_local_var(4, tile_num(self_obj));
      end
      Initialize := 0;
    end
blast:
  start: |
    if (script_action == 7) then begin
      if (obj_pid(obj_being_used_with) == 85) then begin
        script_overrides;
        test := roll_vs_skill(dude_obj, 11, 0);
        if (is_success(test)) then begin
          display_msg(message_str(463, 100));
          give_exp_points(1);
          display_msg(message_str(463, 103));
        end
        else begin
          if (is_critical(test)) then begin
            display_msg(message_str(463, 101));
            damage := random(10, 40);
            critter_dmg(dude_obj, damage, 0);
          end
          else begin
            display_msg(message_str(463, 102));
          end
        end
      end
    end
blkrom:
  start: |
    if (script_action == 2) then begin
      if (obj_type(source_obj) == dude_obj) then begin
        if (local_var(4) == 0) then begin
          if (get_critter_stat(dude_obj, 4) > 6) then begin
            display_msg(message_str(189, 100));
          end
          else begin
            display_msg(message_str(189, 101));
          end
          set_local_var(4, 1);
        end
      end
    end
blkroom:
  start: |
    if (script_action == 2) then begin
      if (obj_type(source_obj) == dude_obj) then begin
        if (local_var(0) == 0) then begin
          if (get_critter_stat(dude_obj, 4) > 6) then begin
            display_msg(message_str(111, 100));
          end
          else begin
            display_msg(message_str(111, 101));
          end
          set_local_var(0, 1);
        end
      end
    end
bobsign:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    if (global_var(305) == 4) then begin
      display_msg(message_str(969, 101));
    end
    else begin
      display_msg(message_str(969, 103));
    end
  description_p_proc: |
    script_overrides;
    if (global_var(305) == 4) then begin
      display_msg(message_str(969, 100));
    end
    else begin
      display_msg(message_str(969, 104));
    end
bonebody:
  start: |
    if (script_action == 3) then begin
      call look_at_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    rndx := random(1, 3);
    if (rndx == 1) then begin
      display_msg(message_str(293, 100));
    end
    else begin
      if (rndx == 2) then begin
        display_msg(message_str(293, 101));
      end
      else begin
        if (rndx == 3) then begin
          display_msg(message_str(293, 102));
        end
      end
    end
bookcase:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
    else begin
      if (script_action == 8) then begin
        call use_skill_on_p_proc;
      end
      else begin
        if (script_action == 6) then begin
          call use_p_proc;
        end
        else begin
          if (script_action == 4) then begin
            call pickup_p_proc;
          end
        end
      end
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(810, 200));
  use_p_proc: |
    script_overrides;
    if ((local_var(0) == 1) or (Door_Test == 1)) then begin
      display_msg(message_str(810, 104));
      use_obj(J_Door_Ptr);
    end
    else begin
      display_msg(message_str(810, 101));
    end
  pickup_p_proc: 'script_overrides;

    '
  use_skill_on_p_proc: |
    use_skill := action_being_used;
    if ((local_var(0) == 0) and (Door_Test == 0)) then begin
      if (use_skill == 9) then begin
        script_overrides;
        if (is_success(roll_vs_skill(dude_obj, 9, 0))) then begin
          set_local_var(0, 1);
          Door_Test := 1;
          display_msg(message_str(810, 102));
        end
        else begin
          display_msg(message_str(810, 105));
        end
      end
      else begin
        if (use_skill == 11) then begin
          script_overrides;
          if (is_success(roll_vs_skill(dude_obj, 11, 0))) then begin
            set_local_var(0, 1);
            Door_Test := 1;
            display_msg(message_str(810, 102));
          end
          else begin
            display_msg(message_str(810, 105));
          end
        end
        else begin
          display_msg(message_str(810, 103));
        end
      end
    end
    else begin
      display_msg(message_str(810, 103));
    end
  secret: |
    set_local_var(0, 1);
    display_msg(message_str(810, 102));
bookheav:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(974, 100));
  pickup_p_proc: |
    script_overrides;
    display_msg(message_str(974, 101));
boslori:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 63);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(675, self_obj, 4, -1, -1);
    gsay_start;
    call do_dialog;
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(675, 100));
  boslori00: |
    heal := get_critter_stat(dude_obj, 7) - get_critter_stat(dude_obj, 35);
    gsay_reply(675, 102);
    if (heal > 0) then begin
      giq_option(4, 675, 103, boslori04, 50);
    end
    if (get_critter_stat(dude_obj, 37) > 0) then begin
      giq_option(5, 675, 104, boslori05, 50);
    end
    if (local_var(5) != 1) then begin
      giq_option(4, 675, 105, boslori07, 50);
    end
    else begin
      giq_option(4, 675, 106, boslori09, 50);
    end
    if ((local_var(11) == 1) or (local_var(9) == 1)) then begin
      giq_option(-3, 675, 107, boslori01, 50);
    end
    else begin
      giq_option(-3, 675, 107, Dumb02, 50);
    end
  boslori01: |
    gsay_message(675, 108, 50);
    if (heal > 0) then begin
      call boslori02;
    end
    else begin
      call boslori03;
    end
  boslori02: |
    critter_heal(dude_obj, heal);
    gsay_message(675, 109, 50);
  boslori03: 'gsay_message(675, 110, 50);

    '
  boslori04: |
    critter_heal(dude_obj, heal);
    gsay_message(675, random(112, 116), 50);
  boslori05: |
    gsay_message(675, 117, 50);
    gfade_out(600);
    rad_level := get_critter_stat(dude_obj, 37);
    radiation_dec(dude_obj, rad_level);
    game_time_advance(game_ticks(86400));
    gfade_in(600);
    gsay_message(675, 146, 50);
  boslori06: 'gsay_message(675, 118, 50);

    '
  boslori07: |
    gsay_reply(675, 119);
    giq_option(4, 675, 120, boslori08, 50);
    giq_option(4, 675, 121, bosloriend, 50);
  boslori08: |
    set_local_var(5, 1);
    gsay_message(675, 122, 50);
    call boslori10;
  boslori09: |
    gsay_reply(675, 126);
    call boslori10;
  boslori10: |
    if (local_var(6) != 1) then begin
      giq_option(4, 675, 127, boslori11, 50);
    end
    if (local_var(7) != 1) then begin
      giq_option(4, 675, 128, boslori12, 50);
    end
    if (local_var(8) != 1) then begin
      giq_option(4, 675, 129, boslori13, 50);
    end
    if (local_var(9) != 1) then begin
      giq_option(4, 675, 130, boslori14, 50);
    end
    if (local_var(10) != 1) then begin
      giq_option(4, 675, 131, boslori15, 50);
    end
    giq_option(4, 675, 132, bosloriend, 50);
  boslori11: |
    armor := critter_inven_obj(dude_obj, 0);
    if (armor != 0) then begin
      bag_ptr := create_object_sid(16777262, 0, 0, 860);
      move_to(bag_ptr, 0, 0);
      move_obj_inven_to_obj(dude_obj, bag_ptr);
      move_obj_inven_to_obj(bag_ptr, dude_obj);
      destroy_object(bag_ptr);
    end
    temp := get_critter_stat(dude_obj, 0);
    if (temp > 9) then begin
      call sorry;
    end
    else begin
      gsay_reply(675, 133);
      giq_option(4, 675, 135, boslori18, 50);
      giq_option(4, 675, 136, boslori17, 50);
    end
  boslori12: |
    temp := get_critter_stat(dude_obj, 1);
    if (temp > 9) then begin
      call sorry;
    end
    else begin
      gsay_reply(675, 137);
      giq_option(4, 675, 135, boslori19, 50);
      giq_option(4, 675, 136, boslori17, 50);
    end
  boslori13: |
    temp := get_critter_stat(dude_obj, 2);
    if (temp > 9) then begin
      call sorry;
    end
    else begin
      gsay_reply(675, 139);
      giq_option(4, 675, 135, boslori20, 50);
      giq_option(4, 675, 136, boslori17, 50);
    end
  boslori14: |
    temp := get_critter_stat(dude_obj, 4);
    if (temp > 9) then begin
      call sorry;
    end
    else begin
      gsay_reply(675, 141);
      giq_option(4, 675, 135, raisiq, 50);
      giq_option(4, 675, 136, boslori17, 50);
    end
  boslori15: |
    temp := get_critter_stat(dude_obj, 5);
    if (temp > 9) then begin
      call sorry;
    end
    else begin
      gsay_reply(675, 143);
      giq_option(4, 675, 135, boslori22, 50);
      giq_option(4, 675, 136, boslori17, 50);
    end
  boslori16: 'gsay_message(675, random(147, 149), 50);

    '
  boslori17: |
    gsay_message(675, 153, 50);
    call boslori10;
  boslori18: |
    cost := 2000;
    if (item_caps_total(dude_obj) >= cost) then begin
      armor := critter_inven_obj(dude_obj, 0);
      if (armor != 0) then begin
        bag_ptr := create_object_sid(16777262, 0, 0, 860);
        move_to(bag_ptr, 0, 0);
        move_obj_inven_to_obj(dude_obj, bag_ptr);
        move_obj_inven_to_obj(bag_ptr, dude_obj);
        destroy_object(bag_ptr);
      end
      set_local_var(6, 1);
      item_caps_adjust(dude_obj, -cost);
      gsay_message(675, 154, 50);
      gfade_out(600);
      game_time_advance(game_ticks(3 * 604800));
      gfade_in(600);
      temp := get_critter_stat(dude_obj, 0);
      set_critter_stat(dude_obj, 0, 1);
      gsay_message(675, 156, 50);
    end
    else begin
      call boslori16;
    end
  boslori19: |
    cost := 4000;
    if (item_caps_total(dude_obj) >= cost) then begin
      set_local_var(7, 1);
      item_caps_adjust(dude_obj, -cost);
      gsay_message(675, 159, 50);
      gfade_out(600);
      game_time_advance(game_ticks(604800));
      gfade_in(600);
      temp := get_critter_stat(dude_obj, 1);
      set_critter_stat(dude_obj, 1, 1);
      gsay_message(675, 161, 50);
    end
    else begin
      call boslori16;
    end
  boslori20: |
    cost := 3000;
    if (item_caps_total(dude_obj) >= cost) then begin
      set_local_var(8, 1);
      item_caps_adjust(dude_obj, -cost);
      gsay_message(675, 164, 50);
      gfade_out(600);
      game_time_advance(game_ticks(604800));
      gfade_in(600);
      temp := get_critter_stat(dude_obj, 2);
      set_critter_stat(dude_obj, 2, 1);
      gsay_message(675, 166, 50);
    end
    else begin
      call boslori16;
    end
  Dumb02: |
    gsay_reply(675, 400);
    if (local_var(9) != 1) then begin
      giq_option(-3, 675, 401, Dumb04, 50);
    end
    giq_option(-3, 675, 402, Dumb03, 50);
  Dumb03: |
    gsay_reply(675, 403);
    giq_option(-3, 675, 404, Dumb06a, 50);
    giq_option(-3, 675, 405, boslori05, 50);
    giq_option(-3, 675, 406, bosloriend, 50);
  Dumb04: |
    variable LVar0 := 0;
    LVar0 := 3000;
    if (item_caps_total(dude_obj) >= LVar0) then begin
      set_local_var(9, 1);
      set_local_var(11, 1);
      item_caps_adjust(dude_obj, -LVar0);
      gsay_message(675, 164, 50);
      gfade_out(600);
      game_time_advance(game_ticks(604800));
      gfade_in(600);
      temp := get_critter_stat(dude_obj, 4);
      set_critter_stat(dude_obj, 4, 1);
      gsay_reply(675, 407);
      giq_option(4, 675, 409, Dumb06, 50);
      giq_option(-3, 675, 408, Dumb05, 50);
    end
    else begin
      call boslori16;
    end
  Dumb05: 'gsay_message(675, 410, 50);

    '
  Dumb06: |
    gsay_reply(675, 411);
    giq_option(4, 675, 412, bosloriend, 50);
  Dumb06a: |
    Hurting := get_critter_stat(dude_obj, 7) - get_critter_stat(dude_obj, 35);
    critter_heal(dude_obj, Hurting);
    gsay_message(675, 413, 50);
  raisiq: |
    cost := 6000;
    if (item_caps_total(dude_obj) >= cost) then begin
      set_local_var(9, 1);
      item_caps_adjust(dude_obj, -cost);
      gsay_message(675, 168, 50);
      gfade_out(600);
      game_time_advance(game_ticks(3 * 604800));
      gfade_in(600);
      temp := get_critter_stat(dude_obj, 4);
      set_critter_stat(dude_obj, 4, 1);
      gsay_message(675, 170, 50);
    end
    else begin
      call boslori16;
    end
  boslori22: |
    cost := 5000;
    if (item_caps_total(dude_obj) >= cost) then begin
      set_local_var(10, 1);
      item_caps_adjust(dude_obj, -cost);
      gsay_message(675, 174, 50);
      gfade_out(600);
      game_time_advance(game_ticks(3 * 604800));
      gfade_in(600);
      temp := get_critter_stat(dude_obj, 5);
      set_critter_stat(dude_obj, 5, 1);
      gsay_message(675, 176, 50);
    end
    else begin
      call boslori16;
    end
  bosloriend: "[]"
  sorry: 'gsay_message(675, 300, 50);

    '
  do_dialog: 'call boslori00;

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
boxguard:
  start: "[]"
  critter_p_proc: |
    if (global_var(627) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (Saul_loses) then begin
        if ((obj_pid(challenger_ptr) == 16777227) or (obj_pid(challenger_ptr) == 16777226)) then begin
          if (shot_challenger == 0) then begin
            Saul_loses := 0;
            anim(self_obj, 1000, 5);
            float_msg(self_obj, message_str(835, random(100, 103)), 0);
            reg_anim_func(2, self_obj);
            reg_anim_func(1, 1);
            reg_anim_animate(self_obj, 43, -1);
            reg_anim_animate(self_obj, 45, -1);
            sfx_name := sfx_build_weapon_name(1, obj_carrying_pid_obj(self_obj, 8), 2, challenger_ptr);
            reg_anim_play_sfx(dude_obj, sfx_name, -1);
            reg_anim_animate(challenger_ptr, 14, 4);
            reg_anim_animate(self_obj, 43, -1);
            reg_anim_animate(self_obj, 45, -1);
            sfx_name := sfx_build_weapon_name(1, obj_carrying_pid_obj(self_obj, 8), 2, challenger_ptr);
            reg_anim_play_sfx(dude_obj, sfx_name, -1);
            reg_anim_animate(challenger_ptr, 34, 4);
            reg_anim_animate(self_obj, 44, -1);
            reg_anim_func(3, 0);
            rm_timer_event(self_obj);
            add_timer_event(self_obj, game_ticks(5), 1);
          end
        end
        else begin
          shot_challenger := 1;
        end
      end
      else begin
        if (Saul_wins) then begin
          shot_challenger := 1;
        end
      end
    end
  destroy_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_carrying_pid_obj(self_obj, 1);
    if (LVar0) then begin
      rm_obj_from_inven(self_obj, LVar0);
      destroy_object(LVar0);
    end
    if (source_obj == dude_obj) then begin
      set_global_var(627, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  map_enter_p_proc: |
    if (global_var(15) == 1) then begin
      kill_critter(self_obj, 49);
    end
    if (local_var(0) == 0) then begin
      set_local_var(0, tile_num(self_obj));
    end
    home_tile := local_var(0);
    critter_add_trait(self_obj, 1, 6, 15);
    if (item_caps_total(self_obj) == 0) then begin
      item_caps_adjust(self_obj, random(10, 25));
    end
  talk_p_proc: 'float_msg(self_obj, message_str(835, random(106, 107)), 0);

    '
  timed_event_p_proc: |
    Saul_loses := 1;
    shot_challenger := 1;
brahmin:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  critter_p_proc: |
    if (not(initialized)) then begin
      add_timer_event(self_obj, game_ticks(random(1, 5)), 1);
      initialized := 1;
    end
  description_p_proc: 'display_msg(message_str(34, 100));

    '
  talk_p_proc: 'float_msg(self_obj, message_str(34, 103), 0);

    '
  timed_event_p_proc: |
    if (((critter_state(self_obj) bwand 2) == 0) and not(combat_is_initialized)) then begin
      critter_tile := tile_num_in_direction(tile_num(self_obj), random(0, 5), 3);
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_obj_move_to_tile(self_obj, critter_tile, -1);
      reg_anim_func(3, 0);
    end
    add_timer_event(self_obj, game_ticks(random(3, 5)), 1);
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    if ((obj_pid(obj_being_used_with) == 124) or (obj_pid(obj_being_used_with) == 125)) then begin
      script_overrides;
      LVar0 := obj_being_used_with;
      rm_obj_from_inven(source_obj, obj_being_used_with);
      destroy_object(LVar0);
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_animate(self_obj, 14, -1);
      reg_anim_animate(self_obj, 20, 5);
      reg_anim_animate(self_obj, 48, -1);
      reg_anim_func(3, 0);
      critter_injure(self_obj, 2);
    end
  use_skill_on_p_proc: |
    if (action_being_used == 12) then begin
      script_overrides;
      if (is_success(roll_vs_skill(dude_obj, action_being_used, 0))) then begin
        display_msg(message_str(34, 101));
      end
      else begin
        display_msg(message_str(34, 102));
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      if ((cur_map_index == 10) or (cur_map_index == 12)) then begin
        set_global_var(247, 1);
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if ((cur_map_index == 10) or (cur_map_index == 12)) then begin
        set_global_var(247, 1);
      end
    end
brenden:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 62);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 11) then begin
            call talk_p_proc;
          end
        end
      end
    end
  critter_p_proc: |
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      animate_move_obj_to_tile(self_obj, 25699, 0);
      if (anim_busy(self_obj) == 0) then begin
        anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), 25699));
      end
    end
    else begin
      animate_move_obj_to_tile(self_obj, 20912, 0);
    end
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  talk_p_proc: |
    start_gdialog(666, self_obj, 4, -1, -1);
    gsay_start;
    call Brenden01;
    gsay_end;
    end_dialogue;
  Brenden01: |
    if (local_var(0)) then begin
      gsay_reply(666, 112);
    end
    else begin
      set_local_var(0, 1);
      gsay_reply(666, 102);
    end
    giq_option(-3, 666, 107, Brenden05, 50);
    giq_option(4, 666, 103, Brenden02, 50);
    giq_option(4, 666, 104, Brenden03, 50);
    giq_option(4, 666, 105, Brenden04, 50);
    if (local_var(1) == 0) then begin
      giq_option(4, 666, 106, Brenden06, 50);
    end
    giq_option(4, 666, 113, BrendenEnd, 50);
  Brenden02: |
    gsay_reply(666, 109);
    giq_option(0, 634, 106, Brenden01, 50);
  Brenden03: |
    gsay_reply(666, 110);
    giq_option(0, 634, 106, Brenden01, 50);
  Brenden04: |
    gsay_reply(666, 111);
    giq_option(0, 634, 106, Brenden01, 50);
  Brenden05: 'gsay_message(666, 108, 50);

    '
  Brenden06: |
    set_local_var(1, 1);
    gsay_reply(666, 114);
    giq_option(4, 666, 115, Brenden07, 49);
    giq_option(4, 666, 116, Brenden12, 51);
    giq_option(4, 666, 113, BrendenEnd, 50);
  Brenden07: |
    gsay_reply(666, 117);
    giq_option(6, 666, 118, Brenden08, 50);
    giq_option(4, 666, 119, Brenden11, 50);
    giq_option(4, 666, 113, BrendenEnd, 50);
  Brenden08: |
    gsay_reply(666, 120);
    giq_option(6, 666, 121, Brenden09, 49);
    giq_option(4, 666, 113, BrendenEnd, 50);
  Brenden09: |
    gsay_reply(666, 122);
    giq_option(6, 666, 123, Brenden10, 50);
    giq_option(4, 666, 113, BrendenEnd, 50);
  Brenden10: |
    gsay_reply(666, 124);
    giq_option(4, 666, 113, BrendenEnd, 50);
  Brenden11: |
    gsay_reply(666, 125);
    giq_option(4, 666, 126, Brenden09, 49);
    giq_option(4, 666, 113, BrendenEnd, 50);
  Brenden12: 'gsay_message(666, 127, 51);

    '
  BrendenEnd: "[]"
broeld:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 80);
    end
    if (script_action == 11) then begin
      call talk_p_proc;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 4) then begin
          call pickup_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  talk_p_proc: 'float_msg(self_obj, message_str(944, random(101, 105)), 2);

    '
  pickup_p_proc: 'hostile := 1;

    '
  look_at_p_proc: 'display_msg(message_str(944, 100));

    '
  destroy_p_proc: 'set_global_var(250, 1);

    '
broinvad:
  start: "[]"
  talk_p_proc: |
    anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)));
    if (global_var(223) != 10) then begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        float_msg(self_obj, message_str(819, random(100, 105)), 9);
      end
      else begin
        float_msg(self_obj, message_str(819, random(106, 111)), 9);
      end
    end
    call StepAside;
  critter_p_proc: |
    if (not((cur_map_index == 17) or (cur_map_index == 18) or (cur_map_index == 33) or (cur_map_index == 34) or (cur_map_index == 30) or ((cur_map_index == 31) and (elevation(self_obj) == 0)))) then begin
      float_msg(self_obj, message_str(819, 115), 9);
      party_remove(self_obj);
      destroy_object(self_obj);
    end
    if ((global_var(223) == 1) and ((cur_map_index == 17) or (cur_map_index == 18) or (cur_map_index == 33) or (cur_map_index == 34)) or ((global_var(223) == 2) and ((cur_map_index == 30) or (cur_map_index == 31)))) then begin
      if (tile_distance_objs(dude_obj, self_obj) > 10) then begin
        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), random(3, 6)), 1);
      end
      if (local_var(0) == 0) then begin
        if ((tile_distance_objs(dude_obj, self_obj) < 8) and ((cur_map_index == 17) or (cur_map_index == 30))) then begin
          set_local_var(0, 1);
          float_msg(self_obj, message_str(819, 112), 9);
        end
      end
    end
    if ((local_var(4) == 1) and (cur_map_index == 17) and (elevation(self_obj) == local_var(3)) and not(combat_is_initialized)) then begin
      set_local_var(4, 0);
      set_local_var(1, 2);
      party_remove(self_obj);
      set_global_var(223, 10);
      reg_anim_func(2, self_obj);
      float_msg(self_obj, message_str(819, 115), 9);
      add_timer_event(self_obj, 10, 1);
    end
    if ((global_var(271) == 2) and (local_var(1) == 1) and (cur_map_index == 30) and (local_var(5) == 1) and not(combat_is_initialized)) then begin
      set_local_var(1, 2);
      party_remove(self_obj);
      set_global_var(223, 10);
      reg_anim_func(2, self_obj);
      float_msg(self_obj, message_str(819, 115), 9);
      add_timer_event(self_obj, 10, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 0);
      critter_add_trait(self_obj, 1, 5, 65);
      Only_Once := 0;
    end
    if (metarule(22, 0) == 0) then begin
      if ((local_var(1) == 0) and ((global_var(223) == 1) and (cur_map_index == 17) or ((global_var(223) == 2) and (cur_map_index == 30)))) then begin
        set_local_var(1, 1);
        if (metarule(22, 0) == 0) then begin
          set_obj_visibility(self_obj, 0);
        end
        party_add(self_obj);
      end
      else begin
        if ((global_var(223) != 1) and ((cur_map_index == 17) or (cur_map_index == 18) or (cur_map_index == 33) or (cur_map_index == 34)) or ((global_var(223) != 2) and ((cur_map_index == 30) or (cur_map_index == 31) or (cur_map_index == 32)))) then begin
          if (metarule(22, 0) == 0) then begin
            set_obj_visibility(self_obj, 1);
          end
          if (local_var(1) != 0) then begin
            party_remove(self_obj);
            destroy_object(self_obj);
          end
        end
        else begin
          if ((global_var(223) >= 10) and (local_var(1) != 0)) then begin
            destroy_object(self_obj);
          end
        end
      end
      if ((global_var(223) == 1) or (global_var(223) == 2)) then begin
        if (cur_map_index == 33) then begin
          float_msg(self_obj, message_str(819, 113), 9);
        end
        if (cur_map_index == 34) then begin
          float_msg(self_obj, message_str(819, 114), 9);
        end
      end
    end
    if (cur_map_index == 33) then begin
      set_local_var(4, 1);
    end
    if (local_var(5) == 0) then begin
      if (cur_map_index == 32) then begin
        set_local_var(5, 1);
      end
    end
  timed_event_p_proc: |
    set_obj_visibility(self_obj, 1);
    if (global_var(223) == 10) then begin
      set_global_var(223, 11);
      gfade_out(600);
      gfade_in(600);
    end
  StepAside: |
    variable LVar0 := 0;
    NewHex := 0;
    LVar0 := random(0, 5);
    LVar0 := random(0, 5);
    LVar0 := random(0, 5);
    if (LVar0 == 0) then begin
      NewHex := tile_num(self_obj) - 400;
    end
    if (LVar0 == 1) then begin
      NewHex := tile_num(self_obj) - 202;
    end
    if (LVar0 == 2) then begin
      NewHex := tile_num(self_obj) - 198;
    end
    if (LVar0 == 3) then begin
      NewHex := tile_num(self_obj) + 400;
    end
    if (LVar0 == 4) then begin
      NewHex := tile_num(self_obj) + 202;
    end
    if (LVar0 == 5) then begin
      NewHex := tile_num(self_obj) + 198;
    end
    script_overrides;
    move_to(self_obj, NewHex, elevation(self_obj));
    script_overrides;
bullbord:
  start: "[]"
  use_p_proc: 'dialogue_system_enter;

    '
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(839, 100));
  talk_p_proc: |
    set_map_var(43, 1);
    start_gdialog(839, self_obj, 4, -1, -1);
    gsay_start;
    call bull01;
    gsay_end;
    end_dialogue;
  bull01: |
    gsay_reply(839, 106);
    giq_option(0, 839, 200, bull02, 50);
    giq_option(0, 839, 201, bull03, 50);
    giq_option(0, 839, 202, bull04, 50);
    giq_option(0, 839, 203, bull05, 50);
    giq_option(0, 839, 108, bullEnd, 50);
  bull02: |
    gsay_reply(839, 300);
    giq_option(0, 839, 107, bull01, 50);
    giq_option(0, 839, 108, bullEnd, 50);
  bull03: |
    gsay_reply(839, 301);
    giq_option(0, 839, 107, bull01, 50);
    giq_option(0, 839, 108, bullEnd, 50);
  bull04: |
    gsay_reply(839, 302);
    giq_option(0, 839, 107, bull01, 50);
    giq_option(0, 839, 108, bullEnd, 50);
  bull05: |
    gsay_reply(839, 303);
    giq_option(0, 839, 107, bull01, 50);
    giq_option(0, 839, 108, bullEnd, 50);
  bullEnd: "[]"
butch:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(39, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (map_var(40) == 1) then begin
      float_msg(self_obj, message_str(39, 328), 2);
    end
    else begin
      if (map_var(41) == 2) then begin
        float_msg(self_obj, message_str(39, 325), 2);
      end
      else begin
        if (get_critter_stat(dude_obj, 4) < 4) then begin
          float_msg(dude_obj, message_str(39, 330), 3);
          float_msg(self_obj, message_str(39, 331), 2);
        end
        else begin
          if ((local_var(4) == 0) and (map_var(34) == 1)) then begin
            set_local_var(4, 1);
            start_gdialog(39, self_obj, 4, 8, 3);
            gsay_start;
            call Butch01;
            gsay_end;
            end_dialogue;
          end
          else begin
            if ((local_var(4) == 0) and (map_var(34) == 0)) then begin
              float_msg(self_obj, message_str(39, 324), 2);
            end
            else begin
              if (map_var(41) == 3) then begin
                start_gdialog(39, self_obj, 4, 8, 3);
                gsay_start;
                call Butch73;
                gsay_end;
                end_dialogue;
              end
              else begin
                if ((local_var(5) == 1) or (map_var(41) == 4)) then begin
                  start_gdialog(39, self_obj, 4, 8, 3);
                  gsay_start;
                  call Butch60;
                  gsay_end;
                  end_dialogue;
                end
                else begin
                  if (map_var(56) == 1) then begin
                    start_gdialog(39, self_obj, 4, 8, 3);
                    gsay_start;
                    call Butch59;
                    gsay_end;
                    end_dialogue;
                  end
                  else begin
                    if (global_var(226) == 5) then begin
                      start_gdialog(39, self_obj, 4, 8, 3);
                      gsay_start;
                      call Butch37;
                      gsay_end;
                      end_dialogue;
                    end
                    else begin
                      start_gdialog(39, self_obj, 4, 8, 3);
                      gsay_start;
                      call Butch01;
                      gsay_end;
                      end_dialogue;
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    if (TossOut == 1) then begin
      TossOut := 0;
      call ButchEndTransport;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 36);
      critter_add_trait(self_obj, 1, 5, 50);
    end
  Butch00a: |
    if (local_var(1) >= 2) then begin
      call Butch34;
    end
    else begin
      call Butch36;
    end
  Butch00: |
    giq_option(4, 39, 101, Butch23, 50);
    giq_option(4, 39, 102, Butch10, 50);
    giq_option(4, 39, 103, Butch00a, 50);
    giq_option(4, 39, 104, Butch27, 50);
    giq_option(4, 39, 105, ButchEnd, 50);
  Butch01: |
    gsay_reply(39, 106);
    giq_option(4, 39, 107, Butch02, 50);
    giq_option(4, 39, 108, ButchEnd, 50);
  Butch02: |
    gsay_reply(39, 109);
    giq_option(4, 39, 110, Butch03, 50);
    giq_option(4, 39, 111, Butch08, 50);
    giq_option(4, 39, 112, Butch08, 50);
  Butch03: |
    call UpReactLevel;
    gsay_reply(39, 113);
    giq_option(4, 39, 114, Butch04, 50);
    giq_option(4, 39, 115, ButchEndAccept, 50);
  Butch04: |
    gsay_reply(39, 116);
    giq_option(4, 39, 117, Butch05, 50);
    giq_option(4, 39, 118, Butch08, 50);
    giq_option(4, 39, 119, ButchEndAccept, 50);
  Butch05: |
    gsay_reply(39, 120);
    giq_option(4, 39, 121, Butch06, 50);
    giq_option(4, 39, 122, ButchEndAccept, 50);
  Butch06: |
    gsay_reply(39, message_str(39, 123) + message_str(39, 124));
    giq_option(4, 39, 125, Butch08, 50);
    giq_option(4, 39, 127, Butch05, 50);
    giq_option(4, 39, 128, Butch21, 51);
    giq_option(4, 39, 129, Butch11, 50);
  Butch08: |
    gsay_reply(39, 133);
    giq_option(4, 39, 134, Butch09, 50);
    giq_option(4, 39, 135, Butch19, 51);
  Butch09: |
    gsay_reply(39, 136);
    giq_option(4, 39, 137, Butch12, 50);
    giq_option(4, 39, 138, Butch16, 50);
    giq_option(4, 39, 139, Butch18, 50);
  Butch10: |
    gsay_reply(39, 140);
    giq_option(4, 39, 141, Butch12, 50);
  Butch11: 'gsay_message(39, 142, 50);

    '
  Butch12: |
    gsay_reply(39, 143);
    giq_option(4, 39, 144, Butch12a, 50);
    giq_option(4, 39, 145, ButchEndAccept, 50);
  Butch12a: 'call Butch13;

    '
  Butch13: |
    set_map_var(8, 1);
    set_global_var(226, 1);
    gsay_reply(39, 146);
    giq_option(4, 39, 147, Butch14, 51);
    giq_option(4, 39, 148, Butch17, 50);
    giq_option(4, 39, 149, Butch13a, 50);
  Butch13a: |
    set_map_var(33, 1);
    gsay_reply(39, 150);
    giq_option(4, 39, 151, Butch15, 51);
    giq_option(4, 39, 152, Butch16, 50);
    giq_option(4, 39, 153, Butch17, 50);
  Butch14: |
    call DownReactLevel;
    set_map_var(33, 1);
    gsay_reply(39, 154);
    giq_option(4, 39, 155, Butch15, 51);
    giq_option(4, 39, 156, Butch16, 50);
    giq_option(4, 39, 157, Butch17, 50);
  Butch15: |
    set_map_var(40, 1);
    set_map_var(35, 1);
    set_map_var(10, 0);
    TossOut := 1;
    gsay_message(39, 158, 50);
  Butch16: |
    set_map_var(41, 1);
    set_global_var(106, 1);
    set_map_var(10, 1);
    gsay_message(39, 159, 50);
    call ButchX3;
  Butch17: |
    gsay_reply(39, 160);
    call Butch00;
  Butch18: |
    set_map_var(41, 2);
    set_global_var(106, 0);
    gsay_message(39, 161, 50);
  Butch19: |
    gsay_reply(39, 162);
    giq_option(4, 39, 163, Butch15, 51);
    giq_option(4, 39, 164, Butch19a, 50);
  Butch19a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Butch09;
    end
    else begin
      call Butch20;
    end
  Butch20: |
    call DownReactLevel;
    gsay_reply(39, 165);
    giq_option(4, 39, 166, Butch16, 50);
    giq_option(4, 39, 167, Butch18, 50);
  Butch21: |
    call DownReactLevel;
    gsay_reply(39, 168);
    giq_option(4, 39, 169, Butch15, 51);
    giq_option(4, 39, 170, Butch08, 50);
  Butch23: |
    gsay_reply(39, 172);
    giq_option(4, 39, 173, Butch23a, 50);
    giq_option(4, 39, 174, Butch23a, 50);
    giq_option(4, 39, 175, Butch17, 50);
  Butch23a: |
    variable LVar0 := 0;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      LVar0 := 0;
    end
    else begin
      LVar0 := 20;
    end
    if (is_success(roll_vs_skill(dude_obj, 14, LVar0))) then begin
      call Butch24;
    end
    else begin
      call Butch26;
    end
  Butch24: |
    gsay_reply(39, 176);
    giq_option(4, 39, 177, Butch25, 50);
    call Butch00;
  Butch25: |
    gsay_message(39, 179, 50);
    call Butch00;
  Butch26: |
    gsay_reply(39, 180);
    giq_option(4, 39, 181, Butch24, 50);
    call Butch00;
  Butch27: |
    gsay_reply(39, 183);
    giq_option(4, 39, 184, Butch28, 50);
    giq_option(4, 39, 185, Butch27a, 50);
  Butch27a: |
    if (local_var(1) >= 2) then begin
      call Butch29;
    end
    else begin
      call Butch30;
    end
  Butch28: |
    gsay_reply(39, 186);
    call Butch00;
  Butch29: |
    gsay_reply(39, 187);
    giq_option(4, 39, 188, Butch32, 50);
    call Butch00;
  Butch30: |
    gsay_reply(39, 190);
    giq_option(4, 39, 191, Butch30a, 51);
    call Butch00;
  Butch30a: |
    if (local_var(1) >= 2) then begin
      call DownReactLevel;
      call Butch31;
    end
    else begin
      call Butch15;
    end
  Butch31: |
    gsay_reply(39, 193);
    giq_option(4, 39, 194, Butch15, 51);
    giq_option(4, 39, 195, Butch17, 50);
  Butch32: |
    gsay_reply(39, 196);
    call Butch00;
  Butch34: |
    if (global_var(71) == 0) then begin
      set_global_var(71, 1);
    end
    if (global_var(74) == 0) then begin
      set_global_var(74, 1);
    end
    if (global_var(75) == 0) then begin
      set_global_var(75, 1);
    end
    gsay_reply(39, 201);
    giq_option(4, 39, 202, Butch35, 50);
    call Butch00;
  Butch35: |
    if (global_var(72) == 0) then begin
      set_global_var(72, 1);
    end
    gsay_reply(39, 204);
    giq_option(4, 39, 205, Butch35a, 50);
  Butch35a: |
    gsay_reply(39, 206);
    call Butch00;
  Butch36: |
    gsay_reply(39, 208);
    giq_option(4, 39, 209, Butch30a, 51);
    call Butch00;
  Butch37: |
    gsay_reply(39, 211);
    if ((global_var(78) == 2) or (obj_is_carrying_obj_pid(dude_obj, 196) >= 1)) then begin
      giq_option(4, 39, 212, Butch38, 50);
    end
    else begin
      if (global_var(226) == 5) then begin
        giq_option(4, 39, 213, Butch53, 50);
      end
    end
    giq_option(4, 39, 214, ButchEnd, 50);
  Butch38: |
    gsay_reply(39, 215);
    giq_option(4, 39, 216, Butch39, 50);
    giq_option(4, 39, 217, Butch51, 50);
  Butch39: |
    set_map_var(42, 2);
    gsay_reply(39, 218);
    giq_option(4, 39, 219, Butch40, 50);
    giq_option(4, 39, 220, Butch46, 50);
  Butch40: |
    gsay_reply(39, 221);
    giq_option(4, 39, 222, Butch41, 50);
    giq_option(4, 39, 223, Butch46, 50);
  Butch41: |
    gsay_reply(39, 224);
    giq_option(4, 39, 225, Butch42, 50);
    if (global_var(78) == 2) then begin
      giq_option(4, 39, 226, Butch34, 50);
    end
  Butch42: |
    set_map_var(41, 3);
    set_global_var(106, 2);
    gsay_message(39, 227, 50);
    call ButchX2;
  Butch46: |
    gsay_reply(39, 233);
    giq_option(4, 39, 234, Butch42, 50);
    giq_option(4, 39, 235, Butch47, 50);
  Butch47: |
    set_map_var(41, 3);
    set_global_var(106, 2);
    gsay_message(39, 236, 50);
    call ButchX2;
  Butch49: |
    gsay_message(39, 241, 50);
    call ButchX3;
  Butch50: |
    gsay_reply(39, 242);
    giq_option(4, 39, 243, Butch39, 50);
    giq_option(4, 39, 244, Butch49, 50);
  Butch51: |
    gsay_reply(39, 245);
    giq_option(4, 39, 246, Butch51a, 50);
    giq_option(4, 39, 247, Butch50, 50);
  Butch51a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Butch52;
    end
    else begin
      call Butch49;
    end
  Butch52: |
    set_map_var(41, 3);
    set_global_var(106, 2);
    set_map_var(42, 1);
    gsay_message(39, 248, 50);
    call ButchX2;
  Butch53: |
    gsay_reply(39, 249);
    giq_option(4, 39, 250, Butch54, 50);
    giq_option(4, 39, 251, Butch53a, 50);
  Butch53a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Butch54a;
    end
    else begin
      call Butch58;
    end
  Butch54: |
    gsay_reply(39, 252);
    giq_option(4, 39, 253, Butch54a, 50);
  Butch54a: |
    gsay_reply(39, 254);
    giq_option(4, 39, 255, Butch55, 50);
    giq_option(4, 39, 256, Butch56, 50);
  Butch55: |
    gsay_message(39, 257, 50);
    call ButchX3;
  Butch56: |
    gsay_reply(39, 258);
    giq_option(4, 39, 259, Butch55, 50);
    giq_option(4, 39, 260, Butch57, 50);
  Butch57: |
    gsay_message(39, 261, 50);
    call ButchX3;
  Butch58: |
    gsay_message(39, 262, 50);
    call ButchX3;
  Butch59: |
    gsay_reply(39, 263);
    if ((global_var(78) == 2) or (obj_is_carrying_obj_pid(dude_obj, 196) >= 1)) then begin
      giq_option(4, 39, 264, Butch40, 50);
    end
    else begin
      if (global_var(226) == 5) then begin
        giq_option(4, 39, 265, Butch54a, 50);
      end
    end
    giq_option(4, 39, 327, Butch67, 50);
    giq_option(4, 39, 329, Butch49, 50);
  Butch60: |
    gsay_message(39, 266, 50);
    call ButchX2;
  Butch67: |
    gsay_message(39, 274, 50);
    call ButchEnd;
  Butch68: |
    gsay_message(39, 276, 50);
    call ButchEnd;
  Butch73: |
    gsay_reply(39, 160);
    giq_option(4, 39, 326, Butch68, 50);
  ButchX2: |
    set_local_var(5, 1);
    set_map_var(56, 0);
  ButchX3: |
    set_local_var(5, 0);
    set_map_var(56, 1);
  ButchEnd: "[]"
  ButchEndAccept: |
    set_map_var(41, 1);
    set_global_var(106, 1);
    set_map_var(10, 1);
  ButchEndTransport: |
    gfade_out(1000);
    move_to(dude_obj, 18664, 0);
    gfade_in(1000);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
bvair:
  start: |
    if (script_action == 2) then begin
      if (obj_type(source_obj) == dude_obj) then begin
        if (local_var(0) == 0) then begin
          set_local_var(0, 1);
          if (is_success(do_check(dude_obj, 4, 0))) then begin
            display_msg(message_str(190, 100));
          end
        end
      end
    end
bvairl:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
        if (is_success(do_check(dude_obj, 4, 0))) then begin
          display_msg(message_str(154, 100));
        end
      end
    end
bvcache:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if (local_var(0) == 0) then begin
          set_local_var(0, 1);
          if (is_success(do_check(dude_obj, 4, 2))) then begin
            display_msg(message_str(191, 100));
          end
        end
      end
    end
bvcore:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if (local_var(0) == 0) then begin
          set_local_var(0, 1);
          if (is_success(do_check(dude_obj, 4, 0))) then begin
            display_msg(message_str(148, 100));
          end
        end
      end
    end
bvent:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if (local_var(0) == 0) then begin
          set_local_var(0, 1);
          if (is_success(do_check(dude_obj, 4, 0))) then begin
            display_msg(message_str(192, 100));
          end
          if (is_success(roll_vs_skill(dude_obj, 11, 0))) then begin
            display_msg(message_str(192, 101));
          end
        end
      end
    end
bvlad:
  start: "[]"
  use_p_proc: 'load_map("VaultEnt.map", 1);

    '
bvlib:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if (local_var(0) == 0) then begin
          set_local_var(0, 1);
          if (is_success(do_check(dude_obj, 4, 0))) then begin
            display_msg(message_str(147, 100));
          end
          if (is_success(do_check(dude_obj, 1, has_trait(0, dude_obj, 0)))) then begin
            display_msg(message_str(147, 101));
          end
        end
      end
    end
bvlive:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if (local_var(0) == 0) then begin
          set_local_var(0, 1);
          test := do_check(dude_obj, 1, has_trait(0, dude_obj, 0) - 2);
          if (is_success(test)) then begin
            if (is_critical(test)) then begin
              display_msg(message_str(150, 100));
            end
            else begin
              display_msg(message_str(150, 101));
            end
          end
        end
      end
    end
bvmeet:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
        if (is_success(do_check(dude_obj, 1, -2))) then begin
          display_msg(message_str(149, 100));
        end
      end
    end
bvstore:
  start: "[]"
  spatial_p_proc: |
    if (obj_type(source_obj) == dude_obj) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
        if (is_success(do_check(dude_obj, 4, 0))) then begin
          display_msg(message_str(146, 100));
        end
      end
    end
bychris:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(924, 101));
    end
    else begin
      display_msg(message_str(924, 100));
    end
  talk_p_proc: |
    if (global_var(253) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if (local_var(5) == 2) then begin
        float_msg(self_obj, message_str(924, 116), 0);
      end
      else begin
        call get_reaction;
        start_gdialog(924, self_obj, -1, -1, -1);
        gsay_start;
        DisplayMessage := 102;
        call BYChris01;
        gsay_end;
        end_dialogue;
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(253) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  pickup_p_proc: 'set_global_var(253, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      if (obj_is_carrying_obj_pid(self_obj, 41) == 0) then begin
        item_caps_adjust(self_obj, random(10, 100));
      end
      critter_add_trait(self_obj, 1, 6, 47);
      critter_add_trait(self_obj, 1, 5, 27);
      Initialize := 0;
    end
  BYChris01: |
    gsay_reply(924, DisplayMessage);
    giq_option(4, 924, 103, BYChris02, 50);
    if (local_var(4) == 0) then begin
      giq_option(4, 924, 104, BYChris03, 50);
    end
    giq_option(4, 924, 105, BYChris04, 50);
    giq_option(7, 924, 111, BYChris05, 50);
    giq_option(4, 924, 106, BYChrisEnd, 50);
    giq_option(-3, 924, 107, BYChris07, 50);
  BYChris02: |
    DisplayMessage := 108;
    call BYChris01;
  BYChris03: |
    DisplayMessage := 109;
    set_local_var(4, 1);
    call BYChris01;
  BYChris04: |
    DisplayMessage := 110;
    call BYChris01;
  BYChris05: |
    gsay_reply(924, 112);
    gsay_option(924, 113, BYChris06, 50);
  BYChris06: |
    gsay_reply(924, 114);
    DisplayMessage := 116;
    gsay_option(924, 115, BYChris01, 50);
  BYChris07: 'gsay_message(924, 117, 50);

    '
  BYChrisEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
bygreg:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(925, 101));
    end
    else begin
      display_msg(message_str(925, 100));
    end
  talk_p_proc: |
    if ((global_var(253) == 1) or (get_critter_stat(dude_obj, 4) < 4)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if ((local_var(5) == 1) and (get_critter_stat(dude_obj, 4) < 4)) then begin
        float_msg(self_obj, message_str(925, random(115, 119)), 0);
      end
      else begin
        call get_reaction;
        start_gdialog(925, self_obj, -1, -1, -1);
        gsay_start;
        if (local_var(4) == 0) then begin
          DisplayMessage := 102;
        end
        else begin
          DisplayMessage := 103;
        end
        call BYGreg03;
        gsay_end;
        end_dialogue;
      end
    end
  critter_p_proc: |
    if ((((game_time / 10) - PsstTime) >= 30) and (tile_distance_objs(self_obj, dude_obj) <= 4) and (local_var(5) == 1)) then begin
      float_msg(self_obj, message_str(925, random(115, 119)), 0);
      PsstTime := game_time / 10;
    end
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(253) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  pickup_p_proc: 'set_global_var(253, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      critter_add_trait(self_obj, 1, 6, 47);
      critter_add_trait(self_obj, 1, 5, 27);
      Initialize := 0;
    end
  BYGreg03: |
    gsay_reply(925, DisplayMessage);
    if (local_var(4) == 0) then begin
      gsay_option(925, 105, BYGreg04, 50);
    end
    gsay_option(925, 106, BYGreg05, 50);
    gsay_option(925, 107, BYGreg07, 50);
    gsay_option(925, 108, BYGregEnd, 50);
  BYGreg04: |
    DisplayMessage := 109;
    set_local_var(4, 1);
    call BYGreg03;
  BYGreg05: |
    gsay_reply(925, 110);
    gsay_option(925, 111, BYGreg06, 50);
    gsay_option(925, 112, BYGregEnd, 50);
  BYGreg06: |
    gsay_reply(925, 113);
    set_local_var(5, 1);
  BYGreg07: |
    gsay_reply(925, 114);
    set_local_var(5, 1);
  BYGregEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
bymike:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(923, 101));
    end
    else begin
      display_msg(message_str(923, 100));
    end
  talk_p_proc: |
    if ((global_var(253) == 1) or (get_critter_stat(dude_obj, 4) < 4)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if ((local_var(5) == 2) or (map_var(0) == 1)) then begin
        float_msg(self_obj, message_str(923, 116), 0);
      end
      else begin
        call get_reaction;
        start_gdialog(923, self_obj, -1, -1, -1);
        gsay_start;
        if (global_var(613) == 2) then begin
          call BYMike06;
        end
        else begin
          if (local_var(4) == 0) then begin
            DisplayMessage := 102;
            call BYMike02;
          end
          else begin
            DisplayMessage := 103;
            call BYMike02;
          end
        end
        gsay_end;
        end_dialogue;
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(253) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  pickup_p_proc: 'set_global_var(253, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      if (obj_is_carrying_obj_pid(self_obj, 41) == 0) then begin
        item_caps_adjust(self_obj, random(10, 100));
      end
      critter_add_trait(self_obj, 1, 6, 47);
      critter_add_trait(self_obj, 1, 5, 27);
      Initialize := 0;
    end
  BYMike02: |
    gsay_reply(923, DisplayMessage);
    if (local_var(4) == 0) then begin
      gsay_option(923, 105, BYMike04, 50);
    end
    gsay_option(923, 104, BYMike03, 50);
    gsay_option(923, 106, BYMike05, 50);
    gsay_option(923, 107, BYMikeEnd, 50);
  BYMike03: |
    DisplayMessage := 108;
    call BYMike02;
  BYMike04: |
    DisplayMessage := 109;
    set_local_var(4, 1);
    call BYMike02;
  BYMike05: |
    DisplayMessage := 110;
    call BYMike02;
  BYMike06: |
    gsay_reply(923, 111);
    gsay_option(923, 112, BYMike08, 50);
    gsay_option(923, 113, BYMike07, 50);
  BYMike07: |
    gsay_message(923, 115, 50);
    set_global_var(155, global_var(155) + 1);
    call BYMike08;
  BYMike08: |
    variable LVar0 := 0;
    gsay_message(923, 115, 50);
    set_local_var(5, 1);
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(dude_obj, LVar0, 4);
    item_caps_adjust(dude_obj, random(10, 100));
    set_map_var(0, 1);
  BYMikeEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
cabbot:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      Cabbot_Ptr := self_obj;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 64);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 14) then begin
        call damage_p_proc;
      end
      else begin
        if (script_action == 4) then begin
          call pickup_p_proc;
        end
        else begin
          if (script_action == 22) then begin
            call time_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
            else begin
              if (script_action == 12) then begin
                call critter_p_proc;
              end
              else begin
                if (script_action == 18) then begin
                  call destroy_p_proc;
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    start_gdialog(40, self_obj, 4, 16, 5);
    gsay_start;
    if (local_var(4) == 1) then begin
      if (global_var(108) == 1) then begin
        call cabbot24;
      end
      else begin
        if (global_var(108) == 2) then begin
          call cabbot36;
        end
        else begin
          if (global_var(117 == 1)) then begin
            call cabbot33;
          end
          else begin
            if (local_var(0) >= 50) then begin
              call cabbot19;
            end
            else begin
              call cabbot21;
            end
          end
        end
      end
    end
    else begin
      call cabbot01;
    end
    gsay_end;
    end_dialogue;
    if (awardex) then begin
      awardex := 0;
      display_msg(message_str(40, 232));
      set_global_var(155, global_var(155) + 1);
      give_exp_points(2000);
    end
  cabbot01: |
    set_local_var(4, 1);
    gsay_reply(40, 101);
    giq_option(4, 40, 103, cabbot17, 50);
    giq_option(4, 40, 105, cabbot04, 50);
    giq_option(4, 40, 106, cabbot12, 50);
    giq_option(4, 40, 107, cabbot10, 50);
    giq_option(4, 40, 102, cabbot02, 50);
    giq_option(-3, 40, 104, cabbot46, 50);
  cabbot02: |
    gsay_reply(40, 108);
    giq_option(5, 40, 109, cabbot17, 50);
    giq_option(4, 40, 110, cabbot16, 50);
    giq_option(5, 40, 111, cabbot04, 50);
    giq_option(4, 40, 112, cabbot12, 50);
    giq_option(4, 40, 113, cabbot10, 50);
  cabbot04: |
    gsay_message(40, 114, 50);
    set_local_var(6, 1);
    gfade_out(600);
    game_time_advance(game_ticks(600));
    gfade_in(600);
    call cabbot05;
  cabbot05: |
    gsay_reply(40, 115);
    giq_option(4, 40, 116, cabbot06, 50);
    giq_option(4, 40, 117, cabbot10, 50);
    giq_option(6, 40, 118, cabbot05a, 50);
  cabbot05a: |
    gsay_reply(40, 119);
    giq_option(4, 40, 120, cabbot06, 50);
    giq_option(6, 40, 121, cabbot17, 50);
    giq_option(4, 40, 122, cabbot10, 50);
  cabbot06: |
    gsay_reply(40, 123);
    if (not(global_var(76))) then begin
      set_global_var(76, 1);
    end
    giq_option(7, 40, 124, cabbot07, 50);
    giq_option(4, 40, 125, cabbot09, 50);
    giq_option(4, 40, 126, cabbot06a, 51);
  cabbot07: |
    gsay_reply(40, 127);
    giq_option(4, 40, 128, cabbot09, 50);
    giq_option(4, 40, 129, cabbot07a, 51);
  cabbot09: |
    gsay_message(40, 130, 49);
    set_global_var(108, 1);
    call UpReactLevel;
    call cabbotx;
  cabbot10: 'gsay_message(40, 131, 50);

    '
  cabbot12: |
    gsay_reply(40, 132);
    giq_option(5, 40, 133, cabbot04, 50);
    giq_option(4, 40, 134, cabbot10, 50);
    giq_option(5, 40, 135, cabbot17, 50);
  cabbot16: |
    gsay_reply(40, 136);
    giq_option(5, 40, 137, cabbot17, 50);
    giq_option(5, 40, 138, cabbot04, 50);
    giq_option(4, 40, 139, cabbot16a, 51);
    giq_option(4, 40, 140, cabbot10, 50);
  cabbot17: |
    gsay_message(40, 141, 51);
    call cabbotx;
  cabbot18: |
    gsay_message(40, 142, 51);
    call cabbotx;
  cabbot19: |
    if (local_var(1) >= 3) then begin
      gsay_reply(40, 143);
    end
    else begin
      gsay_reply(40, 144);
    end
    giq_option(5, 40, 145, cabbot05, 50);
    giq_option(5, 40, 146, cabbot17, 50);
    giq_option(4, 40, 147, cabbot19a, 51);
    giq_option(-3, 40, 104, cabbot46, 50);
  cabbot20: |
    gsay_message(40, 148, 50);
    call cabbotx;
  cabbot21: |
    gsay_reply(40, 149);
    giq_option(5, 40, 150, cabbot21_1, 50);
    giq_option(4, 40, 151, cabbotx, 50);
  cabbot21_1: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
        call cabbot23;
      end
      else begin
        call cabbot22;
      end
    end
    else begin
      call cabbot23;
    end
  cabbot22: |
    gsay_message(40, 152, 50);
    call cabbotx;
  cabbot23: |
    if (local_var(1) < 2) then begin
      set_local_var(1, 2);
      call LevelToReact;
    end
    gsay_reply(40, 153);
    giq_option(5, 40, 154, cabbot05, 50);
    giq_option(5, 40, 155, cabbot17, 50);
    giq_option(4, 40, 156, cabbot23a, 51);
  cabbot24: |
    gsay_reply(40, 157);
    giq_option(4, 40, 158, cabbot25, 50);
    giq_option(4, 40, 159, cabbot32, 50);
  cabbot25: |
    gsay_reply(40, 160);
    giq_option(4, 40, 161, cabbotx3, 50);
    giq_option(4, 40, 162, cabbot32, 50);
  cabbot27: |
    gsay_reply(40, 163);
    giq_option(4, 40, 164, cabbotopen, 50);
  cabbot28: |
    gsay_reply(40, 165);
    giq_option(4, 40, 166, cabbot31, 50);
  cabbot31: |
    gsay_message(40, 168, 50);
    call cabbotx;
  cabbot32: |
    gsay_message(40, 169, 50);
    call cabbotx;
  cabbot33: |
    if (local_var(1) >= 3) then begin
      gsay_reply(40, 170);
    end
    else begin
      if (local_var(1) <= 1) then begin
        gsay_reply(40, 171);
      end
      else begin
        gsay_reply(40, 172);
      end
    end
    giq_option(4, 40, 173, cabbot34, 50);
    giq_option(4, 40, 174, cabbot33a, 51);
  cabbot34: |
    if (local_var(1) >= 3) then begin
      gsay_message(40, 175, 49);
    end
    else begin
      if (local_var(1) <= 1) then begin
        gsay_message(40, 176, 51);
      end
      else begin
        gsay_message(40, 177, 50);
      end
    end
    call cabbotx6;
  cabbot35: |
    giq_option(5, 40, 178, cabbot38, 50);
    giq_option(5, 40, 179, cabbot42, 50);
    giq_option(4, 40, 180, cabbot37, 50);
  cabbot36: |
    if (local_var(1) >= 3) then begin
      gsay_reply(40, 182);
    end
    else begin
      if (local_var(1) <= 1) then begin
        gsay_reply(40, 183);
      end
      else begin
        gsay_reply(40, 184);
      end
    end
    giq_option(5, 40, 185, cabbot35a, 50);
    giq_option(4, 40, 186, cabbot37, 50);
  cabbot37: |
    gsay_message(40, 187, 50);
    call cabbotx7;
  cabbot38: |
    gsay_reply(40, 188);
    giq_option(5, 40, 189, cabbot39, 50);
    giq_option(5, 40, 190, cabbot40, 50);
  cabbot39: |
    gsay_reply(40, 191);
    giq_option(5, 40, 192, cabbot35a, 50);
    giq_option(4, 40, 193, cabbot37, 50);
  cabbot40: |
    gsay_reply(40, 194);
    giq_option(6, 40, 195, cabbot41, 50);
    giq_option(5, 40, 196, cabbot35a, 50);
    giq_option(4, 40, 197, cabbot37, 50);
  cabbot41: |
    gsay_reply(40, 198);
    giq_option(4, 40, 199, cabbot35a, 50);
    giq_option(4, 40, 200, cabbot37, 50);
  cabbot42: |
    gsay_reply(40, 201);
    giq_option(4, 40, 202, cabbot39, 50);
    giq_option(5, 40, 203, cabbot35a, 50);
    giq_option(4, 40, 204, cabbot37, 50);
  cabbot43: |
    call DownReactLevel;
    ILLEGAL := 1;
    float_msg(self_obj, message_str(40, 205), 2);
  cabbot44: |
    call DownReactLevel;
    ILLEGAL := 1;
    float_msg(self_obj, message_str(40, 206), 2);
    call cabbotx8;
  cabbot45: |
    call DownReactLevel;
    ILLEGAL := 1;
    float_msg(self_obj, message_str(40, 207), 2);
  cabbot46: |
    gsay_message(40, 208, 50);
    call cabbotx;
  cabbot47: 'gsay_message(40, 209, 50);

    '
  cabbot48: 'gsay_message(40, 210, 50);

    '
  cabbot06a: |
    call DownReactLevel;
    call cabbot10;
  cabbot07a: |
    call DownReactLevel;
    call LevelToReact;
    call cabbot10;
  cabbot16a: |
    call BottomReact;
    call cabbot18;
  cabbot19a: |
    call DownReactLevel;
    call LevelToReact;
    call cabbot20;
  cabbot23a: |
    call DownReactLevel;
    call cabbot20;
  cabbot33a: |
    call DownReactLevel;
    call cabbot34;
  cabbotx: "[]"
  cabbotx1: 'call cabbot05;

    '
  cabbotx3: |
    variable LVar0 := 0;
    if (obj_is_carrying_obj_pid(dude_obj, 164)) then begin
      awardex := 1;
      LVar0 := obj_carrying_pid_obj(dude_obj, 164);
      set_global_var(108, 2);
      call TopReact;
      rm_obj_from_inven(dude_obj, LVar0);
      call cabbot27;
    end
    else begin
      call cabbot31;
    end
  cabbotx6: "[]"
  cabbotx7: "[]"
  cabbotx8: "[]"
  cabbot35a: |
    gsay_message(40, 181, 50);
    call cabbot35;
  cabbot49: 'gsay_message(40, 211, 50);

    '
  cabbot50: 'gsay_message(40, 212, 50);

    '
  cabbot51: 'gsay_message(40, 213, 50);

    '
  cabbot52: 'gsay_message(40, 214, 50);

    '
  cabbot53: 'gsay_message(40, 215, 50);

    '
  cabbot54: 'gsay_message(40, 216, 50);

    '
  cabbot55: 'gsay_message(40, 217, 50);

    '
  cabbot56: 'gsay_message(40, 218, 50);

    '
  cabbot57: 'gsay_message(40, 219, 50);

    '
  cabbot58: 'gsay_message(40, 220, 50);

    '
  cabbot59: 'gsay_message(40, 221, 50);

    '
  cabbot60: 'gsay_message(40, 222, 50);

    '
  cabbot61: 'gsay_message(40, 223, 50);

    '
  cabbot62: 'gsay_message(40, 224, 50);

    '
  cabbot63: 'gsay_message(40, 225, 50);

    '
  cabbot64: 'gsay_message(40, 226, 50);

    '
  cabbot65: 'gsay_message(40, 227, 50);

    '
  cabbot66: 'gsay_message(40, 228, 50);

    '
  cabbot67: 'gsay_message(40, 229, 50);

    '
  cabbot68: 'gsay_message(40, 230, 50);

    '
  cabbot69: 'gsay_message(40, 231, 50);

    '
  cabbotend: "[]"
  cabbotopen: "[]"
  combat: 'HOSTILE := 1;

    '
  damage_p_proc: 'set_global_var(250, 1);

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      HOSTILE := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      HOSTILE := 0;
    end
    if (HOSTILE) then begin
      set_global_var(250, 1);
      HOSTILE := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(5) == 0) then begin
        if (global_var(108) == 2) then begin
          add_timer_event(self_obj, game_ticks(1), 1);
        end
      end
      else begin
        if (local_var(5) == 1) then begin
          if (tile_num(self_obj) == 20906) then begin
            set_local_var(5, 2);
          end
          else begin
            animate_move_obj_to_tile(self_obj, 20906, 0);
          end
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      HOSTILE := 1;
    end
  talk_p_proc: |
    if (global_var(108) == 5) then begin
      float_msg(self_obj, message_str(40, 233), 2);
    end
    else begin
      call do_dialogue;
    end
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(40, 100));
  time_p_proc: |
    set_local_var(5, 1);
    use_obj(Door_ptr);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
calder:
  start: |
    if (Only_once) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 69);
      Only_once := 0;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(393, 100));
      end
      else begin
        if (script_action == 18) then begin
          if (source_obj == dude_obj) then begin
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
              set_global_var(156, 1);
              set_global_var(157, 0);
            end
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
              set_global_var(157, 1);
              set_global_var(156, 0);
            end
            set_global_var(159, global_var(159) + 1);
            if ((global_var(159) % 2) == 0) then begin
              set_global_var(155, global_var(155) - 1);
            end
          end
        end
        else begin
          if (script_action == 4) then begin
            hostile := 1;
          end
          else begin
            if (script_action == 12) then begin
              if (hostile) then begin
                hostile := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call weapon_check;
    start_gdialog(-1, self_obj, 4, -1, -1);
    gsay_start;
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      if (local_var(4) == 1) then begin
        call calder28;
      end
      else begin
        set_local_var(4, 1);
        call calder05;
      end
    end
    else begin
      if (global_var(158) > 2) then begin
        call calder00;
      end
      else begin
        if (local_var(4) == 1) then begin
          call calder28;
        end
        else begin
          set_local_var(4, 1);
          call calder29;
        end
      end
    end
    gsay_end;
    end_dialogue;
  calder00: |
    gsay_reply(393, 101);
    giq_option(4, 393, 102, calder02, 50);
    giq_option(4, 393, 103, calder03, 50);
    giq_option(4, 393, 104, calder04, 50);
    giq_option(4, 393, 105, calder05, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 393, 106, caldercombat, 50);
    end
  calder01: |
    gsay_reply(393, 107);
    giq_option(4, 393, 108, calder01a, 50);
    giq_option(4, 393, 109, calder03, 50);
    giq_option(4, 393, 110, calder01b, 50);
    giq_option(-3, 393, 111, calder03, 50);
  calder01a: |
    if (get_critter_stat(dude_obj, 3) > 6) then begin
      call calder04;
    end
    else begin
      call calder03;
    end
  calder01b: |
    if (get_critter_stat(dude_obj, 3) > 6) then begin
      call calder02;
    end
    else begin
      call calder03;
    end
  calder02: 'gsay_message(393, 112, 51);

    '
  calder03: |
    gsay_message(393, 113, 51);
    call caldercombat;
  calder04: 'gsay_message(393, 114, 51);

    '
  calder05: |
    if (GENDER == 0) then begin
      gsay_reply(393, 115);
    end
    else begin
      gsay_reply(393, 116);
    end
    giq_option(7, 393, 117, calder05a, 50);
    giq_option(4, 393, 118, calder08, 50);
    giq_option(4, 393, 119, calder09, 50);
    giq_option(-3, 393, 120, calder10, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 393, 121, calder11, 50);
    end
  calder05a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call calder06;
    end
    else begin
      call calder07;
    end
  calder06: |
    set_global_var(196, 1);
    gsay_reply(393, 122);
    giq_option(7, 393, 123, calder06a, 50);
    giq_option(4, 393, 124, calder12, 50);
    giq_option(4, 393, 125, calder09, 50);
    giq_option(-3, 393, 126, calder10, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 393, 127, calder11, 50);
    end
  calder06a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call calder12;
    end
    else begin
      call calder07;
    end
  calder07: |
    LASHERKNOWN := 1;
    LASHERABUSEKNOWN := 1;
    gsay_reply(393, 128);
    giq_option(7, 393, 129, calder07a, 50);
    giq_option(4, 393, 130, calder07b, 50);
    giq_option(-3, 393, 131, calder16, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 393, 132, calder15, 50);
    end
  calder07a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call calder06;
    end
    else begin
      call calder13;
    end
  calder07b: |
    if (get_critter_stat(dude_obj, 3) > 6) then begin
      call calder14;
    end
    else begin
      call calder15;
    end
  calder08: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(117, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(393, 133, 49);
  calder09: |
    gsay_reply(393, 134);
    giq_option(7, 393, 135, calder15, 50);
    giq_option(4, 393, 136, calder16, 50);
    giq_option(4, 393, 137, calder17, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 393, 138, calder09a, 50);
    end
  calder09a: |
    if (get_critter_stat(dude_obj, 3) > 6) then begin
      call calder02;
    end
    else begin
      call calder03;
    end
  calder10: 'gsay_message(393, 139, 50);

    '
  calder11: 'gsay_message(393, 140, 50);

    '
  calder12: |
    gsay_reply(393, 141);
    giq_option(7, 393, 142, calder12a, 50);
    giq_option(4, 393, 143, calder08, 50);
    if (GENDER == 0) then begin
      giq_option(4, 393, 144, calder19, 50);
    end
    if (GENDER == 0) then begin
      giq_option(4, 393, 145, calder19, 50);
    end
    giq_option(-3, 393, 146, calder15, 50);
  calder12a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -3))) then begin
      call calder18;
    end
    else begin
      call calder13;
    end
  calder13: 'gsay_message(393, 147, 50);

    '
  calder14: |
    gsay_reply(393, 148);
    giq_option(7, 393, 149, calder20, 50);
    giq_option(4, 393, 150, calder21, 50);
    giq_option(4, 393, 151, calder22, 50);
    giq_option(-3, 393, 152, calder15, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 393, 153, calder02, 50);
    end
  calder15: 'gsay_message(393, 154, 51);

    '
  calder16: 'gsay_message(393, 155, 50);

    '
  calder17: 'gsay_message(393, 156, 50);

    '
  calder18: 'gsay_message(393, 157, 51);

    '
  calder19: 'gsay_message(393, 158, 50);

    '
  calder20: |
    gsay_reply(393, 159);
    giq_option(7, 393, 160, calder23, 50);
    giq_option(4, 393, 161, calder24, 50);
    giq_option(4, 393, 162, calder25, 50);
    giq_option(-3, 393, 163, calder15, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 393, 164, calder25, 50);
    end
  calder21: 'gsay_message(393, 165, 51);

    '
  calder22: 'gsay_message(393, 166, 51);

    '
  calder23: 'gsay_message(393, 167, 51);

    '
  calder24: 'gsay_message(393, 168, 50);

    '
  calder25: |
    LASHERKNOWN := 1;
    LASHERABUSEKNOWN := 1;
    gsay_reply(393, 169);
    giq_option(7, 393, 171, calder25a, 50);
    giq_option(4, 393, 172, calder15, 50);
    giq_option(4, 393, 173, calder24, 50);
    giq_option(-3, 393, 174, calder15, 50);
  calder25a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call calder26;
    end
    else begin
      call calder15;
    end
  calder26: |
    set_global_var(196, 1);
    gsay_reply(393, 175);
    giq_option(4, 393, 176, calder13, 50);
    giq_option(4, 393, 177, calder27, 50);
    giq_option(-3, 393, 178, calder16, 50);
  calder27: 'gsay_message(393, 179, 51);

    '
  calder28: |
    gsay_reply(393, 180);
    giq_option(7, 393, 181, calder27, 50);
    giq_option(4, 393, 182, calder27, 50);
    giq_option(4, 393, 183, calder15, 50);
    giq_option(-3, 393, 184, calder15, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 393, 185, calder15, 50);
    end
  calder29: |
    gsay_reply(393, 186);
    giq_option(7, 393, 187, calder29a, 50);
    giq_option(4, 393, 188, calder29b, 50);
    giq_option(4, 393, 189, calder29c, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 393, 190, calder02, 50);
    end
    giq_option(-3, 393, 191, calder15, 50);
  calder29a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call calder30;
    end
    else begin
      call calder32;
    end
  calder29b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call calder31;
    end
    else begin
      call calder32;
    end
  calder29c: |
    if (get_critter_stat(dude_obj, 3) > 6) then begin
      call calder33;
    end
    else begin
      call calder32;
    end
  calder30: |
    gsay_reply(393, 192);
    giq_option(4, 393, 193, calder30a, 50);
    giq_option(4, 393, 194, calder30b, 50);
    giq_option(4, 393, 195, calder11, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 393, 196, calder03, 50);
    end
  calder30a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call calder13;
    end
    else begin
      call calder15;
    end
  calder30b: |
    if (get_critter_stat(dude_obj, 3) > 6) then begin
      call calder31;
    end
    else begin
      call calder32;
    end
  calder31: |
    gsay_reply(393, 197);
    giq_option(7, 393, 198, calder13, 50);
    giq_option(4, 393, 199, calder08, 50);
    giq_option(4, 393, 200, calder09, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 393, 201, calder11, 50);
    end
  calder32: |
    LASHERKNOWN := 1;
    LASHERABUSEKNOWN := 1;
    gsay_message(393, 202, 50);
  calder33: |
    LASHERKNOWN := 1;
    LASHERABUSEKNOWN := 1;
    gsay_reply(393, 203);
    giq_option(7, 393, 204, calder34, 50);
    giq_option(4, 393, 205, calder14, 50);
    giq_option(4, 393, 206, calder34, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 393, 207, calder15, 50);
    end
  calder34: 'gsay_message(393, 208, 51);

    '
  calderdone: 'gsay_option(393, 209, calderend, 50);

    '
  calderend: "[]"
  caldercombat: |
    set_global_var(195, 1);
    hostile := 1;
  weapon_check: |
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      armed := 1;
    end
    else begin
      armed := 0;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
caleb:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(255, 100));
    end
    else begin
      display_msg(message_str(255, 101));
    end
  talk_p_proc: |
    if ((global_var(251) == 1) or (global_var(616) == 1)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if ((local_var(4) == 1) and (get_critter_stat(dude_obj, 4) < 4)) then begin
        float_msg(self_obj, message_str(255, 127), 0);
      end
      else begin
        if (global_var(128) == 2) then begin
          float_msg(self_obj, message_str(255, 147), 0);
        end
        else begin
          call get_reaction;
          start_gdialog(255, self_obj, -1, -1, -1);
          gsay_start;
          if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
            call DialogWeapon;
          end
          else begin
            if (local_var(4) == 0) then begin
              if (local_var(1) < 2) then begin
                DisplayMessage := 102;
              end
              else begin
                DisplayMessage := 103;
              end
              call DialogMain;
            end
            else begin
              if (global_var(128) == 0) then begin
                if (local_var(1) < 2) then begin
                  DisplayMessage := 122;
                end
                if (get_critter_stat(dude_obj, 34) == 0) then begin
                  DisplayMessage := 123;
                end
                else begin
                  DisplayMessage := 124;
                end
                call DialogMain;
              end
              else begin
                DisplayMessage := 141;
                call DialogMain11;
              end
            end
          end
          gsay_end;
          end_dialogue;
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if ((global_var(251) == 1) or (global_var(616) == 1)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(616, 1);
    end
  destroy_p_proc: |
    set_map_var(1, map_var(1) - 1);
    if (source_obj == dude_obj) then begin
      set_global_var(616, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(160, global_var(160) + 1);
        if ((global_var(160) % 6) == 0) then begin
          set_global_var(155, global_var(155) + 1);
        end
      end
    end
    if (map_var(1) == 0) then begin
      terminate_combat;
    end
  pickup_p_proc: 'set_global_var(616, 1);

    '
  map_enter_p_proc: |
    variable LVar0 := 0;
    if (Initialize) then begin
      if (not(metarule(22, 0)) and (obj_is_carrying_obj_pid(self_obj, 41) == 0)) then begin
        item_caps_adjust(self_obj, random(10, 100));
      end
      critter_add_trait(self_obj, 1, 6, 89);
      critter_add_trait(self_obj, 1, 5, 29);
      if (local_var(7) == 0) then begin
        set_map_var(1, map_var(1) + 1);
        set_local_var(7, 1);
        set_global_var(351, 1);
      end
      Initialize := 0;
    end
  DialogWeapon: 'gsay_message(255, 125, 50);

    '
  DialogExit: "[]"
  DialogMain: |
    gsay_reply(255, DisplayMessage);
    giq_option(4, 255, 105, DialogMain1, 50);
    giq_option(4, 255, 106, DialogMain2, 50);
    giq_option(4, 255, 107, DialogMain5, 50);
    if (local_var(5) == 1) then begin
      giq_option(4, 255, 108, DialogMain6, 50);
    end
    if (local_var(6) == 1) then begin
      giq_option(4, 255, 109, DialogMain7, 50);
    end
    if (global_var(128) == 0) then begin
      giq_option(4, 255, 110, DialogMain8, 50);
    end
    giq_option(4, 255, 111, DialogMainExit, 50);
    giq_option(-3, 255, 126, Dumb, 50);
  Dumb: |
    set_local_var(4, 1);
    gsay_message(255, 127, 50);
  DialogMainExit: |
    if (local_var(1) < 2) then begin
      gsay_message(255, 120, 50);
    end
    else begin
      gsay_message(255, 121, 50);
    end
  DialogMain1: |
    set_local_var(4, 1);
    if (local_var(1) < 2) then begin
      DisplayMessage := 116;
    end
    else begin
      set_local_var(5, 1);
      DisplayMessage := 117;
    end
    call DialogMain;
  DialogMain2: |
    gsay_reply(255, 112);
    giq_option(4, 255, 113, DialogMain3, 50);
    giq_option(4, 255, 114, DialogMain4, 50);
    giq_option(4, 255, 115, DialogMainExit, 50);
  DialogMain3: |
    DisplayMessage := 128;
    call DialogMain;
  DialogMain4: |
    DisplayMessage := 129;
    call DialogMain;
  DialogMain5: |
    gsay_message(255, 118, 50);
    set_local_var(6, 1);
    DisplayMessage := 119;
    call DialogMain;
  DialogMain6: |
    gsay_message(255, 130, 50);
    DisplayMessage := 131;
    call DialogMain;
  DialogMain7: |
    DisplayMessage := 132;
    call DialogMain;
  DialogMain8: |
    gsay_reply(255, 133);
    giq_option(4, 255, 134, DialogMain10, 50);
    giq_option(4, 255, 135, DialogMain9, 50);
    giq_option(4, 255, 136, DialogExit, 50);
  DialogMain9: |
    DisplayMessage := 137;
    call DialogMain;
  DialogMain10: |
    gsay_reply(255, 138);
    giq_option(4, 255, 139, DialogMain9, 50);
    giq_option(4, 255, 140, DialogExit, 50);
  DialogMain11: |
    gsay_reply(255, DisplayMessage);
    giq_option(4, 255, 140, DialogMain12, 50);
    giq_option(4, 255, 141, DialogMain13, 50);
    giq_option(4, 255, 142, DialogExit, 50);
  DialogMain12: |
    DisplayMessage := 145;
    call DialogMain11;
  DialogMain13: |
    DisplayMessage := 146;
    call DialogMain11;
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
carvlead:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (spawnDialogue == 1) then begin
      spawnDialogue := 0;
      set_local_var(6, game_time / (10 * 60 * 60));
      dialogue_system_enter;
    end
    else begin
      if (local_var(5) == 1) then begin
        if ((WaitForTwoHours == 1) and (((game_time / (10 * 60 * 60)) - local_var(6)) >= 2)) then begin
          WaitForTwoHours := 0;
          gfade_out(1000);
          set_local_var(5, 0);
          set_local_var(4, 0);
          set_obj_visibility(self_obj, 1);
          gfade_in(1000);
          display_msg(message_str(817, 151));
        end
      end
      else begin
        set_obj_visibility(self_obj, 1);
      end
    end
  map_enter_p_proc: |
    critter_add_trait(self_obj, 1, 6, 64);
    critter_add_trait(self_obj, 1, 5, 50);
    if (((game_time / (10 * 60 * 60)) - local_var(6)) >= 2) then begin
      WaitForTwoHours := 0;
      set_obj_visibility(self_obj, 1);
      set_local_var(5, 0);
      set_local_var(4, 0);
    end
    if (local_var(5) == 1) then begin
      if (((game_time / (10 * 60 * 60)) - local_var(6)) < 2) then begin
        WaitForTwoHours := 1;
        set_obj_visibility(self_obj, 0);
      end
      else begin
        WaitForTwoHours := 0;
        set_obj_visibility(self_obj, 1);
        set_local_var(5, 0);
        set_local_var(4, 0);
      end
    end
    else begin
      if ((global_var(199) == 2) or (global_var(199) == 3) or ((global_var(200) == 2) or (global_var(200) == 3)) or ((global_var(201) == 2) or (global_var(201) == 3))) then begin
        if (global_var(200) == 2) then begin
          set_obj_visibility(self_obj, 0);
          PaymentAmount := 200;
          set_local_var(7, 0);
          set_global_var(205, 4);
          set_global_var(200, 0);
          set_global_var(199, 0);
          set_global_var(201, 0);
        end
        else begin
          if (global_var(201) == 2) then begin
            set_obj_visibility(self_obj, 0);
            PaymentAmount := 400;
            set_local_var(7, 2);
            set_global_var(206, 4);
            set_global_var(201, 0);
            set_global_var(199, 0);
            set_global_var(200, 0);
          end
          else begin
            if (global_var(199) == 2) then begin
              set_obj_visibility(self_obj, 0);
              PaymentAmount := 600;
              set_local_var(7, 1);
              set_global_var(204, 4);
              set_global_var(199, 0);
              set_global_var(200, 0);
              set_global_var(201, 0);
            end
            else begin
              if (global_var(200) == 3) then begin
                set_obj_visibility(self_obj, 0);
                PaymentAmount := 0;
                set_local_var(7, 3);
                set_global_var(205, 3);
                set_global_var(200, 0);
                set_global_var(199, 0);
                set_global_var(201, 0);
              end
              else begin
                if (global_var(201) == 3) then begin
                  set_obj_visibility(self_obj, 0);
                  PaymentAmount := 0;
                  set_local_var(7, 3);
                  set_global_var(206, 3);
                  set_global_var(201, 0);
                  set_global_var(199, 0);
                  set_global_var(200, 0);
                end
                else begin
                  if (global_var(199) == 3) then begin
                    set_obj_visibility(self_obj, 0);
                    PaymentAmount := 600;
                    set_local_var(7, 3);
                    set_global_var(204, 3);
                    set_global_var(199, 0);
                    set_global_var(200, 0);
                    set_global_var(201, 0);
                  end
                end
              end
            end
          end
        end
        set_local_var(5, 1);
        set_local_var(4, 0);
        WaitForTwoHours := 1;
        spawnDialogue := 1;
        beenPaid := 0;
      end
      else begin
        if ((global_var(199) == 5) or (global_var(200) == 5) or (global_var(201) == 5)) then begin
          if (global_var(199) == 5) then begin
            set_global_var(204, 5);
          end
          else begin
            if (global_var(200) == 5) then begin
              set_global_var(205, 5);
            end
            else begin
              if (global_var(201) == 5) then begin
                set_global_var(206, 5);
              end
            end
          end
          set_global_var(199, 0);
          set_global_var(200, 0);
          set_global_var(201, 0);
          set_obj_visibility(self_obj, 0);
          set_local_var(7, 5);
          PaymentAmount := 0;
          set_local_var(5, 1);
          set_local_var(4, 0);
          WaitForTwoHours := 0;
          spawnDialogue := 1;
          beenPaid := 0;
        end
        else begin
          WaitForTwoHours := 0;
          set_obj_visibility(self_obj, 1);
          set_local_var(5, 0);
          set_local_var(4, 0);
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (local_var(7) == 4) then begin
      float_msg(self_obj, message_str(817, random(143, 145)), 2);
    end
    else begin
      if (cur_map_index == 36) then begin
        start_gdialog(817, self_obj, 4, -1, -1);
        gsay_start;
        if (local_var(7) == 3) then begin
          call HubAbandoned;
        end
        else begin
          if (local_var(7) == 5) then begin
            call HubLost;
          end
          else begin
            call CarvLead09;
          end
        end
        gsay_end;
        end_dialogue;
        gfade_out(1000);
        set_local_var(5, 0);
        set_local_var(4, 0);
        set_obj_visibility(self_obj, 1);
        WaitForTwoHours := 0;
        gfade_in(1000);
      end
      else begin
        if (local_var(7) == 5) then begin
          start_gdialog(817, self_obj, 4, -1, -1);
          gsay_start;
          call Lost;
          gsay_end;
          end_dialogue;
          gfade_out(1000);
          set_local_var(5, 0);
          set_local_var(4, 0);
          WaitForTwoHours := 0;
          set_obj_visibility(self_obj, 1);
          gfade_in(1000);
        end
        else begin
          if (local_var(4) == 0) then begin
            set_local_var(4, 1);
            start_gdialog(817, self_obj, 4, -1, -1);
            gsay_start;
            if (local_var(7) == 3) then begin
              set_local_var(7, 4);
              call Abandoned;
            end
            else begin
              call CarvLead00;
            end
            gsay_end;
            end_dialogue;
          end
          else begin
            start_gdialog(817, self_obj, 4, -1, -1);
            gsay_start;
            call CarvLead07;
            gsay_end;
            end_dialogue;
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(817, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    if (cur_map_index == 36) then begin
      LVar0 := obj_pid(source_obj);
      if (party_member_obj(LVar0) != 0) then begin
        set_global_var(248, 1);
      end
    end
  CarvLead00: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (PaymentAmount == 200) then begin
      LVar0 := 146;
    end
    else begin
      if (PaymentAmount == 400) then begin
        LVar0 := 147;
      end
      else begin
        if (PaymentAmount == 600) then begin
          LVar0 := 148;
        end
      end
    end
    LVar1 := item_caps_adjust(dude_obj, PaymentAmount);
    beenPaid := 1;
    gsay_reply(817, message_str(817, 101) + message_str(817, LVar0) + message_str(817, 102) + message_str(817, LVar0) + message_str(817, 103));
    giq_option(-3, 817, 104, CarvLead01, 50);
    giq_option(4, 817, 105, CarvLead03, 50);
    if (cur_map_index == 10) then begin
      giq_option(4, 817, 106, CarvLead04, 50);
    end
    else begin
      if (cur_map_index == 28) then begin
        giq_option(4, 817, 107, CarvLead05, 50);
      end
      else begin
        if (cur_map_index == 13) then begin
          giq_option(4, 817, 108, CarvLead06, 50);
        end
      end
    end
  CarvLead01: |
    gsay_reply(817, 109);
    giq_option(-3, 817, 110, CarvLead11, 50);
    giq_option(-3, 817, 111, CarvLead02, 50);
    giq_option(-3, 817, 112, CarvLead12, 50);
  CarvLead02: 'gsay_message(817, 113, 50);

    '
  CarvLead03: |
    gsay_reply(817, 114);
    giq_option(4, 817, 115, CarvLead11, 50);
    giq_option(4, 817, 116, CarvLead12, 50);
    if (cur_map_index == 10) then begin
      giq_option(4, 817, 117, CarvLead04, 50);
    end
    else begin
      if (cur_map_index == 28) then begin
        giq_option(4, 817, 118, CarvLead05, 50);
      end
      else begin
        if (cur_map_index == 13) then begin
          giq_option(4, 817, 119, CarvLead06, 50);
        end
      end
    end
  CarvLead04: |
    gsay_reply(817, 120);
    giq_option(4, 817, 121, CarvLead03, 50);
    giq_option(4, 817, 122, CarvLead11, 50);
  CarvLead05: |
    gsay_reply(817, 123);
    giq_option(4, 817, 125, CarvLead03, 50);
    giq_option(4, 817, 126, CarvLead11, 50);
  CarvLead06: |
    gsay_reply(817, 127);
    giq_option(4, 817, 128, CarvLead03, 50);
    giq_option(4, 817, 129, CarvLead11, 50);
  CarvLead07: |
    variable LVar0 := 0;
    if (beenPaid == 0) then begin
      LVar0 := item_caps_adjust(dude_obj, PaymentAmount);
      beenPaid := 1;
    end
    gsay_reply(817, 130);
    giq_option(-3, 817, 131, CarvLead12, 50);
    giq_option(-3, 817, 111, CarvLead11, 50);
    giq_option(4, 817, 132, CarvLead11, 50);
    giq_option(4, 817, 133, CarvLead12, 50);
  CarvLead09: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (PaymentAmount == 200) then begin
      LVar0 := 146;
    end
    else begin
      if (PaymentAmount == 400) then begin
        LVar0 := 147;
      end
      else begin
        if (PaymentAmount == 600) then begin
          LVar0 := 148;
        end
      end
    end
    LVar1 := item_caps_adjust(dude_obj, PaymentAmount);
    beenPaid := 1;
    gsay_reply(817, message_str(817, 137) + message_str(817, LVar0) + message_str(817, 138));
    giq_option(-3, 817, 139, CarvLead11, 50);
    giq_option(4, 817, 140, CarvLead11, 50);
  CarvLead11: "[]"
  CarvLead12: |
    variable LVar0 := 0;
    set_local_var(5, 0);
    set_local_var(4, 0);
    if (local_var(7) == 0) then begin
      set_global_var(205, 1);
      set_global_var(200, 1);
      if (cur_map_index == 10) then begin
        LVar0 := do_check(dude_obj, 6, -2);
        if (is_success(LVar0)) then begin
          set_global_var(200, 2);
          load_map(36, 1);
        end
        else begin
          load_map(64, 3);
        end
      end
      else begin
        if (cur_map_index == 28) then begin
          LVar0 := do_check(dude_obj, 6, -2);
          if (is_success(LVar0)) then begin
            set_global_var(200, 2);
            load_map(36, 1);
          end
          else begin
            load_map(63, 3);
          end
        end
      end
    end
    else begin
      if (local_var(7) == 1) then begin
        set_global_var(204, 1);
        set_global_var(199, 1);
        if (cur_map_index == 13) then begin
          load_map(64, 3);
        end
        else begin
          if (cur_map_index == 10) then begin
            load_map(64, 3);
          end
          else begin
            if (cur_map_index == 4) then begin
              load_map(63, 3);
            end
            else begin
              if (cur_map_index == 28) then begin
                load_map(63, 3);
              end
            end
          end
        end
      end
      else begin
        if (local_var(7) == 2) then begin
          set_global_var(206, 1);
          set_global_var(201, 1);
          if (cur_map_index == 10) then begin
            LVar0 := do_check(dude_obj, 6, -4);
            if (is_success(LVar0)) then begin
              set_global_var(201, 2);
              load_map(36, 1);
            end
            else begin
              load_map(64, 3);
            end
          end
          else begin
            if (cur_map_index == 28) then begin
              LVar0 := do_check(dude_obj, 6, -4);
              if (is_success(LVar0)) then begin
                set_global_var(201, 2);
                load_map(36, 1);
              end
              else begin
                load_map(63, 3);
              end
            end
            else begin
              if (cur_map_index == 13) then begin
                LVar0 := do_check(dude_obj, 6, -4);
                if (is_success(LVar0)) then begin
                  set_global_var(201, 2);
                  load_map(36, 1);
                end
                else begin
                  load_map(64, 3);
                end
              end
            end
          end
        end
      end
    end
  Abandoned: 'gsay_message(817, 501, 50);

    '
  Lost: 'gsay_message(817, 502, 50);

    '
  HubAbandoned: 'gsay_message(817, 504, 50);

    '
  HubLost: 'gsay_message(817, 505, 50);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
cathshop:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 69);
      Shopkepper_Ptr := self_obj;
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 22) then begin
        call timed_event_p_proc;
      end
      else begin
        if (script_action == 4) then begin
          call pickup_p_proc;
        end
        else begin
          if (script_action == 11) then begin
            call talk_p_proc;
          end
          else begin
            if (script_action == 12) then begin
              call critter_p_proc;
            end
            else begin
              if (script_action == 18) then begin
                call destroy_p_proc;
              end
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    call get_reaction;
    LVar1 := obj_carrying_pid_obj(self_obj, 113);
    rm_obj_from_inven(self_obj, LVar1);
    move_obj_inven_to_obj(Shop_Ptr, self_obj);
    start_gdialog(843, self_obj, 4, -1, -1);
    gsay_start;
    if (Caught_Stealing) then begin
      call BarterGuy00;
    end
    else begin
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) or (global_var(195) == 1)) then begin
        call BarterGuy02;
      end
      else begin
        if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
          call BarterGuy07;
        end
        else begin
          call BarterGuy10;
        end
      end
    end
    gsay_end;
    end_dialogue;
    move_obj_inven_to_obj(self_obj, Shop_Ptr);
    add_obj_to_inven(self_obj, LVar1);
    wield_obj_critter(self_obj, LVar1);
    if (Go_Balistic) then begin
      LVar0 := create_object_sid(12, 0, 0, -1);
      add_obj_to_inven(self_obj, LVar0);
      wield_obj_critter(self_obj, LVar0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(843, 100));
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      Here_To_Shop := 1;
      dialogue_system_enter;
    end
    else begin
      if (fixed_param == 2) then begin
        Caught_Stealing := 1;
        dialogue_system_enter;
      end
    end
  BarterGuy00: |
    gsay_reply(843, 101);
    giq_option(-3, 843, 102, BarterGuy01, 50);
    giq_option(4, 843, 103, BarterGuy01, 50);
    giq_option(5, 843, 104, BarterGuy00a, 50);
  BarterGuy00a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call combat;
    end
    else begin
      call BarterGuy01;
    end
  BarterGuy01: |
    gsay_message(843, 105, 51);
    call combat;
  BarterGuy02: |
    gsay_reply(843, 106);
    giq_option(-3, 843, 107, BarterGuyEnd, 50);
    giq_option(4, 843, 108, BarterGuy03, 50);
    giq_option(6, 843, 109, BarterGuy02a, 50);
  BarterGuy02a: |
    if (global_var(195) == 1) then begin
      call BarterGuy04;
    end
    else begin
      call BarterGuy05;
    end
  BarterGuy03: 'gsay_message(843, 110, 50);

    '
  BarterGuy04: |
    gsay_reply(843, 111);
    giq_option(6, 843, 112, BarterGuy01, 50);
    giq_option(6, 843, 113, BarterGuyEnd, 50);
  BarterGuy05: |
    gsay_reply(843, 114);
    giq_option(6, 843, 115, BarterGuy00a, 50);
    giq_option(6, 843, 116, BarterGuy06, 50);
  BarterGuy06: 'gsay_message(843, 117, 50);

    '
  BarterGuy07: |
    gsay_reply(843, 118);
    giq_option(-3, 843, 119, BarterGuy08, 50);
    giq_option(4, 843, 120, BarterGuy12, 50);
    giq_option(4, 843, 121, BarterGuy09, 50);
  BarterGuy08: |
    gsay_reply(843, 122);
    giq_option(-3, 843, 123, BarterGuyEnd, 50);
  BarterGuy09: 'gsay_message(843, 124, 50);

    '
  BarterGuy10: |
    gsay_reply(843, 125);
    giq_option(-3, 843, 126, BarterGuy08, 50);
    giq_option(4, 843, 127, BarterGuy13, 50);
    giq_option(5, 843, 128, BarterGuy11, 50);
  BarterGuy11: |
    gsay_reply(843, 129);
    giq_option(4, 843, 130, BarterGuyEnd, 50);
    giq_option(4, 843, 131, BarterGuy01, 50);
    giq_option(4, 843, 132, BarterGuy13, 50);
  BarterGuy12: |
    gsay_reply(843, 133);
    giq_option(4, 843, 136, BarterGuy14, 50);
    giq_option(4, 843, 134, BarterGuyEnd, 50);
  BarterGuy13: |
    gsay_reply(843, 135);
    giq_option(4, 843, 136, BarterGuy14, 50);
    giq_option(4, 843, 134, BarterGuyEnd, 50);
  BarterGuy14: |
    gdialog_mod_barter(-10);
    gsay_message(843, 137, 50);
  BarterGuyEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
cavewall:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(465, 100));
  description_p_proc: |
    script_overrides;
    if (is_success(do_check(dude_obj, 1, 0)) or is_success(do_check(dude_obj, 6, -1))) then begin
      display_msg(message_str(465, 101));
    end
    else begin
      display_msg(message_str(465, 100));
    end
  damage_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (map_var(0) == 0) then begin
      set_map_var(0, 1);
      gfade_out(600);
      LVar0 := create_object_sid(33554839, 0, 0, -1);
      move_to(LVar0, 21744, 0);
      create_object_sid(33554499, 22349, 0, -1);
      create_object_sid(33554499, 21544, 0, -1);
      create_object_sid(33554499, 21744, 0, -1);
      create_object_sid(33554499, 21944, 0, -1);
      create_object_sid(33554499, 22144, 0, -1);
      create_object_sid(33554499, 22344, 0, -1);
      create_object_sid(33554499, 22544, 0, -1);
      create_object_sid(33554499, 22744, 0, -1);
      create_object_sid(33554499, 22944, 0, -1);
      create_object_sid(33554499, 21139, 0, -1);
      create_object_sid(33554499, 21339, 0, -1);
      create_object_sid(33554499, 21539, 0, -1);
      create_object_sid(33554499, 21739, 0, -1);
      create_object_sid(33554499, 21939, 0, -1);
      create_object_sid(33554499, 22139, 0, -1);
      create_object_sid(33554499, 22339, 0, -1);
      create_object_sid(33554499, 22539, 0, -1);
      create_object_sid(33554499, 22739, 0, -1);
      create_object_sid(33554499, 22939, 0, -1);
      create_object_sid(33554499, 22940, 0, -1);
      create_object_sid(33554499, 22941, 0, -1);
      create_object_sid(33554499, 22942, 0, -1);
      create_object_sid(33554499, 22943, 0, -1);
      if (global_var(28) == 0) then begin
        set_global_var(155, global_var(155) + 6);
        LVar1 := (global_var(2) * 75) + 75;
        if (LVar1 < 300) then begin
          LVar1 := 300;
        end
        if (global_var(2) > 0) then begin
          LVar1 := LVar1 + 500;
        end
        set_global_var(28, 2);
        set_global_var(43, 2);
        display_msg(message_str(766, 188) + " " + message_str(766, 103) + " " + LVar1 + " " + message_str(766, 104));
        give_exp_points(LVar1);
      end
      else begin
        display_msg(message_str(465, 102));
      end
      gfade_in(600);
      if (not(tile_distance(tile_num(dude_obj), 21155) < 15)) then begin
        metarule(13, 0);
      end
    end
ccvan:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 36);
      critter_add_trait(self_obj, 1, 5, 50);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(767, self_obj, 4, -1, -1);
    gsay_start;
    call caravan00;
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 7) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(767, 100));
  caravan00: |
    gsay_reply(767, 103);
    giq_option(0, 767, 104, caravan01, 50);
    giq_option(0, 767, 105, caravan02, 50);
  caravan01: |
    gsay_reply(767, 106);
    giq_option(0, 767, 104, caravan03, 50);
    giq_option(0, 767, 105, caravan02, 50);
  caravan02: 'gsay_message(767, 107, 50);

    '
  caravan03: |
    gsay_reply(767, 109);
    giq_option(0, 767, 112, caravan03a, 50);
    giq_option(0, 767, 113, caravan03b, 50);
    giq_option(0, 767, 114, caravan03c, 50);
    giq_option(0, 767, 115, caravan03d, 50);
    giq_option(0, 767, 116, caravan04, 50);
  caravan03a: |
    variable LVar0 := 0;
    gsay_message(767, 117, 50);
    set_global_var(199, 1);
    LVar0 := random(1, 4);
    game_time_advance(game_ticks(60 * 60 * 24 * 3));
    item_caps_adjust(dude_obj, 600);
    if (LVar0 < 3) then begin
      LVar0 := random(1, 4);
      if (LVar0 == 1) then begin
        load_map(56, 1);
      end
      else begin
        load_map(56, 2);
      end
    end
    else begin
      load_map(56, 3);
    end
  caravan03b: |
    variable LVar0 := 0;
    gsay_message(767, 117, 50);
    set_global_var(199, 1);
    LVar0 := random(1, 4);
    game_time_advance(game_ticks(60 * 60 * 24 * 3));
    item_caps_adjust(dude_obj, 600);
    if (LVar0 < 3) then begin
      LVar0 := random(1, 4);
      if (LVar0 == 1) then begin
        load_map(58, 1);
      end
      else begin
        load_map(58, 2);
      end
    end
    else begin
      load_map(58, 3);
    end
  caravan03c: |
    variable LVar0 := 0;
    gsay_message(767, 117, 50);
    set_global_var(199, 1);
    LVar0 := random(1, 4);
    game_time_advance(game_ticks(60 * 60 * 24 * 5));
    item_caps_adjust(dude_obj, 600);
    if (LVar0 < 3) then begin
      LVar0 := random(1, 4);
      if (LVar0 == 1) then begin
        load_map(59, 1);
      end
      else begin
        load_map(59, 2);
      end
    end
    else begin
      load_map(59, 3);
    end
  caravan03d: |
    variable LVar0 := 0;
    gsay_message(767, 117, 50);
    set_global_var(199, 1);
    LVar0 := random(1, 4);
    game_time_advance(game_ticks(60 * 60 * 24 * 3));
    item_caps_adjust(dude_obj, 600);
    if (LVar0 < 3) then begin
      LVar0 := random(1, 4);
      if (LVar0 == 1) then begin
        load_map(57, 1);
      end
      else begin
        load_map(57, 2);
      end
    end
    else begin
      load_map(57, 3);
    end
  caravan04: 'gsay_message(767, 108, 50);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1)) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1)) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
chair:
  start: |
    if (script_action == 6) then begin
      script_overrides;
      display_msg(message_str(21, 100));
    end
chanter:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 69);
      Only_Once := 0;
    end
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(398, 100));
    end
    else begin
      if (script_action == 12) then begin
        if (Hostile) then begin
          Hostile := 0;
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 18) then begin
            if (source_obj == dude_obj) then begin
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                set_global_var(156, 1);
                set_global_var(157, 0);
              end
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                set_global_var(157, 1);
                set_global_var(156, 0);
              end
              set_global_var(159, global_var(159) + 1);
              if ((global_var(159) % 2) == 0) then begin
                set_global_var(155, global_var(155) - 1);
              end
            end
          end
          else begin
            if (script_action == 11) then begin
              script_overrides;
              if (global_var(195) == 1) then begin
                float_msg(self_obj, message_str(398, 101), 0);
              end
              else begin
                start_gdialog(398, self_obj, 4, -1, -1);
                gsay_start;
                call Chant01;
                gsay_end;
                end_dialogue;
              end
            end
          end
        end
      end
    end
  Chant01: |
    gsay_reply(398, 102);
    giq_option(7, 398, 103, Chant02, 50);
    giq_option(4, 398, 104, Chant03, 50);
    giq_option(4, 398, 105, Chant04, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 398, 106, Chant05, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 398, 107, Chant05, 50);
    end
    giq_option(-3, 398, 108, Chant06, 50);
  Chant02: 'gsay_message(398, 109, 50);

    '
  Chant03: 'gsay_message(398, 110, 50);

    '
  Chant04: 'gsay_message(398, 111, 50);

    '
  Chant05: 'gsay_message(398, 112, 50);

    '
  Chant06: 'gsay_message(398, 113, 49);

    '
  ChantEnd: "[]"
  Combat: 'Hostile := 1;

    '
  Chant07: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(398, 114, 49);
    end
    else begin
      gsay_message(398, 115, 49);
    end
charbody:
  start: |
    if (script_action == 3) then begin
      call look_at_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    rndx := random(1, 4);
    if (rndx == 1) then begin
      display_msg(message_str(292, 100));
    end
    else begin
      if (rndx == 2) then begin
        display_msg(message_str(292, 101));
      end
      else begin
        if (rndx == 3) then begin
          display_msg(message_str(292, 102));
        end
        else begin
          if (rndx == 4) then begin
            display_msg(message_str(292, 103));
          end
        end
      end
    end
  use_p_proc: |
    script_overrides;
    display_msg(message_str(292, 104));
chdguard:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(275, 100));
  talk_p_proc: |
    script_overrides;
    if (local_var(0)) then begin
      call ChdGuard35;
    end
    else begin
      set_local_var(0, 1);
      start_gdialog(275, self_obj, 4, -1, -1);
      gsay_start;
      call ChdGuard0;
      gsay_end;
      end_dialogue;
    end
  ChdGuard0: |
    gsay_reply(275, 101);
    giq_option(-3, 275, 102, ChdGuard1, 50);
    giq_option(4, 275, 103, ChdGuard13, 50);
    giq_option(4, 275, 104, ChdGuard25, 50);
    giq_option(6, 275, 105, ChdGuard26, 50);
    giq_option(6, 275, 106, ChdGuard27, 50);
  ChdGuard1: |
    gsay_reply(275, 107);
    giq_option(-3, 275, 108, ChdGuard2, 50);
    giq_option(-3, 275, 109, combat, 50);
    giq_option(-3, 275, 110, ChdGuard9, 50);
  ChdGuard2: |
    gsay_reply(275, 111);
    giq_option(-3, 275, 112, combat, 50);
    giq_option(-3, 275, 113, ChdGuard3, 50);
    giq_option(-3, 275, 114, ChdGuard4, 50);
  ChdGuard3: 'gsay_message(275, 115, 50);

    '
  ChdGuard4: |
    gsay_reply(275, 116);
    giq_option(-3, 275, 117, ChdGuard5, 50);
    giq_option(-3, 275, 118, combat, 50);
    giq_option(-3, 275, 119, ChdGuard6, 50);
  ChdGuard5: 'gsay_message(275, 120, 50);

    '
  ChdGuard6: |
    gsay_reply(275, 121);
    giq_option(-3, 275, 122, ChdGuard7, 50);
    giq_option(-3, 275, 123, ChdGuard5, 50);
    giq_option(-3, 275, 124, ChdGuard8, 50);
  ChdGuard7: 'gsay_message(275, 125, 50);

    '
  ChdGuard8: 'gsay_message(275, 126, 50);

    '
  ChdGuard9: |
    gsay_reply(275, 127);
    giq_option(-3, 275, 128, ChdGuard10, 50);
    giq_option(-3, 275, 129, ChdGuard12, 50);
    giq_option(-3, 275, 130, ChdGuardend, 50);
  ChdGuard10: |
    gsay_reply(275, 131);
    giq_option(-3, 275, 132, ChdGuard11, 50);
    giq_option(-3, 275, 133, ChdGuardend, 50);
  ChdGuard11: 'gsay_message(275, 134, 50);

    '
  ChdGuard12: |
    gsay_reply(275, 135);
    giq_option(-3, 275, 136, ChdGuardend, 50);
  ChdGuard13: |
    gsay_reply(275, 137);
    giq_option(4, 275, 138, ChdGuard14, 50);
    giq_option(4, 275, 139, ChdGuard15, 50);
    giq_option(4, 275, message_str(275, 140) + proto_data(obj_pid(dude_obj), 1) + message_str(275, 141), ChdGuard22, 50);
    giq_option(4, 275, 142, ChdGuard24, 50);
    giq_option(4, 275, 143, combat, 50);
  ChdGuard14: |
    gsay_message(275, 144, 50);
    call combat;
  ChdGuard15: |
    gsay_reply(275, 145);
    giq_option(4, 275, 146, ChdGuard16, 50);
    giq_option(4, 275, 147, ChdGuard17, 50);
  ChdGuard16: |
    gsay_message(275, 148, 50);
    call combat;
  ChdGuard17: |
    gsay_reply(275, 149);
    giq_option(4, 275, message_str(275, 150) + proto_data(obj_pid(dude_obj), 1) + message_str(275, 151), ChdGuard17a, 50);
    giq_option(4, 275, 152, ChdGuard20, 50);
    giq_option(4, 275, 153, combat, 50);
  ChdGuard17a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call ChdGuard18;
    end
    else begin
      call ChdGuard19;
    end
  ChdGuard18: 'gsay_message(275, 154, 50);

    '
  ChdGuard19: |
    gsay_message(275, 155, 50);
    call combat;
  ChdGuard20: |
    gsay_reply(275, 156);
    giq_option(4, 275, message_str(275, 157) + proto_data(obj_pid(dude_obj), 1) + message_str(275, 158), ChdGuard21, 50);
    giq_option(4, 275, 159, combat, 50);
  ChdGuard21: |
    gsay_message(275, 160, 50);
    call ChdGuard17a;
  ChdGuard22: |
    gsay_reply(275, message_str(275, 161) + proto_data(obj_pid(dude_obj), 1) + message_str(275, 162));
    giq_option(4, 275, 163, ChdGuard23, 50);
    giq_option(4, 275, 164, ChdGuard23, 50);
    giq_option(4, 275, 165, combat, 50);
  ChdGuard23: |
    gsay_message(275, 166, 50);
    call combat;
  ChdGuard24: |
    gsay_message(275, 167, 50);
    call combat;
  ChdGuard25: |
    gsay_reply(275, 168);
    giq_option(4, 275, 169, ChdGuard14, 50);
    giq_option(4, 275, 170, ChdGuard15, 50);
    giq_option(4, 275, message_str(275, 171) + proto_data(obj_pid(dude_obj), 1) + message_str(275, 172), ChdGuard22, 50);
    giq_option(4, 275, 173, ChdGuard24, 50);
    giq_option(4, 275, 174, combat, 50);
  ChdGuard26: |
    gsay_message(275, 175, 50);
    call combat;
  ChdGuard27: |
    gsay_reply(275, 176);
    giq_option(6, 275, 177, ChdGuard28, 50);
    giq_option(6, 275, 178, ChdGuard29, 50);
    giq_option(6, 275, 179, ChdGuard30, 50);
    giq_option(6, 275, 180, ChdGuard34, 50);
  ChdGuard28: 'gsay_message(275, 181, 50);

    '
  ChdGuard29: 'gsay_message(275, 182, 50);

    '
  ChdGuard30: |
    gsay_reply(275, 183);
    giq_option(6, 275, 184, ChdGuard31, 50);
    giq_option(6, 275, 185, ChdGuard32, 50);
    giq_option(6, 275, 186, combat, 50);
  ChdGuard31: |
    gsay_message(275, 187, 50);
    call combat;
  ChdGuard32: |
    gsay_reply(275, 188);
    giq_option(6, 275, 189, ChdGuard33, 50);
    giq_option(6, 275, 190, ChdGuard33, 50);
    giq_option(6, 275, 191, combat, 50);
  ChdGuard33: |
    gsay_reply(275, 192);
    giq_option(6, 275, 193, ChdGuardend, 50);
    giq_option(6, 275, 194, combat, 50);
  ChdGuard34: |
    gsay_message(275, 195, 50);
    call combat;
  ChdGuard35: |
    gsay_message(275, 196, 50);
    call combat;
  ChdGuardend: "[]"
  combat: 'hostile := 1;

    '
chdscout:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(276, 100));
  talk_p_proc: |
    if (local_var(0)) then begin
      call ChdScout35;
    end
    else begin
      set_local_var(0, 1);
      start_gdialog(276, self_obj, 4, -1, -1);
      gsay_start;
      call ChdScout0;
      gsay_end;
      end_dialogue;
    end
  ChdScout0: |
    gsay_reply(276, 101);
    giq_option(-3, 276, 102, ChdScout1, 50);
    giq_option(4, 276, 103, ChdScout13, 50);
    giq_option(4, 276, 104, ChdScout25, 50);
    giq_option(6, 276, 105, ChdScout26, 50);
    giq_option(6, 276, 106, ChdScout27, 50);
  ChdScout1: |
    gsay_reply(276, 107);
    giq_option(-3, 276, 108, ChdScout2, 50);
    giq_option(-3, 276, 109, combat, 50);
    giq_option(-3, 276, 110, ChdScout9, 50);
  ChdScout2: |
    gsay_reply(276, 111);
    giq_option(-3, 276, 112, combat, 50);
    giq_option(-3, 276, 113, ChdScout3, 50);
    giq_option(-3, 276, 114, ChdScout4, 50);
  ChdScout3: 'gsay_message(276, 115, 50);

    '
  ChdScout4: |
    gsay_reply(276, 116);
    giq_option(-3, 276, 117, ChdScout5, 50);
    giq_option(-3, 276, 118, combat, 50);
    giq_option(-3, 276, 119, ChdScout6, 50);
  ChdScout5: 'gsay_message(276, 120, 50);

    '
  ChdScout6: |
    gsay_reply(276, 121);
    giq_option(-3, 276, 122, ChdScout7, 50);
    giq_option(-3, 276, 123, ChdScout5, 50);
    giq_option(-3, 276, 124, ChdScout8, 50);
  ChdScout7: 'gsay_message(276, 125, 50);

    '
  ChdScout8: 'gsay_message(276, 126, 50);

    '
  ChdScout9: |
    gsay_reply(276, 127);
    giq_option(-3, 276, 128, ChdScout10, 50);
    giq_option(-3, 276, 129, ChdScout12, 50);
    giq_option(-3, 276, 130, ChdScoutend, 50);
  ChdScout10: |
    gsay_reply(276, 131);
    giq_option(-3, 276, 132, ChdScout11, 50);
    giq_option(-3, 276, 133, ChdScoutend, 50);
  ChdScout11: 'gsay_message(276, 134, 50);

    '
  ChdScout12: |
    gsay_reply(276, 135);
    giq_option(-3, 276, 136, ChdScoutend, 50);
  ChdScout13: |
    gsay_reply(276, 137);
    giq_option(4, 276, 138, ChdScout14, 50);
    giq_option(4, 276, 139, ChdScout15, 50);
    giq_option(4, 276, message_str(276, 140) + proto_data(obj_pid(dude_obj), 1) + message_str(276, 141), ChdScout22, 50);
    giq_option(4, 276, 142, ChdScout24, 50);
    giq_option(4, 276, 143, combat, 50);
  ChdScout14: |
    gsay_message(276, 144, 50);
    call combat;
  ChdScout15: |
    gsay_reply(276, 145);
    giq_option(4, 276, 146, ChdScout16, 50);
    giq_option(4, 276, 147, ChdScout17, 50);
  ChdScout16: |
    gsay_message(276, 148, 50);
    call combat;
  ChdScout17: |
    gsay_reply(276, 149);
    giq_option(4, 276, message_str(276, 150) + proto_data(obj_pid(dude_obj), 1) + message_str(276, 151), ChdScout17a, 50);
    giq_option(4, 276, 152, ChdScout20, 50);
    giq_option(4, 276, 153, combat, 50);
  ChdScout17a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call ChdScout18;
    end
    else begin
      call ChdScout19;
    end
  ChdScout18: 'gsay_message(276, 154, 50);

    '
  ChdScout19: |
    gsay_message(276, 155, 50);
    call combat;
  ChdScout20: |
    gsay_reply(276, 156);
    giq_option(4, 276, message_str(276, 157) + proto_data(obj_pid(dude_obj), 1) + message_str(276, 158), ChdScout21, 50);
    giq_option(4, 276, 159, combat, 50);
  ChdScout21: |
    gsay_message(276, 160, 50);
    call ChdScout17a;
  ChdScout22: |
    gsay_reply(276, message_str(276, 161) + proto_data(obj_pid(dude_obj), 1) + message_str(276, 162));
    giq_option(4, 276, 163, ChdScout23, 50);
    giq_option(4, 276, 164, ChdScout23, 50);
    giq_option(4, 276, 165, combat, 50);
  ChdScout23: |
    gsay_message(276, 166, 50);
    call combat;
  ChdScout24: |
    gsay_message(276, 167, 50);
    call combat;
  ChdScout25: |
    gsay_reply(276, 168);
    giq_option(4, 276, 169, ChdScout14, 50);
    giq_option(4, 276, 170, ChdScout15, 50);
    giq_option(4, 276, message_str(276, 171) + proto_data(obj_pid(dude_obj), 1) + message_str(276, 172), ChdScout22, 50);
    giq_option(4, 276, 173, ChdScout24, 50);
    giq_option(4, 276, 174, combat, 50);
  ChdScout26: |
    gsay_message(276, 175, 50);
    call combat;
  ChdScout27: |
    gsay_reply(276, 176);
    giq_option(6, 276, 177, ChdScout28, 50);
    giq_option(6, 276, 178, ChdScout29, 50);
    giq_option(6, 276, 179, ChdScout30, 50);
    giq_option(6, 276, 180, ChdScout34, 50);
  ChdScout28: 'gsay_message(276, 181, 50);

    '
  ChdScout29: 'gsay_message(276, 182, 50);

    '
  ChdScout30: |
    gsay_reply(276, 183);
    giq_option(6, 276, 184, ChdScout31, 50);
    giq_option(6, 276, 185, ChdScout32, 50);
    giq_option(6, 276, 186, combat, 50);
  ChdScout31: |
    gsay_message(276, 187, 50);
    call combat;
  ChdScout32: |
    gsay_reply(276, 188);
    giq_option(6, 276, 189, ChdScout33, 50);
    giq_option(6, 276, 190, ChdScout33, 50);
    giq_option(6, 276, 191, combat, 50);
  ChdScout33: |
    gsay_reply(276, 192);
    giq_option(6, 276, 193, ChdScoutend, 50);
    giq_option(6, 276, 194, combat, 50);
  ChdScout34: |
    gsay_message(276, 195, 50);
    call combat;
  ChdScout35: |
    gsay_message(276, 196, 50);
    call combat;
  ChdScoutend: "[]"
  combat: 'hostile := 1;

    '
chepslot:
  start: |
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 15) then begin
        call map_enter_p_proc;
      end
      else begin
        if (script_action == 6) then begin
          call use_p_proc;
        end
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(354, 100));
  map_enter_p_proc: |
    if (global_var(38) == 1) then begin
      destroy_object(self_obj);
    end
  use_p_proc: |
    script_overrides;
    if (item_caps_total(dude_obj) < 10) then begin
      display_msg(message_str(354, 108));
    end
    else begin
      display_msg(message_str(354, 101));
      item_caps_adjust(dude_obj, -10);
      bonus := random(1, 50) - random(1, 50);
      test := roll_vs_skill(dude_obj, 16, bonus);
      if (is_success(test)) then begin
        if (is_critical(test)) then begin
          rndx := random(15, 30);
          float_msg(self_obj, message_str(354, 102), 0);
          display_msg(message_str(354, 103) + rndx + message_str(354, 104));
        end
        else begin
          float_msg(self_obj, message_str(354, 105), 0);
          display_msg(message_str(354, 106));
          rndx := 15;
        end
        item_caps_adjust(dude_obj, rndx);
      end
      else begin
        display_msg(message_str(354, 107));
      end
    end
chidgab:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 69);
      Only_Once := 0;
    end
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(395, 100));
    end
    else begin
      if (script_action == 4) then begin
        Hostile := 1;
      end
      else begin
        if (script_action == 12) then begin
          if (Hostile) then begin
            Hostile := 0;
            attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
          end
        end
        else begin
          if (script_action == 18) then begin
            if (source_obj == dude_obj) then begin
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                set_global_var(156, 1);
                set_global_var(157, 0);
              end
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                set_global_var(157, 1);
                set_global_var(156, 0);
              end
              set_global_var(160, global_var(160) + 1);
              if ((global_var(160) % 6) == 0) then begin
                set_global_var(155, global_var(155) + 1);
              end
            end
          end
          else begin
            if (script_action == 11) then begin
              script_overrides;
              if (global_var(195) == 1) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1)) or (global_var(158) > 2)) then begin
                  float_msg(self_obj, message_str(395, 102), 0);
                end
                else begin
                  float_msg(self_obj, message_str(395, 101), 0);
                end
              end
              else begin
                start_gdialog(395, self_obj, 4, -1, -1);
                gsay_start;
                call Brat02;
                gsay_end;
                end_dialogue;
              end
            end
          end
        end
      end
    end
  Brat02: |
    gsay_reply(395, 103);
    giq_option(7, 395, 104, Brat03, 50);
    giq_option(4, 395, 105, Brat04, 50);
    giq_option(4, 395, 106, Brat05, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 395, 107, Brat06, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 395, 108, Brat07, 50);
    end
    giq_option(-3, 395, 109, Brat07, 50);
  Brat03: |
    gsay_reply(395, 110);
    gsay_option(395, 115, BratEnd, 50);
  Brat04: |
    gsay_reply(395, 111);
    gsay_option(395, 115, BratEnd, 50);
  Brat05: |
    gsay_reply(395, 112);
    gsay_option(395, 115, BratEnd, 50);
  Brat06: |
    gsay_reply(395, 113);
    gsay_option(395, 115, BratEnd, 50);
  Brat07: |
    gsay_reply(395, 114);
    gsay_option(395, 115, BratEnd, 50);
  Combat: 'Hostile := 1;

    '
  BratEnd: "[]"
chidinit:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      if (local_var(0) == 0) then begin
        set_local_var(0, random(100, 109));
      end
      initialized := 1;
    end
    else begin
      if (script_action == 18) then begin
        call destroy_p_proc;
      end
      else begin
        if (script_action == 21) then begin
          call look_at_p_proc;
        end
        else begin
          if (script_action == 11) then begin
            call talk_p_proc;
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(262, local_var(0)));
  talk_p_proc: |
    script_overrides;
    float_msg(self_obj, message_str(262, random(110, 116)), 0);
chidnite:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 66);
      Only_Once := 0;
    end
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(394, 100));
    end
    else begin
      if (script_action == 18) then begin
        if (source_obj == dude_obj) then begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
            set_global_var(156, 1);
            set_global_var(157, 0);
          end
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
            set_global_var(157, 1);
            set_global_var(156, 0);
          end
          set_global_var(160, global_var(160) + 1);
          if ((global_var(160) % 6) == 0) then begin
            set_global_var(155, global_var(155) + 1);
          end
        end
      end
      else begin
        if (script_action == 14) then begin
          set_global_var(245, 1);
        end
        else begin
          if (script_action == 12) then begin
            if (obj_can_see_obj(self_obj, dude_obj)) then begin
              if (not(obj_is_carrying_obj_pid(dude_obj, 142))) then begin
                if (not(obj_is_carrying_obj_pid(dude_obj, 141))) then begin
                  if (obj_pid(critter_inven_obj(dude_obj, 0)) != 113) then begin
                    Hostile := 1;
                  end
                end
              end
            end
            if ((metarule(16, 0) > 1) and obj_can_see_obj(self_obj, dude_obj)) then begin
              Hostile := 1;
            end
            if (Hostile) then begin
              Hostile := 0;
              attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
            end
          end
          else begin
            if (script_action == 4) then begin
              Hostile := 1;
            end
            else begin
              if (script_action == 11) then begin
                script_overrides;
                if (global_var(195) == 1) then begin
                  float_msg(self_obj, message_str(394, 101), 0);
                  Hostile := 1;
                end
                else begin
                  start_gdialog(394, self_obj, 4, -1, -1);
                  gsay_start;
                  call Nightkin01;
                  gsay_end;
                  end_dialogue;
                end
              end
            end
          end
        end
      end
    end
  Nightkin01: |
    gsay_reply(394, 102);
    giq_option(7, 394, 103, Nightkin01a, 50);
    giq_option(4, 394, 104, Nightkin04, 50);
    giq_option(4, 394, 105, Nightkin05, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 394, 106, Nightkin05, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 394, 107, Nightkin04, 50);
    end
    giq_option(-3, 394, 108, Nightkinend, 50);
  Nightkin01a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Nightkin02;
    end
    else begin
      call Nightkin03;
    end
  Nightkin02: |
    gsay_reply(394, 109);
    gsay_option(394, 125, Nightkinend, 50);
  Nightkin03: |
    gsay_reply(394, 110);
    call Combat;
  Nightkin04: |
    gsay_reply(394, 111);
    call Combat;
  Nightkin05: |
    gsay_reply(394, 112);
    giq_option(7, 394, 113, Nightkin05a, 50);
    giq_option(4, 394, 114, Nightkin04, 50);
    giq_option(4, 394, 115, Nightkin07, 50);
    giq_option(4, 394, 116, Nightkin07, 50);
    giq_option(4, 394, 117, Nightkinend, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 394, 118, Nightkin04, 50);
    end
  Nightkin05a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Nightkin06;
    end
    else begin
      call Nightkin03;
    end
  Nightkin06: |
    gsay_reply(394, 119);
    gsay_option(394, 125, Nightkinend, 50);
  Nightkin07: |
    gsay_reply(394, 120);
    giq_option(4, 394, 121, Nightkin04, 50);
    giq_option(4, 394, 122, Nightkin04, 50);
    giq_option(4, 394, 123, Nightkinend, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 394, 124, Combat, 50);
    end
  Nightkinend: "[]"
  Combat: |
    set_global_var(195, 1);
    Hostile := 1;
chidscol:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      if (local_var(0) == 0) then begin
        set_local_var(0, random(100, 109));
      end
      initialized := 1;
    end
    else begin
      if (script_action == 18) then begin
        call destroy_p_proc;
      end
      else begin
        if (script_action == 21) then begin
          call look_at_p_proc;
        end
        else begin
          if (script_action == 11) then begin
            call talk_p_proc;
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(261, local_var(0)));
  talk_p_proc: |
    script_overrides;
    float_msg(self_obj, message_str(261, random(110, 120)), 0);
child:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 68);
      if (local_var(3) == 0) then begin
        set_local_var(3, tile_num(self_obj));
      end
    end
  critter_p_proc: |
    if ((game_time_hour > 600) and (game_time_hour < 1900)) then begin
      set_local_var(0, 0);
      set_local_var(1, 1);
    end
    else begin
      set_local_var(1, 0);
      set_local_var(0, 1);
    end
    if (cur_map_index == 25) then begin
      if (local_var(0) == 1) then begin
        if (tile_num(self_obj) != 14950) then begin
          animate_move_obj_to_tile(self_obj, 14950, 0);
        end
        else begin
          set_obj_visibility(self_obj, 1);
        end
      end
      else begin
        set_obj_visibility(self_obj, 0);
        if (random(0, 6) == 1) then begin
          animate_move_obj_to_tile(self_obj, tile_num_in_direction(local_var(3), random(0, 5), random(6, 12)), 0);
        end
        else begin
          animate_move_obj_to_tile(self_obj, tile_num_in_direction(local_var(3), random(0, 5), random(6, 12)), 1);
        end
      end
    end
    else begin
      if (cur_map_index == 26) then begin
        if (local_var(0) == 1) then begin
          if (tile_num(self_obj) != 22443) then begin
            animate_move_obj_to_tile(self_obj, 22443, 0);
          end
          else begin
            set_obj_visibility(self_obj, 1);
          end
        end
        else begin
          set_obj_visibility(self_obj, 0);
          if (random(0, 6) == 1) then begin
            animate_move_obj_to_tile(self_obj, tile_num_in_direction(local_var(3), random(0, 5), random(6, 12)), 0);
          end
          else begin
            animate_move_obj_to_tile(self_obj, tile_num_in_direction(local_var(3), random(0, 5), random(5, 10)), 1);
          end
        end
      end
      else begin
        if ((random(0, 15) == 1) and (Start_Moving == 0)) then begin
          add_timer_event(self_obj, game_ticks(random(3, 6)), 1);
        end
      end
      if (cur_map_index == 12) then begin
        if (local_var(0) == 1) then begin
          if (tile_num(self_obj) != 20257) then begin
            animate_move_obj_to_tile(self_obj, 20257, 0);
          end
          else begin
            set_obj_visibility(self_obj, 1);
          end
        end
        else begin
          set_obj_visibility(self_obj, 0);
          if (random(0, 6) == 1) then begin
            animate_move_obj_to_tile(self_obj, tile_num_in_direction(local_var(3), random(0, 5), random(6, 12)), 0);
          end
          else begin
            animate_move_obj_to_tile(self_obj, tile_num_in_direction(local_var(3), random(0, 5), random(6, 12)), 1);
          end
        end
      end
      else begin
        if ((random(0, 15) == 1) and (Start_Moving == 0)) then begin
          add_timer_event(self_obj, game_ticks(random(3, 6)), 1);
        end
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  talk_p_proc: |
    start_gdialog(237, self_obj, 4, -1, -1);
    gsay_start;
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      call child04;
    end
    else begin
      call child01;
    end
    gsay_end;
    end_dialogue;
  pickup_p_proc: 'hostile := 1;

    '
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    if (source_obj == dude_obj) then begin
      set_global_var(158, global_var(158) + 1);
      set_global_var(155, global_var(155) - 1);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(237, 100));
  timed_event_p_proc: |
    Start_Moving := 0;
    if (obj_on_screen(self_obj)) then begin
      animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), random(0, 5), random(3, 7)), 0);
    end
  child01: |
    gsay_reply(237, 101);
    giq_option(4, 237, 102, childend, 50);
    giq_option(5, 237, 103, child02, 50);
    giq_option(-3, 237, 104, child03, 50);
  child02: 'gsay_message(237, 105, 50);

    '
  child03: 'gsay_message(237, 106, 50);

    '
  child04: |
    gsay_reply(237, 107);
    giq_option(4, 237, 108, child05, 50);
    giq_option(4, 237, 109, child06, 50);
    giq_option(-3, 237, 110, child03, 50);
  child05: 'gsay_message(237, 111, 50);

    '
  child06: 'gsay_message(237, 112, 50);

    '
  childend: "[]"
childmem:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 67);
      init_teams := 1;
    end
    max_hp := get_critter_stat(dude_obj, 7);
    current_hp := get_critter_stat(dude_obj, 35);
    RADCOUNT := 0;
    if (script_action == 11) then begin
      if (local_var(5) == 0) then begin
        call pre_dialogue;
      end
      else begin
        call childend;
      end
    end
    else begin
      if (script_action == 14) then begin
        set_local_var(4, 1);
      end
      else begin
        if (script_action == 21) then begin
          script_overrides;
          display_msg(message_str(41, 100));
        end
        else begin
          if (script_action == 4) then begin
            hostile := 1;
          end
          else begin
            if (script_action == 12) then begin
              if (hostile) then begin
                hostile := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
            end
            else begin
              if (script_action == 18) then begin
                if (source_obj == dude_obj) then begin
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                    set_global_var(156, 1);
                    set_global_var(157, 0);
                  end
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                    set_global_var(157, 1);
                    set_global_var(156, 0);
                  end
                  set_global_var(159, global_var(159) + 1);
                  if ((global_var(159) % 2) == 0) then begin
                    set_global_var(155, global_var(155) - 1);
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    start_gdialog(41, self_obj, 4, -1, -1);
    gsay_start;
    call child00;
    gsay_end;
    end_dialogue;
  pre_dialogue: |
    if (local_var(4)) then begin
      call child16;
    end
    else begin
      if (global_var(35) > 0) then begin
        call child15;
      end
      else begin
        call do_dialogue;
      end
    end
  childend: "[]"
  childcbt: 'hostile := 1;

    '
  child_heal: |
    game_time_advance(game_ticks(600 * hp_injured));
    critter_heal(dude_obj, hp_injured);
    set_global_var(154, global_var(154) - 1);
  child_pois: |
    game_time_advance(game_ticks(1800));
    cur_pois := get_poison(dude_obj);
    poison(dude_obj, -cur_pois);
    set_global_var(154, global_var(154) - 1);
  child00: |
    gsay_reply(41, 101);
    giq_option(4, 41, 102, child04, 50);
    giq_option(5, 41, 103, child11, 50);
    giq_option(-3, 41, 104, child01, 50);
  child01: |
    gsay_message(41, 105, 50);
    if (current_hp < max_hp) then begin
      hp_injured := max_hp - current_hp;
      call child_heal;
      call child03;
    end
    else begin
      call child02;
    end
  child02: |
    gsay_message(41, 106, 50);
    call childend;
  child03: |
    gsay_message(41, 107, 50);
    call childend;
  child04: |
    variable LVar0 := 0;
    if (local_var(1) >= 3) then begin
      LVar0 := 5;
      pois_cost := 12;
    end
    else begin
      if (local_var(1) < 2) then begin
        LVar0 := 20;
        pois_cost := 50;
      end
      else begin
        LVar0 := 10;
        pois_cost := 25;
      end
    end
    hp_injured := max_hp - current_hp;
    cost := (hp_injured * LVar0) + pois_cost;
    cheat := 3 * cost / 4;
    if (hp_injured > 0) then begin
      gsay_message(41, 108, 50);
    end
    else begin
      gsay_message(41, 109, 50);
    end
    if (get_poison(dude_obj)) then begin
      gsay_message(41, 110, 50);
    end
    if (RADCOUNT > 50) then begin
      gsay_message(41, 111, 50);
    end
    if ((hp_injured > 0) or get_poison(dude_obj)) then begin
      gsay_reply(41, message_str(41, 113) + cost + message_str(41, 114));
      giq_option(3, 41, 115, child04a, 50);
      giq_option(3, 41, 116, childend, 50);
      giq_option(3, 41, 117, child09, 50);
      giq_option(3, 41, message_str(41, 118) + cheat + message_str(41, 119), child05, 50);
    end
  child04a: |
    if (cost > item_caps_total(dude_obj)) then begin
      call child08;
    end
    else begin
      call child06;
    end
  child05: |
    gsay_reply(41, 120);
    giq_option(3, 41, 121, child04a, 50);
    giq_option(3, 41, 122, child05a, 50);
  child05a: |
    set_local_var(5, 1);
    call childend;
  child06: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(41, 123, 50);
    end
    else begin
      gsay_message(41, 124, 50);
    end
    item_caps_adjust(dude_obj, -cost);
    gfade_out(400);
    gfade_in(400);
    if (hp_injured > 0) then begin
      call child_heal;
    end
    if (get_poison(dude_obj)) then begin
      call child_pois;
    end
    call child07;
  child07: |
    gsay_message(41, 125, 50);
    call childend;
  child08: |
    if (cost > item_caps_total(dude_obj)) then begin
      cost := item_caps_total(dude_obj);
    end
    gsay_reply(41, 126);
    if (item_caps_total(dude_obj) > 0) then begin
      giq_option(3, 41, 127, child06, 50);
    end
    giq_option(3, 41, 128, childend, 50);
  child09: |
    gsay_reply(41, 129);
    if (item_caps_total(dude_obj) > 0) then begin
      giq_option(3, 41, 130, child09a, 50);
    end
    giq_option(3, 41, 131, childend, 50);
  child09a: |
    if (item_caps_total(dude_obj) >= cost) then begin
      call child10;
    end
    else begin
      cost := item_caps_total(dude_obj);
      call child06;
    end
  child10: |
    gsay_message(41, 132, 50);
    call child06;
  child11: |
    gsay_reply(41, 133);
    giq_option(3, 41, 134, childend, 50);
    giq_option(3, 41, 135, child12, 50);
  child12: |
    gsay_reply(41, 136);
    giq_option(3, 41, 137, child14, 50);
    giq_option(3, 41, 138, child13, 50);
  child13: |
    gsay_message(41, 139, 50);
    call childend;
  child14: |
    gsay_reply(41, 140);
    giq_option(3, 41, 141, childend, 50);
  child15: |
    float_msg(self_obj, message_str(41, 142), 7);
    call childend;
  child16: |
    float_msg(self_obj, message_str(41, 143), 7);
    call childcbt;
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
childrn1:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 16) then begin
          call map_exit_p_proc;
        end
      end
    end
  map_enter_p_proc: |
    call Lighting;
    set_global_var(77, 2);
    if (metarule(14, 0)) then begin
      display_msg(message_str(194, 110));
    end
    Player_Elevation := elevation(dude_obj);
    if (global_var(32) == 0) then begin
      override_map_start(100, 102, 0, 5);
    end
    else begin
      if (global_var(32) == 2) then begin
        override_map_start(100, 86, 0, 2);
      end
      else begin
        if (global_var(32) == 1) then begin
          override_map_start(99, 113, 1, 5);
        end
        else begin
          if (global_var(32) == 3) then begin
            override_map_start(96, 63, 1, 1);
          end
          else begin
            if (global_var(32) == 4) then begin
              override_map_start(85, 63, 1, 4);
            end
            else begin
              override_map_start(100, 102, 0, 5);
            end
          end
        end
      end
    end
    call add_party;
  map_update_p_proc: |
    call Lighting;
    if (elevation(dude_obj) == 1) then begin
      set_global_var(600, 1);
    end
    if (global_var(55) != 0) then begin
      cur_count := 240 - ((game_time / 10) - global_var(55));
      if (cur_count != prev_count) then begin
        display_msg(message_str(447, 100) + cur_count + message_str(447, 101));
        prev_count := cur_count;
      end
      if (((game_time / 10) - global_var(55)) > 240) then begin
        display_msg(message_str(444, 106));
        play_gmovie(4);
        metarule(13, 0);
      end
    end
  map_exit_p_proc: "[]"
  Lighting: |
    variable LVar0 := 0;
    LVar0 := game_time_hour;
    if ((LVar0 >= 600) and (LVar0 < 700)) then begin
      set_light_level(LVar0 - 600 + 40);
    end
    else begin
      if ((LVar0 >= 700) and (LVar0 < 1800)) then begin
        set_light_level(100);
      end
      else begin
        if ((LVar0 >= 1800) and (LVar0 < 1900)) then begin
          set_light_level(100 - (LVar0 - 1800));
        end
        else begin
          set_light_level(40);
        end
      end
    end
  add_party: |
    if (global_var(26) == 5) then begin
      if (Tandi_ptr == 0) then begin
      end
      critter_add_trait(Tandi_ptr, 1, 6, 0);
    end
childrn2:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 16) then begin
          call map_exit_p_proc;
        end
      end
    end
  map_enter_p_proc: |
    call Lighting;
    Player_Elevation := elevation(dude_obj);
    if (global_var(32) == 0) then begin
      override_map_start(101, 95, 0, 2);
    end
    else begin
      if (global_var(32) == 1) then begin
        override_map_start(101, 95, 1, 2);
      end
      else begin
        if (global_var(32) == 2) then begin
          override_map_start(94, 96, 2, 2);
        end
        else begin
          override_map_start(101, 95, 0, 2);
        end
      end
    end
    call add_party;
  map_update_p_proc: |
    call Lighting;
    if (global_var(55) != 0) then begin
      cur_count := 240 - ((game_time / 10) - global_var(55));
      if (cur_count != prev_count) then begin
        display_msg(message_str(447, 100) + cur_count + message_str(447, 101));
        prev_count := cur_count;
      end
      if (((game_time / 10) - global_var(55)) > 240) then begin
        display_msg(message_str(445, 106));
        play_gmovie(4);
        metarule(13, 0);
      end
    end
  map_exit_p_proc: "[]"
  Lighting: |
    variable LVar0 := 0;
    LVar0 := game_time_hour;
    if ((LVar0 >= 600) and (LVar0 < 700)) then begin
      set_light_level(LVar0 - 600 + 40);
    end
    else begin
      if ((LVar0 >= 700) and (LVar0 < 1800)) then begin
        set_light_level(100);
      end
      else begin
        if ((LVar0 >= 1800) and (LVar0 < 1900)) then begin
          set_light_level(100 - (LVar0 - 1800));
        end
        else begin
          set_light_level(40);
        end
      end
    end
  add_party: |
    if (global_var(26) == 5) then begin
      if (Tandi_ptr == 0) then begin
      end
      critter_add_trait(Tandi_ptr, 1, 6, 0);
    end
choctech:
  start: "[]"
  critter_p_proc: |
    if (GVar0) then begin
      GVar0 := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (GVar2) then begin
        critter_dmg(self_obj, random(200, 250), 6);
      end
      else begin
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
            if (not(GVar1)) then begin
              GVar1 := 1;
              if (Team9_Count > 0) then begin
                call ChocTech00;
              end
              else begin
                call ChocTech01;
              end
            end
          end
        end
        else begin
          GVar1 := 0;
        end
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(358, 100));
  talk_p_proc: |
    if (global_var(53) == 1) then begin
      start_gdialog(358, self_obj, 4, -1, -1);
      gsay_start;
      call ChocTech10;
      gsay_end;
      end_dialogue;
    end
    else begin
      if (global_var(54) == 1) then begin
        call ChocTech09;
      end
      else begin
        if (Team9_Count > 0) then begin
          start_gdialog(358, self_obj, 4, -1, -1);
          gsay_start;
          call ChocTech02;
          gsay_end;
          end_dialogue;
        end
        else begin
          call ChocTech01;
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    set_global_var(146, 1);
  map_enter_p_proc: |
    if (not(GVar3)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 69);
      GVar3 := 1;
    end
  ChocTech00: 'float_msg(self_obj, message_str(358, random(101, 104)), 0);

    '
  ChocTech01: 'float_msg(self_obj, message_str(358, random(105, 107)), 0);

    '
  ChocTech02: |
    gsay_reply(358, 108);
    giq_option(-3, 358, 109, ChocTech03, 0);
    giq_option(4, 358, 110, ChocTech04, 0);
    giq_option(4, 358, 111, combat, -10);
    giq_option(6, 358, 112, ChocTech02a, 0);
  ChocTech02a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call ChocTech06;
    end
    else begin
      call ChocTech05;
    end
  ChocTech03: 'gsay_message(358, 113, 0);

    '
  ChocTech04: 'gsay_message(358, 114, 0);

    '
  ChocTech05: |
    gsay_message(358, 115, 0);
    call combat;
  ChocTech06: |
    gsay_reply(358, 116);
    giq_option(5, 358, 117, combat, -10);
    giq_option(6, 358, 118, ChocTech06a, 0);
  ChocTech06a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call ChocTech07;
    end
    else begin
      call ChocTech05;
    end
  ChocTech07: |
    gsay_reply(358, 119);
    giq_option(6, 358, 120, ChocTechend, 0);
    giq_option(6, 358, 121, ChocTech08, 0);
    giq_option(6, 358, 122, ChocTech05, 0);
  ChocTech08: |
    gsay_reply(358, 123);
    giq_option(6, 358, 124, ChocTech05, 0);
  ChocTech09: |
    float_msg(self_obj, message_str(358, 125), 0);
    GVar2 := 1;
  ChocTech10: |
    gsay_reply(358, 126);
    giq_option(-3, 358, 127, ChocTech11, 0);
    giq_option(4, 358, 128, ChocTech11, 0);
    giq_option(4, 358, 129, combat, -10);
  ChocTech11: |
    gsay_message(358, 130, 0);
    GVar2 := 1;
  combat: 'GVar0 := 1;

    '
  ChocTechend: "[]"
chuck:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4)) then begin
      display_msg(message_str(664, 101));
    end
    else begin
      display_msg(message_str(664, 100));
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(251, 1);
      critter_add_trait(self_obj, 1, 6, 49);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(251, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
      critter_add_trait(self_obj, 1, 6, 49);
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(664, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4)) then begin
      call Chuck22;
    end
    else begin
      call Chuck01;
    end
    gsay_end;
    end_dialogue;
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(251) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  pickup_p_proc: 'set_global_var(251, 1);

    '
  map_enter_p_proc: |
    variable LVar0 := 0;
    if (not(initialized)) then begin
      if (obj_is_carrying_obj_pid(self_obj, 41) == 0) then begin
        LVar0 := create_object_sid(41, 0, 0, -1);
        add_mult_objs_to_inven(self_obj, LVar0, random(0, 20));
        if ((global_var(613) == 9103) or (global_var(613) == 9102)) then begin
          critter_add_trait(self_obj, 1, 6, 0);
        end
        else begin
          critter_add_trait(self_obj, 1, 6, 49);
        end
      end
      initialized := 1;
    end
  Chuck01: |
    set_local_var(4, 1);
    gsay_reply(664, 102);
    giq_option(-3, 664, 103, Chuck02, 50);
    giq_option(4, 664, 104, Chuck03, 50);
    giq_option(4, 664, 105, Chuck04, 50);
    giq_option(6, 664, 106, Chuck05, 50);
  Chuck02: 'gsay_message(664, 107, 50);

    '
  Chuck03: |
    gsay_reply(664, 108);
    giq_option(4, 664, 109, Chuck09, 50);
    giq_option(4, 664, 110, Chuck14, 50);
    giq_option(6, 664, 111, Chuck15, 49);
  Chuck04: |
    gsay_reply(664, 112);
    giq_option(4, 664, 113, Chuck14, 50);
    giq_option(4, 664, 114, Chuck18, 50);
    giq_option(4, 664, 115, ChuckBye, 50);
  Chuck05: |
    gsay_reply(664, 117);
    giq_option(4, 664, 118, ChuckBye, 50);
    if (local_var(5) < 4) then begin
      giq_option(4, 664, 119, ChuckCards, 50);
    end
  Chuck06: |
    call DownReact;
    gsay_reply(664, 128);
    giq_option(4, 664, 129, Chuck07, 51);
    giq_option(4, 664, 130, Chuck08, 50);
  Chuck07: |
    call DownReact;
    set_local_var(5, 4);
    gsay_message(664, 131, 51);
  Chuck08: |
    call UpReact;
    gsay_message(664, 132, 50);
  Chuck09: |
    gsay_reply(664, 133);
    giq_option(4, 664, 134, ChuckBye, 50);
    giq_option(4, 664, 135, Chuck10, 50);
    giq_option(6, 664, 136, Chuck19, 50);
  Chuck10: |
    gsay_reply(664, 137);
    giq_option(4, 664, 138, ChuckBye, 50);
    giq_option(4, 664, 139, Chuck11, 50);
  Chuck11: |
    gsay_reply(664, 140);
    giq_option(4, 664, 134, ChuckBye, 50);
    giq_option(4, 664, 141, Chuck12, 51);
    giq_option(4, 664, 142, Chuck13, 50);
  Chuck12: |
    gsay_reply(664, 143);
    giq_option(4, 664, 144, Chuck07, 51);
    giq_option(5, 664, 145, UpReact, 50);
    giq_option(4, 664, 146, ChuckBye, 50);
  Chuck13: |
    gsay_reply(664, 147);
    if (local_var(5) < 4) then begin
      giq_option(4, 664, 148, ChuckCards, 49);
    end
    giq_option(4, 664, 144, Chuck07, 51);
  Chuck14: |
    gsay_reply(664, 149);
    giq_option(4, 664, 150, ChuckEnd, 50);
    giq_option(4, 664, 151, Chuck10, 50);
  Chuck15: |
    gsay_reply(664, 152);
    giq_option(4, 664, 153, ChuckBye, 50);
    giq_option(4, 664, 150, ChuckEnd, 50);
    giq_option(6, 664, 154, Chuck16, 50);
  Chuck16: |
    gsay_reply(664, 155);
    giq_option(4, 664, 156, ChuckBye, 50);
    giq_option(6, 664, 157, Chuck17, 50);
  Chuck17: |
    gsay_reply(664, 158);
    giq_option(4, 664, 159, ChuckBye, 50);
    giq_option(4, 664, 150, DownReact, 51);
  Chuck18: |
    set_local_var(6, 1);
    gsay_reply(664, 160);
    giq_option(4, 664, 146, ChuckBye, 50);
    if (local_var(5) < 4) then begin
      giq_option(4, 664, 161, ChuckCards, 50);
    end
  Chuck19: |
    gsay_reply(664, 162);
    giq_option(4, 664, 146, ChuckBye, 50);
    giq_option(6, 664, 163, Chuck20, 50);
    giq_option(6, 664, 164, Chuck21, 50);
  Chuck20: |
    gsay_reply(664, 165);
    giq_option(4, 664, 146, ChuckBye, 50);
    giq_option(6, 664, 164, Chuck21, 50);
  Chuck21: |
    gsay_reply(664, 166);
    giq_option(0, 664, 125, ChuckBye, 50);
  Chuck22: |
    gsay_reply(664, random(167, 169));
    giq_option(-3, 664, 103, Chuck02, 50);
    giq_option(4, 664, 170, Chuck23, 50);
    if (local_var(5) < 4) then begin
      giq_option(4, 664, 171, ChuckCards, 50);
    end
    if (local_var(6) == 0) then begin
      giq_option(4, 664, 172, Chuck18, 50);
    end
  Chuck23: |
    gsay_reply(664, 173);
    giq_option(0, 664, 125, ChuckBye, 50);
  ChuckCards: |
    gsay_reply(664, 120);
    giq_option(0, 664, 125, ChuckCards2, 50);
  ChuckCards2: |
    if (local_var(5) == 0) then begin
      if (global_var(74) < 1) then begin
        gsay_reply(664, 121);
      end
      else begin
        set_local_var(5, 1);
      end
    end
    if (local_var(5) == 1) then begin
      if (global_var(78) < 1) then begin
        gsay_reply(664, 122);
      end
      else begin
        set_local_var(5, 2);
      end
    end
    if (local_var(5) == 2) then begin
      if (global_var(79) < 1) then begin
        gsay_reply(664, 123);
      end
      else begin
        set_local_var(5, 3);
      end
    end
    if (local_var(5) >= 3) then begin
      gsay_reply(664, 124);
      set_critter_stat(dude_obj, 6, 1);
    end
    set_local_var(5, local_var(5) + 1);
    giq_option(4, 664, 126, ChuckBye, 50);
    giq_option(4, 664, 127, Chuck06, 50);
  ChuckBye: 'gsay_message(664, 116, 50);

    '
  ChuckEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
cindy:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(6) == 1) then begin
        if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
          call flee_dude;
        end
        else begin
          if (tile_distance(tile_num(dude_obj), home_tile) > 3) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
        end
      end
      else begin
        if (global_var(101) == 0) then begin
          if (local_var(7) == 0) then begin
            if ((elevation(self_obj) == elevation(WtrGrd_ptr)) and (elevation(self_obj) == elevation(dude_obj))) then begin
              if ((game_time_hour > 700) and (game_time_hour < 900)) then begin
                call get_rations;
              end
            end
          end
        end
        if (not((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
          set_local_var(7, 0);
        end
        if (sleeping_disabled == 0) then begin
          call sleeping;
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(6, 1);
    end
  description_p_proc: |
    if (local_var(4)) then begin
      display_msg(message_str(168, 101));
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    if (source_obj == dude_obj) then begin
      set_global_var(261, 1);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(168, 100));
  map_enter_p_proc: |
    sleep_tile := 24883;
    home_tile := 24687;
    sleep_time := random(1900, 1930);
    wake_time := random(600, 630);
    critter_add_trait(self_obj, 1, 6, 1);
  pickup_p_proc: |
    if ((game_time / (10 * 60 * 60 * 24)) >= 30) then begin
      float_msg(self_obj, message_str(168, 122), 2);
    end
    hostile := 1;
  talk_p_proc: |
    if (not(local_var(4))) then begin
      if ((global_var(261) == 1) or (local_var(6) == 1)) then begin
        float_msg(self_obj, message_str(168, 125), 0);
        set_local_var(4, 1);
      end
      else begin
        if (global_var(101) == 2) then begin
          float_msg(self_obj, message_str(168, 123), 0);
        end
        else begin
          if (global_var(188) == 2) then begin
            float_msg(self_obj, message_str(168, 124), 0);
          end
          else begin
            start_gdialog(168, self_obj, 4, -1, -1);
            gsay_start;
            call Cindy01;
            gsay_end;
            end_dialogue;
          end
        end
      end
    end
  Cindy01: |
    gsay_reply(168, message_str(168, 102) + proto_data(obj_pid(dude_obj), 1) + message_str(168, 103));
    giq_option(4, 168, 104, Cindy03, 50);
    giq_option(4, 168, 105, Cindy04, 50);
    giq_option(-3, 168, 106, Cindy02, 50);
  Cindy02: |
    set_local_var(4, 1);
    gsay_reply(168, 107);
    giq_option(-3, 168, 108, CindyEnd, 50);
  Cindy03: 'gsay_message(168, random(109, 111), 50);

    '
  Cindy04: |
    if ((game_time / (10 * 60 * 60 * 24)) < 30) then begin
      gsay_reply(168, 126);
      giq_option(4, 168, 127, CindyEnd, 49);
      giq_option(4, 168, 128, CindyEnd, 51);
    end
    else begin
      gsay_reply(168, 113);
      giq_option(4, 168, 114, Cindy05, 50);
      giq_option(4, 168, 115, Cindy06, 50);
    end
  Cindy05: |
    gsay_reply(168, 116);
    giq_option(4, 168, 117, CindyEnd, 50);
  Cindy06: |
    gsay_reply(168, 118);
    giq_option(4, 168, 119, Cindy07, 50);
  Cindy07: |
    set_global_var(188, 1);
    gsay_reply(168, 120);
    giq_option(4, 168, 121, CindyEnd, 50);
    giq_option(4, 168, 112, Cindy05, 50);
  CindyEnd: "[]"
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
  get_rations: |
    if (tile_num(self_obj) != ration_tile) then begin
      sleeping_disabled := 1;
      if (random(0, 1)) then begin
        animate_move_obj_to_tile(self_obj, ration_tile, 0);
      end
      else begin
        animate_move_obj_to_tile(self_obj, ration_tile, 1);
      end
    end
    else begin
      if (not(recipient)) then begin
        recipient := self_obj;
        add_timer_event(self_obj, game_ticks(3), 1);
        set_local_var(7, 1);
        sleeping_disabled := 0;
      end
    end
  sleeping: |
    if (local_var(5) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(5, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(5, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(5, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(5, 1);
          end
        end
      end
    end
citizen:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 6);
      add_timer_event(self_obj, game_ticks(random(3, 5)), 1);
      initialized := 1;
    end
  combat_p_proc: |
    if (fixed_param == 4) then begin
      round_counter := round_counter + 1;
      if (round_counter > 3) then begin
        if (global_var(246) == 0) then begin
          set_global_var(246, 1);
          set_global_var(155, global_var(155) - 5);
        end
      end
    end
  critter_p_proc: |
    variable LVar0 := 0;
    if (hostile) then begin
      hostile := 1;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(4) and (tile_distance_objs(dude_obj, self_obj) < 8)) then begin
        call flee_dude;
      end
      LVar0 := global_var(343);
      if ((((game_time / 10) - LVar0) >= 10) and (tile_distance_objs(self_obj, dude_obj) <= 4) and (global_var(246) == 0)) then begin
        float_msg(self_obj, message_str(115, random(110, 114)), 0);
        LVar0 := game_time / 10;
        set_global_var(343, LVar0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(4, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(115, 100));
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (local_var(4) or global_var(246)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 0);
    end
    else begin
      start_gdialog(115, self_obj, 4, -1, -1);
      gsay_start;
      call Citizen01;
      gsay_end;
      end_dialogue;
    end
  timed_event_p_proc: |
    if (obj_on_screen(self_obj)) then begin
      animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), random(0, 5), random(1, 5)), 0);
    end
    add_timer_event(self_obj, game_ticks(random(3, 5)), 1);
  Citizen01: |
    DisplayMessage := 105;
    gsay_reply(115, 101);
    giq_option(4, 115, 103, Citizen02, 50);
    giq_option(4, 115, 102, CitizenEnd, 50);
    giq_option(-3, 115, 104, CitizenEnd, 50);
  Citizen02: |
    gsay_reply(115, DisplayMessage);
    giq_option(4, 115, 106, Citizen03, 50);
    giq_option(4, 115, 107, Citizen04, 50);
    call Goodbyes;
    giq_option(1, 115, exit_line, CitizenEnd, 50);
  Citizen03: |
    DisplayMessage := 108;
    call Citizen02;
  Citizen04: |
    DisplayMessage := 109;
    call Citizen02;
  CitizenEnd: "[]"
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
cleo:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (map_var(1) == 1) then begin
      call Cleo01;
    end
    else begin
      if (global_var(107) != 2) then begin
        start_gdialog(560, self_obj, 4, -1, -1);
        gsay_start;
        call Cleo02;
        gsay_end;
        end_dialogue;
      end
      else begin
        start_gdialog(560, self_obj, 4, -1, -1);
        gsay_start;
        call Cleo03;
        gsay_end;
        end_dialogue;
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(560, 100));
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 39);
      critter_add_trait(self_obj, 1, 5, 52);
    end
  Cleo01: 'float_msg(self_obj, message_str(560, 103), 2);

    '
  Cleo02: |
    gsay_reply(560, 104);
    if (map_var(2) == 1) then begin
      giq_option(4, 560, 106, Cleo05, 50);
    end
    if (global_var(207) == 1) then begin
      giq_option(4, 560, 105, Cleo04, 50);
    end
    giq_option(4, 560, 107, Cleo06, 50);
    if (global_var(219) == 1) then begin
      giq_option(4, 560, 108, Cleo07, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 560, 109, Cleo08, 50);
    end
    giq_option(4, 560, 110, Cleo09, 50);
    giq_option(-3, 560, 111, Cleo10, 50);
  Cleo03: |
    gsay_reply(560, 112);
    if (global_var(207) == 1) then begin
      giq_option(4, 560, 113, Cleo11, 50);
    end
    if (map_var(2) == 1) then begin
      giq_option(4, 560, 114, Cleo05, 50);
    end
    giq_option(4, 560, 115, Cleo12, 50);
    if (global_var(219) == 1) then begin
      giq_option(4, 560, 116, Cleo13, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 560, 117, Cleo14, 50);
    end
    giq_option(4, 560, 119, Cleo09, 50);
    giq_option(-3, 560, 120, Cleo10, 50);
  Cleo04: |
    gsay_reply(560, 121);
    if (map_var(2) == 1) then begin
      giq_option(4, 560, 122, Cleo05, 50);
    end
    giq_option(4, 560, 123, Cleo06, 50);
    if (global_var(219) == 1) then begin
      giq_option(4, 560, 124, Cleo07, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 560, 125, Cleo08, 50);
    end
    giq_option(4, 560, 126, Cleo09, 50);
    giq_option(-3, 560, 127, Cleo10, 50);
  Cleo05: |
    gsay_reply(560, 128);
    if (global_var(207) == 1) then begin
      giq_option(4, 560, 129, Cleo04, 50);
    end
    giq_option(4, 560, 131, Cleo06, 50);
    if (global_var(219) == 1) then begin
      giq_option(4, 560, 132, Cleo07, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 560, 133, Cleo08, 50);
    end
    giq_option(4, 560, 134, Cleo09, 50);
    giq_option(-3, 560, 135, Cleo10, 50);
  Cleo06: |
    gsay_reply(560, 136);
    if (global_var(207) == 1) then begin
      giq_option(4, 560, 137, Cleo04, 50);
    end
    if (map_var(2) == 1) then begin
      giq_option(4, 560, 138, Cleo05, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 560, 139, Cleo07, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 560, 140, Cleo08, 50);
    end
    giq_option(4, 560, 141, Cleo09, 50);
    giq_option(-3, 560, 142, Cleo10, 50);
  Cleo07: |
    gsay_reply(560, 143);
    if (global_var(207) == 1) then begin
      giq_option(4, 560, 144, Cleo04, 50);
    end
    if (map_var(2) == 1) then begin
      giq_option(4, 560, 145, Cleo05, 50);
    end
    giq_option(4, 560, 146, Cleo06, 50);
    if (global_var(106) == 1) then begin
      giq_option(4, 560, 147, Cleo08, 50);
    end
    giq_option(4, 560, 148, Cleo09, 50);
    giq_option(-3, 560, 149, Cleo10, 50);
  Cleo08: |
    gsay_reply(560, 150);
    if (global_var(207) == 1) then begin
      giq_option(4, 560, 151, Cleo04, 50);
    end
    if (map_var(2) == 1) then begin
      giq_option(4, 560, 152, Cleo05, 50);
    end
    giq_option(4, 560, 153, Cleo06, 50);
    if (global_var(219) == 1) then begin
      giq_option(4, 560, 154, Cleo07, 50);
    end
    giq_option(4, 560, 155, Cleo09, 50);
    giq_option(-3, 560, 156, Cleo10, 50);
  Cleo09: 'gsay_message(560, 157, 50);

    '
  Cleo10: 'gsay_message(560, 158, 50);

    '
  Cleo11: |
    gsay_reply(560, 159);
    if (map_var(2) == 1) then begin
      giq_option(4, 560, 160, Cleo05, 50);
    end
    giq_option(4, 560, 161, Cleo12, 50);
    if (global_var(219) == 1) then begin
      giq_option(4, 560, 162, Cleo13, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 560, 163, Cleo14, 50);
    end
    giq_option(4, 560, 165, Cleo09, 50);
    giq_option(-3, 560, 166, Cleo10, 50);
  Cleo12: |
    gsay_reply(560, 167);
    if (global_var(207) == 1) then begin
      giq_option(4, 560, 168, Cleo11, 50);
    end
    if (map_var(2) == 1) then begin
      giq_option(4, 560, 169, Cleo05, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 560, 170, Cleo13, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 560, 171, Cleo14, 50);
    end
    giq_option(4, 560, 173, Cleo09, 50);
    giq_option(-3, 560, 174, Cleo10, 50);
  Cleo13: 'gsay_message(560, 175, 50);

    '
  Cleo14: |
    set_global_var(219, 1);
    gsay_reply(560, 176);
    giq_option(4, 560, 177, Cleo15, 50);
    giq_option(4, 560, 178, Cleo16, 50);
    giq_option(4, 560, 179, Cleo17, 50);
    giq_option(4, 560, 180, Cleo18, 50);
  Cleo15: 'gsay_message(560, 181, 50);

    '
  Cleo16: 'gsay_message(560, 182, 50);

    '
  Cleo17: |
    gsay_reply(560, 183);
    giq_option(4, 560, 184, Cleo20, 50);
    giq_option(4, 560, 185, Cleo20, 50);
    giq_option(4, 560, 186, Cleo21, 50);
    giq_option(4, 560, 187, Cleo22, 50);
  Cleo18: 'gsay_message(560, 188, 50);

    '
  Cleo20: 'gsay_message(560, 190, 50);

    '
  Cleo21: 'gsay_message(560, 191, 50);

    '
  Cleo22: 'gsay_message(560, 192, 50);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
codedisk:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(350, 100));
    end
    else begin
      if (script_action == 6) then begin
        script_overrides;
        if (local_var(0) == 1) then begin
          display_msg(message_str(350, 101));
        end
        else begin
          set_local_var(0, 1);
          display_msg(message_str(350, 102));
          set_global_var(167, 1);
          display_msg(message_str(766, 103) + "100" + message_str(766, 104));
          give_exp_points(100);
        end
      end
    end
coke:
  start: |
    if (script_action == 6) then begin
      call use_p_proc;
    end
  use_p_proc: |
    script_overrides;
    if (local_var(0) == 1) then begin
      call Coke00;
    end
    else begin
      call Coke01;
    end
  Coke00: 'display_msg(message_str(22, 100));

    '
  Coke01: |
    set_local_var(0, 1);
    if (is_success(do_check(dude_obj, 6, 0))) then begin
      display_msg(message_str(22, 101));
      caps := random(1, 6) + random(1, 6) + random(1, 6);
      item_caps_adjust(dude_obj, caps);
    end
command:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(432, 100));
    display_msg(message_str(432, 101));
    if (local_var(0) and not(local_var(2))) then begin
      call Command01;
    end
  use_p_proc: |
    variable LVar0 := 0;
    if (local_var(0) and not(local_var(1))) then begin
      script_overrides;
      LVar0 := roll_vs_skill(dude_obj, 16, 0);
      if (is_success(LVar0)) then begin
        display_msg(message_str(432, 109));
        set_local_var(1, 1);
        display_msg(message_str(432, 116));
        give_exp_points(800);
      end
      else begin
        display_msg(message_str(432, 110));
      end
      game_time_advance(game_ticks(1200));
    end
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 100) then begin
      if (not(global_var(610))) then begin
        script_overrides;
        if (is_success(roll_vs_skill(dude_obj, 13, 0))) then begin
          display_msg(message_str(432, 117));
          set_global_var(610, 1);
        end
        else begin
          display_msg(message_str(432, 118));
        end
        game_time_advance(game_ticks(600));
      end
    end
  use_skill_on_p_proc: |
    variable LVar0 := 0;
    if (action_being_used == 12) then begin
      script_overrides;
      LVar0 := roll_vs_skill(dude_obj, action_being_used, 0);
      if (not(local_var(0))) then begin
        if (is_success(LVar0)) then begin
          display_msg(message_str(432, 102));
          field_change := "on";
          call use_all_fields_on;
          set_local_var(0, 1);
        end
        else begin
          display_msg(message_str(432, 103));
        end
        game_time_advance(game_ticks(300));
      end
      else begin
        if (not(local_var(1))) then begin
          if (is_success(LVar0)) then begin
            display_msg(message_str(432, 104));
          end
          else begin
            display_msg(message_str(432, 105));
          end
          game_time_advance(game_ticks(300));
          call Command01;
        end
        else begin
          if (not(local_var(2))) then begin
            if (is_success(LVar0)) then begin
              display_msg(message_str(432, 106));
              field_change := "off";
              call use_all_fields_off;
            end
            else begin
              display_msg(message_str(432, 108));
            end
            game_time_advance(game_ticks(1800));
            set_local_var(2, 1);
          end
        end
      end
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      if (global_var(146)) then begin
        set_local_var(0, 1);
      end
      initialized := 1;
    end
  Command01: |
    stat_roll := do_check(dude_obj, 1, has_trait(0, dude_obj, 0));
    if (not(local_var(1))) then begin
      if (is_success(stat_roll)) then begin
        if (is_critical(stat_roll)) then begin
          display_msg(message_str(432, 111));
        end
        else begin
          display_msg(message_str(432, 112));
        end
      end
      else begin
        if (is_critical(stat_roll)) then begin
          display_msg(message_str(432, 113));
        end
        else begin
          display_msg(message_str(432, 114));
        end
      end
    end
    else begin
      display_msg(message_str(432, 115));
    end
  use_all_fields_on: |
    set_global_var(262, 1);
    set_map_var(16, 1);
    set_map_var(17, 1);
    set_map_var(18, 1);
    set_map_var(19, 1);
    set_map_var(20, 1);
    set_map_var(21, 1);
    set_map_var(22, 1);
    set_map_var(23, 1);
  use_all_fields_off: |
    set_global_var(262, 0);
    set_map_var(16, 0);
    set_map_var(17, 0);
    set_map_var(18, 0);
    set_map_var(19, 0);
    set_map_var(20, 0);
    set_map_var(21, 0);
    set_map_var(22, 0);
    set_map_var(23, 0);
computer:
  start: |
    if (script_action == 4) then begin
      script_overrides;
      call computer00;
    end
    else begin
      if (script_action == 21) then begin
        script_overrides;
        display_msg(message_str(23, 100));
      end
    end
  computer00: |
    if (has_skill(dude_obj, 12) > has_skill(dude_obj, 13)) then begin
      test := roll_vs_skill(dude_obj, 12, 0);
    end
    else begin
      test := roll_vs_skill(dude_obj, 13, 0);
    end
    if (is_success(test)) then begin
      display_msg(message_str(23, 101));
      if (is_critical(test)) then begin
        display_msg(message_str(23, 102));
      end
    end
    else begin
      display_msg(message_str(23, 103));
      if (is_critical(test)) then begin
        display_msg(message_str(23, 104));
        critter_dmg(dude_obj, 1, 0);
      end
    end
cook:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 6);
      initialized := 1;
    end
  combat_p_proc: |
    if (fixed_param == 4) then begin
      round_counter := round_counter + 1;
    end
    if (round_counter > 3) then begin
      if (global_var(246) == 0) then begin
        set_global_var(246, 1);
        set_global_var(155, global_var(155) - 5);
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(246) == 1) then begin
        hostile := 1;
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(1, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(114, 100));
  talk_p_proc: |
    if (global_var(246) or (local_var(1) == 1)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 0);
    end
    else begin
      if (is_success(do_check(dude_obj, 6, 0)) and (local_var(0) == 0) and (get_critter_stat(dude_obj, 4) >= 4)) then begin
        start_gdialog(114, self_obj, 4, -1, -1);
        gsay_start;
        gsay_reply(114, 101);
        gsay_option(114, 102, Cook01, 50);
        gsay_end;
        end_dialogue;
      end
      else begin
        float_msg(self_obj, message_str(114, 103), 8);
      end
      set_local_var(0, 1);
    end
  pickup_p_proc: 'set_local_var(1, 1);

    '
  Cook01: |
    set_global_var(155, global_var(155) + 1);
    gsay_message(114, 104, 50);
cookshel:
  start: |
    if (script_action == 4) then begin
      call pickup_p_proc;
    end
    else begin
      if ((script_action == 3) or (script_action == 21)) then begin
        call look_at_p_proc;
      end
    end
  pickup_p_proc: |
    script_overrides;
    display_msg(message_str(125, 101));
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(125, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(125, 100));
cooktabl:
  start: |
    if (script_action == 4) then begin
      call pickup_p_proc;
    end
    else begin
      if ((script_action == 3) or (script_action == 21)) then begin
        call look_at_p_proc;
      end
    end
  pickup_p_proc: |
    script_overrides;
    display_msg(message_str(126, 101));
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(126, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(126, 100));
corecomp:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(133, 100));
  use_p_proc: |
    script_overrides;
    display_msg(message_str(793, 100));
  use_skill_on_p_proc: |
    if (action_being_used == 12) then begin
      script_overrides;
      if (is_success(roll_vs_skill(dude_obj, action_being_used, 0))) then begin
        if ((game_time / (10 * 60 * 60 * 24)) >= 90) then begin
          display_msg(message_str(133, 101));
        end
        else begin
          display_msg(message_str(133, 102));
        end
      end
      else begin
        display_msg(message_str(133, 103));
      end
    end
cougar:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(35, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (fetch_dude) then begin
        hostile := 1;
        fetch_dude := 0;
      end
    end
    if (global_var(346) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  map_enter_p_proc: |
    if (global_var(15) == 1) then begin
      kill_critter(self_obj, 48);
    end
    critter_add_trait(self_obj, 1, 6, 19);
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (local_var(0)) then begin
      call Cougar04;
    end
    else begin
      start_gdialog(35, self_obj, 4, -1, -1);
      gsay_start;
      call Cougar00;
      gsay_end;
      end_dialogue;
    end
  destroy_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_carrying_pid_obj(self_obj, 1);
    if (LVar0) then begin
      rm_obj_from_inven(self_obj, LVar0);
      destroy_object(LVar0);
    end
    if (source_obj == dude_obj) then begin
      set_global_var(346, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(346, 1);
    end
  Cougar00: |
    set_local_var(0, 1);
    gsay_reply(35, 101);
    giq_option(4, 35, 102, Cougar01, 50);
    giq_option(5, 35, 103, Cougar02, 50);
    giq_option(-3, 35, 104, Cougar03, 50);
  Cougar01: |
    gsay_reply(35, 105);
    giq_option(4, 35, 106, Cougar02, 50);
  Cougar02: 'gsay_message(35, 107, 50);

    '
  Cougar03: 'gsay_message(35, 108, 50);

    '
  Cougar04: 'float_msg(self_obj, message_str(35, 109), 50);

    '
cover:
  start: |
    variable LVar0 := 0;
    if (script_action == 6) then begin
      script_overrides;
      call do_stuff;
    end
  do_stuff: |
    OPEN := map_var(local_var(0));
    if (OPEN == 1) then begin
      call cover00;
    end
    else begin
      call cover01;
    end
  coverend: "[]"
  cover00: |
    set_map_var(local_var(0), 0);
    display_msg(message_str(18, 100));
    dude_tile := tile_num(dude_obj);
  cover01: |
    bonus := 3 - local_var(0);
    testa := do_check(dude_obj, 0, bonus);
    call cover01a;
  cover01a: |
    if (is_success(testa)) then begin
      set_local_var(0, 0);
      set_map_var(local_var(0), 1);
      display_msg(message_str(18, 101));
    end
    else begin
      set_local_var(0, local_var(0) + 1);
      if (is_critical(testa)) then begin
        display_msg(message_str(18, 102));
        damage := random(1, 6) - 4;
        if (damage < 1) then begin
          damage := 1;
        end
        critter_dmg(dude_obj, damage, 0);
      end
      else begin
        display_msg(message_str(18, 103));
      end
    end
cow:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 5, 3);
      critter_add_trait(self_obj, 1, 6, 4);
      add_timer_event(self_obj, game_ticks(random(1, 5)), 1);
      initialized := 1;
    end
    else begin
      if (script_action == 22) then begin
        call timed_event_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 7) then begin
            call use_obj_on_p_proc;
          end
          else begin
            if (script_action == 8) then begin
              call use_skill_on_p_proc;
            end
            else begin
              if (script_action == 3) then begin
                display_msg(message_str(5, 103));
              end
            end
          end
        end
      end
    end
  talk_p_proc: |
    if ((moo_counter == 1) and (cur_map_index == 53)) then begin
      float_msg(self_obj, message_str(5, 102), 0);
    end
    else begin
      float_msg(self_obj, message_str(5, random(100, 101)), 0);
    end
    moo_counter := moo_counter + 1;
    if (moo_counter > 2) then begin
      moo_counter := 0;
    end
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    if ((obj_pid(obj_being_used_with) == 124) or (obj_pid(obj_being_used_with) == 125)) then begin
      script_overrides;
      LVar0 := obj_being_used_with;
      rm_obj_from_inven(source_obj, obj_being_used_with);
      destroy_object(LVar0);
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_animate(self_obj, 14, -1);
      reg_anim_animate(self_obj, 20, 5);
      reg_anim_animate(self_obj, 48, -1);
      reg_anim_func(3, 0);
      critter_injure(self_obj, 2);
    end
  use_skill_on_p_proc: |
    if (action_being_used == 12) then begin
      script_overrides;
      if (is_success(roll_vs_skill(dude_obj, action_being_used, 0))) then begin
        display_msg(message_str(5, 104));
      end
      else begin
        display_msg(message_str(5, 105));
      end
    end
  timed_event_p_proc: |
    if (((critter_state(self_obj) bwand 2) == 0) and not(combat_is_initialized)) then begin
      critter_tile := tile_num_in_direction(tile_num(self_obj), random(0, 5), 3);
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_obj_move_to_tile(self_obj, critter_tile, -1);
      reg_anim_func(3, 0);
    end
    if (random(0, 1)) then begin
      call talk_p_proc;
    end
    add_timer_event(self_obj, game_ticks(random(3, 5)), 1);
crashbox:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(852, 101));
  look_at_p_proc: 'display_msg(message_str(852, 100));

    '
  use_p_proc: |
    if (global_var(168) < (game_time / (10 * 60 * 60 * 24))) then begin
      messing_with_fridge := 1;
    end
  use_skill_on_p_proc: |
    if (action_being_used == 10) then begin
      if (not(is_success(roll_vs_skill(source_obj, action_being_used, 0)))) then begin
        if (global_var(168) < (game_time / (10 * 60 * 60 * 24))) then begin
          messing_with_fridge := 1;
        end
      end
    end
crashrm:
  start: "[]"
  spatial_p_proc: |
    if ((source_obj == dude_obj) and (global_var(168) > (game_time / (10 * 60 * 60 * 24)))) then begin
      dialogue_system_enter;
    end
  talk_p_proc: |
    start_gdialog(807, self_obj, 4, -1, -1);
    gsay_start;
    gsay_reply(807, 100);
    giq_option(0, 807, 101, CrashRm01, 50);
    giq_option(0, 807, 102, CrashRmEnd, 50);
    gsay_end;
    end_dialogue;
    if (local_var(0) == 1) then begin
      call CrashRm02;
    end
  CrashRm01: 'set_local_var(0, 1);

    '
  CrashRm02: |
    set_local_var(0, 0);
    gfade_out(600);
    game_time_advance(game_ticks(60 * (60 - (game_time_hour % 100))));
    if (game_time_hour < 1000) then begin
      game_time_advance(game_ticks(36 * (1000 - game_time_hour)));
    end
    else begin
      game_time_advance(game_ticks(36 * (3400 - game_time_hour)));
    end
    critter_heal(dude_obj, random(10, 15));
    display_msg(message_str(807, 103));
    if ((map_var(3) == 0) and (map_var(0) != 2)) then begin
      JTRaider_ptr := create_object_sid(16777291, 17484, 0, 337);
      move_to(Sinthia_ptr, 17485, 0);
      anim(JTRaider_ptr, 1000, 3);
      anim(Sinthia_ptr, 1000, 3);
      item := create_object_sid(8, 0, 0, -1);
      add_obj_to_inven(JTRaider_ptr, item);
      wield_obj_critter(JTRaider_ptr, item);
      item := create_object_sid(1, 0, 0, -1);
      add_obj_to_inven(JTRaider_ptr, item);
      wield_obj_critter(JTRaider_ptr, item);
      set_map_var(3, 1);
    end
    gfade_in(600);
  CrashRmEnd: "[]"
creddoor:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 6) then begin
        call use_p_proc;
      end
      else begin
        if (script_action == 8) then begin
          call use_skill_on_p_proc;
        end
        else begin
          if (script_action == 7) then begin
            call use_obj_on_p_proc;
          end
          else begin
            if (script_action == 14) then begin
              call damage_p_proc;
            end
            else begin
              if (script_action == 23) then begin
                call map_update_p_proc;
              end
            end
          end
        end
      end
    end
  use_p_proc: |
    if (source_obj == Laura_Ptr) then begin
      set_local_var(0, 1);
    end
    if (local_var(0) == 0) then begin
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
    if ((local_var(0) == 0) and (source_obj == dude_obj)) then begin
      script_overrides;
      display_msg(message_str(63, 104));
    end
  use_skill_on_p_proc: |
    variable LVar0 := 0;
    if (local_var(0) == 0) then begin
      if (action_being_used == 9) then begin
        script_overrides;
        LVar0 := roll_vs_skill(dude_obj, 9, -60);
        if (is_success(LVar0)) then begin
          set_local_var(0, 1);
          display_msg(message_str(63, 100));
          display_msg(message_str(766, 103) + "85" + message_str(766, 104));
          give_exp_points(85);
        end
        else begin
          if (is_critical(LVar0)) then begin
            jam_lock(self_obj);
            display_msg(message_str(63, 110));
          end
          else begin
            display_msg(message_str(63, 103));
          end
        end
      end
    end
    else begin
      display_msg(message_str(63, 109));
    end
  look_at_p_proc: |
    if (local_var(0) == 0) then begin
      script_overrides;
      display_msg(message_str(63, 104));
    end
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := obj_being_used_with;
    LVar1 := roll_vs_skill(dude_obj, 9, -40);
    if (obj_pid(LVar0) == 84) then begin
      script_overrides;
      if (is_success(LVar1)) then begin
        set_local_var(0, 1);
        display_msg(message_str(63, 100));
        display_msg(message_str(766, 103) + "85" + message_str(766, 104));
        give_exp_points(85);
      end
      else begin
        if (is_critical(LVar1)) then begin
          rm_obj_from_inven(dude_obj, LVar0);
          destroy_object(LVar0);
          jam_lock(self_obj);
          display_msg(message_str(63, 110));
          display_msg(message_str(63, 101));
        end
        else begin
          display_msg(message_str(63, 103));
        end
      end
    end
    else begin
      if ((obj_pid(LVar0) == 141) or (obj_pid(LVar0) == 142)) then begin
        script_overrides;
        set_local_var(0, 1);
        display_msg(message_str(63, 100));
      end
    end
  map_update_p_proc: |
    Red_Door_Ptr := self_obj;
    if (local_var(0) == 0) then begin
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
  damage_p_proc: |
    set_obj_visibility(self_obj, 1);
    set_local_var(1, 1);
crvnenmy:
  start: |
    if (Only_Once == 0) then begin
      call initialize_p_proc;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
      end
    end
  critter_p_proc: |
    if (Hostile and (elevation(self_obj) == elevation(dude_obj))) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    set_map_var(0, map_var(0) - 1);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  initialize_p_proc: |
    Only_Once := 1;
    critter_add_trait(self_obj, 1, 6, 86);
    critter_add_trait(self_obj, 1, 5, 1);
crvnteam:
  start: |
    if (Only_Once == 0) then begin
      call initialize_p_proc;
    end
    else begin
      if (script_action == 18) then begin
        call destroy_p_proc;
      end
      else begin
        if ((script_action == 11) and not(combat_is_initialized)) then begin
          if ((cur_map_index == 10) or (cur_map_index == 13) or (cur_map_index == 4) or (cur_map_index == 28)) then begin
            float_msg(self_obj, message_str(761, random(100, 104)), 0);
          end
          else begin
            float_msg(self_obj, message_str(761, random(105, 109)), 0);
          end
        end
      end
    end
  destroy_p_proc: |
    if (not((cur_map_index == 10) or (cur_map_index == 13) or (cur_map_index == 4) or (cur_map_index == 28))) then begin
      if (obj_pid(self_obj) == 16777420) then begin
        set_global_var(216, global_var(216) - 1);
      end
      else begin
        set_global_var(215, 0);
      end
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  initialize_p_proc: 'Only_Once := 1;

    '
curtis:
  start: "[]"
  combat_p_proc: |
    if (fixed_param == 4) then begin
      round_counter := round_counter + 1;
    end
    if (round_counter > 3) then begin
      if (global_var(246) == 0) then begin
        set_global_var(155, global_var(155) - 5);
        set_global_var(246, 1);
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(246) == 1) then begin
        hostile := 1;
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (local_var(5) == 1) then begin
      if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
        call flee_dude;
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(5, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(236, 100));
  map_enter_p_proc: |
    home_tile := 22713;
    wake_time := 615;
    sleep_time := 2115;
    sleep_tile := 27702;
    critter_add_trait(self_obj, 1, 6, 2);
    critter_add_trait(self_obj, 1, 5, 23);
    add_timer_event(self_obj, game_ticks(5), 1);
  pickup_p_proc: 'set_local_var(5, 1);

    '
  talk_p_proc: |
    if ((local_var(5) == 1) or (global_var(246) == 1)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      start_gdialog(236, self_obj, 4, -1, -1);
      gsay_start;
      if (local_var(3) == 1) then begin
        call Curtis02;
      end
      else begin
        call Curtis01;
      end
      gsay_end;
      end_dialogue;
    end
  timed_event_p_proc: |
    if (local_var(4) == 0) then begin
      if (random(0, 3) == 3) then begin
        anim(self_obj, 10, 0);
      end
      else begin
        call movement;
      end
    end
    add_timer_event(self_obj, game_ticks(random(3, 7)), 1);
  map_update_p_proc: |
    if ((game_time_hour >= 2200) or (game_time_hour < 600)) then begin
      animate_move_obj_to_tile(self_obj, 27499, 0);
    end
    else begin
      animate_move_obj_to_tile(self_obj, 22511, 0);
    end
  Curtis01: |
    gsay_reply(236, 101);
    giq_option(4, 236, 102, Curtis03, 50);
    giq_option(-3, 236, 103, CurtisEnd, 50);
  Curtis02: |
    gsay_reply(236, 104);
    giq_option(0, 634, 106, Curtis03, 50);
  Curtis03: |
    gsay_reply(236, 105);
    call Curtis03a;
  Curtis03a: |
    if (local_var(3) == 0) then begin
      giq_option(4, 236, 106, Curtis04, 50);
    end
    if (local_var(0) == 0) then begin
      giq_option(5, 236, 107, Curtis05, 50);
    end
    if (local_var(6) == 0) then begin
      giq_option(4, 236, 108, Curtis06, 50);
    end
    giq_option(4, 236, 109, CurtisEnd, 50);
  Curtis04: |
    gsay_reply(236, 110);
    set_local_var(3, 1);
    call Curtis03a;
  Curtis05: |
    set_local_var(0, 1);
    gsay_reply(236, 111);
    call Curtis03a;
  Curtis06: |
    gsay_reply(236, 112);
    giq_option(4, 236, 113, Curtis03, 50);
    if ((has_skill(dude_obj, 12) >= 40) and (local_var(6) == 0)) then begin
      giq_option(5, 236, 114, Curtis07, 50);
    end
  Curtis07: |
    gsay_reply(236, 115);
    giq_option(4, 236, 116, CurtisEnd, 50);
    giq_option(5, 236, 117, Curtis08, 50);
  Curtis08: |
    gsay_message(236, 118, 50);
    set_global_var(155, global_var(155) + 2);
    set_local_var(6, 1);
    give_exp_points(500);
    display_msg(message_str(236, 200));
  CurtisEnd: "[]"
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
  movement: |
    variable LVar0 := 0;
    LVar0 := random(0, 5);
    new_tile := tile_num_in_direction(tile_num(self_obj), LVar0, 1);
    if (tile_distance(home_tile, new_tile) < 6) then begin
      animate_move_obj_to_tile(self_obj, new_tile, 0);
    end
dan:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 62);
      critter_add_trait(self_obj, 1, 5, 50);
      Dan_ptr := self_obj;
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((game_time_hour >= 600) and (game_time_hour < 700)) then begin
      if (SetDayNight == 0) then begin
        add_timer_event(self_obj, game_ticks(30), 3);
        SetDayNight := 1;
      end
    end
    if (map_var(0) == 1) then begin
      if (WalkToTalker == 0) then begin
        reg_anim_func(2, self_obj);
        reg_anim_func(1, 1);
        reg_anim_obj_move_to_tile(self_obj, 13891, -1);
        reg_anim_func(3, 0);
        WalkToTalker := 1;
      end
    end
    if (tile_num(self_obj) == 13891) then begin
      if (map_var(0) == 1) then begin
        if (Talky == 0) then begin
          call Dan27;
          Talky := 1;
          add_timer_event(self_obj, game_ticks(60 * 2), 1);
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      call DanAtNight;
    end
    else begin
      if (local_var(4) == 1) then begin
        set_local_var(4, 2);
        if ((map_var(0) == 2) and (local_var(8) == 0)) then begin
          if (local_var(1) > 1) then begin
            start_gdialog(562, self_obj, 4, -1, -1);
            gsay_start;
            call Dan15;
            gsay_end;
            end_dialogue;
          end
          else begin
            call Dan28;
          end
        end
        else begin
          call Dan28;
        end
      end
      else begin
        if (local_var(4) == 2) then begin
          if ((map_var(0) == 2) and (local_var(8) == 0)) then begin
            if (local_var(1) == 1) then begin
              start_gdialog(562, self_obj, 4, -1, -1);
              gsay_start;
              call Dan16;
              gsay_end;
              end_dialogue;
            end
            else begin
              call Dan28;
            end
          end
          else begin
            call Dan28;
          end
        end
        else begin
          start_gdialog(562, self_obj, 4, -1, -1);
          gsay_start;
          call Dan00;
          gsay_end;
          end_dialogue;
          set_local_var(4, 1);
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    set_global_var(280, 1);
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(562, 100));
  timed_event_p_proc: |
    if ((game_time_hour >= 600) and (game_time_hour < 700) or ((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
      if (Sleeping == 1) then begin
        reg_anim_func(2, self_obj);
        reg_anim_func(1, 1);
        reg_anim_obj_move_to_tile(self_obj, 12871, -1);
        reg_anim_func(3, 0);
        add_timer_event(self_obj, game_ticks(60 * 25), 2);
        Sleeping := 0;
      end
      else begin
        if (fixed_param == 1) then begin
          call SendToStart;
        end
        else begin
          if (fixed_param == 2) then begin
            call SendToStreet;
          end
          else begin
            if (fixed_param == 3) then begin
              call SendToCattle1;
            end
            else begin
              if (fixed_param == 4) then begin
                call SendToCattle2;
              end
            end
          end
        end
      end
    end
    else begin
      call SendToSleep;
      if (fixed_param == 4) then begin
        if (tile_distance_objs(self_obj, dude_obj) <= 10) then begin
          float_msg(self_obj, message_str(562, 215), 2);
        end
      end
      else begin
        if (fixed_param == 5) then begin
          NightCount := 0;
          if (tile_distance_objs(self_obj, dude_obj) <= 10) then begin
            float_msg(self_obj, message_str(562, 216), 2);
            hostile := 1;
          end
        end
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  combat: 'hostile := 1;

    '
  Dan00: |
    gsay_reply(562, 102);
    giq_option(5, 562, 106, Dan11, 50);
    giq_option(4, 562, 107, Dan01, 50);
    if (map_var(0) == 2) then begin
      giq_option(4, 562, 108, Dan14, 50);
      set_local_var(8, 1);
    end
    giq_option(-3, 562, 109, Dan02, 50);
  Dan01: |
    gsay_reply(562, 110);
    giq_option(4, 562, 111, Dan03, 50);
    giq_option(4, 562, 112, Dan05, 50);
    giq_option(5, 562, 113, Dan11, 50);
    giq_option(4, 562, 114, DanEnd, 50);
  Dan02: 'gsay_message(562, 115, 51);

    '
  Dan03: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(562, 118);
    end
    else begin
      gsay_reply(562, 119);
    end
    giq_option(4, 562, 120, Dan04, 51);
    giq_option(5, 562, 121, Dan11, 50);
    giq_option(4, 562, 122, DanEnd, 50);
  Dan04: |
    gsay_reply(562, 123);
    giq_option(4, 562, 124, Dan06, 51);
    giq_option(4, 562, 125, DanEnd, 50);
  Dan05: |
    gsay_reply(562, 126);
    giq_option(4, 562, 127, Dan06, 51);
    giq_option(4, 562, 128, DanEnd, 50);
  Dan06: |
    set_local_var(5, 1);
    gsay_reply(562, 129);
    giq_option(4, 562, 130, Dan07, 51);
    giq_option(4, 562, 131, Dan09, 50);
  Dan07: |
    gsay_reply(562, 132);
    giq_option(4, 562, 133, Dan10, 51);
    giq_option(4, 562, 134, Dan08, 50);
  Dan08: |
    gsay_reply(562, 135);
    giq_option(4, 562, 136, Dan09, 50);
    giq_option(4, 562, 137, Dan11, 50);
  Dan09: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(562, 138, 51);
    end
    else begin
      gsay_message(562, 139, 51);
    end
  Dan10: |
    gsay_message(562, 141, 51);
    call combat;
  Dan11: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(562, 142);
    end
    else begin
      gsay_reply(562, message_str(562, 142) + " " + message_str(562, 143));
    end
    giq_option(7, 562, 144, Dan12, 50);
    giq_option(4, 562, 145, Dan13, 50);
    giq_option(4, 562, 146, DanEnd, 50);
  Dan12: |
    gsay_reply(562, 147);
    giq_option(4, 562, 148, DanEnd, 50);
    giq_option(4, 562, 149, DanEnd, 50);
    giq_option(5, 562, 150, Dan13, 50);
  Dan13: 'gsay_message(562, 151, 50);

    '
  Dan14: |
    gsay_reply(562, 152);
    giq_option(4, 562, 153, Dan17, 50);
    giq_option(4, 562, 154, DanEnd, 50);
  Dan15: |
    gsay_reply(562, 155);
    giq_option(5, 562, 156, Dan11, 50);
    giq_option(4, 562, 157, Dan01, 50);
    if (map_var(0) == 2) then begin
      giq_option(4, 562, 158, Dan14, 50);
    end
    giq_option(4, 562, 159, DanEnd, 50);
    giq_option(-3, 562, 160, Dan02, 50);
  Dan16: |
    gsay_reply(562, 161);
    if (map_var(0) == 2) then begin
      giq_option(4, 562, 162, Dan14, 50);
    end
    giq_option(4, 562, 163, DanEnd, 50);
    giq_option(-3, 562, 164, Dan02, 50);
  Dan17: |
    gsay_reply(562, 168);
    giq_option(4, 562, 169, Dan19, 50);
    giq_option(4, 562, 170, Dan18, 50);
    giq_option(4, 562, 171, DanEnd, 50);
  Dan18: |
    gsay_reply(562, 172);
    giq_option(5, 562, 173, Dan19, 50);
    giq_option(4, 562, 174, DanEnd, 50);
  Dan19: |
    gsay_reply(562, 175);
    giq_option(4, 562, 176, Dan20, 51);
    giq_option(4, 562, 177, DanEnd, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 562, 178, Dan20, 51);
    end
    giq_option(4, 562, 179, Dan22, 50);
    giq_option(4, 562, 180, Dan23, 50);
  Dan20: |
    gsay_reply(562, 181);
    giq_option(4, 562, 182, Dan21, 51);
    giq_option(4, 562, 183, Dan21, 51);
    giq_option(4, 562, 184, Dan24, 50);
    giq_option(4, 562, 185, Dan25, 50);
  Dan21: |
    gsay_reply(562, 186);
    giq_option(4, 562, 187, DanEnd, 50);
    giq_option(4, 562, 188, DanEnd, 50);
    giq_option(4, 562, 189, DanEnd, 50);
  Dan22: |
    set_local_var(7, 1);
    set_map_var(1, 1);
    gsay_message(562, 190, 50);
  Dan23: 'gsay_message(562, 191, 50);

    '
  Dan24: |
    gsay_reply(562, 192);
    giq_option(4, 562, 193, DanEnd, 51);
    giq_option(4, 562, 194, DanEnd, 51);
    giq_option(4, 562, 195, DanEnd, 51);
  Dan25: 'gsay_message(562, 196, 50);

    '
  Dan27: |
    float_msg(self_obj, message_str(562, random(200, 203)), 2);
    set_map_var(0, 2);
  Dan28: 'float_msg(self_obj, message_str(562, random(208, 213)), 2);

    '
  DanAtNight: |
    if (NightCount == 0) then begin
      float_msg(self_obj, message_str(562, 214), 2);
      NightCount := 1;
      add_timer_event(self_obj, game_ticks(5), 4);
      add_timer_event(self_obj, game_ticks(10), 5);
    end
  SendToStart: |
    reg_anim_func(2, self_obj);
    reg_anim_func(1, 1);
    reg_anim_obj_move_to_tile(self_obj, 15522, -1);
    reg_anim_func(3, 0);
    add_timer_event(self_obj, game_ticks(60 * 12), 2);
  SendToStreet: |
    reg_anim_func(2, self_obj);
    reg_anim_func(1, 1);
    reg_anim_obj_move_to_tile(self_obj, 15295, -1);
    reg_anim_func(3, 0);
    add_timer_event(self_obj, game_ticks(60 * 2), 3);
  SendToCattle1: |
    reg_anim_func(2, self_obj);
    reg_anim_func(1, 1);
    reg_anim_obj_move_to_tile(self_obj, 12871, -1);
    reg_anim_func(3, 0);
    if (random(1, 10) >= 6) then begin
      add_timer_event(self_obj, game_ticks(60 * 3), 4);
    end
    else begin
      add_timer_event(self_obj, game_ticks(60 * 4), 1);
    end
  SendToCattle2: |
    reg_anim_func(2, self_obj);
    reg_anim_func(1, 1);
    reg_anim_obj_move_to_tile(self_obj, 12871, -1);
    reg_anim_func(3, 0);
    add_timer_event(self_obj, game_ticks(60 * 4), 1);
  SendToSleep: |
    if (Sleeping == 0) then begin
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_obj_move_to_tile(self_obj, 14932, -1);
      reg_anim_func(3, 0);
      SetDayNight := 0;
      Sleeping := 1;
    end
  DanEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
dane:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 69);
      Only_Once := 0;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(499, 100));
      end
      else begin
        if (script_action == 4) then begin
          hostile := 1;
        end
        else begin
          if (script_action == 18) then begin
            if (source_obj == dude_obj) then begin
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                set_global_var(156, 1);
                set_global_var(157, 0);
              end
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                set_global_var(157, 1);
                set_global_var(156, 0);
              end
              set_global_var(160, global_var(160) + 1);
              if ((global_var(160) % 6) == 0) then begin
                set_global_var(155, global_var(155) + 1);
              end
            end
          end
          else begin
            if (script_action == 12) then begin
              if (hostile) then begin
                hostile := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    start_gdialog(-1, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(6) == 0) then begin
      call dane00;
    end
    else begin
      if (local_var(7) == 0) then begin
        call dane01;
      end
      else begin
        if (local_var(8) == 0) then begin
          call dane02;
        end
        else begin
          if (local_var(9) == 0) then begin
            call dane03;
          end
          else begin
            if (local_var(10) == 0) then begin
              call dane04;
            end
            else begin
              if (local_var(11) == 0) then begin
                call dane05;
              end
              else begin
                if (local_var(12) == 0) then begin
                  call dane06;
                end
                else begin
                  if (local_var(13) == 0) then begin
                    call dane07;
                  end
                  else begin
                    if (local_var(14) == 0) then begin
                      call dane08;
                    end
                    else begin
                      if (local_var(15) == 0) then begin
                        call dane09;
                      end
                      else begin
                        if (local_var(16) == 0) then begin
                          call dane10;
                        end
                        else begin
                          if (local_var(17) == 0) then begin
                            call dane11;
                          end
                          else begin
                            if (local_var(18) == 0) then begin
                              call dane12;
                            end
                            else begin
                              if (local_var(19) == 0) then begin
                                call dane13;
                              end
                              else begin
                                if (local_var(20) == 0) then begin
                                  call dane14;
                                end
                                else begin
                                  if (local_var(21) == 0) then begin
                                    call dane15;
                                  end
                                  else begin
                                    if (local_var(22) == 0) then begin
                                      call dane16;
                                    end
                                    else begin
                                      if (local_var(23) == 0) then begin
                                        call dane17;
                                      end
                                      else begin
                                        if (local_var(24) == 0) then begin
                                          call dane18;
                                        end
                                        else begin
                                          if (local_var(25) == 0) then begin
                                            call dane19;
                                          end
                                          else begin
                                            if (local_var(26) == 0) then begin
                                              call dane20;
                                            end
                                            else begin
                                              if (local_var(5) == 1) then begin
                                                call dane24;
                                              end
                                            end
                                          end
                                        end
                                      end
                                    end
                                  end
                                end
                              end
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
  social_skills: |
    script_overrides;
    call get_reaction;
    call do_dialogue;
  dane00: |
    set_local_var(6, 1);
    gsay_message(499, 101, 50);
    gsay_message(499, 102, 50);
    gsay_message(499, 103, 50);
  dane01: |
    set_local_var(7, 1);
    gsay_message(499, 104, 50);
    gsay_message(499, 105, 50);
    gsay_message(499, 106, 50);
  dane02: |
    set_local_var(8, 1);
    gsay_message(499, 107, 50);
    gsay_message(499, 108, 50);
    gsay_message(499, 109, 50);
    gsay_message(499, 110, 50);
  dane03: |
    set_local_var(9, 1);
    gsay_message(499, 111, 50);
    gsay_message(499, 112, 50);
    gsay_message(499, 113, 50);
  dane04: |
    set_local_var(10, 1);
    gsay_message(499, 114, 50);
    gsay_message(499, 115, 50);
    gsay_message(499, 116, 50);
    gsay_message(499, 117, 50);
  dane05: |
    set_local_var(11, 1);
    gsay_message(499, 118, 50);
    gsay_message(499, 119, 50);
    gsay_message(499, 120, 50);
  dane06: |
    set_local_var(12, 1);
    gsay_message(499, 121, 50);
    gsay_message(499, 122, 50);
    gsay_message(499, 123, 50);
    gsay_message(499, 124, 50);
  dane07: |
    set_local_var(13, 1);
    gsay_message(499, 125, 50);
    gsay_message(499, 126, 50);
    gsay_message(499, 127, 50);
  dane08: |
    set_local_var(14, 1);
    gsay_message(499, 128, 50);
    gsay_message(499, 129, 50);
    gsay_message(499, 130, 50);
    gsay_message(499, 131, 50);
  dane09: |
    set_local_var(15, 1);
    gsay_message(499, 132, 50);
    gsay_message(499, 133, 50);
    gsay_message(499, 134, 50);
    gsay_message(499, 135, 50);
  dane10: |
    set_local_var(16, 1);
    gsay_message(499, 136, 50);
    gsay_message(499, 137, 50);
    gsay_message(499, 138, 50);
  dane11: |
    set_local_var(17, 1);
    gsay_message(499, 139, 50);
    gsay_message(499, 140, 50);
    gsay_message(499, 141, 50);
    gsay_message(499, 142, 50);
  dane12: |
    set_local_var(18, 1);
    gsay_message(499, 143, 50);
    gsay_message(499, 144, 50);
    gsay_message(499, 145, 50);
    gsay_message(499, 146, 50);
  dane13: |
    set_local_var(19, 1);
    gsay_message(499, 147, 50);
    gsay_message(499, 148, 50);
    gsay_message(499, 149, 50);
    gsay_message(499, 150, 50);
    gsay_message(499, 151, 50);
  dane14: |
    set_local_var(20, 1);
    gsay_message(499, 152, 50);
    gsay_message(499, 153, 50);
    gsay_message(499, 154, 50);
    gsay_message(499, 155, 50);
  dane15: |
    set_local_var(21, 1);
    gsay_message(499, 156, 50);
    gsay_message(499, 157, 50);
    gsay_message(499, 158, 50);
  dane16: |
    gsay_message(499, 159, 50);
    gsay_message(499, 160, 50);
    gsay_message(499, 161, 50);
    gsay_reply(499, 162);
    giq_option(7, 499, 163, dane17, 50);
    giq_option(7, 499, 164, dane18, 50);
    giq_option(4, 499, 165, dane19, 50);
    giq_option(4, 499, 166, dane20, 50);
    giq_option(4, 499, 167, dane21, 50);
    giq_option(4, 499, 168, dane22, 50);
    giq_option(-3, 499, 169, dane23, 50);
  dane17: |
    gsay_message(499, 170, 50);
    gsay_message(499, 171, 50);
    gsay_message(499, 172, 50);
    if (local_var(4) == 0) then begin
      set_local_var(4, 1);
      gsay_reply(499, 173);
      giq_option(7, 499, 174, dane18, 50);
      giq_option(4, 499, 175, dane19, 50);
      giq_option(4, 499, 176, dane20, 50);
      giq_option(4, 499, 177, dane21, 50);
      giq_option(4, 499, 178, dane22, 50);
    end
    else begin
      gsay_message(499, 179, 50);
    end
  dane18: |
    gsay_message(499, 180, 50);
    gsay_message(499, 181, 50);
    gsay_message(499, 182, 50);
    gsay_message(499, 183, 50);
    if (local_var(4) == 0) then begin
      set_local_var(4, 1);
      gsay_reply(499, 184);
      giq_option(7, 499, 185, dane18, 50);
      giq_option(4, 499, 186, dane19, 50);
      giq_option(4, 499, 187, dane20, 50);
      giq_option(4, 499, 188, dane21, 50);
      giq_option(4, 499, 189, dane22, 50);
    end
    else begin
      gsay_message(499, 190, 50);
    end
  dane19: |
    if (local_var(4) == 0) then begin
      set_local_var(4, 1);
      gsay_reply(499, 191);
      giq_option(7, 499, 192, dane18, 50);
      giq_option(4, 499, 193, dane19, 50);
      giq_option(4, 499, 194, dane20, 50);
      giq_option(4, 499, 195, dane21, 50);
      giq_option(4, 499, 196, dane22, 50);
    end
    else begin
      gsay_message(499, 197, 50);
    end
  dane20: |
    gsay_message(499, 198, 50);
    if (local_var(4) == 0) then begin
      set_local_var(4, 1);
      gsay_reply(499, 199);
      giq_option(7, 499, 200, dane19, 50);
      giq_option(7, 499, 201, dane18, 50);
      giq_option(4, 499, 202, dane19, 50);
      giq_option(4, 499, 203, dane21, 50);
      giq_option(4, 499, 204, dane22, 50);
      giq_option(-3, 499, 205, dane23, 50);
    end
    else begin
      gsay_message(499, 206, 50);
    end
  dane21: |
    gsay_message(499, 207, 50);
    if (local_var(4) == 0) then begin
      set_local_var(4, 1);
      gsay_reply(499, 208);
      giq_option(7, 499, 209, dane19, 50);
      giq_option(7, 499, 210, dane18, 50);
      giq_option(4, 499, 211, dane19, 50);
      giq_option(4, 499, 212, dane20, 50);
      giq_option(4, 499, 213, dane22, 50);
      giq_option(-3, 499, 214, dane23, 50);
    end
    else begin
      gsay_message(499, 215, 50);
    end
  dane22: |
    set_local_var(5, 1);
    gsay_message(499, 216, 50);
    gsay_message(499, 217, 50);
    gsay_message(499, 218, 50);
    gsay_message(499, 219, 50);
  dane23: |
    set_local_var(5, 1);
    gsay_message(499, 220, 50);
  dane24: 'gsay_message(499, 221, 50);

    '
  danemore: 'gsay_option(499, 222, danereturn, 50);

    '
  danereturn: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
danwife:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 62);
      critter_add_trait(self_obj, 1, 5, 51);
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((game_time_hour >= 600) and (game_time_hour < 700)) then begin
      if (SetDayNight == 0) then begin
        add_timer_event(self_obj, game_ticks(15), 1);
        SetDayNight := 1;
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (global_var(280) == 1) then begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        float_msg(self_obj, message_str(563, 103), 2);
      end
      else begin
        float_msg(self_obj, message_str(563, 104), 2);
      end
    end
    else begin
      float_msg(self_obj, message_str(563, random(101, 102)), 2);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (global_var(280) == 1) then begin
      display_msg(message_str(563, 105));
    end
    else begin
      display_msg(message_str(563, 100));
    end
  timed_event_p_proc: |
    if ((game_time_hour >= 600) and (game_time_hour < 700) or ((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
      Sleeping := 0;
      if (fixed_param == 1) then begin
        reg_anim_func(2, self_obj);
        reg_anim_func(1, 1);
        reg_anim_obj_move_to_tile(self_obj, 15330, -1);
        reg_anim_func(3, 0);
        add_timer_event(self_obj, game_ticks(30), 2);
      end
      else begin
        if (fixed_param == 2) then begin
          reg_anim_func(2, self_obj);
          reg_anim_func(1, 1);
          reg_anim_obj_move_to_tile(self_obj, 15122, -1);
          reg_anim_func(3, 0);
          add_timer_event(self_obj, game_ticks(60 * 1), 3);
        end
        else begin
          if (fixed_param == 3) then begin
            reg_anim_func(2, self_obj);
            reg_anim_func(1, 1);
            reg_anim_obj_move_to_tile(self_obj, 14930, -1);
            reg_anim_func(3, 0);
          end
        end
      end
    end
    else begin
      if (Sleeping == 0) then begin
        reg_anim_func(2, self_obj);
        reg_anim_func(1, 1);
        reg_anim_obj_move_to_tile(self_obj, 14930, -1);
        reg_anim_func(3, 0);
        Sleeping := 1;
        SetDayNight := 0;
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
darrel:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 64);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 14) then begin
        call damage_p_proc;
      end
      else begin
        if (script_action == 4) then begin
          call pickup_p_proc;
        end
        else begin
          if (script_action == 11) then begin
            call talk_p_proc;
          end
          else begin
            if (script_action == 12) then begin
              call critter_p_proc;
            end
            else begin
              if (script_action == 18) then begin
                call destroy_p_proc;
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    if (global_var(108) == 1) then begin
      start_gdialog(316, self_obj, 4, -1, -1);
      gsay_start;
      if (second) then begin
        call Darrel71;
      end
      else begin
        second := 1;
        call Darrel59;
      end
      gsay_end;
      end_dialogue;
    end
    else begin
      if (local_var(4) == 0) then begin
        start_gdialog(316, self_obj, 4, -1, -1);
        gsay_start;
        call Darrel01;
        gsay_end;
        end_dialogue;
      end
      else begin
        call Darrel16;
      end
    end
    set_local_var(4, 1);
  pre_dialogue: |
    if (local_var(4) == 0) then begin
      call do_dialogue;
    end
    else begin
      if (global_var(108) == 2) then begin
        call Darrel73;
      end
      else begin
        call do_dialogue;
      end
    end
  Darrel01: |
    gsay_reply(316, 102);
    giq_option(-3, 316, 103, Darrel02, 50);
    giq_option(4, 316, 104, Darrel03, 50);
    if (global_var(30) != 1) then begin
      giq_option(4, 316, 105, Darrel04, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 316, 106, Darrel75, 50);
    end
    giq_option(4, 316, 107, DarrelEnd, 50);
  Darrel02: |
    if (local_var(6) == 0) then begin
      gsay_reply(316, 108);
      giq_option(-3, 316, 300, Darrel02a, 50);
    end
    else begin
      gsay_message(316, 108, 50);
    end
  Darrel02a: |
    gsay_reply(316, 209);
    giq_option(-3, 316, 300, Darrel02b, 50);
  Darrel02b: |
    gsay_reply(316, 210);
    giq_option(-3, 316, 300, Darrel02c, 50);
  Darrel02c: |
    gsay_reply(316, 211);
    giq_option(-3, 316, 300, giveradx, 50);
  Darrel03: |
    gsay_reply(316, 110);
    giq_option(4, 316, 111, Darrel05, 50);
    giq_option(4, 316, 112, Darrel12, 50);
    giq_option(4, 316, 113, Darrel06, 50);
    giq_option(4, 316, 114, DarrelEnd, 50);
  Darrel04: |
    gsay_reply(316, 115);
    giq_option(4, 316, 116, Darrel07, 50);
    giq_option(4, 316, 201, DarrelEnd, 50);
    giq_option(4, 316, 118, Darrel11, 50);
  Darrel05: |
    gsay_reply(316, 119);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 316, 120, DarrelEnd, 50);
    end
    giq_option(4, 316, 121, Darrel08, 50);
    giq_option(4, 316, 122, Darrel09, 50);
  Darrel06: |
    gsay_reply(316, 123);
    giq_option(4, 316, 202, DarrelEnd, 50);
    giq_option(4, 316, 125, Darrel04, 50);
  Darrel07: |
    gsay_reply(316, 126);
    giq_option(4, 316, 202, DarrelEnd, 50);
    giq_option(4, 316, 127, Darrel03, 50);
  Darrel08: |
    gsay_reply(316, 128);
    giq_option(4, 316, 129, Darrel10, 50);
    giq_option(4, 316, 130, Darrel11, 50);
  Darrel09: |
    gsay_reply(316, 109);
    giq_option(4, 316, 129, Darrel10, 50);
    giq_option(4, 316, 130, Darrel11, 50);
  Darrel10: |
    gsay_reply(316, 131);
    giq_option(4, 316, 132, Darrel07, 50);
    giq_option(4, 316, 133, Darrel11, 50);
  Darrel11: 'gsay_message(316, 134, 50);

    '
  Darrel12: |
    gsay_reply(316, 135);
    giq_option(4, 316, 136, Darrel13, 50);
    giq_option(4, 316, 137, Darrel15, 50);
    giq_option(4, 316, 203, DarrelEnd, 50);
  Darrel13: |
    gsay_reply(316, 139);
    giq_option(4, 316, 140, Darrel14, 50);
    giq_option(4, 316, 132, Darrel07, 50);
    giq_option(4, 316, 204, DarrelEnd, 50);
  Darrel14: |
    gsay_reply(316, 143);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 316, 144, combat, 51);
    end
    giq_option(4, 316, 141, Darrel07, 50);
    giq_option(4, 316, 145, DarrelEnd, 50);
    giq_option(4, 316, 146, Darrel05, 50);
  Darrel15: |
    gsay_reply(316, 147);
    giq_option(4, 316, 148, Darrel14, 50);
    giq_option(4, 316, 149, Darrel07, 50);
    giq_option(4, 316, 203, DarrelEnd, 50);
  Darrel16: 'float_msg(self_obj, message_str(316, 151), 2);

    '
  Darrel58: |
    set_local_var(5, 1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      float_msg(self_obj, message_str(316, 152), 2);
    end
    else begin
      float_msg(self_obj, message_str(316, 153), 2);
    end
  Darrel59: |
    gsay_reply(316, 154);
    giq_option(4, 316, 155, Darrel60, 50);
    giq_option(4, 316, 156, Darrel61, 50);
    giq_option(4, 316, 157, Darrel62, 50);
    giq_option(4, 316, 158, DarrelEnd, 50);
    giq_option(-3, 316, 103, Darrel02, 50);
  Darrel60: |
    gsay_reply(316, 159);
    giq_option(4, 316, 160, Darrel63, 50);
    giq_option(4, 316, 161, Darrel63, 50);
    giq_option(4, 316, 162, Darrel64, 50);
    giq_option(4, 316, 163, Darrel61, 50);
  Darrel61: |
    gsay_reply(316, 164);
    giq_option(4, 316, 165, Darrel66, 50);
    giq_option(4, 316, 166, Darrel67, 50);
  Darrel62: 'gsay_message(316, 167, 50);

    '
  Darrel63: |
    gsay_reply(316, 168);
    giq_option(4, 316, 203, DarrelEnd, 50);
    giq_option(4, 316, 170, Darrel72, 50);
  Darrel64: |
    gsay_reply(316, 171);
    giq_option(4, 316, 205, DarrelEnd, 50);
    giq_option(4, 316, 170, Darrel69, 50);
  Darrel66: |
    gsay_reply(316, 174);
    giq_option(4, 316, 175, Darrel68, 50);
    giq_option(4, 316, 176, DarrelEnd, 50);
    giq_option(4, 316, 177, Darrel63, 50);
    giq_option(4, 316, 206, DarrelEnd, 50);
  Darrel67: |
    gsay_reply(316, 179);
    giq_option(4, 316, 180, Darrel64, 50);
    giq_option(4, 316, 203, DarrelEnd, 50);
  Darrel68: |
    gsay_reply(316, 181);
    giq_option(4, 316, 182, DarrelEnd, 50);
    giq_option(4, 316, 183, Darrel63, 50);
    giq_option(4, 316, 184, DarrelEnd, 50);
  Darrel69: |
    gsay_reply(316, 189);
    giq_option(4, 316, 203, DarrelEnd, 50);
    giq_option(4, 316, 190, Darrel72, 50);
  Darrel70: |
    gsay_reply(316, 168);
    giq_option(4, 316, 203, DarrelEnd, 50);
    giq_option(4, 316, 190, Darrel72, 50);
  Darrel71: |
    gsay_reply(316, 191);
    giq_option(4, 316, 188, Darrel72, 50);
    giq_option(4, 316, 192, DarrelEnd, 50);
    giq_option(-3, 316, 103, Darrel02, 50);
  Darrel72: |
    gsay_reply(316, 193);
    giq_option(4, 316, 186, Darrel69, 50);
    giq_option(4, 316, 187, Darrel70, 50);
    if (global_var(106) == 1) then begin
      giq_option(4, 316, 106, Darrel75, 50);
    end
    giq_option(4, 316, 207, DarrelEnd, 50);
  Darrel73: |
    ccount := ccount + 1;
    if (ccount < 6) then begin
      float_msg(self_obj, message_str(723, 200 + random(0, 2)), 2);
    end
    else begin
      if (ccount < 9) then begin
        float_msg(self_obj, message_str(723, 203 + random(0, 4)), 2);
      end
      else begin
        if (ccount < 12) then begin
          float_msg(self_obj, message_str(723, 209 + random(0, 3)), 2);
        end
        else begin
          display_msg(message_str(723, 213));
        end
      end
    end
  Darrel75: |
    gsay_reply(316, 195);
    giq_option(4, 316, 196, Darrel11, 50);
    giq_option(4, 316, 197, Darrel76, 50);
    giq_option(4, 316, 104, Darrel03, 50);
    giq_option(4, 316, 198, DarrelEnd, 50);
  Darrel76: |
    gsay_reply(316, 199);
    giq_option(4, 316, 104, Darrel03, 50);
    if (global_var(30) != 1) then begin
      giq_option(4, 316, 105, Darrel04, 50);
    end
    giq_option(4, 316, 208, DarrelEnd, 50);
  DarrelEnd: "[]"
  giveradx: |
    set_local_var(6, 1);
    radx := create_object_sid(109, 0, 0, -1);
    add_obj_to_inven(dude_obj, radx);
    gsay_reply(316, 212);
    giq_option(-3, 316, 300, DarrelEnd, 50);
  combat: 'hostile := 1;

    '
  damage_p_proc: 'set_global_var(250, 1);

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (local_var(5) == 0) then begin
      if (global_var(108) == 1) then begin
        call Darrel58;
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    if (global_var(108) == 5) then begin
      float_msg(self_obj, message_str(40, 233), 2);
    end
    else begin
      call pre_dialogue;
    end
  destroy_p_proc: |
    set_global_var(250, 1);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (known) then begin
      display_msg(message_str(316, 100));
    end
    else begin
      display_msg(message_str(316, 101));
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
dcmutant:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      anim(self_obj, 48, 0);
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 47);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
            else begin
              if (script_action == 8) then begin
                call use_skill_on_p_proc;
              end
              else begin
                if (script_action == 7) then begin
                  call use_obj_on_p_proc;
                end
                else begin
                  if (script_action == 13) then begin
                    call combat_p_proc;
                  end
                end
              end
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((local_var(5) == 0) and (((game_time / 10) - lastBabble) >= 10) and (tile_distance_objs(self_obj, dude_obj) <= 15)) then begin
      lastBabble := game_time / 10;
      float_msg(self_obj, message_str(848, random(111, 113)), 2);
    end
  combat_p_proc: 'script_overrides;

    '
  pickup_p_proc: "[]"
  talk_p_proc: |
    call get_reaction;
    if (local_var(5) == 1) then begin
      display_msg(message_str(848, 103));
    end
    else begin
      start_gdialog(848, self_obj, 4, -1, -1);
      gsay_start;
      call Mutant00;
      gsay_end;
      end_dialogue;
    end
    if (kill_me == 1) then begin
      kill_me := 0;
      kill_critter(self_obj, 48);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(5) == 0) then begin
      display_msg(message_str(848, 100));
    end
    else begin
      display_msg(message_str(848, 102));
    end
  use_skill_on_p_proc: |
    script_overrides;
    dialogue_system_enter;
  use_obj_on_p_proc: |
    script_overrides;
    dialogue_system_enter;
  Mutant00: |
    gsay_reply(848, 104);
    giq_option(4, 848, 105, Mutant01, 50);
  Mutant01: |
    variable LVar0 := 0;
    set_global_var(106, 2);
    gsay_reply(848, 106);
    LVar0 := obj_carrying_pid_obj(self_obj, 196);
    if (LVar0 != 0) then begin
      rm_obj_from_inven(self_obj, LVar0);
      add_obj_to_inven(dude_obj, LVar0);
    end
    giq_option(4, 848, 107, Mutant02, 50);
  Mutant02: |
    gsay_reply(848, 108);
    giq_option(4, 848, 109, Mutant03, 50);
  Mutant03: |
    set_local_var(5, 1);
    kill_me := 1;
    gsay_message(848, 110, 50);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
dead:
  start: |
    variable LVar0 := 0;
    if (script_action == 3) then begin
      script_overrides;
      if (success_level == 0) then begin
        success_level := do_check(dude_obj, 4, 0);
      end
      call dead00;
    end
    else begin
      if (script_action == 21) then begin
        script_overrides;
        display_msg(message_str(24, 100));
      end
    end
  dead00: |
    if (is_success(success_level)) then begin
      if (is_critical(success_level)) then begin
        display_msg(message_str(24, 101));
      end
      else begin
        display_msg(message_str(24, 102));
      end
    end
    else begin
      if (is_critical(success_level)) then begin
        display_msg(message_str(24, 103));
      end
      else begin
        display_msg(message_str(24, 104));
      end
    end
deadbro:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      rndx := random(1, 4);
      if (global_var(74) == 2) then begin
        if (rndx == 1) then begin
          display_msg(message_str(294, 100));
        end
        else begin
          if (rndx == 2) then begin
            display_msg(message_str(294, 101));
          end
          else begin
            if (rndx == 3) then begin
              display_msg(message_str(294, 102));
            end
            else begin
              if (rndx == 4) then begin
                display_msg(message_str(294, 103));
              end
            end
          end
        end
      end
      else begin
        if (rndx == 1) then begin
          display_msg(message_str(294, 104));
        end
        else begin
          if (rndx == 2) then begin
            display_msg(message_str(294, 105));
          end
          else begin
            if (rndx == 3) then begin
              display_msg(message_str(294, 106));
            end
          end
        end
      end
    end
deadcomp:
  start: |
    if (script_action == 6) then begin
      script_overrides;
      call do_stuff;
    end
  do_stuff: 'display_msg(message_str(62, 100));

    '
deadguy:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 41);
      critter_add_trait(self_obj, 1, 5, 51);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (local_var(4) == 1) then begin
      call Deadguy02;
    end
    else begin
      set_local_var(4, 1);
      start_gdialog(564, self_obj, 4, -1, -1);
      gsay_start;
      call Deadguy00;
      gsay_end;
      end_dialogue;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(564, 100));
  Deadguy00: |
    gsay_reply(564, 101);
    giq_option(4, 564, 102, Deadguy01, 51);
    if (local_var(5) == 0) then begin
      giq_option(4, 564, 103, Deadguy03, 50);
    end
    giq_option(4, 564, 104, Deadguy07, 50);
    giq_option(-3, 564, 105, Deadguy06, 50);
  Deadguy01: 'gsay_message(564, 106, 50);

    '
  Deadguy02: 'float_msg(self_obj, message_str(564, 107), 2);

    '
  Deadguy03: |
    set_local_var(5, 1);
    item_caps_adjust(dude_obj, 20);
    gsay_reply(564, 108);
    giq_option(4, 564, 109, DeadguyEnd, 50);
    giq_option(4, 564, 110, Deadguy04, 50);
  Deadguy04: |
    gsay_reply(564, 111);
    giq_option(4, 564, 112, Deadguy05, 50);
    giq_option(4, 564, 113, DeadguyEnd, 50);
  Deadguy05: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(564, 114, 50);
    end
    else begin
      gsay_message(564, 115, 50);
    end
  Deadguy06: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(564, 118, 50);
    end
    else begin
      gsay_message(564, 119, 50);
    end
  Deadguy07: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(564, 122);
    end
    else begin
      gsay_reply(564, 123);
    end
    giq_option(4, 564, 126, Deadguy08, 50);
    giq_option(4, 564, 127, combat, 50);
  Deadguy08: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(564, 128, 50);
    end
    else begin
      gsay_message(564, 129, 50);
    end
  DeadguyEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
dealer:
  start: |
    variable LVar0 := 0;
    if (not(initialized)) then begin
      if (metarule(14, 0)) then begin
        LVar0 := create_object_sid(41, 0, 0, -1);
        add_mult_objs_to_inven(self_obj, LVar0, random(0, 100));
        critter_add_trait(self_obj, 1, 6, 24);
        set_global_var(289, 0);
      end
      initialized := 1;
    end
    else begin
      if (script_action == 18) then begin
        call destroy_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  talk_p_proc: |
    if (global_var(289) == 1) then begin
      float_msg(self_obj, message_str(657, random(127, 130)), 0);
    end
    else begin
      start_gdialog(657, self_obj, 4, -1, -1);
      gsay_start;
      call Dealer00;
      gsay_end;
      end_dialogue;
    end
  critter_p_proc: |
    if (not(said_hi) and (tile_distance_objs(self_obj, dude_obj) <= 6)) then begin
      float_msg(self_obj, message_str(657, 131), 0);
      said_hi := 1;
    end
  Dealer00: |
    set_global_var(289, 1);
    gsay_reply(657, 100);
    giq_option(4, 657, 101, Dealer02, 50);
    giq_option(4, 657, 102, DealerEnd, 50);
    giq_option(-3, 657, 103, Dealer01, 50);
  Dealer01: 'gsay_message(657, 104, 50);

    '
  Dealer02: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(657, 105);
    end
    else begin
      gsay_reply(657, 106);
    end
    giq_option(4, 657, 107, Dealer03, 50);
    giq_option(4, 657, 108, DealerEnd, 50);
  Dealer03: |
    gsay_reply(657, 109);
    giq_option(4, 657, 110, Dealer04, 50);
    giq_option(4, 657, 111, Dealer08, 51);
    giq_option(4, 657, 112, DealerEnd, 50);
  Dealer04: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(657, 113);
    end
    else begin
      gsay_reply(657, 114);
    end
    giq_option(4, 657, 115, Dealer05, 50);
    giq_option(4, 657, 116, Dealer08, 51);
    giq_option(4, 657, 112, DealerEnd, 50);
  Dealer05: |
    gsay_reply(657, 117);
    giq_option(4, 657, 118, Dealer06, 50);
    giq_option(4, 657, 119, Dealer08, 51);
    giq_option(4, 657, 120, DealerEnd, 50);
  Dealer06: |
    gsay_reply(657, 121);
    giq_option(4, 657, 122, Dealer07, 49);
    giq_option(4, 657, 123, Dealer08, 51);
    giq_option(4, 657, 124, DealerEnd, 50);
  Dealer07: 'gsay_message(657, 125, 49);

    '
  Dealer08: 'gsay_message(657, 126, 51);

    '
  DealerEnd: "[]"
decker:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(42, 100));
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (travel == 1) then begin
      travel := 0;
      call DeckerTransport;
    end
    else begin
      if (tile_distance_objs(self_obj, dude_obj) <= 10) then begin
        dialogue_system_enter;
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    set_global_var(219, 1);
    call get_reaction;
    if ((map_var(49) == 1) or (map_var(45) != 1)) then begin
      if (map_var(52) == 0) then begin
        float_msg(self_obj, message_str(42, 230), 2);
        call combat;
      end
      else begin
        float_msg(self_obj, message_str(42, 231), 2);
        call combat;
      end
    end
    else begin
      set_map_var(45, 0);
      if (local_var(4) == 0) then begin
        set_local_var(4, 1);
        start_gdialog(42, self_obj, 4, 7, 3);
        gsay_start;
        call Decker01;
        gsay_end;
        end_dialogue;
      end
      else begin
        if (global_var(112) == 2) then begin
          start_gdialog(42, self_obj, 4, 7, 3);
          gsay_start;
          call Decker15;
          gsay_end;
          end_dialogue;
        end
        else begin
          if (global_var(111) == 2) then begin
            start_gdialog(42, self_obj, 4, 7, 3);
            gsay_start;
            call Decker26;
            gsay_end;
            end_dialogue;
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    set_map_var(50, 1);
    set_global_var(203, 1);
    if ((map_var(49) == 1) and (map_var(50) == 1)) then begin
      set_global_var(202, 1);
      set_map_var(11, 1);
      set_map_var(44, 1);
    end
    if (global_var(111) == 1) then begin
      set_global_var(111, 0);
    end
    if (global_var(112) == 1) then begin
      set_global_var(112, 0);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      Decker_Ptr := self_obj;
      if (map_var(50) == 1) then begin
        set_obj_visibility(self_obj, 1);
      end
      critter_add_trait(self_obj, 1, 6, 38);
      critter_add_trait(self_obj, 1, 5, 87);
    end
  PlayerQuestions: |
    giq_option(4, 42, 144, Decker17, 50);
    giq_option(4, 42, 145, Decker25, 50);
    giq_option(4, 42, 146, DeckerEndNormal, 50);
  Decker01: |
    gsay_reply(42, 103);
    giq_option(4, 42, message_str(42, 104) + proto_data(obj_pid(dude_obj), 1) + message_str(42, 105), Decker02, 50);
    giq_option(4, 42, 106, Decker13, 51);
  Decker02: |
    gsay_reply(42, 107);
    giq_option(4, 42, 108, Decker03, 50);
    giq_option(4, 42, 109, Decker14, 50);
  Decker03: |
    gsay_reply(42, 110);
    giq_option(4, 42, 111, Decker04, 50);
  Decker04: |
    gsay_reply(42, 112);
    giq_option(4, 42, 113, Decker05, 50);
    giq_option(4, 42, 114, Decker11, 50);
    giq_option(4, 42, 115, Decker10, 51);
  Decker05: |
    gsay_reply(42, 116);
    giq_option(4, 42, 117, Decker06, 50);
    giq_option(4, 42, 118, Decker10, 50);
    giq_option(4, 42, 119, Decker06, 50);
  Decker06: |
    gsay_reply(42, 120);
    giq_option(4, 42, 121, Decker07, 50);
  Decker07: |
    gsay_reply(42, 122);
    giq_option(4, 42, 123, Decker08, 50);
    giq_option(4, 42, 124, Decker09, 50);
    giq_option(4, 42, 125, Decker10, 50);
  Decker08: |
    gsay_message(42, 126, 50);
    call DeckerEndAcceptJob1;
  Decker09: |
    gsay_reply(42, 127);
    giq_option(4, 42, 128, Decker08, 50);
    giq_option(4, 42, 129, Decker10, 50);
  Decker10: |
    gsay_message(42, 130, 50);
    call DeckerEndDeclineJob1;
  Decker11: |
    gsay_reply(42, 131);
    giq_option(4, 42, 132, Decker10, 50);
    giq_option(4, 42, 133, Decker12, 50);
  Decker12: |
    gsay_message(42, 134, 50);
    call DeckerEndAcceptJob1;
  Decker13: |
    gsay_reply(42, 135);
    giq_option(4, 42, message_str(42, 136) + proto_data(obj_pid(dude_obj), 1) + message_str(42, 137), Decker02, 50);
    giq_option(4, 42, 138, Decker14, 50);
  Decker14: |
    gsay_message(42, 139, 51);
    call DeckerEndInsult;
  Decker15: |
    gsay_reply(42, 140);
    giq_option(4, 42, 141, Decker16, 50);
    giq_option(4, 42, 142, DeckerEndNormal, 50);
  Decker16: |
    gsay_reply(42, 143);
    call PlayerQuestions;
  Decker17: |
    gsay_reply(42, 148);
    giq_option(4, 42, 149, Decker18, 50);
    giq_option(4, 42, 150, Decker16, 50);
  Decker18: |
    gsay_reply(42, 151);
    giq_option(4, 42, 152, Decker19, 50);
    giq_option(4, 42, 153, Decker16, 50);
  Decker19: |
    gsay_reply(42, 154);
    giq_option(4, 42, 155, Decker16, 50);
  Decker25: |
    gsay_reply(42, 167);
    call PlayerQuestions;
  Decker26: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(42, 232);
    end
    else begin
      gsay_reply(42, 233);
    end
    giq_option(4, 42, 169, Decker27, 50);
    giq_option(4, 42, 170, Decker35, 51);
  Decker27: |
    gsay_reply(42, 171);
    giq_option(4, 42, 172, Decker28, 50);
    giq_option(4, 42, 173, Decker35, 51);
  Decker28: |
    gsay_reply(42, 174);
    giq_option(4, 42, 175, Decker29, 50);
  Decker29: |
    gsay_reply(42, 176);
    giq_option(4, 42, 177, Decker30, 50);
    giq_option(4, 42, 178, Decker32, 51);
  Decker30: |
    call UpReact;
    gsay_reply(42, 179);
    giq_option(4, 42, 180, Decker31, 50);
  Decker31: |
    gsay_message(42, 181, 50);
    call DeckerEndAcceptJob2;
  Decker32: |
    gsay_reply(42, 182);
    giq_option(4, 42, 183, Decker33, 50);
    giq_option(4, 42, 184, Decker34, 50);
  Decker33: |
    gsay_reply(42, 185);
    giq_option(4, 42, 186, Decker31, 50);
  Decker34: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(42, 234, 51);
    end
    else begin
      gsay_message(42, 235, 51);
    end
    call DeckerEndDeclineJob2;
  Decker35: |
    gsay_reply(42, 188);
    giq_option(4, 42, 189, Decker36, 50);
    giq_option(4, 42, 190, Decker28, 50);
  Decker36: |
    gsay_message(42, 191, 51);
    call DeckerEndDeclineJob2;
  DeckerEndAcceptJob1: |
    set_map_var(46, 2);
    set_global_var(111, 1);
    travel := 1;
  DeckerEndDeclineJob1: |
    set_map_var(46, 1);
    set_map_var(11, 1);
    set_global_var(111, 0);
    travel := 1;
  DeckerEndAcceptJob2: |
    set_map_var(47, 3);
    set_global_var(112, 1);
    travel := 1;
  DeckerEndDeclineJob2: |
    set_map_var(47, 2);
    set_map_var(11, 1);
    set_global_var(112, 0);
    travel := 1;
  DeckerEndInsult: |
    set_map_var(46, 1);
    set_map_var(11, 1);
    set_map_var(44, 1);
    travel := 1;
  DeckerEndNormal: 'travel := 1;

    '
  DeckerTransport: |
    gfade_out(1000);
    move_to(Kane_Ptr, 24336, 0);
    move_to(dude_obj, 23736, 0);
    anim(Kane_Ptr, 1000, rotation_to_tile(tile_num(Kane_Ptr), tile_num(dude_obj)));
    anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(Kane_Ptr)));
    gfade_in(1000);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
deckgrd:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(565, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (global_var(202) == 0) then begin
      float_msg(self_obj, message_str(565, random(101, 106)), 2);
    end
    else begin
      float_msg(self_obj, message_str(565, random(108, 110)), 2);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  combat_p_proc: |
    if ((global_var(202) == 1) and (surrendered == 0)) then begin
      script_overrides;
      set_map_var(54, 1);
      surrendered := 1;
      inven_unwield;
      float_msg(self_obj, message_str(565, 107), 2);
    end
    else begin
      if ((global_var(202) == 1) and (surrendered == 1)) then begin
        script_overrides;
      end
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      if (global_var(202) == 1) then begin
        set_obj_visibility(self_obj, 1);
      end
      critter_add_trait(self_obj, 1, 6, 38);
      critter_add_trait(self_obj, 1, 5, 16);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
demetre:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(566, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (map_var(24) == 1) then begin
      call Demetre10;
    end
    else begin
      if (map_var(25) == 1) then begin
        if (local_var(5) == 0) then begin
          start_gdialog(566, self_obj, 4, -1, -1);
          gsay_start;
          call Demetre20;
          gsay_end;
          end_dialogue;
        end
        else begin
          call Demetre20;
        end
      end
      else begin
        if (global_var(204) == 5) then begin
          call Demetre29;
        end
        else begin
          if (global_var(204) == 3) then begin
            call Demetre30;
          end
          else begin
            if (local_var(4) == 0) then begin
              start_gdialog(566, self_obj, 4, -1, -1);
              gsay_start;
              call Demetre00;
              gsay_end;
              end_dialogue;
            end
            else begin
              if (map_var(26) == 0) then begin
                start_gdialog(566, self_obj, 4, -1, -1);
                gsay_start;
                call Demetre27;
                gsay_end;
                end_dialogue;
              end
              else begin
                if ((map_var(26) == 1) and (global_var(204) != 4)) then begin
                  start_gdialog(566, self_obj, 4, -1, -1);
                  gsay_start;
                  call Demetre40;
                  gsay_end;
                  end_dialogue;
                end
                else begin
                  if ((map_var(26) == 1) and (global_var(204) == 4)) then begin
                    start_gdialog(566, self_obj, 4, -1, -1);
                    gsay_start;
                    call Demetre28;
                    gsay_end;
                    end_dialogue;
                  end
                end
              end
            end
          end
        end
      end
    end
    set_local_var(4, 1);
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    set_map_var(28, 1);
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 36);
      critter_add_trait(self_obj, 1, 5, 1);
    end
  combat: |
    hostile := 1;
    set_map_var(24, 1);
  Demetre00: |
    variable LVar0 := 0;
    LVar0 := get_critter_stat(dude_obj, 0);
    if (LVar0 < 4) then begin
      gsay_reply(566, message_str(566, 101) + " " + message_str(566, 102));
    end
    else begin
      if ((LVar0 >= 4) and (LVar0 < 6)) then begin
        gsay_reply(566, message_str(566, 101) + " " + message_str(566, 103));
      end
      else begin
        if ((LVar0 >= 6) and (LVar0 < 8)) then begin
          gsay_reply(566, message_str(566, 101) + " " + message_str(566, 104));
        end
        else begin
          if ((LVar0 >= 8) and (LVar0 < 10)) then begin
            gsay_reply(566, message_str(566, 101) + " " + message_str(566, 105));
          end
          else begin
            gsay_reply(566, message_str(566, 101) + " " + message_str(566, 106));
          end
        end
      end
    end
    giq_option(4, 566, 107, Demetre01, 49);
    giq_option(4, 566, 108, Demetre01, 50);
    giq_option(-3, 566, 109, Demetre01, 50);
  Demetre01: |
    gsay_reply(566, 110);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 566, 112, Demetre13, 50);
    end
    else begin
      giq_option(4, 566, 111, Demetre02, 50);
    end
    giq_option(4, 566, 113, Demetre12, 50);
    if (local_var(7) == 0) then begin
      giq_option(4, 566, 114, Demetre31a, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 566, 115, Demetre15, 50);
    end
    giq_option(4, 566, 116, DemetreEnd, 50);
    giq_option(-3, 566, 117, Demetre21, 50);
  Demetre02: |
    gsay_reply(566, 118);
    giq_option(4, 566, 119, Demetre03, 50);
    giq_option(4, 566, 120, Demetre05, 50);
    giq_option(4, 566, 121, Demetre09, 50);
    giq_option(4, 566, 122, Demetre04, 50);
  Demetre03: |
    set_map_var(26, 1);
    gsay_message(566, 123, 50);
  Demetre04: 'gsay_message(566, 124, 50);

    '
  Demetre05: |
    gsay_reply(566, 125);
    giq_option(4, 566, 126, Demetre08, 50);
    giq_option(4, 566, 127, Demetre07, 50);
    giq_option(4, 566, 128, Demetre06, 50);
    giq_option(4, 566, 129, Demetre07, 50);
  Demetre06: |
    set_map_var(26, 1);
    gsay_message(566, 130, 50);
  Demetre07: |
    set_map_var(26, 1);
    gsay_message(566, 131, 50);
  Demetre08: 'gsay_message(566, 132, 50);

    '
  Demetre09: |
    gsay_reply(566, 133);
    giq_option(4, 566, 134, DemetreEnd, 50);
    giq_option(4, 566, 135, Demetre11, 50);
  Demetre10: 'float_msg(self_obj, message_str(566, random(136, 138)), 2);

    '
  Demetre11: |
    set_map_var(26, 1);
    gsay_message(566, 139, 50);
  Demetre12: 'gsay_message(566, 140, 50);

    '
  Demetre13: |
    set_map_var(26, 1);
    gsay_message(566, 141, 50);
  Demetre14: |
    gsay_reply(566, 142);
    giq_option(4, 566, 143, Demetre02, 50);
    giq_option(4, 566, 144, Demetre12, 50);
  Demetre15: |
    gsay_reply(566, 145);
    giq_option(5, 566, 146, Demetre16, 50);
    if ((map_var(4) == 1) and (global_var(106) == 1)) then begin
      giq_option(4, 566, 147, Demetre17, 50);
    end
    giq_option(4, 566, 148, DemetreEnd, 50);
  Demetre16: |
    gsay_reply(566, 149);
    giq_option(4, 566, 150, Demetre02, 50);
    if ((map_var(4) == 1) and (global_var(106) == 1)) then begin
      giq_option(4, 566, 151, Demetre17, 50);
    end
    giq_option(4, 566, 152, DemetreEnd, 50);
  Demetre17: |
    gsay_reply(566, 153);
    giq_option(7, 566, 154, Demetre18, 50);
    giq_option(4, 566, 155, Demetre17a, 50);
    giq_option(4, 566, 156, Demetre17b, 51);
  Demetre17a: |
    if (global_var(100) == 2) then begin
      call DemetreEnd;
    end
    else begin
      call Demetre19;
    end
  Demetre17b: |
    call BigDownReact;
    call DemetreEnd;
  Demetre18: |
    gsay_reply(566, 157);
    giq_option(4, 566, 158, Demetre17a, 50);
  Demetre19: 'gsay_message(566, 159, 50);

    '
  Demetre20: |
    if (local_var(5) == 0) then begin
      set_local_var(5, 1);
      gsay_reply(566, 160);
      giq_option(4, 566, 161, DemetreEnd, 51);
      giq_option(4, 566, 162, Demetre25, 51);
      giq_option(4, 566, 163, Demetre20a, 51);
      giq_option(-3, 566, 164, Demetre22, 51);
    end
    else begin
      if (local_var(5) <= 5) then begin
        float_msg(self_obj, message_str(566, 164 + local_var(5)), 2);
        set_local_var(5, local_var(5) + 1);
      end
      else begin
        display_msg(message_str(566, 170));
      end
    end
  Demetre20a: |
    if (is_success(do_check(dude_obj, 3, -5))) then begin
      call Demetre24;
    end
    else begin
      call Demetre23;
    end
  Demetre21: |
    gsay_reply(566, 171);
    giq_option(-3, 566, 172, DemetreEnd, 50);
    giq_option(-3, 566, 173, DemetreEnd, 50);
  Demetre22: 'gsay_message(566, 174, 51);

    '
  Demetre23: 'gsay_message(566, 175, 51);

    '
  Demetre24: 'gsay_message(566, 176, 50);

    '
  Demetre25: 'gsay_message(566, 177, 51);

    '
  Demetre27: |
    gsay_reply(566, 184);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 566, 186, Demetre13, 50);
    end
    else begin
      giq_option(4, 566, 185, Demetre02, 50);
    end
    giq_option(4, 566, 187, Demetre12, 50);
    if (local_var(7) == 0) then begin
      giq_option(4, 566, 188, Demetre31a, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 566, 189, Demetre15, 50);
    end
    giq_option(4, 566, 190, DemetreEnd, 50);
    giq_option(-3, 566, 191, Demetre21, 50);
  Demetre28: |
    gsay_reply(566, 192);
    giq_option(4, 566, 193, Demetre33, 50);
    if (local_var(7) == 0) then begin
      giq_option(4, 566, 194, Demetre31a, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 566, 195, Demetre15, 50);
    end
    giq_option(4, 566, 196, Demetre39, 50);
    giq_option(4, 566, 197, DemetreEnd, 50);
  Demetre29: |
    float_msg(self_obj, message_str(566, 198), 2);
    set_map_var(25, 1);
  Demetre30: |
    float_msg(self_obj, message_str(566, 199), 2);
    set_map_var(25, 1);
  Demetre31a: |
    set_local_var(7, 1);
    call Demetre14;
  Demetre33: |
    if (local_var(9) == 0) then begin
      set_local_var(9, 1);
      gsay_reply(566, 209);
      giq_option(4, 566, 211, Demetre34, 50);
      giq_option(4, 566, 212, Demetre33a, 51);
      giq_option(4, 566, 213, DemetreEnd, 50);
    end
    else begin
      gsay_message(566, 210, 50);
    end
  Demetre33a: |
    set_map_var(25, 1);
    set_map_var(24, 1);
    call Demetre35;
  Demetre34: |
    gsay_reply(566, 214);
    giq_option(4, 566, 215, Demetre37, 51);
    giq_option(4, 566, 216, DemetreEnd, 50);
  Demetre35: |
    gsay_reply(566, 217);
    giq_option(4, 566, 218, Demetre36, 51);
    giq_option(4, 566, 219, Demetre35a, 51);
  Demetre35a: |
    set_map_var(24, 1);
    call combat;
  Demetre36: |
    set_map_var(25, 1);
    gsay_message(566, 220, 51);
  Demetre37: |
    gsay_reply(566, 221);
    giq_option(4, 566, 222, combat, 51);
    giq_option(4, 566, 223, Demetre38, 50);
    giq_option(4, 566, 224, DemetreEnd, 50);
  Demetre38: |
    gsay_reply(566, 225);
    giq_option(4, 566, 226, DemetreEnd, 50);
    giq_option(4, 566, 227, combat, 51);
  Demetre39: 'gsay_message(566, 228, 50);

    '
  Demetre40: |
    gsay_reply(566, 229);
    giq_option(4, 566, 230, Demetre41, 50);
    giq_option(4, 566, 231, Demetre43, 50);
    if (local_var(7) == 0) then begin
      giq_option(4, 566, 232, Demetre31a, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 566, 233, Demetre15, 50);
    end
    giq_option(4, 566, 234, DemetreEnd, 50);
    giq_option(-3, 566, 235, Demetre21, 50);
    giq_option(-3, 566, 236, Demetre42, 50);
  Demetre41: |
    variable LVar0 := 0;
    if (local_var(10) == 0) then begin
      LVar0 := create_object_sid(25, 0, 0, -1);
      add_obj_to_inven(dude_obj, LVar0);
      set_local_var(10, 1);
      gsay_message(566, 237, 50);
    end
    else begin
      gsay_message(566, 238, 50);
    end
  Demetre42: 'gsay_message(566, 239, 50);

    '
  Demetre43: 'gsay_message(566, 240, 50);

    '
  DemetreEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
demodog:
  start: |
    if (not(GVar2)) then begin
      critter_add_trait(self_obj, 1, 6, 6);
      GVar2 := 1;
      dog_is_angry := 1;
    end
    else begin
      if (script_action == 11) then begin
        call do_dialogue;
      end
      else begin
        if (script_action == 4) then begin
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
        else begin
          if ((script_action == 21) or (script_action == 3)) then begin
            script_overrides;
            if (global_var(5)) then begin
              display_msg(message_str(374, 100));
            end
            else begin
              display_msg(message_str(374, 101));
            end
          end
          else begin
            if (script_action == 12) then begin
              if (global_var(5) == 1) then begin
                if (tile_distance_objs(self_obj, dude_obj) > 4) then begin
                  animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 1), 1);
                end
                else begin
                  animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 3), 0);
                end
              end
              else begin
                if (Phil_approaches) then begin
                  if (dog_is_angry) then begin
                    add_timer_event(self_obj, game_ticks(4), 1);
                  end
                  Phil_approaches := 0;
                end
              end
            end
            else begin
              if (script_action == 18) then begin
                dog_is_angry := 0;
              end
              else begin
                if (script_action == 22) then begin
                  if (fixed_param == 1) then begin
                    call growl;
                  end
                  else begin
                    if (fixed_param == 2) then begin
                      call follow_player;
                    end
                  end
                end
                else begin
                  if (script_action == 7) then begin
                    if (obj_pid(obj_being_used_with) == 103) then begin
                      display_msg(message_str(374, 104));
                      give_exp_points(200);
                      set_global_var(5, 1);
                      set_global_var(187, 2);
                      set_global_var(186, 2);
                      critter_add_trait(self_obj, 1, 6, 0);
                      dog_is_angry := 0;
                      add_timer_event(self_obj, game_ticks(1), 2);
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  growl: |
    float_msg(self_obj, message_str(374, 103), 0);
    growling := 1;
    smartass2 := 1;
  do_dialogue: 'float_msg(self_obj, message_str(374, 102), 0);

    '
  follow_player: |
    variable LVar0 := 0;
    LVar0 := tile_num_in_direction(tile_num(dude_obj), random(0, 5), 1);
    if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
      animate_move_obj_to_tile(self_obj, LVar0, 0 bwor 16);
    end
    else begin
      animate_move_obj_to_tile(self_obj, LVar0, 1 bwor 16);
    end
    add_timer_event(self_obj, game_ticks(2), 2);
demopeas:
  start: |
    if (not(GVar2)) then begin
      critter_add_trait(self_obj, 1, 6, 5);
      GVar2 := 1;
    end
    else begin
      if (script_action == 11) then begin
        call talk_p_proc;
      end
      else begin
        if ((script_action == 21) or (script_action == 3)) then begin
          script_overrides;
          display_msg(message_str(375, 100));
        end
        else begin
          if (script_action == 4) then begin
            attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
          end
          else begin
            if (script_action == 12) then begin
              if (smartass2) then begin
                call PeasantD00;
              end
              if (not(dog_is_angry)) then begin
                call go_inside;
              end
            end
            else begin
              if (script_action == 8) then begin
                if (action_being_used == 14) then begin
                  dialogue_system_enter;
                end
              end
            end
          end
        end
      end
    end
  talk_p_proc: |
    if (global_var(5)) then begin
      call PeasantD02;
    end
    else begin
      if (not(dog_is_angry)) then begin
        call PeasantD04;
      end
      else begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
          call PeasantD01;
        end
        else begin
          call PeasantD03;
        end
      end
    end
  go_inside: 'animate_move_obj_to_tile(self_obj, 15283, 0);

    '
  PeasantD00: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 3);
    if (LVar0 == 1) then begin
      LVar1 := message_str(375, 101);
    end
    else begin
      if (LVar0 == 2) then begin
        LVar1 := message_str(375, 102);
      end
      else begin
        set_global_var(187, 1);
        LVar1 := message_str(375, 103);
      end
    end
    if (dog_is_angry) then begin
      float_msg(self_obj, LVar1, 3);
    end
    smartass2 := 0;
  PeasantD01: |
    if (dog_is_angry) then begin
      float_msg(self_obj, message_str(375, 104), 3);
    end
  PeasantD02: |
    if (dog_is_angry) then begin
      float_msg(self_obj, message_str(375, 105), 3);
    end
  PeasantD03: |
    float_msg(self_obj, message_str(375, 106), 3);
    smartass := 1;
  PeasantD04: 'float_msg(self_obj, message_str(375, 107), 3);

    '
demophil:
  start: |
    if (not(GVar3)) then begin
      critter_add_trait(self_obj, 1, 6, 5);
      add_timer_event(self_obj, game_ticks(10), 1);
      GVar3 := 1;
    end
    else begin
      if (script_action == 11) then begin
        call do_dialogue;
      end
      else begin
        if ((script_action == 21) or (script_action == 3)) then begin
          script_overrides;
          if (GVar0) then begin
            display_msg(message_str(376, 100));
          end
          else begin
            display_msg(message_str(376, 101));
          end
        end
        else begin
          if (script_action == 12) then begin
            if (growling) then begin
              call run_away;
            end
            if (smartass) then begin
              add_timer_event(self_obj, game_ticks(2), 2);
              smartass := 0;
            end
            if (not(dog_is_angry)) then begin
              animate_move_obj_to_tile(self_obj, 15686, 0);
            end
          end
          else begin
            if (script_action == 4) then begin
              attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
            end
            else begin
              if (script_action == 22) then begin
                if (fixed_param == 2) then begin
                  float_msg(self_obj, message_str(376, 102), 0);
                end
                else begin
                  if (dog_is_angry) then begin
                    call go_forward;
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call weapon_check;
    if (global_var(5)) then begin
      call Phil01;
    end
    else begin
      if (not(dog_is_angry)) then begin
        call Phil09;
      end
      else begin
        if (GVar2) then begin
          call Phil00;
        end
        else begin
          if (not(GVar0)) then begin
            start_gdialog(376, self_obj, 4, -1, -1);
            gsay_start;
            call Phil02;
            gsay_end;
            end_dialogue;
          end
          else begin
            call Phil08;
          end
        end
      end
    end
  run_away: |
    animate_move_obj_to_tile(self_obj, 16892, 1);
    growling := 0;
    add_timer_event(self_obj, game_ticks(random(10, 30)), 1);
  weapon_check: |
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      GVar2 := 1;
    end
    else begin
      GVar2 := 0;
    end
  go_forward: |
    Phil_approaches := 1;
    animate_move_obj_to_tile(self_obj, 16886, 0);
  Phil00: 'float_msg(self_obj, message_str(376, 103), 0);

    '
  Phil01: 'float_msg(self_obj, message_str(376, 104), 0);

    '
  Phil02: |
    variable LVar0 := 0;
    GVar0 := 1;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      LVar0 := message_str(376, 105);
    end
    else begin
      LVar0 := message_str(376, 106);
    end
    gsay_reply(376, LVar0 + message_str(376, 107));
    giq_option(4, 376, 108, Phil04, 50);
    giq_option(4, 376, 109, PhilEnd, 50);
    giq_option(6, 376, 110, Phil05, 50);
    giq_option(-3, 376, 111, Phil03, 50);
  Phil03: 'gsay_message(376, 112, 50);

    '
  Phil04: |
    gsay_reply(376, 113);
    giq_option(4, 376, 114, PhilEnd, 50);
    giq_option(4, 376, 115, Phil05, 50);
  Phil05: |
    gsay_reply(376, 116);
    giq_option(4, 376, 117, PhilEnd, 50);
    giq_option(5, 376, 118, Phil06, 50);
    giq_option(6, 376, 119, Phil07, 50);
  Phil06: |
    gsay_message(376, 120, 50);
    gsay_reply(376, 121);
    call Goodbyes;
    giq_option(7, 376, 122, Phil07, 50);
    giq_option(4, 634, GVar4, PhilEnd, 50);
  Phil07: |
    gsay_message(376, 123, 50);
    gsay_reply(376, 124);
    giq_option(4, 376, 125, PhilEnd, 50);
  Phil08: 'float_msg(self_obj, message_str(376, 126), 0);

    '
  Phil09: 'float_msg(self_obj, message_str(376, 127), 0);

    '
  PhilEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'GVar4 := message_str(634, random(100, 105));

    '
desk:
  start: |
    variable LVar0 := 0;
    if (script_action == 4) then begin
      call do_stuff;
    end
  do_stuff: 'display_msg(message_str(25, 100));

    '
  deskend: "[]"
diana:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 6);
      critter_add_trait(self_obj, 1, 5, 21);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(142, 100));
  talk_p_proc: |
    if (global_var(116) == 1) then begin
      float_msg(self_obj, message_str(136, random(102, 106)), 8);
    end
    else begin
      call do_dialogue;
    end
  pickup_p_proc: 'hostile := 1;

    '
  critter_p_proc: |
    call Critter_Action;
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    set_global_var(254, 1);
    set_global_var(611, 0);
    set_global_var(115, global_var(115) - 1);
  damage_p_proc: |
    if (global_var(116) == 0) then begin
      set_global_var(254, 1);
    end
  do_dialogue: |
    set_local_var(3, 1);
    call get_reaction;
    start_gdialog(142, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4)) then begin
      call Diana10;
    end
    else begin
      if (global_var(611) == 1) then begin
        call Diana11;
      end
      else begin
        set_local_var(4, 1);
        call Diana00;
      end
    end
    gsay_end;
    end_dialogue;
  Diana00: |
    gsay_reply(142, 101);
    if ((global_var(103) == 1) and (global_var(218) == 1)) then begin
      giq_option(4, 142, 102, Diana01, 50);
    end
    giq_option(4, 142, 103, Dianaend, 50);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      giq_option(4, 142, 104, Diana02, 50);
    end
    giq_option(4, 142, 105, Diana04, 50);
    if (local_var(5) == 0) then begin
      giq_option(7, 142, 106, Diana05, 50);
    end
    giq_option(-3, 142, 107, Diana10, 50);
  Diana01: |
    gsay_reply(142, 108);
    giq_option(4, 142, 109, Dianaend, 50);
    giq_option(4, 142, 110, Diana03, 50);
  Diana02: 'gsay_message(142, 111, 50);

    '
  Diana03: 'gsay_message(142, 112, 50);

    '
  Diana04: |
    gsay_reply(142, 113);
    giq_option(4, 142, 114, Diana03, 50);
    if (local_var(5) == 0) then begin
      giq_option(7, 142, 115, Diana05, 50);
    end
  Diana05: |
    gsay_reply(142, 116);
    set_local_var(5, 1);
    if ((global_var(103) == 1) and (global_var(218) == 1)) then begin
      giq_option(4, 142, 117, Diana01, 50);
    end
    giq_option(4, 142, 118, Diana03, 50);
  Diana10: 'gsay_message(142, 119, 50);

    '
  Diana11: |
    gsay_reply(142, 120);
    giq_option(4, 142, 104, Diana10, 50);
    giq_option(4, 142, 118, Diana12, 50);
    giq_option(-3, 142, 107, Diana10, 50);
  Diana12: 'gsay_message(142, 121, 50);

    '
  Dianaend: "[]"
  Critter_Action: |
    variable LVar0 := 0;
    if (global_var(26) == 2) then begin
      set_global_var(254, 1);
    end
    else begin
      if (global_var(116)) then begin
        set_global_var(254, 0);
        if (tile_distance_objs(self_obj, dude_obj) < 3) then begin
          LVar0 := tile_num_in_direction(tile_num(self_obj), random(0, 5), 3);
          if (tile_distance(tile_num(self_obj), LVar0) > 2) then begin
            if (random(0, 9) == 0) then begin
              float_msg(self_obj, message_str(136, random(102, 106)), 8);
            end
            animate_move_obj_to_tile(self_obj, LVar0, 0);
          end
        end
      end
      else begin
        if (global_var(213)) then begin
          set_global_var(254, 1);
        end
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          if (global_var(214)) then begin
            set_global_var(254, 1);
          end
        end
        if (map_var(2) == 1) then begin
          set_global_var(254, 1);
        end
      end
    end
    if (global_var(254) and obj_can_see_obj(self_obj, dude_obj)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
dirtnap:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 32);
      critter_add_trait(self_obj, 1, 5, 78);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 13) then begin
            if (fixed_param == 2) then begin
              rndx := random(1, 6) - 5;
              if (rndx < 0) then begin
                rndx := 0;
              end
              if (rndx > 0) then begin
                radiation_inc(target_obj, rndx);
              end
            end
          end
          else begin
            if (script_action == 12) then begin
              call critter_p_proc;
            end
            else begin
              if (script_action == 18) then begin
                call destroy_p_proc;
              end
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if ((global_var(30) != 0) and (global_var(31) != 2)) then begin
      if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 9)) then begin
        float_msg(self_obj, message_str(791, 102), 2);
        hostile := 1;
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    if (global_var(30) != 0) then begin
      float_msg(self_obj, message_str(791, 102), 2);
    end
    else begin
      float_msg(self_obj, message_str(791, 101), 2);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(791, 100));
diska:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(345, 100));
    end
  use_p_proc: |
    script_overrides;
    if (local_var(0) == 1) then begin
      display_msg(message_str(345, 101));
    end
    else begin
      display_msg(message_str(345, 102));
      set_global_var(164, 1);
      set_local_var(0, 1);
      rm_obj_from_inven(dude_obj, self_obj);
      display_msg(message_str(766, 103) + "100" + message_str(766, 104));
      give_exp_points(100);
    end
diskd:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(346, 100));
    end
  use_p_proc: |
    script_overrides;
    if (local_var(0) == 1) then begin
      display_msg(message_str(346, 101));
    end
    else begin
      display_msg(message_str(346, 102));
      set_global_var(165, 1);
      set_local_var(0, 1);
      rm_obj_from_inven(dude_obj, self_obj);
      display_msg(message_str(766, 103) + "100" + message_str(766, 104));
      give_exp_points(100);
    end
doclockr:
  start: "[]"
  look_at_p_proc: 'set_map_var(4, self_obj);

    '
  use_p_proc: |
    messing_with_Morbid_stuff := 1;
    if (source_obj == dude_obj) then begin
      if (obj_is_locked(self_obj)) then begin
        script_overrides;
        display_msg(message_str(851, 100));
      end
      else begin
        if (local_var(2) == 0) then begin
          script_overrides;
          if (local_var(1) == 0) then begin
            GVar0 := roll_vs_skill(source_obj, 11, 0);
            if (is_success(GVar0)) then begin
              reg_anim_func(2, source_obj);
              GVar0 := roll_vs_skill(source_obj, 11, 0);
              if (is_success(GVar0)) then begin
                set_local_var(1, 1);
                set_local_var(2, 1);
                display_msg(message_str(851, 101));
              end
              else begin
                if (is_critical(GVar0) and (local_var(2) == 0)) then begin
                  set_local_var(1, 1);
                  set_local_var(2, 1);
                  display_msg(message_str(851, 103));
                  call set_off_trap;
                end
                else begin
                  set_local_var(1, 1);
                  display_msg(message_str(851, 102));
                end
              end
            end
            else begin
              call set_off_trap;
            end
          end
          else begin
            call set_off_trap;
          end
        end
      end
    end
    else begin
      if (source_obj == Katja_ptr) then begin
        set_local_var(1, 1);
        set_local_var(2, 1);
        obj_unlock(self_obj);
      end
    end
  use_obj_on_p_proc: |
    messing_with_Morbid_stuff := 1;
    if (obj_pid(obj_being_used_with) == 84) then begin
      if (obj_is_locked(self_obj)) then begin
        script_overrides;
        GVar0 := roll_vs_skill(source_obj, 9, -40);
        if (is_success(GVar0)) then begin
          obj_unlock(self_obj);
          display_msg(message_str(851, 107));
        end
        else begin
          if (is_critical(GVar0)) then begin
            jam_lock(self_obj);
            set_local_var(0, local_var(0) + 1);
            if ((local_var(0) >= 3) and (local_var(2) == 0)) then begin
              display_msg(message_str(851, 106));
              call set_off_trap;
            end
            else begin
              display_msg(message_str(851, 110));
            end
          end
          else begin
            set_local_var(0, local_var(0) + 1);
            if ((local_var(0) >= 3) and (local_var(2) == 0)) then begin
              display_msg(message_str(851, 106));
              call set_off_trap;
            end
            else begin
              display_msg(message_str(851, 108));
            end
          end
        end
      end
      else begin
        display_msg(message_str(851, 109));
      end
    end
  use_skill_on_p_proc: |
    messing_with_Morbid_stuff := 1;
    if (action_being_used == 9) then begin
      if (obj_is_locked(self_obj)) then begin
        script_overrides;
        GVar0 := roll_vs_skill(dude_obj, 9, -60);
        if (is_success(GVar0)) then begin
          obj_unlock(self_obj);
          display_msg(message_str(851, 107));
        end
        else begin
          if (is_critical(GVar0)) then begin
            jam_lock(self_obj);
            display_msg(message_str(851, 110));
          end
          else begin
            display_msg(message_str(851, 108));
            set_local_var(0, local_var(0) + 1);
            if ((local_var(0) >= 3) and (local_var(2) == 0)) then begin
              display_msg(message_str(851, 106));
              call set_off_trap;
            end
          end
        end
      end
      else begin
        display_msg(message_str(851, 109));
      end
    end
    else begin
      if (action_being_used == 11) then begin
        if (local_var(1) == 0) then begin
          GVar0 := roll_vs_skill(source_obj, 11, 0);
          if (is_success(GVar0)) then begin
            if (is_critical(GVar0)) then begin
              script_overrides;
              display_msg(message_str(851, 101));
              set_local_var(1, 1);
              set_local_var(2, 1);
            end
            else begin
              script_overrides;
              display_msg(message_str(851, 111));
              set_local_var(1, 1);
            end
          end
          else begin
            if (is_critical(GVar0)) then begin
              display_msg(message_str(851, 106));
              call set_off_trap;
            end
          end
        end
        else begin
          if (local_var(2) == 0) then begin
            script_overrides;
            GVar0 := roll_vs_skill(source_obj, 11, 0);
            if (is_success(GVar0)) then begin
              display_msg(message_str(851, 104));
              set_local_var(2, 1);
            end
            else begin
              if (is_critical(GVar0)) then begin
                display_msg(message_str(851, 106));
                call set_off_trap;
              end
              else begin
                display_msg(message_str(851, 105));
              end
            end
          end
        end
      end
    end
  set_off_trap: |
    if (local_var(2) == 0) then begin
      explosion(tile_num(self_obj), elevation(self_obj), random(6, 36));
      destroy_object(self_obj);
    end
docwu:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 69);
      Only_Once := 0;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if (script_action == 18) then begin
        if (source_obj == dude_obj) then begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
            set_global_var(156, 1);
            set_global_var(157, 0);
          end
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
            set_global_var(157, 1);
            set_global_var(156, 0);
          end
          set_global_var(160, global_var(160) + 1);
          if ((global_var(160) % 6) == 0) then begin
            set_global_var(155, global_var(155) + 1);
          end
        end
      end
      else begin
        if (script_action == 12) then begin
          if (hostile) then begin
            hostile := 0;
            attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
          end
        end
        else begin
          if ((script_action == 21) or (script_action == 3)) then begin
          end
          else begin
            if (script_action == 4) then begin
              hostile := 1;
            end
            else begin
              if (script_action == 22) then begin
                if (fixed_param == 1) then begin
                  if ((healing == 1) or (healing == 3)) then begin
                    float_msg(dude_obj, message_str(400, 138), 2);
                  end
                  else begin
                    if (healing == 2) then begin
                      float_msg(dude_obj, message_str(400, 152), 2);
                    end
                    else begin
                      if (healing == 4) then begin
                        float_msg(dude_obj, message_str(400, 175), 2);
                      end
                      else begin
                        if (healing == 5) then begin
                          float_msg(self_obj, message_str(400, 150), 8);
                        end
                        else begin
                          if (healing == 6) then begin
                            float_msg(self_obj, message_str(400, 178), 8);
                          end
                        end
                      end
                    end
                  end
                  add_timer_event(self_obj, game_ticks(3), 2);
                end
                else begin
                  if (fixed_param == 2) then begin
                    if (healing < 4) then begin
                      float_msg(self_obj, message_str(400, 139), 8);
                    end
                    else begin
                      if (healing == 4) then begin
                        float_msg(self_obj, message_str(400, 176), 8);
                      end
                    end
                    add_timer_event(self_obj, game_ticks(3), 3);
                  end
                  else begin
                    if (fixed_param == 3) then begin
                      if (healing == 1) then begin
                        if (get_critter_stat(dude_obj, 34) == 0) then begin
                          float_msg(self_obj, message_str(400, 140), 8);
                        end
                        else begin
                          float_msg(self_obj, message_str(400, 141), 8);
                        end
                      end
                      else begin
                        if (healing == 2) then begin
                          float_msg(self_obj, message_str(400, 153), 8);
                        end
                        else begin
                          if (healing == 3) then begin
                            if (get_critter_stat(dude_obj, 34) == 0) then begin
                              float_msg(self_obj, message_str(400, 167), 8);
                            end
                            else begin
                              float_msg(self_obj, message_str(400, 168), 8);
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    start_gdialog(400, self_obj, 4, -1, -1);
    gsay_start;
    healing := 0;
    if (local_var(5) == 1) then begin
      call DocWu00;
    end
    else begin
      if (local_var(6) == 1) then begin
        call DocWu01;
      end
      else begin
        if (local_var(7) == 1) then begin
          call DocWu02;
        end
        else begin
          call DocWu03;
        end
      end
    end
    gsay_end;
    end_dialogue;
    if (healing) then begin
      use_obj(dude_obj);
      add_timer_event(self_obj, game_ticks(2), 1);
    end
  social_skills: |
    call get_reaction;
    dialogue_system_enter;
  DocWu00: |
    variable LVar0 := 0;
    set_local_var(4, 1);
    set_local_var(5, 1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(400, message_str(400, 102));
    end
    else begin
      gsay_reply(400, message_str(400, 103));
    end
    giq_option(7, 400, 106, DocWu04, 50);
    call DocWuOpts1;
    giq_option(4, 400, 109, DocWu07, 50);
    call DocWuOpts2;
    giq_option(4, 400, 111, DocWu09, 50);
    call DocWuOpts3;
  DocWu01: |
    set_local_var(6, 1);
    gsay_reply(400, 113);
    giq_option(7, 400, 114, DocWu11, 50);
    call DocWuOpts1;
    giq_option(4, 400, 115, DocWu12, 50);
    call DocWuOpts2;
    giq_option(4, 400, 116, DocWu09, 50);
    call DocWuOpts3;
  DocWu02: |
    set_local_var(7, 1);
    gsay_reply(400, 117);
    giq_option(7, 400, 118, DocWu13, 50);
    call DocWuOpts1;
    giq_option(4, 400, 119, DocWu12, 50);
    call DocWuOpts2;
    giq_option(4, 400, 120, DocWu14, 50);
    call DocWuOpts3;
  DocWu03: |
    set_local_var(5, 0);
    set_local_var(6, 0);
    set_local_var(7, 0);
    gsay_reply(400, 121);
    giq_option(7, 400, 122, DocWu15, 50);
    call DocWuOpts1;
    giq_option(4, 400, 123, DocWu12, 50);
    call DocWuOpts2;
    giq_option(4, 400, 124, DocWu14, 50);
    call DocWuOpts3;
  DocWu04: |
    gsay_reply(400, 125);
    giq_option(7, 400, 126, DocWu16, 50);
    call DocWuOpts4;
  DocWu05: |
    gsay_reply(400, 130);
    giq_option(0, 400, 101, DocWuEnd, 50);
  DocWu06: |
    gsay_reply(400, 131);
    giq_option(0, 400, 100, DocWu06a, 50);
  DocWu06a: 'healing := 1;

    '
  DocWu07: |
    gsay_reply(400, 142);
    call DocWuOpts4;
  DocWu08: |
    gsay_reply(400, 143);
    giq_option(0, 400, 101, DocWuEnd, 50);
  DocWu09: |
    gsay_reply(400, 144);
    giq_option(4, 400, 145, DocWu06, 50);
    giq_option(4, 400, 146, DocWu23, 50);
    giq_option(4, 400, 147, DocWu24, 50);
  DocWu10: |
    gsay_reply(400, 148);
    giq_option(0, 400, 100, DocWu10a, 50);
  DocWu10a: |
    gsay_reply(400, 151);
    giq_option(0, 400, 100, DocWu10c, 50);
  DocWu10b: 'healing := 5;

    '
  DocWu10c: 'healing := 2;

    '
  DocWu11: |
    gsay_reply(400, 154);
    call DocWuOpts4;
  DocWu12: |
    gsay_reply(400, 155);
    call DocWuOpts4;
  DocWu13: |
    gsay_reply(400, 156);
    call DocWuOpts4;
  DocWu14: |
    gsay_reply(400, 157);
    giq_option(4, 400, 158, DocWu06, 50);
    giq_option(4, 400, 159, DocWu23, 50);
    giq_option(4, 400, 160, DocWu24, 50);
  DocWu15: |
    gsay_reply(400, 161);
    giq_option(4, 400, 162, DocWu06, 50);
    giq_option(4, 400, 163, DocWu23, 50);
    giq_option(4, 400, 160, DocWu24, 50);
  DocWu16: |
    gsay_reply(400, 164);
    giq_option(4, 400, 162, DocWu06, 50);
    giq_option(4, 400, 163, DocWu23, 50);
    giq_option(4, 400, 160, DocWu24, 50);
  DocWu17: |
    gsay_reply(400, 165);
    giq_option(0, 400, 100, DocWu17a, 50);
  DocWu17a: |
    gsay_reply(400, 166);
    giq_option(0, 400, 100, DocWu17b, 50);
  DocWu17b: 'healing := 3;

    '
  DocWu18: |
    gsay_reply(400, 169);
    giq_option(0, 400, 101, DocWuEnd, 50);
  DocWu19: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar1 := get_critter_stat(dude_obj, 7);
    LVar0 := get_critter_stat(dude_obj, 35);
    if (LVar0 == LVar1) then begin
      gsay_reply(400, 170);
      giq_option(0, 400, 101, DocWuEnd, 50);
    end
    else begin
      if (LVar0 > (LVar1 / 2)) then begin
        call DocWu19a;
      end
      else begin
        call DocWu19b;
      end
    end
  DocWu19a: |
    gsay_reply(400, 171);
    giq_option(4, 400, 127, DocWu06, 50);
    giq_option(4, 400, 173, DocWu23, 50);
  DocWu19b: |
    gsay_reply(400, 171);
    giq_option(4, 400, 127, DocWu06, 50);
    giq_option(4, 400, 173, DocWu18, 50);
  DocWu20: |
    gsay_reply(400, 174);
    giq_option(0, 400, 100, DocWu20a, 50);
  DocWu20a: |
    gsay_reply(400, 137);
    giq_option(0, 400, 100, DocWu20b, 50);
  DocWu20b: 'healing := 4;

    '
  DocWu21: |
    gsay_reply(400, 177);
    giq_option(0, 400, 100, DocWu21a, 50);
  DocWu21a: 'healing := 6;

    '
  DocWu22: |
    gsay_reply(400, 179);
    giq_option(0, 400, 101, DocWuEnd, 50);
  DocWu23: |
    gsay_reply(400, 180);
    giq_option(0, 400, 101, DocWuEnd, 50);
  DocWu24: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar1 := get_critter_stat(dude_obj, 7);
    LVar0 := get_critter_stat(dude_obj, 35);
    if (LVar0 == LVar1) then begin
      gsay_reply(400, 170);
      giq_option(0, 400, 101, DocWuEnd, 50);
    end
    else begin
      if (LVar0 > (LVar1 / 2)) then begin
        call DocWu24a;
      end
      else begin
        call DocWu24b;
      end
    end
  DocWu24a: |
    gsay_reply(400, 181);
    giq_option(4, 400, 127, DocWu17, 50);
    giq_option(4, 400, 173, DocWu23, 50);
  DocWu24b: |
    gsay_reply(400, 182);
    giq_option(4, 400, 183, DocWu06, 50);
    giq_option(4, 400, 173, DocWu23, 50);
  DocWuOpts1: |
    giq_option(4, 400, 107, DocWu05, 50);
    giq_option(4, 400, 108, DocWu06, 50);
  DocWuOpts2: 'giq_option(4, 400, 110, DocWu08, 50);

    '
  DocWuOpts3: |
    giq_option(-3, 400, 112, DocWu10, 50);
    giq_option(-3, 400, 184, DocWuEnd, 50);
  DocWuOpts4: |
    giq_option(4, 400, 127, DocWu17, 50);
    giq_option(4, 400, 128, DocWu18, 50);
    giq_option(4, 400, 129, DocWu19, 50);
  DocWuOpts5: |
    gsay_reply(400, 132);
    giq_option(7, 400, 133, DocWuOpts5a, 50);
    giq_option(4, 400, 134, DocWu21, 50);
    giq_option(4, 400, 135, DocWu22, 50);
    giq_option(4, 400, 136, DocWuOpts5a, 50);
  DocWuOpts5a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call DocWu20;
    end
    else begin
      call DocWu21;
    end
  DocWuEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
dog2:
  start: "[]"
  critter_p_proc: |
    if (global_var(4) == 0) then begin
      rndx := random(0, 5);
      critter_tile := tile_num_in_direction(tile_num(dude_obj), rndx, 1);
      animate_move_obj_to_tile(self_obj, critter_tile, 0);
    end
    else begin
      rndy := random(1, 20);
      if (rndy == 1) then begin
        rndx := random(0, 5);
        critter_tile := tile_num_in_direction(tile_num(self_obj), rndx, 1);
        animate_move_obj_to_tile(self_obj, critter_tile, 0);
      end
    end
  destroy_p_proc: 'set_global_var(4, global_var(4) + 1);

    '
  map_enter_p_proc: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 5, 8);
      critter_add_trait(self_obj, 1, 6, 49);
    end
dogmeat:
  start: |
    if (not(initialized) and metarule(14, 0)) then begin
      critter_add_trait(self_obj, 1, 6, 0);
      add_timer_event(self_obj, game_ticks(1), 1);
      move_to(self_obj, tile_num_in_direction(tile_num(dude_obj), (has_trait(1, dude_obj, 10) + 3) % 6, 2), elevation(dude_obj));
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 8) then begin
            call use_skill_on_p_proc;
          end
        end
      end
    end
  critter_p_proc: |
    if (global_var(5) == 1) then begin
      if (tile_distance_objs(self_obj, dude_obj) > 4) then begin
        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 1), 1);
      end
      else begin
        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 3), 0);
      end
    end
  destroy_p_proc: 'set_global_var(5, 0);

    '
  use_skill_on_p_proc: |
    if (action_being_used == 10) then begin
      script_overrides;
    end
dolgan:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 47);
      critter_add_trait(self_obj, 1, 5, 27);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj) and (global_var(136) < 41)) then begin
      hostile := 1;
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    set_global_var(136, global_var(136) - 1);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    if ((global_var(135) == 2) or (get_critter_stat(dude_obj, 6) > 6)) then begin
      call show_true_name;
    end
    else begin
      if (get_critter_stat(dude_obj, 6) < 4) then begin
        call show_false_name;
      end
      else begin
        if (get_critter_stat(dude_obj, 4) < 5) then begin
          call show_false_name;
        end
        else begin
          if (random(0, 1)) then begin
            call show_false_name;
          end
          else begin
            call show_true_name;
          end
        end
      end
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    start_gdialog(282, self_obj, 4, -1, -1);
    gsay_start;
    set_local_var(0, 1);
    if (global_var(135) == 2) then begin
      call Dolgan03;
    end
    else begin
      if ((global_var(135) == 1) and (local_var(1) == 0)) then begin
        call Dolgan01;
      end
      else begin
        call Dolgan00;
      end
    end
    gsay_end;
    end_dialogue;
  show_true_name: |
    script_overrides;
    if (local_var(0)) then begin
      if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
        display_msg(message_str(282, 100));
      end
      else begin
        display_msg(message_str(282, 101));
      end
    end
    else begin
      display_msg(message_str(282, 104));
    end
  show_false_name: |
    script_overrides;
    display_msg(message_str(282, random(105, 111)));
  Dolgan00: 'float_msg(self_obj, message_str(282, 112), 2);

    '
  Dolgan01: |
    float_msg(self_obj, message_str(282, 113), 2);
    set_local_var(1, 1);
    critter_mod_skill(dude_obj, 4, 7);
    game_time_advance(game_ticks(14400));
    call Dolgan02;
  Dolgan02: 'gsay_message(282, 114, 50);

    '
  Dolgan03: |
    gsay_reply(282, 115);
    if (local_var(1) != 2) then begin
      giq_option(5, 282, 116, Dolgan04, 50);
    end
    giq_option(5, 282, 117, Dolgan07, 50);
    giq_option(5, 282, 118, DolganEnd, 50);
  Dolgan04: |
    gsay_reply(282, 119);
    if (local_var(1) != 2) then begin
      giq_option(4, 282, 120, Train, 50);
    end
    giq_option(4, 282, 121, DolganEnd, 50);
  Dolgan05: 'gsay_message(282, 122, 50);

    '
  Dolgan06: 'gsay_message(282, 123, 50);

    '
  Dolgan07: |
    gsay_reply(282, 124);
    giq_option(5, 282, 125, DolganEnd, 50);
  Train: |
    game_time_advance(game_ticks(21600));
    set_local_var(1, 2);
    critter_mod_skill(dude_obj, 4, 7);
    call Dolgan05;
  DolganEnd: "[]"
  DolganCombat: 'hostile := 1;

    '
door:
  start: |
    if (script_action == 3) then begin
      call look_at_p_proc;
    end
  use_p_proc: |
    if (local_var(0) == 0) then begin
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
    if ((local_var(0) == 0) and (source_obj == dude_obj)) then begin
      script_overrides;
      display_msg(message_str(63, 104));
    end
  use_skill_on_p_proc: |
    variable LVar0 := 0;
    if (local_var(0) == 0) then begin
      if (action_being_used == 9) then begin
        script_overrides;
        LVar0 := roll_vs_skill(dude_obj, 9, 0);
        if (is_success(LVar0)) then begin
          set_local_var(0, 1);
          display_msg(message_str(63, 100));
          give_exp_points(25);
          display_msg(message_str(766, 103) + "25" + message_str(766, 104));
        end
        else begin
          if (is_critical(LVar0)) then begin
            jam_lock(self_obj);
            display_msg(message_str(63, 110));
          end
          else begin
            display_msg(message_str(63, 103));
          end
        end
      end
    end
    else begin
      display_msg(message_str(63, 109));
    end
  look_at_p_proc: |
    if (local_var(0) == 0) then begin
      script_overrides;
      display_msg(message_str(63, 104));
    end
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := obj_being_used_with;
    LVar1 := roll_vs_skill(dude_obj, 9, 20);
    if ((obj_pid(LVar0) == 84) and (local_var(0) == 0)) then begin
      script_overrides;
      if (is_success(LVar1)) then begin
        set_local_var(0, 1);
        display_msg(message_str(63, 100));
        display_msg(message_str(766, 103) + "25" + message_str(766, 104));
        give_exp_points(25);
      end
      else begin
        if (is_critical(LVar1)) then begin
          rm_obj_from_inven(dude_obj, LVar0);
          destroy_object(LVar0);
          display_msg(message_str(63, 101));
        end
        else begin
          display_msg(message_str(63, 103));
        end
      end
    end
  map_update_p_proc: |
    if (local_var(0) == 0) then begin
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
  damage_p_proc: |
    set_obj_visibility(self_obj, 1);
    set_local_var(1, 1);
doorcode:
  start: |
    if (script_action == 21) then begin
      script_overrides;
      display_msg(message_str(534, 101));
    end
    if (script_action == 3) then begin
      script_overrides;
      display_msg(message_str(534, 102));
    end
  use_p_proc: |
    script_overrides;
    display_msg(message_str(534, 100));
    if (global_var(271) == 0) then begin
      set_global_var(271, 1);
    end
dragon:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 47);
      critter_add_trait(self_obj, 1, 5, 27);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if ((game_time_hour >= 700) and (game_time_hour < 1800) and (tile_num(self_obj) != 26746)) then begin
      animate_move_obj_to_tile(self_obj, 26746, 0);
    end
    else begin
      if ((game_time_hour >= 1900) or (game_time_hour < 600) and (tile_num(self_obj) != 23938)) then begin
        animate_move_obj_to_tile(self_obj, 23938, 0);
      end
    end
    if (obj_can_see_obj(self_obj, dude_obj) and (global_var(136) < 41)) then begin
      hostile := 1;
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    set_global_var(136, global_var(136) - 1);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    if ((global_var(135) == 2) or (get_critter_stat(dude_obj, 6) > 6)) then begin
      call show_true_name;
    end
    else begin
      if (get_critter_stat(dude_obj, 6) < 4) then begin
        call show_false_name;
      end
      else begin
        if (get_critter_stat(dude_obj, 4) < 5) then begin
          call show_false_name;
        end
        else begin
          if (random(0, 1)) then begin
            call show_false_name;
          end
          else begin
            call show_true_name;
          end
        end
      end
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (get_critter_stat(dude_obj, 4) < 4) then begin
      display_msg(message_str(766, 175));
    end
    else begin
      start_gdialog(284, self_obj, 4, -1, -1);
      gsay_start;
      set_local_var(0, 1);
      if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
        call Dragon00;
      end
      else begin
        if (global_var(135) == 1) then begin
          call Dragon07;
        end
        else begin
          if (global_var(135) == 2) then begin
            call Dragon11;
          end
          else begin
            call Dragon01;
          end
        end
      end
      gsay_end;
      end_dialogue;
    end
  show_true_name: |
    script_overrides;
    if (local_var(0)) then begin
      display_msg(message_str(284, 100));
    end
    else begin
      display_msg(message_str(284, 103));
    end
  show_false_name: |
    script_overrides;
    display_msg(message_str(284, random(104, 110)));
  Dragon00: 'gsay_message(284, 111, 50);

    '
  Dragon01: |
    gsay_reply(284, 112);
    giq_option(4, 284, 113, Dragon02, 50);
    giq_option(4, 284, 114, Dragon06, 50);
    giq_option(4, 284, 115, DragonCombat, 50);
  Dragon02: |
    gsay_reply(284, 116);
    giq_option(4, 284, 117, Dragon03, 50);
    giq_option(4, 284, 118, Dragon04, 50);
    giq_option(4, 284, 119, Dragon05, 50);
  Dragon03: |
    gsay_message(284, 120, 50);
    call DragonCombat;
  Dragon04: 'gsay_message(284, 121, 50);

    '
  Dragon05: |
    gsay_message(284, 122, 50);
    call DragonCombat;
  Dragon06: |
    gsay_reply(284, 123);
    giq_option(0, 284, 124, DragonEnd, 50);
    giq_option(0, 284, 125, DragonCombat, 50);
  Dragon07: |
    gsay_reply(284, 126);
    giq_option(4, 284, 127, DragonCombat, 50);
    giq_option(4, 284, 128, Dragon08, 50);
    giq_option(4, 284, 129, Dragon10, 50);
  Dragon08: |
    if (obj_is_carrying_obj_pid(dude_obj, 114)) then begin
      gsay_message(284, 130, 50);
    end
    else begin
      call Dragon09;
    end
  Dragon09: 'gsay_message(284, 131, 50);

    '
  Dragon10: 'gsay_message(284, 132, 50);

    '
  Dragon11: 'gsay_message(284, 133, 50);

    '
  DragonCombat: 'hostile := 1;

    '
  DragonEnd: "[]"
duc:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 6);
      known := global_var(333);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 14) then begin
          call damage_p_proc;
        end
        else begin
          if (script_action == 18) then begin
            call destroy_p_proc;
          end
          else begin
            if (script_action == 21) then begin
              call look_at_p_proc;
            end
            else begin
              if (script_action == 4) then begin
                call pickup_p_proc;
              end
              else begin
                if (script_action == 11) then begin
                  call talk_p_proc;
                end
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if ((global_var(289) == 1) and (tile_distance_objs(dude_obj, self_obj) < 8)) then begin
      call flee_dude;
    end
  damage_p_proc: 'set_global_var(289, 1);

    '
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
    set_global_var(331, 1);
    set_global_var(289, 1);
  look_at_p_proc: |
    script_overrides;
    if (not(known)) then begin
      display_msg(message_str(243, 100));
    end
    else begin
      display_msg(message_str(243, 101));
    end
  pickup_p_proc: 'set_global_var(289, 1);

    '
  talk_p_proc: |
    if (global_var(289) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 0);
    end
    else begin
      start_gdialog(243, self_obj, 4, -1, -1);
      gsay_start;
      call get_reaction;
      if ((global_var(26) == 1) and (Tandi_seed == 0)) then begin
        call Duc09;
      end
      else begin
        if ((global_var(26) == 2) and (Tandi_rescued == 0)) then begin
          call Duc10;
        end
        else begin
          if (not(known)) then begin
            if (local_var(1) > 1) then begin
              call Duc01;
            end
            else begin
              call Duc06;
            end
          end
          else begin
            if (local_var(1) > 1) then begin
              call Duc07;
            end
            else begin
              call Duc08;
            end
          end
        end
      end
      gsay_end;
      end_dialogue;
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
  Duc01: |
    gsay_reply(243, 102);
    known := 1;
    set_global_var(333, known);
    giq_option(4, 243, 103, Duc02, 50);
    giq_option(4, 243, 104, Duc03, 50);
    giq_option(-3, 243, 105, Duc04, 50);
  Duc02: |
    gsay_reply(243, 106);
    giq_option(0, 634, 106, DucBarter, 49);
  Duc03: |
    gsay_reply(243, 107);
    giq_option(4, 243, 108, Duc05, 50);
    giq_option(4, 243, 109, DucEnd, 50);
  Duc04: 'gsay_message(243, 110, 50);

    '
  Duc05: |
    gsay_message(243, 111, 50);
    game_time_advance(game_ticks(86400));
    if (global_var(68) < 1) then begin
      set_global_var(68, 1);
    end
    load_map(26, 1);
  Duc06: |
    gsay_reply(243, 113);
    giq_option(4, 243, 114, Duc04, 51);
    giq_option(4, 243, message_str(243, 115) + proto_data(obj_pid(dude_obj), 1) + message_str(243, 116), Duc08, 50);
    giq_option(-3, 243, 117, Duc04, 50);
  Duc07: |
    gsay_reply(243, 118);
    giq_option(4, 243, 119, Duc05, 50);
    giq_option(4, 243, 120, Duc02, 50);
    giq_option(4, 243, 121, DucEnd, 50);
  Duc08: |
    gsay_reply(243, 122);
    known := 1;
    set_global_var(333, known);
    giq_option(6, 243, 123, DucEnd, 50);
    giq_option(6, 243, 124, Duc02, 50);
    giq_option(-3, 243, 125, Duc04, 50);
  Duc09: |
    gsay_message(243, 126, 50);
    Tandi_seed := 1;
  Duc10: |
    gsay_message(243, 127, 49);
    Tandi_rescued := 1;
    call UpReact;
  DucBarter: |
    gdialog_mod_barter(0);
    giq_option(0, 634, 100, DucEnd, 50);
  DucEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
dugan:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(917, 101));
    end
    else begin
      display_msg(message_str(917, 100));
    end
  talk_p_proc: |
    if (global_var(253) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if ((local_var(4) == 1) and (get_critter_stat(dude_obj, 4) < 4)) then begin
        float_msg(self_obj, message_str(917, 120), 0);
      end
      else begin
        call get_reaction;
        start_gdialog(917, self_obj, -1, -1, -1);
        gsay_start;
        call Dugan01;
        gsay_end;
        end_dialogue;
      end
    end
  critter_p_proc: |
    if ((((game_time / 10) - PsstTime) >= 30) and (tile_distance_objs(self_obj, dude_obj) <= 10)) then begin
      float_msg(self_obj, message_str(917, random(121, 125)), 0);
      PsstTime := game_time / 10;
    end
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(253) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  pickup_p_proc: 'set_global_var(253, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      critter_add_trait(self_obj, 1, 6, 47);
      critter_add_trait(self_obj, 1, 5, 27);
      Initialize := 0;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  Dugan01: |
    gsay_reply(917, 102);
    giq_option(4, 917, 103, Dugan02, 50);
    giq_option(4, 917, 104, Dugan03, 50);
    giq_option(4, 917, 105, Dugan05, 50);
    if (global_var(613) < 1) then begin
      giq_option(4, 917, 106, Dugan08, 50);
    end
    giq_option(4, 917, 107, DuganEnd, 50);
    giq_option(-3, 917, 108, Dugan09, 50);
  Dugan02: 'gsay_message(917, 109, 50);

    '
  Dugan03: |
    gsay_reply(917, 110);
    call Dugan04;
  Dugan04: |
    gsay_option(917, 111, Dugan05, 50);
    gsay_option(917, 112, Dugan06, 50);
    gsay_option(917, 113, Dugan07, 50);
    gsay_option(917, 114, Dugan01, 50);
    gsay_option(917, 115, DuganEnd, 50);
  Dugan05: |
    gsay_reply(917, 116);
    call Dugan04;
  Dugan06: |
    gsay_reply(917, 117);
    call Dugan04;
  Dugan07: |
    gsay_reply(917, 118);
    call Dugan04;
  Dugan08: |
    gsay_message(917, 119, 50);
    call Dugan01;
  Dugan09: 'gsay_message(917, 120, 50);

    '
  DuganEnd: "[]"
elder:
  start: |
    variable LVar0 := 0;
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if (script_action == 21) then begin
        script_overrides;
        display_msg(message_str(2, 100));
      end
      else begin
        if (script_action == 18) then begin
          set_global_var(6, 1);
        end
      end
    end
  do_dialogue: |
    start_gdialog(2, self_obj, 4, -1, -1);
    gsay_start;
    if ((global_var(6) != 0) or (global_var(4) != 0)) then begin
      set_global_var(0, 1);
      set_global_var(1, 1);
    end
    if (global_var(0)) then begin
      call elder07;
    end
    else begin
      if (global_var(1)) then begin
        call elder06;
      end
      else begin
        gsay_reply(2, 101);
        gsay_option(2, 102, elder01, 50);
        gsay_option(2, 103, elder02, 50);
      end
    end
    gsay_end;
    end_dialogue;
  elder01: |
    dialogue_reaction(-1);
    gsay_reply(2, 104);
    gsay_option(2, 105, elder03, 50);
  elder02: |
    dialogue_reaction(1);
    gsay_reply(2, 106);
    gsay_option(2, 107, elder03, 50);
  elder03: |
    gsay_reply(2, 108);
    gsay_option(2, 109, elder05, 50);
    gsay_option(2, 110, elder04, 50);
  elder04: |
    set_global_var(0, 1);
    set_global_var(1, 1);
    dialogue_reaction(1);
    gsay_reply(2, 111);
  elder05: |
    variable LVar0 := 0;
    set_global_var(1, 1);
    dialogue_reaction(-1);
    gsay_reply(2, 112);
    LVar0 := create_object_sid(1, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(10, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(34, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(34, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
  elder06: 'gsay_message(2, 113, 50);

    '
  elder07: |
    dialogue_reaction(1);
    gsay_message(2, 114, 50);
elevatr:
  start: |
    if (script_action == 2) then begin
      if (obj_type(source_obj) != 1) then begin
        detach;
      end
      if (local_var(0) == 0) then begin
        if (tile_distance(self_obj, source_obj) < 3) then begin
          set_local_var(0, 1);
          display_msg(message_str(0, 100));
        end
      end
      script_overrides;
    end
    detach;
emiter1a:
  start: "[]"
  use_p_proc: |
    script_overrides;
    display_msg(message_str(875, 100));
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(obj_being_used_with);
    if (local_var(0) == 0) then begin
      if (LVar0 == 75) then begin
        script_overrides;
        if (is_success(roll_vs_skill(dude_obj, 13, 0))) then begin
          if (map_var(16) == 1) then begin
            set_obj_visibility(Field1a_Ptr, 1);
            display_msg(message_str(875, 103));
            give_exp_points(50);
            set_map_var(16, 0);
          end
          else begin
            set_obj_visibility(Field1a_Ptr, 0);
            display_msg(message_str(875, 105));
            set_map_var(16, 1);
          end
        end
        else begin
          display_msg(message_str(875, 104));
        end
      end
    end
  use_skill_on_p_proc: |
    variable LVar0 := 0;
    LVar0 := action_being_used;
    if (local_var(0) == 0) then begin
      if (LVar0 == 13) then begin
        script_overrides;
        if (is_success(roll_vs_skill(dude_obj, 13, -20))) then begin
          if (map_var(16) == 1) then begin
            display_msg(message_str(875, 103));
            set_obj_visibility(Field1a_Ptr, 1);
            give_exp_points(50);
            set_map_var(16, 0);
          end
          else begin
            set_obj_visibility(Field1a_Ptr, 0);
            display_msg(message_str(875, 105));
            set_map_var(16, 1);
          end
        end
        else begin
          display_msg(message_str(875, 104));
        end
      end
    end
  damage_p_proc: |
    if (is_success(roll_vs_skill(dude_obj, 11, 0))) then begin
      set_local_var(0, 1);
      destroy_object(Field1a_Ptr);
      display_msg(message_str(875, 102));
    end
    else begin
      set_map_var(16, 0);
      set_obj_visibility(Field1a_Ptr, 1);
      display_msg(message_str(875, 101));
    end
falcon1:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(697, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(697, self_obj, 4, -1, -1);
    gsay_start;
    call Falcon00;
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 38);
      critter_add_trait(self_obj, 1, 5, 50);
    end
  Falcon00: |
    gsay_reply(697, 101);
    giq_option(4, 697, 102, Falcon05, 50);
    giq_option(4, 697, 103, Falcon06, 50);
    giq_option(4, 697, 104, Falcon07, 50);
    giq_option(4, 697, 106, Falcon04, 50);
    giq_option(-3, 697, 107, Falcon03, 50);
  Falcon01: 'gsay_message(697, 108, 50);

    '
  Falcon03: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(697, 110, 50);
    end
    else begin
      gsay_message(697, 111, 50);
    end
  Falcon04: 'gsay_message(697, 112, 50);

    '
  Falcon05: |
    gsay_reply(697, 113);
    giq_option(4, 697, 114, Falcon05a, 50);
    giq_option(4, 697, 115, Falcon11, 50);
  Falcon05a: |
    if (obj_is_carrying_obj_pid(dude_obj, 41) >= 2) then begin
      call Falcon09;
    end
    else begin
      call Falcon01;
    end
  Falcon06: |
    gsay_reply(697, 116);
    giq_option(4, 697, 117, Falcon06a, 50);
    giq_option(4, 697, 115, Falcon11, 50);
  Falcon06a: |
    if (obj_is_carrying_obj_pid(dude_obj, 41) < 5) then begin
      call Falcon01;
    end
    else begin
      call Falcon14;
    end
  Falcon07: |
    gsay_reply(697, 118);
    giq_option(4, 697, 117, Falcon07a, 50);
    giq_option(4, 697, 115, Falcon11, 50);
  Falcon07a: |
    if (obj_is_carrying_obj_pid(dude_obj, 41) < 10) then begin
      call Falcon01;
    end
    else begin
      call Falcon16;
    end
  Falcon09: |
    if (First_Water) then begin
      gsay_reply(697, message_str(697, 139) + message_str(697, 140) + message_str(697, 141));
    end
    else begin
      gsay_reply(697, message_str(697, 136) + message_str(697, 137) + message_str(697, 138));
    end
    Money_Pack := obj_carrying_pid_obj(dude_obj, 41);
    Money_Count := rm_mult_objs_from_inven(dude_obj, Money_Pack, 2);
    destroy_object(Money_Pack);
    First_Water := 1;
    call Falcon15;
  Falcon11: |
    if (random(0, 1)) then begin
      gsay_message(697, message_str(697, 151) + message_str(697, 152), 50);
    end
    else begin
      gsay_message(697, message_str(697, 153) + message_str(697, 154), 50);
    end
  Falcon14: |
    Money_Pack := obj_carrying_pid_obj(dude_obj, 41);
    Money_Count := rm_mult_objs_from_inven(dude_obj, Money_Pack, 5);
    destroy_object(Money_Pack);
    item := create_object_sid(124, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    gsay_reply(697, message_str(697, 160) + message_str(697, 161));
    call Falcon15;
  Falcon15: |
    giq_option(4, 697, 102, Falcon05, 50);
    giq_option(4, 697, 103, Falcon06, 50);
    giq_option(4, 697, 104, Falcon07, 50);
    giq_option(4, 697, 106, Falcon04, 50);
    giq_option(-3, 697, 107, Falcon03, 50);
  Falcon16: |
    Money_Pack := obj_carrying_pid_obj(dude_obj, 41);
    Money_Count := rm_mult_objs_from_inven(dude_obj, Money_Pack, 10);
    destroy_object(Money_Pack);
    item := create_object_sid(125, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    gsay_reply(697, message_str(697, 163) + message_str(697, 164));
    call Falcon15;
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
farli:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(315, 100));
    end
    else begin
      if (script_action == 18) then begin
        if (source_obj == dude_obj) then begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
            set_global_var(156, 1);
            set_global_var(157, 0);
          end
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
            set_global_var(157, 1);
            set_global_var(156, 0);
          end
          set_global_var(159, global_var(159) + 1);
          if ((global_var(159) % 2) == 0) then begin
            set_global_var(155, global_var(155) - 1);
          end
        end
      end
      else begin
        if (script_action == 11) then begin
          script_overrides;
          if (Herebefore > 1) then begin
            call farli4;
          end
          else begin
            if (Herebefore == 1) then begin
              Herebefore := Herebefore + 1;
              call farli3;
            end
            else begin
              Herebefore := Herebefore + 1;
              start_gdialog(315, self_obj, 4, -1, -1);
              gsay_start;
              call farli0;
              gsay_end;
              end_dialogue;
            end
          end
        end
      end
    end
  farli0: |
    gsay_reply(315, 101);
    giq_option(3, 315, 102, farli1, 50);
  farli1: |
    gsay_reply(315, 103);
    giq_option(3, 315, message_str(315, 104) + proto_data(obj_pid(dude_obj), 1) + message_str(315, 105), farli2, 50);
  farli2: |
    variable LVar0 := 0;
    gsay_message(315, 106, 50);
    LVar0 := create_object_sid(95, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
  farli3: 'float_msg(self_obj, message_str(315, 107), 0);

    '
  farli4: 'float_msg(self_obj, message_str(315, 108), 0);

    '
farmpart:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(681, 100));
    if (global_var(138) == 1) then begin
      if (is_success(roll_vs_skill(dude_obj, 12, 0))) then begin
        display_msg(message_str(681, 101));
      end
    end
feardark:
  start: "[]"
femfarmr:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 65);
      critter_add_trait(self_obj, 1, 5, 51);
      home_tile := 21931;
      sleep_tile := 26724;
    end
  critter_p_proc: |
    if (hostile and obj_can_see_obj(self_obj, dude_obj)) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((game_time_hour >= 600) and (game_time_hour < 1800)) then begin
      if (Sleeping == 1) then begin
        reg_anim_func(2, self_obj);
        Sleeping := 0;
        if ((tile_num(self_obj) != home_tile) and ((game_time_hour - 600) > 10)) then begin
          move_to(self_obj, home_tile, elevation(self_obj));
        end
      end
      else begin
        if ((tile_distance(home_tile, tile_num(self_obj)) > 8) and not(anim_busy(self_obj))) then begin
          animate_move_obj_to_tile(self_obj, home_tile, 0);
        end
        else begin
          if (not(in_timed_event)) then begin
            in_timed_event := 1;
            add_timer_event(self_obj, game_ticks(random(20, 30)), 1);
          end
        end
      end
    end
    else begin
      if (Sleeping == 0) then begin
        reg_anim_func(2, self_obj);
        Sleeping := 1;
        if ((tile_num(self_obj) != sleep_tile) and ((game_time_hour - 1800) > 10) or ((600 - game_time_hour) > 0)) then begin
          move_to(self_obj, sleep_tile, elevation(self_obj));
        end
      end
      else begin
        if ((tile_num(self_obj) != sleep_tile) and not(anim_busy(self_obj))) then begin
          animate_move_obj_to_tile(self_obj, sleep_tile, 0);
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if ((game_time_hour >= 600) and (game_time_hour < 1800)) then begin
      call Farmer00;
    end
    else begin
      call Farmer01;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(571, 100));
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      in_timed_event := 0;
      if ((game_time_hour >= 600) and (game_time_hour < 1800)) then begin
        animate_move_obj_to_tile(self_obj, tile_num_in_direction(home_tile, random(0, 5), random(1, 8)), 0);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  Farmer00: |
    variable LVar0 := 0;
    LVar0 := random(1, 5);
    if (LVar0 == 1) then begin
      float_msg(self_obj, message_str(571, 101), 2);
    end
    else begin
      if (LVar0 == 2) then begin
        if ((game_time_hour >= 600) and (game_time_hour < 1200)) then begin
          float_msg(self_obj, message_str(571, 102), 2);
        end
        else begin
          if ((game_time_hour >= 1200) and (game_time_hour < 1600)) then begin
            float_msg(self_obj, message_str(571, 103), 2);
          end
          else begin
            float_msg(self_obj, message_str(571, 104), 2);
          end
        end
      end
      else begin
        if (LVar0 == 3) then begin
          float_msg(self_obj, message_str(571, 105), 2);
        end
        else begin
          if (LVar0 == 4) then begin
            float_msg(self_obj, message_str(571, 106), 2);
          end
          else begin
            if (LVar0 == 5) then begin
              float_msg(self_obj, message_str(571, 107), 2);
            end
            else begin
              float_msg(self_obj, message_str(571, 108), 2);
            end
          end
        end
      end
    end
  Farmer01: 'float_msg(self_obj, message_str(571, random(109, 116)), 2);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
fevdisk:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(347, 100));
    end
  use_p_proc: |
    script_overrides;
    if (local_var(0) == 1) then begin
      display_msg(message_str(347, 101));
    end
    else begin
      display_msg(message_str(347, 102));
      set_global_var(162, 1);
      set_local_var(0, 1);
      rm_obj_from_inven(dude_obj, self_obj);
      display_msg(message_str(766, 103) + "100" + message_str(766, 104));
      give_exp_points(100);
    end
fgtcarvn:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(849, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: 'call FGTDriver10;

    '
  talk_p_proc: |
    variable LVar0 := 0;
    call get_reaction;
    if (local_var(10) == 1) then begin
      if (local_var(7) < (game_time / (10 * 60 * 60 * 24 * 365))) then begin
        set_local_var(10, 0);
      end
      else begin
        if ((local_var(6) < get_month) or (local_var(6) == 12) and (get_month == 1) and ((local_var(6) != 1) or (get_month != 12))) then begin
          set_local_var(10, 0);
        end
        else begin
          if ((local_var(5) < get_day) and ((local_var(6) != 1) or (get_month != 12))) then begin
            set_local_var(10, 0);
          end
        end
      end
    end
    call RecalcDate;
    LVar0 := local_var(5);
    if (local_var(8) > 0) then begin
      call FGTDriver14;
    end
    else begin
      if (map_var(35) == 1) then begin
        call FGTDriver15;
      end
      else begin
        if (global_var(206) == 3) then begin
          call BottomReact;
          start_gdialog(849, self_obj, 4, -1, -1);
          gsay_start;
          call FGTDriver37;
          gsay_end;
          end_dialogue;
        end
        else begin
          if (global_var(206) == 5) then begin
            start_gdialog(849, self_obj, 4, -1, -1);
            gsay_start;
            call FGTDriver19;
            gsay_end;
            end_dialogue;
          end
          else begin
            if (global_var(206) == 4) then begin
              call TopReact;
              start_gdialog(849, self_obj, 4, -1, -1);
              gsay_start;
              call FGTDriver27;
              gsay_end;
              end_dialogue;
            end
            else begin
              if (map_var(36) == 0) then begin
                call FGTDriver00;
              end
              else begin
                if ((map_var(36) == 1) and (local_var(10) == 0)) then begin
                  start_gdialog(849, self_obj, 4, -1, -1);
                  gsay_start;
                  if (local_var(9) == 0) then begin
                    call FGTDriver01;
                  end
                  else begin
                    call FGTDriver03;
                  end
                  gsay_end;
                  end_dialogue;
                end
                else begin
                  if ((local_var(10) == 1) and (LVar0 == get_day)) then begin
                    start_gdialog(849, self_obj, 4, -1, -1);
                    gsay_start;
                    call FGTDriver28;
                    gsay_end;
                    end_dialogue;
                  end
                  else begin
                    if ((local_var(10) == 1) and (LVar0 != get_day)) then begin
                      start_gdialog(849, self_obj, 4, -1, -1);
                      gsay_start;
                      call FGTDriver29;
                      gsay_end;
                      end_dialogue;
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    set_local_var(4, 1);
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 37);
      critter_add_trait(self_obj, 1, 5, 50);
    end
  combat: 'hostile := 1;

    '
  RecalcDate: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    LVar0 := get_day;
    if ((LVar0 >= 1) and (LVar0 <= 8)) then begin
      LVar0 := 8;
      LVar1 := get_month;
      LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
    end
    else begin
      if ((LVar0 > 8) and (LVar0 <= 18)) then begin
        LVar0 := 18;
        LVar1 := get_month;
        LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
      end
      else begin
        if ((LVar0 > 18) and (LVar0 <= 28)) then begin
          LVar0 := 28;
          LVar1 := get_month;
          LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
        end
        else begin
          if (LVar0 > 28) then begin
            LVar0 := 8;
            LVar1 := get_month;
            if (LVar1 == 12) then begin
              LVar1 := 1;
              LVar2 := (game_time / (10 * 60 * 60 * 24 * 365)) + 1;
            end
            else begin
              LVar1 := LVar1 + 1;
              LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
            end
          end
        end
      end
    end
    set_local_var(5, LVar0);
    set_local_var(6, LVar1);
    set_local_var(7, LVar2);
  RecalcDateString: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    call RecalcDate;
    LVar0 := local_var(6);
    LVar1 := local_var(5);
    if (LVar0 == 1) then begin
      DayString := message_str(849, 204);
    end
    else begin
      if (LVar0 == 2) then begin
        DayString := message_str(849, 205);
      end
      else begin
        if (LVar0 == 3) then begin
          DayString := message_str(849, 206);
        end
        else begin
          if (LVar0 == 4) then begin
            DayString := message_str(849, 207);
          end
          else begin
            if (LVar0 == 5) then begin
              DayString := message_str(849, 208);
            end
            else begin
              if (LVar0 == 6) then begin
                DayString := message_str(849, 209);
              end
              else begin
                if (LVar0 == 7) then begin
                  DayString := message_str(849, 210);
                end
                else begin
                  if (LVar0 == 8) then begin
                    DayString := message_str(849, 211);
                  end
                  else begin
                    if (LVar0 == 9) then begin
                      DayString := message_str(849, 212);
                    end
                    else begin
                      if (LVar0 == 10) then begin
                        DayString := message_str(849, 213);
                      end
                      else begin
                        if (LVar0 == 11) then begin
                          DayString := message_str(849, 214);
                        end
                        else begin
                          if (LVar0 == 12) then begin
                            DayString := message_str(849, 215);
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    if (LVar1 == 8) then begin
      DayString := DayString + message_str(849, 197);
    end
    else begin
      if (LVar1 == 18) then begin
        DayString := DayString + message_str(849, 198);
      end
      else begin
        if (LVar1 == 28) then begin
          DayString := DayString + message_str(849, 199);
        end
      end
    end
  FGTDriver00: |
    if (local_var(4) == 0) then begin
      float_msg(self_obj, message_str(849, 101), 2);
      set_local_var(4, 1);
    end
    else begin
      float_msg(self_obj, message_str(849, 102), 2);
    end
  FGTDriver01: |
    if (global_var(71) == 0) then begin
      set_global_var(71, 1);
    end
    if (global_var(75) == 0) then begin
      set_global_var(75, 1);
    end
    if (global_var(74) == 0) then begin
      set_global_var(74, 1);
    end
    gsay_reply(849, 103);
    giq_option(4, 849, 104, FGTDriver02, 50);
    giq_option(-3, 849, 105, FGTDriver02, 50);
  FGTDriver02: |
    variable LVar0 := 0;
    call RecalcDateString;
    LVar0 := local_var(5);
    if (LVar0 == get_day) then begin
      gsay_reply(849, message_str(849, 106) + message_str(849, 107));
    end
    else begin
      gsay_reply(849, message_str(849, 106) + message_str(849, 108) + DayString + message_str(849, 111));
    end
    call FGTDriver04;
  FGTDriver03: |
    variable LVar0 := 0;
    if (local_var(1) != 1) then begin
      call RecalcDateString;
      LVar0 := local_var(5);
      if (LVar0 == get_day) then begin
        gsay_reply(849, message_str(849, 107));
      end
      else begin
        gsay_reply(849, message_str(849, 108) + DayString + message_str(849, 111));
      end
      call FGTDriver04;
    end
    else begin
      gsay_reply(849, 112);
      call FGTDriver04;
    end
  FGTDriver04: |
    giq_option(4, 849, 113, FGTDriver04a, 50);
    giq_option(4, 849, 114, FGTDriver05, 50);
    giq_option(4, 849, 115, FGTDriver06, 50);
    giq_option(-3, 849, 116, FGTDriver07, 50);
    giq_option(-3, 849, 117, FGTDriver07, 50);
  FGTDriver04a: |
    variable LVar0 := 0;
    set_local_var(10, 1);
    call RecalcDate;
    LVar0 := local_var(5);
    if (LVar0 == get_day) then begin
      call FGTDriver17;
    end
    else begin
      call FGTDriver18;
    end
  FGTDriver05: |
    set_local_var(10, 0);
    gsay_message(849, 118, 50);
  FGTDriver06: |
    set_local_var(10, 0);
    gsay_message(849, 120, 50);
  FGTDriver07: 'gsay_message(849, 121, 50);

    '
  FGTDriver08: 'gsay_message(849, 123, 50);

    '
  FGTDriver10: |
    if (local_var(8) == 0) then begin
      set_local_var(8, 1);
      set_map_var(35, 1);
      set_map_var(10, 0);
      gsay_reply(849, 125);
      giq_option(4, 849, 126, FGTDriver08, 50);
      giq_option(4, 849, 127, FGTDriver10a, 50);
      giq_option(4, 849, 128, FGTDriver31, 51);
      giq_option(-3, 849, 130, FGTDriver31, 51);
    end
    else begin
      gsay_message(849, 131, 51);
      call combat;
    end
  FGTDriver10a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 20)) == 1) then begin
      call FGTDriver11;
    end
    else begin
      call FGTDriver12;
    end
  FGTDriver11: |
    set_map_var(36, 0);
    set_map_var(35, 1);
    set_map_var(10, 0);
    gsay_message(849, 132, 50);
  FGTDriver12: |
    gsay_message(849, 133, 51);
    call combat;
  FGTDriver14: |
    if (local_var(8) > 0) then begin
      float_msg(self_obj, message_str(849, 138), 2);
    end
    else begin
      float_msg(self_obj, message_str(849, 139), 2);
      call FGTDriver31;
    end
  FGTDriver15: |
    variable LVar0 := 0;
    LVar0 := random(1, 4);
    if (LVar0 == 1) then begin
      float_msg(self_obj, message_str(849, 140), 2);
    end
    else begin
      if (LVar0 == 2) then begin
        float_msg(self_obj, message_str(849, 141), 2);
      end
      else begin
        if (LVar0 == 3) then begin
          float_msg(self_obj, message_str(849, 142), 2);
        end
        else begin
          if (LVar0 == 4) then begin
            float_msg(self_obj, message_str(849, 143), 2);
          end
        end
      end
    end
  FGTDriver17: |
    gsay_reply(849, 145);
    call FGTDriver33;
    call FGTDriver20;
  FGTDriver18: |
    call RecalcDateString;
    gsay_reply(849, message_str(849, 146) + DayString + message_str(849, 153));
    giq_option(4, 849, 154, FGTDriver30, 50);
    giq_option(4, 849, 155, FGTDriver34, 50);
  FGTDriver19: |
    set_map_var(35, 1);
    set_map_var(10, 0);
    set_global_var(206, 6);
    gsay_message(849, 156, 51);
  FGTDriver20: |
    giq_option(4, 849, 157, FGTDriver21a, 50);
    giq_option(4, 849, 158, FGTDriver21b, 50);
    giq_option(4, 849, 152, FGTDriver21c, 50);
    giq_option(4, 849, 159, FGTDriver34, 50);
  FGTDriver21a: |
    variable LVar0 := 0;
    set_global_var(201, 1);
    LVar0 := random(1, 7);
    if (LVar0 == 1) then begin
      gsay_message(849, 160, 50);
    end
    else begin
      if (LVar0 == 2) then begin
        gsay_message(849, 161, 50);
      end
      else begin
        if (LVar0 == 3) then begin
          gsay_message(849, 162, 50);
        end
        else begin
          if (LVar0 == 4) then begin
            gsay_message(849, 163, 50);
          end
          else begin
            if (LVar0 == 5) then begin
              gsay_message(849, 167, 50);
            end
            else begin
              if (LVar0 == 6) then begin
                gsay_message(849, 168, 50);
              end
              else begin
                if (LVar0 == 7) then begin
                  gsay_message(849, 169, 50);
                end
              end
            end
          end
        end
      end
    end
    LVar0 := do_check(dude_obj, 6, -4);
    if (is_success(LVar0)) then begin
      set_global_var(201, 2);
      set_global_var(215, 1);
      set_global_var(216, 2);
      load_map(10, 1);
    end
    else begin
      load_map(58, 3);
    end
  FGTDriver21b: |
    variable LVar0 := 0;
    set_global_var(201, 1);
    LVar0 := random(1, 7);
    if (LVar0 == 1) then begin
      gsay_message(849, 160, 50);
    end
    else begin
      if (LVar0 == 2) then begin
        gsay_message(849, 161, 50);
      end
      else begin
        if (LVar0 == 3) then begin
          gsay_message(849, 162, 50);
        end
        else begin
          if (LVar0 == 4) then begin
            gsay_message(849, 163, 50);
          end
          else begin
            if (LVar0 == 5) then begin
              gsay_message(849, 164, 50);
            end
            else begin
              if (LVar0 == 6) then begin
                gsay_message(849, 165, 50);
              end
              else begin
                if (LVar0 == 7) then begin
                  gsay_message(849, 166, 50);
                end
              end
            end
          end
        end
      end
    end
    LVar0 := do_check(dude_obj, 6, -4);
    if (is_success(LVar0)) then begin
      set_global_var(201, 2);
      set_global_var(215, 1);
      set_global_var(216, 2);
      load_map(28, 1);
    end
    else begin
      load_map(56, 3);
    end
  FGTDriver21c: |
    variable LVar0 := 0;
    set_global_var(201, 1);
    LVar0 := random(1, 8);
    if (LVar0 == 1) then begin
      gsay_message(849, 160, 50);
    end
    else begin
      if (LVar0 == 2) then begin
        gsay_message(849, 161, 50);
      end
      else begin
        if (LVar0 == 3) then begin
          gsay_message(849, 162, 50);
        end
        else begin
          if (LVar0 == 4) then begin
            gsay_message(849, 163, 50);
          end
          else begin
            if (LVar0 == 5) then begin
              gsay_message(849, 216, 50);
            end
            else begin
              if (LVar0 == 6) then begin
                gsay_message(849, 217, 50);
              end
              else begin
                if (LVar0 == 7) then begin
                  gsay_message(849, 218, 50);
                end
                else begin
                  if (LVar0 == 8) then begin
                    gsay_message(849, 219, 50);
                  end
                end
              end
            end
          end
        end
      end
    end
    LVar0 := do_check(dude_obj, 6, -4);
    if (is_success(LVar0)) then begin
      set_global_var(201, 2);
      set_global_var(215, 1);
      set_global_var(216, 2);
      load_map(13, 1);
    end
    else begin
      load_map(59, 3);
    end
  FGTDriver27: |
    gsay_reply(849, 185);
    giq_option(4, 849, 186, FGTDriver04a, 50);
    giq_option(4, 849, 187, FGTDriver05, 50);
    giq_option(4, 849, 188, FGTDriver06, 50);
    giq_option(-3, 849, 189, FGTDriver07, 50);
    giq_option(-3, 849, 190, FGTDriver07, 50);
  FGTDriver28: |
    gsay_reply(849, 191);
    giq_option(4, 849, 192, FGTDriver17, 50);
    giq_option(4, 849, 193, FGTDriver35, 50);
    giq_option(-3, 849, 194, FGTDriver07, 50);
  FGTDriver29: |
    variable LVar0 := 0;
    call RecalcDateString;
    LVar0 := local_var(5);
    gsay_message(849, message_str(849, 196) + DayString + message_str(849, 203) + message_str(849, 195), 50);
  FGTDriver30: 'set_local_var(10, 1);

    '
  FGTDriver31: 'call combat;

    '
  FGTDriver33: |
    variable LVar0 := 0;
    set_local_var(10, 0);
    set_global_var(206, 1);
    LVar0 := local_var(9);
    set_local_var(9, LVar0 + 1);
  FGTDriver34: 'set_local_var(10, 0);

    '
  FGTDriver35: "[]"
  FGTDriver37: |
    set_map_var(35, 1);
    set_map_var(10, 0);
    set_global_var(206, 6);
    gsay_reply(849, 170);
    giq_option(4, 849, 171, FGTDriver38, 50);
    giq_option(4, 849, 172, FGTDriverEnd, 50);
    giq_option(4, 849, 173, FGTDriver39, 50);
    giq_option(-3, 849, 174, FGTDriver40, 50);
    giq_option(-3, 849, 175, FGTDriverEnd, 50);
  FGTDriver38: |
    gsay_reply(849, 177);
    giq_option(4, 849, 178, FGTDriverEnd, 50);
    giq_option(4, 849, 179, combat, 51);
    giq_option(4, 849, 180, FGTDriver41, 50);
    giq_option(4, 849, 181, FGTDriver42, 50);
  FGTDriver39: 'gsay_message(849, 176, 50);

    '
  FGTDriver40: 'gsay_message(849, 182, 50);

    '
  FGTDriver41: 'gsay_message(849, 183, 50);

    '
  FGTDriver42: |
    set_map_var(35, 0);
    set_map_var(10, 1);
    set_global_var(206, 1);
    gsay_message(849, 184, 50);
  FGTDriverEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
fgtgard:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(572, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if ((game_time_hour >= 600) and (game_time_hour < 700) or ((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
      if (global_var(106) != 2) then begin
        float_msg(self_obj, message_str(572, random(101, 109)), 2);
      end
      else begin
        if (random(0, 1)) then begin
          float_msg(self_obj, message_str(572, random(101, 106)), 2);
        end
        else begin
          float_msg(self_obj, message_str(572, random(110, 112)), 2);
        end
      end
    end
    else begin
      float_msg(self_obj, message_str(572, random(113, 119)), 2);
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 37);
      critter_add_trait(self_obj, 1, 5, 18);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
fielda:
  start: |
    if (not(initialized)) then begin
      if (elevation(self_obj) == 0) then begin
        if (tile_num(self_obj) == 17106) then begin
          set_map_var(0, self_obj);
        end
        else begin
          if (tile_num(self_obj) == 17082) then begin
            set_map_var(1, self_obj);
          end
          else begin
            if (tile_num(self_obj) == 26710) then begin
              set_map_var(2, self_obj);
            end
          end
        end
      end
      else begin
        if (tile_num(self_obj) == 15520) then begin
          set_map_var(3, self_obj);
        end
      end
      set_local_var(1, tile_num(self_obj));
      call use_p_proc;
      initialized := 1;
    end
    else begin
      if (script_action == 6) then begin
        call use_p_proc;
      end
    end
  use_p_proc: |
    if (global_var(609)) then begin
      field_change := "off";
    end
    if (source_obj != dude_obj) then begin
      if (field_change == "toggle") then begin
        call toggle_field;
      end
      else begin
        if (field_change == "off") then begin
          call turn_field_off;
        end
        else begin
          if (field_change == "on") then begin
            call turn_field_on;
          end
        end
      end
    end
  turn_field_on: |
    set_obj_visibility(self_obj, 0);
    set_local_var(0, 0);
  turn_field_off: |
    set_obj_visibility(self_obj, 1);
    set_local_var(0, 1);
  toggle_field: |
    if (local_var(0) == 1) then begin
      call turn_field_on;
    end
    else begin
      call turn_field_off;
    end
fieldgen:
  start: |
    if (script_action == 7) then begin
      call use_obj_on_p_proc;
    end
    else begin
      if (script_action == 8) then begin
        call use_skill_on_p_proc;
      end
    end
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 75) then begin
      script_overrides;
      if (is_success(roll_vs_skill(dude_obj, 13, 0))) then begin
        call turn_field_off;
      end
      else begin
        display_msg(message_str(741, 100));
      end
    end
  use_skill_on_p_proc: |
    if (action_being_used == 13) then begin
      script_overrides;
      if (is_success(roll_vs_skill(dude_obj, 13, -20))) then begin
        call turn_field_off;
      end
      else begin
        display_msg(message_str(741, 100));
      end
    end
  turn_field_off: |
    field_change := "off";
    display_msg(message_str(741, 101));
    if (cur_map_index == 31) then begin
      if (elevation(self_obj) == 0) then begin
        if (tile_num(self_obj) == 15581) then begin
          use_obj(map_var(4));
        end
        else begin
          if (tile_num(self_obj) == 19124) then begin
            use_obj(map_var(5));
          end
          else begin
            if (tile_num(self_obj) == 25098) then begin
              use_obj(map_var(6));
            end
          end
        end
      end
    end
    else begin
      if (cur_map_index == 32) then begin
      end
    end
fire:
  start: |
    if (script_action == 12) then begin
      call critter_p_proc;
    end
    else begin
      if (script_action == 18) then begin
        call destroy_p_proc;
      end
      else begin
        if (script_action == 21) then begin
          call look_at_p_proc;
        end
        else begin
          if (script_action == 23) then begin
            call map_update_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj) and (global_var(136) < 41)) then begin
      hostile := 1;
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    set_global_var(136, global_var(136) - 1);
    set_global_var(131, 0);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    if ((global_var(135) == 2) or (get_critter_stat(dude_obj, 6) > 6)) then begin
      call show_true_name;
    end
    else begin
      if (get_critter_stat(dude_obj, 6) < 4) then begin
        call show_false_name;
      end
      else begin
        if (get_critter_stat(dude_obj, 4) < 5) then begin
          call show_false_name;
        end
        else begin
          if (random(0, 1)) then begin
            call show_false_name;
          end
          else begin
            call show_true_name;
          end
        end
      end
    end
  map_update_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 5, 27);
      if (cur_map_index == 44) then begin
        critter_add_trait(self_obj, 1, 6, 47);
      end
      else begin
        if ((cur_map_index == 17) or (cur_map_index == 18)) then begin
          party_add(self_obj);
          if (global_var(131) == 1) then begin
            set_obj_visibility(self_obj, 0);
            critter_add_trait(self_obj, 1, 6, 0);
            add_timer_event(self_obj, game_ticks(1), 1);
          end
          else begin
            set_obj_visibility(self_obj, 1);
          end
        end
        else begin
          if ((cur_map_index != 17) and (cur_map_index != 18)) then begin
            party_remove(self_obj);
          end
        end
      end
      initialized := 1;
    end
    if ((elevation(self_obj) != elevation(dude_obj)) and (global_var(131) == 1)) then begin
      move_to(self_obj, tile_num_in_direction(tile_num(dude_obj), random(4, 5), 1), elevation(dude_obj));
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    start_gdialog(280, self_obj, 4, -1, -1);
    gsay_start;
    set_local_var(4, 1);
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      call Fire18;
    end
    else begin
      if (global_var(135) == 2) then begin
        call Fire21;
      end
      else begin
        if (global_var(135) == 1) then begin
          if (global_var(131) == 1) then begin
            call Fire19;
          end
          else begin
            call Fire20;
          end
        end
        else begin
          call Fire00;
        end
      end
    end
    gsay_end;
    end_dialogue;
  Fire00: |
    gsay_reply(280, 111);
    giq_option(-3, 280, 112, Fire01, 50);
    giq_option(4, 280, 113, Fire07, 50);
    giq_option(6, 280, 114, Fire11, 50);
    giq_option(5, 280, 115, FireCombat, 50);
    giq_option(4, 280, 116, FireEnd, 50);
    giq_option(6, 280, 117, Fire17, 50);
  Fire01: |
    gsay_reply(280, 118);
    giq_option(-3, 280, 119, Fire02, 50);
    giq_option(-3, 280, 120, Fire05, 50);
    giq_option(-3, 280, 121, Fire06, 50);
  Fire02: |
    gsay_reply(280, 122);
    giq_option(-3, 280, 123, Fire03, 50);
    giq_option(-3, 280, 124, Fire04, 50);
  Fire03: 'gsay_message(280, 125, 50);

    '
  Fire04: |
    gsay_message(280, 126, 50);
    call FireCombat;
  Fire05: |
    gsay_message(280, 127, 50);
    call FireCombat;
  Fire06: 'gsay_message(280, 128, 50);

    '
  Fire07: |
    gsay_reply(280, 129);
    giq_option(4, 280, 130, FireEnd, 50);
    giq_option(4, 280, 131, Fire08, 50);
    giq_option(5, 280, 132, Fire09, 50);
    giq_option(7, 280, 133, Fire10, 50);
  Fire08: |
    gsay_message(280, 134, 50);
    call FireCombat;
  Fire09: |
    gsay_reply(280, 135);
    giq_option(5, 280, 136, FireEnd, 50);
    giq_option(5, 280, 137, Fire08, 50);
  Fire10: 'gsay_message(280, 138, 50);

    '
  Fire11: |
    gsay_reply(280, 139);
    giq_option(6, 280, 140, Fire12, 50);
    giq_option(6, 280, 141, Fire15, 50);
    giq_option(6, 280, 142, Fire16, 50);
  Fire12: |
    gsay_reply(280, 143);
    giq_option(6, 280, 144, Fire13, 50);
    giq_option(6, 280, 145, Fire14, 50);
  Fire13: 'gsay_message(280, 146, 50);

    '
  Fire14: |
    gsay_message(280, 147, 50);
    call FireCombat;
  Fire15: 'gsay_message(280, 148, 50);

    '
  Fire16: |
    gsay_message(280, 149, 50);
    call FireCombat;
  Fire17: |
    gsay_message(280, 150, 50);
    call FireCombat;
  Fire18: |
    gsay_message(280, 151, 50);
    add_timer_event(self_obj, game_ticks(10), 2);
  Fire19: 'gsay_message(280, 152, 50);

    '
  Fire20: 'gsay_message(280, 153, 50);

    '
  Fire21: 'gsay_message(280, 154, 50);

    '
  FireCombat: 'hostile := 1;

    '
  FireEnd: "[]"
  follow_player: |
    variable LVar0 := 0;
    prev_tile := dest_tile;
    LVar0 := (has_trait(1, dude_obj, 10) + random(4, 5)) % 6;
    dest_tile := tile_num_in_direction(tile_num(dude_obj), LVar0, random(2, 3));
    if (tile_distance(prev_tile, tile_num(dude_obj)) > tile_distance(dest_tile, tile_num(dude_obj))) then begin
      if (tile_distance_objs(self_obj, dude_obj) > 8) then begin
        animate_move_obj_to_tile(self_obj, dest_tile, 1 bwor 16);
      end
      else begin
        animate_move_obj_to_tile(self_obj, dest_tile, 0 bwor 16);
      end
    end
    else begin
      if (tile_distance_objs(self_obj, dude_obj) > 8) then begin
        animate_move_obj_to_tile(self_obj, dest_tile, 1);
      end
      else begin
        animate_move_obj_to_tile(self_obj, dest_tile, 0);
      end
    end
    if (tile_distance_objs(self_obj, dude_obj) > 3) then begin
      add_timer_event(self_obj, game_ticks(1), 1);
    end
    else begin
      add_timer_event(self_obj, game_ticks(random(2, 5)), 1);
    end
  show_true_name: |
    script_overrides;
    if (local_var(4)) then begin
      display_msg(message_str(280, 100));
    end
    else begin
      display_msg(message_str(280, 103));
    end
  show_false_name: |
    script_overrides;
    display_msg(message_str(280, random(104, 110)));
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      call follow_player;
    end
    else begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        hostile := 1;
      end
    end
fishrman:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 6);
      hostile := global_var(334);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 14) then begin
          call damage_p_proc;
        end
        else begin
          if (script_action == 18) then begin
            call destroy_p_proc;
          end
          else begin
            if (script_action == 21) then begin
              call look_at_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (dude_enemy) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        hostile := 1;
        set_global_var(334, 1);
      end
    end
  damage_p_proc: |
    dude_enemy := 1;
    set_global_var(334, 1);
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(644, 100));
  pickup_p_proc: |
    dude_enemy := 1;
    hostile := 1;
    set_global_var(334, 1);
  talk_p_proc: |
    call get_reaction;
    if (dude_enemy) then begin
      float_msg(self_obj, message_str(669, 101), 0);
    end
    else begin
      if ((local_var(1) < 2) or (global_var(158) > 2) or (global_var(155) < -30)) then begin
        call FishrMan00;
      end
      else begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
          call FishrMan25;
        end
        else begin
          start_gdialog(644, self_obj, 4, -1, -1);
          gsay_start;
          if (known) then begin
            call FishrMan03;
          end
          else begin
            if (global_var(155) >= 30) then begin
              call FishrMan02;
            end
            else begin
              call FishrMan01;
            end
          end
          gsay_end;
          end_dialogue;
        end
      end
    end
  FishrMan00: 'float_msg(self_obj, message_str(644, 101 + (get_critter_stat(dude_obj,
    34) == 1)), 0);

    '
  FishrMan01: |
    known := 1;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(644, 103);
    end
    else begin
      gsay_reply(644, 104);
    end
    if ((global_var(101) == 1) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 644, 105, FishrMan04, 50);
    end
    giq_option(7, 644, 106, FishrMan05, 50);
    giq_option(4, 644, 107, FishrMan06, 50);
    giq_option(4, 644, 108, FishrMan07, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 644, 109, FishrMan08, 51);
    end
    giq_option(-3, 644, 110, FishrMan09, 50);
  FishrMan02: |
    known := 1;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(644, 111);
    end
    else begin
      gsay_reply(644, 112);
    end
    if ((global_var(101) == 1) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 644, 105, FishrMan04, 50);
    end
    giq_option(7, 644, 106, FishrMan05, 50);
    giq_option(4, 644, 108, FishrMan07, 50);
    giq_option(4, 644, 113, FishrMan13, 50);
    giq_option(-3, 644, 110, FishrMan14, 50);
  FishrMan03: |
    gsay_reply(644, 114);
    giq_option(4, 644, 115, FishrMan15, 51);
    giq_option(4, 644, 116, FishrMan16, 50);
    giq_option(4, 644, 117, FishrMan03a, 50);
    giq_option(-3, 644, 110, FishrMan19, 50);
  FishrMan03a: |
    if (get_critter_stat(dude_obj, 3) >= 6) then begin
      call FishrMan17;
    end
    else begin
      call FishrMan18;
    end
  FishrMan04: |
    gsay_reply(644, 118);
    giq_option(0, 634, 106, FishrMan04a, 50);
  FishrMan04a: |
    gsay_reply(644, 119);
    giq_option(0, 634, 106, FishrMan04b, 50);
  FishrMan04b: |
    gsay_reply(644, 120);
    giq_option(0, 634, 106, FishrManEnd1, 50);
  FishrMan05: |
    gsay_reply(644, 122);
    giq_option(0, 634, 106, FishrMan05a, 50);
  FishrMan05a: |
    gsay_reply(644, 123);
    giq_option(0, 634, 106, FishrManEnd1, 50);
  FishrMan06: |
    gsay_reply(644, 124);
    giq_option(0, 634, 106, FishrManEnd1, 50);
  FishrMan07: |
    gsay_reply(644, 125);
    giq_option(0, 634, 106, FishrMan07a, 50);
  FishrMan07a: |
    gsay_reply(644, 126);
    giq_option(0, 634, 106, FishrManEnd1, 50);
  FishrMan08: |
    call DownReactLevel;
    call DownReactLevel;
    gsay_reply(644, 127);
    giq_option(4, 644, 128, FishrMan08a, 51);
    giq_option(4, 644, 129, FishrManCombat, 51);
    giq_option(4, 644, 130, FishrMan22, 50);
  FishrMan08a: |
    if ((get_critter_stat(dude_obj, 0) >= 8) or obj_is_carrying_obj_pid(dude_obj, 11) or obj_is_carrying_obj_pid(dude_obj, 12) or obj_is_carrying_obj_pid(dude_obj, 13) or obj_is_carrying_obj_pid(dude_obj, 118) or obj_is_carrying_obj_pid(dude_obj, 15)) then begin
      call FishrMan20;
    end
    else begin
      call FishrMan21;
    end
  FishrMan09: |
    gsay_reply(644, 131 + (get_critter_stat(dude_obj, 34) == 1));
    giq_option(0, 634, 106, FishrMan09a, 50);
  FishrMan09a: |
    variable LVar0 := 0;
    if (obj_is_carrying_obj_pid(self_obj, 109)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 109);
      rm_obj_from_inven(self_obj, LVar0);
      add_obj_to_inven(dude_obj, LVar0);
      gsay_message(644, 133, 50);
    end
    else begin
      gsay_message(644, 134, 50);
    end
  FishrMan10: |
    gsay_reply(644, 135);
    giq_option(0, 634, 106, FishrManEnd2, 50);
  FishrMan11: |
    gsay_reply(644, 137);
    giq_option(0, 634, 106, FishrManEnd2, 50);
  FishrMan12: |
    gsay_reply(644, 138);
    giq_option(0, 634, 106, FishrMan12a, 50);
  FishrMan12a: |
    gsay_reply(644, 139);
    giq_option(0, 634, 106, FishrManEnd2, 50);
  FishrMan13: |
    gsay_reply(644, 140);
    call FishrManBarter;
  FishrMan14: |
    gsay_reply(644, 141);
    giq_option(0, 634, 106, FishrManEnd2, 50);
  FishrMan15: |
    gsay_reply(644, 142);
    giq_option(0, 634, 106, FishrMan15a, 50);
  FishrMan15a: 'gsay_message(644, 143, 50);

    '
  FishrMan16: 'gsay_message(644, 144, 50);

    '
  FishrMan17: |
    gsay_reply(644, 145);
    if ((global_var(101) == 1) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 644, 146, FishrMan04, 50);
    end
    giq_option(4, 644, 147, FishrMan11, 50);
    giq_option(4, 644, 148, FishrMan23, 50);
    giq_option(4, 644, 149, FishrMan24, 50);
    giq_option(4, 644, 108, FishrMan07, 50);
  FishrMan18: 'gsay_message(644, 150, 50);

    '
  FishrMan19: 'gsay_message(644, 151, 50);

    '
  FishrMan20: |
    gsay_reply(644, 152);
    call FishrManBarter;
  FishrMan21: |
    gsay_message(644, 153, 51);
    call FishrManCombat;
  FishrMan22: 'gsay_message(644, 154, 51);

    '
  FishrMan23: 'gsay_message(644, 155, 50);

    '
  FishrMan24: 'gsay_message(644, 156, 50);

    '
  FishrMan25: 'float_msg(self_obj, message_str(644, 157), 0);

    '
  FishrManBarter: |
    gdialog_mod_barter(0);
    giq_option(0, 634, 100, FishrManEnd, 50);
  FishrManCombat: |
    hostile := 1;
    set_global_var(334, 1);
  FishrManEnd: "[]"
  FishrManEnd1: 'gsay_message(644, 121, 50);

    '
  FishrManEnd2: 'gsay_message(644, 136, 50);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
fishrson:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 68);
      dude_enemy := global_var(334);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 14) then begin
          call damage_p_proc;
        end
        else begin
          if (script_action == 18) then begin
            call destroy_p_proc;
          end
          else begin
            if (script_action == 21) then begin
              call look_at_p_proc;
            end
            else begin
              if (script_action == 4) then begin
                call pickup_p_proc;
              end
              else begin
                if (script_action == 11) then begin
                  call talk_p_proc;
                end
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (dude_enemy and (tile_distance_objs(dude_obj, self_obj) < 8)) then begin
      call flee_dude;
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      dude_enemy := 1;
      set_global_var(334, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
      set_global_var(158, global_var(158) + 1);
      set_global_var(155, global_var(155) - 1);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(645, 100));
  pickup_p_proc: |
    dude_enemy := 1;
    set_global_var(334, 1);
  talk_p_proc: |
    call get_reaction;
    if (dude_enemy) then begin
      float_msg(self_obj, message_str(669, 103), 0);
    end
    else begin
      if ((global_var(158) > 2) or (local_var(1) < 2) or (global_var(155) < -30)) then begin
        call FishrSon00;
      end
      else begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
          call FishrSon01;
        end
        else begin
          start_gdialog(645, self_obj, 4, -1, -1);
          gsay_start;
          if (known or (global_var(155) < 30)) then begin
            call FishrSon04;
          end
          else begin
            call FishrSon02;
          end
          gsay_end;
          end_dialogue;
        end
      end
    end
  FishrSon00: 'float_msg(self_obj, message_str(645, 101), 0);

    '
  FishrSon01: 'float_msg(self_obj, message_str(645, 102), 0);

    '
  FishrSon02: |
    known := 1;
    gsay_reply(645, 103);
    call FishrSon02a;
  FishrSon02a: |
    giq_option(4, 645, 104, FishrSon06, 50);
    giq_option(4, 645, 105, FishrSon07, 50);
    giq_option(4, 645, 106, FishrSon08, 50);
    giq_option(4, 645, 107, FishrSon10, 50);
    giq_option(-3, 645, 108, FishrSon09, 50);
  FishrSon03: |
    known := 1;
    gsay_reply(645, 109);
    giq_option(4, 645, 110, FishrSon05, 50);
    call FishrSon02a;
  FishrSon04: |
    gsay_reply(645, 111);
    giq_option(4, 645, 110, FishrSon05, 50);
    call FishrSon02a;
  FishrSon05: |
    gsay_reply(645, 112);
    giq_option(0, 634, 106, FishrSon05a, 50);
  FishrSon05a: |
    gsay_reply(645, 113);
    giq_option(4, 645, 104, FishrSon06, 50);
    giq_option(4, 645, 105, FishrSon07, 50);
    giq_option(4, 645, 106, FishrSon08, 50);
    giq_option(4, 645, 114, FishrSon12, 50);
    giq_option(4, 645, 115, FishrSon13, 50);
  FishrSon06: |
    gsay_reply(645, 116);
    giq_option(4, 645, 117, FishrSon14, 50);
    giq_option(4, 645, 104, FishrSon06, 50);
    giq_option(4, 645, 105, FishrSon07, 50);
    giq_option(4, 645, 106, FishrSon08, 50);
    giq_option(4, 645, 114, FishrSon12, 50);
  FishrSon07: 'gsay_message(645, 118, 50);

    '
  FishrSon08: |
    gsay_reply(645, 119);
    giq_option(4, 645, 110, FishrSon05, 50);
    giq_option(4, 645, 104, FishrSon06, 50);
    giq_option(4, 645, 105, FishrSon07, 50);
    giq_option(4, 645, 106, FishrSon08, 50);
    giq_option(4, 645, 120, FishrSon15, 50);
  FishrSon09: 'gsay_message(645, 121, 50);

    '
  FishrSon10: |
    gsay_reply(645, 122);
    giq_option(4, 645, 123, FishrSon16, 49);
    giq_option(4, 645, 124, FishrSon16, 49);
    giq_option(4, 645, 125, FishrSon16, 49);
  FishrSon11: |
    gsay_reply(645, 126);
    giq_option(0, 634, 106, FishrSon11a, 49);
  FishrSon11a: 'gsay_message(645, 127, 49);

    '
  FishrSon12: |
    gsay_reply(645, 128);
    giq_option(4, 645, 110, FishrSon05, 50);
    giq_option(4, 645, 104, FishrSon06, 50);
    giq_option(4, 645, 105, FishrSon07, 50);
    giq_option(4, 645, 106, FishrSon08, 50);
  FishrSon13: |
    gsay_reply(645, 129);
    giq_option(4, 645, 110, FishrSon05, 50);
    giq_option(4, 645, 104, FishrSon06, 50);
    giq_option(4, 645, 105, FishrSon07, 50);
    giq_option(4, 645, 106, FishrSon08, 50);
    giq_option(4, 645, 130, FishrSon17, 50);
  FishrSon14: 'gsay_message(645, 131, 50);

    '
  FishrSon15: |
    gsay_reply(645, 132);
    giq_option(4, 645, 110, FishrSon05, 50);
    giq_option(4, 645, 104, FishrSon06, 50);
    giq_option(4, 645, 105, FishrSon07, 50);
    giq_option(4, 645, 133, FishrSon18, 50);
    giq_option(4, 645, 134, FishrSon19, 50);
  FishrSon16: 'gsay_message(645, 135, 49);

    '
  FishrSon17: |
    gsay_reply(645, 136);
    giq_option(4, 645, 137, FishrSon20, 50);
    if (global_var(74) > 0) then begin
      giq_option(4, 645, 138, FishrSon21, 50);
    end
  FishrSon18: |
    gsay_reply(645, 139);
    giq_option(4, 645, 110, FishrSon05, 50);
    giq_option(4, 645, 104, FishrSon06, 50);
    giq_option(4, 645, 105, FishrSon07, 50);
    giq_option(4, 645, 134, FishrSon18, 50);
  FishrSon19: 'gsay_message(645, 140, 50);

    '
  FishrSon20: 'gsay_message(645, 141, 49);

    '
  FishrSon21: 'gsay_message(645, 142, 50);

    '
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
flare:
  start: |
    if (script_action == 7) then begin
      scr_return(0);
      if ((lit != 1) and (lit != 2)) then begin
        obj_set_light_level(self_obj, 100, 7);
        display_msg(message_str(223, 100));
        lit := 1;
        add_timer_event(self_obj, game_ticks(1800 * 3), 1);
      end
      else begin
        display_msg(message_str(223, 101));
      end
    end
    else begin
      if (script_action == 22) then begin
        if (fixed_param == 1) then begin
          obj_set_light_level(self_obj, 80, 7);
          add_timer_event(self_obj, game_ticks(900 * 3), 2);
        end
        else begin
          if (fixed_param == 2) then begin
            obj_set_light_level(self_obj, 60, 7);
            add_timer_event(self_obj, game_ticks(450 * 3), 3);
          end
          else begin
            if (fixed_param == 3) then begin
              obj_set_light_level(self_obj, 0, 1);
              lit := 2;
              display_msg(message_str(223, 102));
            end
          end
        end
      end
      else begin
        if (script_action == 21) then begin
          script_overrides;
          if (lit == 1) then begin
            display_msg(message_str(223, 103));
          end
          else begin
            if (lit == 2) then begin
              display_msg(message_str(223, 104));
            end
            else begin
              display_msg(message_str(223, 105));
            end
          end
        end
      end
    end
flash:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(36, 1000));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (fetch_dude) then begin
        fetch_dude := 0;
        hostile := 1;
      end
    end
    if (global_var(346) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  map_enter_p_proc: |
    if (global_var(15) == 1) then begin
      kill_critter(self_obj, 57);
    end
    critter_add_trait(self_obj, 1, 6, 19);
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
      if (not(local_var(0))) then begin
        call Flash00;
      end
      else begin
        call Flash01;
      end
    end
    else begin
      if (loitering) then begin
        call Flash07N;
      end
      else begin
        start_gdialog(36, self_obj, 4, -1, -1);
        gsay_start;
        if (not(local_var(0))) then begin
          call Flash00N;
        end
        else begin
          call Flash03N;
        end
        gsay_end;
        end_dialogue;
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        loitering := 1;
        dialogue_system_enter;
      end
    end
    else begin
      if (fixed_param == 2) then begin
        hostile := 1;
      end
    end
  destroy_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_carrying_pid_obj(self_obj, 1);
    if (LVar0) then begin
      rm_obj_from_inven(self_obj, LVar0);
      destroy_object(LVar0);
    end
    if (source_obj == dude_obj) then begin
      set_global_var(346, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(346, 1);
    end
  Flash00: |
    set_local_var(0, 1);
    float_msg(self_obj, message_str(36, 100), 0);
  Flash01: 'float_msg(self_obj, message_str(36, 106), 0);

    '
  Flash00N: |
    set_local_var(0, 1);
    gsay_reply(36, 101);
    giq_option(4, 36, 102, Flash01N, 50);
    giq_option(4, 36, 103, Flash10N, 50);
    giq_option(5, 36, 104, Flash00Na, 50);
    giq_option(4, 36, 128, Flash11N, 50);
    giq_option(-3, 36, 105, Flash10N, 50);
  Flash00Na: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    LVar1 := get_critter_stat(dude_obj, 7);
    LVar2 := get_critter_stat(dude_obj, 35);
    if (LVar2 == LVar1) then begin
      call Flash01N;
    end
    else begin
      LVar0 := -20;
      if (LVar2 < 5) then begin
        LVar0 := 0;
      end
      if (is_success(roll_vs_skill(dude_obj, 14, LVar0))) then begin
        call Flash02N;
      end
      else begin
        call Flash01N;
      end
    end
  Flash01N: |
    float_msg(self_obj, message_str(36, 107), 7);
    add_timer_event(self_obj, game_ticks(10), 2);
  Flash02N: 'gsay_message(36, 108, 50);

    '
  Flash03N: |
    set_local_var(0, 1);
    gsay_reply(36, 109);
    giq_option(4, 36, 110, Flash03Na, 50);
    giq_option(5, 36, 111, Flash03Na, 50);
    giq_option(-3, 36, 112, Flash06N, 50);
  Flash03Na: |
    if (elevation(self_obj) == elevation(Morbid_ptr)) then begin
      call Flash05N;
    end
    else begin
      call Flash04N;
    end
  Flash04N: |
    gsay_reply(36, 113);
    giq_option(4, 36, 126, Flash11N, 50);
    add_timer_event(self_obj, game_ticks(10), 1);
  Flash05N: 'gsay_message(36, 114, 50);

    '
  Flash06N: 'gsay_message(36, 115, 50);

    '
  Flash07N: |
    gsay_reply(36, 116);
    giq_option(4, 36, 117, FlashCombat, 50);
    giq_option(5, 36, 118, Flash07Na, 50);
  Flash07Na: |
    variable LVar0 := 0;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      LVar0 := -15;
    end
    else begin
      LVar0 := -25;
    end
    if (is_success(roll_vs_skill(dude_obj, 14, LVar0))) then begin
      call Flash09N;
    end
    else begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        call Flash08Nb;
      end
      else begin
        call Flash08Na;
      end
    end
  Flash08Na: |
    gsay_reply(36, 119);
    giq_option(4, 36, 120, FlashCombat, 50);
    giq_option(5, 36, 121, FlashEnd, 50);
  Flash08Nb: |
    gsay_reply(36, 122);
    giq_option(4, 36, 123, FlashCombat, 50);
    giq_option(5, 36, 124, FlashEnd, 50);
  Flash09N: 'gsay_message(36, 125, 50);

    '
  Flash10N: 'add_timer_event(self_obj, game_ticks(10), 1);

    '
  Flash11N: 'gsay_message(36, 127, 50);

    '
  FlashCombat: 'hostile := 1;

    '
  FlashEnd: "[]"
flip:
  start: "[]"
  combat_p_proc: |
    if (fixed_param == 4) then begin
      round_counter := round_counter + 1;
    end
    if (round_counter > 2) then begin
      if (global_var(146) == 0) then begin
        set_global_var(146, 1);
        set_map_var(7, 1);
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 12)) then begin
        if (global_var(54)) then begin
          call Flip00;
        end
        else begin
          if ((obj_pid(critter_inven_obj(dude_obj, 0)) != 113) and (local_var(4) == 0)) then begin
            dialogue_system_enter;
          end
          else begin
            if ((obj_pid(critter_inven_obj(dude_obj, 0)) != 113) and (local_var(5) == 1)) then begin
              dialogue_system_enter;
            end
          end
        end
      end
      if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
        animate_move_obj_to_tile(self_obj, cell_tile, 0);
      end
      else begin
        animate_move_obj_to_tile(self_obj, home_tile, 0);
      end
    end
  destroy_p_proc: |
    set_map_var(8, 3);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(4)) then begin
      display_msg(message_str(367, 100));
    end
    else begin
      display_msg(message_str(367, 101));
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    call get_reaction;
    start_gdialog(367, self_obj, 4, -1, -1);
    gsay_start;
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      call Flip01;
    end
    else begin
      if (local_var(4) == 1) then begin
        call Flip05;
      end
      else begin
        call Flip02;
      end
    end
    gsay_end;
    end_dialogue;
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        hostile := 1;
      end
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 43);
      critter_add_trait(self_obj, 1, 5, 4);
      initialized := 1;
    end
  Flip00: |
    float_msg(self_obj, message_str(367, 102), 0);
    call FlipCombat;
  Flip01: |
    add_timer_event(self_obj, game_ticks(30), 1);
    gsay_message(367, 103, 50);
  Flip02: |
    set_local_var(4, 1);
    gsay_reply(367, 104);
    giq_option(4, 367, 105, FlipCombat, 50);
    giq_option(4, 367, 106, transit, 50);
    giq_option(4, 367, 110, Flip03, 50);
    giq_option(-3, 367, 107, FlipCombat, 50);
  Flip03: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call FlipLeave;
    end
    else begin
      call Flip04;
    end
  Flip04: |
    gsay_message(367, 111, 50);
    call FlipCombat;
  Flip05: |
    gsay_message(367, 112, 50);
    call FlipCombat;
  FlipCombat: 'hostile := 1;

    '
  transit: |
    set_global_var(57, 2);
    load_map(32, 5);
  FlipLeave: |
    if (tile_num(self_obj) == home_tile) then begin
      animate_move_obj_to_tile(self_obj, tile_num_in_direction(home_tile, 0, 7), 0);
    end
    else begin
      animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), 5, 7), 0);
    end
    set_local_var(5, 1);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
flsupmut:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 56);
      if (local_var(0) == 0) then begin
        set_local_var(0, random(100, 109));
      end
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: 'display_msg(message_str(260, local_var(0)));

    '
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    variable LVar0 := 0;
    script_overrides;
    LVar0 := random(110, 118);
    float_msg(self_obj, message_str(260, LVar0), 0);
    if ((LVar0 == 3) or (LVar0 == 8)) then begin
      hostile := 1;
    end
folguard:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 46);
      if (local_var(0) == 0) then begin
        if (get_critter_stat(self_obj, 34) == 1) then begin
          set_local_var(0, random(100, 104));
        end
        else begin
          set_local_var(0, random(105, 109));
        end
      end
      if (global_var(129) == 2) then begin
        if (random(0, 1)) then begin
          kill_critter(self_obj, 59);
        end
        else begin
          kill_critter(self_obj, 57);
        end
      end
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 14) then begin
          call damage_p_proc;
        end
        else begin
          if (script_action == 18) then begin
            call destroy_p_proc;
          end
          else begin
            if (script_action == 21) then begin
              call look_at_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (map_var(1) == 1) then begin
      animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 6), random(3, 7)), 0);
    end
    else begin
      if ((map_var(1) == 2) and obj_can_see_obj(self_obj, dude_obj)) then begin
        hostile := 1;
      end
    end
    if (global_var(129) == 2) then begin
      removal_ptr := self_obj;
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
        if (local_var(1) or global_var(256)) then begin
          hostile := 1;
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(1, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(256, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: 'display_msg(message_str(264, local_var(0)));

    '
  talk_p_proc: |
    script_overrides;
    if (local_var(1) or global_var(256)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 0);
    end
    else begin
      start_gdialog(264, self_obj, 4, -1, -1);
      gsay_start;
      if (global_var(133) == 1) then begin
        call guard16;
      end
      else begin
        if (global_var(133) == 2) then begin
          call guard22;
        end
        else begin
          call guard0;
        end
      end
      gsay_end;
      end_dialogue;
    end
  guard0: |
    gsay_reply(264, 110);
    giq_option(-3, 264, 111, guard1, 50);
    giq_option(4, 264, message_str(264, 112) + proto_data(obj_pid(dude_obj), 1) + message_str(264, 113), guard4, 50);
    giq_option(4, 264, message_str(264, 114) + proto_data(obj_pid(dude_obj), 1) + message_str(264, 115), combat, 50);
    giq_option(6, 264, 116, guard11, 50);
  guard1: |
    gsay_reply(264, 117);
    giq_option(-3, 264, message_str(264, 118) + proto_data(obj_pid(dude_obj), 1) + message_str(264, 119), combat, 50);
    giq_option(-3, 264, message_str(264, 120) + proto_data(obj_pid(dude_obj), 1) + message_str(264, 121), guard2, 50);
    giq_option(-3, 264, message_str(264, 122), guard3, 50);
    giq_option(-3, 264, message_str(264, 123) + proto_data(obj_pid(dude_obj), 1) + message_str(264, 124), guard3, 50);
  guard2: 'gsay_message(264, 125, 50);

    '
  guard3: 'gsay_message(264, 126, 50);

    '
  guard4: |
    gsay_reply(264, 127);
    giq_option(4, 264, 128, guard5, 50);
    giq_option(4, 264, 129, combat, 50);
    giq_option(4, 264, 130, guard6, 50);
    giq_option(4, 264, 131, guard10, 50);
  guard5: 'gsay_message(264, 132, 50);

    '
  guard6: |
    gsay_reply(264, 133);
    giq_option(4, 264, 134, guard5, 50);
    giq_option(4, 264, 135, guard7, 50);
    giq_option(4, 264, 136, guard9, 50);
    giq_option(4, 264, 137, guard8, 50);
  guard7: |
    gsay_reply(264, 138);
    giq_option(4, 264, 139, guard5, 50);
    giq_option(4, 264, 140, guard8, 50);
  guard8: 'gsay_message(264, 141, 50);

    '
  guard9: |
    gsay_reply(264, 142);
    giq_option(4, 264, 143, guardend, 50);
  guard10: |
    gsay_reply(264, 144);
    giq_option(4, 264, 145, guard5, 50);
    giq_option(4, 264, 146, guard8, 50);
    giq_option(4, 264, 147, guard6, 50);
  guard11: |
    gsay_reply(264, 148);
    giq_option(6, 264, 149, guardend, 50);
    giq_option(6, 264, 150, guard12, 50);
    giq_option(6, 264, 151, guard15, 50);
  guard12: |
    gsay_reply(264, 152);
    giq_option(6, 264, 153, guardend, 50);
    giq_option(6, 264, 154, guard13, 50);
    giq_option(6, 264, 155, guard14, 50);
  guard13: |
    gsay_reply(264, 156);
    giq_option(6, 264, 157, guardend, 50);
    giq_option(6, 264, 158, combat, 50);
  guard14: 'gsay_message(264, 159, 50);

    '
  guard15: |
    gsay_reply(264, 160);
    giq_option(6, 264, 161, guardend, 50);
  guard16: |
    gsay_reply(264, 162);
    giq_option(4, 264, 163, guard17, 50);
    giq_option(4, 264, 164, guard19, 50);
    giq_option(6, 264, 165, guard16a, 50);
  guard16a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call guard20;
    end
    else begin
      call guard21;
    end
  guard17: |
    gsay_reply(264, 166);
    giq_option(4, 264, 167, guard18, 50);
    giq_option(4, 264, 168, guardend, 50);
    giq_option(4, 264, 169, combat, 50);
  guard18: |
    gsay_reply(264, 170);
    giq_option(4, 264, 171, guardend, 50);
  guard19: |
    gsay_message(264, 172, 50);
    call combat;
  guard20: 'gsay_message(264, 173, 50);

    '
  guard21: |
    gsay_message(264, 174, 50);
    call combat;
  guard22: |
    gsay_reply(264, 175);
    giq_option(4, 264, 176, guardend, 50);
    if (global_var(132) == 0) then begin
      giq_option(4, 264, 177, guard23, 50);
    end
  guard23: |
    variable LVar0 := 0;
    LVar0 := 4 * 3600;
    set_global_var(132, 1);
    gsay_reply(264, 178);
    game_time_advance(game_ticks(LVar0));
    gfade_out(400);
    gfade_in(400);
    giq_option(4, 264, 179, guardend, 50);
  combat: 'hostile := 1;

    '
  guardend: "[]"
folinit:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 46);
      if (local_var(0) == 0) then begin
        if (get_critter_stat(self_obj, 34) == 0) then begin
          set_local_var(0, random(100, 104));
        end
        else begin
          set_local_var(0, random(105, 109));
        end
      end
      if (global_var(129) == 2) then begin
        if (random(0, 1)) then begin
          kill_critter(self_obj, 59);
        end
        else begin
          kill_critter(self_obj, 57);
        end
      end
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 14) then begin
          call damage_p_proc;
        end
        else begin
          if (script_action == 18) then begin
            call destroy_p_proc;
          end
          else begin
            if (script_action == 21) then begin
              call look_at_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (global_var(129) == 2) then begin
      removal_ptr := self_obj;
    end
    if (local_var(1) or global_var(256)) then begin
      if (tile_distance_objs(dude_obj, self_obj) < 8) then begin
        call flee_dude;
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(1, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(256, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(259, local_var(0)));
  talk_p_proc: |
    script_overrides;
    if (local_var(1) or global_var(256)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 0);
    end
    else begin
      if (global_var(133) == 1) then begin
        call float_line1;
      end
      else begin
        if (global_var(132) == 1) then begin
          call float_line2;
        end
        else begin
          call float_line0;
        end
      end
    end
  float_line0: 'float_msg(self_obj, message_str(259, random(110, 117)), 0);

    '
  float_line1: 'float_msg(self_obj, message_str(259, random(118, 122)), 0);

    '
  float_line2: 'float_msg(self_obj, message_str(259, random(123, 126)), 0);

    '
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
folinvad:
  start: |
    if (Only_Once) then begin
      call Initialize_p_proc;
    end
    else begin
      if (script_action == 11) then begin
        call talk_p_proc;
      end
      else begin
        if (script_action == 12) then begin
          call critter_p_proc;
        end
        else begin
          if (script_action == map_enter_p_proc) then begin
            call map_enter_p_proc;
          end
        end
      end
    end
  talk_p_proc: |
    if (local_var(3) == 0) then begin
      float_msg(self_obj, message_str(820, random(100, 107)), 9);
    end
  Initialize_p_proc: |
    critter_add_trait(self_obj, 1, 6, 0);
    critter_add_trait(self_obj, 1, 5, 33);
    Only_Once := 0;
  critter_p_proc: |
    variable LVar0 := 0;
    if (global_var(63) == 1) then begin
      if (local_var(4) == 0) then begin
        if (Hex_Number == 0) then begin
          set_obj_visibility(self_obj, 0);
          LVar0 := random(1, 10);
          if (LVar0 == 1) then begin
            Hex_Number := 19905;
          end
          else begin
            if (LVar0 == 2) then begin
              Hex_Number := 20308;
            end
            else begin
              if (LVar0 == 3) then begin
                Hex_Number := 20506;
              end
              else begin
                if (LVar0 == 4) then begin
                  Hex_Number := 20906;
                end
                else begin
                  if (LVar0 == 5) then begin
                    Hex_Number := 20110;
                  end
                  else begin
                    if (LVar0 == 6) then begin
                      Hex_Number := 19503;
                    end
                    else begin
                      if (LVar0 == 7) then begin
                        Hex_Number := 19103;
                      end
                      else begin
                        if (LVar0 == 8) then begin
                          Hex_Number := 20904;
                        end
                        else begin
                          if (LVar0 == 9) then begin
                            Hex_Number := 21113;
                          end
                          else begin
                            Hex_Number := 19910;
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
        if (tile_num(self_obj) != Hex_Number) then begin
          animate_move_obj_to_tile(self_obj, Hex_Number, 0);
        end
        else begin
          if (tile_num(self_obj) == Hex_Number) then begin
            set_local_var(4, 1);
          end
        end
      end
      else begin
        if ((tile_distance_objs(dude_obj, self_obj) > 10) and (tile_distance_objs(dude_obj, self_obj) < 15)) then begin
          animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), random(3, 6)), 0);
        end
        else begin
          if (tile_distance_objs(dude_obj, self_obj) >= 15) then begin
            animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), random(3, 6)), 1);
          end
          else begin
            if (random(1, 100) == 1) then begin
              animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), random(0, 5), random(3, 6)), 0);
            end
          end
        end
      end
      if (local_var(4) == 1) then begin
        if ((cur_map_index == 17) or (cur_map_index == 18)) then begin
          if (local_var(0) == 0) then begin
            set_local_var(0, 1);
            party_add(self_obj);
            float_msg(self_obj, message_str(820, 112), 9);
          end
        end
        else begin
          if (cur_map_index == 33) then begin
            if (local_var(1) == 0) then begin
              if (elevation(self_obj) == 1) then begin
                set_local_var(1, 1);
                float_msg(self_obj, message_str(820, 109), 9);
              end
            end
          end
          else begin
            if (cur_map_index == 34) then begin
              if (local_var(2) == 0) then begin
                set_local_var(2, 1);
                float_msg(self_obj, message_str(820, 110), 9);
              end
            end
            else begin
              if (local_var(3) == 0) then begin
                set_local_var(3, 1);
                float_msg(self_obj, message_str(820, 111), 9);
                party_remove(self_obj);
                animate_move_obj_to_tile(self_obj, 26000, 0);
                set_global_var(63, 5);
              end
            end
          end
        end
      end
    end
    else begin
      set_obj_visibility(self_obj, 1);
    end
  map_enter_p_proc: |
    if (global_var(63) != 1) then begin
      set_obj_visibility(self_obj, 1);
    end
folschol:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(258, 100));
  talk_p_proc: |
    if (global_var(256) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if (global_var(18) == 1) then begin
        float_msg(self_obj, message_str(258, random(115, 119)), 0);
      end
      else begin
        float_msg(self_obj, message_str(258, random(101, 114)), 0);
      end
    end
  critter_p_proc: |
    variable LVar0 := 0;
    LVar0 := global_var(344);
    if ((((game_time / 10) - LVar0) >= 10) and (tile_distance_objs(self_obj, dude_obj) <= 4) and (global_var(256) == 0)) then begin
      if (global_var(18) == 1) then begin
        float_msg(self_obj, message_str(258, random(115, 119)), 0);
      end
      else begin
        float_msg(self_obj, message_str(258, random(101, 114)), 0);
      end
      LVar0 := game_time / 10;
      set_global_var(344, LVar0);
    end
    else begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        if (global_var(256) == 1) then begin
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(256, 1);
    end
  destroy_p_proc: |
    set_global_var(24, global_var(24) - 1);
    if (source_obj == dude_obj) then begin
      set_global_var(256, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  timed_event_p_proc: |
    animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), random(0, 5), random(1, 5)), 0);
    add_timer_event(self_obj, game_ticks(random(3, 5)), 1);
  pickup_p_proc: 'set_global_var(256, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      if (obj_is_carrying_obj_pid(self_obj, 41) == 0) then begin
        item_caps_adjust(self_obj, random(1, 10));
      end
      critter_add_trait(self_obj, 1, 6, 46);
      add_timer_event(self_obj, game_ticks(random(3, 5)), 1);
      Initialize := 0;
    end
    if (local_var(4) != 99) then begin
      set_local_var(4, 99);
      if (global_var(24) < 24) then begin
        set_global_var(24, global_var(24) + 1);
      end
    end
folscout:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 46);
      if (global_var(129) == 2) then begin
        if (random(0, 1)) then begin
          kill_critter(self_obj, 59);
        end
        else begin
          kill_critter(self_obj, 57);
        end
      end
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (map_var(1) == 1) then begin
      animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 6), random(3, 7)), 0);
    end
    else begin
      if ((map_var(1) == 2) and obj_can_see_obj(self_obj, dude_obj)) then begin
        hostile := 1;
      end
    end
    if (global_var(129) == 2) then begin
      removal_ptr := self_obj;
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(1) or global_var(256)) then begin
        if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
          call flee_dude;
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(256, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    if (local_var(0) == 0) then begin
      if (get_critter_stat(self_obj, 34) == 0) then begin
        set_local_var(0, random(100, 104));
      end
      else begin
        set_local_var(0, random(105, 109));
      end
    end
    script_overrides;
    display_msg(message_str(263, local_var(0)));
  talk_p_proc: |
    script_overrides;
    if (local_var(1) or global_var(256)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 0);
    end
    else begin
      start_gdialog(263, self_obj, 4, -1, -1);
      gsay_start;
      if (global_var(133) == 1) then begin
        call Scout16;
      end
      else begin
        if (global_var(133) == 2) then begin
          call Scout22;
        end
        else begin
          call Scout0;
        end
      end
      gsay_end;
      end_dialogue;
    end
  Scout0: |
    gsay_reply(263, 110);
    giq_option(-3, 263, 111, Scout1, 50);
    giq_option(4, 263, message_str(263, 112) + proto_data(obj_pid(dude_obj), 1) + message_str(263, 113), Scout4, 50);
    giq_option(4, 263, message_str(263, 114) + proto_data(obj_pid(dude_obj), 1) + message_str(263, 115), combat, 50);
    giq_option(6, 263, 116, Scout11, 50);
  Scout1: |
    gsay_reply(263, 117);
    giq_option(-3, 263, message_str(263, 118) + proto_data(obj_pid(dude_obj), 1) + message_str(263, 119), combat, 50);
    giq_option(-3, 263, message_str(263, 120) + proto_data(obj_pid(dude_obj), 1) + message_str(263, 121), Scout2, 50);
    giq_option(-3, 263, message_str(263, 122), combat, 50);
    giq_option(-3, 263, message_str(263, 123) + proto_data(obj_pid(dude_obj), 1) + message_str(263, 124), Scout3, 50);
  Scout2: 'gsay_message(263, 125, 50);

    '
  Scout3: 'gsay_message(263, 126, 50);

    '
  Scout4: |
    gsay_reply(263, 127);
    giq_option(4, 263, 128, Scout5, 50);
    giq_option(4, 263, 129, combat, 50);
    giq_option(4, 263, 130, Scout6, 50);
    giq_option(4, 263, 131, Scout10, 50);
  Scout5: 'gsay_message(263, 132, 50);

    '
  Scout6: |
    gsay_reply(263, 133);
    giq_option(4, 263, 134, Scout5, 50);
    giq_option(4, 263, 135, Scout7, 50);
    giq_option(4, 263, 136, Scout9, 50);
    giq_option(4, 263, 137, Scout8, 50);
  Scout7: |
    gsay_reply(263, 138);
    giq_option(4, 263, 139, Scout5, 50);
    giq_option(4, 263, 140, Scout8, 50);
  Scout8: 'gsay_message(263, 141, 50);

    '
  Scout9: |
    gsay_reply(263, 142);
    giq_option(4, 263, 143, ScoutEnd, 50);
  Scout10: |
    gsay_reply(263, 144);
    giq_option(4, 263, 145, Scout5, 50);
    giq_option(4, 263, 146, Scout8, 50);
    giq_option(4, 263, 147, Scout6, 50);
  Scout11: |
    gsay_reply(263, 148);
    giq_option(6, 263, 149, ScoutEnd, 50);
    giq_option(6, 263, 150, Scout12, 50);
    giq_option(6, 263, 151, Scout15, 50);
  Scout12: |
    gsay_reply(263, 152);
    giq_option(6, 263, 153, ScoutEnd, 50);
    giq_option(6, 263, 154, Scout13, 50);
    giq_option(6, 263, 155, Scout14, 50);
  Scout13: |
    gsay_reply(263, 156);
    giq_option(6, 263, 157, ScoutEnd, 50);
    giq_option(6, 263, 158, combat, 50);
  Scout14: 'gsay_message(263, 159, 50);

    '
  Scout15: |
    gsay_reply(263, 160);
    giq_option(6, 263, 161, ScoutEnd, 50);
  Scout16: |
    gsay_reply(263, 162);
    giq_option(4, 263, 163, Scout17, 50);
    giq_option(4, 263, 164, Scout19, 50);
    giq_option(6, 263, 165, Scout16a, 50);
    giq_option(-3, 263, 111, Scout1, 50);
  Scout16a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call Scout20;
    end
    else begin
      call Scout21;
    end
  Scout17: |
    gsay_reply(263, 166);
    giq_option(4, 263, 167, Scout18, 50);
    giq_option(4, 263, 168, ScoutEnd, 50);
    giq_option(4, 263, 169, combat, 50);
  Scout18: |
    gsay_reply(263, 170);
    giq_option(4, 263, 171, ScoutEnd, 50);
  Scout19: |
    gsay_message(263, 172, 50);
    call combat;
  Scout20: 'gsay_message(263, 173, 50);

    '
  Scout21: |
    gsay_message(263, 174, 50);
    call combat;
  Scout22: |
    gsay_reply(263, 175);
    giq_option(4, 263, 176, ScoutEnd, 50);
    if (global_var(132) == 0) then begin
      giq_option(4, 263, 177, Scout23, 50);
    end
    giq_option(-3, 263, 111, Scout1, 50);
  Scout23: |
    variable LVar0 := 0;
    LVar0 := 4 * 3600;
    set_global_var(132, 1);
    gsay_reply(263, 178);
    game_time_advance(game_ticks(LVar0));
    gfade_out(400);
    gfade_in(400);
    giq_option(4, 263, 179, ScoutEnd, 50);
  combat: 'hostile := 1;

    '
  ScoutEnd: "[]"
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(1, 1);
    end
footprnt:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if (local_var(0) == 0) then begin
          set_local_var(0, 1);
          display_msg(message_str(829, 100));
        end
      end
    end
forccomp:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(364, 100));
  use_p_proc: |
    if (not(global_var(609))) then begin
      script_overrides;
      display_msg(message_str(364, 101));
      set_global_var(262, 0);
      set_global_var(146, 2);
      set_global_var(609, 1);
      field_change := "off";
      use_obj(fieldH_Ptr);
    end
forcecon:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(545, 100));
  use_p_proc: |
    field_change := "toggle";
    use_obj(fieldH_Ptr);
francis:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 67);
      Only_Once := 0;
    end
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(399, 100));
    end
    else begin
      if (script_action == 4) then begin
        Hostile := 1;
      end
      else begin
        if (script_action == 12) then begin
          if (Hostile) then begin
            Hostile := 0;
            attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
          end
        end
        else begin
          if (script_action == 18) then begin
            if (source_obj == dude_obj) then begin
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                set_global_var(156, 1);
                set_global_var(157, 0);
              end
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                set_global_var(157, 1);
                set_global_var(156, 0);
              end
              set_global_var(160, global_var(160) + 1);
              if ((global_var(160) % 6) == 0) then begin
                set_global_var(155, global_var(155) + 1);
              end
            end
          end
          else begin
            if (script_action == 11) then begin
              script_overrides;
              if (global_var(195) == 1) then begin
                float_msg(self_obj, message_str(399, 101), 0);
              end
              else begin
                if (local_var(0) == 1) then begin
                  float_msg(self_obj, message_str(399, 102), 0);
                end
                else begin
                  if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
                    float_msg(self_obj, message_str(399, 103), 0);
                  end
                  else begin
                    if (not(obj_pid(critter_inven_obj(dude_obj, 0)) == 113) and (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1)) or (global_var(158) > 2))) then begin
                      float_msg(self_obj, message_str(399, 104), 0);
                    end
                    else begin
                      start_gdialog(399, self_obj, 4, -1, -1);
                      gsay_start;
                      if (not(obj_pid(critter_inven_obj(dude_obj, 0)) == 113)) then begin
                        call Francis04;
                      end
                      else begin
                        if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
                          call Francis05;
                        end
                        else begin
                          call Francis06;
                        end
                      end
                      gsay_end;
                      end_dialogue;
                      set_local_var(0, 1);
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  Francis04: |
    gsay_reply(399, 105);
    giq_option(7, 399, 106, Francis07_1, 50);
    giq_option(7, 399, 107, Francis08_1, 50);
    giq_option(4, 399, 108, Francis09_1, 50);
    giq_option(4, 399, 109, Francis10_1, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 399, 110, Francis11_1, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 399, 111, Francis12_1, 50);
    end
    giq_option(-3, 399, 112, Francis13, 50);
  Francis05: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(399, 113);
    end
    else begin
      gsay_reply(399, 114);
    end
    giq_option(7, 399, 115, Francis14, 50);
    giq_option(7, 399, 116, Francis15_1, 50);
    giq_option(4, 399, 117, Francis16, 50);
    giq_option(4, 399, 118, Francis17_1, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 399, 119, Francis18, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 399, 120, Francis19, 50);
    end
    giq_option(-3, 399, 121, Francis20, 50);
  Francis06: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(399, 160);
    end
    else begin
      gsay_reply(399, 161);
    end
    giq_option(7, 399, 122, Francis21_1, 50);
    giq_option(7, 399, 123, Francis15_1, 50);
    giq_option(4, 399, 124, Francis09_1, 50);
    giq_option(4, 399, 125, Francis22, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 399, 126, Francis11_1, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 399, 127, Francis12_1, 50);
    end
    giq_option(-3, 399, 128, Francis13, 50);
  Francis07_1: 'gsay_message(399, message_str(399, 129) + message_str(399, 130), 50);

    '
  Francis07_2: "[]"
  Francis08_1: 'gsay_message(399, message_str(399, 131) + message_str(399, 132), 50);

    '
  Francis08_2: "[]"
  Francis09_1: 'gsay_message(399, message_str(399, 133) + message_str(399, 134), 50);

    '
  Francis09_2: 'gsay_message(399, message_str(399, 134), 50);

    '
  Francis10_1: 'gsay_message(399, message_str(399, 135) + message_str(399, 136), 50);

    '
  Francis10_2: "[]"
  Francis11_1: 'gsay_message(399, message_str(399, 137) + message_str(399, 138), 50);

    '
  Francis11_2: "[]"
  Francis12_1: 'gsay_message(399, message_str(399, 139) + message_str(399, 140), 50);

    '
  Francis12_2: "[]"
  Francis13: 'gsay_message(399, message_str(399, 141), 50);

    '
  Francis14: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(399, 142, 50);
    end
    else begin
      gsay_message(399, 143, 50);
    end
  Francis15_1: 'gsay_message(399, message_str(399, 144) + message_str(399, 145) +
    message_str(399, 146), 50);

    '
  Francis15_2: "[]"
  Francis15_3: "[]"
  Francis16: 'gsay_message(399, 147, 50);

    '
  Francis17_1: 'gsay_message(399, message_str(399, 148) + message_str(399, 149), 50);

    '
  Francis17_2: "[]"
  Francis18: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(399, 150, 50);
    end
    else begin
      gsay_message(399, 151, 50);
    end
  Francis19: 'gsay_message(399, 152, 50);

    '
  Francis20: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(399, 153, 50);
    end
    else begin
      gsay_message(399, 154, 50);
    end
  Francis21_1: 'gsay_message(399, message_str(399, 155) + message_str(399, 156), 50);

    '
  Francis21_2: "[]"
  Francis22: 'gsay_message(399, 157, 50);

    '
  FrancisEnd: "[]"
  Combat: 'Hostile := 1;

    '
freezer:
  start: |
    if (script_action == 21) then begin
      script_overrides;
      display_msg(message_str(314, 100));
    end
    else begin
      if (script_action == 3) then begin
        script_overrides;
        display_msg(message_str(314, 101));
      end
    end
fruit:
  start: |
    if (script_action == 2) then begin
      call spatial_p_proc;
    end
  spatial_p_proc: |
    if (obj_type(source_obj) == dude_obj) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
        if (is_success(roll_vs_skill(dude_obj, 17, 0))) then begin
          display_msg(message_str(127, 100));
        end
      end
    end
fry:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      if (global_var(469) == 1) then begin
        set_obj_visibility(self_obj, 1);
      end
      critter_add_trait(self_obj, 1, 6, 40);
      critter_add_trait(self_obj, 1, 5, 86);
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((game_time_hour >= 600) and (game_time_hour < 700) or ((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
      if (tile_num(self_obj) != 21508) then begin
        animate_move_obj_to_tile(self_obj, 21508, 0);
      end
      else begin
        if (random(1, 150) == 1) then begin
          animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), random(0, 5), random(3, 5)), 0);
        end
      end
    end
    else begin
      if (tile_num(self_obj) != 22280) then begin
        animate_move_obj_to_tile(self_obj, 22280, 0);
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    call FryDialog;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    set_global_var(469, 1);
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(567, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  FryDialog: |
    if ((game_time_hour >= 1800) and (game_time_hour < 1900) or ((game_time_hour >= 1900) or (game_time_hour < 600))) then begin
      float_msg(self_obj, message_str(567, 146), 3);
    end
    else begin
      start_gdialog(567, self_obj, 4, -1, -1);
      gsay_start;
      if (global_var(220) > 2) then begin
        call Fry11;
      end
      else begin
        if (global_var(221) == 1) then begin
          call Fry12;
        end
        else begin
          if (global_var(222) > 2) then begin
            call Fry13;
          end
          else begin
            if (local_var(4) == 0) then begin
              call Fry00;
              set_local_var(4, 1);
            end
            else begin
              if (global_var(158) > 2) then begin
                call Fry10;
              end
              else begin
                if (local_var(1) == 3) then begin
                  call Fry14;
                end
                else begin
                  if (local_var(1) == 2) then begin
                    call Fry15;
                  end
                  else begin
                    call Fry16;
                  end
                end
              end
            end
          end
        end
      end
      gsay_end;
      end_dialogue;
    end
  FryCombat: 'hostile := 1;

    '
  FryEnd: "[]"
  Fry00: |
    if (global_var(158) > 2) then begin
      gsay_reply(567, 101);
    end
    else begin
      gsay_reply(567, 102);
    end
    giq_option(4, 567, 103, Fry01, 50);
    giq_option(4, 567, 104, FryEnd, 50);
    giq_option(-3, 567, 105, Fry09, 50);
    giq_option(-3, 567, 106, Fry09, 50);
  Fry01: |
    gsay_reply(567, 107);
    giq_option(4, 567, 108, Fry02, 50);
    giq_option(4, 567, 109, Fry03, 50);
  Fry02: |
    set_global_var(219, 1);
    gsay_reply(567, 110);
    if (global_var(106) != 2) then begin
      set_global_var(106, 1);
    end
    call Fry05;
  Fry03: |
    set_global_var(219, 1);
    gsay_reply(567, 111);
    if (global_var(106) != 2) then begin
      set_global_var(106, 1);
    end
    giq_option(4, 567, 112, Fry07, 50);
    giq_option(4, 567, 113, Fry04, 50);
    giq_option(4, 567, 114, Fry06, 50);
    giq_option(4, 567, 115, Fry21, 50);
    if (global_var(101) != 2) then begin
      giq_option(4, 567, 147, Fry23, 50);
    end
    giq_option(4, 567, 116, Fry08, 50);
  Fry04: |
    gsay_reply(567, 117);
    call Fry05;
  Fry05: |
    if (global_var(219) == 1) then begin
      giq_option(4, 567, 112, Fry07, 50);
    end
    if (global_var(106) == 1) then begin
      giq_option(4, 567, 114, Fry06, 50);
    end
    giq_option(4, 567, 115, Fry21, 50);
    if (global_var(101) != 2) then begin
      giq_option(4, 567, 147, Fry23, 50);
    end
    giq_option(4, 567, 116, Fry08, 50);
  Fry06: |
    gsay_reply(567, 118);
    call Fry05;
  Fry07: |
    gsay_reply(567, 119);
    call Fry05;
  Fry08: |
    gsay_message(567, 120, 50);
    call FryEnd;
  Fry09: |
    gsay_message(567, 121, 50);
    call FryEnd;
  Fry10: |
    gsay_message(567, 122, 50);
    call FryEnd;
  Fry11: |
    gsay_message(567, 123, 50);
    call FryCombat;
  Fry12: |
    gsay_message(567, 124, 50);
    call FryEnd;
  Fry13: |
    gsay_reply(567, 125);
    call FryCombat;
  Fry14: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(567, 130);
    end
    else begin
      gsay_reply(567, 131);
    end
    call Fry17;
  Fry15: |
    gsay_reply(567, 132);
    call Fry17;
  Fry16: |
    gsay_reply(567, 133);
    call Fry17;
  Fry17: |
    if (global_var(101) != 2) then begin
      giq_option(4, 567, 147, Fry24, 50);
    end
    giq_option(4, 567, 134, Fry18, 49);
    giq_option(4, 567, 135, Fry19, 50);
    giq_option(4, 567, 136, Fry20, 50);
    giq_option(4, 567, 137, Fry21, 49);
    giq_option(4, 567, 138, FryEnd, 50);
    giq_option(-3, 567, 139, Fry09, 50);
    giq_option(-3, 567, 140, Fry09, 50);
  Fry18: |
    gsay_reply(567, 141);
    call Fry17;
  Fry19: |
    gsay_reply(567, 142);
    call Fry17;
  Fry20: |
    gsay_reply(567, 143);
    call Fry17;
  Fry21: |
    gsay_reply(567, 144);
    call Fry17;
  Fry23: |
    gsay_reply(567, 148);
    call Fry05;
  Fry24: |
    gsay_reply(567, 148);
    call Fry17;
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
frystub:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    float_msg(self_obj, message_str(914, 101), 2);
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    set_global_var(469, 1);
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(914, 100));
  combat_p_proc: |
    if (map_var(54) == 1) then begin
      script_overrides;
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if ((party_member_obj(LVar0) != 0) and (map_var(52) == 0)) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      Fry_Stub_Ptr := self_obj;
      set_obj_visibility(self_obj, 1);
      critter_add_trait(self_obj, 1, 6, 0);
      critter_add_trait(self_obj, 1, 5, 86);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
gabriel:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(156, 101));
    end
    else begin
      display_msg(message_str(156, 100));
    end
  talk_p_proc: |
    if ((global_var(617) == 1) or (get_critter_stat(dude_obj, 4) < 4)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      call get_reaction;
      start_gdialog(156, self_obj, -1, -1, -1);
      gsay_start;
      if (local_var(4) == 0) then begin
        if (global_var(265) == 9250) then begin
          call Gab17;
        end
        else begin
          call Gab01;
        end
      end
      else begin
        if (local_var(5) == 1) then begin
          if ((local_var(8) == 0) and (global_var(613) == 2)) then begin
            set_local_var(8, 1);
            call Gab25;
          end
          else begin
            call Gab27;
          end
        end
        else begin
          if ((global_var(614) == 9201) and (global_var(265) == 9250)) then begin
            call Gab20;
          end
          else begin
            if (global_var(614) == 9201) then begin
              call Gab13;
            end
            else begin
              if ((local_var(6) == 1) or (local_var(7) == 1)) then begin
                call Gab24;
              end
              else begin
                call Gab12;
              end
            end
          end
        end
      end
      gsay_end;
      end_dialogue;
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(617, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(617, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(617) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  pickup_p_proc: 'set_global_var(617, 1);

    '
  map_enter_p_proc: |
    if (GVar0) then begin
      if (obj_is_carrying_obj_pid(self_obj, 41) == 0) then begin
        item_caps_adjust(self_obj, random(50, 150));
      end
      critter_add_trait(self_obj, 1, 6, 48);
      critter_add_trait(self_obj, 1, 5, 28);
      GVar0 := 0;
    end
    if ((global_var(265) == 2) and (days_since_visited > 1)) then begin
      set_obj_visibility(self_obj, 1);
      move_to(self_obj, 3846, 1);
    end
  Gab01: |
    gsay_reply(156, 102);
    gsay_option(156, 103, Gab02, 50);
    gsay_option(156, 104, Gab04, 50);
  Gab02: |
    gsay_reply(156, 105);
    gsay_option(156, 106, Gab03, 50);
    set_local_var(4, 1);
  Gab03: |
    gsay_reply(156, 107);
    gsay_option(156, 108, Gab08, 50);
  Gab04: |
    gsay_reply(156, 109);
    gsay_option(156, 110, Gab05, 50);
  Gab05: |
    gsay_reply(156, 111);
    gsay_option(156, 112, Gab06, 50);
  Gab06: |
    gsay_reply(156, 113);
    if (global_var(265) == 9250) then begin
      gsay_option(156, 114, Gab19, 50);
    end
    else begin
      gsay_option(156, 114, Gab07, 50);
    end
    gsay_option(156, 115, Gab08, 50);
  Gab07: |
    gsay_reply(156, 116);
    gsay_option(156, 117, Gab03, 50);
  Gab08: |
    gsay_reply(156, 118);
    gsay_option(156, 119, Gab09, 50);
    if (global_var(613) == 9101) then begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        gsay_option(156, 170, Gab11, 50);
      end
      else begin
        gsay_option(156, 171, Gab11, 50);
      end
    end
  Gab09: |
    gsay_reply(156, 121);
    gsay_option(156, 122, Gab09a, 50);
    gsay_option(156, 123, GabEnd, 50);
  Gab09a: 'set_global_var(614, 9201);

    '
  Gab11: |
    gsay_reply(156, 125);
    gsay_option(156, 126, Gab09a, 50);
    gsay_option(156, 127, GabEnd, 50);
  Gab12: |
    gsay_reply(156, 128);
    gsay_option(156, 129, Gab04, 50);
    gsay_option(156, 130, GabEnd, 50);
  Gab13: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(156, 172);
    end
    else begin
      gsay_reply(156, 173);
    end
    gsay_option(156, 132, Gab15, 50);
    gsay_option(156, 133, Gab14, 50);
  Gab14: |
    gsay_reply(156, 134);
    gsay_option(156, 135, GabEnd, 50);
  Gab15: |
    gsay_reply(156, 136);
    gsay_option(156, 137, GabEnd, 50);
  Gab17: |
    gsay_reply(156, 140);
    gsay_option(156, 141, Gab18, 50);
    gsay_option(156, 142, Gab04, 50);
  Gab18: |
    gsay_reply(156, 143);
    gsay_option(156, 144, Gab20, 50);
    set_local_var(4, 1);
  Gab19: |
    gsay_reply(156, 145);
    gsay_option(156, 146, Gab20, 50);
  Gab20: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(156, 174);
    end
    else begin
      gsay_reply(156, 175);
    end
    gsay_option(156, 148, Gab21, 50);
    if (global_var(613) == 9101) then begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        gsay_option(156, 170, Gab22, 50);
      end
      else begin
        gsay_option(156, 171, Gab22, 50);
      end
    end
    gsay_option(156, 150, Gab23, 50);
  Gab21: |
    gsay_reply(156, 151);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_option(156, 176, GabEnd, 50);
    end
    else begin
      gsay_option(156, 177, GabEnd, 50);
    end
    if (global_var(265) != 2) then begin
      set_global_var(265, 2);
      set_global_var(614, 9203);
      set_global_var(155, global_var(155) + 1);
      give_exp_points(1000);
      display_msg(message_str(766, 103) + 1000 + message_str(766, 104));
      set_local_var(6, 1);
    end
  Gab22: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(156, 178);
    end
    else begin
      gsay_reply(156, 179);
    end
    gsay_option(156, 154, GabEnd, 50);
    if (global_var(614) != 9202) then begin
      set_global_var(614, 9202);
      set_global_var(155, global_var(155) + 1);
      give_exp_points(1000);
      display_msg(message_str(766, 103) + 1000 + message_str(766, 104));
      set_local_var(5, 1);
    end
  Gab23: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(156, 180);
    end
    else begin
      gsay_reply(156, 181);
    end
    gsay_option(156, 156, GabEnd, 50);
    call UpReactLevel;
  Gab24: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(156, 182, 50);
    end
    else begin
      gsay_message(156, 183, 50);
    end
  Gab25: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(156, 184);
    end
    else begin
      gsay_reply(156, 185);
    end
    gsay_option(156, 159, Gab26, 50);
    gsay_option(156, 160, GabBarter, 50);
    gsay_option(156, 161, GabEnd, 50);
  Gab26: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(156, 186);
    end
    else begin
      gsay_reply(156, 187);
    end
    gsay_option(156, 163, GabBarter, 50);
    gsay_option(156, 164, GabEnd, 50);
  Gab27: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(156, 184);
    end
    else begin
      gsay_reply(156, 185);
    end
    gsay_option(156, 166, GabBarter, 50);
    gsay_option(156, 167, GabEnd, 50);
  GabBarter: 'gsay_message(156, 188, 50);

    '
  GabEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
gambler:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(3) == 0) then begin
      display_msg(message_str(247, 100));
    end
    else begin
      display_msg(message_str(247, 101));
    end
  talk_p_proc: |
    start_gdialog(247, self_obj, 4, -1, -1);
    gsay_start;
    if ((global_var(104) == 2) or (global_var(38) != 0)) then begin
      call Hernandez00;
    end
    else begin
      if (local_var(4) == 0) then begin
        call Hernandez01;
      end
      else begin
        call Hernandez12;
      end
    end
    gsay_end;
    end_dialogue;
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj) and (local_var(7) == 1)) then begin
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(7, 1);
    end
  pickup_p_proc: 'set_local_var(7, 1);

    '
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 5, 6);
    end
  Hernandez00: |
    gsay_reply(247, 139);
    if (local_var(4) == 1) then begin
      giq_option(4, 247, 140, Hernandez00a, 50);
    end
    giq_option(4, 247, 141, Hernandezend, 50);
  Hernandez00a: |
    gsay_reply(247, 142);
    giq_option(4, 247, 134, Hernandez14, 50);
    giq_option(4, 247, 141, Hernandezend, 50);
  Hernandez01: |
    gsay_reply(247, 102);
    giq_option(4, 247, 103, Hernandez02, 50);
    giq_option(4, 247, 104, Hernandezend, 50);
    giq_option(-3, 247, 105, Hernandez04, 50);
  Hernandez02: |
    gsay_reply(247, 106);
    giq_option(5, 247, 108, Hernandez09, 50);
    giq_option(5, 247, 109, Hernandez11, 50);
    giq_option(4, 247, 107, Hernandezend, 50);
  Hernandez03: |
    variable LVar0 := 0;
    LVar0 := message_str(247, 110);
    if (get_critter_stat(dude_obj, 1) == 7) then begin
      LVar0 := LVar0 + message_str(247, 111);
      set_local_var(3, 1);
    end
    gsay_message(247, LVar0, 50);
    gsay_reply(247, 112);
    giq_option(4, 247, 113, Hernandez05, 50);
    giq_option(4, 247, 114, Hernandez06, 50);
    if (get_critter_stat(dude_obj, 1) == 7) then begin
      giq_option(4, 247, 115, Hernandez14, 50);
    end
  Hernandez04: 'gsay_message(247, 116, 50);

    '
  Hernandez05: |
    variable LVar0 := 0;
    if (item_caps_total(dude_obj) >= 50) then begin
      LVar0 := item_caps_adjust(dude_obj, -50);
      gsay_message(247, 117, 50);
      set_local_var(4, 1);
      display_msg(message_str(247, 143));
    end
    else begin
      gsay_message(247, 138, 50);
    end
  Hernandez06: 'gsay_message(247, 118, 50);

    '
  Hernandez07: |
    gsay_reply(247, 119);
    giq_option(4, 247, 120, Hernandez08, 50);
    giq_option(4, 247, 121, Hernandezend, 50);
  Hernandez08: "[]"
  Hernandez09: |
    gsay_message(247, 122, 50);
    gsay_reply(247, 123);
    giq_option(6, 247, 125, Hernandez10, 50);
    giq_option(4, 247, 124, Hernandez07, 50);
  Hernandez10: 'gsay_message(247, 126, 50);

    '
  Hernandez11: |
    gsay_reply(247, 127);
    giq_option(4, 247, 128, Hernandez03, 50);
  Hernandez12: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(247, 136);
    end
    else begin
      gsay_reply(247, 137);
    end
    giq_option(4, 247, 130, Hernandez13, 50);
    giq_option(4, 247, 131, Hernandezend, 50);
  Hernandez13: |
    gsay_reply(247, 132);
    giq_option(4, 247, 133, Hernandezend, 50);
    giq_option(4, 247, 134, Hernandez14, 50);
  Hernandez14: |
    gsay_message(247, 135, 50);
    set_local_var(7, 1);
  Hernandezend: "[]"
ganger:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 42);
      init_teams := 1;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if (script_action == 21) then begin
        script_overrides;
        display_msg(message_str(64, 100));
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            if (Hostile) then begin
              Hostile := 0;
              attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
            end
          end
          else begin
            if (script_action == 18) then begin
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(160, global_var(160) + 1);
                if ((global_var(160) % 6) == 0) then begin
                  set_global_var(155, global_var(155) + 1);
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    start_gdialog(64, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(0)) then begin
      call ghoul08;
    end
    else begin
      set_local_var(0, 1);
      call ghoul00;
    end
    gsay_end;
    end_dialogue;
  ghoulend: "[]"
  ghoulcbt: 'Hostile := 1;

    '
  ghoul00: |
    gsay_reply(64, 101);
    giq_option(6, 64, 102, ghoul01, 50);
    giq_option(4, 64, 103, ghoul08, 50);
    giq_option(4, 64, 104, ghoul11, 50);
    giq_option(-3, 64, 105, ghoul12, 50);
  ghoul01: |
    gsay_reply(64, 106);
    giq_option(6, 64, 107, ghoulend, 50);
    giq_option(6, 64, 108, ghoul02, 50);
    giq_option(6, 64, 109, ghoulcbt, 51);
  ghoul02: |
    gsay_reply(64, 110);
    giq_option(5, 64, 111, ghoul04, 50);
    giq_option(4, 64, 112, ghoul05, 50);
  ghoul03: |
    gsay_reply(64, 113);
    giq_option(8, 64, 114, ghoul05, 50);
  ghoul04: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call ghoul03;
    end
    else begin
      call ghoul04a;
    end
  ghoul04a: |
    gsay_message(64, 115, 50);
    call ghoulend;
  ghoul05: |
    gsay_reply(64, 116);
    giq_option(5, 64, 117, ghoul06, 50);
    giq_option(5, 64, 118, ghoulend, 50);
  ghoul06: |
    gsay_reply(64, 119);
    giq_option(5, 64, 120, ghoul07, 50);
    giq_option(5, 64, 121, ghoulend, 50);
  ghoul07: |
    gsay_message(64, 122, 50);
    call ghoulend;
  ghoul08: |
    gsay_reply(64, 123);
    giq_option(4, 64, 124, ghoul09, 50);
    giq_option(4, 64, 125, ghoulend, 50);
    giq_option(-3, 64, 105, ghoul12, 50);
  ghoul09: |
    gsay_reply(64, 126);
    giq_option(4, 64, 127, ghoul10, 50);
    giq_option(4, 64, 128, ghoulend, 50);
  ghoul10: |
    gsay_reply(64, 129);
    call ghoulcbt;
  ghoul11: |
    gsay_message(64, 130, 50);
    call ghoulend;
  ghoul12: |
    gsay_message(64, 131, 50);
    call ghoulcbt;
  ghoul13: |
    gsay_message(64, 132, 50);
    call ghoulend;
gar2:
  start: |
    if (Only_once) then begin
      Only_once := 0;
      critter_add_trait(self_obj, 1, 6, 30);
      if (global_var(31) == 1) then begin
        set_obj_visibility(self_obj, 0);
      end
      else begin
        set_obj_visibility(self_obj, 1);
      end
    end
    if (script_action == 11) then begin
      if (global_var(31) == 2) then begin
        float_msg(self_obj, message_str(535, 102), 8);
      end
      else begin
        float_msg(self_obj, message_str(535, 101), 8);
      end
    end
    else begin
      if (script_action == 12) then begin
        if (Hostile) then begin
          Hostile := 0;
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
        if (global_var(31) != 2) then begin
          if (tile_distance_objs(self_obj, dude_obj) > 7) then begin
            Hostile := 1;
          end
          else begin
            if ((tile_distance_objs(self_obj, dude_obj) > 4) and oktoyell) then begin
              oktoyell := 0;
              float_msg(self_obj, message_str(535, 103), 8);
            end
            else begin
              if (tile_distance_objs(self_obj, dude_obj) < 5) then begin
                oktoyell := 1;
              end
            end
          end
        end
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 21) then begin
            script_overrides;
            display_msg(message_str(535, 100));
          end
          else begin
            if (script_action == 18) then begin
              set_global_var(607, 3);
              if (source_obj == dude_obj) then begin
                set_global_var(160, global_var(160) + 1);
              end
            end
          end
        end
      end
    end
garl:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 6);
      critter_add_trait(self_obj, 1, 5, 22);
    end
  talk_p_proc: |
    if (elevation(self_obj) == 1) then begin
      float_msg(self_obj, message_str(137, 208), 2);
      add_timer_event(self_obj, 5, 4);
    end
    else begin
      if (killing_women) then begin
        call garl39a;
      end
      else begin
        set_local_var(3, 1);
        call get_reaction;
        start_gdialog(137, self_obj, 4, -1, -1);
        gsay_start;
        if (women_killed > 1) then begin
          call garl11;
        end
        else begin
          if (global_var(116)) then begin
            call garl01;
          end
          else begin
            if (local_var(4) < 1) then begin
              call first;
              set_local_var(4, 1);
            end
            else begin
              call notfirst;
            end
          end
        end
        gsay_end;
        end_dialogue;
      end
    end
    if (obj_carrying_pid_obj(dude_obj, 212)) then begin
      rm_obj_from_inven(dude_obj, tandi_pid_ptr);
      destroy_object(tandi_pid_ptr);
      set_global_var(26, 5);
      set_map_var(2, 2);
      obj_unlock(Cell_Door_Ptr);
      add_timer_event(self_obj, 1, 2);
    end
    else begin
      if (obj_carrying_pid_obj(self_obj, 212)) then begin
        rm_obj_from_inven(self_obj, tandi_pid_ptr);
        destroy_object(tandi_pid_ptr);
        call garl20;
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if (global_var(611) != 1) then begin
        dialogue_system_enter;
      end
    end
    else begin
      if (fixed_param == 2) then begin
        call freetandi;
      end
      else begin
        if (fixed_param == 3) then begin
          call honorarea;
        end
        else begin
          if (fixed_param == 4) then begin
            if (local_var(18) > 0) then begin
              call return_to_map;
              call freetandi;
            end
            else begin
              add_timer_event(self_obj, 5, 4);
              HOSTILE := 1;
            end
          end
        end
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(137, 100));
  pickup_p_proc: 'HOSTILE := 1;

    '
  critter_p_proc: |
    call Critter_Action;
    if (HOSTILE) then begin
      HOSTILE := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (local_var(7) == 1) then begin
      move_to(dude_obj, local_var(6), 0);
      move_obj_inven_to_obj(Garls_Inven_Ptr, dude_obj);
      set_global_var(26, 5);
      set_map_var(2, 2);
      obj_unlock(Cell_Door_Ptr);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    if (local_var(7) == 0) then begin
      set_global_var(254, 1);
      set_global_var(611, 0);
    end
    set_global_var(114, 1);
    set_global_var(115, global_var(115) - 1);
  damage_p_proc: |
    if (local_var(7) == 0) then begin
      set_global_var(254, 1);
    end
    else begin
      set_local_var(18, 1);
    end
  first: |
    if (global_var(26) > 1) then begin
      call garl43;
    end
    else begin
      if (global_var(26) > 0) then begin
        call garl12;
      end
      else begin
        call garl32;
      end
    end
  notfirst: |
    if (global_var(26) > 1) then begin
      call garl43;
    end
    else begin
      if (global_var(26) > 0) then begin
        call garl22;
      end
      else begin
        call garl41;
      end
    end
  garl01: |
    gsay_reply(137, 102);
    giq_option(-3, 137, 207, garl09, 50);
    giq_option(4, 137, 103, garl01a, 50);
    giq_option(5, 137, 104, garl01b, 50);
    giq_option(6, 137, 105, garl01c, 50);
  garl01a: 'call garl02;

    '
  garl01b: 'call garl03;

    '
  garl01c: 'call garl04;

    '
  garl02: |
    gsay_message(137, 110, 50);
    set_global_var(116, 0);
    call garlcbt;
  garl03: |
    gsay_reply(137, 111);
    giq_option(8, 137, 112, garl03a, 50);
  garl03a: |
    set_global_var(116, 0);
    call garlcbt;
  garl04: |
    gsay_reply(137, 113);
    giq_option(6, 137, 114, garl04a, 50);
    giq_option(6, 137, 115, garl04b, 50);
  garl04a: 'call garl06;

    '
  garl04b: 'call garl05;

    '
  garl05: |
    gsay_message(137, 119, 50);
    set_global_var(116, 0);
    call garlcbt;
  garl06: |
    gsay_reply(137, 120);
    if (global_var(26) == 1) then begin
      giq_option(6, 137, 121, garl06a, 50);
    end
    giq_option(6, 137, 122, garl10, 50);
    giq_option(6, 137, 123, garl10, 50);
  garl06a: |
    if (is_success(do_check(dude_obj, 3, 0)) or is_success(roll_vs_skill(dude_obj, 14, 10))) then begin
      call garl08;
    end
    else begin
      call garl09;
    end
  garl08: |
    gsay_message(137, 126, 50);
    set_global_var(116, 0);
    call freetandi;
  garl09: |
    gsay_message(137, 127, 50);
    call garlcbt;
  garl10: |
    gsay_message(137, 128, 50);
    set_global_var(116, 0);
    call garlcbt;
  garl11: |
    if (women_killed > 1) then begin
      women_killed := 0;
      gsay_message(137, 129, 50);
      call garlcbt;
    end
  garl12: |
    gsay_reply(137, 130);
    if (global_var(218) == 1) then begin
      giq_option(4, 137, 131, garl13, 50);
      giq_option(5, 137, 133, garl13, 50);
    end
    else begin
      giq_option(5, 137, 200, garl12a, 50);
    end
    giq_option(4, 137, 132, garlcbt, 50);
    giq_option(-3, 137, 134, garl17, 50);
  garl12a: 'gsay_message(137, 201, 50);

    '
  garl12b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 10)) or is_success(do_check(dude_obj, 3, 0))) then begin
      call garl15;
    end
    else begin
      call garl13b;
    end
  garl13: |
    gsay_reply(137, 135);
    giq_option(4, 137, 136, garl12b, 50);
    giq_option(4, 137, 137, garl13a, 50);
    giq_option(4, 137, 138, garl12b, 50);
  garl13a: |
    gsay_message(137, 139, 50);
    set_global_var(116, 0);
    call garlcbt;
  garl13b: |
    gsay_message(137, 111, 50);
    set_global_var(116, 0);
    call garlcbt;
  garl15: |
    gsay_reply(137, 140);
    if (has_skill(dude_obj, 14) >= 45) then begin
      giq_option(6, 137, 141, garl15a, 50);
    end
    giq_option(6, 137, 142, garl18, 50);
    giq_option(6, 137, 143, garl21, 50);
    giq_option(4, 137, 203, garl27, 50);
  garl15a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 10)) or is_success(do_check(dude_obj, 3, 0))) then begin
      call garl16;
    end
    else begin
      call garl17;
    end
  garl16: |
    gsay_message(137, 145, 50);
    call freetandi;
  garl17: |
    gsay_message(137, 146, 50);
    call garlcbt;
  garl18: |
    tandi_pid_ptr := create_object_sid(212, 0, 0, -1);
    add_obj_to_inven(self_obj, tandi_pid_ptr);
    gsay_message(137, 147, 50);
    call garlbarter;
  garl20: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      float_msg(self_obj, message_str(137, 149), 2);
    end
    else begin
      float_msg(self_obj, message_str(137, 205), 2);
    end
    call garlcbt;
  garl21: |
    gsay_message(137, 150, 50);
    call garlcbt;
  garl22: |
    gsay_reply(137, 151);
    giq_option(4, 137, 152, garl23, 50);
    giq_option(4, 137, 153, garl24, 50);
    giq_option(-3, 137, 207, garl17, 50);
  garl23: 'gsay_message(137, 155, 50);

    '
  garl24: |
    gsay_reply(137, 156);
    giq_option(4, 137, 157, garl25, 50);
    giq_option(6, 137, 158, garl18, 50);
    giq_option(6, 137, 159, garl15a, 50);
  garl25: |
    gsay_reply(137, 160);
    giq_option(4, 137, 161, garl26, 50);
    giq_option(4, 137, 162, garl27, 50);
  garl26: |
    gsay_message(137, 163, 50);
    call garlcbt;
  garl27: |
    gsay_reply(137, 164);
    giq_option(4, 137, 165, garl26, 50);
    giq_option(4, 137, 166, garl28, 50);
    giq_option(6, 137, 167, garl29, 50);
  garl28: |
    gsay_reply(137, 168);
    giq_option(4, 137, 169, honorcbt, 50);
  garl29: |
    gsay_reply(137, 170);
    giq_option(4, 137, 171, garlcbt, 50);
  garl32: |
    gsay_reply(137, 174);
    giq_option(4, 137, 175, garl33, 50);
    giq_option(6, 137, 176, garl34, 50);
    giq_option(-3, 137, 154, garl23, 50);
  garl33: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(137, 177, 50);
    end
    else begin
      gsay_message(137, 206, 50);
    end
    call garlcbt;
  garl34: |
    gsay_reply(137, 178);
    giq_option(6, 137, 179, garl35, 50);
    giq_option(6, 137, 180, garl33, 50);
  garl35: |
    gsay_reply(137, 181);
    giq_option(4, 137, 182, garl37, 50);
    giq_option(4, 137, 183, garl36, 50);
  garl36: 'gsay_message(137, 184, 50);

    '
  garl37: |
    gsay_reply(137, 185);
    giq_option(4, 137, 186, garl38, 50);
    giq_option(4, 137, 187, garl37a, 50);
  garl37a: |
    signal_women := 2;
    killing_women := 1;
    add_timer_event(self_obj, game_ticks(15), 1);
  garl38: |
    women_killed := 0;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(137, 188, 50);
    end
    else begin
      gsay_message(137, 189, 50);
    end
    call garlcbt;
  garl38a: |
    women_killed := 0;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      float_msg(self_obj, message_str(137, 188), 2);
    end
    else begin
      float_msg(self_obj, message_str(137, 189), 2);
    end
    call garlcbt;
  garl39a: |
    killing_women := 0;
    if (women_killed > 1) then begin
      call garl40;
    end
    else begin
      call garl38a;
    end
  garl40: |
    women_killed := 0;
    call TopReact;
    float_msg(self_obj, message_str(137, 191), 2);
    temp := 500;
    display_msg(message_str(238, 100) + temp + message_str(238, 102));
    give_exp_points(temp);
    set_global_var(155, global_var(155) + -2);
    set_global_var(611, 1);
  garl41: |
    gsay_reply(137, 192);
    giq_option(4, 137, 193, garl23, 50);
    giq_option(6, 137, 194, garl42, 50);
    giq_option(-3, 137, 195, garl23, 50);
  garl42: 'gsay_message(137, 196, 50);

    '
  garl43: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(137, 197, 50);
    end
    else begin
      gsay_message(137, 198, 50);
    end
    call garlcbt;
  freetandi: |
    set_global_var(26, 5);
    set_map_var(2, 2);
    obj_unlock(Cell_Door_Ptr);
  garlcbt: 'HOSTILE := 1;

    '
  honorcbt: 'add_timer_event(self_obj, game_ticks(1), 3);

    '
  honorarea: |
    variable LVar0 := 0;
    set_local_var(6, tile_num(dude_obj));
    set_local_var(7, 1);
    move_to(dude_obj, 20102, 1);
    move_to(self_obj, 20301, 1);
    LVar0 := critter_inven_obj(dude_obj, 0);
    rm_obj_from_inven(dude_obj, LVar0);
    move_obj_inven_to_obj(self_obj, Garls_Inven_Ptr);
    move_obj_inven_to_obj(dude_obj, Garls_Inven_Ptr);
    add_obj_to_inven(dude_obj, LVar0);
    wield_obj_critter(dude_obj, LVar0);
    if (party_member_obj(16777292) != 0) then begin
      move_to(party_member_obj(16777292), tile_num_in_direction(tile_num(dude_obj), 0, 15), 1);
    end
    if (party_member_obj(16777518) != 0) then begin
      move_to(party_member_obj(16777518), tile_num_in_direction(tile_num(dude_obj), 1, 15), 1);
    end
    if (party_member_obj(16777426) != 0) then begin
      move_to(party_member_obj(16777426), tile_num_in_direction(tile_num(dude_obj), 2, 15), 1);
    end
    if (party_member_obj(16777338) != 0) then begin
      move_to(party_member_obj(16777338), tile_num_in_direction(tile_num(dude_obj), 4, 15), 1);
    end
    if (party_member_obj(16777279) != 0) then begin
      move_to(party_member_obj(16777279), tile_num_in_direction(tile_num(dude_obj), 5, 15), 1);
    end
    critter_add_trait(self_obj, 1, 6, 87);
    critter_add_trait(self_obj, 1, 5, 43);
    call garlcbt;
  garlbarter: |
    gdialog_mod_barter(0);
    gsay_message(137, "", 50);
  return_to_map: |
    move_to(dude_obj, local_var(6), 0);
    move_obj_inven_to_obj(Garls_Inven_Ptr, dude_obj);
    set_global_var(26, 5);
    set_map_var(2, 2);
    obj_unlock(Cell_Door_Ptr);
  Critter_Action: |
    if (global_var(26) == 2) then begin
      set_global_var(254, 1);
    end
    else begin
      if (global_var(116)) then begin
        set_global_var(254, 0);
      end
      else begin
        if (global_var(213)) then begin
          set_global_var(254, 1);
        end
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          if (global_var(214)) then begin
            set_global_var(254, 1);
          end
        end
      end
    end
    if (global_var(254) and obj_can_see_obj(self_obj, dude_obj)) then begin
      HOSTILE := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      HOSTILE := 0;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
garret:
  start: |
    if (not(init)) then begin
      if (local_var(7) == 0) then begin
        set_local_var(7, tile_num(self_obj));
      end
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 78);
      Garret_ptr := self_obj;
      init := 1;
    end
    else begin
      if (script_action == 14) then begin
        set_global_var(249, 1);
      end
      else begin
        if (script_action == 11) then begin
          call do_dialogue;
        end
        else begin
          if (script_action == 21) then begin
            script_overrides;
            display_msg(message_str(102, 100));
          end
          else begin
            if (script_action == 4) then begin
              Hostile := 1;
            end
            else begin
              if (script_action == 12) then begin
                if (global_var(249) and obj_can_see_obj(self_obj, dude_obj)) then begin
                  attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
                end
                else begin
                  my_hex := tile_num(self_obj);
                  if (Hostile > 0) then begin
                    set_global_var(249, 1);
                    attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
                  end
                  if (global_var(60) bwand 1) then begin
                    if (local_var(5) == 0) then begin
                      moving := 1;
                      float_msg(self_obj, message_str(102, 114), 0);
                      set_local_var(5, 1);
                    end
                    else begin
                      if (local_var(5) == 1) then begin
                        moving := 1;
                        if (my_hex != target_hex) then begin
                          animate_move_obj_to_tile(self_obj, target_hex, 0);
                        end
                        else begin
                          set_local_var(5, 2);
                          use_obj(Fridge_ptr);
                        end
                      end
                      else begin
                        if (local_var(5) == 2) then begin
                          moving := 1;
                          if (tile_distance_objs(self_obj, dude_obj) < 5) then begin
                            call reward;
                            set_local_var(5, 3);
                            use_obj(Fridge_ptr);
                          end
                        end
                        else begin
                          if (local_var(5) == 3) then begin
                            moving := 1;
                            target_hex := local_var(7);
                            if (my_hex != target_hex) then begin
                              animate_move_obj_to_tile(self_obj, target_hex, 0);
                            end
                            else begin
                              call done;
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
              else begin
                if (script_action == 18) then begin
                  set_global_var(249, 1);
                  set_global_var(607, 3);
                  if (source_obj == dude_obj) then begin
                    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                      set_global_var(156, 1);
                      set_global_var(157, 0);
                    end
                    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                      set_global_var(157, 1);
                      set_global_var(156, 0);
                    end
                    set_global_var(160, global_var(160) + 1);
                    if ((global_var(160) % 6) == 0) then begin
                      set_global_var(155, global_var(155) + 1);
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    if ((local_var(8) == 0) and (global_var(60) bwand 2)) then begin
      set_local_var(8, 1);
      float_msg(self_obj, message_str(102, 201), 0);
      display_msg(message_str(102, 202));
      stuff := create_object_sid(38, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(39, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(87, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(53, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(40, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(40, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(25, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(25, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(26, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(26, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(27, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(27, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(35, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(35, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(35, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(35, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(36, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(36, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(36, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
      stuff := create_object_sid(36, 0, 0, -1);
      add_obj_to_inven(dude_obj, stuff);
    end
    else begin
      if (moving) then begin
        display_msg(message_str(102, 200));
      end
      else begin
        if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
          call get_reaction;
          if (local_var(4)) then begin
            call garret02a;
          end
          else begin
            set_local_var(4, 1);
            if (local_var(1) >= 2) then begin
              call garret04;
            end
            else begin
              call garret01a;
            end
          end
        end
        else begin
          call garret00b;
        end
      end
    end
  garretend: "[]"
  garretcbt: 'Hostile := 1;

    '
  goodstuff: |
    cash := cash + 100;
    add_mult_objs_to_inven(dude_obj, create_object_sid(41, 0, 0, -1), 100);
    call neutstuff;
    call badstuff;
  neutstuff: |
    cash := cash + 50;
    add_mult_objs_to_inven(dude_obj, create_object_sid(41, 0, 0, -1), 50);
    if (obj_is_carrying_obj_pid(Fridge_ptr, 94)) then begin
      display_msg(message_str(102, 204));
      Shotgun_ptr := obj_carrying_pid_obj(Fridge_ptr, 94);
      rm_obj_from_inven(Fridge_ptr, Shotgun_ptr);
      add_obj_to_inven(dude_obj, Shotgun_ptr);
    end
    else begin
      robbed := 1;
    end
    if (obj_is_carrying_obj_pid(Fridge_ptr, 95)) then begin
      display_msg(message_str(102, 205));
      Shells_ptr := obj_carrying_pid_obj(Fridge_ptr, 95);
      rm_obj_from_inven(Fridge_ptr, Shells_ptr);
      add_obj_to_inven(dude_obj, Shells_ptr);
    end
    else begin
      robbed := 1;
    end
    if (obj_is_carrying_obj_pid(Fridge_ptr, 95)) then begin
      Shells_ptr := obj_carrying_pid_obj(Fridge_ptr, 95);
      rm_obj_from_inven(Fridge_ptr, Shells_ptr);
      add_obj_to_inven(dude_obj, Shells_ptr);
    end
    else begin
      robbed := 1;
    end
  badstuff: |
    cash := cash + 50;
    add_mult_objs_to_inven(dude_obj, create_object_sid(41, 0, 0, -1), 50);
    flare_count := 0;
    call give_flare;
    call give_flare;
    call give_flare;
    call give_flare;
    cola_count := 0;
    call give_cola;
    call give_cola;
    call give_cola;
    call give_cola;
  reward: |
    cash := 0;
    robbed := 0;
    display_msg(message_str(102, 203));
    if (local_var(1) >= 3) then begin
      call goodstuff;
    end
    else begin
      if (local_var(1) >= 2) then begin
        call neutstuff;
      end
      else begin
        call badstuff;
      end
    end
    if (flare_count) then begin
      if (flare_count > 1) then begin
        display_msg(message_str(102, 206));
      end
      else begin
        display_msg(message_str(102, 207));
      end
    end
    if (cola_count) then begin
      if (cola_count > 1) then begin
        display_msg(message_str(102, 208));
      end
      else begin
        display_msg(message_str(102, 209));
      end
    end
    display_msg("$" + cash);
    if (robbed) then begin
      float_msg(self_obj, message_str(102, 121), 0);
    end
    else begin
      float_msg(self_obj, message_str(102, 201), 0);
    end
  done: |
    moving := 0;
    set_local_var(5, 4);
  garret00a: |
    gsay_reply(102, 101);
    giq_option(4, 102, 102, garretend, 50);
    giq_option(4, 102, 103, garret01a, 50);
    giq_option(5, 102, 104, garret02a, 50);
    giq_option(-3, 102, 112, garretend, 50);
  garret00b: |
    float_msg(self_obj, message_str(102, 105), 0);
    call garretend;
  garret00c: |
    gsay_reply(102, 109);
    giq_option(3, 102, 110, garret01c, 50);
    giq_option(5, 102, 111, garret00ca, 50);
    giq_option(-3, 102, 112, garret02c, 50);
  garret00ca: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call garret03c;
    end
    else begin
      call garret02c;
    end
  garret01a: |
    if (indlog) then begin
      gsay_message(102, 113, 50);
    end
    else begin
      float_msg(self_obj, message_str(102, 113), 0);
    end
    call garretend;
  garret01c: |
    gsay_message(102, 115, 50);
    call DownReact;
    call garretend;
  garret02a: |
    call DownReact;
    if (indlog) then begin
      gsay_message(102, 116, 50);
    end
    else begin
      float_msg(self_obj, message_str(102, 116), 0);
    end
    call garretend;
  garret02c: |
    gsay_message(102, 117, 50);
    call garretend;
  garret03c: |
    gsay_message(102, 118, 50);
    display_msg(message_str(102, 119));
    gsay_message(102, 120, 50);
    call garretend;
  garret04: |
    start_gdialog(102, self_obj, 4, -1, -1);
    gsay_start;
    indlog := 1;
    call garret00a;
    indlog := 0;
    gsay_end;
    end_dialogue;
  give_flare: |
    if (obj_is_carrying_obj_pid(Fridge_ptr, 79)) then begin
      flare_count := flare_count + 1;
      Flare_ptr := obj_carrying_pid_obj(Fridge_ptr, 79);
      rm_obj_from_inven(Fridge_ptr, Flare_ptr);
      add_obj_to_inven(dude_obj, Flare_ptr);
    end
    else begin
      robbed := 1;
    end
  give_cola: |
    if (obj_is_carrying_obj_pid(Fridge_ptr, 106)) then begin
      cola_count := cola_count + 1;
      Cola_ptr := obj_carrying_pid_obj(Fridge_ptr, 106);
      rm_obj_from_inven(Fridge_ptr, Cola_ptr);
      add_obj_to_inven(dude_obj, Cola_ptr);
    end
    else begin
      robbed := 1;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
gary:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 79);
      set_local_var(1, 0);
      init_teams := 1;
    end
    else begin
      if ((script_action == 11) and (global_var(35) < 1)) then begin
        if (global_var(306) == 0) then begin
          call do_dialogue;
        end
        else begin
          display_msg(message_str(65, 104));
        end
      end
      else begin
        if (script_action == 21) then begin
          script_overrides;
          display_msg(message_str(65, 101));
        end
        else begin
          if (script_action == 4) then begin
            Hostile := 1;
          end
          else begin
            if (script_action == 12) then begin
              call Critter_Action;
            end
            else begin
              if (script_action == 18) then begin
                set_global_var(35, global_var(35) + 1);
                if (global_var(35) > global_var(551)) then begin
                  set_global_var(155, global_var(155) + 3);
                  set_global_var(29, 2);
                  set_global_var(225, game_time / (10 * 60 * 60 * 24));
                end
                if (source_obj == dude_obj) then begin
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                    set_global_var(156, 1);
                    set_global_var(157, 0);
                  end
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                    set_global_var(157, 1);
                    set_global_var(156, 0);
                  end
                  set_global_var(160, global_var(160) + 1);
                  if ((global_var(160) % 6) == 0) then begin
                    set_global_var(155, global_var(155) + 1);
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      call mutant01;
    end
    else begin
      call mutant02;
    end
  mutant01: |
    float_msg(self_obj, message_str(65, 102), 3);
    call combat;
  mutant02: 'float_msg(self_obj, message_str(65, 103), 3);

    '
  combat: 'Hostile := 1;

    '
  Critter_Action: |
    if ((global_var(35) > 0) and obj_can_see_obj(self_obj, dude_obj) and (global_var(306) < 1)) then begin
      Hostile := 1;
    end
    if (Hostile > 0) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if ((global_var(306) == 1) and (tile_num(self_obj) != 15507)) then begin
        animate_move_obj_to_tile(self_obj, 15507, 0);
      end
      else begin
        if ((global_var(306) == 1) and (tile_num(self_obj) == 15507)) then begin
          set_global_var(306, 2);
        end
        else begin
          if ((global_var(306) == 2) and (tile_num(self_obj) != 12536)) then begin
            animate_move_obj_to_tile(self_obj, 12536, 0);
          end
          else begin
            if ((tile_num(self_obj) == 12536) and (global_var(306) == 2)) then begin
              set_obj_visibility(self_obj, 1);
            end
          end
        end
      end
    end
gastrap:
  start: "[]"
  spatial_p_proc: |
    if (global_var(140) == 1) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
        float_msg(dude_obj, message_str(335, 100), 0);
        display_msg(message_str(335, 101));
        poison(dude_obj, random(3, 9));
      end
    end
gdoor:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 6) then begin
        call use_p_proc;
      end
      else begin
        if (script_action == 8) then begin
          call use_skill_on_p_proc;
        end
        else begin
          if (script_action == 7) then begin
            call use_obj_on_p_proc;
          end
          else begin
            if (script_action == 14) then begin
              call damage_p_proc;
            end
            else begin
              if (script_action == 23) then begin
                call map_update_p_proc;
              end
            end
          end
        end
      end
    end
  use_p_proc: |
    if (local_var(0) == 0) then begin
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
    if ((local_var(0) == 0) and (source_obj == dude_obj)) then begin
      script_overrides;
      display_msg(message_str(63, 104));
    end
    else begin
      set_map_var(6, 1);
    end
  use_skill_on_p_proc: |
    variable LVar0 := 0;
    if (local_var(0) == 0) then begin
      if (action_being_used == 9) then begin
        script_overrides;
        LVar0 := roll_vs_skill(dude_obj, 9, 0);
        if (is_success(LVar0)) then begin
          set_local_var(0, 1);
          display_msg(message_str(63, 100));
          give_exp_points(25);
          display_msg(message_str(766, 103) + "25" + message_str(766, 104));
        end
        else begin
          if (is_critical(LVar0)) then begin
            jam_lock(self_obj);
            display_msg(message_str(63, 110));
          end
          else begin
            display_msg(message_str(63, 103));
          end
        end
      end
    end
    else begin
      display_msg(message_str(63, 109));
    end
  look_at_p_proc: |
    if (local_var(0) == 0) then begin
      script_overrides;
      display_msg(message_str(63, 104));
    end
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := obj_being_used_with;
    LVar1 := roll_vs_skill(dude_obj, 9, 20);
    if ((obj_pid(LVar0) == 84) and (local_var(0) == 0)) then begin
      script_overrides;
      if (is_success(LVar1)) then begin
        set_local_var(0, 1);
        display_msg(message_str(63, 100));
        give_exp_points(25);
        display_msg(message_str(766, 103) + "25" + message_str(766, 104));
      end
      else begin
        if (is_critical(LVar1)) then begin
          rm_obj_from_inven(dude_obj, LVar0);
          destroy_object(LVar0);
          display_msg(message_str(63, 101));
        end
        else begin
          display_msg(message_str(63, 103));
        end
      end
    end
  map_update_p_proc: |
    if (local_var(0) == 0) then begin
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
  damage_p_proc: |
    set_obj_visibility(self_obj, 1);
    set_local_var(1, 1);
    set_map_var(6, 1);
genchant:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 69);
      Only_Once := 0;
    end
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(396, 100));
    end
    else begin
      if (script_action == 18) then begin
        if (source_obj == dude_obj) then begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
            set_global_var(156, 1);
            set_global_var(157, 0);
          end
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
            set_global_var(157, 1);
            set_global_var(156, 0);
          end
          set_global_var(159, global_var(159) + 1);
          if ((global_var(159) % 2) == 0) then begin
            set_global_var(155, global_var(155) - 1);
          end
        end
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            if (Hostile) then begin
              Hostile := 0;
              attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
            end
          end
        end
      end
    end
    if (script_action == 11) then begin
      script_overrides;
      if (global_var(195) == 1) then begin
        float_msg(self_obj, message_str(396, 101), 0);
      end
      else begin
        start_gdialog(396, self_obj, 4, -1, -1);
        gsay_start;
        call Chant01;
        gsay_end;
        end_dialogue;
      end
    end
  Chant01: |
    gsay_reply(396, 102);
    giq_option(7, 396, 103, Chant02, 50);
    giq_option(4, 396, 104, Chant03, 50);
    giq_option(4, 396, 105, Chant04, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 396, 106, Chant05, 50);
    end
    giq_option(-3, 396, 107, Chant06, 50);
  Chant02: |
    gsay_reply(396, 108);
    gsay_option(396, 113, ChantEnd, 50);
  Chant03: |
    gsay_reply(396, 109);
    gsay_option(396, 113, ChantEnd, 50);
  Chant04: |
    gsay_reply(396, 110);
    gsay_option(396, 113, ChantEnd, 50);
  Chant05: |
    gsay_reply(396, 111);
    gsay_option(396, 113, ChantEnd, 50);
  Chant06: |
    gsay_reply(396, 112);
    gsay_option(396, 113, ChantEnd, 50);
  ChantEnd: "[]"
  Combat: 'Hostile := 1;

    '
gencop:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 40);
      critter_add_trait(self_obj, 1, 5, 86);
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      if (global_var(248) == 1) then begin
        hostile := 1;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (cur_map_index == 36) then begin
      call Cop01;
    end
    else begin
      if (cur_map_index == 38) then begin
        call Cop00;
      end
      else begin
        call Cop02;
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  combat_p_proc: |
    if (global_var(248) == 1) then begin
      hostile := 1;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(573, 100));
  Cop00: |
    if (random(0, 3) == 1) then begin
      float_msg(self_obj, message_str(573, random(101, 106)), 2);
    end
    else begin
      if (global_var(158) > 2) then begin
        float_msg(self_obj, message_str(573, random(113, 116)), 2);
      end
      else begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          if (get_critter_stat(dude_obj, 34) == 0) then begin
            float_msg(self_obj, message_str(573, random(110, 112)), 2);
          end
          else begin
            float_msg(self_obj, message_str(573, random(110, 111)), 2);
          end
        end
        else begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
            float_msg(self_obj, message_str(573, random(117, 118)), 2);
          end
          else begin
            if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
              float_msg(self_obj, message_str(573, random(107, 109)), 2);
            end
            else begin
              if (global_var(44) == 2) then begin
                float_msg(self_obj, message_str(573, 119), 2);
              end
              else begin
                float_msg(self_obj, message_str(573, random(101, 106)), 2);
              end
            end
          end
        end
      end
    end
  Cop01: |
    if (random(0, 3) == 1) then begin
      float_msg(self_obj, message_str(573, random(120, 129)), 2);
    end
    else begin
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
        float_msg(self_obj, message_str(573, random(130, 133)), 2);
      end
      else begin
        if (obj_pid(critter_inven_obj(dude_obj, 0)) == 3) then begin
          float_msg(self_obj, message_str(573, 134), 2);
        end
        else begin
          if (global_var(198) == 1) then begin
            float_msg(self_obj, message_str(573, random(135, 137)), 2);
          end
          else begin
            if (global_var(201) == 1) then begin
              float_msg(self_obj, message_str(573, 138), 2);
            end
            else begin
              if (global_var(200) == 1) then begin
                float_msg(self_obj, message_str(573, 139), 2);
              end
              else begin
                if (global_var(199) == 1) then begin
                  float_msg(self_obj, message_str(573, 140), 2);
                end
                else begin
                  if (global_var(202) == 1) then begin
                    float_msg(self_obj, message_str(573, random(141, 143)), 2);
                  end
                  else begin
                    float_msg(self_obj, message_str(573, random(120, 129)), 2);
                  end
                end
              end
            end
          end
        end
      end
    end
  Cop02: |
    variable LVar0 := 0;
    if (random(0, 3) == 1) then begin
      float_msg(self_obj, message_str(573, 144), 2);
    end
    else begin
      if (global_var(198) == 1) then begin
        float_msg(self_obj, message_str(573, random(155, 157)), 2);
      end
      else begin
        if (global_var(201) == 1) then begin
          float_msg(self_obj, message_str(573, 158), 2);
        end
        else begin
          if (global_var(200) == 1) then begin
            float_msg(self_obj, message_str(573, 159), 2);
          end
          else begin
            if (global_var(199) == 1) then begin
              float_msg(self_obj, message_str(573, 160), 2);
            end
            else begin
              if (global_var(202) == 1) then begin
                float_msg(self_obj, message_str(573, random(161, 163)), 2);
              end
              else begin
                LVar0 := random(144, 154);
                if ((LVar0 == 145) or (LVar0 == 146)) then begin
                  if (get_critter_stat(dude_obj, 34) == 0) then begin
                    LVar0 := 145;
                  end
                  else begin
                    LVar0 := 146;
                  end
                end
                float_msg(self_obj, message_str(573, LVar0), 2);
              end
            end
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
gendisk:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(295, 100));
    end
    else begin
      if (script_action == 6) then begin
        script_overrides;
        rndx := random(1, 5);
        display_msg(message_str(295, 101));
        if (rndx == 1) then begin
          display_msg(message_str(295, 102));
        end
        else begin
          if (rndx == 2) then begin
            display_msg(message_str(295, 103));
          end
          else begin
            if (rndx == 3) then begin
              display_msg(message_str(295, 104));
            end
            else begin
              if (rndx == 4) then begin
                display_msg(message_str(295, 105));
              end
              else begin
                if (rndx == 5) then begin
                  display_msg(message_str(295, 106));
                end
              end
            end
          end
        end
        rm_obj_from_inven(dude_obj, 4);
        display_msg(message_str(295, 107));
      end
    end
generic:
  start: |
    if (not(init)) then begin
      if (local_var(7) == 0) then begin
        set_local_var(7, tile_num(self_obj));
        set_local_var(5, 1);
      end
      critter_add_trait(self_obj, 1, 6, 32);
      init := 1;
    end
    else begin
      if (script_action == 22) then begin
        call timetomove;
      end
      else begin
        if (script_action == 11) then begin
          call do_dialogue;
        end
        else begin
          if (script_action == 4) then begin
            Hostile := 1;
          end
          else begin
            if (script_action == 12) then begin
              call Critter_Action;
            end
            else begin
              if (script_action == 18) then begin
                if (source_obj == dude_obj) then begin
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                    set_global_var(156, 1);
                    set_global_var(157, 0);
                  end
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                    set_global_var(157, 1);
                    set_global_var(156, 0);
                  end
                  set_global_var(160, global_var(160) + 1);
                  if ((global_var(160) % 6) == 0) then begin
                    set_global_var(155, global_var(155) + 1);
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    if (local_var(4) == 0) then begin
      set_local_var(4, 1);
      if (local_var(1) < 2) then begin
        if (is_success(do_check(dude_obj, 6, 0))) then begin
          Hostile := Hostile + 1;
        end
        else begin
          Hostile := Hostile + 2;
        end
      end
    end
    if (Hostile) then begin
      call generic01;
    end
    else begin
      call generic00;
    end
  genericend: "[]"
  genericcbt: "[]"
  generic00: |
    rndx := random(1, 7);
    if (rndx == 1) then begin
      float_msg(self_obj, message_str(66, 100), 7);
    end
    if (rndx == 2) then begin
      float_msg(self_obj, message_str(66, 101), 7);
    end
    if (rndx == 3) then begin
      float_msg(self_obj, message_str(66, 102), 7);
    end
    if (rndx == 4) then begin
      float_msg(self_obj, message_str(66, 103), 7);
    end
    if (rndx == 5) then begin
      float_msg(self_obj, message_str(66, 104), 7);
    end
    if (rndx == 6) then begin
      call generic02;
    end
    if (rndx == 7) then begin
      call generic03;
    end
  generic01: |
    rndx := random(1, 4);
    if (rndx == 1) then begin
      float_msg(self_obj, message_str(66, 105), 7);
    end
    if (rndx == 2) then begin
      float_msg(self_obj, message_str(66, 106), 7);
    end
    if (rndx == 3) then begin
      float_msg(self_obj, message_str(66, 107), 7);
    end
    if (rndx == 4) then begin
      float_msg(self_obj, message_str(66, 108), 7);
    end
  generic02: |
    if (SET == 0) then begin
      rndx := random(1, 2);
      if (rndx == 1) then begin
        float_msg(self_obj, message_str(66, 109), 7);
      end
      if (rndx == 2) then begin
        float_msg(self_obj, message_str(66, 110), 7);
      end
    end
    else begin
      float_msg(self_obj, message_str(66, 111), 7);
    end
  generic03: |
    if (MUTANTS == 0) then begin
      rndx := random(1, 2);
      if (rndx == 1) then begin
        float_msg(self_obj, message_str(66, 112), 7);
      end
      if (rndx == 2) then begin
        float_msg(self_obj, message_str(66, 113), 7);
      end
    end
    else begin
      float_msg(self_obj, message_str(66, 114), 7);
    end
  Critter_Action: |
    if (Hostile > 0) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(5)) then begin
        loopcount := loopcount + 1;
        if (loopcount > 40) then begin
          loopcount := 0;
          if (noevent == 0) then begin
            noevent := 1;
            add_timer_event(self_obj, game_ticks(random(5, 13)), 0);
          end
        end
      end
    end
  timetomove: |
    noevent := 0;
    set_local_var(8, tile_num(self_obj));
    new_tile := tile_num_in_direction(local_var(8), random(0, 5), 2);
    if (tile_distance(local_var(7), new_tile) < maxleash) then begin
      animate_move_obj_to_tile(self_obj, new_tile, 0);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
genfgt:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 37);
      critter_add_trait(self_obj, 1, 5, 50);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    float_msg(self_obj, message_str(574, random(101, 107)), 2);
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(574, 100));
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
gengambl:
  start: "[]"
  critter_p_proc: |
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        if (tile_distance_objs(self_obj, dude_obj) < 12) then begin
          if (not(weapon_check)) then begin
            dialogue_system_enter;
            add_timer_event(self_obj, game_ticks(600), 1);
          end
        end
      end
    end
    if (hostile) then begin
      hostile := 0;
      call flee_dude;
    end
    if (cur_map_index == 11) then begin
      if ((global_var(104) == 2) or (global_var(38) == 1)) then begin
        destroy_object(self_obj);
      end
    end
    if ((cur_map_index == 11) and (global_var(628) == 1)) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        call flee_dude;
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(628, 1);
      set_global_var(247, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(351, 100));
  map_enter_p_proc: |
    if (local_var(0) == 0) then begin
      set_local_var(0, tile_num(self_obj));
    end
    if (not(metarule(22, 0)) and not(obj_is_carrying_obj_pid(self_obj, 41)) and (local_var(1) == 0)) then begin
      item_caps_adjust(self_obj, random(0, 25));
      set_local_var(1, 1);
    end
    if (cur_map_index == 11) then begin
      critter_add_trait(self_obj, 1, 6, 16);
      if ((global_var(104) == 2) or (global_var(38) == 1)) then begin
        destroy_object(self_obj);
      end
    end
  talk_p_proc: |
    script_overrides;
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      call gambler1;
    end
    else begin
      if (global_var(158) > 2) then begin
        call gambler3;
      end
      else begin
        if (global_var(105) == 2) then begin
          call gambler4;
        end
        else begin
          if (global_var(155) < -10) then begin
            call gambler2;
          end
          else begin
            call gambler5;
          end
        end
      end
    end
  timed_event_p_proc: 'weapon_check := 0;

    '
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  pickup_p_proc: 'hostile := 1;

    '
  gambler1: |
    variable LVar0 := 0;
    weapon_check := 1;
    LVar0 := random(1, 3);
    if (LVar0 == 1) then begin
      float_msg(self_obj, message_str(351, 101), 0);
    end
    else begin
      if (LVar0 == 2) then begin
        float_msg(self_obj, message_str(351, 102), 0);
      end
      else begin
        if (LVar0 == 3) then begin
          if (get_critter_stat(dude_obj, 34) == 0) then begin
            float_msg(self_obj, message_str(351, 103), 0);
          end
          else begin
            float_msg(self_obj, message_str(351, 104), 0);
          end
        end
      end
    end
  gambler2: 'float_msg(self_obj, message_str(351, random(105, 107)), 0);

    '
  gambler3: 'float_msg(self_obj, message_str(351, random(108, 110)), 0);

    '
  gambler4: 'float_msg(self_obj, message_str(351, random(111, 113)), 0);

    '
  gambler5: |
    variable LVar0 := 0;
    LVar0 := random(1, 6);
    if (LVar0 == 1) then begin
      if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
        float_msg(self_obj, message_str(351, 114), 0);
      end
      else begin
        float_msg(self_obj, message_str(351, 115), 0);
      end
    end
    else begin
      float_msg(self_obj, message_str(351, 114 + LVar0), 0);
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
genghoul:
  start: |
    if (not(init)) then begin
      if (local_var(1) == 0) then begin
        set_local_var(1, tile_num(self_obj));
        set_local_var(0, 1);
        if (cur_map_index == 9) then begin
          set_local_var(3, 1);
        end
      end
      critter_add_trait(self_obj, 1, 6, 87);
      critter_add_trait(self_obj, 1, 5, 93);
      critter_injure(self_obj, 4);
      init := 1;
    end
    else begin
      if (script_action == 22) then begin
        call timetomove;
      end
      else begin
        if (script_action == 11) then begin
          call do_dialogue;
        end
        else begin
          if (script_action == 4) then begin
            Hostile := 1;
          end
          else begin
            if (script_action == 13) then begin
              if (local_var(3)) then begin
                if (fixed_param == 2) then begin
                  rndx := random(1, 6) - 5;
                  if (rndx < 0) then begin
                    rndx := 0;
                  end
                  if (rndx > 0) then begin
                    radiation_inc(target_obj, rndx);
                  end
                end
              end
            end
            else begin
              if (script_action == 12) then begin
                call Critter_Action;
              end
              else begin
                if (script_action == 18) then begin
                  if (source_obj == dude_obj) then begin
                    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                      set_global_var(156, 1);
                      set_global_var(157, 0);
                    end
                    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                      set_global_var(157, 1);
                      set_global_var(156, 0);
                    end
                    set_global_var(160, global_var(160) + 1);
                    if ((global_var(160) % 6) == 0) then begin
                      set_global_var(155, global_var(155) + 1);
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: 'float_msg(self_obj, message_str(32, 105 + random(0, 3)), 7);

    '
  genericend: "[]"
  genericcbt: "[]"
  Critter_Action: |
    if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 3)) then begin
      Hostile := 1;
    end
    if (Hostile > 0) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(0)) then begin
        loopcount := loopcount + 1;
        if (loopcount > 40) then begin
          loopcount := 0;
          if (noevent == 0) then begin
            noevent := 1;
            add_timer_event(self_obj, game_ticks(random(10, 15)), 0);
          end
        end
      end
    end
  timetomove: |
    if (obj_on_screen(self_obj)) then begin
      noevent := 0;
      set_local_var(2, tile_num(self_obj));
      new_tile := tile_num_in_direction(local_var(2), random(0, 5), random(1, 5));
      if (tile_distance(local_var(1), new_tile) < maxleash) then begin
        if (random(0, 1) > 0) then begin
          float_msg(self_obj, message_str(32, 105 + random(0, 3)), 7);
        end
        animate_move_obj_to_tile(self_obj, new_tile, 0);
      end
    end
    else begin
      call Critter_Action;
    end
genglow1:
  start: |
    variable LVar0 := 0;
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 31);
      init_teams := 1;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(68, 100));
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 13) then begin
            if (fixed_param == 2) then begin
              rndx := random(1, 6) - 5;
              if (rndx < 0) then begin
                rndx := 0;
              end
              if (rndx > 0) then begin
                radiation_inc(target_obj, rndx);
              end
            end
          end
          else begin
            if (script_action == 12) then begin
              if (Hostile) then begin
                Hostile := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
            end
            else begin
              if (script_action == 18) then begin
                if (source_obj == dude_obj) then begin
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                    set_global_var(156, 1);
                    set_global_var(157, 0);
                  end
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                    set_global_var(157, 1);
                    set_global_var(156, 0);
                  end
                  set_global_var(159, global_var(159) + 1);
                  if ((global_var(159) % 2) == 0) then begin
                    set_global_var(155, global_var(155) - 1);
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    rndx := random(1, 3);
    if (rndx == 1) then begin
      float_msg(self_obj, message_str(68, 101), 9);
    end
    if (rndx == 2) then begin
      float_msg(self_obj, message_str(68, 102), 9);
    end
    if (rndx == 3) then begin
      float_msg(self_obj, message_str(68, 103), 9);
    end
gengrda:
  start: |
    if (script_action == 12) then begin
      call critter_p_proc;
    end
    else begin
      if (script_action == 18) then begin
        call destroy_p_proc;
      end
      else begin
        if (script_action == 23) then begin
          call map_update_p_proc;
        end
        else begin
          if (script_action == 4) then begin
            call pickup_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
            else begin
              if (script_action == 22) then begin
                call timed_event_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (scared) then begin
      if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
        call flee_dude;
      end
    end
    else begin
      if (hostile) then begin
        hostile := 0;
        scared := 1;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  map_update_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 15 + random(0, 4));
      add_timer_event(self_obj, game_ticks(random(1, 3)), 1);
      hostile := global_var(334);
      initialized := 1;
    end
  pickup_p_proc: |
    if (scared == 0) then begin
      hostile := 1;
      set_global_var(334, 1);
    end
  talk_p_proc: |
    if (scared) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      float_msg(self_obj, message_str(755, random(100, 105)), 3);
    end
  timed_event_p_proc: |
    animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), random(0, 5), random(3, 5)), 0);
    add_timer_event(self_obj, game_ticks(random(0, 3)), 1);
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
gengrdb:
  start: |
    if (not(GVar1)) then begin
      critter_add_trait(self_obj, 1, 6, 35);
      critter_add_trait(self_obj, 1, 5, random(15, 19));
      GVar0 := global_var(334);
      GVar1 := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 4) then begin
            call pickup_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
      if (GVar2) then begin
        call GVar3;
      end
      else begin
        if (GVar0) then begin
          GVar0 := 0;
          GVar2 := 1;
          set_global_var(334, 1);
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    if (source_obj == dude_obj) then begin
      random_seed_2 := 1;
    end
  pickup_p_proc: |
    if (not(GVar2)) then begin
      GVar0 := 1;
      set_global_var(334, 1);
    end
  talk_p_proc: |
    if (GVar2) then begin
      if (random_seed_2) then begin
        float_msg(self_obj, message_str(756, 103), 2);
      end
      else begin
        float_msg(self_obj, message_str(756, 104), 3);
      end
    end
    else begin
      if (random_seed_2) then begin
        float_msg(self_obj, message_str(756, 102), 2);
      end
      else begin
        if (random_seed_1 == 0) then begin
          float_msg(self_obj, message_str(756, 100), 4);
        end
        else begin
          float_msg(self_obj, message_str(756, 101), 3);
        end
      end
    end
genknigh:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 64);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: 'float_msg(self_obj, message_str(718, random(101, 110)), 2);

    '
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(718, 100));
genlock:
  start: "[]"
  pickup_p_proc: |
    if (obj_is_locked(self_obj)) then begin
      script_overrides;
      display_msg(message_str(954, 100));
    end
  use_p_proc: |
    if (obj_is_locked(self_obj)) then begin
      script_overrides;
      display_msg(message_str(954, 100));
    end
  use_skill_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := action_being_used;
    if (LVar0 == 9) then begin
      script_overrides;
      LVar1 := roll_vs_skill(source_obj, 9, 0);
      if (obj_is_locked(self_obj)) then begin
        if (is_success(LVar1)) then begin
          set_local_var(0, 1);
          display_msg(message_str(954, 101));
          obj_unlock(self_obj);
          display_msg(message_str(766, 103) + "25" + message_str(766, 104));
          give_exp_points(25);
        end
        else begin
          if (is_critical(LVar1)) then begin
            display_msg(message_str(954, 102));
            jam_lock(self_obj);
          end
          else begin
            display_msg(message_str(954, 103));
          end
        end
      end
      else begin
        display_msg(message_str(954, 104));
      end
    end
    else begin
      if (LVar0 == 10) then begin
        if (obj_is_locked(self_obj)) then begin
          script_overrides;
          display_msg(message_str(954, 100));
        end
      end
    end
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar1 := obj_being_used_with;
    if (obj_pid(LVar1) == 84) then begin
      script_overrides;
      LVar0 := roll_vs_skill(source_obj, 9, 20);
      if (obj_is_locked(self_obj)) then begin
        if (is_success(LVar0)) then begin
          set_local_var(0, 1);
          display_msg(message_str(954, 101));
          obj_unlock(self_obj);
          display_msg(message_str(766, 103) + "25" + message_str(766, 104));
          give_exp_points(25);
        end
        else begin
          if (is_critical(LVar0)) then begin
            display_msg(message_str(954, 102));
            display_msg(message_str(954, 105));
            jam_lock(self_obj);
            rm_obj_from_inven(source_obj, LVar1);
            destroy_object(LVar1);
          end
          else begin
            display_msg(message_str(954, 103));
          end
        end
      end
      else begin
        display_msg(message_str(954, 104));
      end
    end
  look_at_p_proc: |
    if (obj_is_locked(self_obj)) then begin
      script_overrides;
      display_msg(message_str(954, 100));
    end
  map_update_p_proc: |
    if (local_var(0) == 0) then begin
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
genmerca:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 50);
      index := random(0, 3);
      name_index := 105 + index;
      job_index := 109 + index;
      hostile := 0;
      set_global_var(335, global_var(335) + 1);
      initialized := 1;
    end
    if (script_action == 12) then begin
      call critter_p_proc;
    end
    else begin
      if (script_action == 18) then begin
        call destroy_p_proc;
      end
      else begin
        if (script_action == 4) then begin
          call pickup_p_proc;
        end
        else begin
          if (script_action == 11) then begin
            call talk_p_proc;
          end
        end
      end
    end
  critter_p_proc: |
    if (scared and (tile_distance_objs(self_obj, dude_obj) < 8)) then begin
      call flee_dude;
    end
    else begin
      if (hostile) then begin
        hostile := 0;
        scared := 1;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(334, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  pickup_p_proc: |
    if (scared == 0) then begin
      hostile := 1;
      set_global_var(334, 1);
    end
  talk_p_proc: |
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      set_global_var(156, 1);
      set_global_var(157, 0);
    end
    if (scared) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      start_gdialog(752, self_obj, 4, -1, -1);
      gsay_start;
      call GenMercA00;
      gsay_end;
      end_dialogue;
    end
    if (move) then begin
      move := 0;
      if (index == 0) then begin
        load_map(28, 1);
      end
      else begin
        if (index == 1) then begin
          load_map(10, 1);
        end
        else begin
          if (index == 2) then begin
            load_map(36, 1);
          end
          else begin
            if (index == 3) then begin
              load_map(4, 1);
            end
          end
        end
      end
    end
  GenMercA00: |
    gsay_reply(752, 100);
    giq_option(4, 752, 101, GenMercA01, 50);
    giq_option(4, 752, 102, GenMercA02, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 752, 103, GenMercA03, 51);
    end
    giq_option(-3, 752, 104, GenMercAEnd, 50);
    giq_option(4, 634, 103, GenMercAEnd, 50);
  GenMercA01: |
    gsay_reply(752, name_index);
    giq_option(4, 752, 102, GenMercA02, 50);
    giq_option(4, 634, 100, GenMercAEnd, 50);
  GenMercA02: |
    gsay_reply(752, job_index);
    giq_option(4, 752, 114, GenMercA04, 50);
    giq_option(4, 634, 100, GenMercAEnd, 50);
  GenMercA03: |
    scared := 1;
    gsay_message(752, 113, 51);
  GenMercA04: |
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1)) or (global_var(158) > 2) or (global_var(155) < -20)) then begin
      gsay_message(752, 117, 51);
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
        move := 1;
        gsay_message(752, 115, 50);
      end
      else begin
        gsay_message(752, 116, 50);
      end
    end
  GenMercAEnd: "[]"
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
genmercb:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 35);
      critter_add_trait(self_obj, 1, 5, 50);
      scared := global_var(334);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 14) then begin
          call damage_p_proc;
        end
        else begin
          if (script_action == 18) then begin
            call destroy_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (scared and (tile_distance_objs(dude_obj, self_obj) < 8)) then begin
      call flee_dude;
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      scared := 1;
      set_global_var(334, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  pickup_p_proc: |
    scared := 1;
    set_global_var(334, 1);
  talk_p_proc: |
    raiders_left := random_seed_1;
    dude_attacked_raiders := random_seed_2;
    dude_attacked_guards := random_seed_3;
    if (scared) then begin
      float_msg(self_obj, message_str(753, 104), 2);
    end
    else begin
      if ((raiders_left == 0) and dude_attacked_raiders) then begin
        if (rewarded) then begin
          float_msg(self_obj, message_str(753, 101), 4);
        end
        else begin
          if (get_critter_stat(dude_obj, 34) == 0) then begin
            float_msg(self_obj, message_str(753, 106), 4);
          end
          else begin
            float_msg(self_obj, message_str(753, 107), 4);
          end
          rewarded := 1;
          move_obj_inven_to_obj(self_obj, dude_obj);
          set_global_var(155, global_var(155) + 3);
          give_exp_points(50);
          display_msg(message_str(753, 106));
        end
      end
      else begin
        if (dude_attacked_guards) then begin
          float_msg(self_obj, message_str(753, 103), 2);
        end
        else begin
          if (raiders_left != 0) then begin
            if (random(0, 1)) then begin
              float_msg(self_obj, message_str(753, 105), 3);
            end
            else begin
              float_msg(self_obj, message_str(753, 102), 3);
            end
          end
        end
      end
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
genmutan:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 48);
    end
    else begin
      if (script_action == 14) then begin
        if (global_var(245) == 0) then begin
          set_global_var(245, 1);
        end
      end
      else begin
        if (script_action == 11) then begin
          call pre_dialogue;
        end
        else begin
          if (script_action == 4) then begin
            HOSTILE := 1;
          end
        end
      end
    end
    if (script_action == 12) then begin
      if (HOSTILE) then begin
        HOSTILE := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      else begin
        if (signal_mutants == 1) then begin
          signal_mutants := 0;
          call mutancbt;
        end
        else begin
          if (obj_can_see_obj(self_obj, dude_obj)) then begin
            if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
              if (Weapons == 0) then begin
                Weapons := 1;
                if (tile_distance_objs(self_obj, dude_obj) < 6) then begin
                  dialogue_system_enter;
                end
              end
            end
            DISGUISED := 0;
            if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
              if (metarule(16, 0) > 1) then begin
                DISGUISED := 0;
              end
              else begin
                DISGUISED := 1;
              end
            end
            if ((DISGUISED == 0) and (again == 0)) then begin
              if (tile_distance_objs(self_obj, dude_obj) < 6) then begin
                again := 1;
                dialogue_system_enter;
              end
            end
          end
        end
      end
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
      end
      else begin
        if (script_action == 18) then begin
          if (source_obj == dude_obj) then begin
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
              set_global_var(156, 1);
              set_global_var(157, 0);
            end
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
              set_global_var(157, 1);
              set_global_var(156, 0);
            end
            set_global_var(160, global_var(160) + 1);
            if ((global_var(160) % 6) == 0) then begin
              set_global_var(155, global_var(155) + 1);
            end
          end
        end
      end
    end
  do_dialogue: |
    set_local_var(3, 1);
    call get_reaction;
    start_gdialog(524, self_obj, 4, -1, -1);
    gsay_start;
    if (Weapons == 1) then begin
      call mutan01;
    end
    else begin
      if (local_var(4)) then begin
        call mutan13;
      end
      else begin
        set_local_var(4, 1);
        call mutan05;
      end
    end
    gsay_end;
    end_dialogue;
  pre_dialogue: |
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      if (metarule(16, 0) > 1) then begin
        DISGUISED := 0;
      end
      else begin
        DISGUISED := 1;
      end
    end
    if (Weapons == 1) then begin
      if (DISGUISED) then begin
        call do_dialogue;
      end
      else begin
        call mutan00;
      end
    end
    else begin
      if (DISGUISED) then begin
        call do_dialogue;
      end
      else begin
        call mutan00;
      end
    end
  mutan00: |
    rndx := random(1, 8);
    if (rndx < 5) then begin
      if (rndx == 1) then begin
        float_msg(self_obj, message_str(524, 100), 2);
      end
      else begin
        if (rndx == 2) then begin
          float_msg(self_obj, message_str(524, 101), 2);
        end
        else begin
          if (rndx == 3) then begin
            float_msg(self_obj, message_str(524, 102), 2);
          end
          else begin
            if (rndx == 4) then begin
              float_msg(self_obj, message_str(524, 103), 2);
            end
          end
        end
      end
    end
    call mutancbt;
  mutan01: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(524, 104);
    end
    else begin
      gsay_reply(524, 105);
    end
    giq_option(4, 524, 107, mutan02, 51);
    giq_option(6, 524, 108, mutan03, 50);
    giq_option(9, 524, 109, mutan04, 50);
    giq_option(-3, 524, 106, mutan02, 51);
  mutan02: |
    gsay_message(524, 110, 51);
    call mutancbt;
  mutan03: |
    gsay_reply(524, 111);
    giq_option(6, 524, 112, mutan03a, 50);
    giq_option(6, 524, 113, mutancbt, 51);
  mutan03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call mutan04;
    end
    else begin
      call mutan02;
    end
  mutan04: |
    gsay_message(524, 114, 50);
    set_local_var(5, 1);
  mutan05: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(524, 115);
    end
    else begin
      gsay_reply(524, 116);
    end
    giq_option(4, 524, 118, mutan05a, 50);
    giq_option(6, 524, 119, mutan05b, 50);
    giq_option(-3, 524, 106, mutan06, 50);
  mutan05a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call mutan08;
    end
    else begin
      call mutan07;
    end
  mutan05b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call mutan10;
    end
    else begin
      call mutan11;
    end
  mutan06: |
    gsay_message(524, 120, 50);
    set_local_var(5, 1);
  mutan07: |
    gsay_message(524, 121, 51);
    call mutancbt;
  mutan08: |
    gsay_reply(524, 122);
    giq_option(4, 524, 123, mutan08a, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 524, 124, mutancbt, 51);
    end
    giq_option(7, 524, 125, mutan08b, 50);
  mutan08a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call mutan04;
    end
    else begin
      call mutan07;
    end
  mutan08b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 20))) then begin
      call mutan04;
    end
    else begin
      call mutan09;
    end
  mutan09: |
    gsay_message(524, 126, 51);
    call mutancbt;
  mutan10: |
    gsay_message(524, 127, 50);
    set_local_var(5, 1);
  mutan11: |
    gsay_reply(524, 128);
    giq_option(6, 524, 129, mutan11a, 50);
    giq_option(6, 524, 130, mutancbt, 51);
  mutan11a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call mutan12;
    end
    else begin
      call mutan09;
    end
  mutan12: |
    gsay_message(524, 131, 50);
    set_local_var(5, 1);
  mutan13: |
    gsay_reply(524, 132);
    giq_option(4, 524, 134, mutancbt, 51);
    giq_option(4, 524, 135, mutan13a, 50);
    giq_option(6, 524, 136, mutan13b, 50);
    giq_option(-3, 524, 133, mutan14, 51);
  mutan13a: |
    if (is_success(do_check(dude_obj, 6, 0))) then begin
      call mutan12;
    end
    else begin
      call mutan09;
    end
  mutan13b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 20))) then begin
      call mutan10;
    end
    else begin
      call mutan11;
    end
  mutan14: |
    gsay_message(524, 137, 51);
    call mutancbt;
  mutan15: |
    rndx := random(1, 3);
    if (rndx == 1) then begin
      gsay_message(524, 138, 50);
    end
    else begin
      if (rndx == 2) then begin
        gsay_message(524, 139, 50);
      end
      else begin
        if (rndx == 3) then begin
          gsay_message(524, 140, 50);
        end
      end
    end
  mutanend: "[]"
  mutancbt: 'HOSTILE := 1;

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
genpala:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 65);
      hostile := global_var(334);
      initialized := 1;
    end
    else begin
      if (script_action == 13) then begin
        call combat_p_proc;
      end
      else begin
        if (script_action == 12) then begin
          call critter_p_proc;
        end
        else begin
          if (script_action == 18) then begin
            call destroy_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  combat_p_proc: |
    if (fixed_param == 4) then begin
      round_counter := round_counter + 1;
      if (get_critter_stat(self_obj, 35) < 10) then begin
        scared := 1;
      end
    end
  critter_p_proc: |
    if (scared) then begin
      if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
        call flee_dude;
      end
    end
    else begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      random_seed_1 := 1;
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
      set_global_var(250, 1);
    end
  pickup_p_proc: |
    if (not(scared)) then begin
      hostile := 1;
      set_global_var(334, 1);
    end
  talk_p_proc: |
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      set_global_var(156, 1);
      set_global_var(157, 0);
    end
    if (scared) then begin
      float_msg(self_obj, message_str(758, 101), 2);
    end
    else begin
      if ((global_var(250) == 1) or (random_seed_1 == 1)) then begin
        float_msg(self_obj, message_str(758, 100), 2);
        set_global_var(334, 1);
        hostile := 1;
      end
      else begin
        if (global_var(45) == 2) then begin
          float_msg(self_obj, message_str(758, 102), 4);
        end
        else begin
          if ((global_var(155) < -20) or (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) or (global_var(158) > 2)) then begin
            float_msg(self_obj, message_str(758, 104), 2);
          end
          else begin
            float_msg(self_obj, message_str(758, 103), 3);
          end
        end
      end
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
genpalad:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 65);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: 'float_msg(self_obj, message_str(719, random(102, 109)), 2);

    '
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(719, 100));
genpalb:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 65);
      hostile := global_var(334);
      initialized := 1;
    end
    else begin
      if (script_action == 13) then begin
        call combat_p_proc;
      end
      else begin
        if (script_action == 12) then begin
          call critter_p_proc;
        end
        else begin
          if (script_action == 18) then begin
            call destroy_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  combat_p_proc: |
    if (fixed_param == 4) then begin
      round_counter := round_counter + 1;
      if (get_critter_stat(self_obj, 35) < 10) then begin
        scared := 1;
      end
    end
  critter_p_proc: |
    if (scared) then begin
      if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
        call flee_dude;
      end
    end
    else begin
      if (hostile) then begin
        hostile := 0;
        random_seed_1 := 1;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      random_seed_1 := 1;
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
      set_global_var(250, 1);
    end
  pickup_p_proc: |
    if (not(scared)) then begin
      hostile := 1;
      set_global_var(334, 1);
    end
  talk_p_proc: |
    if (known) then begin
      if (annoyed) then begin
        call GenPalB23;
      end
      else begin
        start_gdialog(759, self_obj, 4, -1, -1);
        gsay_start;
        call GenPalB24;
        gsay_end;
        end_dialogue;
      end
    end
    else begin
      if (scared) then begin
        call GenPalB01;
      end
      else begin
        if ((random_seed_1 == 1) or (global_var(250) == 1)) then begin
          call GenPalB00;
        end
        else begin
          start_gdialog(759, self_obj, 4, -1, -1);
          gsay_start;
          if (global_var(45) == 2) then begin
            call GenPalB02;
          end
          else begin
            if (global_var(74) >= 1) then begin
              if (global_var(155) >= 20) then begin
                call GenPalB03;
              end
              else begin
                call GenPalB04;
              end
            end
            else begin
              if ((global_var(155) < 20) or (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) or (global_var(158) > 2)) then begin
                call GenPalB06;
              end
              else begin
                call GenPalB05;
              end
            end
          end
          gsay_end;
          end_dialogue;
        end
      end
    end
  GenPalB00: |
    float_msg(self_obj, message_str(759, 100), 2);
    hostile := 1;
    set_global_var(334, 1);
  GenPalB01: 'float_msg(self_obj, message_str(759, 101), 2);

    '
  GenPalB02: |
    known := 1;
    gsay_reply(759, 102);
    giq_option(7, 759, 103, GenPalB07, 50);
    giq_option(4, 759, 104, GenPalB08, 50);
    giq_option(4, 759, 105, GenPalB09, 50);
    giq_option(4, 759, 106, GenPalB10, 50);
    giq_option(-3, 759, 107, GenPalB11, 50);
  GenPalB03: |
    known := 1;
    gsay_reply(759, 108);
    giq_option(7, 759, 109, GenPalB12, 50);
    giq_option(4, 759, 110, GenPalB13, 50);
    giq_option(4, 759, 111, GenPalB14, 50);
    giq_option(4, 759, 112, GenPalB15, 50);
    giq_option(4, 759, 113, GenPalB16, 50);
    giq_option(-3, 759, 114, GenPalB11, 50);
  GenPalB04: |
    known := 1;
    annoyed := 1;
    gsay_message(759, 115, 51);
  GenPalB05: |
    known := 1;
    gsay_reply(759, 116);
    if ((global_var(101) == 0) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 759, message_str(759, 117) + proto_data(obj_pid(dude_obj), 1) + message_str(759, 118), GenPalB17, 50);
    end
    giq_option(4, 759, message_str(759, 117) + proto_data(obj_pid(dude_obj), 1) + message_str(759, 119), GenPalB18, 50);
    giq_option(4, 759, message_str(759, 117) + proto_data(obj_pid(dude_obj), 1) + message_str(759, 120), GenPalB19, 50);
    giq_option(4, 759, message_str(759, 117) + proto_data(obj_pid(dude_obj), 1) + message_str(759, 121), GenPalB21, 50);
    giq_option(4, 759, 122, GenPalB21, 51);
    giq_option(-3, 759, 123, GenPalB22, 50);
  GenPalB06: |
    known := 1;
    annoyed := 1;
    gsay_message(759, 124, 51);
  GenPalB07: 'gsay_message(759, 125, 50);

    '
  GenPalB08: 'gsay_message(759, 126, 50);

    '
  GenPalB09: 'gsay_message(759, 127, 50);

    '
  GenPalB10: |
    gsay_reply(759, 128);
    giq_option(0, 634, 106, GenPalB10a, 50);
  GenPalB10a: 'gsay_message(759, 129, 50);

    '
  GenPalB11: 'gsay_message(759, 130, 50);

    '
  GenPalB12: |
    gsay_reply(759, 131);
    if ((global_var(101) == 0) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 759, 132, GenPalB17, 50);
    end
    giq_option(4, 759, 133, GenPalB18, 50);
    giq_option(4, 759, 134, GenPalB19, 50);
    giq_option(4, 759, 135, GenPalB20, 50);
    giq_option(4, 759, 122, GenPalB21, 50);
  GenPalB13: |
    known := 1;
    annoyed := 1;
    gsay_message(759, 136, 51);
  GenPalB14: 'gsay_message(759, 137, 50);

    '
  GenPalB15: 'gsay_message(759, 138, 50);

    '
  GenPalB16: |
    gsay_message(759, 139, 50);
    gfade_out(600);
    game_time_advance(game_ticks(random(86400, 172800)));
    load_map(13, 0);
    gfade_in(600);
  GenPalB17: 'gsay_message(759, 140, 50);

    '
  GenPalB18: 'gsay_message(759, 141, 50);

    '
  GenPalB19: |
    annoyed := 1;
    gsay_message(759, 142, 51);
  GenPalB20: |
    gsay_reply(759, 143);
    giq_option(0, 634, 106, GenPalB20a, 50);
  GenPalB20a: 'gsay_message(759, 144, 50);

    '
  GenPalB21: |
    hostile := 1;
    set_global_var(334, 1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(759, 145, 51);
    end
    else begin
      gsay_message(759, 146, 51);
    end
  GenPalB22: 'gsay_message(759, 147, 50);

    '
  GenPalB23: 'float_msg(self_obj, message_str(759, 148), 2);

    '
  GenPalB24: |
    gsay_reply(759, 149);
    if ((global_var(101) == 0) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 759, 132, GenPalB17, 50);
    end
    giq_option(4, 759, 133, GenPalB18, 50);
    giq_option(4, 759, 150, GenPalB25, 50);
    giq_option(4, 759, 135, GenPalB20, 50);
    giq_option(4, 759, 122, GenPalB21, 51);
  GenPalB25: |
    annoyed := 1;
    gsay_message(759, 151, 51);
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
genraid2:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 6);
      critter_add_trait(self_obj, 1, 5, 20);
    end
    if (script_action == 22) then begin
      if (fixed_param == 1) then begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
          call combat;
        end
      end
      else begin
        if (fixed_param == 2) then begin
          if (tile_distance_objs(self_obj, dude_obj) < 6) then begin
            call combat;
          end
        end
        else begin
          if (fixed_param == 3) then begin
            if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
              call combat;
            end
          end
        end
      end
    end
    else begin
      if (script_action == 11) then begin
        if (local_var(5) == 1) then begin
          display_msg(message_str(439, 100));
        end
        else begin
          call do_dialogue;
        end
      end
      else begin
        if (script_action == 4) then begin
          HOSTILE := 1;
        end
      end
    end
    if (script_action == 12) then begin
      call Critter_Action;
      if (HOSTILE) then begin
        HOSTILE := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      else begin
        if (obj_can_see_obj(self_obj, dude_obj) and (global_var(611) != 1)) then begin
          if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) and ((Weapons == 0) and (killing_women == 0))) then begin
            Weapons := 1;
            dialogue_system_enter;
          end
        end
      end
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(439, 101));
      end
      else begin
        if (script_action == 14) then begin
          call damage_p_proc;
        end
        else begin
          if (script_action == 18) then begin
            if (source_obj == dude_obj) then begin
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                set_global_var(156, 1);
                set_global_var(157, 0);
              end
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                set_global_var(157, 1);
                set_global_var(156, 0);
              end
              set_global_var(160, global_var(160) + 1);
              if ((global_var(160) % 6) == 0) then begin
                set_global_var(155, global_var(155) + 1);
              end
            end
            set_global_var(254, 1);
            set_global_var(611, 0);
            set_global_var(115, global_var(115) - 1);
          end
        end
      end
    end
  do_dialogue: |
    if (global_var(116) == 1) then begin
      call guard00;
    end
    else begin
      if ((Weapons == 1) and (killing_women == 0) and (global_var(611) != 1)) then begin
        call guard02;
      end
      else begin
        call sys_dialog;
      end
    end
  sys_dialog: |
    set_local_var(3, 1);
    call get_reaction;
    start_gdialog(439, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4) == 0) then begin
      set_local_var(4, 1);
      call guard04;
    end
    else begin
      call guard15;
    end
    gsay_end;
    end_dialogue;
  guard00: 'float_msg(self_obj, message_str(439, random(102, 106)), 8);

    '
  guard01: |
    rndx := random(1, 5);
    if (rndx == 1) then begin
      gsay_message(439, 107, 50);
    end
    else begin
      if (rndx == 2) then begin
        gsay_message(439, 108, 50);
      end
      else begin
        if (rndx == 3) then begin
          gsay_message(439, 109, 50);
        end
        else begin
          if (rndx == 4) then begin
            gsay_message(439, 110, 50);
          end
          else begin
            if (rndx == 5) then begin
              gsay_message(439, 111, 50);
            end
          end
        end
      end
    end
  guard02: |
    float_msg(self_obj, message_str(439, random(112, 115)), 8);
    add_timer_event(self_obj, game_ticks(9), 1);
  guard03: |
    rndx := random(1, 3);
    if (rndx == 1) then begin
      gsay_message(439, 116, 50);
    end
    else begin
      if (rndx == 2) then begin
        gsay_message(439, 117, 50);
      end
      else begin
        if (rndx == 3) then begin
          gsay_message(439, 118, 50);
        end
      end
    end
    add_timer_event(self_obj, game_ticks(10), 2);
  guard04: |
    gsay_reply(439, 119);
    if ((global_var(103) == 1) and (global_var(218) == 1)) then begin
      giq_option(4, 439, 120, guard07, 50);
    end
    giq_option(4, 439, 121, guard06, 50);
    giq_option(-3, 439, 122, guard05, 50);
  guard05: 'gsay_message(439, 123, 50);

    '
  guard06: |
    gsay_message(439, 124, 50);
    call DownReact;
  guard07: |
    gsay_reply(439, 125);
    giq_option(4, 439, 126, guard08, 50);
    giq_option(6, 439, 127, guard07a, 50);
    if (is_success(do_check(dude_obj, 1, 0))) then begin
      giq_option(4, 439, 128, guard07b, 50);
    end
  guard07a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call guard09;
    end
    else begin
      call guard11;
    end
  guard07b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call guard12;
    end
    else begin
      call guard13;
    end
  guard08: 'gsay_message(439, 129, 50);

    '
  guard09: |
    gsay_reply(439, 130);
    giq_option(6, 439, 131, guard10, 50);
  guard10: 'gsay_message(439, 132, 50);

    '
  guard11: 'gsay_message(439, 133, 50);

    '
  guard12: |
    gsay_message(439, 134, 50);
    set_local_var(5, 1);
  guard13: |
    gsay_message(439, 135, 50);
    call combat;
  guard14: |
    gsay_message(439, 136, 50);
    add_timer_event(self_obj, game_ticks(12), 3);
  guard15: 'gsay_message(439, 137, 50);

    '
  guardend: "[]"
  combat: |
    if (global_var(116) == 1) then begin
      critter_add_trait(self_obj, 1, 6, 87);
    end
    HOSTILE := 1;
  weapon_check: |
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      Weapons := 0;
    end
    else begin
      Weapons := 1;
    end
  Critter_Action: |
    variable LVar0 := 0;
    if (global_var(26) == 2) then begin
      set_global_var(254, 1);
    end
    else begin
      if (global_var(116)) then begin
        set_global_var(254, 0);
        if (tile_distance_objs(self_obj, dude_obj) < 3) then begin
          LVar0 := tile_num_in_direction(tile_num(self_obj), random(0, 5), 3);
          if (tile_distance(tile_num(self_obj), LVar0) > 2) then begin
            if (random(0, 9) == 0) then begin
              float_msg(self_obj, message_str(136, random(102, 106)), 8);
            end
            animate_move_obj_to_tile(self_obj, LVar0, 0);
          end
        end
      end
      else begin
        if (global_var(213)) then begin
          set_global_var(254, 1);
        end
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          if (global_var(214)) then begin
            set_global_var(254, 1);
          end
        end
        if (map_var(2) == 1) then begin
          set_global_var(254, 1);
        end
      end
    end
    if (global_var(254) and obj_can_see_obj(self_obj, dude_obj)) then begin
      HOSTILE := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      HOSTILE := 0;
    end
  damage_p_proc: |
    if (global_var(116) == 0) then begin
      set_global_var(254, 1);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
  first: "[]"
  notfirst: "[]"
genraidb:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 6);
      critter_add_trait(self_obj, 1, 5, 20);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 4) then begin
            call pickup_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      scared := 1;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(290, global_var(290) + 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(160, global_var(160) + 1);
        if ((global_var(160) % 6) == 0) then begin
          set_global_var(155, global_var(155) + 1);
        end
      end
    end
    set_global_var(289, global_var(289) - 1);
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (scared) then begin
      float_msg(self_obj, message_str(750, random(102, 103)), 0);
    end
    else begin
      float_msg(self_obj, message_str(750, random(100, 101)), 0);
    end
genraidr:
  start: "[]"
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
        call combat;
      end
    end
    else begin
      if (fixed_param == 2) then begin
        if (tile_distance_objs(self_obj, dude_obj) < 6) then begin
          call combat;
        end
      end
      else begin
        if (fixed_param == 3) then begin
          if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
            call combat;
          end
        end
      end
    end
  talk_p_proc: |
    if (local_var(5) == 1) then begin
      display_msg(message_str(136, 100));
    end
    else begin
      call do_dialogue;
    end
  pickup_p_proc: 'hostile := 1;

    '
  critter_p_proc: |
    call Critter_Action;
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 6);
      critter_add_trait(self_obj, 1, 5, 20);
      initialized := 1;
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    rndq := random(0, 10);
    if (rndq == 1) then begin
      rndr := random(0, 5);
      animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), rndr, 1), 0);
    end
    else begin
      if (obj_can_see_obj(self_obj, dude_obj) and (global_var(611) != 1)) then begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) and ((Weapons == 0) and (killing_women == 0))) then begin
          Weapons := 1;
          dialogue_system_enter;
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    set_global_var(254, 1);
    set_global_var(611, 0);
    set_global_var(115, global_var(115) - 1);
  damage_p_proc: |
    if (global_var(116) == 0) then begin
      set_global_var(254, 1);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(136, 101));
  do_dialogue: |
    if (global_var(116) == 1) then begin
      call guard00;
    end
    else begin
      if ((Weapons == 1) and (killing_women == 0) and (global_var(611) != 1)) then begin
        call guard02;
      end
      else begin
        call sys_dialog;
      end
    end
  sys_dialog: |
    set_local_var(3, 1);
    call get_reaction;
    start_gdialog(136, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4) == 0) then begin
      set_local_var(4, 1);
      call guard04;
    end
    else begin
      call guard15;
    end
    gsay_end;
    end_dialogue;
  guard00: 'float_msg(self_obj, message_str(136, random(102, 106)), 8);

    '
  guard02: |
    float_msg(self_obj, message_str(136, random(112, 115)), 8);
    add_timer_event(self_obj, game_ticks(9), 1);
  guard04: |
    gsay_reply(136, 119);
    if ((global_var(103) == 1) and (global_var(218) == 1)) then begin
      giq_option(4, 136, 120, guard07, 50);
    end
    giq_option(4, 136, 121, guard06, 50);
    giq_option(-3, 136, 122, guard05, 50);
  guard05: 'gsay_message(136, 123, 50);

    '
  guard06: |
    gsay_message(136, 124, 50);
    call DownReact;
  guard07: |
    gsay_reply(136, 125);
    giq_option(4, 136, 126, guard08, 50);
    giq_option(5, 136, 127, guard07a, 50);
    if (is_success(do_check(dude_obj, 1, 0))) then begin
      giq_option(4, 136, 128, guard07b, 50);
    end
  guard07a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call guard09;
    end
    else begin
      call guard11;
    end
  guard07b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call guard12;
    end
    else begin
      call guard13;
    end
  guard08: 'gsay_message(136, 129, 50);

    '
  guard09: |
    gsay_reply(136, 130);
    giq_option(6, 136, 131, guard10, 50);
  guard10: 'gsay_message(136, 132, 50);

    '
  guard11: 'gsay_message(136, 133, 50);

    '
  guard12: |
    gsay_message(136, 134, 50);
    set_local_var(5, 1);
  guard13: |
    gsay_message(136, 135, 50);
    call combat;
  guard15: 'gsay_message(136, 137, 50);

    '
  combat: |
    if (global_var(116) == 1) then begin
      critter_add_trait(self_obj, 1, 6, 87);
    end
    hostile := 1;
  Critter_Action: |
    variable LVar0 := 0;
    if (global_var(26) == 2) then begin
      set_global_var(254, 1);
    end
    else begin
      if (global_var(116)) then begin
        set_global_var(254, 0);
        if (tile_distance_objs(self_obj, dude_obj) < 3) then begin
          LVar0 := tile_num_in_direction(tile_num(self_obj), random(0, 5), 3);
          if (tile_distance(tile_num(self_obj), LVar0) > 2) then begin
            if (random(0, 9) == 0) then begin
              float_msg(self_obj, message_str(136, random(102, 106)), 8);
            end
            animate_move_obj_to_tile(self_obj, LVar0, 0);
          end
        end
      end
      else begin
        if (global_var(213)) then begin
          set_global_var(254, 1);
        end
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          if (global_var(214)) then begin
            set_global_var(254, 1);
          end
        end
        if (map_var(2) == 1) then begin
          set_global_var(254, 1);
        end
      end
    end
    if (global_var(254) and obj_can_see_obj(self_obj, dude_obj)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
gensarg:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 49);
    end
    else begin
      if (script_action == 14) then begin
        if (global_var(245) == 0) then begin
          set_global_var(245, 1);
        end
      end
      else begin
        if (script_action == 11) then begin
          call pre_dialogue;
        end
        else begin
          if (script_action == 4) then begin
            HOSTILE := 1;
          end
        end
      end
    end
    if (script_action == 12) then begin
      if (HOSTILE) then begin
        HOSTILE := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
          if (Weapons == 0) then begin
            Weapons := 1;
            if (tile_distance_objs(self_obj, dude_obj) < 6) then begin
              dialogue_system_enter;
            end
          end
        end
        DISGUISED := 0;
        if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
          if (metarule(16, 0) > 1) then begin
            DISGUISED := 0;
          end
          else begin
            DISGUISED := 1;
          end
        end
        if ((DISGUISED == 0) and (again == 0)) then begin
          if (tile_distance_objs(self_obj, dude_obj) < 6) then begin
            again := 1;
            dialogue_system_enter;
          end
        end
      end
    end
    else begin
      if (script_action == 21) then begin
        script_overrides;
        display_msg(message_str(525, 200));
      end
      else begin
        if (script_action == 18) then begin
          if (source_obj == dude_obj) then begin
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
              set_global_var(156, 1);
              set_global_var(157, 0);
            end
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
              set_global_var(157, 1);
              set_global_var(156, 0);
            end
            set_global_var(160, global_var(160) + 1);
            if ((global_var(160) % 6) == 0) then begin
              set_global_var(155, global_var(155) + 1);
            end
          end
        end
      end
    end
  do_dialogue: |
    set_local_var(3, 1);
    call get_reaction;
    start_gdialog(525, self_obj, 4, -1, -1);
    gsay_start;
    if (Weapons == 1) then begin
      call mutan01;
    end
    else begin
      if (local_var(4)) then begin
        call mutan13;
      end
      else begin
        set_local_var(4, 1);
        call mutan05;
      end
    end
    gsay_end;
    end_dialogue;
  pre_dialogue: |
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      if (metarule(16, 0) > 1) then begin
        DISGUISED := 0;
      end
      else begin
        DISGUISED := 1;
      end
    end
    if (Weapons == 1) then begin
      if (DISGUISED) then begin
        call do_dialogue;
      end
      else begin
        call mutan00;
      end
    end
    else begin
      if (DISGUISED) then begin
        call do_dialogue;
      end
      else begin
        call mutan00;
      end
    end
  mutan00: |
    rndx := random(1, 12);
    if (rndx < 5) then begin
      if (rndx == 1) then begin
        float_msg(self_obj, message_str(524, 100), 2);
      end
      else begin
        if (rndx == 2) then begin
          float_msg(self_obj, message_str(524, 101), 2);
        end
        else begin
          if (rndx == 3) then begin
            float_msg(self_obj, message_str(524, 102), 2);
          end
          else begin
            if (rndx == 4) then begin
              float_msg(self_obj, message_str(524, 103), 2);
            end
          end
        end
      end
    end
    call mutancbt;
  mutan01: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(525, 107);
    end
    else begin
      gsay_reply(525, 108);
    end
    giq_option(4, 525, 110, mutan02, 51);
    giq_option(6, 525, 111, mutan03, 50);
    giq_option(9, 525, 112, mutan04, 50);
    giq_option(-3, 525, 109, mutan02, 51);
  mutan02: |
    gsay_message(525, 113, 51);
    call mutancbt;
  mutan03: |
    gsay_reply(525, 114);
    giq_option(6, 525, 115, mutan03a, 50);
    giq_option(6, 525, 116, mutancbt, 51);
  mutan03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call mutan04;
    end
    else begin
      call mutan02;
    end
  mutan04: |
    gsay_message(525, 117, 50);
    set_local_var(5, 1);
  mutan05: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(525, 118);
    end
    else begin
      gsay_reply(525, 119);
    end
    giq_option(4, 525, 121, mutan05a, 50);
    giq_option(6, 525, 122, mutan05b, 50);
    giq_option(-3, 525, 109, mutan06, 50);
  mutan05a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call mutan08;
    end
    else begin
      call mutan07;
    end
  mutan05b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call mutan10;
    end
    else begin
      call mutan11;
    end
  mutan06: |
    gsay_message(525, 123, 50);
    set_local_var(5, 1);
  mutan07: |
    gsay_message(525, 124, 51);
    call mutancbt;
  mutan08: |
    gsay_reply(525, 125);
    giq_option(4, 525, 126, mutan08a, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 525, 127, mutancbt, 51);
    end
    giq_option(7, 525, 128, mutan08b, 50);
  mutan08a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call mutan04;
    end
    else begin
      call mutan07;
    end
  mutan08b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 20))) then begin
      call mutan04;
    end
    else begin
      call mutan09;
    end
  mutan09: |
    gsay_message(525, 129, 51);
    call mutancbt;
  mutan10: |
    gsay_message(525, 130, 50);
    set_local_var(5, 1);
  mutan11: |
    gsay_reply(525, 131);
    giq_option(6, 525, 132, mutan11a, 50);
    giq_option(6, 525, 133, mutancbt, 51);
  mutan11a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call mutan12;
    end
    else begin
      call mutan09;
    end
  mutan12: |
    gsay_message(525, 134, 50);
    set_local_var(5, 1);
  mutan13: |
    gsay_reply(525, 135);
    giq_option(4, 525, 137, mutancbt, 51);
    giq_option(4, 525, 138, mutan13a, 50);
    giq_option(6, 525, 139, mutan13b, 50);
    giq_option(-3, 525, 136, mutan14, 51);
  mutan13a: |
    if (is_success(do_check(dude_obj, 6, 0))) then begin
      call mutan12;
    end
    else begin
      call mutan09;
    end
  mutan13b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 20))) then begin
      call mutan10;
    end
    else begin
      call mutan11;
    end
  mutan14: |
    gsay_message(525, 140, 51);
    call mutancbt;
  mutan15: |
    rndx := random(1, 2);
    if (rndx == 1) then begin
      gsay_message(525, 141, 50);
    end
    else begin
      if (rndx == 2) then begin
        gsay_message(525, 142, 50);
      end
    end
  mutanend: "[]"
  mutancbt: 'HOSTILE := 1;

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
genscrib:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 63);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    rndx := random(101, 115);
    if (rndx == 104) then begin
      rndx := 107;
    end
    float_msg(self_obj, message_str(717, rndx), 2);
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(717, 100));
genskag:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if ((game_time_hour > 700) and (game_time_hour < 1900)) then begin
      float_msg(self_obj, message_str(575, random(101, 109)), 2);
    end
    else begin
      float_msg(self_obj, message_str(575, random(110, 116)), 2);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(575, 100));
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 41);
      critter_add_trait(self_obj, 1, 5, 51);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
genskulz:
  start: "[]"
  critter_p_proc: |
    if (global_var(626) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (cur_map_index == 11) then begin
        if ((map_var(2) == 2) and (waypoint == 0)) then begin
          waypoint := 1;
          dest_tile := 26297;
          sleeping_disabled := 1;
        end
        else begin
          if ((global_var(282) == 1) and (waypoint == 0)) then begin
            waypoint := 1;
            sleeping_disabled := 1;
            add_timer_event(self_obj, game_ticks(8), 3);
          end
        end
        if (waypoint != 0) then begin
          if (tile_distance(tile_num(self_obj), dest_tile) > 3) then begin
            animate_move_obj_to_tile(self_obj, dest_tile, 0);
          end
          else begin
            if (waypoint == 1) then begin
              if (map_var(2) == 0) then begin
                dest_tile := 33519;
              end
              else begin
                dest_tile := 20076;
                waypoint := 2;
              end
            end
          end
        end
        if (sleeping_disabled == 0) then begin
          call sleeping;
        end
      end
      else begin
        if (cur_map_index == 12) then begin
          if ((global_var(555) != 2) and (sleeping_disabled == 0)) then begin
            call sleeping;
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    if (home_tile == 20082) then begin
      Skul_target := 0;
    end
    if ((cur_map_index == 11) and (map_var(2) == 1)) then begin
      set_map_var(0, map_var(0) - 1);
      set_global_var(626, 1);
    end
    if (cur_map_index == 12) then begin
      set_map_var(0, map_var(0) - 1);
      set_global_var(626, 1);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(390, 100));
  map_enter_p_proc: |
    if (not(local_var(5))) then begin
      set_local_var(5, tile_num(self_obj));
    end
    home_tile := local_var(5);
    if (cur_map_index == 10) then begin
      if (global_var(555) == 2) then begin
        set_obj_visibility(self_obj, 0);
      end
      else begin
        set_obj_visibility(self_obj, 1);
      end
    end
    if (cur_map_index != 11) then begin
      if (cur_map_index == 10) then begin
        if (global_var(555) == 2) then begin
          add_timer_event(self_obj, game_ticks(random(30, 60)), 1);
        end
      end
      else begin
        if (cur_map_index == 12) then begin
          add_timer_event(self_obj, game_ticks(random(30, 60)), 1);
        end
      end
    end
    else begin
      if ((global_var(282) == 1) and (map_var(2) == 0)) then begin
        destroy_object(self_obj);
      end
    end
    critter_add_trait(self_obj, 1, 6, 14);
    critter_add_trait(self_obj, 1, 5, 59);
    if (global_var(555) == 2) then begin
      if (cur_map_index == 10) then begin
        set_obj_visibility(self_obj, 0);
      end
      else begin
        destroy_object(self_obj);
      end
    end
    call set_sleep_tile;
    if ((home_tile == 20082) and (cur_map_index == 11)) then begin
      Skul_target := self_obj;
    end
  map_exit_p_proc: |
    if (cur_map_index == 11) then begin
      if ((global_var(282) == 1) and (map_var(2) == 0)) then begin
        destroy_object(self_obj);
      end
    end
  pickup_p_proc: |
    float_msg(self_obj, message_str(390, 101), 2);
    hostile := 1;
  talk_p_proc: |
    variable LVar0 := 0;
    if (cur_map_index == 10) then begin
      set_local_var(6, 104);
    end
    else begin
      if ((cur_map_index == 11) and (map_var(2) == 2)) then begin
        set_local_var(6, 112);
      end
      else begin
        if (local_var(6) == 0) then begin
          set_local_var(6, random(102, 105));
        end
      end
    end
    LVar0 := message_str(390, local_var(6));
    if (local_var(4) == 1) then begin
      LVar0 := message_str(390, 106);
    end
    float_msg(self_obj, LVar0, 0);
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if ((local_var(4) == 0) and (combat_is_initialized == 0)) then begin
        if (random(0, 1)) then begin
          float_msg(self_obj, message_str(390, random(107, 112)), 0);
        end
        else begin
          animate_move_obj_to_tile(self_obj, tile_num_in_direction(local_var(5), random(0, 3), random(0, 5)), 0);
        end
      end
      add_timer_event(self_obj, game_ticks(random(30, 60)), 1);
    end
    else begin
      if ((fixed_param == 2) and (Trish_ptr != 0) and (Neal_ptr != 0)) then begin
        float_msg(self_obj, message_str(387, 102), 2);
        rm_timer_event(Trish_ptr);
        rm_timer_event(Neal_ptr);
        reg_anim_func(2, self_obj);
        reg_anim_func(1, 1);
        reg_anim_obj_move_to_obj(self_obj, Trish_ptr, -1);
        reg_anim_animate(self_obj, 16, -1);
        reg_anim_animate(Trish_ptr, 20, 4);
        reg_anim_animate(Trish_ptr, 48, -1);
        reg_anim_animate(Trish_ptr, 37, -1);
        reg_anim_obj_run_to_tile(Trish_ptr, 19889, -1);
        reg_anim_func(3, 0);
        add_timer_event(Neal_ptr, game_ticks(3), 1);
      end
      else begin
        if (fixed_param == 3) then begin
          dest_tile := 26297;
          sleeping_disabled := 1;
        end
      end
    end
  set_sleep_tile: |
    if (cur_map_index == 12) then begin
      if (home_tile == 13502) then begin
        sleep_tile := 13093;
      end
      else begin
        if (home_tile == 13516) then begin
          sleep_tile := 13719;
        end
        else begin
          if (home_tile == 13717) then begin
            sleep_tile := 13721;
          end
        end
      end
      sleep_time := random(2200, 2215);
      wake_time := random(800, 815);
    end
    else begin
      if (cur_map_index == 11) then begin
        sleep_tile := 7000;
        sleep_time := 300;
        wake_time := 1600;
        night_person := 1;
      end
      else begin
        if (cur_map_index == 10) then begin
          sleep_tile := home_tile;
          sleep_time := 2200;
          wake_time := 1000;
        end
      end
    end
  sleeping: |
    if (local_var(4) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(4, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(4, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(4, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(4, 1);
          end
        end
      end
    end
gensupr:
  start: "[]"
  combat_p_proc: |
    if (fixed_param == 4) then begin
      round_count := round_count + 1;
    end
    if (round_count > 2) then begin
      call GenSuprAlert;
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      else begin
        if (global_var(146)) then begin
          hostile := 1;
        end
        else begin
          if (not(map_var(5))) then begin
            if (tile_distance_objs(self_obj, dude_obj) < 12) then begin
              dialogue_system_enter;
            end
          end
        end
      end
    end
    if (cur_map_index == 30) then begin
      if (map_var(0)) then begin
        if (not(waypoint)) then begin
          if (tile_num(self_obj) != 22312) then begin
            animate_move_obj_to_tile(self_obj, 22312, 0);
          end
          else begin
            waypoint := 1;
          end
        end
        else begin
          if (waypoint == 1) then begin
            if (tile_num(self_obj) != 31944) then begin
              animate_move_obj_to_tile(self_obj, 31944, 0);
            end
            else begin
              waypoint := 2;
            end
          end
          else begin
            if (waypoint == 2) then begin
              removal_ptr := self_obj;
            end
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (global_var(54)) then begin
      call GenSupr08;
    end
    else begin
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) and not(hostile)) then begin
        if (random(0, 5) == 5) then begin
          call GenSupr00;
        end
        else begin
          hostile := 1;
        end
      end
      else begin
        start_gdialog(433, self_obj, 4, -1, -1);
        gsay_start;
        call GenSupr03;
        gsay_end;
        end_dialogue;
      end
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 48);
      initialized := 1;
    end
  GenSupr00: |
    float_msg(self_obj, message_str(433, random(101, 103)), 2);
    hostile := 1;
  GenSupr03: |
    gsay_reply(433, random(104, 106));
    giq_option(-3, 433, 107, GenSupr04, 50);
    giq_option(4, 433, 108, GenSupr04, 50);
    giq_option(5, 433, 109, GenSupr05, 50);
    giq_option(6, 433, 110, GenSupr03a, 50);
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      giq_option(6, 433, 111, GenSupr03b, 50);
    end
  GenSupr03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call GenSupr07;
    end
    else begin
      call GenSupr06;
    end
  GenSupr03b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 25))) then begin
      call GenSupr07;
    end
    else begin
      call GenSupr06;
    end
  GenSupr04: |
    hostile := 1;
    gsay_message(433, random(112, 114), 51);
  GenSupr05: |
    gsay_reply(433, 115);
    giq_option(5, 433, 116, GenSuprxx, 50);
    giq_option(5, 433, 117, GenSuprAlert, 51);
  GenSupr06: |
    hostile := 1;
    gsay_message(433, random(118, 120), 51);
  GenSupr07: |
    set_map_var(5, 1);
    gsay_message(433, random(121, 123), 50);
  GenSupr08: |
    float_msg(self_obj, message_str(433, random(124, 127)), 2);
    hostile := 1;
  GenSuprAlert: |
    set_global_var(146, 1);
    hostile := 1;
  GenSuprxx: |
    set_global_var(57, 2);
    load_map(32, 5);
genvault:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(7) and (tile_distance_objs(self_obj, dude_obj) < 8)) then begin
        call flee_dude;
      end
      if (global_var(101) == 0) then begin
        if (local_var(5) == 0) then begin
          if ((elevation(self_obj) == elevation(WtrGrd_ptr)) and (elevation(self_obj) == elevation(dude_obj))) then begin
            if ((game_time_hour > 700) and (game_time_hour < 900)) then begin
              call get_rations;
            end
          end
        end
      end
      if (not((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
        sleeping_disabled := 0;
        set_local_var(5, 0);
      end
      if (sleeping_disabled == 0) then begin
        call sleeping;
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(7, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    if (source_obj == dude_obj) then begin
      set_global_var(261, 1);
    end
  map_enter_p_proc: |
    if (local_var(4) == 0) then begin
      set_local_var(4, tile_num(self_obj));
    end
    home_tile := local_var(4);
    critter_add_trait(self_obj, 1, 6, 1);
    call set_ration_tile;
    call set_sleep_tile;
    sleep_time := random(1900, 1930);
    wake_time := sleep_time - 1300;
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    call get_reaction;
    if (local_var(6)) then begin
      if (random(0, 1)) then begin
        float_msg(self_obj, message_str(185, 166), 0);
      end
      else begin
        display_msg(message_str(185, 167));
      end
    end
    else begin
      if (local_var(7) or global_var(261)) then begin
        call Vault00;
      end
      else begin
        if ((global_var(101) != 0) and (global_var(101) != 1)) then begin
          call Vault01;
        end
        else begin
          if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
            call Vault02;
          end
          else begin
            if (global_var(10) < 80) then begin
              call Vault00b;
            end
            else begin
              if (global_var(10) < 40) then begin
                call Vault00c;
              end
              else begin
                call Vault00a;
              end
            end
          end
        end
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(WtrGrd_ptr), 2, 1), 0);
      add_timer_event(self_obj, game_ticks(3), 2);
    end
    else begin
      if (fixed_param == 2) then begin
        getting_ration := 1;
        if (random(0, 1)) then begin
          float_msg(self_obj, message_str(185, 165), 0);
        end
        add_timer_event(self_obj, game_ticks(3), 3);
      end
      else begin
        if (fixed_param == 3) then begin
          recipient := 0;
          animate_move_obj_to_tile(self_obj, home_tile, 0);
        end
      end
    end
  Vault00: 'float_msg(self_obj, message_str(185, random(101, 104)), 0);

    '
  Vault00a: |
    if (local_var(1) == 3) then begin
      call Vault03;
    end
    else begin
      if (local_var(1) == 2) then begin
        call Vault06;
      end
      else begin
        call Vault09;
      end
    end
  Vault00b: |
    if (local_var(1) == 3) then begin
      call Vault04;
    end
    else begin
      if (local_var(1) == 2) then begin
        call Vault07;
      end
      else begin
        call Vault10;
      end
    end
  Vault00c: |
    if (local_var(1) == 3) then begin
      call Vault05;
    end
    else begin
      if (local_var(1) == 2) then begin
        call Vault08;
      end
      else begin
        call Vault11;
      end
    end
  Vault01: |
    PICK := random(1, 5);
    if (PICK == 1) then begin
      float_msg(self_obj, message_str(185, 109), 0);
    end
    else begin
      if (PICK == 2) then begin
        float_msg(self_obj, message_str(185, 110), 0);
      end
      else begin
        if (PICK == 3) then begin
          float_msg(self_obj, message_str(185, 111), 0);
        end
        else begin
          if (PICK == 4) then begin
            if (get_critter_stat(dude_obj, 34) == 0) then begin
              float_msg(self_obj, message_str(185, 112), 0);
            end
            else begin
              float_msg(self_obj, message_str(185, 113), 0);
            end
          end
          else begin
            if (PICK == 5) then begin
              if (get_critter_stat(dude_obj, 34) == 0) then begin
                float_msg(self_obj, message_str(185, 114), 0);
              end
              else begin
                float_msg(self_obj, message_str(185, 115), 0);
              end
            end
          end
        end
      end
    end
  Vault02: |
    call DownReact;
    float_msg(self_obj, message_str(185, random(116, 119)), 0);
  Vault03: |
    PICK := random(1, 4);
    if (PICK == 1) then begin
      float_msg(self_obj, message_str(185, 120), 0);
    end
    else begin
      if (PICK == 2) then begin
        float_msg(self_obj, message_str(185, 121), 0);
      end
      else begin
        if (PICK == 3) then begin
          float_msg(self_obj, message_str(185, 122), 0);
        end
        else begin
          if (PICK == 4) then begin
            float_msg(self_obj, message_str(185, 123) + proto_data(obj_pid(dude_obj), 1) + message_str(185, 124), 0);
          end
        end
      end
    end
  Vault04: 'float_msg(self_obj, message_str(185, random(125, 128)), 0);

    '
  Vault05: 'float_msg(self_obj, message_str(185, random(129, 133)), 0);

    '
  Vault06: |
    PICK := random(1, 5);
    if (PICK == 1) then begin
      float_msg(self_obj, message_str(185, 134), 0);
    end
    else begin
      if (PICK == 2) then begin
        float_msg(self_obj, message_str(185, 135) + proto_data(obj_pid(dude_obj), 1) + message_str(185, 136), 0);
      end
      else begin
        if (PICK == 3) then begin
          float_msg(self_obj, message_str(185, 137), 0);
        end
        else begin
          if (PICK == 4) then begin
            float_msg(self_obj, message_str(185, 138), 0);
          end
          else begin
            if (PICK == 5) then begin
              float_msg(self_obj, message_str(185, 139), 0);
            end
          end
        end
      end
    end
  Vault07: 'float_msg(self_obj, message_str(185, random(140, 144)), 0);

    '
  Vault08: 'float_msg(self_obj, message_str(185, random(145, 149)), 0);

    '
  Vault09: |
    PICK := random(1, 5);
    if (PICK == 1) then begin
      float_msg(self_obj, message_str(185, 150) + proto_data(obj_pid(dude_obj), 1) + message_str(185, 151), 0);
    end
    else begin
      if (PICK >= 4) then begin
        display_msg(message_str(185, 150 + PICK));
      end
      else begin
        float_msg(self_obj, message_str(185, 150 + PICK), 0);
      end
    end
  Vault10: |
    PICK := random(1, 5);
    if (PICK == 5) then begin
      display_msg(message_str(185, 160));
    end
    else begin
      float_msg(self_obj, message_str(185, 155 + PICK), 0);
    end
  Vault11: |
    PICK := random(1, 5);
    if (PICK == 1) then begin
      float_msg(self_obj, message_str(185, 161), 0);
    end
    else begin
      if (PICK == 2) then begin
        float_msg(self_obj, message_str(185, 162), 0);
      end
      else begin
        if (PICK == 3) then begin
          display_msg(message_str(185, 163));
        end
        else begin
          if (PICK == 4) then begin
            display_msg(message_str(185, 164));
          end
        end
      end
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
  get_rations: |
    sleeping_disabled := 1;
    if (tile_num(self_obj) != ration_tile) then begin
      if (random(0, 1)) then begin
        animate_move_obj_to_tile(self_obj, ration_tile, 0);
      end
      else begin
        animate_move_obj_to_tile(self_obj, ration_tile, 1);
      end
    end
    else begin
      if (not(recipient)) then begin
        recipient := self_obj;
        add_timer_event(self_obj, game_ticks(3), 1);
        set_local_var(5, 1);
        sleeping_disabled := 0;
      end
    end
  set_ration_tile: |
    if (elevation(self_obj) == 0) then begin
      ration_tile := tile_num_in_direction(14704, random(0, 5), random(1, 2));
    end
    else begin
      if (elevation(self_obj) == 1) then begin
        ration_tile := tile_num_in_direction(21895, random(0, 5), random(1, 2));
      end
      else begin
        if (elevation(self_obj) == 2) then begin
          ration_tile := tile_num_in_direction(22513, random(0, 5), random(1, 2));
        end
      end
    end
  set_sleep_tile: |
    if (elevation(self_obj) == 0) then begin
      sleep_tile := 7000;
    end
    else begin
      if (elevation(self_obj) == 1) then begin
        sleep_tile := home_tile;
      end
      else begin
        if (elevation(self_obj) == 2) then begin
          sleep_tile := 7000;
        end
      end
    end
  sleeping: |
    if (local_var(6) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(6, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(6, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(6, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(6, 1);
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
ghdorgrd:
  start: |
    if (not(init)) then begin
      if (local_var(7) == 0) then begin
        set_local_var(7, tile_num(self_obj));
        set_local_var(5, 0);
      end
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 40);
      init := 1;
    end
    else begin
      if (script_action == 11) then begin
        if (global_var(249)) then begin
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
        else begin
          call do_dialogue;
        end
      end
      else begin
        if (script_action == 21) then begin
          script_overrides;
          display_msg(message_str(70, 100));
        end
        else begin
          if (script_action == 4) then begin
            Hostile := 1;
          end
          else begin
            if (script_action == 12) then begin
              if (obj_can_see_obj(self_obj, dude_obj) and global_var(249)) then begin
                Hostile := 1;
              end
              call Critter_Action;
            end
            else begin
              if (script_action == 18) then begin
                if (source_obj == dude_obj) then begin
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                    set_global_var(156, 1);
                    set_global_var(157, 0);
                  end
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                    set_global_var(157, 1);
                    set_global_var(156, 0);
                  end
                  set_global_var(160, global_var(160) + 1);
                  if ((global_var(160) % 6) == 0) then begin
                    set_global_var(155, global_var(155) + 1);
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    start_gdialog(70, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4)) then begin
      call ghoul02;
    end
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      if (local_var(1) >= 3) then begin
        call ghoul00b;
      end
      else begin
        set_local_var(4, 1);
        call ghoul03;
      end
    end
    else begin
      if (local_var(1) >= 3) then begin
        call ghoul01;
      end
      else begin
        set_local_var(4, 1);
        call ghoul03;
      end
    end
    gsay_end;
    end_dialogue;
  ghoulend: "[]"
  ghoulcbt: 'Hostile := 1;

    '
  ghoul00a: |
    gsay_reply(70, 111);
    giq_option(4, 70, 102, ghoulend, 50);
    giq_option(-3, 70, 103, ghoulend, 50);
  ghoul00b: |
    gsay_message(70, 104, 50);
    call ghoulend;
  ghoul01: |
    gsay_reply(70, 105);
    giq_option(4, 70, 106, ghoulend, 50);
    giq_option(-3, 70, 107, ghoulend, 50);
  ghoul02: |
    gsay_reply(70, 108);
    giq_option(4, 70, 109, ghoulend, 50);
    giq_option(-3, 70, 110, ghoulend, 50);
  ghoul03: |
    gsay_reply(70, 101);
    giq_option(5, 70, 112, ghoul03a, 50);
    giq_option(4, 70, 113, ghoulend, 50);
    giq_option(-3, 70, 114, ghoulend, 50);
  ghoul03a: 'call ghoul02;

    '
  ghoul05: 'gsay_message(70, 116, 50);

    '
  Critter_Action: |
    if (Hostile > 0) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(5)) then begin
        loopcount := loopcount + 1;
        if (loopcount > 40) then begin
          loopcount := 0;
          if (noevent == 0) then begin
            noevent := 1;
            add_timer_event(self_obj, game_ticks(random(5, 13)), 0);
          end
        end
      end
    end
  timetomove: |
    noevent := 0;
    set_local_var(6, tile_num(self_obj));
    new_tile := tile_num_in_direction(local_var(6), random(0, 5), 2);
    if (tile_distance(local_var(7), new_tile) < maxleash) then begin
      animate_move_obj_to_tile(self_obj, new_tile, 0);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
ghgended:
  start: |
    variable LVar0 := 0;
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      call do_stuff;
    end
  do_stuff: |
    rndx := random(1, 5);
    if (rndx == 1) then begin
      display_msg(message_str(71, 100));
    end
    if (rndx == 2) then begin
      display_msg(message_str(71, 101));
    end
    if (rndx == 3) then begin
      display_msg(message_str(71, 102));
    end
    if (rndx == 4) then begin
      display_msg(message_str(71, 103));
    end
    if (rndx == 5) then begin
      display_msg(message_str(71, 104));
    end
ghguard:
  start: |
    if (not(init)) then begin
      if (local_var(7) == 0) then begin
        set_local_var(7, tile_num(self_obj));
        set_local_var(5, 0);
      end
      critter_add_trait(self_obj, 1, 6, 30);
      init := 1;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(72, 100));
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            call Critter_Action;
          end
          else begin
            if (script_action == 18) then begin
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(160, global_var(160) + 1);
                if ((global_var(160) % 6) == 0) then begin
                  set_global_var(155, global_var(155) + 1);
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    start_gdialog(72, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4)) then begin
      call ghoul06;
    end
    else begin
      if (local_var(1) >= 2) then begin
        set_local_var(4, 1);
        call ghoul01;
      end
      else begin
        set_local_var(4, 1);
        call ghoul00;
      end
    end
    gsay_end;
    end_dialogue;
  ghoulend: "[]"
  ghoulcbt: 'Hostile := 1;

    '
  ghoul00: |
    gsay_message(72, 101, 50);
    call ghoulcbt;
  ghoul01: |
    gsay_reply(72, 102);
    giq_option(6, 72, 103, ghoul01a, 50);
    giq_option(3, 72, 104, ghoulend, 50);
    giq_option(-3, 72, 105, ghoul00, 50);
  ghoul01a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call ghoul02;
    end
    else begin
      call ghoul03;
    end
  ghoul02: |
    gsay_reply(72, 106);
    giq_option(3, 72, 107, ghoulcbt, 50);
    giq_option(5, 72, 108, ghoulend, 50);
  ghoul03: |
    gsay_reply(72, 109);
    giq_option(3, 72, 110, ghoul03a, 50);
    giq_option(3, 72, 111, ghoul04, 50);
  ghoul03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call ghoul05;
    end
    else begin
      call ghoul04;
    end
  ghoul04: |
    gsay_message(72, 112, 50);
    call ghoulend;
  ghoul05: |
    gsay_reply(72, 113);
    giq_option(4, 72, 114, ghoulend, 50);
  ghoul06: |
    gsay_message(72, 115, 50);
    call ghoulend;
  Critter_Action: |
    if (Hostile > 0) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(5)) then begin
        loopcount := loopcount + 1;
        if (loopcount > 40) then begin
          loopcount := 0;
          if (noevent == 0) then begin
            noevent := 1;
            add_timer_event(self_obj, game_ticks(random(5, 13)), 0);
          end
        end
      end
    end
  timetomove: |
    noevent := 0;
    set_local_var(6, tile_num(self_obj));
    new_tile := tile_num_in_direction(local_var(6), random(0, 5), 2);
    if (tile_distance(local_var(7), new_tile) < maxleash) then begin
      animate_move_obj_to_tile(self_obj, new_tile, 0);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
ghkick:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 78);
      initialized := 1;
    end
    if (script_action == 22) then begin
      Hostile := 1;
    end
    else begin
      if (script_action == 11) then begin
        if (local_var(0) == 0) then begin
          set_local_var(0, 1);
          call do_dialogue;
        end
      end
      else begin
        if ((script_action == 21) or (script_action == 3)) then begin
          script_overrides;
          display_msg(message_str(231, 100));
        end
        else begin
          if (script_action == 4) then begin
            Hostile := 1;
          end
          else begin
            if (script_action == 12) then begin
              if (Hostile) then begin
                Hostile := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
            end
            else begin
              if (script_action == 18) then begin
                if (source_obj == dude_obj) then begin
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                    set_global_var(156, 1);
                    set_global_var(157, 0);
                  end
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                    set_global_var(157, 1);
                    set_global_var(156, 0);
                  end
                  set_global_var(160, global_var(160) + 1);
                  if ((global_var(160) % 6) == 0) then begin
                    set_global_var(155, global_var(155) + 1);
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    float_msg(self_obj, message_str(231, 101), 0);
    add_timer_event(self_obj, game_ticks(5), 1);
ghoul:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 78);
      initialized := 1;
    end
    else begin
      if (script_action == 22) then begin
        call timeforwhat;
      end
      else begin
        if (script_action == 11) then begin
          call pre_dialogue;
        end
        else begin
          if (script_action == 4) then begin
            Hostile := 1;
          end
          else begin
            if (script_action == 12) then begin
              if (Hostile) then begin
                Hostile := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
              else begin
                if ((game_time_hour >= 1900) or (game_time_hour < 600) and (tile_num(self_obj) != 22531)) then begin
                  animate_move_obj_to_tile(self_obj, 22531, 0);
                end
                if ((game_time_hour >= 700) and (game_time_hour < 1800) and (tile_num(self_obj) != 24730)) then begin
                  animate_move_obj_to_tile(self_obj, 24730, 0);
                end
                loopcount := loopcount + 1;
                if (loopcount > 40) then begin
                  loopcount := 0;
                  if (tile_distance_objs(self_obj, dude_obj) < 7) then begin
                    if (obj_can_see_obj(self_obj, dude_obj)) then begin
                      if (noevent == 0) then begin
                        noevent := 1;
                        add_timer_event(self_obj, game_ticks(5), 0);
                      end
                    end
                  end
                end
              end
            end
            else begin
              if ((script_action == 21) or (script_action == 3)) then begin
                script_overrides;
                display_msg(message_str(30, 100));
              end
              else begin
                if (script_action == 18) then begin
                  if (source_obj == dude_obj) then begin
                    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                      set_global_var(156, 1);
                      set_global_var(157, 0);
                    end
                    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                      set_global_var(157, 1);
                      set_global_var(156, 0);
                    end
                    set_global_var(160, global_var(160) + 1);
                    if ((global_var(160) % 6) == 0) then begin
                      set_global_var(155, global_var(155) + 1);
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  timeforwhat: |
    if (fixed_param == 1) then begin
      Hostile := 1;
    end
    else begin
      if (local_var(0) == 0) then begin
        dialogue_system_enter;
      end
    end
  do_dialogue: |
    start_gdialog(30, self_obj, 4, -1, -1);
    gsay_start;
    set_local_var(0, 1);
    call ghoul00;
    gsay_end;
    end_dialogue;
  pre_dialogue: |
    if (local_var(0)) then begin
      call ghoul08;
    end
    else begin
      call do_dialogue;
    end
  ghoulend: "[]"
  ghoulcbt: 'add_timer_event(self_obj, game_ticks(2), 1);

    '
  ghoul00: |
    gsay_reply(30, 101);
    giq_option(6, 30, 102, ghoul01, 50);
    giq_option(4, 30, 103, ghoul04, 50);
    giq_option(4, 30, 104, ghoul05, 50);
    giq_option(-3, 30, 105, ghoulend, 50);
  ghoul01: |
    gsay_reply(30, 106);
    giq_option(6, 30, 107, ghoul02, 50);
    giq_option(6, 30, 108, ghoul03, 50);
  ghoul02: |
    gsay_message(30, 109, 50);
    call ghoulend;
  ghoul03: |
    gsay_message(30, 110, 50);
    call ghoulend;
  ghoul04: |
    gsay_message(30, 111, 50);
    call ghoulend;
  ghoul05: |
    gsay_reply(30, 112);
    giq_option(4, 30, 113, ghoul07, 50);
    giq_option(4, 30, 114, ghoul05a, 50);
    call ghoulend;
  ghoul05a: |
    if (is_success(do_check(dude_obj, 14, 0))) then begin
      call ghoul06;
    end
    else begin
      call ghoul07;
    end
  ghoul06: |
    gsay_message(30, 115, 50);
    call ghoulend;
  ghoul07: |
    gsay_message(30, 116, 50);
    call ghoulcbt;
  ghoul08: |
    float_msg(self_obj, message_str(30, 117), 7);
    call ghoulend;
ghrefuge:
  start: |
    if (not(init)) then begin
      if (local_var(7) == 0) then begin
        set_local_var(7, tile_num(self_obj));
        set_local_var(5, 0);
      end
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 40);
      init := 1;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(74, 100));
      end
      else begin
        if (script_action == 4) then begin
          call pickup_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call Critter_Action;
          end
          else begin
            if (script_action == 18) then begin
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(159, global_var(159) + 1);
                if ((global_var(159) % 2) == 0) then begin
                  set_global_var(155, global_var(155) - 1);
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    start_gdialog(74, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4)) then begin
      if (local_var(1) >= 2) then begin
        call ghoul14;
      end
      else begin
        call ghoul03;
      end
    end
    else begin
      if (local_var(1) >= 2) then begin
        set_local_var(4, 1);
        call ghoul00;
      end
      else begin
        set_local_var(4, 1);
        call ghoul03;
      end
    end
    gsay_end;
    end_dialogue;
  ghoulend: "[]"
  ghoulcbt: 'Hostile := 1;

    '
  ghoul00: |
    gsay_reply(74, 101);
    giq_option(4, 74, 102, ghoul00a, 50);
    giq_option(4, 74, 103, ghoulend, 50);
    giq_option(5, 74, 104, ghoul05, 50);
    giq_option(-3, 74, 105, ghoul01, 50);
  ghoul00a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call ghoul02;
    end
    else begin
      call ghoul01;
    end
  ghoul01: |
    gsay_message(74, 106, 50);
    call ghoulcbt;
  ghoul02: |
    gsay_reply(74, 107);
    giq_option(4, 74, 108, ghoulend, 50);
    giq_option(4, 74, 109, ghoul04, 50);
  ghoul03: |
    gsay_message(74, 110, 50);
    call ghoulcbt;
  ghoul04: |
    gsay_reply(74, 111);
    giq_option(4, 74, 112, ghoulcbt, 50);
    giq_option(4, 74, 113, ghoul05, 50);
  ghoul05: |
    if (local_var(1) < 2) then begin
      gsay_reply(74, 114);
    end
    else begin
      gsay_reply(74, 115);
    end
    giq_option(4, 74, 116, ghoul12, 50);
    giq_option(4, 74, 117, ghoul11, 50);
    giq_option(6, 74, 118, ghoul05a, 50);
  ghoul05a: |
    if (HENRY == 0) then begin
      call ghoul07;
    end
    else begin
      call ghoul06;
    end
  ghoul06: |
    gsay_reply(74, 119);
    giq_option(4, 74, 120, ghoulend, 50);
    giq_option(4, 74, 121, ghoul03, 50);
  ghoul07: |
    gsay_reply(74, 122);
    giq_option(4, 74, 123, ghoul07a, 50);
    giq_option(4, 74, 124, ghoulend, 50);
  ghoul07a: |
    if (local_var(1) < 2) then begin
      call ghoul08;
    end
    else begin
      call ghoul09;
    end
  ghoul08: |
    gsay_reply(74, 125);
    giq_option(4, 74, 126, ghoulend, 50);
    giq_option(4, 74, 127, ghoul03, 50);
  ghoul09: |
    gsay_reply(74, 128);
    giq_option(4, 74, 129, ghoulend, 50);
    giq_option(4, 74, 130, ghoul09a, 50);
  ghoul09a: |
    call DownReact;
    if (local_var(1) < 2) then begin
      call ghoul03;
    end
    else begin
      call ghoul10;
    end
  ghoul10: |
    gsay_reply(74, 131);
    giq_option(4, 74, 132, ghoulend, 50);
  ghoul11: |
    gsay_reply(74, 133);
    giq_option(4, 74, 134, ghoul05a, 50);
  ghoul12: |
    gsay_reply(74, 135);
    giq_option(4, 74, 136, ghoul05a, 50);
    giq_option(4, 74, 137, ghoul13, 50);
  ghoul13: |
    gsay_reply(74, 138);
    giq_option(4, 74, 139, ghoulcbt, 50);
    giq_option(4, 74, 140, ghoulend, 50);
  ghoul14: |
    gsay_reply(74, 141);
    giq_option(4, 74, 142, ghoul15, 50);
    giq_option(4, 74, 143, ghoul16, 50);
    giq_option(-3, 74, 105, ghoul01, 50);
  ghoul15: |
    gsay_reply(74, 144);
    giq_option(4, 74, 145, ghoulend, 50);
  ghoul16: 'gsay_message(74, 146, 50);

    '
  Critter_Action: |
    if (Hostile > 0) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(5)) then begin
        loopcount := loopcount + 1;
        if (loopcount > 40) then begin
          loopcount := 0;
          if (noevent == 0) then begin
            noevent := 1;
            add_timer_event(self_obj, game_ticks(random(5, 13)), 0);
          end
        end
      end
    end
  timetomove: |
    noevent := 0;
    set_local_var(6, tile_num(self_obj));
    new_tile := tile_num_in_direction(local_var(6), random(0, 5), 2);
    if (tile_distance(local_var(7), new_tile) < maxleash) then begin
      animate_move_obj_to_tile(self_obj, new_tile, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      Hostile := 1;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
ghrndgrd:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 41);
      initialized := 1;
    end
    if (script_action == 11) then begin
      if (global_var(249)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      else begin
        call do_dialogue;
      end
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(230, 100));
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            if (obj_can_see_obj(self_obj, dude_obj) and global_var(249)) then begin
              Hostile := 1;
            end
            if (Hostile) then begin
              Hostile := 0;
              attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
            end
          end
          else begin
            if (script_action == 18) then begin
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(160, global_var(160) + 1);
                if ((global_var(160) % 6) == 0) then begin
                  set_global_var(155, global_var(155) + 1);
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    rndx := random(1, 3);
    if (rndx == 1) then begin
      float_msg(self_obj, message_str(230, 101), 3);
    end
    if (rndx == 2) then begin
      float_msg(self_obj, message_str(230, 102), 3);
    end
    if (rndx == 3) then begin
      float_msg(self_obj, message_str(230, 103), 3);
    end
ghzero:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 42);
      init_teams := 1;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(75, 100));
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            if (Hostile) then begin
              Hostile := 0;
              attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
            end
          end
          else begin
            if (script_action == 18) then begin
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(160, global_var(160) + 1);
                if ((global_var(160) % 6) == 0) then begin
                  set_global_var(155, global_var(155) + 1);
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    start_gdialog(75, self_obj, 4, -1, -1);
    gsay_start;
    call ghoul00;
    gsay_end;
    end_dialogue;
  ghoulend: "[]"
  ghoulcbt: 'Hostile := 1;

    '
  ghoul00: |
    gsay_message(75, 101, 50);
    call ghoulend;
gideon:
  start: |
    if (GVar1) then begin
      critter_add_trait(self_obj, 1, 6, 50);
      critter_add_trait(self_obj, 1, 5, 67);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == combat_p_proc) then begin
        call combat_p_proc;
      end
      else begin
        if (script_action == 4) then begin
          call pickup_p_proc;
        end
        else begin
          if (script_action == 11) then begin
            call talk_p_proc;
          end
          else begin
            if (script_action == 22) then begin
              animate_move_obj_to_tile(self_obj, 15319, 0);
            end
            else begin
              if (script_action == 12) then begin
                call critter_p_proc;
              end
              else begin
                if (script_action == 18) then begin
                  call destroy_p_proc;
                end
              end
            end
          end
        end
      end
    end
  combat: |
    use_obj(contpan);
    GVar0 := 1;
  critter_p_proc: |
    if (GVar0) then begin
      GVar0 := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      GVar0 := 1;
    end
  talk_p_proc: |
    start_gdialog(671, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4) == 0) then begin
      call gideon00;
    end
    else begin
      call gideon01;
    end
    set_local_var(4, 1);
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(671, 100));
  combat_p_proc: "[]"
  gideon00: |
    gsay_reply(671, 101);
    giq_option(8, 671, 102, gideon03, 49 + random(0, 2));
    giq_option(4, 671, 103, gideon02, 49 + random(0, 2));
    giq_option(4, 671, 104, gideon07, 49 + random(0, 2));
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 671, 105, gideon07, 49 + random(0, 2));
    end
    giq_option(-3, 671, 106, gideon08, 49 + random(0, 2));
  gideon01: |
    gsay_reply(671, 107);
    giq_option(8, 671, 108, gideon04, 49 + random(0, 2));
    giq_option(4, 671, 109, dialog_end, 49 + random(0, 2));
    giq_option(4, 671, 112, gideon01a, 49 + random(0, 2));
  gideon01a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call gideon03;
    end
    else begin
      call gideon08;
    end
  gideon02: |
    gsay_reply(671, 113);
    giq_option(4, 671, 114, dialog_end, 49 + random(0, 2));
    giq_option(4, 671, 112, gideon02a, 49 + random(0, 2));
    giq_option(-3, 671, 115, gideon08, 49 + random(0, 2));
  gideon02a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call gideon09;
    end
    else begin
      call gideon08;
    end
  gideon03: |
    gsay_reply(671, 116);
    giq_option(8, 671, 108, gideon04, 49 + random(0, 2));
    giq_option(4, 671, 117, gideon04, 49 + random(0, 2));
    giq_option(4, 671, 118, dialog_end, 49 + random(0, 2));
  gideon04: |
    gsay_reply(671, 119);
    giq_option(8, 671, 120, gideon05, 49 + random(0, 2));
    giq_option(4, 671, 121, gideon04a, 49 + random(0, 2));
    giq_option(4, 671, 122, gideon04b, 49 + random(0, 2));
    giq_option(4, 671, 124, dialog_end, 49 + random(0, 2));
  gideon04a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call gideon05;
    end
    else begin
      call gideon08;
    end
  gideon04b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call gideon03;
    end
    else begin
      call gideon11;
    end
  gideon04c: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call gideon07;
    end
    else begin
      call gideon08;
    end
  gideon05: |
    gsay_reply(671, 125);
    giq_option(8, 671, 126, gideon06, 49 + random(0, 2));
    giq_option(4, 671, 127, gideon05a, 49 + random(0, 2));
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 671, 128, gideon05b, 49 + random(0, 2));
    end
    giq_option(4, 671, 129, dialog_end, 49 + random(0, 2));
  gideon05a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call gideon07;
    end
    else begin
      call gideon11;
    end
  gideon05b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call gideon10;
    end
    else begin
      call gideon06;
    end
  gideon06: |
    gsay_reply(671, 130);
    giq_option(8, 671, 131, gideonnull, 49 + random(0, 2));
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 671, 132, combat, 49 + random(0, 2));
    end
    giq_option(4, 671, 133, gideon06a, 49 + random(0, 2));
    giq_option(4, 671, 134, dialog_end, 49 + random(0, 2));
  gideon06a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call gideonnull;
    end
    else begin
      call gideon08;
    end
  gideon07: |
    gsay_reply(671, 135);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 671, 136, gideon07b, 49 + random(0, 2));
    end
    giq_option(4, 671, 137, gideon07c, 49 + random(0, 2));
    giq_option(4, 671, 138, dialog_end, 49 + random(0, 2));
  gideon07a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call gideon10;
    end
    else begin
      call gideon08;
    end
  gideon07b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call gideon10;
    end
    else begin
      call gideon11;
    end
  gideon07c: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call gideon06;
    end
    else begin
      call gideon10;
    end
  gideon08: |
    gsay_message(671, 139, 49 + random(0, 2));
    call dialog_end;
  gideon09: |
    gsay_reply(671, 107);
    giq_option(4, 671, 141, gideon09a, 49 + random(0, 2));
    giq_option(4, 671, 127, gideon09b, 49 + random(0, 2));
    giq_option(4, 671, 124, dialog_end, 49 + random(0, 2));
  gideon09a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call gideon04;
    end
    else begin
      call gideon08;
    end
  gideon09b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call gideon07;
    end
    else begin
      call gideon11;
    end
  gideon09c: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call gideon10;
    end
    else begin
      call gideon08;
    end
  gideon10: |
    gsay_message(671, 143, 49 + random(0, 2));
    call combat;
  gideon11: |
    gsay_message(671, 144, 49 + random(0, 2));
    call dialog_end;
  gideon12: |
    gsay_reply(671, 145);
    giq_option(8, 671, 146, gideon06, 49 + random(0, 2));
    giq_option(4, 671, 147, gideon12a, 49 + random(0, 2));
    giq_option(4, 671, 148, gideon13, 49 + random(0, 2));
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 671, 136, gideon12a, 49 + random(0, 2));
    end
    giq_option(4, 671, 150, dialog_end, 49 + random(0, 2));
  gideon12a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call gideon13;
    end
    else begin
      call gideon07;
    end
  gideon12b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call gideon10;
    end
    else begin
      call gideon08;
    end
  gideon13: |
    gsay_reply(671, 130);
    giq_option(8, 671, 131, gideonnull, 49 + random(0, 2));
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 671, 132, combat, 49 + random(0, 2));
    end
    giq_option(4, 671, 133, gideon13a, 49 + random(0, 2));
    giq_option(4, 671, 151, gideon07, 49 + random(0, 2));
    giq_option(4, 671, 134, dialog_end, 49 + random(0, 2));
  gideon13a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call gideonnull;
    end
    else begin
      call gideon08;
    end
  gideonnull: |
    if (local_var(5) == 0) then begin
      set_local_var(5, 1);
      use_obj(contpan);
      use_obj(dude_obj);
      add_obj_to_inven(dude_obj, create_object_sid(123, 0, 0, -1));
      GVar2 := 1000;
      display_msg(message_str(671, 501) + GVar2 + message_str(671, 502));
      give_exp_points(GVar2);
      add_timer_event(self_obj, game_ticks(10), 1);
    end
  dialog_end: "[]"
gizguard:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    else begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        if (tile_distance_objs(self_obj, dude_obj) < 12) then begin
          if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) and not(weapon_checked)) then begin
            dialogue_system_enter;
          end
          else begin
            if (using_skill(dude_obj, 8) and not(sneak_checked)) then begin
              dialogue_system_enter;
            end
          end
        end
      end
    end
    if (global_var(347) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  destroy_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_carrying_pid_obj(self_obj, 1);
    if (LVar0) then begin
      rm_obj_from_inven(self_obj, LVar0);
      destroy_object(LVar0);
    end
    if (source_obj == dude_obj) then begin
      set_global_var(347, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  map_enter_p_proc: |
    if (not(metarule(22, 0)) and not(obj_is_carrying_obj_pid(self_obj, 41))) then begin
      item_caps_adjust(self_obj, random(0, 10));
    end
    critter_add_trait(self_obj, 1, 6, 13);
    if ((global_var(32) == 4) and (metarule(22, 0) == 0)) then begin
      set_obj_visibility(self_obj, 1);
      move_to(self_obj, 7000, 0);
      removal_ptr := self_obj;
    end
    else begin
      if ((global_var(38) == 1) or (global_var(104) == 2)) then begin
        set_obj_visibility(self_obj, 1);
        move_to(self_obj, 7000, 0);
        removal_ptr := self_obj;
      end
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      call GizGuard00;
    end
    else begin
      if (using_skill(dude_obj, 8)) then begin
        call GizGuard01;
      end
      else begin
        if (not(local_var(0))) then begin
          start_gdialog(639, self_obj, 4, -1, -1);
          gsay_start;
          call GizGuard02;
          gsay_end;
          end_dialogue;
        end
        else begin
          call GizGuard07;
        end
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
        float_msg(self_obj, message_str(639, random(100, 103)), 2);
        hostile := 1;
      end
      else begin
        weapon_checked := 0;
      end
    end
    else begin
      if (fixed_param == 2) then begin
        if (using_skill(dude_obj, 8)) then begin
          hostile := 1;
        end
        else begin
          sneak_checked := 0;
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(347, 1);
    end
  GizGuard00: |
    float_msg(self_obj, message_str(639, random(132, 133)), 2);
    weapon_checked := 1;
    add_timer_event(self_obj, game_ticks(5), 1);
  GizGuard01: |
    float_msg(self_obj, message_str(639, random(104, 106)), 2);
    sneak_checked := 1;
    add_timer_event(self_obj, game_ticks(5), 2);
  GizGuard02: |
    set_local_var(0, 1);
    gsay_reply(639, 107);
    giq_option(4, 639, 108, GizGuard03, 50);
    giq_option(4, 639, 109, GizGuard04, 50);
    giq_option(4, 639, 110, GizGuardEnd, 50);
    giq_option(-3, 639, 111, GizGuard08, 51);
  GizGuard03: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      gsay_reply(639, 112);
      giq_option(4, 639, 114, GizGuard05, 50);
      giq_option(4, 639, 115, GizGuard06, 50);
    end
    else begin
      gsay_message(639, 113, 51);
    end
  GizGuard04: 'gsay_message(639, random(116, 119), 50);

    '
  GizGuard05: 'gsay_message(639, 120, 50);

    '
  GizGuard06: 'gsay_message(639, random(121, 124), 50);

    '
  GizGuard07: 'float_msg(self_obj, message_str(639, random(125, 130)), 0);

    '
  GizGuard08: 'gsay_message(639, 131, 50);

    '
  GizGuardEnd: "[]"
gizmo:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  critter_p_proc: |
    if (HOSTILE) then begin
      HOSTILE := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (Killian_ptr != 0) then begin
        float_msg(self_obj, message_str(44, 220), 0);
        attack_complex(Killian_ptr, 0, 1, 0, 0, 30000, 0, 0);
      end
      else begin
        if (obj_is_carrying_obj_pid(self_obj, 57)) then begin
          set_global_var(41, 1);
        end
      end
    end
    if (global_var(347) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(44, 218));
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(347, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    set_global_var(38, 1);
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(44, 100));
  map_enter_p_proc: |
    variable LVar0 := 0;
    Gizmo_ptr := self_obj;
    if (local_var(7) == 0) then begin
      set_local_var(7, 1000);
    end
    if (local_var(9) == 1) then begin
      payment := local_var(7);
    end
    critter_add_trait(self_obj, 1, 6, 13);
    critter_add_trait(self_obj, 1, 5, 60);
    if (global_var(104) == 2) then begin
      LVar0 := create_object_sid(213, tile_num(self_obj), 0, -1);
      kill_critter(self_obj, 0);
    end
  pickup_p_proc: |
    stealing := 1;
    dialogue_system_enter;
  talk_p_proc: |
    call get_reaction;
    if (local_var(8) == 1) then begin
      float_msg(self_obj, message_str(669, 104), 2);
    end
    else begin
      if (global_var(39) == 2) then begin
        float_msg(self_obj, message_str(669, 101), 0);
      end
      else begin
        start_gdialog(44, self_obj, 4, 21, 7);
        gsay_start;
        if (stealing) then begin
          call Gizmo45;
        end
        else begin
          if (global_var(37) == 1) then begin
            call Gizmo21;
          end
          else begin
            if ((local_var(4) > 0) and (local_var(4) < 3)) then begin
              call Gizmo13;
            end
            else begin
              if (local_var(4) == 3) then begin
                call Gizmo35;
              end
              else begin
                set_local_var(4, 1);
                if ((global_var(37) == 1) or (global_var(36) == 1)) then begin
                  call Gizmo21;
                end
                else begin
                  call Gizmo01;
                end
              end
            end
          end
        end
        gsay_end;
        end_dialogue;
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(347, 1);
    end
  Gizmo01: |
    gsay_reply(44, 101);
    giq_option(5, 44, 102, Gizmo01_1, 49);
    giq_option(7, 44, 103, Gizmo04, 50);
    giq_option(4, 44, 104, Gizmo04, 50);
    giq_option(-3, 44, 105, Gizmo01b, 51);
  Gizmo01_1: |
    call UpReactLevel;
    set_local_var(5, 1);
    call Gizmo02;
  Gizmo01b: |
    gsay_message(44, 106, 51);
    call Gizmox2;
  Gizmo02: |
    gsay_reply(44, 107);
    giq_option(5, 44, 108, Gizmo11, 51);
    giq_option(4, 44, 109, Gizmo04, 50);
  Gizmo04: |
    gsay_reply(44, 110);
    giq_option(4, 44, 111, Gizmo05, 50);
    giq_option(4, 44, 112, Gizmo04_1, 51);
  Gizmo04a: |
    gsay_message(44, 113, 50);
    call Gizmo05;
  Gizmo04_1: |
    set_local_var(5, local_var(5) + 1);
    if (local_var(5) > 1) then begin
      call Gizmo11;
    end
    else begin
      call Gizmo04a;
    end
  Gizmo05: |
    gsay_reply(44, 114);
    giq_option(7, 44, 115, Gizmo06, 50);
    if (not(is_success(do_check(dude_obj, 6, 0)))) then begin
      giq_option(6, 44, 116, Gizmo05_1, 51);
    end
    giq_option(4, 44, 117, Gizmo07, 49);
    giq_option(4, 44, 118, Gizmo10, 50);
    giq_option(5, 44, 119, Gizmo08, 50);
  Gizmo05_1: |
    call DownReactLevel;
    call Gizmo10;
  Gizmo06: |
    gsay_reply(44, 120);
    giq_option(7, 44, 121, Gizmo07, 49);
    giq_option(4, 44, 122, Gizmo07, 49);
    giq_option(6, 44, 123, badmouth, 51);
    giq_option(5, 44, 124, Gizmo08, 50);
    giq_option(4, 44, 125, Gizmo10, 51);
    giq_option(4, 44, 126, Gizmo10, 50);
  Gizmo07: |
    set_global_var(39, 1);
    gsay_message(44, 127, 49);
    call Gizmox;
  Gizmo08: |
    gsay_reply(44, 128);
    giq_option(4, 44, 129, Gizmo07, 49);
    giq_option(6, 44, 130, Gizmo09, 50);
    giq_option(4, 44, 131, Gizmo10, 50);
    giq_option(5, 44, 132, badmouth, 51);
  Gizmo09: |
    set_local_var(7, 1500);
    gsay_reply(44, 133);
    giq_option(4, 44, 134, Gizmo07, 49);
    giq_option(6, 44, 135, badmouth, 51);
    giq_option(5, 44, 136, Gizmo10, 50);
    giq_option(4, 44, 137, Gizmo10, 51);
  Gizmo10: |
    gsay_message(44, 138, 51);
    call Gizmox1;
  Gizmo11: |
    gsay_message(44, 139, 51);
    call Gizmox1;
  Gizmo13: |
    set_local_var(4, local_var(4) + 1);
    gsay_reply(44, 140);
    giq_option(4, 44, 141, Gizmo13_1, 50);
    giq_option(4, 44, 142, Gizmo20, 50);
  Gizmo13_1: |
    if (obj_is_carrying_obj_pid(dude_obj, 56) or (global_var(37) == 1)) then begin
      call Gizmo14;
    end
    else begin
      call Gizmo17;
    end
  Gizmo14: |
    gsay_reply(44, 143);
    if (obj_is_carrying_obj_pid(dude_obj, 56)) then begin
      gsay_option(634, 106, Gizmo15, 49);
    end
    else begin
      gsay_option(634, 106, Gizmo17, 51);
    end
  Gizmo15: |
    destroy_object(obj_carrying_pid_obj(dude_obj, 56));
    set_global_var(39, 2);
    gsay_reply(44, 144);
    giq_option(4, 44, 145, GizmoPay, 50);
    giq_option(6, 44, 146, Gizmo15_1, 51);
    giq_option(6, 44, 147, Gizmo16, 50);
    giq_option(7, 44, 148, GizmoPay, 50);
  Gizmo15_1: |
    set_local_var(5, local_var(5) + 1);
    if (local_var(5) > 1) then begin
      call Gizmo11;
    end
    else begin
      call Gizmo16;
    end
  Gizmo16: |
    gsay_reply(44, 149);
    giq_option(4, 44, 150, GizmoPay, 50);
    if (not(is_success(do_check(dude_obj, 6, 0)))) then begin
      giq_option(7, 44, 151, Gizmo16a, 51);
    end
    giq_option(6, 44, 152, GizmoPay, 50);
  Gizmo16a: |
    call DownReactLevel;
    call badmouth;
  Gizmo17: |
    gsay_reply(44, 153);
    giq_option(4, 44, 154, Gizmo18, 50);
    giq_option(6, 44, 155, Gizmo19, 51);
    giq_option(5, 44, 156, Gizmo20, 50);
    giq_option(6, 44, 157, Gizmo20, 50);
  Gizmo18: |
    if (local_var(6) > 1) then begin
      call Gizmo11;
    end
    else begin
      set_local_var(6, local_var(6) + 1);
      if (obj_is_carrying_obj_pid(dude_obj, 104) and (global_var(36) == 1)) then begin
        set_global_var(42, 1);
      end
      gsay_message(44, 158, 50);
      call Gizmox;
    end
  Gizmo19: |
    gsay_reply(44, 159);
    giq_option(4, 44, 160, Gizmo20, 50);
    if (not(is_success(do_check(dude_obj, 6, 0)))) then begin
      giq_option(7, 44, 161, Gizmo19a, 51);
    end
    giq_option(5, 44, 162, Gizmo18, 50);
    giq_option(6, 44, 163, Gizmo20, 50);
  Gizmo20: |
    if (local_var(6) > 1) then begin
      call Gizmo11;
    end
    else begin
      set_local_var(6, local_var(6) + 1);
      gsay_message(44, 164, 50);
      call Gizmox;
    end
  Gizmo21: |
    gsay_reply(44, 165);
    if (global_var(37) == 0) then begin
      giq_option(7, 44, 166, Gizmo22, 50);
      giq_option(4, 44, 169, Gizmo22, 50);
    end
    else begin
      giq_option(4, 44, 221, Gizmo15, 49);
    end
    giq_option(4, 44, 167, Gizmo32, 50);
    giq_option(6, 44, 168, Gizmo34, 51);
    giq_option(-3, 44, 105, Gizmo01b, 51);
  Gizmo22: |
    gsay_reply(44, 170);
    if (get_critter_stat(dude_obj, 4) >= 7) then begin
      giq_option(7, 44, 171, Gizmo23, 50);
    end
    else begin
      giq_option(4, 44, 222, Gizmo23, 50);
    end
    giq_option(6, 44, 172, Gizmo34, 51);
    giq_option(5, 44, 173, Gizmo33, 50);
    giq_option(4, 44, 174, Gizmo34, 51);
    giq_option(4, 44, 175, Gizmo32, 51);
  Gizmo23: |
    gsay_reply(44, 176);
    giq_option(7, 44, 177, Gizmo24, 49);
    giq_option(5, 44, 178, Gizmo34, 51);
    giq_option(4, 44, 179, Gizmo32, 50);
    giq_option(4, 44, 223, Gizmo24, 49);
  Gizmo24: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(44, 180);
    end
    else begin
      gsay_reply(44, 226);
    end
    giq_option(7, 44, 181, Gizmo25, 49);
    giq_option(4, 44, 182, Gizmo32, 50);
    giq_option(4, 44, 224, Gizmo26, 49);
  Gizmo25: |
    gsay_reply(44, 183);
    giq_option(7, 44, 184, Gizmo26, 50);
    giq_option(4, 44, 185, Gizmo26, 50);
  Gizmo26: |
    gsay_reply(44, 186);
    giq_option(7, 44, 187, Gizmo27, 50);
    giq_option(4, 44, 188, Gizmo30, 50);
    giq_option(4, 44, 189, Gizmo27, 50);
  Gizmo27: |
    gsay_reply(44, 190);
    giq_option(6, 44, 191, Gizmo34, 51);
    giq_option(6, 44, 192, Gizmo28, 50);
    giq_option(4, 44, 225, Gizmo28, 50);
  Gizmo28: |
    gsay_reply(44, 193);
    if (global_var(36) == 1) then begin
      if (obj_is_carrying_obj_pid(dude_obj, 104)) then begin
        set_global_var(42, 1);
        display_msg(message_str(44, 1110));
      end
    end
    if (global_var(41) == 1) then begin
      display_msg(message_str(44, 1111));
    end
    giq_option(6, 44, 194, Gizmo29, 50);
    giq_option(4, 44, 195, Gizmo29, 50);
    giq_option(4, 44, 196, Gizmo30, 51);
    giq_option(4, 44, 197, Gizmo30, 50);
  Gizmo29: |
    set_global_var(39, 1);
    gsay_message(44, 198, 50);
    call Gizmox;
  Gizmo30: |
    gsay_message(44, 199, 51);
    call Gizmox1;
  Gizmo32: |
    gsay_message(44, 200, 51);
    call Gizmox2;
  Gizmo33: |
    gsay_reply(44, 201);
    giq_option(5, 44, 202, Gizmo25, 50);
    giq_option(4, 44, 203, Gizmo32, 50);
  Gizmo34: |
    gsay_message(44, 204, 50);
    call Gizmox1;
  Gizmo35: |
    gsay_message(44, 205, 51);
    call Gizmox1;
  Gizmo45: |
    Gizmo_is_angry := 1;
    set_local_var(8, 1);
    stealing := 0;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(44, 213, 50);
    end
    else begin
      gsay_message(44, 214, 50);
    end
  Gizmo19a: |
    call DownReactLevel;
    call Gizmo11;
  Gizmox: 'show_to_door := 1;

    '
  Gizmox1: |
    Gizmo_is_angry := 1;
    set_local_var(8, 1);
  Gizmox2: 'set_local_var(8, 1);

    '
  GizmoPay: |
    payment := local_var(7);
    set_local_var(9, 1);
  badmouth: |
    set_local_var(5, local_var(5) + 1);
    if (local_var(5) > 1) then begin
      call Gizmo11;
    end
    else begin
      call Gizmo10;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
glo1weap:
  start: |
    if ((script_action == 21) and (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(298, 100));
    end
  use_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    variable LVar3 := 0;
    LVar0 := get_critter_stat(dude_obj, 0);
    LVar1 := get_critter_stat(dude_obj, 5);
    LVar2 := get_critter_stat(dude_obj, 6);
    LVar3 := LVar0 + LVar1 + LVar2;
    if ((LVar0 < 8) and (LVar3 < 18)) then begin
      script_overrides;
      display_msg(message_str(298, 101));
    end
glo3supl:
  start: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    LVar0 := get_critter_stat(dude_obj, 0);
    LVar1 := get_critter_stat(dude_obj, 5);
    LVar2 := LVar0 + LVar1;
    if ((script_action == 21) and (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(300, 100));
    end
    else begin
      if (script_action == 6) then begin
        if ((LVar0 < 7) and (LVar2 < 12)) then begin
          script_overrides;
          display_msg(message_str(300, 101));
        end
      end
    end
glo3wep:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(307, 100));
    end
    else begin
      if (script_action == 7) then begin
        if (obj_being_used_with == 84) then begin
          if (is_success(roll_vs_skill(dude_obj, 9, 0))) then begin
            set_local_var(0, 1);
            display_msg(message_str(307, 101));
          end
          else begin
            display_msg(message_str(307, 102));
          end
        end
        else begin
          display_msg(message_str(307, 103));
        end
      end
      else begin
        if (script_action == 6) then begin
          if (local_var(0) == 0) then begin
            script_overrides;
            display_msg(message_str(307, 104));
          end
        end
        else begin
          if (script_action == 8) then begin
            script_overrides;
            if (action_being_used == 9) then begin
              if (is_success(roll_vs_skill(dude_obj, 9, -10))) then begin
                set_local_var(0, 1);
                display_msg(message_str(307, 105));
              end
              else begin
                display_msg(message_str(307, 106));
              end
            end
            else begin
              display_msg(message_str(307, 107));
            end
          end
        end
      end
    end
glo4supl:
  start: |
    if (script_action == 6) then begin
      call open_door;
    end
    else begin
      if (script_action == 7) then begin
        call pick_lock;
      end
      else begin
        if (script_action == 8) then begin
          call disarm_electronics;
        end
      end
    end
  open_door: |
    if (local_var(3) == 1) then begin
      script_overrides;
      call shock;
    end
    else begin
      if (local_var(0) == 0) then begin
        call arm_doors;
      end
      else begin
        if (local_var(1) == 0) then begin
          script_overrides;
          display_msg(message_str(503, 105));
        end
      end
    end
  pick_lock: |
    script_overrides;
    if (local_var(3) == 0) then begin
      call shock;
    end
    else begin
      if (local_var(0) == 0) then begin
        call arm_doors;
      end
      else begin
        if (obj_being_used_with == 84) then begin
          skill_roll := roll_vs_skill(dude_obj, 9, 0);
        end
        else begin
          skill_roll := roll_vs_skill(dude_obj, 9, 3);
        end
        if (local_var(1) == 1) then begin
          display_msg(message_str(503, 100));
        end
        else begin
          if (is_success(skill_roll)) then begin
            display_msg(message_str(503, 101));
            set_local_var(1, 1);
          end
          else begin
            display_msg(message_str(503, 102));
          end
        end
      end
    end
  disarm_electronics: |
    if ((action_being_used != 12) and (action_being_used != 11)) then begin
      if (local_var(3) == 1) then begin
        call shock;
      end
      else begin
        call arm_doors;
      end
    end
    else begin
      if (local_var(0) == 1) then begin
        display_msg(message_str(503, 106));
      end
      else begin
        if (is_success(roll_vs_skill(dude_obj, action_being_used, 0))) then begin
          display_msg(message_str(503, 107));
          set_local_var(3, 0);
          set_local_var(0, 1);
        end
        else begin
          if (local_var(3) == 1) then begin
            call shock;
          end
          else begin
            call arm_doors;
          end
        end
      end
    end
  arm_doors: |
    display_msg(message_str(503, 104));
    set_local_var(3, 1);
  shock: |
    display_msg(message_str(503, 103));
    critter_dmg(dude_obj, 1, 0);
glo4weap:
  start: |
    if (global_var(142) == 2) then begin
      set_local_var(1, 1);
    end
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(321, 100));
    end
    else begin
      if (script_action == 6) then begin
        if (global_var(142) != 2) then begin
          set_global_var(142, 1);
        end
        call Using_Door;
      end
      else begin
        if (script_action == 8) then begin
          if (global_var(142) != 2) then begin
            set_global_var(142, 1);
          end
          if (action_being_used == 9) then begin
            call Picklocks;
          end
          else begin
            if (action_being_used == 11) then begin
              call Traps;
            end
            else begin
              if (action_being_used == 12) then begin
                call Sciences;
              end
              else begin
                display_msg(message_str(321, 101));
              end
            end
          end
        end
        else begin
          if (script_action == 7) then begin
            if (global_var(142) != 2) then begin
              set_global_var(142, 1);
            end
            if (obj_pid(obj_being_used_with) == 96) then begin
              if (local_var(1) == 0) then begin
                script_overrides;
                Shocked := random(3, 7);
                critter_dmg(dude_obj, Shocked, 0);
                display_msg(message_str(321, 102) + Shocked + message_str(321, 103));
                set_local_var(0, local_var(0) + 1);
              end
              else begin
                if (local_var(2) == 0) then begin
                  script_overrides;
                  set_local_var(2, 1);
                  display_msg(message_str(321, 104));
                end
              end
            end
            else begin
              display_msg(message_str(321, 105));
            end
          end
        end
      end
    end
  Traps: |
    if (local_var(1) == 0) then begin
      if (is_success(roll_vs_skill(dude_obj, 11, 0))) then begin
        set_local_var(1, 1);
        display_msg(message_str(321, 113));
      end
      else begin
        set_local_var(0, 5);
        Shocked := random(2, local_var(0));
        critter_dmg(dude_obj, Shocked, 0);
        display_msg(message_str(321, 114) + Shocked + message_str(321, 115));
        set_local_var(0, local_var(0) + 1);
      end
    end
    else begin
      display_msg(message_str(321, 116));
    end
  Sciences: |
    if (local_var(1) == 0) then begin
      if (is_success(roll_vs_skill(dude_obj, 12, 0))) then begin
        set_local_var(1, 1);
        display_msg(message_str(321, 117));
      end
      else begin
        set_local_var(0, 5);
        Shocked := random(2, local_var(0));
        critter_dmg(dude_obj, Shocked, 0);
        display_msg(message_str(321, 118) + Shocked + message_str(321, 119));
        set_local_var(0, local_var(0) + 1);
      end
    end
    else begin
      display_msg(message_str(321, 120));
    end
  Picklocks: |
    if (local_var(1) == 0) then begin
      if (local_var(0) > 2) then begin
        Shocked := random(2, local_var(0));
        critter_dmg(dude_obj, Shocked, 0);
        display_msg(message_str(321, 121) + Shocked + message_str(321, 122));
        set_local_var(0, local_var(0) + 1);
      end
      else begin
        set_local_var(0, local_var(0) + 1);
        display_msg(message_str(321, 123));
      end
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 9, 0))) then begin
        set_local_var(2, 1);
        display_msg(message_str(321, 124));
      end
      else begin
        display_msg(message_str(321, 125));
      end
    end
  Using_Door: |
    if (local_var(1) == 0) then begin
      script_overrides;
      if (local_var(0) > 2) then begin
        Shocked := random(2, local_var(0));
        critter_dmg(dude_obj, Shocked, 0);
        display_msg(message_str(321, 106) + Shocked + message_str(321, 107));
        set_local_var(0, local_var(0) + 1);
      end
      else begin
        set_local_var(0, local_var(0) + 1);
        display_msg(message_str(321, 108));
      end
    end
    else begin
      if (local_var(2) == 0) then begin
        script_overrides;
        display_msg(message_str(321, 109));
        if (is_success(do_check(dude_obj, 1, 0))) then begin
          display_msg(message_str(321, 110));
        end
        else begin
          if (is_success(roll_vs_skill(dude_obj, 11, 0))) then begin
            display_msg(message_str(321, 111));
          end
          else begin
            display_msg(message_str(321, 112));
          end
        end
      end
    end
globldor:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  use_p_proc: |
    variable LVar0 := 0;
    LVar0 := roll_vs_skill(source_obj, 11, -20);
    if (global_var(224) != 2) then begin
      script_overrides;
      display_msg(message_str(306, 205));
    end
    else begin
      if (local_var(2) == 0) then begin
        if (is_success(LVar0)) then begin
          script_overrides;
          display_msg(message_str(306, 204));
          reg_anim_func(2, source_obj);
        end
        else begin
          if (obj_is_locked(self_obj)) then begin
            script_overrides;
            set_local_var(0, local_var(0) + 1);
            call Damage_Dude;
          end
          else begin
            script_overrides;
            set_local_var(0, local_var(0) + 1);
            call Damage_Dude;
          end
        end
      end
      else begin
        if (local_var(3) == 0) then begin
          script_overrides;
          display_msg(message_str(306, 105));
        end
      end
    end
  use_skill_on_p_proc: |
    if ((local_var(2) == 0) and obj_is_locked(self_obj)) then begin
      call Trapped_And_Locked;
    end
    else begin
      if (local_var(2) == 0) then begin
        call Trapped_Door;
      end
      else begin
        if (obj_is_locked(self_obj)) then begin
          call Locked_Door;
        end
      end
    end
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    LVar0 := obj_pid(obj_being_used_with);
    if (LVar0 == 77) then begin
      script_overrides;
      if (local_var(2) == 0) then begin
        LVar1 := roll_vs_skill(source_obj, 11, -20);
        if (is_success(LVar1)) then begin
          display_msg(204);
          reg_anim_func(2, source_obj);
        end
        else begin
          set_local_var(0, local_var(0) + 1);
          call Damage_Dude;
        end
      end
      if (obj_is_locked(self_obj)) then begin
        LVar2 := roll_vs_skill(source_obj, 9, -10);
        if (is_success(LVar2)) then begin
          obj_unlock(self_obj);
          set_local_var(3, 1);
          display_msg(message_str(306, 109));
          display_msg(message_str(766, 103) + "45" + message_str(766, 104));
          give_exp_points(45);
        end
        else begin
          if (is_critical(LVar2)) then begin
            display_msg(message_str(306, 121));
            jam_lock(self_obj);
            display_msg(message_str(306, 110));
            rm_obj_from_inven(source_obj, LVar0);
            destroy_object(LVar0);
          end
          else begin
            display_msg(message_str(306, 122));
          end
        end
      end
    end
    else begin
      if (LVar0 == 97) then begin
        script_overrides;
        set_local_var(2, 1);
        obj_unlock(self_obj);
        set_local_var(3, 1);
        display_msg(message_str(306, 106));
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(306, 123));
  description_p_proc: |
    script_overrides;
    if ((local_var(3) == 0) and (local_var(2) == 0)) then begin
      call Skill_Checks;
      call Display_Armed_And_Locked;
    end
    else begin
      if (local_var(2) == 0) then begin
        call Skill_Checks;
        call Display_Trapped;
      end
      else begin
        if (local_var(3) == 0) then begin
          call Locks_Check;
          call Display_Locked;
        end
        else begin
          display_msg(message_str(306, 123));
        end
      end
    end
  damage_p_proc: |
    if (local_var(1) > 3) then begin
      set_local_var(2, 1);
      set_obj_visibility(self_obj, 1);
      obj_open(self_obj);
      set_local_var(3, 1);
    end
  map_enter_p_proc: |
    if (local_var(3) == 0) then begin
      obj_lock(self_obj);
    end
  map_update_p_proc: |
    if (local_var(3) == 0) then begin
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
  Trapped_And_Locked: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (action_being_used == 11) then begin
      script_overrides;
      LVar0 := roll_vs_skill(source_obj, 11, -20);
      if (is_success(LVar0)) then begin
        display_msg(message_str(306, 113));
        set_local_var(2, 1);
        display_msg(message_str(766, 103) + "45" + message_str(766, 104));
        give_exp_points(45);
      end
      else begin
        if (is_critical(LVar0)) then begin
          display_msg(message_str(306, 114));
          jam_lock(self_obj);
          display_msg(message_str(306, 110));
          if (local_var(0) == 0) then begin
            set_local_var(0, 4);
          end
          else begin
            set_local_var(0, local_var(0) + 4);
          end
          call Damage_Dude;
        end
        else begin
          set_local_var(0, local_var(0) + 1);
          display_msg(message_str(306, 115));
          call Damage_Dude;
        end
      end
    end
    else begin
      if (action_being_used == 9) then begin
        script_overrides;
        LVar0 := roll_vs_skill(source_obj, 9, -30);
        LVar1 := roll_vs_skill(source_obj, 11, -20);
        if (is_success(LVar1)) then begin
          if (is_success(LVar0)) then begin
            obj_unlock(self_obj);
            set_local_var(3, 1);
            display_msg(message_str(306, 116));
            display_msg(message_str(766, 103) + "55" + message_str(766, 104));
            give_exp_points(55);
          end
          else begin
            if (is_critical(LVar0)) then begin
              jam_lock(self_obj);
              display_msg(message_str(306, 110));
              set_local_var(0, local_var(0) + 2);
              display_msg(message_str(306, 117));
              call Damage_Dude;
            end
            else begin
              set_local_var(0, local_var(0) + 1);
              display_msg(message_str(306, 118));
              call Damage_Dude;
            end
          end
        end
        else begin
          if (is_critical(LVar1)) then begin
            display_msg(message_str(306, 120));
            if (local_var(0) == 0) then begin
              set_local_var(0, 4);
            end
            else begin
              set_local_var(0, local_var(0) + 4);
            end
            call Damage_Dude;
          end
          else begin
            set_local_var(0, local_var(0) + 1);
            display_msg(message_str(306, 119));
            call Damage_Dude;
          end
        end
      end
    end
  Locked_Door: |
    variable LVar0 := 0;
    if (action_being_used == 9) then begin
      script_overrides;
      LVar0 := roll_vs_skill(source_obj, 9, -30);
      if (is_success(LVar0)) then begin
        obj_unlock(self_obj);
        set_local_var(3, 1);
        display_msg(message_str(306, 116));
        display_msg(message_str(766, 103) + "55" + message_str(766, 104));
        give_exp_points(55);
      end
      else begin
        if (is_critical(LVar0)) then begin
          jam_lock(self_obj);
          display_msg(message_str(306, 110));
          game_time_advance(game_ticks(600));
          display_msg(message_str(306, 111));
        end
        else begin
          display_msg(message_str(306, 122));
        end
      end
    end
  Trapped_Door: |
    variable LVar0 := 0;
    if (action_being_used == 11) then begin
      script_overrides;
      LVar0 := roll_vs_skill(source_obj, 11, -20);
      if (is_success(LVar0)) then begin
        display_msg(message_str(306, 113));
        set_local_var(2, 1);
        display_msg(message_str(766, 103) + "45" + message_str(766, 104));
        give_exp_points(45);
      end
      else begin
        if (is_critical(LVar0)) then begin
          display_msg(message_str(306, 114));
          if (local_var(0) == 0) then begin
            set_local_var(0, 4);
          end
          else begin
            set_local_var(0, local_var(0) + 4);
          end
          call Damage_Dude;
        end
        else begin
          set_local_var(0, local_var(0) + 1);
          display_msg(message_str(306, 115));
          call Damage_Dude;
        end
      end
    end
  Damage_Dude: |
    critter_dmg(source_obj, local_var(0), 4 bwor 256);
    if (local_var(0) == 1) then begin
      display_msg(message_str(306, 101));
    end
    else begin
      display_msg(message_str(306, 102) + local_var(0) + message_str(306, 103));
    end
  Skill_Checks: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    LVar0 := roll_vs_skill(source_obj, 11, 0);
    LVar1 := roll_vs_skill(source_obj, 9, -10);
    LVar2 := do_check(source_obj, 1, 0);
    if (is_success(LVar0)) then begin
      if (is_critical(LVar0)) then begin
        call Locks_Check;
        Traps := 3;
      end
      else begin
        call Locks_Check;
        Traps := 2;
      end
    end
    else begin
      if (is_critical(LVar0)) then begin
        call Locks_Check;
        Traps := 0;
      end
      else begin
        call Locks_Check;
        Traps := 1;
      end
    end
  Stat_Checks: |
    variable LVar0 := 0;
    LVar0 := do_check(source_obj, 1, 0);
    if (is_success(LVar0)) then begin
      if (is_critical(LVar0)) then begin
        Per := 3;
      end
      else begin
        Per := 2;
      end
    end
    else begin
      if (is_critical(LVar0)) then begin
        Per := 0;
      end
      else begin
        Per := 1;
      end
    end
  Locks_Check: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := roll_vs_skill(source_obj, 9, -10);
    LVar1 := do_check(source_obj, 1, 0);
    if (is_success(LVar0)) then begin
      if (is_critical(LVar0)) then begin
        call Stat_Checks;
        Locks := 3;
      end
      else begin
        call Stat_Checks;
        Locks := 2;
      end
    end
    else begin
      if (is_critical(LVar0)) then begin
        call Stat_Checks;
        Locks := 0;
      end
      else begin
        call Stat_Checks;
        Locks := 1;
      end
    end
  Display_Armed_And_Locked: |
    if (Per == 0) then begin
      if (Locks == 0) then begin
        if (Traps == 0) then begin
          display_msg(message_str(306, 124));
        end
        else begin
          if (Traps == 1) then begin
            display_msg(message_str(306, 125));
          end
          else begin
            if (Traps == 2) then begin
              display_msg(message_str(306, 126));
            end
            else begin
              display_msg(message_str(306, 127));
            end
          end
        end
      end
      else begin
        if (Locks == 1) then begin
          if (Traps == 0) then begin
            display_msg(message_str(306, 128));
          end
          else begin
            if (Traps == 1) then begin
              display_msg(message_str(306, 129));
            end
            else begin
              if (Traps == 2) then begin
                display_msg(message_str(306, 130));
              end
              else begin
                display_msg(message_str(306, 131));
              end
            end
          end
        end
        else begin
          if (Locks == 2) then begin
            if (Traps == 0) then begin
              display_msg(message_str(306, 132));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(306, 133));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(306, 134));
                end
                else begin
                  display_msg(message_str(306, 135));
                end
              end
            end
          end
          else begin
            if (Traps == 0) then begin
              display_msg(message_str(306, 136));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(306, 137));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(306, 138));
                end
                else begin
                  display_msg(message_str(306, 139));
                end
              end
            end
          end
        end
      end
    end
    else begin
      if (Per == 1) then begin
        if (Locks == 0) then begin
          if (Traps == 0) then begin
            display_msg(message_str(306, 140));
          end
          else begin
            if (Traps == 1) then begin
              display_msg(message_str(306, 141));
            end
            else begin
              if (Traps == 2) then begin
                display_msg(message_str(306, 142));
              end
              else begin
                display_msg(message_str(306, 143));
              end
            end
          end
        end
        else begin
          if (Locks == 1) then begin
            if (Traps == 0) then begin
              display_msg(message_str(306, 144));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(306, 145));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(306, 146));
                end
                else begin
                  display_msg(message_str(306, 147));
                end
              end
            end
          end
          else begin
            if (Locks == 2) then begin
              if (Traps == 0) then begin
                display_msg(message_str(306, 148));
              end
              else begin
                if (Traps == 1) then begin
                  display_msg(message_str(306, 149));
                end
                else begin
                  if (Traps == 2) then begin
                    display_msg(message_str(306, 150));
                  end
                  else begin
                    display_msg(message_str(306, 151));
                  end
                end
              end
            end
            else begin
              if (Traps == 0) then begin
                display_msg(message_str(306, 152));
              end
              else begin
                if (Traps == 1) then begin
                  display_msg(message_str(306, 153));
                end
                else begin
                  if (Traps == 2) then begin
                    display_msg(message_str(306, 154));
                  end
                  else begin
                    display_msg(message_str(306, 155));
                  end
                end
              end
            end
          end
        end
      end
      else begin
        if (Per == 2) then begin
          if (Locks == 0) then begin
            if (Traps == 0) then begin
              display_msg(message_str(306, 156));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(306, 157));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(306, 158));
                end
                else begin
                  display_msg(message_str(306, 159));
                end
              end
            end
          end
          else begin
            if (Locks == 1) then begin
              if (Traps == 0) then begin
                display_msg(message_str(306, 160));
              end
              else begin
                if (Traps == 1) then begin
                  display_msg(message_str(306, 161));
                end
                else begin
                  if (Traps == 2) then begin
                    display_msg(message_str(306, 162));
                  end
                  else begin
                    display_msg(message_str(306, 163));
                  end
                end
              end
            end
            else begin
              if (Locks == 2) then begin
                if (Traps == 0) then begin
                  display_msg(message_str(306, 164));
                end
                else begin
                  if (Traps == 1) then begin
                    display_msg(message_str(306, 165));
                  end
                  else begin
                    if (Traps == 2) then begin
                      display_msg(message_str(306, 166));
                    end
                    else begin
                      display_msg(message_str(306, 167));
                    end
                  end
                end
              end
              else begin
                if (Traps == 0) then begin
                  display_msg(message_str(306, 168));
                end
                else begin
                  if (Traps == 1) then begin
                    display_msg(message_str(306, 169));
                  end
                  else begin
                    if (Traps == 2) then begin
                      display_msg(message_str(306, 170));
                    end
                    else begin
                      display_msg(message_str(306, 171));
                    end
                  end
                end
              end
            end
          end
        end
        else begin
          if (Locks == 0) then begin
            if (Traps == 0) then begin
              display_msg(message_str(306, 172));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(306, 173));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(306, 174));
                end
                else begin
                  display_msg(message_str(306, 175));
                end
              end
            end
          end
          else begin
            if (Locks == 1) then begin
              if (Traps == 0) then begin
                display_msg(message_str(306, 176));
              end
              else begin
                if (Traps == 1) then begin
                  display_msg(message_str(306, 177));
                end
                else begin
                  if (Traps == 2) then begin
                    display_msg(message_str(306, 178));
                  end
                  else begin
                    display_msg(message_str(306, 179));
                  end
                end
              end
            end
            else begin
              if (Locks == 2) then begin
                if (Traps == 0) then begin
                  display_msg(message_str(306, 180));
                end
                else begin
                  if (Traps == 1) then begin
                    display_msg(message_str(306, 181));
                  end
                  else begin
                    if (Traps == 2) then begin
                      display_msg(message_str(306, 182));
                    end
                    else begin
                      display_msg(message_str(306, 183));
                    end
                  end
                end
              end
              else begin
                if (Traps == 0) then begin
                  display_msg(message_str(306, 184));
                end
                else begin
                  if (Traps == 1) then begin
                    display_msg(message_str(306, 185));
                  end
                  else begin
                    if (Traps == 2) then begin
                      display_msg(message_str(306, 186));
                    end
                    else begin
                      display_msg(message_str(306, 187));
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  Display_Locked: |
    if (Per == 0) then begin
      if (Locks == 0) then begin
        display_msg(message_str(306, 124));
      end
      else begin
        if (Locks == 1) then begin
          display_msg(message_str(306, 128));
        end
        else begin
          if (Locks == 2) then begin
            display_msg(message_str(306, 132));
          end
          else begin
            display_msg(message_str(306, 136));
          end
        end
      end
    end
    else begin
      if (Per == 1) then begin
        if (Locks == 0) then begin
          display_msg(message_str(306, 140));
        end
        else begin
          if (Locks == 1) then begin
            display_msg(message_str(306, 144));
          end
          else begin
            if (Locks == 2) then begin
              display_msg(message_str(306, 148));
            end
            else begin
              display_msg(message_str(306, 152));
            end
          end
        end
      end
      else begin
        if (Per == 2) then begin
          if (Locks == 0) then begin
            display_msg(message_str(306, 156));
          end
          else begin
            if (Locks == 1) then begin
              display_msg(message_str(306, 160));
            end
            else begin
              if (Locks == 2) then begin
                display_msg(message_str(306, 164));
              end
              else begin
                display_msg(message_str(306, 168));
              end
            end
          end
        end
        else begin
          if (Locks == 0) then begin
            display_msg(message_str(306, 172));
          end
          else begin
            if (Locks == 1) then begin
              display_msg(message_str(306, 176));
            end
            else begin
              if (Locks == 2) then begin
                display_msg(message_str(306, 180));
              end
              else begin
                display_msg(message_str(306, 184));
              end
            end
          end
        end
      end
    end
  Display_Trapped: |
    if (Per == 0) then begin
      if (Traps == 0) then begin
        display_msg(message_str(306, 188));
      end
      else begin
        if (Traps == 1) then begin
          display_msg(message_str(306, 189));
        end
        else begin
          if (Traps == 2) then begin
            display_msg(message_str(306, 190));
          end
          else begin
            display_msg(message_str(306, 191));
          end
        end
      end
    end
    else begin
      if (Per == 1) then begin
        if (Traps == 0) then begin
          display_msg(message_str(306, 192));
        end
        else begin
          if (Traps == 1) then begin
            display_msg(message_str(306, 193));
          end
          else begin
            if (Traps == 2) then begin
              display_msg(message_str(306, 194));
            end
            else begin
              display_msg(message_str(306, 195));
            end
          end
        end
      end
      else begin
        if (Per == 2) then begin
          if (Traps == 0) then begin
            display_msg(message_str(306, 196));
          end
          else begin
            if (Traps == 1) then begin
              display_msg(message_str(306, 197));
            end
            else begin
              if (Traps == 2) then begin
                display_msg(message_str(306, 198));
              end
              else begin
                display_msg(message_str(306, 199));
              end
            end
          end
        end
        else begin
          if (Traps == 0) then begin
            display_msg(message_str(306, 200));
          end
          else begin
            if (Traps == 1) then begin
              display_msg(message_str(306, 201));
            end
            else begin
              if (Traps == 2) then begin
                display_msg(message_str(306, 202));
              end
              else begin
                display_msg(message_str(306, 203));
              end
            end
          end
        end
      end
    end
globlelv:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(328, 100));
    end
    else begin
      if (script_action == 6) then begin
        if ((local_var(0) == 0) and (global_var(139) == 2)) then begin
          script_overrides;
          set_local_var(1, local_var(1) + 1);
          Shocked := random(1, 6) - 4 + local_var(1);
          if (Shocked <= 0) then begin
            display_msg(message_str(328, 101));
          end
          else begin
            if (Shocked == 1) then begin
              display_msg(message_str(328, 102));
              critter_dmg(dude_obj, Shocked, 0);
            end
            else begin
              display_msg(message_str(328, 103) + Shocked + message_str(328, 104));
              critter_dmg(dude_obj, Shocked, 0);
            end
          end
        end
      end
      else begin
        if (script_action == 7) then begin
          if (obj_pid(obj_being_used_with) == 97) then begin
            set_local_var(0, 1);
            display_msg(message_str(328, 105));
          end
          else begin
            display_msg(message_str(328, 106));
          end
        end
      end
    end
glocabn:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(334, 100));
    end
    else begin
      if (script_action == 4) then begin
        if (local_var(0) == 0) then begin
          script_overrides;
          display_msg(message_str(334, 101));
        end
      end
      else begin
        if (script_action == 8) then begin
          if (action_being_used == 9) then begin
            if (is_success(roll_vs_skill(dude_obj, 9, -15))) then begin
              set_local_var(0, 1);
              display_msg(message_str(334, 102));
            end
            else begin
              display_msg(message_str(334, 103));
            end
          end
          else begin
            if (action_being_used == 12) then begin
              if (is_success(roll_vs_skill(dude_obj, 12, -5))) then begin
                set_local_var(0, 1);
                display_msg(message_str(334, 104));
              end
              else begin
                display_msg(message_str(334, 105));
              end
            end
            else begin
              display_msg(message_str(334, 106));
            end
          end
        end
      end
    end
glocomp:
  start: |
    variable LVar0 := 0;
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      LVar0 := random(1, 4);
      if (LVar0 == 1) then begin
        display_msg(message_str(299, 100));
      end
      else begin
        if (LVar0 == 2) then begin
          display_msg(message_str(299, 101));
        end
        else begin
          if (LVar0 == 3) then begin
            display_msg(message_str(299, 102));
          end
          else begin
            if (LVar0 == 4) then begin
              display_msg(message_str(299, 103));
            end
          end
        end
      end
    end
glorddor:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  use_p_proc: |
    variable LVar0 := 0;
    LVar0 := roll_vs_skill(source_obj, 11, -20);
    if (global_var(224) == 0) then begin
      script_overrides;
      display_msg(message_str(305, 205));
    end
    else begin
      if (local_var(2) == 0) then begin
        if (is_success(LVar0)) then begin
          script_overrides;
          display_msg(message_str(305, 204));
          reg_anim_func(2, source_obj);
        end
        else begin
          if (obj_is_locked(self_obj)) then begin
            script_overrides;
            set_local_var(0, local_var(0) + 1);
            call Damage_Dude;
          end
          else begin
            script_overrides;
            set_local_var(0, local_var(0) + 1);
            call Damage_Dude;
          end
        end
      end
      else begin
        if (local_var(3) == 0) then begin
          script_overrides;
          display_msg(message_str(305, 105));
        end
      end
    end
  use_skill_on_p_proc: |
    if ((local_var(2) == 0) and obj_is_locked(self_obj)) then begin
      call Trapped_And_Locked;
    end
    else begin
      if (local_var(2) == 0) then begin
        call Trapped_Door;
      end
      else begin
        if (obj_is_locked(self_obj)) then begin
          call Locked_Door;
        end
      end
    end
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    LVar0 := obj_pid(obj_being_used_with);
    if (LVar0 == 77) then begin
      script_overrides;
      if (local_var(2) == 0) then begin
        LVar1 := roll_vs_skill(source_obj, 11, -20);
        if (is_success(LVar1)) then begin
          display_msg(204);
          reg_anim_func(2, source_obj);
        end
        else begin
          set_local_var(0, local_var(0) + 1);
          call Damage_Dude;
        end
      end
      if (obj_is_locked(self_obj)) then begin
        LVar2 := roll_vs_skill(source_obj, 9, -10);
        if (is_success(LVar2)) then begin
          obj_unlock(self_obj);
          set_local_var(3, 1);
          display_msg(message_str(305, 109));
          display_msg(message_str(766, 103) + "45" + message_str(766, 104));
          give_exp_points(45);
        end
        else begin
          if (is_critical(LVar2)) then begin
            display_msg(message_str(305, 121));
            jam_lock(self_obj);
            display_msg(message_str(305, 110));
            rm_obj_from_inven(source_obj, LVar0);
            destroy_object(LVar0);
          end
          else begin
            display_msg(message_str(305, 122));
          end
        end
      end
    end
    else begin
      if (LVar0 == 96) then begin
        script_overrides;
        set_local_var(2, 1);
        obj_unlock(self_obj);
        set_local_var(3, 1);
        display_msg(message_str(305, 106));
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(305, 123));
  description_p_proc: |
    script_overrides;
    if ((local_var(3) == 0) and (local_var(2) == 0)) then begin
      call Skill_Checks;
      call Display_Armed_And_Locked;
    end
    else begin
      if (local_var(2) == 0) then begin
        call Skill_Checks;
        call Display_Trapped;
      end
      else begin
        if (local_var(3) == 0) then begin
          call Locks_Check;
          call Display_Locked;
        end
        else begin
          display_msg(message_str(305, 123));
        end
      end
    end
  damage_p_proc: |
    if (local_var(1) > 3) then begin
      set_local_var(2, 1);
      set_obj_visibility(self_obj, 1);
      obj_open(self_obj);
      set_local_var(3, 1);
    end
  map_enter_p_proc: |
    if (local_var(3) == 0) then begin
      obj_lock(self_obj);
    end
  map_update_p_proc: |
    if (local_var(3) == 0) then begin
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
  Trapped_And_Locked: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (action_being_used == 11) then begin
      script_overrides;
      LVar0 := roll_vs_skill(source_obj, 11, -20);
      if (is_success(LVar0)) then begin
        display_msg(message_str(305, 113));
        set_local_var(2, 1);
        display_msg(message_str(766, 103) + "45" + message_str(766, 104));
        give_exp_points(45);
      end
      else begin
        if (is_critical(LVar0)) then begin
          display_msg(message_str(305, 114));
          jam_lock(self_obj);
          display_msg(message_str(305, 110));
          if (local_var(0) == 0) then begin
            set_local_var(0, 4);
          end
          else begin
            set_local_var(0, local_var(0) + 4);
          end
          call Damage_Dude;
        end
        else begin
          set_local_var(0, local_var(0) + 1);
          display_msg(message_str(305, 115));
          call Damage_Dude;
        end
      end
    end
    else begin
      if (action_being_used == 9) then begin
        script_overrides;
        LVar0 := roll_vs_skill(source_obj, 9, -30);
        LVar1 := roll_vs_skill(source_obj, 11, -20);
        if (is_success(LVar1)) then begin
          if (is_success(LVar0)) then begin
            obj_unlock(self_obj);
            set_local_var(3, 1);
            display_msg(message_str(305, 116));
            display_msg(message_str(766, 103) + "55" + message_str(766, 104));
            give_exp_points(55);
          end
          else begin
            if (is_critical(LVar0)) then begin
              jam_lock(self_obj);
              display_msg(message_str(305, 110));
              set_local_var(0, local_var(0) + 2);
              display_msg(message_str(305, 117));
              call Damage_Dude;
            end
            else begin
              set_local_var(0, local_var(0) + 1);
              display_msg(message_str(305, 118));
              call Damage_Dude;
            end
          end
        end
        else begin
          if (is_critical(LVar1)) then begin
            display_msg(message_str(305, 120));
            if (local_var(0) == 0) then begin
              set_local_var(0, 4);
            end
            else begin
              set_local_var(0, local_var(0) + 4);
            end
            call Damage_Dude;
          end
          else begin
            set_local_var(0, local_var(0) + 1);
            display_msg(message_str(305, 119));
            call Damage_Dude;
          end
        end
      end
    end
  Locked_Door: |
    variable LVar0 := 0;
    if (action_being_used == 9) then begin
      script_overrides;
      LVar0 := roll_vs_skill(source_obj, 9, -30);
      if (is_success(LVar0)) then begin
        obj_unlock(self_obj);
        set_local_var(3, 1);
        display_msg(message_str(305, 116));
        display_msg(message_str(766, 103) + "55" + message_str(766, 104));
        give_exp_points(55);
      end
      else begin
        if (is_critical(LVar0)) then begin
          display_msg(message_str(305, 111));
          jam_lock(self_obj);
          display_msg(message_str(305, 110));
          game_time_advance(game_ticks(600));
        end
        else begin
          display_msg(message_str(305, 122));
        end
      end
    end
  Trapped_Door: |
    variable LVar0 := 0;
    if (action_being_used == 11) then begin
      script_overrides;
      LVar0 := roll_vs_skill(source_obj, 11, -20);
      if (is_success(LVar0)) then begin
        display_msg(message_str(305, 113));
        set_local_var(2, 1);
        display_msg(message_str(766, 103) + "45" + message_str(766, 104));
        give_exp_points(45);
      end
      else begin
        if (is_critical(LVar0)) then begin
          display_msg(message_str(305, 114));
          if (local_var(0) == 0) then begin
            set_local_var(0, 4);
          end
          else begin
            set_local_var(0, local_var(0) + 4);
          end
          call Damage_Dude;
        end
        else begin
          set_local_var(0, local_var(0) + 1);
          display_msg(message_str(305, 115));
          call Damage_Dude;
        end
      end
    end
  Damage_Dude: |
    critter_dmg(source_obj, local_var(0), 4 bwor 256);
    if (local_var(0) == 1) then begin
      display_msg(message_str(305, 101));
    end
    else begin
      display_msg(message_str(305, 102) + local_var(0) + message_str(305, 103));
    end
  Skill_Checks: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    LVar0 := roll_vs_skill(source_obj, 11, 0);
    LVar1 := roll_vs_skill(source_obj, 9, -10);
    LVar2 := do_check(source_obj, 1, 0);
    if (is_success(LVar0)) then begin
      if (is_critical(LVar0)) then begin
        call Locks_Check;
        Traps := 3;
      end
      else begin
        call Locks_Check;
        Traps := 2;
      end
    end
    else begin
      if (is_critical(LVar0)) then begin
        call Locks_Check;
        Traps := 0;
      end
      else begin
        call Locks_Check;
        Traps := 1;
      end
    end
  Stat_Checks: |
    variable LVar0 := 0;
    LVar0 := do_check(source_obj, 1, 0);
    if (is_success(LVar0)) then begin
      if (is_critical(LVar0)) then begin
        Per := 3;
      end
      else begin
        Per := 2;
      end
    end
    else begin
      if (is_critical(LVar0)) then begin
        Per := 0;
      end
      else begin
        Per := 1;
      end
    end
  Locks_Check: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := roll_vs_skill(source_obj, 9, -10);
    LVar1 := do_check(source_obj, 1, 0);
    if (is_success(LVar0)) then begin
      if (is_critical(LVar0)) then begin
        call Stat_Checks;
        Locks := 3;
      end
      else begin
        call Stat_Checks;
        Locks := 2;
      end
    end
    else begin
      if (is_critical(LVar0)) then begin
        call Stat_Checks;
        Locks := 0;
      end
      else begin
        call Stat_Checks;
        Locks := 1;
      end
    end
  Display_Armed_And_Locked: |
    if (Per == 0) then begin
      if (Locks == 0) then begin
        if (Traps == 0) then begin
          display_msg(message_str(305, 124));
        end
        else begin
          if (Traps == 1) then begin
            display_msg(message_str(305, 125));
          end
          else begin
            if (Traps == 2) then begin
              display_msg(message_str(305, 126));
            end
            else begin
              display_msg(message_str(305, 127));
            end
          end
        end
      end
      else begin
        if (Locks == 1) then begin
          if (Traps == 0) then begin
            display_msg(message_str(305, 128));
          end
          else begin
            if (Traps == 1) then begin
              display_msg(message_str(305, 129));
            end
            else begin
              if (Traps == 2) then begin
                display_msg(message_str(305, 130));
              end
              else begin
                display_msg(message_str(305, 131));
              end
            end
          end
        end
        else begin
          if (Locks == 2) then begin
            if (Traps == 0) then begin
              display_msg(message_str(305, 132));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(305, 133));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(305, 134));
                end
                else begin
                  display_msg(message_str(305, 135));
                end
              end
            end
          end
          else begin
            if (Traps == 0) then begin
              display_msg(message_str(305, 136));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(305, 137));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(305, 138));
                end
                else begin
                  display_msg(message_str(305, 139));
                end
              end
            end
          end
        end
      end
    end
    else begin
      if (Per == 1) then begin
        if (Locks == 0) then begin
          if (Traps == 0) then begin
            display_msg(message_str(305, 140));
          end
          else begin
            if (Traps == 1) then begin
              display_msg(message_str(305, 141));
            end
            else begin
              if (Traps == 2) then begin
                display_msg(message_str(305, 142));
              end
              else begin
                display_msg(message_str(305, 143));
              end
            end
          end
        end
        else begin
          if (Locks == 1) then begin
            if (Traps == 0) then begin
              display_msg(message_str(305, 144));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(305, 145));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(305, 146));
                end
                else begin
                  display_msg(message_str(305, 147));
                end
              end
            end
          end
          else begin
            if (Locks == 2) then begin
              if (Traps == 0) then begin
                display_msg(message_str(305, 148));
              end
              else begin
                if (Traps == 1) then begin
                  display_msg(message_str(305, 149));
                end
                else begin
                  if (Traps == 2) then begin
                    display_msg(message_str(305, 150));
                  end
                  else begin
                    display_msg(message_str(305, 151));
                  end
                end
              end
            end
            else begin
              if (Traps == 0) then begin
                display_msg(message_str(305, 152));
              end
              else begin
                if (Traps == 1) then begin
                  display_msg(message_str(305, 153));
                end
                else begin
                  if (Traps == 2) then begin
                    display_msg(message_str(305, 154));
                  end
                  else begin
                    display_msg(message_str(305, 155));
                  end
                end
              end
            end
          end
        end
      end
      else begin
        if (Per == 2) then begin
          if (Locks == 0) then begin
            if (Traps == 0) then begin
              display_msg(message_str(305, 156));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(305, 157));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(305, 158));
                end
                else begin
                  display_msg(message_str(305, 159));
                end
              end
            end
          end
          else begin
            if (Locks == 1) then begin
              if (Traps == 0) then begin
                display_msg(message_str(305, 160));
              end
              else begin
                if (Traps == 1) then begin
                  display_msg(message_str(305, 161));
                end
                else begin
                  if (Traps == 2) then begin
                    display_msg(message_str(305, 162));
                  end
                  else begin
                    display_msg(message_str(305, 163));
                  end
                end
              end
            end
            else begin
              if (Locks == 2) then begin
                if (Traps == 0) then begin
                  display_msg(message_str(305, 164));
                end
                else begin
                  if (Traps == 1) then begin
                    display_msg(message_str(305, 165));
                  end
                  else begin
                    if (Traps == 2) then begin
                      display_msg(message_str(305, 166));
                    end
                    else begin
                      display_msg(message_str(305, 167));
                    end
                  end
                end
              end
              else begin
                if (Traps == 0) then begin
                  display_msg(message_str(305, 168));
                end
                else begin
                  if (Traps == 1) then begin
                    display_msg(message_str(305, 169));
                  end
                  else begin
                    if (Traps == 2) then begin
                      display_msg(message_str(305, 170));
                    end
                    else begin
                      display_msg(message_str(305, 171));
                    end
                  end
                end
              end
            end
          end
        end
        else begin
          if (Locks == 0) then begin
            if (Traps == 0) then begin
              display_msg(message_str(305, 172));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(305, 173));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(305, 174));
                end
                else begin
                  display_msg(message_str(305, 175));
                end
              end
            end
          end
          else begin
            if (Locks == 1) then begin
              if (Traps == 0) then begin
                display_msg(message_str(305, 176));
              end
              else begin
                if (Traps == 1) then begin
                  display_msg(message_str(305, 177));
                end
                else begin
                  if (Traps == 2) then begin
                    display_msg(message_str(305, 178));
                  end
                  else begin
                    display_msg(message_str(305, 179));
                  end
                end
              end
            end
            else begin
              if (Locks == 2) then begin
                if (Traps == 0) then begin
                  display_msg(message_str(305, 180));
                end
                else begin
                  if (Traps == 1) then begin
                    display_msg(message_str(305, 181));
                  end
                  else begin
                    if (Traps == 2) then begin
                      display_msg(message_str(305, 182));
                    end
                    else begin
                      display_msg(message_str(305, 183));
                    end
                  end
                end
              end
              else begin
                if (Traps == 0) then begin
                  display_msg(message_str(305, 184));
                end
                else begin
                  if (Traps == 1) then begin
                    display_msg(message_str(305, 185));
                  end
                  else begin
                    if (Traps == 2) then begin
                      display_msg(message_str(305, 186));
                    end
                    else begin
                      display_msg(message_str(305, 187));
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  Display_Locked: |
    if (Per == 0) then begin
      if (Locks == 0) then begin
        display_msg(message_str(305, 124));
      end
      else begin
        if (Locks == 1) then begin
          display_msg(message_str(305, 128));
        end
        else begin
          if (Locks == 2) then begin
            display_msg(message_str(305, 132));
          end
          else begin
            display_msg(message_str(305, 136));
          end
        end
      end
    end
    else begin
      if (Per == 1) then begin
        if (Locks == 0) then begin
          display_msg(message_str(305, 140));
        end
        else begin
          if (Locks == 1) then begin
            display_msg(message_str(305, 144));
          end
          else begin
            if (Locks == 2) then begin
              display_msg(message_str(305, 148));
            end
            else begin
              display_msg(message_str(305, 152));
            end
          end
        end
      end
      else begin
        if (Per == 2) then begin
          if (Locks == 0) then begin
            display_msg(message_str(305, 156));
          end
          else begin
            if (Locks == 1) then begin
              display_msg(message_str(305, 160));
            end
            else begin
              if (Locks == 2) then begin
                display_msg(message_str(305, 164));
              end
              else begin
                display_msg(message_str(305, 168));
              end
            end
          end
        end
        else begin
          if (Locks == 0) then begin
            display_msg(message_str(305, 172));
          end
          else begin
            if (Locks == 1) then begin
              display_msg(message_str(305, 176));
            end
            else begin
              if (Locks == 2) then begin
                display_msg(message_str(305, 180));
              end
              else begin
                display_msg(message_str(305, 184));
              end
            end
          end
        end
      end
    end
  Display_Trapped: |
    if (Per == 0) then begin
      if (Traps == 0) then begin
        display_msg(message_str(305, 188));
      end
      else begin
        if (Traps == 1) then begin
          display_msg(message_str(305, 189));
        end
        else begin
          if (Traps == 2) then begin
            display_msg(message_str(305, 190));
          end
          else begin
            display_msg(message_str(305, 191));
          end
        end
      end
    end
    else begin
      if (Per == 1) then begin
        if (Traps == 0) then begin
          display_msg(message_str(305, 192));
        end
        else begin
          if (Traps == 1) then begin
            display_msg(message_str(305, 193));
          end
          else begin
            if (Traps == 2) then begin
              display_msg(message_str(305, 194));
            end
            else begin
              display_msg(message_str(305, 195));
            end
          end
        end
      end
      else begin
        if (Per == 2) then begin
          if (Traps == 0) then begin
            display_msg(message_str(305, 196));
          end
          else begin
            if (Traps == 1) then begin
              display_msg(message_str(305, 197));
            end
            else begin
              if (Traps == 2) then begin
                display_msg(message_str(305, 198));
              end
              else begin
                display_msg(message_str(305, 199));
              end
            end
          end
        end
        else begin
          if (Traps == 0) then begin
            display_msg(message_str(305, 200));
          end
          else begin
            if (Traps == 1) then begin
              display_msg(message_str(305, 201));
            end
            else begin
              if (Traps == 2) then begin
                display_msg(message_str(305, 202));
              end
              else begin
                display_msg(message_str(305, 203));
              end
            end
          end
        end
      end
    end
glowcage:
  start: |
    if (script_action == 3) then begin
      script_overrides;
      display_msg(message_str(310, 100));
    end
glowdesk:
  start: |
    if (script_action == 4) then begin
      if (local_var(0) == 0) then begin
        script_overrides;
        display_msg(message_str(331, 100));
      end
    end
    else begin
      if (script_action == 8) then begin
        if (action_being_used == 9) then begin
          if (is_success(roll_vs_skill(dude_obj, 9, 0))) then begin
            set_local_var(0, 1);
            display_msg(message_str(331, 101));
          end
          else begin
            display_msg(message_str(331, 102));
          end
        end
        else begin
          display_msg(message_str(331, 103));
        end
      end
    end
glowgen:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(301, 100));
  description_p_proc: |
    script_overrides;
    if (global_var(139) == 2) then begin
      display_msg(message_str(301, 101));
    end
    else begin
      display_msg(message_str(301, 102));
    end
  use_skill_on_p_proc: |
    if (action_being_used == 13) then begin
      script_overrides;
      if (has_skill(dude_obj, 13) > 35) then begin
        set_local_var(0, 0);
      end
      if (global_var(139) == 2) then begin
        display_msg(message_str(301, 103));
      end
      else begin
        if (local_var(0) == 0) then begin
          if (is_success(roll_vs_skill(dude_obj, 13, -10))) then begin
            display_msg(message_str(301, 104));
            set_global_var(139, 2);
            give_exp_points(1000);
            display_msg(message_str(766, 103) + "1000" + message_str(766, 104));
          end
          else begin
            if (has_skill(dude_obj, 13) < 35) then begin
              set_local_var(0, 1);
            end
            display_msg(message_str(301, 105));
            game_time_advance(game_ticks(1200));
          end
        end
        else begin
          if (local_var(0) == 1) then begin
            display_msg(message_str(301, 106));
          end
        end
      end
    end
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 75) then begin
      script_overrides;
      if (has_skill(dude_obj, 13) > 35) then begin
        set_local_var(0, 0);
      end
      if (global_var(139) == 2) then begin
        display_msg(message_str(301, 103));
      end
      else begin
        if (local_var(0) == 0) then begin
          if (is_success(roll_vs_skill(dude_obj, 13, 10))) then begin
            display_msg(message_str(301, 104));
            set_global_var(139, 2);
            display_msg(message_str(766, 103) + "1000" + message_str(766, 104));
            give_exp_points(1000);
          end
          else begin
            if (has_skill(dude_obj, 13) < 35) then begin
              set_local_var(0, 1);
            end
            display_msg(message_str(301, 105));
            game_time_advance(game_ticks(1200));
          end
        end
        else begin
          if (local_var(0) == 1) then begin
            display_msg(message_str(301, 106));
          end
        end
      end
    end
glowone:
  start: |
    variable LVar0 := 0;
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 31);
      critter_add_trait(self_obj, 1, 5, 93);
      init_teams := 1;
    end
    if (script_action == 11) then begin
      script_overrides;
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(76, 100));
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 13) then begin
            if (fixed_param == 2) then begin
              rndx := random(1, 6) - 5;
              if (rndx < 0) then begin
                rndx := 0;
              end
              if (rndx > 0) then begin
                radiation_inc(target_obj, rndx);
              end
            end
          end
          else begin
            if (script_action == 12) then begin
              if (Hostile) then begin
                Hostile := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
            end
            else begin
              if (script_action == 18) then begin
                if (source_obj == dude_obj) then begin
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                    set_global_var(156, 1);
                    set_global_var(157, 0);
                  end
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                    set_global_var(157, 1);
                    set_global_var(156, 0);
                  end
                  set_global_var(159, global_var(159) + 1);
                  if ((global_var(159) % 2) == 0) then begin
                    set_global_var(155, global_var(155) - 1);
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    rndx := random(1, 4);
    if (rndx == 1) then begin
      float_msg(self_obj, message_str(76, 101), 2);
    end
    if (rndx == 2) then begin
      float_msg(self_obj, message_str(76, 102), 2);
    end
    if (rndx == 3) then begin
      display_msg(message_str(76, 103));
    end
    if (rndx == 4) then begin
      display_msg(message_str(76, 104));
    end
glowpump:
  start: |
    if (script_action == 21) then begin
      script_overrides;
      display_msg(message_str(302, 100));
    end
    else begin
      if (script_action == 3) then begin
        script_overrides;
        display_msg(message_str(302, 101));
      end
      else begin
        if (script_action == 8) then begin
          if (action_being_used == 13) then begin
            script_overrides;
            display_msg(message_str(302, 102));
          end
        end
      end
    end
glowtabl:
  start: |
    if (script_action == 3) then begin
      script_overrides;
      display_msg(message_str(311, 100));
    end
gloyldor:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  use_p_proc: |
    variable LVar0 := 0;
    LVar0 := roll_vs_skill(source_obj, 11, -20);
    if (global_var(224) == 0) then begin
      script_overrides;
      display_msg(message_str(832, 205));
    end
    else begin
      if (local_var(2) == 0) then begin
        if (is_success(LVar0)) then begin
          script_overrides;
          display_msg(message_str(832, 204));
          reg_anim_func(2, source_obj);
        end
        else begin
          if (obj_is_locked(self_obj)) then begin
            script_overrides;
            set_local_var(0, local_var(0) + 1);
            call Damage_Dude;
          end
          else begin
            script_overrides;
            set_local_var(0, local_var(0) + 1);
            call Damage_Dude;
          end
        end
      end
      else begin
        if (local_var(3) == 0) then begin
          script_overrides;
          display_msg(message_str(832, 105));
        end
      end
    end
  use_skill_on_p_proc: |
    if ((local_var(2) == 0) and obj_is_locked(self_obj)) then begin
      call Trapped_And_Locked;
    end
    else begin
      if (local_var(2) == 0) then begin
        call Trapped_Door;
      end
      else begin
        if (obj_is_locked(self_obj)) then begin
          call Locked_Door;
        end
      end
    end
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    LVar0 := obj_pid(obj_being_used_with);
    if (LVar0 == 77) then begin
      script_overrides;
      if (local_var(2) == 0) then begin
        LVar1 := roll_vs_skill(source_obj, 11, -20);
        if (is_success(LVar1)) then begin
          display_msg(204);
          reg_anim_func(2, source_obj);
        end
        else begin
          set_local_var(0, local_var(0) + 1);
          call Damage_Dude;
        end
      end
      if (obj_is_locked(self_obj)) then begin
        LVar2 := roll_vs_skill(source_obj, 9, -10);
        if (is_success(LVar2)) then begin
          obj_unlock(self_obj);
          set_local_var(3, 1);
          display_msg(message_str(832, 109));
          display_msg(message_str(766, 103) + "55" + message_str(766, 104));
          give_exp_points(55);
        end
        else begin
          if (is_critical(LVar2)) then begin
            display_msg(message_str(832, 121));
            jam_lock(self_obj);
            display_msg(message_str(63, 110));
            rm_obj_from_inven(source_obj, LVar0);
            destroy_object(LVar0);
          end
          else begin
            display_msg(message_str(832, 122));
          end
        end
      end
    end
    else begin
      if (LVar0 == 223) then begin
        script_overrides;
        set_local_var(2, 1);
        obj_unlock(self_obj);
        set_local_var(3, 1);
        display_msg(message_str(832, 106));
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(832, 123));
  description_p_proc: |
    script_overrides;
    if ((local_var(3) == 0) and (local_var(2) == 0)) then begin
      call Skill_Checks;
      call Display_Armed_And_Locked;
    end
    else begin
      if (local_var(2) == 0) then begin
        call Skill_Checks;
        call Display_Trapped;
      end
      else begin
        if (local_var(3) == 0) then begin
          call Locks_Check;
          call Display_Locked;
        end
        else begin
          display_msg(message_str(832, 123));
        end
      end
    end
  damage_p_proc: |
    if (local_var(1) > 3) then begin
      set_local_var(2, 1);
      set_obj_visibility(self_obj, 1);
      obj_open(self_obj);
      set_local_var(3, 1);
    end
  map_enter_p_proc: |
    if (local_var(3) == 0) then begin
      obj_lock(self_obj);
    end
  map_update_p_proc: |
    if (local_var(3) == 0) then begin
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
  Trapped_And_Locked: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (action_being_used == 11) then begin
      script_overrides;
      LVar0 := roll_vs_skill(source_obj, 11, -20);
      if (is_success(LVar0)) then begin
        display_msg(message_str(832, 113));
        set_local_var(2, 1);
        display_msg(message_str(766, 103) + "45" + message_str(766, 104));
        give_exp_points(45);
      end
      else begin
        if (is_critical(LVar0)) then begin
          display_msg(message_str(832, 114));
          if (local_var(0) == 0) then begin
            set_local_var(0, 4);
          end
          else begin
            set_local_var(0, local_var(0) + 4);
          end
          call Damage_Dude;
        end
        else begin
          set_local_var(0, local_var(0) + 1);
          display_msg(message_str(832, 115));
          call Damage_Dude;
        end
      end
    end
    else begin
      if (action_being_used == 9) then begin
        script_overrides;
        LVar0 := roll_vs_skill(source_obj, 9, -30);
        LVar1 := roll_vs_skill(source_obj, 11, -20);
        if (is_success(LVar1)) then begin
          if (is_success(LVar0)) then begin
            obj_unlock(self_obj);
            set_local_var(3, 1);
            display_msg(message_str(832, 116));
            display_msg(message_str(766, 103) + "55" + message_str(766, 104));
            give_exp_points(55);
          end
          else begin
            if (is_critical(LVar0)) then begin
              set_local_var(0, local_var(0) + 2);
              display_msg(message_str(832, 117));
              jam_lock(self_obj);
              display_msg(message_str(832, 110));
              call Damage_Dude;
            end
            else begin
              set_local_var(0, local_var(0) + 1);
              display_msg(message_str(832, 118));
              call Damage_Dude;
            end
          end
        end
        else begin
          if (is_critical(LVar1)) then begin
            display_msg(message_str(832, 120));
            if (local_var(0) == 0) then begin
              set_local_var(0, 4);
            end
            else begin
              set_local_var(0, local_var(0) + 4);
            end
            call Damage_Dude;
          end
          else begin
            set_local_var(0, local_var(0) + 1);
            display_msg(message_str(832, 119));
            call Damage_Dude;
          end
        end
      end
    end
  Locked_Door: |
    variable LVar0 := 0;
    if (action_being_used == 9) then begin
      script_overrides;
      LVar0 := roll_vs_skill(source_obj, 9, -30);
      if (is_success(LVar0)) then begin
        obj_unlock(self_obj);
        set_local_var(3, 1);
        display_msg(message_str(832, 116));
      end
      else begin
        if (is_critical(LVar0)) then begin
          display_msg(message_str(832, 111));
          jam_lock(self_obj);
          display_msg(message_str(832, 110));
          game_time_advance(game_ticks(600));
        end
        else begin
          display_msg(message_str(832, 122));
        end
      end
    end
  Trapped_Door: |
    variable LVar0 := 0;
    if (action_being_used == 11) then begin
      script_overrides;
      LVar0 := roll_vs_skill(source_obj, 11, -20);
      if (is_success(LVar0)) then begin
        display_msg(message_str(832, 113));
        set_local_var(2, 1);
      end
      else begin
        if (is_critical(LVar0)) then begin
          display_msg(message_str(832, 114));
          if (local_var(0) == 0) then begin
            set_local_var(0, 4);
          end
          else begin
            set_local_var(0, local_var(0) + 4);
          end
          call Damage_Dude;
        end
        else begin
          set_local_var(0, local_var(0) + 1);
          display_msg(message_str(832, 115));
          call Damage_Dude;
        end
      end
    end
  Damage_Dude: |
    critter_dmg(source_obj, local_var(0), 4 bwor 256);
    if (local_var(0) == 1) then begin
      display_msg(message_str(832, 101));
    end
    else begin
      display_msg(message_str(832, 102) + local_var(0) + message_str(832, 103));
    end
  Skill_Checks: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    LVar0 := roll_vs_skill(source_obj, 11, 0);
    LVar1 := roll_vs_skill(source_obj, 9, -10);
    LVar2 := do_check(source_obj, 1, 0);
    if (is_success(LVar0)) then begin
      if (is_critical(LVar0)) then begin
        call Locks_Check;
        Traps := 3;
      end
      else begin
        call Locks_Check;
        Traps := 2;
      end
    end
    else begin
      if (is_critical(LVar0)) then begin
        call Locks_Check;
        Traps := 0;
      end
      else begin
        call Locks_Check;
        Traps := 1;
      end
    end
  Stat_Checks: |
    variable LVar0 := 0;
    LVar0 := do_check(source_obj, 1, 0);
    if (is_success(LVar0)) then begin
      if (is_critical(LVar0)) then begin
        Per := 3;
      end
      else begin
        Per := 2;
      end
    end
    else begin
      if (is_critical(LVar0)) then begin
        Per := 0;
      end
      else begin
        Per := 1;
      end
    end
  Locks_Check: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := roll_vs_skill(source_obj, 9, -10);
    LVar1 := do_check(source_obj, 1, 0);
    if (is_success(LVar0)) then begin
      if (is_critical(LVar0)) then begin
        call Stat_Checks;
        Locks := 3;
      end
      else begin
        call Stat_Checks;
        Locks := 2;
      end
    end
    else begin
      if (is_critical(LVar0)) then begin
        call Stat_Checks;
        Locks := 0;
      end
      else begin
        call Stat_Checks;
        Locks := 1;
      end
    end
  Display_Armed_And_Locked: |
    if (Per == 0) then begin
      if (Locks == 0) then begin
        if (Traps == 0) then begin
          display_msg(message_str(832, 124));
        end
        else begin
          if (Traps == 1) then begin
            display_msg(message_str(832, 125));
          end
          else begin
            if (Traps == 2) then begin
              display_msg(message_str(832, 126));
            end
            else begin
              display_msg(message_str(832, 127));
            end
          end
        end
      end
      else begin
        if (Locks == 1) then begin
          if (Traps == 0) then begin
            display_msg(message_str(832, 128));
          end
          else begin
            if (Traps == 1) then begin
              display_msg(message_str(832, 129));
            end
            else begin
              if (Traps == 2) then begin
                display_msg(message_str(832, 130));
              end
              else begin
                display_msg(message_str(832, 131));
              end
            end
          end
        end
        else begin
          if (Locks == 2) then begin
            if (Traps == 0) then begin
              display_msg(message_str(832, 132));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(832, 133));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(832, 134));
                end
                else begin
                  display_msg(message_str(832, 135));
                end
              end
            end
          end
          else begin
            if (Traps == 0) then begin
              display_msg(message_str(832, 136));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(832, 137));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(832, 138));
                end
                else begin
                  display_msg(message_str(832, 139));
                end
              end
            end
          end
        end
      end
    end
    else begin
      if (Per == 1) then begin
        if (Locks == 0) then begin
          if (Traps == 0) then begin
            display_msg(message_str(832, 140));
          end
          else begin
            if (Traps == 1) then begin
              display_msg(message_str(832, 141));
            end
            else begin
              if (Traps == 2) then begin
                display_msg(message_str(832, 142));
              end
              else begin
                display_msg(message_str(832, 143));
              end
            end
          end
        end
        else begin
          if (Locks == 1) then begin
            if (Traps == 0) then begin
              display_msg(message_str(832, 144));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(832, 145));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(832, 146));
                end
                else begin
                  display_msg(message_str(832, 147));
                end
              end
            end
          end
          else begin
            if (Locks == 2) then begin
              if (Traps == 0) then begin
                display_msg(message_str(832, 148));
              end
              else begin
                if (Traps == 1) then begin
                  display_msg(message_str(832, 149));
                end
                else begin
                  if (Traps == 2) then begin
                    display_msg(message_str(832, 150));
                  end
                  else begin
                    display_msg(message_str(832, 151));
                  end
                end
              end
            end
            else begin
              if (Traps == 0) then begin
                display_msg(message_str(832, 152));
              end
              else begin
                if (Traps == 1) then begin
                  display_msg(message_str(832, 153));
                end
                else begin
                  if (Traps == 2) then begin
                    display_msg(message_str(832, 154));
                  end
                  else begin
                    display_msg(message_str(832, 155));
                  end
                end
              end
            end
          end
        end
      end
      else begin
        if (Per == 2) then begin
          if (Locks == 0) then begin
            if (Traps == 0) then begin
              display_msg(message_str(832, 156));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(832, 157));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(832, 158));
                end
                else begin
                  display_msg(message_str(832, 159));
                end
              end
            end
          end
          else begin
            if (Locks == 1) then begin
              if (Traps == 0) then begin
                display_msg(message_str(832, 160));
              end
              else begin
                if (Traps == 1) then begin
                  display_msg(message_str(832, 161));
                end
                else begin
                  if (Traps == 2) then begin
                    display_msg(message_str(832, 162));
                  end
                  else begin
                    display_msg(message_str(832, 163));
                  end
                end
              end
            end
            else begin
              if (Locks == 2) then begin
                if (Traps == 0) then begin
                  display_msg(message_str(832, 164));
                end
                else begin
                  if (Traps == 1) then begin
                    display_msg(message_str(832, 165));
                  end
                  else begin
                    if (Traps == 2) then begin
                      display_msg(message_str(832, 166));
                    end
                    else begin
                      display_msg(message_str(832, 167));
                    end
                  end
                end
              end
              else begin
                if (Traps == 0) then begin
                  display_msg(message_str(832, 168));
                end
                else begin
                  if (Traps == 1) then begin
                    display_msg(message_str(832, 169));
                  end
                  else begin
                    if (Traps == 2) then begin
                      display_msg(message_str(832, 170));
                    end
                    else begin
                      display_msg(message_str(832, 171));
                    end
                  end
                end
              end
            end
          end
        end
        else begin
          if (Locks == 0) then begin
            if (Traps == 0) then begin
              display_msg(message_str(832, 172));
            end
            else begin
              if (Traps == 1) then begin
                display_msg(message_str(832, 173));
              end
              else begin
                if (Traps == 2) then begin
                  display_msg(message_str(832, 174));
                end
                else begin
                  display_msg(message_str(832, 175));
                end
              end
            end
          end
          else begin
            if (Locks == 1) then begin
              if (Traps == 0) then begin
                display_msg(message_str(832, 176));
              end
              else begin
                if (Traps == 1) then begin
                  display_msg(message_str(832, 177));
                end
                else begin
                  if (Traps == 2) then begin
                    display_msg(message_str(832, 178));
                  end
                  else begin
                    display_msg(message_str(832, 179));
                  end
                end
              end
            end
            else begin
              if (Locks == 2) then begin
                if (Traps == 0) then begin
                  display_msg(message_str(832, 180));
                end
                else begin
                  if (Traps == 1) then begin
                    display_msg(message_str(832, 181));
                  end
                  else begin
                    if (Traps == 2) then begin
                      display_msg(message_str(832, 182));
                    end
                    else begin
                      display_msg(message_str(832, 183));
                    end
                  end
                end
              end
              else begin
                if (Traps == 0) then begin
                  display_msg(message_str(832, 184));
                end
                else begin
                  if (Traps == 1) then begin
                    display_msg(message_str(832, 185));
                  end
                  else begin
                    if (Traps == 2) then begin
                      display_msg(message_str(832, 186));
                    end
                    else begin
                      display_msg(message_str(832, 187));
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  Display_Locked: |
    if (Per == 0) then begin
      if (Locks == 0) then begin
        display_msg(message_str(832, 124));
      end
      else begin
        if (Locks == 1) then begin
          display_msg(message_str(832, 128));
        end
        else begin
          if (Locks == 2) then begin
            display_msg(message_str(832, 132));
          end
          else begin
            display_msg(message_str(832, 136));
          end
        end
      end
    end
    else begin
      if (Per == 1) then begin
        if (Locks == 0) then begin
          display_msg(message_str(832, 140));
        end
        else begin
          if (Locks == 1) then begin
            display_msg(message_str(832, 144));
          end
          else begin
            if (Locks == 2) then begin
              display_msg(message_str(832, 148));
            end
            else begin
              display_msg(message_str(832, 152));
            end
          end
        end
      end
      else begin
        if (Per == 2) then begin
          if (Locks == 0) then begin
            display_msg(message_str(832, 156));
          end
          else begin
            if (Locks == 1) then begin
              display_msg(message_str(832, 160));
            end
            else begin
              if (Locks == 2) then begin
                display_msg(message_str(832, 164));
              end
              else begin
                display_msg(message_str(832, 168));
              end
            end
          end
        end
        else begin
          if (Locks == 0) then begin
            display_msg(message_str(832, 172));
          end
          else begin
            if (Locks == 1) then begin
              display_msg(message_str(832, 176));
            end
            else begin
              if (Locks == 2) then begin
                display_msg(message_str(832, 180));
              end
              else begin
                display_msg(message_str(832, 184));
              end
            end
          end
        end
      end
    end
  Display_Trapped: |
    if (Per == 0) then begin
      if (Traps == 0) then begin
        display_msg(message_str(832, 188));
      end
      else begin
        if (Traps == 1) then begin
          display_msg(message_str(832, 189));
        end
        else begin
          if (Traps == 2) then begin
            display_msg(message_str(832, 190));
          end
          else begin
            display_msg(message_str(832, 191));
          end
        end
      end
    end
    else begin
      if (Per == 1) then begin
        if (Traps == 0) then begin
          display_msg(message_str(832, 192));
        end
        else begin
          if (Traps == 1) then begin
            display_msg(message_str(832, 193));
          end
          else begin
            if (Traps == 2) then begin
              display_msg(message_str(832, 194));
            end
            else begin
              display_msg(message_str(832, 195));
            end
          end
        end
      end
      else begin
        if (Per == 2) then begin
          if (Traps == 0) then begin
            display_msg(message_str(832, 196));
          end
          else begin
            if (Traps == 1) then begin
              display_msg(message_str(832, 197));
            end
            else begin
              if (Traps == 2) then begin
                display_msg(message_str(832, 198));
              end
              else begin
                display_msg(message_str(832, 199));
              end
            end
          end
        end
        else begin
          if (Traps == 0) then begin
            display_msg(message_str(832, 200));
          end
          else begin
            if (Traps == 1) then begin
              display_msg(message_str(832, 201));
            end
            else begin
              if (Traps == 2) then begin
                display_msg(message_str(832, 202));
              end
              else begin
                display_msg(message_str(832, 203));
              end
            end
          end
        end
      end
    end
glwalien:
  start: |
    if (script_action == 3) then begin
      script_overrides;
      if (success_level == 0) then begin
        success_level := roll_vs_skill(dude_obj, 7, 0);
      end
      call dead00;
    end
    else begin
      if (script_action == 21) then begin
        script_overrides;
        display_msg(message_str(313, 100));
      end
    end
  dead00: |
    if (is_success(success_level)) then begin
      if (is_critical(success_level)) then begin
        display_msg(message_str(313, 101));
      end
      else begin
        display_msg(message_str(313, 102));
      end
    end
    else begin
      if (is_critical(success_level)) then begin
        display_msg(message_str(313, 103));
      end
      else begin
        display_msg(message_str(313, 104));
      end
    end
glwbox:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(308, 100));
    end
    else begin
      if (script_action == 7) then begin
        if (obj_being_used_with == 84) then begin
          if (is_success(roll_vs_skill(dude_obj, 9, 0))) then begin
            set_local_var(0, 1);
            display_msg(message_str(308, 101));
          end
          else begin
            display_msg(message_str(308, 102));
          end
        end
        else begin
          display_msg(message_str(308, 103));
        end
      end
      else begin
        if (script_action == 6) then begin
          if (local_var(0) == 0) then begin
            script_overrides;
            display_msg(message_str(308, 104));
          end
        end
        else begin
          if (script_action == 8) then begin
            script_overrides;
            if (action_being_used == 9) then begin
              if (is_success(roll_vs_skill(dude_obj, 9, -15))) then begin
                set_local_var(0, 1);
                display_msg(message_str(308, 105));
              end
              else begin
                display_msg(message_str(308, 106));
              end
            end
            else begin
              display_msg(message_str(308, 107));
            end
          end
        end
      end
    end
goodslot:
  start: |
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 15) then begin
        call map_enter_p_proc;
      end
      else begin
        if (script_action == 6) then begin
          call use_p_proc;
        end
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(355, 100));
  map_enter_p_proc: |
    if (global_var(38) == 1) then begin
      destroy_object(self_obj);
    end
  use_p_proc: |
    script_overrides;
    if (item_caps_total(dude_obj) < 20) then begin
      display_msg(message_str(355, 108));
    end
    else begin
      display_msg(message_str(355, 101));
      item_caps_adjust(dude_obj, -20);
      bonus := random(1, 50) - random(20, 50);
      test := roll_vs_skill(dude_obj, 16, bonus);
      if (is_success(test)) then begin
        if (is_critical(test)) then begin
          rndx := random(30, 40);
          float_msg(self_obj, message_str(355, 102), 0);
          display_msg(message_str(355, 103) + rndx + message_str(355, 104));
        end
        else begin
          float_msg(self_obj, message_str(355, 105), 0);
          display_msg(message_str(355, 106));
          rndx := 30;
        end
        item_caps_adjust(dude_obj, rndx);
      end
      else begin
        display_msg(message_str(355, 107));
      end
    end
gpwrterm:
  start: "[]"
  use_p_proc: |
    script_overrides;
    dialogue_system_enter;
  talk_p_proc: |
    start_gdialog(828, self_obj, 4, -1, -1);
    gsay_start;
    if (global_var(224) == 0) then begin
      call Term14;
    end
    else begin
      if (global_var(224) == 1) then begin
        call Term01;
      end
      else begin
        call Term09;
      end
    end
    gsay_end;
    end_dialogue;
  use_skill_on_p_proc: |
    if (action_being_used == 12) then begin
      script_overrides;
      dialogue_system_enter;
    end
  Term01: |
    gsay_reply(828, 100);
    giq_option(4, 828, 101, Term02, 50);
    giq_option(-3, 828, 102, Term10, 50);
    giq_option(0, 828, 103, TermEnd, 50);
  Term02: |
    gsay_reply(828, 104);
    giq_option(4, 828, 105, Term03, 50);
    giq_option(4, 828, 106, Term06, 50);
    giq_option(4, 828, 107, Term01, 50);
  Term03: |
    gsay_reply(828, 108);
    giq_option(4, 828, 109, Term03a, 50);
    giq_option(4, 828, 110, Term02, 50);
  Term03a: |
    if (global_var(139) != 2) then begin
      call Term04;
    end
    else begin
      set_global_var(224, 2);
    end
  Term04: |
    gsay_reply(828, 111);
    giq_option(8, 828, 112, Term05, 50);
    giq_option(4, 828, 113, Term02, 50);
  Term05: |
    gsay_reply(828, 114);
    giq_option(4, 828, 115, Term02, 50);
  Term06: |
    gsay_reply(828, 116);
    giq_option(4, 828, 117, Term06a, 50);
    giq_option(4, 828, 118, Term02, 50);
  Term06a: 'set_global_var(224, 0);

    '
  Term09: |
    gsay_reply(828, 125);
    giq_option(-3, 828, 126, Term09a, 50);
    giq_option(4, 828, 127, Term09a, 50);
    giq_option(0, 828, 128, TermEnd, 50);
  Term09a: 'set_global_var(224, 1);

    '
  Term10: |
    gsay_reply(828, 129);
    giq_option(-3, 828, 130, Term11, 50);
    giq_option(-3, 828, 131, Term13, 50);
    giq_option(-3, 828, 132, Term01, 50);
  Term11: |
    gsay_reply(828, 133);
    giq_option(-3, 828, 134, Term11a, 50);
    giq_option(-3, 828, 135, Term10, 50);
  Term11a: |
    if (global_var(139) != 2) then begin
      call Term12;
    end
    else begin
      set_global_var(224, 2);
    end
  Term12: |
    gsay_reply(828, 136);
    giq_option(-3, 828, 137, Term10, 50);
  Term13: |
    gsay_reply(828, 138);
    giq_option(-3, 828, 148, Term06a, 50);
    giq_option(-3, 828, 137, Term10, 50);
  Term14: |
    gsay_reply(828, 139);
    giq_option(4, 828, 140, Term14a, 50);
    giq_option(-3, 828, 141, Term15, 50);
    giq_option(-3, 828, 142, Term15, 50);
    giq_option(-3, 828, 143, Term14a, 50);
    giq_option(-3, 828, 144, Term15, 50);
    giq_option(0, 828, 145, TermEnd, 50);
  Term14a: |
    set_global_var(224, 1);
    if (global_var(139) == 2) then begin
      call Term01;
    end
  Term15: |
    gsay_reply(828, 146);
    giq_option(0, 828, 147, TermEnd, 50);
  TermEnd: "[]"
graffiti:
  start: |
    if (script_action == 2) then begin
      if (obj_type(source_obj) == dude_obj) then begin
        if (not(HEREBEFORE)) then begin
          HEREBEFORE := 1;
          display_msg(message_str(91, 100));
        end
      end
    end
gretch:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 19);
      initialized := 1;
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (messing_with_Morbid_stuff) then begin
        if ((tile_distance_objs(self_obj, dude_obj) < 12) and (elevation(self_obj) == elevation(dude_obj))) then begin
          if (warned_about_messing) then begin
            hostile := 1;
          end
          else begin
            warned_about_messing := 1;
            float_msg(self_obj, message_str(103, 141), 2);
          end
        end
        messing_with_Morbid_stuff := 0;
      end
      if (Gretch_call) then begin
        Gretch_call := 0;
        hostile := 1;
      end
    end
    if (global_var(346) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(346, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  pickup_p_proc: 'hostile := 1;

    '
  look_at_p_proc: |
    script_overrides;
    if (local_var(0) == 0) then begin
      display_msg(message_str(103, 100));
    end
    else begin
      display_msg(message_str(103, 101));
    end
  talk_p_proc: |
    start_gdialog(103, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(0) == 1) then begin
      call Gretch01;
    end
    else begin
      call Gretch00;
    end
    gsay_end;
    end_dialogue;
  timed_event_p_proc: "[]"
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(346, 1);
    end
  Gretch00: |
    gsay_reply(103, 102);
    giq_option(-3, 103, 103, Gretch07, 50);
    giq_option(4, 103, 104, Gretch00a, 50);
    giq_option(4, 103, 105, Gretch00b, 51);
    giq_option(4, 103, 106, Gretch02, 50);
    giq_option(4, 103, 107, GretchEnd, 50);
  Gretch00a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Gretch04;
    end
    else begin
      call Gretch02;
    end
  Gretch00b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Gretch02;
    end
    else begin
      call Gretch08;
    end
  Gretch01: |
    gsay_reply(103, 108);
    giq_option(4, 103, 109, Gretch02, 50);
    giq_option(4, 103, 110, Gretch01a, 50);
    giq_option(4, 103, 111, GretchEnd, 50);
    giq_option(-3, 103, 103, Gretch07, 50);
  Gretch01a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Gretch05;
    end
    else begin
      call Gretch02;
    end
  Gretch02: |
    gsay_reply(103, 112);
    giq_option(4, 103, 113, Gretch04, 50);
    giq_option(4, 103, 114, Gretch03, 50);
    giq_option(4, 103, 115, Gretch02a, 50);
  Gretch02a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Gretch03;
    end
    else begin
      call Gretch07;
    end
  Gretch03: |
    gsay_reply(103, 116);
    giq_option(4, 103, 117, Gretch04, 50);
    giq_option(4, 103, 118, Gretch03a, 50);
    giq_option(4, 103, 119, GretchEnd, 50);
  Gretch03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Gretch05;
    end
    else begin
      call Gretch04;
    end
  Gretch04: |
    gsay_reply(103, 120);
    giq_option(4, 103, 121, Gretch06, 50);
    giq_option(4, 103, 122, Gretch05, 50);
    giq_option(4, 103, 123, GretchEnd, 50);
  Gretch05: |
    set_global_var(305, 1);
    gsay_reply(103, 124);
    giq_option(4, 103, 125, Gretch05a, 50);
    giq_option(4, 103, 126, GretchCombat, 51);
    giq_option(4, 103, 127, GretchEnd, 50);
  Gretch05a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Gretch09;
    end
    else begin
      call Gretch06;
    end
  Gretch06: |
    set_global_var(305, 1);
    gsay_reply(103, 128);
    giq_option(4, 103, 129, GretchEnd, 50);
    giq_option(4, 103, 130, Gretch09, 50);
    giq_option(4, 103, 131, Gretch07, 50);
  Gretch07: |
    gsay_reply(103, 132);
    giq_option(4, 103, 133, GretchEnd, 50);
    giq_option(4, 103, 134, Gretch04, 50);
    giq_option(4, 103, 135, Gretch08, 51);
    giq_option(-3, 103, 136, Gretch10, 50);
  Gretch08: 'gsay_message(103, 137, 51);

    '
  Gretch09: |
    gsay_reply(103, 138);
    giq_option(4, 103, 139, GretchEnd, 50);
    giq_option(4, 103, 126, GretchCombat, 51);
  Gretch10: 'gsay_message(103, 140, 50);

    '
  GretchEnd: "[]"
  GretchCombat: 'hostile := 1;

    '
groundr:
  start: |
    if (not(init)) then begin
      if (local_var(6) == 0) then begin
        set_local_var(6, tile_num(self_obj));
        set_local_var(5, 1);
      end
      critter_add_trait(self_obj, 1, 6, 31);
      critter_add_trait(self_obj, 1, 5, 40);
      init := 1;
    end
    if (script_action == 22) then begin
      call timetomove;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(77, 100));
      end
      else begin
        if (script_action == 11) then begin
          call do_dialogue;
        end
        else begin
          if (script_action == 4) then begin
            Hostile := 1;
          end
          else begin
            if (script_action == 12) then begin
              call Critter_Action;
            end
            else begin
              if (script_action == 18) then begin
                if (source_obj == dude_obj) then begin
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                    set_global_var(156, 1);
                    set_global_var(157, 0);
                  end
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                    set_global_var(157, 1);
                    set_global_var(156, 0);
                  end
                  set_global_var(159, global_var(159) + 1);
                  if ((global_var(159) % 2) == 0) then begin
                    set_global_var(155, global_var(155) - 1);
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    if (local_var(1) < 2) then begin
      call groundr01;
    end
    else begin
      call groundr00;
    end
  groundr00: 'float_msg(self_obj, message_str(77, random(101, 104)), 0);

    '
  groundr01: 'float_msg(self_obj, message_str(77, random(105, 107)), 0);

    '
  Critter_Action: |
    if (Hostile > 0) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(5)) then begin
        loopcount := loopcount + 1;
        if (loopcount > 40) then begin
          loopcount := 0;
          if (noevent == 0) then begin
            noevent := 1;
            add_timer_event(self_obj, game_ticks(random(5, 13)), 0);
          end
        end
      end
    end
  timetomove: |
    noevent := 0;
    set_local_var(7, tile_num(self_obj));
    new_tile := tile_num_in_direction(local_var(7), random(0, 5), 2);
    if (tile_distance(local_var(6), new_tile) < maxleash) then begin
      animate_move_obj_to_tile(self_obj, new_tile, 0);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
  set_sleep_tile: |
    if (local_var(6) == 21943) then begin
      sleep_tile := 21143;
    end
    else begin
      if (local_var(6) == 21541) then begin
        sleep_tile := 20537;
      end
      else begin
        if (local_var(6) == 21740) then begin
          sleep_tile := 20735;
        end
      end
    end
guard:
  start: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    variable LVar3 := 0;
    variable LVar4 := 0;
    if (script_action == 11) then begin
      call do_dialogue;
    end
  do_dialogue: |
    start_gdialog(7, self_obj, 4, -1, -1);
    rndx := random(0, 6);
    if (rndx == 0) then begin
      sayMessage(0, message_str(7, 102));
    end
    if (rndx == 1) then begin
      sayMessage(0, message_str(7, 103));
    end
    if (rndx == 2) then begin
      sayMessage(0, message_str(7, 104));
    end
    if (rndx == 3) then begin
      sayMessage(0, message_str(7, 105));
    end
    if (rndx == 4) then begin
      sayMessage(0, message_str(7, 106));
    end
    if (rndx == 5) then begin
      sayMessage(0, message_str(7, 107));
    end
    if (rndx == 6) then begin
      sayMessage(0, message_str(7, 108));
    end
    end_dialogue;
guard2:
  start: |
    if (Only_once) then begin
      Only_once := 0;
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 78);
      if (global_var(227) == 1) then begin
        active := 1;
        set_obj_visibility(self_obj, 0);
      end
      else begin
        set_obj_visibility(self_obj, 1);
      end
    end
    if (active) then begin
      if (script_action == 11) then begin
        if (global_var(31) == 2) then begin
          float_msg(self_obj, message_str(535, 102), 8);
        end
        else begin
          float_msg(self_obj, message_str(535, 101), 8);
        end
      end
      else begin
        if (script_action == 14) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            if (global_var(249) and obj_can_see_obj(self_obj, dude_obj)) then begin
              Hostile := 1;
            end
            if (Hostile) then begin
              Hostile := 0;
              set_global_var(227, 0);
              set_global_var(249, 1);
              attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
            end
            else begin
              if (global_var(31) != 2) then begin
                if (tile_distance_objs(self_obj, dude_obj) > 7) then begin
                  Hostile := 1;
                end
                else begin
                  if ((tile_distance_objs(self_obj, dude_obj) > 4) and oktoyell) then begin
                    oktoyell := 0;
                    float_msg(self_obj, message_str(535, 103), 8);
                  end
                  else begin
                    if (tile_distance_objs(self_obj, dude_obj) < 5) then begin
                      oktoyell := 1;
                    end
                  end
                end
              end
            end
          end
          else begin
            if (script_action == 4) then begin
              Hostile := 1;
            end
            else begin
              if (script_action == 21) then begin
                script_overrides;
                display_msg(message_str(535, 100));
              end
              else begin
                if (script_action == 18) then begin
                  set_global_var(607, 3);
                  set_global_var(227, 0);
                  set_global_var(249, 1);
                  if (source_obj == dude_obj) then begin
                    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                      set_global_var(156, 1);
                      set_global_var(157, 0);
                    end
                    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                      set_global_var(157, 1);
                      set_global_var(156, 0);
                    end
                    set_global_var(160, global_var(160) + 1);
                    if ((global_var(160) % 6) == 0) then begin
                      set_global_var(155, global_var(155) + 1);
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
guardemo:
  start: |
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if (script_action == 12) then begin
        call weapon_check;
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          if ((global_var(142) == 0) and armed and not(Scared) and not(Checked)) then begin
            Checked := 1;
            dialogue_system_enter;
          end
        end
        if (hostile) then begin
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
      end
      else begin
        if (script_action == 22) then begin
          if (fixed_param == 1) then begin
            if (obj_can_see_obj(self_obj, dude_obj)) then begin
              call weapon_check;
              if (armed) then begin
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
            end
            else begin
              if (script_action == 18) then begin
                give_exp_points(150);
                display_msg(message_str(221, 123));
              end
              else begin
                if ((script_action == 21) or 3) then begin
                  script_overrides;
                  display_msg(message_str(221, 100));
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    if ((global_var(142) == 0) and armed and not(Scared)) then begin
      set_global_var(142, 1);
      start_gdialog(221, self_obj, 4, -1, -1);
      sayStart;
      call guard00;
      sayEnd;
      end_dialogue;
      add_timer_event(self_obj, game_ticks(5), 1);
    end
    else begin
      call guard02a;
    end
  guard02a: |
    rndx := random(1, 3);
    if (rndx == 1) then begin
      float_msg(self_obj, message_str(221, 101), 0);
    end
    else begin
      if (rndx == 2) then begin
        float_msg(self_obj, message_str(221, 102), 0);
      end
      else begin
        if (rndx == 3) then begin
          float_msg(self_obj, message_str(221, 103), 0);
        end
      end
    end
  guard02b: |
    sayReply(0, message_str(221, 114));
    if (get_critter_stat(dude_obj, 2) >= 4) then begin
      sayOption(message_str(221, 115), guardend);
    end
    if (get_critter_stat(dude_obj, 2) >= 4) then begin
      sayOption(message_str(221, 116), guard02i);
    end
  guard00: |
    sayReply(0, message_str(221, 104));
    if (get_critter_stat(dude_obj, 2) >= 4) then begin
      sayOption(message_str(221, 105), guard01);
    end
    if (get_critter_stat(dude_obj, 2) >= 4) then begin
      sayOption(message_str(221, 106), guard00i);
    end
    if (get_critter_stat(dude_obj, 2) >= 5) then begin
      sayOption(message_str(221, 107), guard00ii);
    end
    if (-get_critter_stat(dude_obj, 2) >= -3) then begin
      sayOption(message_str(221, 108), guard05);
    end
  guard00i: |
    call DownReact;
    call guard02;
  guard00ii: |
    call UpReact;
    call guard04;
  guard01: |
    sayReply(0, message_str(221, 109));
    if (get_critter_stat(dude_obj, 2) >= 4) then begin
      sayOption(message_str(221, 110), guard02);
    end
    if (get_critter_stat(dude_obj, 2) >= 4) then begin
      sayOption(message_str(221, 111), guard01i);
    end
  guard01i: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call guard03;
    end
    else begin
      call guard02;
    end
  guard02: |
    sayReply(0, message_str(221, 112));
    if (get_critter_stat(dude_obj, 2) >= 0) then begin
      sayOption(message_str(221, 113), guard02b);
    end
  guard02i: 'hostile := 1;

    '
  guard03: |
    sayReply(0, message_str(221, 117));
    if (get_critter_stat(dude_obj, 2) >= 0) then begin
      sayOption(message_str(221, 118), guardend);
    end
    Scared := 1;
  guard04: |
    sayReply(0, message_str(221, 119));
    if (get_critter_stat(dude_obj, 2) >= 0) then begin
      sayOption(message_str(221, 120), guardend);
    end
  guard05: |
    sayReply(0, message_str(221, 121));
    if (get_critter_stat(dude_obj, 2) >= 0) then begin
      sayOption(message_str(221, 122), guardend);
    end
  guardend: "[]"
  weapon_check: |
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      armed := 1;
    end
    else begin
      armed := 0;
    end
  ReactToLevel: |
    if (reaction < 24) then begin
      reaction_level := 1;
    end
    else begin
      if (reaction < 74) then begin
        reaction_level := 2;
      end
      else begin
        reaction_level := 3;
      end
    end
  LevelToReact: |
    if (reaction_level == 1) then begin
      reaction := random(1, 24);
    end
    else begin
      if (reaction_level == 2) then begin
        reaction := random(25, 74);
      end
      else begin
        reaction := random(75, 100);
      end
    end
  ModReact: |
    Talk := roll_vs_skill(dude_obj, 14, 0);
    if (action_being_used == 14) then begin
      if (is_success(Talk)) then begin
        reaction_level := reaction_level + 1;
      end
    end
    call LevelToReact;
  UpReact: |
    reaction := reaction + 10;
    call ReactToLevel;
  DownReact: |
    reaction := reaction - 10;
    call ReactToLevel;
  BottomReact: |
    reaction_level := 1;
    reaction := 1;
  TopReact: |
    reaction := 100;
    reaction_level := 3;
  BigUpReact: |
    reaction := reaction + 25;
    call ReactToLevel;
  BigDownReact: |
    reaction := reaction - 25;
    call ReactToLevel;
  UpReactLevel: |
    reaction_level := reaction_level + 1;
    if (reaction_level > 3) then begin
      reaction_level := 3;
    end
    call LevelToReact;
  DownReactLevel: |
    reaction_level := reaction_level - 1;
    if (reaction_level < 1) then begin
      reaction_level := 1;
    end
    call LevelToReact;
  Goodbyes: |
    variable LVar0 := 0;
    LVar0 := random(1, 6);
    if (LVar0 == 1) then begin
      exit_line := "Thanks, bye.";
    end
    if (LVar0 == 2) then begin
      exit_line := "Okay, thanks.";
    end
    if (LVar0 == 3) then begin
      exit_line := "Hmm. Bye.";
    end
    if (LVar0 == 4) then begin
      exit_line := "See ya.";
    end
    if (LVar0 == 5) then begin
      exit_line := "Thanks.";
    end
    if (LVar0 == 6) then begin
      exit_line := "Okay, bye.";
    end
guido:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(576, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (map_var(16) == 0) then begin
      set_map_var(16, 1);
      call Guido00;
    end
    else begin
      call Guido01;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      call Guido02;
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      Guido_Ptr := self_obj;
      critter_add_trait(self_obj, 1, 6, 73);
      critter_add_trait(self_obj, 1, 5, 4);
    end
  Guido00: |
    float_msg(self_obj, message_str(576, 101), 2);
    float_msg(Leon_Ptr, message_str(596, 105), 3);
    add_timer_event(self_obj, game_ticks(3), 1);
    add_timer_event(Leon_Ptr, game_ticks(3), 1);
  Guido01: 'float_msg(self_obj, message_str(576, 104), 2);

    '
  Guido02: |
    float_msg(self_obj, message_str(576, 102), 2);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      float_msg(Leon_Ptr, message_str(596, 102), 3);
    end
    else begin
      float_msg(Leon_Ptr, message_str(596, 103), 3);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
guncache:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
    end
  map_enter_p_proc: 'Locker_Ptr := self_obj;

    '
  map_update_p_proc: 'Locker_Ptr := self_obj;

    '
gunrnr:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(10, 116));
  talk_p_proc: |
    if (global_var(617) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      float_msg(self_obj, message_str(10, random(100, 115)), 0);
    end
  critter_p_proc: |
    variable LVar0 := 0;
    LVar0 := global_var(342);
    if ((((game_time / 10) - LVar0) >= 10) and (tile_distance_objs(self_obj, dude_obj) <= 4) and (global_var(617) == 0)) then begin
      float_msg(self_obj, message_str(10, random(100, 115)), 0);
      LVar0 := game_time / 10;
      set_global_var(342, LVar0);
    end
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(617) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(617, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(617, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  pickup_p_proc: 'set_global_var(617, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      if (obj_is_carrying_obj_pid(self_obj, 41) == 0) then begin
        item_caps_adjust(self_obj, random(2, 20));
      end
      critter_add_trait(self_obj, 1, 6, 48);
      critter_add_trait(self_obj, 1, 5, 28);
      Initialize := 0;
    end
    if ((global_var(265) == 2) and (days_since_visited > 1)) then begin
      set_obj_visibility(self_obj, 1);
      move_to(self_obj, 3846, 1);
    end
gunther:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 41);
      critter_add_trait(self_obj, 1, 5, 51);
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    set_local_var(4, 1);
    start_gdialog(841, self_obj, 4, -1, -1);
    gsay_start;
    call Gunther00;
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(841, 100));
  Gunther00: |
    gsay_reply(841, 102);
    call Gunther01;
  Gunther01: |
    giq_option(4, 841, 103, Gunther03, 50);
    giq_option(4, 841, 104, Gunther06, 50);
    giq_option(4, 841, 105, Gunther09, 50);
    giq_option(4, 841, 106, Gunther10, 50);
    giq_option(4, 841, 112, GuntherEnd, 50);
    giq_option(-3, 841, 122, Gunther11, 50);
  Gunther02: |
    gsay_reply(841, 107);
    call Gunther01;
  Gunther03: |
    gsay_reply(841, 108);
    giq_option(4, 841, 109, Gunther04, 50);
    giq_option(4, 841, 110, Gunther05, 50);
    giq_option(4, 841, 111, Gunther02, 50);
    giq_option(4, 841, 112, GuntherEnd, 50);
  Gunther04: |
    gsay_reply(841, 113);
    giq_option(4, 841, 110, Gunther05, 50);
    giq_option(4, 841, 111, Gunther02, 50);
    giq_option(4, 841, 112, GuntherEnd, 50);
  Gunther05: |
    gsay_reply(841, 114);
    giq_option(4, 841, 109, Gunther04, 50);
    giq_option(4, 841, 111, Gunther02, 50);
    giq_option(4, 841, 112, GuntherEnd, 50);
  Gunther06: |
    gsay_reply(841, 115);
    giq_option(4, 841, 116, Gunther07, 50);
    giq_option(4, 841, 117, Gunther08, 50);
    giq_option(4, 841, 111, Gunther02, 50);
    giq_option(4, 841, 112, GuntherEnd, 50);
  Gunther07: |
    gsay_reply(841, 118);
    giq_option(4, 841, 111, Gunther02, 50);
    giq_option(4, 841, 112, GuntherEnd, 50);
  Gunther08: |
    gsay_reply(841, 119);
    giq_option(4, 841, 116, Gunther04, 50);
    giq_option(4, 841, 111, Gunther02, 50);
    giq_option(4, 841, 112, GuntherEnd, 50);
  Gunther09: |
    gsay_reply(841, 120);
    giq_option(4, 841, 111, Gunther02, 50);
    giq_option(4, 841, 112, GuntherEnd, 50);
  Gunther10: |
    gsay_reply(841, 121);
    giq_option(4, 841, 111, Gunther02, 50);
    giq_option(4, 841, 112, GuntherEnd, 50);
  Gunther11: 'gsay_message(841, 123, 50);

    '
  GuntherEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
gurdrip2:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(978, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(978, 101));
  critter_p_proc: |
    if (global_var(252) == 1) then begin
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(252, 1);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(252, 1);
      float_msg(self_obj, message_str(978, 102), 2);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(155, global_var(155) + 1);
    end
  map_enter_p_proc: |
    if (metarule(22, 0) == 0) then begin
      if (tile_num(self_obj) == 24511) then begin
        set_local_var(0, 24511);
        set_local_var(1, 23670);
      end
      else begin
        if (tile_num(self_obj) == 24272) then begin
          set_local_var(0, 24272);
          set_local_var(1, 23710);
        end
        else begin
          if (tile_num(self_obj) == 20278) then begin
            set_local_var(0, 20278);
            set_local_var(1, 16500);
          end
        end
      end
      add_timer_event(self_obj, 30, 1);
      critter_add_trait(self_obj, 1, 5, 26);
      critter_add_trait(self_obj, 1, 6, 20);
    end
    if ((global_var(643) == 1) and (days_since_visited > 1)) then begin
      set_obj_visibility(self_obj, 1);
      move_to(self_obj, 9929, 2);
      removal_ptr := self_obj;
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      animate_move_obj_to_tile(self_obj, local_var(1), 0);
      add_timer_event(self_obj, 350, 2);
    end
    else begin
      if (fixed_param == 2) then begin
        animate_move_obj_to_tile(self_obj, local_var(0), 0);
        add_timer_event(self_obj, 350, 1);
      end
    end
  talk_p_proc: 'float_msg(self_obj, message_str(978, 103 + random(1, 7)), 0);

    '
gurdrip3:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(979, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(979, 101));
  critter_p_proc: |
    if (global_var(252) == 1) then begin
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(252, 1);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(252, 1);
      float_msg(self_obj, message_str(979, 102), 2);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(155, global_var(155) + 1);
    end
  map_enter_p_proc: |
    if (metarule(22, 0) == 0) then begin
      critter_add_trait(self_obj, 1, 5, 26);
      critter_add_trait(self_obj, 1, 6, 20);
    end
    if ((global_var(643) == 1) and (days_since_visited > 1)) then begin
      set_obj_visibility(self_obj, 1);
      move_to(self_obj, 9929, 2);
      removal_ptr := self_obj;
    end
  talk_p_proc: |
    if (global_var(643) == 1) then begin
      call Node008;
    end
    else begin
      if (local_var(0) == 0) then begin
        call Node000;
      end
      else begin
        call Node007;
      end
    end
  Node000: |
    start_gdialog(979, self_obj, 4, -1, -1);
    gsay_start;
    call Node001;
    gsay_end;
    end_dialogue;
  Node001: |
    set_local_var(0, 1);
    gsay_reply(979, 200);
    giq_option(4, 979, 201, Node002, 50);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      giq_option(4, 979, 202, Node003, 50);
    end
    else begin
      giq_option(4, 979, 2002, Node003, 50);
    end
    giq_option(-3, 979, 214, Node004, 50);
  Node002: |
    gsay_reply(979, 204);
    giq_option(4, 979, 205, Node005, 50);
  Node003: |
    gsay_message(979, 203, 50);
    set_global_var(252, 1);
  Node004: 'gsay_message(979, 215, 50);

    '
  Node005: |
    gsay_reply(979, 206);
    giq_option(4, 979, 207, Node006, 50);
    giq_option(4, 979, 208, Node003, 50);
  Node006: |
    gsay_reply(979, 209);
    giq_option(4, 979, 210, Node999, 50);
    giq_option(4, 979, 211, Node003, 50);
  Node007: |
    start_gdialog(979, self_obj, 4, -1, -1);
    gsay_start;
    gsay_reply(979, 212);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      giq_option(4, 979, 216, Node003, 50);
    end
    else begin
      giq_option(4, 979, 2016, Node003, 50);
    end
    giq_option(4, 979, 213, Node999, 50);
    giq_option(-3, 979, 214, Node004, 50);
    gsay_end;
    end_dialogue;
  Node008: |
    start_gdialog(976, self_obj, 4, -1, -1);
    gsay_start;
    gsay_message(976, 307, 50);
    gsay_end;
    end_dialogue;
  Node999: "[]"
gustofer:
  start: "[]"
  combat_p_proc: |
    if ((fixed_param == 4) and obj_can_see_obj(self_obj, dude_obj)) then begin
      round_counter := round_counter + 1;
    end
    if (round_counter > 3) then begin
      if (global_var(247) == 0) then begin
        set_global_var(247, 1);
        set_global_var(155, global_var(155) - 5);
      end
    end
  critter_p_proc: |
    if (global_var(627) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) and (tile_distance_objs(self_obj, dude_obj) < 8) and (local_var(1) == 0)) then begin
      call flee_dude;
    end
    else begin
      if (game_time_hour == 1400) then begin
        if ((line148flag == 0) and ((game_time / (10 * 60 * 60 * 24) % 3) == 0)) then begin
          line148flag := 1;
          fight := 1;
          float_msg(self_obj, message_str(529, 148), 0);
        end
      end
      else begin
        line148flag := 0;
      end
      if (Saul_wins or Saul_loses and shot_challenger) then begin
        call destroy_challenger;
        if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 12)) then begin
          dialogue_system_enter;
        end
      end
      else begin
        call sleeping;
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(627, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  map_enter_p_proc: |
    if (global_var(15) == 1) then begin
      destroy_object(self_obj);
    end
    if (local_var(0) == 0) then begin
      set_local_var(0, tile_num(self_obj));
    end
    if (not(metarule(22, 0)) and not(obj_is_carrying_obj_pid(self_obj, 41))) then begin
      item_caps_adjust(self_obj, random(0, 10));
    end
    critter_add_trait(self_obj, 1, 6, 15);
    sleep_time := 1920;
    wake_time := 530;
    home_tile := 17096;
    sleep_tile := 7000;
  pickup_p_proc: |
    robbed := 1;
    dialogue_system_enter;
  talk_p_proc: |
    if (not(robbed) and (local_var(2) == 1) and ((game_time / (10 * 60 * 60 * 24) % 3) != 0)) then begin
      call Gustofer05;
    end
    else begin
      start_gdialog(529, self_obj, 4, -1, -1);
      gsay_start;
      if (Saul_wins) then begin
        if (dude_bet == 1) then begin
          call Gustofer16;
        end
        else begin
          call Gustofer07;
        end
      end
      else begin
        if (Saul_loses) then begin
          if (dude_bet == 2) then begin
            call Gustofer16;
          end
          else begin
            call Gustofer07;
          end
        end
        else begin
          if (robbed) then begin
            call Gustofer13;
          end
          else begin
            if ((game_time / (10 * 60 * 60 * 24) % 3) == 0) then begin
              if (game_time_hour < 1400) then begin
                if (dude_bet == 0) then begin
                  call Gustofer06;
                end
                else begin
                  gsay_message(529, 152, 50);
                end
              end
              else begin
                if (challenger_ptr != 0) then begin
                  call Gustofer19;
                end
                else begin
                  call Gustofer18;
                  dude_bet := 0;
                end
              end
            end
            else begin
              call Gustofer00;
            end
          end
        end
      end
      gsay_end;
      end_dialogue;
    end
  Gustofer00: |
    set_local_var(2, 1);
    gsay_reply(529, 100);
    giq_option(-3, 529, 101, Gustofer01, 50);
    giq_option(4, 529, 102, GustoferEnd, 50);
    giq_option(6, 529, 103, Gustofer00a, 50);
  Gustofer00a: |
    if ((game_time / (10 * 60 * 60 * 24) % 3) == 1) then begin
      call Gustofer03;
    end
    else begin
      call Gustofer02;
    end
  Gustofer01: 'gsay_message(529, 104, 50);

    '
  Gustofer02: |
    gsay_reply(529, 105);
    giq_option(4, 529, 107, GustoferEnd, 50);
    if (global_var(169) == 0) then begin
      giq_option(4, 529, 108, Gustofer04, 50);
    end
  Gustofer03: |
    gsay_reply(529, 106);
    giq_option(4, 529, 107, GustoferEnd, 50);
    if (global_var(169) == 0) then begin
      giq_option(4, 529, 108, Gustofer04, 50);
    end
  Gustofer04: 'gsay_message(529, 109, 50);

    '
  Gustofer05: |
    variable LVar0 := 0;
    LVar0 := message_str(529, 110);
    if ((game_time / (10 * 60 * 60 * 24) % 3) == 1) then begin
      LVar0 := LVar0 + message_str(529, 112);
    end
    else begin
      if ((game_time / (10 * 60 * 60 * 24) % 3) == 2) then begin
        LVar0 := LVar0 + message_str(529, 111);
      end
    end
    float_msg(self_obj, LVar0, 0);
  Gustofer06: |
    gsay_reply(529, 113);
    giq_option(-3, 529, 101, Gustofer01, 50);
    giq_option(4, 529, 114, GustoferEnd, 50);
    giq_option(4, 529, 115, Gustofer08, 50);
    giq_option(4, 529, 116, Gustofer09, 50);
  Gustofer07: |
    Saul_wins := 0;
    Saul_loses := 0;
    dude_bet := 0;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(529, 150, 50);
    end
    else begin
      gsay_message(529, 151, 50);
    end
  Gustofer08: |
    gsay_reply(529, 120);
    giq_option(4, 529, 121, GustoferBet1, 50);
    giq_option(4, 529, 122, GustoferBet2, 50);
  Gustofer09: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      gsay_reply(529, 123);
      if (global_var(169) == 0) then begin
        giq_option(4, 529, 124, Gustofer10, 50);
      end
      giq_option(4, 529, 125, Gustofer11, 50);
      giq_option(4, 529, 126, GustoferEnd, 50);
    end
    else begin
      gsay_message(529, 127, 50);
    end
  Gustofer10: |
    gsay_reply(529, 128);
    giq_option(0, 634, 106, Gustofer10a, 50);
  Gustofer10a: |
    gsay_reply(529, 129);
    giq_option(4, 529, 130, Gustofer11, 50);
    giq_option(4, 529, 131, GustoferEnd, 50);
  Gustofer11: |
    gsay_reply(529, 132);
    giq_option(4, 529, 133, Gustofer12, 50);
    giq_option(4, 529, 134, GustoferEnd, 50);
  Gustofer12: |
    gsay_reply(529, 135);
    giq_option(4, 529, 136, GustoferEnd, 50);
  Gustofer13: |
    robbed := 0;
    gsay_reply(529, 137);
    giq_option(4, 529, 138, Gustofer14, 51);
    giq_option(4, 529, 139, Gustofer15, 51);
    giq_option(-3, 529, 101, Gustofer15, 51);
  Gustofer14: 'gsay_message(529, 140, 51);

    '
  Gustofer15: 'gsay_message(529, 141, 51);

    '
  Gustofer16: |
    dude_bet := 0;
    if (Saul_wins) then begin
      item_caps_adjust(dude_obj, 50);
    end
    else begin
      item_caps_adjust(dude_obj, 100);
    end
    Saul_wins := 0;
    Saul_loses := 0;
    gsay_message(529, 142, 50);
    call destroy_challenger;
  Gustofer17: 'gsay_message(529, 147, 50);

    '
  Gustofer18: |
    gsay_reply(529, 118);
    giq_option(4, 529, 119, GustoferEnd, 50);
    giq_option(-3, 529, 101, GustoferEnd, 50);
  Gustofer19: 'gsay_message(529, 149, 50);

    '
  GustoferEnd: "[]"
  GustoferWait: |
    gfade_out(600);
    game_time_advance(game_ticks((3600 * (13 - (game_time_hour / 100))) + (60 * (60 - (game_time_hour % 100)))));
    gfade_in(600);
  GustoferBet1: |
    if (item_caps_total(dude_obj) >= 25) then begin
      item_caps_adjust(dude_obj, -25);
      dude_bet := 1;
      gsay_reply(529, 144);
      giq_option(4, 529, 145, GustoferWait, 50);
      giq_option(4, 529, 146, Gustofer17, 50);
    end
    else begin
      gsay_message(529, 143, 50);
    end
  GustoferBet2: |
    if (item_caps_total(dude_obj) >= 25) then begin
      item_caps_adjust(dude_obj, -25);
      dude_bet := 2;
      gsay_reply(529, 144);
      giq_option(4, 529, 145, GustoferWait, 50);
      giq_option(4, 529, 146, Gustofer17, 50);
    end
    else begin
      gsay_message(529, 143, 50);
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
  destroy_challenger: |
    destroy_object(challenger_ptr);
    shot_challenger := 0;
    challenger_ptr := 0;
  sleeping: |
    if (local_var(1) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(1, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(1, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(1, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(1, 1);
          end
        end
      end
    end
gwen:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 6);
      critter_add_trait(self_obj, 1, 5, 20);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(141, 100));
  talk_p_proc: |
    if (global_var(116) == 1) then begin
      float_msg(self_obj, message_str(136, random(102, 106)), 8);
    end
    else begin
      call do_dialogue;
    end
  pickup_p_proc: 'hostile := 1;

    '
  critter_p_proc: |
    call Critter_Action;
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    set_global_var(254, 1);
    set_global_var(611, 0);
    set_global_var(115, global_var(115) - 1);
  damage_p_proc: |
    if (global_var(116) == 0) then begin
      set_global_var(254, 1);
    end
  do_dialogue: |
    set_local_var(3, 1);
    call get_reaction;
    start_gdialog(141, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4) == 5) then begin
      call gwen10;
    end
    else begin
      set_local_var(4, local_var(4) + 1);
      call gwen00;
    end
    gsay_end;
    end_dialogue;
  gwen00: |
    gsay_reply(141, 101);
    giq_option(4, 141, message_str(141, 102) + proto_data(obj_pid(dude_obj), 1) + message_str(141, 103), gwen01, 50);
    giq_option(7, 141, 104, gwen02, 50);
    giq_option(-3, 141, 105, gwen03, 50);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      giq_option(4, 141, 106, gwen07, 50);
    end
  gwen01: |
    gsay_reply(141, 107);
    giq_option(4, 141, 108, gwen04, 50);
    giq_option(4, 141, 109, gwen08, 50);
    giq_option(4, 141, 110, gwen05, 50);
    giq_option(4, 141, 111, gwen06, 50);
  gwen02: 'gsay_message(141, 112, 50);

    '
  gwen03: 'gsay_message(141, 113, 50);

    '
  gwen04: |
    gsay_reply(141, 114);
    giq_option(4, 141, 115, gwenend, 50);
    giq_option(4, 141, 116, combat, 50);
    giq_option(4, 141, 117, combat, 50);
  gwen05: |
    gsay_message(141, 118, 50);
    call combat;
  gwen06: |
    gsay_message(141, 119, 50);
    call combat;
  gwen07: |
    gsay_message(141, 120, 50);
    call combat;
  gwen08: |
    gsay_message(141, 121, 50);
    call combat;
  gwen10: 'gsay_message(141, 122, 50);

    '
  gwenend: "[]"
  combat: |
    if (global_var(116) == 1) then begin
      critter_add_trait(self_obj, 1, 6, 87);
    end
    hostile := 1;
  Critter_Action: |
    variable LVar0 := 0;
    if (global_var(26) == 2) then begin
      set_global_var(254, 1);
    end
    else begin
      if (global_var(116)) then begin
        set_global_var(254, 0);
        if (tile_distance_objs(self_obj, dude_obj) < 3) then begin
          LVar0 := tile_num_in_direction(tile_num(self_obj), random(0, 5), 3);
          if (tile_distance(tile_num(self_obj), LVar0) > 2) then begin
            if (random(0, 9) == 0) then begin
              float_msg(self_obj, message_str(136, random(102, 106)), 8);
            end
            animate_move_obj_to_tile(self_obj, LVar0, 0);
          end
        end
      end
      else begin
        if (global_var(213)) then begin
          set_global_var(254, 1);
        end
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          if (global_var(214)) then begin
            set_global_var(254, 1);
          end
        end
        if (map_var(2) == 1) then begin
          set_global_var(254, 1);
        end
      end
    end
    if (global_var(254) and obj_can_see_obj(self_obj, dude_obj)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
hallgrd:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 65);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    Pick := random(1, 9);
    if (Pick == 1) then begin
      message := message_str(618, 101);
    end
    else begin
      if (Pick == 2) then begin
        message := message_str(618, 102);
      end
      else begin
        if (Pick == 3) then begin
          message := message_str(618, 103);
        end
        else begin
          if (Pick == 4) then begin
            message := message_str(618, 104);
          end
          else begin
            if (Pick == 5) then begin
              message := message_str(618, 105);
            end
            else begin
              if (Pick == 6) then begin
                message := message_str(618, 106);
              end
              else begin
                if (Pick == 7) then begin
                  message := message_str(618, 107);
                end
                else begin
                  if (Pick == 8) then begin
                    message := message_str(618, 108);
                  end
                  else begin
                    if (Pick == 9) then begin
                      message := message_str(618, 110) + proto_data(obj_pid(dude_obj), 1) + message_str(618, 111);
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    float_msg(self_obj, message, 0);
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(618, 100));
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
harold:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (local_var(4) == 0) then begin
      if (local_var(1) > 1) then begin
        set_local_var(4, 1);
        start_gdialog(45, self_obj, 4, 14, 3);
        gsay_start;
        call Harold00;
        gsay_end;
        end_dialogue;
      end
      else begin
        start_gdialog(45, self_obj, 4, 14, 3);
        gsay_start;
        call Harold39;
        gsay_end;
        end_dialogue;
      end
    end
    else begin
      if (local_var(1) > 1) then begin
        set_local_var(4, 1);
        start_gdialog(45, self_obj, 4, 14, 3);
        gsay_start;
        call Harold41;
        gsay_end;
        end_dialogue;
      end
      else begin
        start_gdialog(45, self_obj, 4, 14, 3);
        gsay_start;
        call Harold55;
        gsay_end;
        end_dialogue;
      end
    end
  destroy_p_proc: |
    set_global_var(511, 0);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(45, 100));
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 41);
      critter_add_trait(self_obj, 1, 5, 53);
    end
    if (local_var(7) != 42) then begin
      set_local_var(7, 42);
      set_global_var(511, 100);
    end
  Harold00: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(45, 266);
    end
    else begin
      gsay_reply(45, 267);
    end
    giq_option(4, 45, 102, Harold00a, 50);
    giq_option(4, 45, 103, Harold00b, 50);
    giq_option(4, 45, 104, Harold38, 50);
    if (global_var(226) == 2) then begin
      giq_option(4, 45, 225, Harold45, 50);
    end
    giq_option(4, 45, 105, Harold37, 51);
    giq_option(-3, 45, 106, Harold01, 50);
  Harold00a: |
    variable LVar0 := 0;
    if (item_caps_total(dude_obj) >= 25) then begin
      LVar0 := item_caps_adjust(dude_obj, -25);
      call Harold02;
    end
    else begin
      call Harold01;
    end
  Harold00b: |
    variable LVar0 := 0;
    if (item_caps_total(dude_obj) >= 5) then begin
      LVar0 := item_caps_adjust(dude_obj, -5);
      call Harold02;
    end
    else begin
      call Harold01;
    end
  Harold01: 'gsay_message(45, 107, 50);

    '
  Harold02: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(45, 268);
    end
    else begin
      gsay_reply(45, 269);
    end
    giq_option(4, 45, 109, Harold03, 50);
    if (global_var(226) == 2) then begin
      giq_option(4, 45, 225, Harold45, 50);
    end
    giq_option(4, 45, 110, HaroldEnd, 50);
  Harold03: |
    gsay_reply(45, 111);
    giq_option(4, 45, 112, Harold04, 50);
    giq_option(4, 45, 113, Harold36, 50);
    giq_option(4, 45, 114, HaroldEnd, 50);
  Harold04: |
    gsay_reply(45, 115);
    giq_option(4, 45, 116, Harold05, 50);
    giq_option(4, 45, 117, Harold32, 50);
  Harold05: |
    gsay_reply(45, 118);
    giq_option(4, 45, 119, Harold07, 50);
    giq_option(4, 45, 120, Harold06, 50);
    giq_option(4, 45, 121, Harold30, 50);
  Harold06: |
    gsay_reply(45, 122);
    giq_option(4, 45, 123, Harold07, 50);
  Harold07: |
    gsay_reply(45, 124);
    giq_option(4, 45, 125, Harold08, 50);
  Harold08: |
    gsay_reply(45, 126);
    giq_option(4, 45, 127, Harold09, 50);
    giq_option(4, 45, 128, Harold10, 50);
  Harold09: |
    gsay_reply(45, 129);
    giq_option(4, 45, 130, Harold09a, 50);
  Harold09a: |
    gsay_reply(45, 131);
    giq_option(4, 45, 132, Harold11, 50);
  Harold10: |
    gsay_reply(45, 133);
    giq_option(4, 45, 134, Harold11, 50);
    giq_option(4, 45, 135, Harold12, 50);
    giq_option(4, 45, 136, Harold10a, 50);
  Harold10a: |
    gsay_message(45, 137, 50);
    call Harold11;
  Harold11: |
    gsay_reply(45, 138);
    giq_option(4, 45, 139, Harold14, 50);
    giq_option(4, 45, 140, Harold13, 50);
  Harold12: |
    gsay_reply(45, 141);
    giq_option(4, 45, 142, Harold11, 50);
  Harold13: |
    gsay_reply(45, 143);
    giq_option(4, 45, 144, Harold15, 50);
    giq_option(4, 45, 145, Harold14, 50);
  Harold14: |
    gsay_reply(45, 146);
    giq_option(4, 45, 147, Harold18, 50);
  Harold15: |
    gsay_reply(45, 148);
    giq_option(4, 45, 149, Harold14, 50);
    giq_option(4, 45, 150, Harold15a, 50);
    giq_option(4, 45, 152, HaroldEnd, 50);
  Harold15a: |
    variable LVar0 := 0;
    if (item_caps_total(dude_obj) >= 25) then begin
      LVar0 := item_caps_adjust(dude_obj, -25);
      set_local_var(6, 1);
      call Harold14;
    end
    else begin
      call Harold17;
    end
  Harold16: |
    gsay_message(45, 153, 50);
    giq_option(4, 45, 154, Harold14, 50);
  Harold17: |
    gsay_message(45, 156, 50);
    if (local_var(1) >= 3) then begin
      call Harold16;
    end
    else begin
      call Harold17a;
    end
  Harold17a: |
    gsay_reply(45, 157);
    giq_option(4, 45, 158, HaroldEnd, 50);
    giq_option(4, 45, 159, Harold14, 50);
  Harold18: |
    gsay_reply(45, 160);
    giq_option(4, 45, 161, Harold20, 50);
    giq_option(4, 45, 162, Harold19, 50);
  Harold19: |
    gsay_reply(45, 163);
    giq_option(4, 45, 164, Harold21, 50);
  Harold20: |
    gsay_reply(45, 165);
    giq_option(4, 45, 166, Harold21, 50);
  Harold21: |
    gsay_reply(45, 167);
    giq_option(4, 45, 168, Harold22, 50);
  Harold22: |
    gsay_reply(45, 169);
    giq_option(4, 45, 170, Harold23, 50);
    giq_option(4, 45, 171, Harold24, 50);
  Harold23: |
    gsay_reply(45, 172);
    giq_option(4, 45, 173, Harold24, 50);
  Harold24: |
    gsay_reply(45, 174);
    giq_option(4, 45, 175, Harold25, 50);
  Harold25: |
    gsay_reply(45, 176);
    giq_option(4, 45, 177, Harold25a, 50);
    giq_option(4, 45, 178, Harold27, 50);
  Harold25a: |
    gsay_reply(45, 179);
    giq_option(4, 45, 180, Harold26, 50);
  Harold26: |
    gsay_reply(45, 181);
    giq_option(4, 45, 182, Harold28, 50);
    giq_option(4, 45, 183, Harold26a, 50);
  Harold26a: |
    set_local_var(5, 1);
    if (local_var(6) == 1) then begin
      gsay_reply(45, 184);
      giq_option(4, 45, 185, Harold26b, 50);
    end
    else begin
      gsay_message(45, 184, 50);
    end
  Harold26b: 'gsay_message(45, 187, 50);

    '
  Harold27: |
    gsay_reply(45, 188);
    giq_option(4, 45, 189, Harold26, 50);
  Harold28: |
    gsay_reply(45, 190);
    giq_option(4, 45, 191, Harold29, 50);
    giq_option(4, 45, 192, Harold26a, 50);
  Harold29: |
    gsay_reply(45, 193);
    giq_option(4, 45, 194, Harold26a, 50);
  Harold30: |
    gsay_reply(45, 195);
    giq_option(4, 45, 196, Harold31, 50);
  Harold31: |
    gsay_reply(45, 197);
    giq_option(4, 45, 198, Harold07, 50);
  Harold32: |
    gsay_reply(45, 199);
    giq_option(4, 45, 200, Harold11, 50);
  Harold36: 'gsay_message(45, 207, 50);

    '
  Harold37: |
    call BigDownReact;
    gsay_message(45, 208, 51);
  Harold38: 'gsay_message(45, 209, 50);

    '
  Harold39: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(45, 272);
    end
    else begin
      gsay_reply(45, 273);
    end
    giq_option(4, 45, 211, Harold39a, 50);
    giq_option(4, 45, 212, Harold39b, 50);
    if (global_var(226) == 2) then begin
      giq_option(4, 45, 225, Harold45, 50);
    end
    giq_option(4, 45, 213, Harold38, 50);
    giq_option(-3, 45, 214, Harold01, 50);
  Harold39a: |
    variable LVar0 := 0;
    if (item_caps_total(dude_obj) >= 25) then begin
      LVar0 := item_caps_adjust(dude_obj, -25);
      call Harold40;
    end
    else begin
      call Harold01;
    end
  Harold39b: |
    variable LVar0 := 0;
    if (item_caps_total(dude_obj) >= 5) then begin
      LVar0 := item_caps_adjust(dude_obj, -5);
      call Harold40;
    end
    else begin
      call Harold01;
    end
  Harold40: |
    gsay_reply(45, 215);
    giq_option(4, 45, 216, Harold03, 50);
    giq_option(4, 45, 217, HaroldEnd, 50);
  Harold41: |
    gsay_reply(45, 218);
    giq_option(4, 45, 219, Harold41a, 50);
    giq_option(4, 45, 220, Harold43, 50);
    giq_option(-3, 45, 221, HaroldEnd, 50);
  Harold41a: |
    variable LVar0 := 0;
    if (item_caps_total(dude_obj) >= 20) then begin
      LVar0 := item_caps_adjust(dude_obj, -20);
      call Harold43;
    end
    else begin
      call Harold01;
    end
  Harold43: |
    gsay_reply(45, 223);
    if (global_var(226) == 2) then begin
      giq_option(4, 45, 225, Harold45, 50);
    end
    if (((global_var(150) - (game_time / (10 * 60 * 60 * 24))) < 10) or (global_var(109) == 1)) then begin
      giq_option(4, 45, 224, Harold43b, 50);
    end
    if (local_var(5) == 0) then begin
      giq_option(4, 45, 226, Harold43a, 50);
    end
    giq_option(4, 45, 265, HaroldEnd, 50);
  Harold43a: |
    gsay_message(45, 228, 50);
    call Harold04;
  Harold43b: |
    if (global_var(109) == 1) then begin
      call Harold53;
    end
    else begin
      if ((global_var(150) - (game_time / (10 * 60 * 60 * 24))) < 10) then begin
        call Harold54;
      end
    end
  Harold45: |
    set_global_var(226, 3);
    gsay_reply(45, 230);
    giq_option(4, 45, 231, Harold47, 50);
    giq_option(4, 45, 232, Harold47, 50);
  Harold47: |
    gsay_reply(45, 233);
    giq_option(4, 45, 234, Harold49, 50);
  Harold49: |
    gsay_reply(45, 235);
    giq_option(4, 45, 236, Harold50, 50);
  Harold50: |
    gsay_reply(45, 237);
    giq_option(4, 45, 238, Harold51, 50);
  Harold51: |
    gsay_reply(45, 239);
    giq_option(4, 45, 240, HaroldEnd, 50);
  Harold53: |
    set_global_var(219, 1);
    gsay_reply(45, 242);
    giq_option(4, 45, 243, HaroldEnd, 50);
  Harold54: |
    gsay_reply(45, 244);
    giq_option(4, 45, 245, HaroldEnd, 50);
  Harold55: |
    gsay_reply(45, 246);
    giq_option(4, 45, 247, Harold56, 50);
    giq_option(4, 45, 248, Harold57, 50);
  Harold56: 'gsay_message(45, 249, 51);

    '
  Harold57: 'gsay_message(45, 250, 51);

    '
  HaroldEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
harry:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 79);
      set_local_var(5, 0);
      init_teams := 1;
    end
    if (script_action == 11) then begin
      if (global_var(306) == 0) then begin
        call do_dialogue;
      end
      else begin
        display_msg(message_str(16, 193));
      end
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(16, 100));
      end
      else begin
        if (script_action == 22) then begin
          if (obj_can_see_obj(self_obj, dude_obj)) then begin
            if (fixed_param == 1) then begin
              call harry07b;
            end
            else begin
              if (fixed_param == 2) then begin
                call harry21;
              end
            end
          end
        end
        else begin
          if (script_action == 4) then begin
            call pickup_p_proc;
          end
          else begin
            if (script_action == 12) then begin
              if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 8) and (global_var(306) < 1)) then begin
                if (local_var(4) == 0) then begin
                  dialogue_system_enter;
                end
                else begin
                  call Critter_Action;
                end
              end
              else begin
                call Critter_Action;
              end
            end
            else begin
              if (script_action == 18) then begin
                set_global_var(35, global_var(35) + 1);
                if (global_var(35) > global_var(551)) then begin
                  set_global_var(155, global_var(155) + 3);
                  set_global_var(29, 2);
                  set_global_var(225, game_time / (10 * 60 * 60 * 24));
                end
                if (source_obj == dude_obj) then begin
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                    set_global_var(156, 1);
                    set_global_var(157, 0);
                  end
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                    set_global_var(157, 1);
                    set_global_var(156, 0);
                  end
                  set_global_var(160, global_var(160) + 1);
                  if ((global_var(160) % 6) == 0) then begin
                    set_global_var(155, global_var(155) + 1);
                  end
                end
              end
            end
          end
        end
      end
    end
  gameover: 'gsay_message(16, 191, 50);

    '
  do_dialogue: |
    call get_reaction;
    start_gdialog(16, self_obj, 4, 5, 4);
    gsay_start;
    if (global_var(17)) then begin
      call harry26;
    end
    else begin
      if (local_var(4)) then begin
        if (local_var(1) >= 2) then begin
          call harry19;
        end
        else begin
          call harry11;
        end
      end
      else begin
        set_local_var(4, 1);
        if (global_var(59) == 1) then begin
          call harry23;
        end
        else begin
          if (global_var(35) > 0) then begin
            call harry18;
          end
          else begin
            if ((local_var(1) >= 2) and (Hostile == 0)) then begin
              if (is_success(do_check(dude_obj, 3, 0)) and (get_critter_stat(dude_obj, 34) == 1)) then begin
                call harry12;
              end
              else begin
                call harry00;
              end
            end
            else begin
              call harry07;
            end
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
    if ((HarryThinks != 1) and (global_var(306) != 1)) then begin
      Hostile := 1;
    end
  Critter_Action: |
    if (Hostile > 0) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if ((global_var(306) == 1) and (tile_num(self_obj) != 15507)) then begin
        animate_move_obj_to_tile(self_obj, 15507, 0);
      end
      else begin
        if ((global_var(306) == 1) and (tile_num(self_obj) == 15507)) then begin
          set_global_var(306, 2);
        end
        else begin
          if ((global_var(306) == 2) and (tile_num(self_obj) != 12536)) then begin
            animate_move_obj_to_tile(self_obj, 12536, 0);
          end
          else begin
            if ((tile_num(self_obj) == 12536) and (global_var(306) == 2)) then begin
              set_obj_visibility(self_obj, 1);
            end
          end
        end
      end
    end
  harryleave: 'set_global_var(306, 1);

    '
  harryend: "[]"
  harrycbt: 'Hostile := 1;

    '
  harryturn: 'Hostile := 1;

    '
  harryextra: 'Hostile := 1;

    '
  surprise: 'Hostile := 1;

    '
  harrytime: |
    HarryThinks := 1;
    add_timer_event(self_obj, game_ticks(30), 1);
  harrytime2: |
    HarryThinks := 1;
    add_timer_event(self_obj, game_ticks(30), 2);
  harry00: |
    gsay_reply(16, 101);
    giq_option(5, 16, 102, harry00_2, 50);
    giq_option(4, 16, 103, harry00_3, 50);
    giq_option(4, 16, 104, harry02, 51);
    giq_option(-3, 16, 105, harry00a, 50);
  harry00a: |
    gsay_reply(16, 106);
    giq_option(-3, 16, 107, harry00b, 50);
  harry00b: |
    gsay_reply(16, 108);
    giq_option(-3, 16, 109, harry02, 50);
  harry00_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call harry01;
    end
    else begin
      call harry02;
    end
  harry00_3: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call harry20;
    end
    else begin
      call harry02;
    end
  harry01: |
    gsay_reply(16, 110);
    giq_option(5, 16, 111, harry02, 50);
    giq_option(5, 16, 112, harry04, 50);
  harry02: |
    gsay_reply(16, 113);
    giq_option(4, 16, 114, harry03, 50);
    giq_option(4, 16, 115, harrycbt, 51);
    giq_option(-3, 16, 163, harrycbt, 51);
  harry03: |
    gsay_reply(16, 116);
    giq_option(4, 16, 117, harry03_2, 50);
    giq_option(4, 16, 118, harry03_5, 50);
  harry03_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call harry04;
    end
    else begin
      call harry05;
    end
  harry03_5: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call harry06;
    end
    else begin
      call harry07;
    end
  harry04: |
    gsay_reply(16, 119);
    giq_option(4, 16, 120, harry08, 50);
    if (global_var(17) != 1) then begin
      giq_option(4, 16, 121, harryxxx, 50);
    end
    giq_option(4, 16, 122, harryturn, 50);
  harry05: |
    gsay_reply(16, 123);
    if (global_var(17) != 1) then begin
      giq_option(4, 16, 192, harryxxx, 50);
    end
    giq_option(4, 16, 191, harrycbt, 50);
  harry06: |
    gsay_message(16, 124, 50);
    call harrytime;
  harry07: |
    gsay_message(16, 125, 51);
    call harrycbt;
  harry07b: |
    float_msg(self_obj, message_str(16, 125), 2);
    call harrycbt;
  harry08: |
    gsay_reply(16, 126);
    giq_option(4, 16, 127, harry09, 51);
    giq_option(4, 16, 128, harry08_2, 50);
    giq_option(4, 16, 129, harry07, 50);
  harry08_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call harry10;
    end
    else begin
      call harry09;
    end
  harry09: |
    gsay_message(16, 130, 51);
    call harrycbt;
  harry10: |
    gsay_message(16, 131, 50);
    call harrytime;
  harry11: |
    gsay_message(16, 132, 51);
    call harrycbt;
  harry12: |
    gsay_reply(16, 133);
    giq_option(4, 16, 134, harry12_2, 50);
    giq_option(4, 16, 135, harry12_3, 50);
    giq_option(-3, 16, 105, harry00a, 50);
  harry12_2: |
    if (is_success(do_check(dude_obj, 3, 1))) then begin
      call harry13;
    end
    else begin
      call harry14;
    end
  harry12_3: |
    if (is_success(do_check(dude_obj, 3, 2))) then begin
      call harry17;
    end
    else begin
      call harry14;
    end
  harry13: |
    gsay_reply(16, 136);
    giq_option(4, 16, 137, harry13_2, 50);
    giq_option(4, 16, 138, harry14, 50);
  harry13_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call harry16;
    end
    else begin
      call harry14;
    end
  harry14: |
    gsay_reply(16, 139);
    if (global_var(17) != 1) then begin
      giq_option(4, 16, 121, harryxxx, 50);
    end
    giq_option(4, 16, 140, harry14_2, 50);
    giq_option(4, 16, 141, harryturn, 51);
  harry14_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call harry15;
    end
    else begin
      call harry07;
    end
  harry15: |
    gsay_message(16, 142, 50);
    call harrytime;
  harry16: |
    gsay_message(16, 143, 50);
    call harrytime;
  harry17: |
    gsay_reply(16, 144);
    giq_option(4, 16, 145, surprise, 51);
    giq_option(4, 16, 146, harry14, 50);
  harry18: |
    gsay_message(16, 147, 51);
    call harrycbt;
  harry19: |
    gsay_reply(16, 148);
    if (global_var(17) != 1) then begin
      giq_option(4, 16, 149, harry22, 50);
    end
    giq_option(4, 16, 150, harry19_2, 50);
    giq_option(4, 16, 151, harrycbt, 51);
    giq_option(-3, 16, 105, harry00a, 50);
  harry19_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call harry20;
    end
    else begin
      call harry07;
    end
  harry20: |
    gsay_message(16, 152, 50);
    call harrytime2;
  harry21: |
    float_msg(self_obj, message_str(16, 153), 2);
    call harrycbt;
  harry22: |
    gsay_message(16, 154, 51);
    call harryxxx;
  harry23: |
    gsay_reply(16, 155);
    giq_option(5, 16, 156, harry24, 50);
    if (global_var(17) != 1) then begin
      giq_option(4, 16, 121, harryxxx, 50);
    end
    giq_option(4, 16, 157, harry25, 51);
  harry24: |
    gsay_message(16, 158, 50);
    if (global_var(17) != 1) then begin
      giq_option(4, 16, 121, harryxxx, 50);
    end
    giq_option(4, 16, 191, harrycbt, 50);
  harry25: |
    gsay_message(16, 159, 51);
    call harrycbt;
  harry26: |
    gsay_reply(16, 160);
    giq_option(4, 16, 161, harryturn, 51);
    giq_option(4, 16, 162, harry27, 49);
    giq_option(-3, 16, 163, harry27, 50);
  harry27: |
    gsay_reply(16, 164);
    giq_option(4, 16, 165, harryturn, 51);
    giq_option(4, 16, 166, harryleave, 50);
    giq_option(-3, 16, 167, harryleave, 50);
  harry200: 'gsay_message(16, 168, 50);

    '
  harry201: 'gsay_message(16, 169, 50);

    '
  harry202: 'gsay_message(16, 170, 50);

    '
  harry203: 'gsay_message(16, 171, 50);

    '
  harry204: 'gsay_message(16, 172, 50);

    '
  harry205: 'gsay_message(16, 173, 50);

    '
  harry206: 'gsay_message(16, 174, 50);

    '
  harry207: 'gsay_message(16, 175, 50);

    '
  harry300: 'gsay_message(16, 176, 50);

    '
  harry301: 'gsay_message(16, 177, 50);

    '
  harry302: 'gsay_message(16, 178, 50);

    '
  harry303: 'gsay_message(16, 179, 50);

    '
  harry304: 'gsay_message(16, 180, 50);

    '
  harry305: 'gsay_message(16, 181, 50);

    '
  harry306: 'gsay_message(16, 182, 50);

    '
  harry307: 'gsay_message(16, 183, 50);

    '
  harry308: 'gsay_message(16, 184, 50);

    '
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      Hostile := 1;
    end
  harryxxx: |
    game_time_advance(game_ticks(2 * 604800));
    set_global_var(57, 2);
    load_map(32, 5);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
hbeth:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(617, 100));
  critter_p_proc: |
    if (GVar0) then begin
      GVar0 := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      GVar0 := 1;
    end
  talk_p_proc: |
    variable LVar0 := 0;
    call Get_Stuff;
    call get_reaction;
    if (((game_time / 10) - local_var(16)) > (60 * 60 * 24 * 3)) then begin
      set_local_var(16, game_time / 10);
      set_local_var(17, random(1000, 2000));
      LVar0 := item_caps_adjust(self_obj, local_var(17));
    end
    else begin
      LVar0 := item_caps_adjust(self_obj, local_var(17));
    end
    if (map_var(10) == 1) then begin
      gdialog_set_barter_mod(5);
    end
    else begin
      gdialog_set_barter_mod(-10);
    end
    set_map_var(33, 1);
    if (local_var(11) == 0) then begin
      set_local_var(11, game_time / (10 * 60 * 60));
    end
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      float_msg(self_obj, message_str(617, 361), 2);
    end
    else begin
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) and (local_var(14) == 0)) then begin
        call Beth55;
      end
      else begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) and (local_var(14) == 1)) then begin
          call Beth56;
        end
        else begin
          if (local_var(4) == 1) then begin
            start_gdialog(617, self_obj, 4, -1, -1);
            gsay_start;
            if (local_var(1) > 1) then begin
              call Beth64;
            end
            else begin
              call Beth65;
            end
            gsay_end;
            end_dialogue;
          end
          else begin
            set_local_var(4, 1);
            start_gdialog(617, self_obj, 4, -1, -1);
            gsay_start;
            call Beth00;
            gsay_end;
            end_dialogue;
          end
        end
      end
    end
    set_local_var(11, game_time / (10 * 60 * 60));
    set_local_var(17, item_caps_total(self_obj));
    LVar0 := item_caps_adjust(self_obj, -1 * local_var(17));
    call Put_Stuff;
  destroy_p_proc: |
    move_obj_inven_to_obj(Beth_Box_Ptr, self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    variable LVar0 := 0;
    if (GVar1) then begin
      GVar1 := 0;
      Beth_Ptr := self_obj;
      critter_add_trait(self_obj, 1, 6, 37);
      critter_add_trait(self_obj, 1, 5, 50);
    end
  Beth00: |
    gsay_reply(617, 101);
    call Beth01;
  Beth01: |
    giq_option(4, 617, 102, Beth09, 50);
    giq_option(4, 617, 104, Beth62, 49);
    giq_option(4, 617, 398, Beth68, 50);
    giq_option(4, 617, 105, Beth63, 50);
    giq_option(4, 617, 106, Beth06, 50);
    giq_option(4, 617, 107, BethEnd, 50);
    giq_option(-3, 617, 108, Beth04, 50);
  Beth02: |
    if (map_var(41) == 1) then begin
      giq_option(4, 617, 109, Beth36, 50);
    end
    if (global_var(226) >= 1) then begin
      giq_option(4, 617, 110, Beth02a, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 617, 112, Beth02b, 50);
    end
    giq_option(4, 617, 398, Beth69, 50);
    giq_option(4, 617, 113, Beth23, 50);
    giq_option(4, 617, 114, Beth03a, 50);
    giq_option(4, 617, 115, BethEnd, 50);
  Beth02a: |
    if (global_var(226) == 5) then begin
      call Beth37;
    end
    else begin
      call Beth38;
    end
  Beth02b: |
    if (global_var(203) != 0) then begin
      call Beth66;
    end
    else begin
      call Beth14;
    end
  Beth03: |
    if (local_var(10) == 1) then begin
      if ((local_var(5) == 0) and (global_var(203) == 2)) then begin
        set_local_var(5, 1);
        set_global_var(219, 1);
        gsay_reply(617, 123);
      end
      else begin
        if ((local_var(6) == 0) and (global_var(203) == 2)) then begin
          set_local_var(5, 1);
          gsay_reply(617, 124);
        end
        else begin
          if ((local_var(7) == 0) and (global_var(112) == 2)) then begin
            set_local_var(5, 1);
            gsay_reply(617, 125);
          end
          else begin
            if ((local_var(8) == 0) and (global_var(18) == 1)) then begin
              set_local_var(5, 1);
              gsay_reply(617, 126);
            end
            else begin
              if ((local_var(9) == 0) and (global_var(17) == 1)) then begin
                set_local_var(5, 1);
                gsay_reply(617, 127);
              end
            end
          end
        end
      end
    end
    else begin
      set_local_var(10, 1);
      if ((local_var(5) == 0) and (global_var(203) == 2)) then begin
        set_local_var(5, 1);
        set_global_var(219, 1);
        gsay_reply(617, 117);
      end
      else begin
        if ((local_var(6) == 0) and (global_var(203) == 2)) then begin
          set_local_var(5, 1);
          gsay_reply(617, 118);
        end
        else begin
          if ((local_var(7) == 0) and (global_var(112) == 2)) then begin
            set_local_var(5, 1);
            gsay_reply(617, 119);
          end
          else begin
            if ((local_var(8) == 0) and (global_var(18) == 1)) then begin
              set_local_var(5, 1);
              gsay_reply(617, 121);
            end
            else begin
              if ((local_var(9) == 0) and (global_var(17) == 1)) then begin
                set_local_var(5, 1);
                gsay_reply(617, 122);
              end
            end
          end
        end
      end
    end
    giq_option(4, 617, 128, Beth03a, 50);
    giq_option(4, 617, 129, Beth39, 50);
    giq_option(4, 617, 130, BethEnd, 50);
  Beth03a: |
    if ((local_var(5) == 0) and (global_var(203) == 2) or ((local_var(6) == 0) and (global_var(203) == 2)) or ((local_var(7) == 0) and (global_var(112) == 2)) or ((local_var(8) == 0) and (global_var(18) == 1)) or ((local_var(9) == 0) and (global_var(17) == 1))) then begin
      call Beth03;
    end
    else begin
      call Beth12;
    end
  Beth04: |
    gsay_reply(617, 131);
    giq_option(-3, 617, 132, Beth05, 50);
    giq_option(-3, 617, 133, Beth05, 50);
  Beth05: 'gsay_message(617, 134, 50);

    '
  Beth06: |
    gsay_reply(617, 135);
    giq_option(4, 617, 136, BethEnd, 50);
  Beth08: |
    gsay_reply(617, 140);
    call Beth01;
  Beth09: |
    gsay_reply(617, 141);
    call Beth02;
  Beth12: |
    gsay_reply(617, 144);
    giq_option(4, 617, 145, Beth08, 50);
    giq_option(4, 617, 146, Beth13, 50);
  Beth13: 'gsay_message(617, 147, 50);

    '
  Beth14: |
    gsay_reply(617, 148);
    giq_option(4, 617, 149, Beth15, 50);
    giq_option(4, 617, 150, Beth20, 50);
  Beth15: |
    set_global_var(219, 1);
    gsay_reply(617, 151);
    giq_option(4, 617, 152, Beth16, 50);
    if ((map_var(46) >= 4) or (map_var(46) >= 4)) then begin
      giq_option(4, 617, 153, Beth15a, 51);
    end
    giq_option(4, 617, 154, BethEnd, 50);
  Beth15a: |
    call BigDownReact;
    call Beth21;
  Beth16: |
    set_map_var(48, 1);
    gsay_reply(617, 155);
    if ((map_var(46) >= 5) or (map_var(46) >= 5)) then begin
      giq_option(4, 617, 156, Beth16a, 51);
    end
    giq_option(4, 617, 157, Beth17, 50);
    giq_option(4, 617, 158, Beth18, 50);
    giq_option(4, 617, 159, Beth18, 50);
  Beth16a: |
    call BottomReact;
    call Beth22;
  Beth17: |
    gsay_reply(617, 160);
    giq_option(4, 617, 161, Beth18, 50);
    giq_option(4, 617, 162, Beth17a, 51);
    giq_option(4, 617, 163, Beth17b, 51);
  Beth17a: |
    call DownReact;
    call Beth19;
  Beth17b: |
    call BigDownReact;
    call Beth19;
  Beth18: |
    gsay_reply(617, 164);
    call Beth02;
  Beth19: 'gsay_message(617, 165, 51);

    '
  Beth20: |
    gsay_reply(617, 166);
    call Beth02;
  Beth21: 'gsay_message(617, 167, 51);

    '
  Beth22: 'gsay_message(617, 168, 51);

    '
  Beth23: |
    gsay_reply(617, 169);
    call Beth24;
  Beth24: |
    giq_option(4, 617, 170, Beth25, 50);
    giq_option(4, 617, 172, Beth30, 50);
    giq_option(4, 617, 173, Beth33, 50);
    giq_option(4, 617, 174, Beth42, 50);
    giq_option(4, 617, 175, BethEnd, 50);
  Beth25: |
    gsay_reply(617, 177);
    giq_option(4, 617, 178, Beth27, 50);
    if (map_var(41) == 1) then begin
      giq_option(4, 617, 179, Beth34, 50);
    end
    giq_option(4, 617, 180, Beth26, 50);
    giq_option(4, 617, 181, BethEnd, 50);
  Beth26: |
    gsay_reply(617, 182);
    call Beth24;
  Beth27: |
    gsay_reply(617, 183);
    giq_option(4, 617, 184, Beth28, 50);
    giq_option(4, 617, 185, Beth27a, 51);
    giq_option(4, 617, 186, Beth26, 50);
    giq_option(4, 617, 187, BethEnd, 50);
  Beth27a: |
    call BigDownReact;
    call BethEnd;
  Beth28: |
    gsay_reply(617, 188);
    giq_option(4, 617, 189, Beth29, 50);
    giq_option(4, 617, 190, Beth26, 50);
    giq_option(4, 617, 191, BethEnd, 50);
  Beth29: |
    gsay_reply(617, 192);
    call Beth24;
  Beth30: |
    gsay_reply(617, 193);
    giq_option(4, 617, 194, Beth32, 50);
    giq_option(4, 617, 195, Beth31, 50);
    giq_option(4, 617, 196, Beth26, 50);
    giq_option(4, 617, 197, BethEnd, 50);
  Beth31: |
    gsay_reply(617, 198);
    giq_option(4, 617, 199, Beth32, 50);
    giq_option(4, 617, 200, Beth26, 50);
    giq_option(4, 617, 201, BethEnd, 50);
  Beth32: |
    gsay_reply(617, 202);
    giq_option(4, 617, 203, Beth31, 50);
    giq_option(4, 617, 204, Beth26, 50);
    giq_option(4, 617, 205, BethEnd, 50);
  Beth33: |
    gsay_reply(617, 206);
    call Beth24;
  Beth34: |
    gsay_reply(617, 207);
    call Beth35;
  Beth35: |
    if (map_var(41) == 1) then begin
      giq_option(4, 617, 208, Beth40, 50);
    end
    if (global_var(226) >= 1) then begin
      giq_option(4, 617, 209, Beth46, 50);
    end
    if (map_var(41) == 1) then begin
      giq_option(4, 617, 212, Beth35a, 50);
    end
    giq_option(4, 617, 213, Beth24, 50);
    giq_option(4, 617, 214, BethEnd, 50);
  Beth35a: |
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 3) then begin
      call Beth54;
    end
    else begin
      call Beth53;
    end
  Beth36: |
    gsay_reply(617, 215);
    call Beth35;
  Beth37: |
    gsay_reply(617, 216);
    call Beth35;
  Beth38: |
    gsay_reply(617, 217);
    call Beth35;
  Beth39: |
    gsay_reply(617, 218);
    call Beth02;
  Beth40: |
    gsay_reply(617, 219);
    giq_option(4, 617, 220, Beth43, 50);
    giq_option(4, 617, 221, Beth44, 50);
    giq_option(4, 617, 222, Beth35, 50);
    giq_option(4, 617, 223, Beth23, 50);
    giq_option(4, 617, 224, Beth40a, 51);
    giq_option(4, 617, 225, BethEnd, 50);
  Beth40a: |
    call BigDownReact;
    call Beth41;
  Beth41: 'gsay_message(617, 226, 51);

    '
  Beth42: |
    gsay_reply(617, 227);
    call Beth24;
  Beth43: |
    gsay_reply(617, 228);
    giq_option(4, 617, 229, Beth44, 50);
    giq_option(4, 617, 230, Beth35, 50);
    giq_option(4, 617, 231, Beth23, 50);
    giq_option(4, 617, 232, BethEnd, 50);
  Beth44: |
    gsay_reply(617, 233);
    giq_option(4, 617, 234, Beth44, 50);
    giq_option(4, 617, 235, Beth35, 50);
    giq_option(4, 617, 236, Beth23, 50);
    giq_option(4, 617, 237, Beth45, 51);
    giq_option(4, 617, 238, BethEnd, 50);
  Beth45: |
    call BigDownReact;
    gsay_message(617, 239, 51);
  Beth46: |
    gsay_reply(617, 240);
    giq_option(4, 617, 241, Beth47, 50);
    giq_option(4, 617, 242, Beth49, 51);
    giq_option(4, 617, 243, Beth47, 50);
    giq_option(4, 617, 244, Beth50, 50);
  Beth47: |
    set_global_var(226, 2);
    gsay_reply(617, 245);
    giq_option(4, 617, 246, Beth48, 50);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      giq_option(4, 617, 247, Beth49, 51);
    end
    else begin
      giq_option(4, 617, 248, Beth49, 51);
    end
    giq_option(4, 617, 249, Beth35, 50);
    giq_option(4, 617, 250, Beth23, 50);
    giq_option(4, 617, 251, BethEnd, 50);
  Beth48: |
    gsay_reply(617, 252);
    giq_option(4, 617, 253, Beth35, 50);
    giq_option(4, 617, 254, Beth23, 50);
    giq_option(4, 617, 255, BethEnd, 50);
  Beth49: 'gsay_message(617, 256, 51);

    '
  Beth50: |
    set_global_var(226, 2);
    gsay_reply(617, 257);
    giq_option(4, 617, 258, Beth35, 50);
    giq_option(4, 617, 259, Beth23, 50);
    giq_option(4, 617, 394, Beth48, 50);
    giq_option(4, 617, 260, BethEnd, 50);
  Beth53: |
    gsay_reply(617, 271);
    if (global_var(108) == 2) then begin
      giq_option(4, 617, 272, Beth57, 50);
      giq_option(4, 617, 273, Beth59, 50);
    end
    else begin
      if (global_var(74) == 2) then begin
        giq_option(4, 617, 274, Beth58, 50);
      end
      else begin
        giq_option(4, 617, 275, Beth58, 50);
      end
    end
  Beth54: |
    gsay_reply(617, 276);
    if (global_var(108) == 2) then begin
      giq_option(4, 617, 277, Beth61, 50);
    end
    giq_option(4, 617, 278, Beth57, 50);
    giq_option(4, 617, 279, Beth58, 50);
  Beth55: |
    set_local_var(14, 1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      float_msg(self_obj, message_str(617, 280), 2);
    end
    else begin
      float_msg(self_obj, message_str(617, 281), 2);
    end
  Beth56: 'float_msg(self_obj, message_str(617, 282), 2);

    '
  Beth57: |
    gsay_reply(617, 283);
    call Beth60;
  Beth58: |
    gsay_reply(617, 284);
    call Beth60;
  Beth59: |
    gsay_reply(617, 285);
    call Beth60;
  Beth60: |
    giq_option(4, 617, 286, Beth35, 50);
    giq_option(4, 617, 287, Beth23, 50);
    giq_option(4, 617, 288, BethEnd, 50);
  Beth61: |
    gsay_reply(617, 289);
    call Beth60;
  Beth62: |
    gsay_message(617, random(290, 295), 50);
    if (map_var(10) == 1) then begin
      gsay_message(617, 297, 49);
      gdialog_mod_barter(5);
      gsay_reply(617, 395);
      giq_option(4, 617, 396, BethEnd, 50);
      giq_option(-3, 617, 397, BethEnd, 50);
    end
    else begin
      gdialog_mod_barter(-10);
      gsay_reply(617, 395);
      giq_option(4, 617, 396, BethEnd, 50);
      giq_option(-3, 617, 397, BethEnd, 50);
    end
  Beth63: |
    gsay_message(617, random(300, 305), 50);
    if (map_var(10) == 1) then begin
      gsay_message(617, 297, 49);
      gdialog_mod_barter(5);
      gsay_reply(617, 395);
      giq_option(4, 617, 396, BethEnd, 50);
      giq_option(-3, 617, 397, BethEnd, 50);
    end
    else begin
      gdialog_mod_barter(-10);
      gsay_reply(617, 395);
      giq_option(4, 617, 396, BethEnd, 50);
      giq_option(-3, 617, 397, BethEnd, 50);
    end
  Beth64: |
    if ((get_critter_stat(dude_obj, 3) >= 7) and (get_critter_stat(dude_obj, 34) == 0)) then begin
      if ((((game_time / (10 * 60 * 60)) - local_var(11)) <= 1) and (get_critter_stat(dude_obj, 34) == 1)) then begin
        gsay_reply(617, message_str(617, random(311, 314)) + " " + message_str(617, 315));
      end
      else begin
        if (((game_time / (10 * 60 * 60)) - local_var(11)) <= 1) then begin
          gsay_reply(617, message_str(617, random(311, 314)) + " " + message_str(617, 316));
        end
        else begin
          if ((((game_time / (10 * 60 * 60)) - local_var(11)) > 1) and (((game_time / (10 * 60 * 60)) - local_var(11)) <= 96)) then begin
            gsay_reply(617, message_str(617, random(311, 314)) + " " + message_str(617, 317));
          end
          else begin
            if ((((game_time / (10 * 60 * 60)) - local_var(11)) > 96) and (((game_time / (10 * 60 * 60)) - local_var(11)) <= 168)) then begin
              gsay_reply(617, message_str(617, random(311, 314)) + " " + message_str(617, 318));
            end
            else begin
              if ((((game_time / (10 * 60 * 60)) - local_var(11)) > 168) and (((game_time / (10 * 60 * 60)) - local_var(11)) <= 336)) then begin
                gsay_reply(617, message_str(617, random(311, 314)) + " " + message_str(617, 319));
              end
              else begin
                if (((game_time / (10 * 60 * 60)) - local_var(11)) > 336) then begin
                  gsay_reply(617, message_str(617, random(311, 314)) + " " + message_str(617, 320));
                end
              end
            end
          end
        end
      end
    end
    else begin
      if ((((game_time / (10 * 60 * 60)) - local_var(11)) <= 1) and (get_critter_stat(dude_obj, 34) == 1)) then begin
        gsay_reply(617, message_str(617, random(311, 313)) + " " + message_str(617, 315));
      end
      else begin
        if (((game_time / (10 * 60 * 60)) - local_var(11)) <= 1) then begin
          gsay_reply(617, message_str(617, random(311, 313)) + " " + message_str(617, 316));
        end
        else begin
          if ((((game_time / (10 * 60 * 60)) - local_var(11)) > 1) and (((game_time / (10 * 60 * 60)) - local_var(11)) <= 96)) then begin
            gsay_reply(617, message_str(617, random(311, 313)) + " " + message_str(617, 317));
          end
          else begin
            if ((((game_time / (10 * 60 * 60)) - local_var(11)) > 96) and (((game_time / (10 * 60 * 60)) - local_var(11)) <= 168)) then begin
              gsay_reply(617, message_str(617, random(311, 313)) + " " + message_str(617, 318));
            end
            else begin
              if ((((game_time / (10 * 60 * 60)) - local_var(11)) > 168) and (((game_time / (10 * 60 * 60)) - local_var(11)) <= 336)) then begin
                gsay_reply(617, message_str(617, random(311, 313)) + " " + message_str(617, 319));
              end
              else begin
                if (((game_time / (10 * 60 * 60)) - local_var(11)) > 336) then begin
                  gsay_reply(617, message_str(617, random(311, 313)) + " " + message_str(617, 320));
                end
              end
            end
          end
        end
      end
    end
    call Beth01;
  Beth65: |
    gsay_reply(617, random(322, 329));
    call Beth01;
  Beth66: |
    if (local_var(12) == 0) then begin
      set_local_var(12, 1);
      gsay_reply(617, 330);
    end
    else begin
      gsay_reply(617, 331);
    end
    giq_option(4, 617, 332, Beth18, 50);
    if (local_var(13) == 0) then begin
      giq_option(4, 617, 333, Beth67, 50);
    end
  Beth67: |
    variable LVar0 := 0;
    set_local_var(13, 1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(617, 334, 49);
    end
    else begin
      gsay_message(617, 335, 49);
    end
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
  Beth68: |
    set_global_var(219, 1);
    gsay_reply(617, 399);
    call Beth01;
  Beth69: |
    set_global_var(219, 1);
    gsay_reply(617, 399);
    call Beth02;
  BethEnd: "[]"
  Get_Stuff: 'move_obj_inven_to_obj(Beth_Box_Ptr, self_obj);

    '
  Put_Stuff: 'move_obj_inven_to_obj(self_obj, Beth_Box_Ptr);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
hbodgrd2:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((map_var(6) == 1) and (obj_can_see_obj(self_obj, dude_obj) == 1)) then begin
      call combat;
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    float_msg(self_obj, message_str(578, random(101, 102)), 2);
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(578, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_map_var(6, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 72);
      critter_add_trait(self_obj, 1, 5, 69);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
hchdgrd:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((map_var(6) == 1) and (obj_can_see_obj(self_obj, dude_obj) == 1)) then begin
      call combat;
    end
    if (map_var(4) == 1) then begin
      dialogue_system_enter;
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (map_var(4) == 1) then begin
      set_map_var(4, 0);
      if (local_var(6) == 0) then begin
        start_gdialog(579, self_obj, 4, -1, -1);
        gsay_start;
        call ChildGuard32;
        gsay_end;
        end_dialogue;
      end
      else begin
        call ChildGuard37;
      end
    end
    else begin
      if (global_var(255) == 1) then begin
        call ChildGuard00;
      end
      else begin
        if (map_var(0) == 1) then begin
          call ChildGuard36;
        end
        else begin
          if ((global_var(158) == 1) or (global_var(156) == 1)) then begin
            call ChildGuard01;
          end
          else begin
            if (local_var(5) == 0) then begin
              start_gdialog(579, self_obj, 4, -1, -1);
              gsay_start;
              call ChildGuard02;
              gsay_end;
              end_dialogue;
            end
            else begin
              call ChildGuard30;
            end
          end
        end
      end
    end
  destroy_p_proc: |
    set_map_var(5, 1);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(579, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_map_var(6, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 72);
      critter_add_trait(self_obj, 1, 5, 77);
    end
  ChildGuard00: |
    set_global_var(255, 1);
    float_msg(self_obj, message_str(579, 101), 2);
    call combat;
  ChildGuard01: 'float_msg(self_obj, message_str(579, 102), 2);

    '
  ChildGuard02: |
    set_local_var(5, 1);
    gsay_reply(579, 103);
    giq_option(7, 579, 104, ChildGuard03, 50);
    giq_option(4, 579, 105, ChildGuard04, 50);
    if (global_var(101) != 2) then begin
      giq_option(4, 579, 106, ChildGuard05, 49);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 579, 107, ChildGuard06, 49);
    end
    giq_option(4, 579, 108, ChildGuard02a, 49);
    giq_option(-3, 579, 109, ChildGuard09, 50);
  ChildGuard02a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0)) == 1) then begin
      call ChildGuard07;
    end
    else begin
      call ChildGuard08;
    end
  ChildGuard03: |
    gsay_reply(579, 110);
    giq_option(7, 579, 111, ChildGuard10, 50);
    giq_option(4, 579, 112, ChildGuard11, 50);
    giq_option(4, 579, 113, ChildGuard12, 50);
    giq_option(4, 579, 114, ChildGuard13, 50);
    giq_option(4, 579, 115, ChildGuard14, 51);
    giq_option(4, 579, 116, ChildGuard15, 50);
  ChildGuard04: |
    gsay_reply(579, 117);
    giq_option(7, 579, 118, ChildGuard16, 50);
    giq_option(4, 579, 119, ChildGuard17, 50);
    giq_option(4, 579, 120, ChildGuard12, 50);
    giq_option(4, 579, 121, ChildGuard18, 50);
  ChildGuard05: |
    gsay_reply(579, 122);
    giq_option(4, 579, 123, ChildGuard19, 50);
    giq_option(4, 579, 124, ChildGuard20, 51);
    giq_option(4, 579, 125, ChildGuard21, 50);
    giq_option(4, 579, 126, ChildGuard22, 50);
  ChildGuard06: |
    gsay_reply(579, 127);
    giq_option(4, 579, 128, ChildGuard23, 50);
    giq_option(4, 579, 129, ChildGuard24, 50);
    giq_option(4, 579, 130, ChildGuard25, 50);
    giq_option(4, 579, 131, ChildGuard21, 50);
  ChildGuard07: |
    gsay_reply(579, 132);
    giq_option(7, 579, 133, ChildGuard26, 50);
    giq_option(4, 579, 134, ChildGuard27, 50);
    giq_option(4, 579, 135, ChildGuard28, 50);
    if (global_var(101) != 2) then begin
      giq_option(4, 579, 136, ChildGuard29, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 579, 137, ChildGuard06, 50);
    end
  ChildGuard08: 'gsay_message(579, 138, 50);

    '
  ChildGuard09: 'gsay_message(579, 139, 50);

    '
  ChildGuard10: 'gsay_message(579, 140, 50);

    '
  ChildGuard11: 'gsay_message(579, 141, 50);

    '
  ChildGuard12: 'gsay_message(579, 142, 50);

    '
  ChildGuard13: 'gsay_message(579, 143, 50);

    '
  ChildGuard14: |
    set_global_var(255, 1);
    gsay_message(579, 144, 50);
    call combat;
  ChildGuard15: 'gsay_message(579, 145, 50);

    '
  ChildGuard16: 'gsay_message(579, 146, 50);

    '
  ChildGuard17: 'gsay_message(579, 147, 50);

    '
  ChildGuard18: 'gsay_message(579, 148, 50);

    '
  ChildGuard19: 'gsay_message(579, 149, 50);

    '
  ChildGuard20: 'gsay_message(579, 150, 50);

    '
  ChildGuard21: 'gsay_message(579, 151, 50);

    '
  ChildGuard22: 'gsay_message(579, 152, 50);

    '
  ChildGuard23: 'gsay_message(579, 153, 50);

    '
  ChildGuard24: 'gsay_message(579, 154, 50);

    '
  ChildGuard25: 'gsay_message(579, 155, 50);

    '
  ChildGuard26: 'gsay_message(579, 156, 50);

    '
  ChildGuard27: 'gsay_message(579, 157, 50);

    '
  ChildGuard28: |
    set_global_var(219, 1);
    gsay_message(579, 158, 50);
  ChildGuard29: 'gsay_message(579, 159, 50);

    '
  ChildGuard30: 'float_msg(self_obj, message_str(579, 160), 2);

    '
  ChildGuard31: |
    set_global_var(255, 1);
    gsay_message(579, 161, 50);
    call combat;
  ChildGuard32: |
    set_local_var(6, 1);
    gsay_reply(579, 162);
    giq_option(4, 579, 163, ChildGuard33, 50);
    giq_option(4, 579, 164, ChildGuard34, 50);
    giq_option(4, 579, 165, ChildGuard35, 50);
    giq_option(4, 579, 166, ChildGuard31, 50);
  ChildGuard33: 'gsay_message(579, 167, 50);

    '
  ChildGuard34: 'gsay_message(579, 168, 50);

    '
  ChildGuard35: 'gsay_message(579, 169, 50);

    '
  ChildGuard36: 'float_msg(self_obj, message_str(579, 170), 2);

    '
  ChildGuard37: |
    set_global_var(255, 1);
    call combat;
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
hdtdn2up:
  start: "[]"
  use_p_proc: |
    if (map_var(52) == 0) then begin
      move_to(dude_obj, 25539, 0);
    end
    else begin
      display_msg(message_str(628, 100));
    end
hdtvault:
  start: "[]"
  look_at_p_proc: |
    if (local_var(0) == 0) then begin
      script_overrides;
      display_msg(message_str(63, 104));
    end
  use_p_proc: |
    if ((local_var(0) == 0) and (source_obj == dude_obj)) then begin
      script_overrides;
      display_msg(message_str(63, 104));
      if (not(map_var(55) == 3)) then begin
        set_map_var(55, 1);
      end
    end
    else begin
      if (not(map_var(55) == 3)) then begin
        set_map_var(55, 2);
      end
    end
  use_skill_on_p_proc: |
    variable LVar0 := 0;
    if (local_var(0) == 0) then begin
      if (action_being_used == 9) then begin
        script_overrides;
        LVar0 := roll_vs_skill(dude_obj, 9, -40);
        if (not(map_var(55) == 3)) then begin
          set_map_var(55, 1);
        end
        if (is_success(LVar0)) then begin
          call OpenDoor;
        end
        else begin
          if (is_critical(LVar0)) then begin
            jam_lock(self_obj);
            display_msg(message_str(63, 110));
          end
          else begin
            display_msg(message_str(63, 103));
          end
        end
      end
    end
    else begin
      display_msg(message_str(63, 109));
    end
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := obj_being_used_with;
    LVar1 := roll_vs_skill(dude_obj, 9, -20);
    if (not(map_var(55) == 3)) then begin
      set_map_var(55, 1);
    end
    if (obj_pid(LVar0) == 84) then begin
      script_overrides;
      if (is_success(LVar1)) then begin
        call OpenDoor;
      end
      else begin
        if (is_critical(LVar1)) then begin
          rm_obj_from_inven(dude_obj, LVar0);
          destroy_object(LVar0);
          jam_lock(self_obj);
          display_msg(message_str(63, 110));
          display_msg(message_str(63, 101));
        end
        else begin
          display_msg(message_str(63, 103));
        end
      end
    end
  map_update_p_proc: |
    if (map_var(55) == 3) then begin
      set_local_var(0, 1);
    end
    if (local_var(0) == 1) then begin
      obj_unlock(self_obj);
    end
    else begin
      obj_lock(self_obj);
    end
  damage_p_proc: |
    if (local_var(2) == 2) then begin
      set_obj_visibility(self_obj, 1);
      set_local_var(1, 1);
      set_map_var(55, 2);
    end
    else begin
      set_local_var(2, local_var(2) + 1);
      set_map_var(55, 2);
    end
  OpenDoor: |
    obj_unlock(self_obj);
    set_local_var(0, 1);
    set_map_var(55, 2);
    display_msg(message_str(63, 100));
    display_msg(message_str(766, 103) + "45" + message_str(766, 104));
    give_exp_points(45);
heather:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 69);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (global_var(129) == 2) then begin
      kill_critter(self_obj, 57);
    end
    else begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  destroy_p_proc: |
    set_global_var(133, 2);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(266, 100));
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    script_overrides;
    call get_reaction;
    if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
      start_gdialog(266, self_obj, 4, -1, -1);
      gsay_start;
      call heather0;
      gsay_end;
      end_dialogue;
    end
    else begin
      call heather28;
    end
  heather0: |
    gsay_reply(266, 101);
    giq_option(-3, 266, 102, combat, 50);
    giq_option(-3, 266, 103, HeatherEnd, 50);
    giq_option(4, 266, 104, heather0a, 50);
    giq_option(4, 266, 105, combat, 50);
    giq_option(6, 266, 106, heather0b, 50);
  heather0a: |
    if (local_var(1) < 2) then begin
      call heather19;
    end
    else begin
      call heather1;
    end
  heather0b: |
    if (local_var(1) < 2) then begin
      call heather27;
    end
    else begin
      call heather21;
    end
  heather1: |
    gsay_reply(266, 107);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      giq_option(4, 266, 108, heather2, 50);
    end
    if (global_var(133) == 1) then begin
      giq_option(4, 266, 109, heather1a, 50);
    end
    giq_option(4, 266, 110, heather19, 50);
    giq_option(4, 266, 111, heather20, 50);
  heather1a: |
    call BigDownReact;
    call heather3;
  heather2: 'gsay_message(266, 112, 50);

    '
  heather3: |
    gsay_reply(266, 113);
    giq_option(5, 266, 114, heather3a, 50);
    giq_option(4, 266, 115, heather3b, 50);
    giq_option(4, 266, 116, heather3c, 50);
    giq_option(4, 266, 117, HeatherEnd, 50);
  heather3a: |
    call DownReact;
    call heather4;
  heather3b: |
    call UpReact;
    call heather10;
  heather3c: |
    call BigDownReact;
    call heather8;
  heather4: |
    gsay_reply(266, 118);
    giq_option(5, 266, 119, heather5, 50);
    giq_option(6, 266, 120, heather10, 50);
    giq_option(7, 266, 121, heather17, 50);
  heather5: |
    gsay_reply(266, 122);
    giq_option(5, 266, 123, heather5a, 50);
    giq_option(5, 266, 124, heather7, 50);
    giq_option(6, 266, 125, heather9, 50);
  heather5a: |
    call BigUpReact;
    call heather6;
  heather6: 'gsay_message(266, 126, 50);

    '
  heather7: |
    gsay_reply(266, 127);
    giq_option(4, 266, 128, heather6, 50);
    giq_option(4, 266, 129, heather8, 50);
  heather8: |
    gsay_message(266, 130, 50);
    call combat;
  heather9: |
    gsay_reply(266, 131);
    giq_option(4, 266, 132, heather6, 50);
    giq_option(4, 266, 133, heather8, 50);
  heather10: |
    gsay_reply(266, 134);
    giq_option(4, 266, 135, heather11, 50);
    giq_option(5, 266, 136, heather12, 50);
    giq_option(4, 266, 137, HeatherEnd, 50);
  heather11: |
    gsay_reply(266, 138);
    giq_option(4, 266, 139, HeatherEnd, 50);
  heather12: |
    gsay_reply(266, 140);
    giq_option(4, 266, 141, heather6, 50);
    giq_option(4, 266, 142, heather13, 50);
    giq_option(4, 266, 143, HeatherEnd, 50);
  heather13: |
    gsay_reply(266, 144);
    giq_option(4, 266, 145, heather14, 50);
    giq_option(4, 266, 146, heather15, 50);
    giq_option(4, 266, 147, heather16, 50);
  heather14: |
    gsay_reply(266, 148);
    giq_option(4, 266, 149, heather6, 50);
    giq_option(4, 266, 150, heather8, 50);
  heather15: |
    gsay_reply(266, 151);
    giq_option(4, 266, 152, heather8, 50);
    giq_option(4, 266, 153, combat, 50);
  heather16: 'gsay_message(266, 154, 50);

    '
  heather17: |
    gsay_reply(266, 155);
    giq_option(4, 266, 156, heather8, 50);
    giq_option(4, 266, 157, heather18, 50);
  heather18: |
    gsay_reply(266, 158);
    giq_option(4, 266, 159, heather8, 50);
    giq_option(4, 266, 160, heather6, 50);
  heather19: 'gsay_message(266, 161, 50);

    '
  heather20: 'gsay_message(266, 162, 50);

    '
  heather21: |
    gsay_reply(266, 163);
    giq_option(6, 266, 164, heather22, 50);
    giq_option(6, 266, 165, heather26, 50);
    giq_option(6, 266, 166, heather25, 50);
  heather22: |
    gsay_reply(266, 167);
    giq_option(6, 266, 168, heather22a, 50);
    giq_option(6, 266, 169, heather25, 50);
  heather22a: |
    variable LVar0 := 0;
    if (item_caps_total(dude_obj) >= 300) then begin
      item_caps_adjust(dude_obj, -300);
      item_caps_adjust(self_obj, 300);
      call heather23;
    end
    else begin
      call heather24;
    end
  heather23: 'gsay_message(266, 170, 50);

    '
  heather24: |
    gsay_message(266, 171, 50);
    call combat;
  heather25: 'gsay_message(266, 172, 50);

    '
  heather26: |
    gsay_reply(266, 173);
    giq_option(6, 266, 174, heather22a, 50);
    giq_option(6, 266, 175, heather25, 50);
  heather27: 'gsay_message(266, 176, 50);

    '
  heather28: 'float_msg(self_obj, message_str(266, 177), 0);

    '
  HeatherEnd: "[]"
  combat: 'hostile := 1;

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
hgencvan:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 64);
      critter_add_trait(self_obj, 1, 5, 50);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (map_var(2) == 0) then begin
      call Caravan02;
    end
    else begin
      call Caravan01;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(609, 100));
  Caravan01: 'float_msg(self_obj, message_str(609, random(101, 111)), 2);

    '
  Caravan02: 'float_msg(self_obj, message_str(609, random(112, 122)), 2);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
hgenfarm:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 65);
      critter_add_trait(self_obj, 1, 5, 51);
      home_tile := 21461;
      sleep_tile := 26672;
    end
  critter_p_proc: |
    if (hostile and obj_can_see_obj(self_obj, dude_obj)) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((game_time_hour >= 600) and (game_time_hour < 1800)) then begin
      if (Sleeping == 1) then begin
        reg_anim_func(2, self_obj);
        Sleeping := 0;
        if ((tile_num(self_obj) != home_tile) and ((game_time_hour - 600) > 10)) then begin
          move_to(self_obj, home_tile, elevation(self_obj));
        end
      end
      else begin
        if ((tile_distance(home_tile, tile_num(self_obj)) > 8) and not(anim_busy(self_obj))) then begin
          animate_move_obj_to_tile(self_obj, home_tile, 0);
        end
        else begin
          if (not(in_timed_event)) then begin
            in_timed_event := 1;
            add_timer_event(self_obj, game_ticks(random(20, 30)), 1);
          end
        end
      end
    end
    else begin
      if (Sleeping == 0) then begin
        reg_anim_func(2, self_obj);
        Sleeping := 1;
        if ((tile_num(self_obj) != sleep_tile) and ((game_time_hour - 1800) > 10) or ((600 - game_time_hour) > 0)) then begin
          move_to(self_obj, sleep_tile, elevation(self_obj));
        end
      end
      else begin
        if ((tile_num(self_obj) != sleep_tile) and not(anim_busy(self_obj))) then begin
          animate_move_obj_to_tile(self_obj, sleep_tile, 0);
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if ((game_time_hour >= 600) and (game_time_hour < 1800)) then begin
      call Farmer00;
    end
    else begin
      call Farmer01;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(580, 100));
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      in_timed_event := 0;
      if ((game_time_hour >= 600) and (game_time_hour < 1800)) then begin
        animate_move_obj_to_tile(self_obj, tile_num_in_direction(home_tile, random(0, 5), random(1, 8)), 0);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  Farmer00: |
    variable LVar0 := 0;
    if (global_var(5) == 1) then begin
      LVar0 := random(101, 109);
      if (LVar0 == 108) then begin
        LVar0 := 109;
      end
      float_msg(self_obj, message_str(580, LVar0), 3);
    end
    else begin
      float_msg(self_obj, message_str(580, random(101, 108)), 3);
    end
  Farmer01: 'float_msg(self_obj, message_str(580, random(110, 114)), 3);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
hhooker:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    float_msg(self_obj, message_str(708, random(135, 148)), 2);
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(708, 102));
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 38);
      critter_add_trait(self_obj, 1, 5, 11);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
hicraps:
  start: "[]"
  map_enter_p_proc: "[]"
higheld:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 80);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 3)) then begin
      if ((map_var(19) == 1) and (local_var(5) == 0)) then begin
        dialogue_system_enter;
      end
    end
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (global_var(17) == 1) then begin
      start_gdialog(942, self_obj, 4, -1, -1);
      gsay_start;
      call Elder10;
      gsay_end;
      end_dialogue;
    end
    else begin
      if ((map_var(19) == 1) and (local_var(5) == 0)) then begin
        set_local_var(5, 1);
        start_gdialog(942, self_obj, 4, -1, -1);
        gsay_start;
        call Meeting01;
        gsay_end;
        end_dialogue;
      end
      else begin
        if (local_var(1) == 1) then begin
          call Elder12;
        end
        else begin
          if (local_var(5) == 1) then begin
            float_msg(self_obj, message_str(942, 165), 2);
          end
          else begin
            if (local_var(4) == 0) then begin
              set_local_var(4, 1);
              start_gdialog(942, self_obj, 4, -1, -1);
              gsay_start;
              call Elder01;
              gsay_end;
              end_dialogue;
            end
            else begin
              start_gdialog(942, self_obj, 4, -1, -1);
              gsay_start;
              call Elder04;
              gsay_end;
              end_dialogue;
            end
          end
        end
      end
    end
    if (awardex) then begin
      if (local_var(6) == 0) then begin
        set_local_var(6, 1);
        temp := 1500;
        display_msg(message_str(942, 166) + temp + message_str(942, 167));
        give_exp_points(temp);
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(942, 100));
  Meeting01: |
    gsay_reply(942, message_str(942, 134) + proto_data(obj_pid(dude_obj), 1) + message_str(942, 135) + proto_data(obj_pid(dude_obj), 1) + message_str(942, 136));
    giq_option(4, 942, 137, Meeting02, 50);
    giq_option(-3, 942, 138, Meeting13, 51);
  Meeting02: |
    gsay_reply(942, 139);
    giq_option(6, 942, 140, Meeting02a, 50);
    giq_option(4, 942, 141, Meeting04, 50);
  Meeting02a: |
    if (global_var(166) == 1) then begin
      call Meeting03;
    end
    else begin
      call Meeting04;
    end
  Meeting03: |
    gsay_reply(942, 142);
    giq_option(6, 942, 143, Meeting04, 50);
  Meeting04: |
    gsay_reply(942, 144);
    giq_option(4, 942, 145, Meeting05, 50);
    giq_option(-3, 942, 138, Meeting13, 51);
  Meeting05: |
    gsay_reply(942, 146);
    if (global_var(13) == 1) then begin
      giq_option(4, 942, 147, Meeting06, 50);
    end
    giq_option(4, 942, 148, Meeting05a, 50);
  Meeting05a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Meeting06;
    end
    else begin
      call Meeting07;
    end
  Meeting06: |
    gsay_reply(942, 149);
    giq_option(4, 942, 150, Meeting08, 50);
  Meeting07: |
    gsay_reply(942, 151);
    giq_option(4, 942, message_str(942, 152) + message_str(942, 153), Meeting08, 50);
  Meeting08: |
    gsay_reply(942, 154);
    giq_option(4, 942, 155, Meeting09, 50);
    if ((global_var(79) == 2) and (global_var(18) == 0)) then begin
      giq_option(4, 942, 156, Meeting10, 50);
    end
  Meeting09: |
    awardex := 1;
    set_global_var(223, 2);
    gsay_message(942, 157, 50);
  Meeting10: |
    gsay_reply(942, message_str(942, 158) + message_str(942, 159));
    giq_option(4, 942, 160, Meeting09, 50);
    giq_option(4, 942, 161, Meeting11, 50);
    giq_option(-3, 942, 138, Meeting13, 51);
  Meeting11: |
    awardex := 1;
    set_global_var(223, 1);
    gsay_message(942, 162, 50);
  Meeting13: 'gsay_message(942, 164, 51);

    '
  Elder01: |
    gsay_reply(942, 101);
    giq_option(4, 942, 102, Elder02, 50);
    giq_option(4, 942, 103, Elder08, 50);
    giq_option(-3, 942, 104, Elder11, 51);
  Elder02: |
    gsay_reply(942, message_str(942, 105) + message_str(942, 106) + message_str(942, 107));
    giq_option(4, 942, 108, Elder03, 50);
    giq_option(4, 942, 109, Elder09, 50);
    if (global_var(78) == 2) then begin
      giq_option(4, 942, 110, Elder07, 50);
    end
  Elder03: |
    gsay_reply(942, 111);
    giq_option(4, 942, 112, ElderEnd, 50);
  Elder04: |
    gsay_reply(942, 113);
    if (global_var(78) == 2) then begin
      giq_option(4, 942, 114, Elder05, 50);
    end
    else begin
      giq_option(4, 942, 115, Elder06, 50);
    end
  Elder05: |
    gsay_reply(942, 116);
    giq_option(4, 942, 117, Elder07, 50);
  Elder06: |
    gsay_reply(942, 118);
    giq_option(4, 942, 119, ElderEnd, 50);
  Elder07: |
    gsay_reply(942, 120);
    giq_option(4, 942, 121, ElderEnd, 50);
  Elder07a: 'set_local_var(1, 1);

    '
  Elder08: |
    gsay_reply(942, 122);
    giq_option(4, 942, 123, Elder02, 50);
    giq_option(4, 942, 124, Elder07a, 51);
    giq_option(4, 942, 125, Elder07a, 51);
  Elder09: |
    gsay_reply(942, 126);
    giq_option(4, 942, 127, ElderEnd, 50);
  Elder10: 'gsay_message(942, 128, 50);

    '
  Elder11: 'gsay_message(942, 130, 51);

    '
  Elder12: 'float_msg(self_obj, message_str(942, random(131, 133)), 2);

    '
  ElderEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
hightowr:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (visible == 0) then begin
      script_overrides;
    end
    else begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      if (map_var(5) == 1) then begin
        if ((obj_can_hear_obj(self_obj, dude_obj) == 1) or (obj_can_see_obj(self_obj, dude_obj) == 1)) then begin
          call combat;
        end
      end
      else begin
        if ((game_time_hour >= 600) and (game_time_hour < 700) or ((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
          if (tile_num(self_obj) != 25125) then begin
            animate_move_obj_to_tile(self_obj, 25125, 0);
          end
          else begin
            if ((tile_num(dude_obj) == 24522) and (map_var(1) == 0)) then begin
              dialogue_system_enter;
            end
          end
        end
        else begin
          if (tile_num(self_obj) != 24708) then begin
            animate_move_obj_to_tile(self_obj, 24708, 0);
          end
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      float_msg(self_obj, message_str(582, 127), 2);
      call combat;
    end
    else begin
      if (global_var(248) == 1) then begin
        float_msg(self_obj, message_str(582, 127), 2);
        call combat;
      end
      else begin
        if (local_var(4) == 0) then begin
          set_local_var(4, 1);
          start_gdialog(582, self_obj, 4, -1, -1);
          gsay_start;
          call Daren01;
          gsay_end;
          end_dialogue;
        end
        else begin
          float_msg(self_obj, message_str(582, 127), 2);
          call combat;
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    set_map_var(0, map_var(0) + 1);
    if (map_var(0) > 1) then begin
      set_global_var(111, 2);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(582, 100));
  damage_p_proc: |
    set_map_var(5, 1);
    set_global_var(111, 5);
  combat_p_proc: 'critter_set_flee_state(self_obj, 1);

    '
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      if (global_var(111) == 5) then begin
        set_obj_visibility(self_obj, 1);
        visible := 0;
      end
      critter_add_trait(self_obj, 1, 6, 42);
      critter_add_trait(self_obj, 1, 5, 5);
    end
  Daren01: |
    gsay_reply(582, 101);
    giq_option(4, 582, 102, Daren02, 50);
    if (global_var(111) == 1) then begin
      giq_option(4, 582, 103, Daren03, 50);
    end
    giq_option(4, 582, message_str(582, 104) + proto_data(obj_pid(dude_obj), 1) + message_str(582, 105), Daren04, 50);
    giq_option(4, 582, 106, Daren07, 50);
    giq_option(4, 582, 107, Daren06, 50);
    giq_option(-3, 582, 108, Daren06, 50);
  Daren02: |
    gsay_reply(582, 109);
    if (global_var(111) == 1) then begin
      giq_option(4, 582, 110, DarenCombat, 51);
    end
    giq_option(4, 582, 111, Daren05, 50);
    giq_option(4, 582, 112, Daren06, 50);
    giq_option(4, 582, 113, Daren06, 50);
  Daren03: |
    gsay_reply(582, 114);
    giq_option(4, 582, 115, Daren06, 50);
    giq_option(4, 582, 116, Daren07, 50);
    giq_option(4, 582, 117, DarenCombat, 51);
    giq_option(4, 582, 118, Daren06, 50);
  Daren04: |
    gsay_message(582, message_str(582, 119) + proto_data(obj_pid(dude_obj), 1) + message_str(582, 120), 51);
    call DarenEndLeon;
  Daren05: |
    gsay_reply(582, 121);
    giq_option(4, 582, 122, Daren07, 50);
    if (item_caps_total(dude_obj) >= 100) then begin
      giq_option(4, 582, 123, Daren05a, 50);
    end
    giq_option(4, 582, 124, Daren06, 50);
  Daren05a: |
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, -100);
    gsay_message(582, 125, 51);
    call DarenEndLeon;
  Daren06: |
    gsay_message(582, 126, 51);
    call DarenEndLeon;
  Daren07: |
    gsay_message(582, 127, 51);
    call DarenCombat;
  DarenCombat: 'call combat;

    '
  DarenEndLeon: 'set_map_var(1, 1);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
hopehub:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(970, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(970, 101));
  damage_p_proc: |
    set_global_var(248, 1);
    if (get_critter_stat(dude_obj, 34) == 1) then begin
      float_msg(self_obj, message_str(970, 103), 2);
    end
    else begin
      float_msg(self_obj, message_str(970, 102), 2);
    end
  critter_p_proc: |
    if (global_var(248) == 1) then begin
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if ((((game_time / 10) - lastPsst) >= 10) and (tile_distance_objs(self_obj, dude_obj) <= 3)) then begin
        lastPsst := game_time / 10;
        float_msg(self_obj, message_str(970, 103 + random(1, 5)), 0);
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(248, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  talk_p_proc: 'float_msg(self_obj, message_str(970, 109), 2);

    '
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 41);
      critter_add_trait(self_obj, 1, 5, 5);
    end
hotspot:
  start: "[]"
  spatial_p_proc: |
    Rads := random(20, 50);
    radiation_inc(dude_obj, Rads);
houschar:
  start: |
    variable LVar0 := 0;
    if (script_action == 6) then begin
      call use_p_proc;
    end
    else begin
      if (script_action == 3) then begin
        call description_p_proc;
      end
      else begin
        if (script_action == 21) then begin
          call look_at_p_proc;
        end
      end
    end
  use_p_proc: |
    script_overrides;
    display_msg(message_str(116, 102));
  chairend: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(116, 101));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(116, 100));
htwrbox:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(0) == 0) then begin
      display_msg(message_str(872, 100));
    end
    else begin
      display_msg(message_str(872, 101));
    end
  use_p_proc: |
    if (local_var(0) == 0) then begin
      script_overrides;
      display_msg(message_str(872, 102));
    end
    else begin
      if (local_var(1) == 0) then begin
        script_overrides;
        if (local_var(2) == 0) then begin
          test := roll_vs_skill(dude_obj, 11, 0);
          if (is_success(test)) then begin
            reg_anim_func(2, source_obj);
            test := roll_vs_skill(dude_obj, 11, 0);
            if (is_success(test)) then begin
              set_local_var(2, 1);
              set_local_var(1, 1);
              display_msg(message_str(872, 103));
            end
            else begin
              if (is_critical(test)) then begin
                set_local_var(2, 1);
                set_local_var(1, 1);
                display_msg(message_str(872, 104));
                call set_off_trap;
              end
              else begin
                set_local_var(2, 1);
                set_local_var(1, 0);
                display_msg(message_str(872, 105));
              end
            end
          end
          else begin
            set_local_var(1, 1);
            call set_off_trap;
          end
        end
        else begin
          set_local_var(1, 1);
          call set_off_trap;
        end
      end
    end
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 84) then begin
      if (local_var(0) == 0) then begin
        script_overrides;
        test := roll_vs_skill(dude_obj, 9, 0);
        if (is_success(test)) then begin
          set_local_var(0, 1);
          display_msg(message_str(872, 107));
          set_local_var(3, local_var(3) + 1);
          if ((local_var(3) >= 3) and (local_var(1) == 0)) then begin
            display_msg(message_str(872, 108));
            set_local_var(1, 1);
            call set_off_trap;
          end
        end
        else begin
          if (is_critical(test)) then begin
            jam_lock(self_obj);
            display_msg(message_str(872, 109));
            set_local_var(3, local_var(3) + 1);
            if ((local_var(3) >= 3) and (local_var(1) == 0)) then begin
              display_msg(message_str(872, 108));
              set_local_var(1, 1);
              call set_off_trap;
            end
          end
          else begin
            display_msg(message_str(872, 110));
            set_local_var(3, local_var(3) + 1);
            if ((local_var(3) >= 3) and (local_var(1) == 0)) then begin
              display_msg(message_str(872, 108));
              set_local_var(1, 1);
              call set_off_trap;
            end
          end
        end
      end
      else begin
        display_msg(message_str(872, 106));
      end
    end
  use_skill_on_p_proc: |
    if (action_being_used == 9) then begin
      if (local_var(0) == 0) then begin
        script_overrides;
        test := roll_vs_skill(dude_obj, 9, -20);
        if (is_success(test)) then begin
          set_local_var(0, 1);
          display_msg(message_str(872, 107));
          set_local_var(3, local_var(3) + 1);
          if ((local_var(3) >= 3) and (local_var(1) == 0)) then begin
            display_msg(message_str(872, 108));
            set_local_var(1, 1);
            call set_off_trap;
          end
        end
        else begin
          if (is_critical(test)) then begin
            jam_lock(self_obj);
            display_msg(message_str(872, 109));
            set_local_var(3, local_var(3) + 1);
            if ((local_var(3) >= 3) and (local_var(1) == 0)) then begin
              display_msg(message_str(872, 108));
              set_local_var(1, 1);
              call set_off_trap;
            end
          end
          else begin
            display_msg(message_str(872, 110));
            set_local_var(3, local_var(3) + 1);
            if ((local_var(3) >= 3) and (local_var(1) == 0)) then begin
              display_msg(message_str(872, 108));
              set_local_var(1, 1);
              call set_off_trap;
            end
          end
        end
      end
      else begin
        display_msg(message_str(872, 106));
      end
    end
    else begin
      if (action_being_used == 11) then begin
        if (local_var(2) == 0) then begin
          test := roll_vs_skill(dude_obj, 11, 0);
          if (is_success(test)) then begin
            if (is_critical(test)) then begin
              script_overrides;
              display_msg(message_str(872, 111));
              set_local_var(2, 1);
              set_local_var(1, 1);
            end
            else begin
              script_overrides;
              display_msg(message_str(872, 112));
              set_local_var(2, 1);
            end
          end
          else begin
            if (is_critical(test)) then begin
              script_overrides;
              display_msg(message_str(872, 113));
              set_local_var(1, 1);
              call set_off_trap;
            end
            else begin
              script_overrides;
              display_msg(message_str(872, 114));
            end
          end
        end
        else begin
          script_overrides;
          test := roll_vs_skill(dude_obj, 11, 0);
          if (is_success(test)) then begin
            display_msg(message_str(872, 115));
            set_local_var(1, 1);
          end
          else begin
            if (is_critical(test)) then begin
              display_msg(message_str(872, 116));
              set_local_var(1, 1);
              call set_off_trap;
            end
            else begin
              display_msg(message_str(872, 117));
            end
          end
        end
      end
    end
  set_off_trap: |
    explosion(tile_num(self_obj), elevation(self_obj), random(6, 36));
    set_local_var(0, 1);
    set_local_var(1, 1);
    obj_unlock(self_obj);
    obj_open(self_obj);
htwrgrd:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (visible == 0) then begin
      script_overrides;
    end
    else begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      if (map_var(5) == 1) then begin
        if ((obj_can_hear_obj(self_obj, dude_obj) == 1) or (obj_can_see_obj(self_obj, dude_obj) == 1)) then begin
          call combat;
        end
      end
      else begin
        if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
          if ((obj_can_hear_obj(self_obj, dude_obj) == 1) or (obj_can_see_obj(self_obj, dude_obj) == 1) and (threatened == 0)) then begin
            dialogue_system_enter;
          end
          if (guardNumber == 1) then begin
            if (tile_num(self_obj) != 17119) then begin
              animate_move_obj_to_tile(self_obj, 17119, 0);
            end
          end
          else begin
            if (guardNumber == 2) then begin
              if (tile_num(self_obj) != 16930) then begin
                animate_move_obj_to_tile(self_obj, 16930, 0);
              end
            end
          end
        end
        else begin
          if (guardNumber == 1) then begin
            if (tile_num(self_obj) != 19511) then begin
              animate_move_obj_to_tile(self_obj, 19511, 0);
            end
          end
          else begin
            if (guardNumber == 2) then begin
              if (tile_num(self_obj) != 19935) then begin
                animate_move_obj_to_tile(self_obj, 19935, 0);
              end
            end
          end
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if ((game_time_hour > 700) and (game_time_hour < 1900)) then begin
      float_msg(self_obj, message_str(583, random(101, 106)), 2);
    end
    else begin
      threatened := 1;
      float_msg(self_obj, message_str(583, random(107, 109)), 2);
      call combat;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(583, 100));
  damage_p_proc: 'set_map_var(5, 1);

    '
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      if (tile_num(self_obj) == 19511) then begin
        guardNumber := 1;
      end
      if (tile_num(self_obj) == 19935) then begin
        guardNumber := 2;
      end
      if (global_var(111) == 5) then begin
        set_obj_visibility(self_obj, 1);
        visible := 0;
      end
      critter_add_trait(self_obj, 1, 6, 42);
      critter_add_trait(self_obj, 1, 5, 16);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
htwrgrge:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (visible == 0) then begin
      script_overrides;
    end
    else begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      if (map_var(5) == 1) then begin
        if ((obj_can_hear_obj(self_obj, dude_obj) == 1) or (obj_can_see_obj(self_obj, dude_obj) == 1)) then begin
          call combat;
        end
      end
      else begin
        if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
          if ((obj_can_hear_obj(self_obj, dude_obj) == 1) or (obj_can_see_obj(self_obj, dude_obj) == 1)) then begin
            dialogue_system_enter;
          end
        end
        else begin
          if (map_var(2) == 1) then begin
            dialogue_system_enter;
          end
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      float_msg(self_obj, message_str(870, 118), 2);
      call combat;
    end
    else begin
      if (global_var(248) == 1) then begin
        float_msg(self_obj, message_str(870, 120), 2);
        call combat;
      end
      else begin
        if (map_var(2) == 1) then begin
          set_map_var(2, 0);
          call George08;
        end
        else begin
          if (hereBefore == 0) then begin
            hereBefore := 1;
            start_gdialog(870, self_obj, 4, -1, -1);
            gsay_start;
            call George01;
            gsay_end;
            end_dialogue;
          end
          else begin
            call George07;
          end
        end
      end
    end
  destroy_p_proc: |
    set_map_var(4, 1);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(870, 100));
  damage_p_proc: 'set_map_var(5, 1);

    '
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      set_map_var(3, 0);
      if (global_var(111) == 5) then begin
        set_obj_visibility(self_obj, 1);
        visible := 0;
        set_map_var(3, 1);
      end
      critter_add_trait(self_obj, 1, 6, 42);
      critter_add_trait(self_obj, 1, 5, 16);
    end
  map_update_p_proc: |
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      if ((global_var(111) == 1) or (global_var(107) == 1)) then begin
        set_map_var(3, 1);
        if (((game_time / 10) - lastTraverse) >= 30) then begin
          lastTraverse := game_time / 10;
          if (currentLocation == 0) then begin
            currentLocation := 1;
            animate_move_obj_to_tile(self_obj, 19516, 0);
          end
          else begin
            currentLocation := 0;
            animate_move_obj_to_tile(self_obj, 22529, 0);
          end
        end
      end
      else begin
        if (tile_num(self_obj) != 22529) then begin
          animate_move_obj_to_tile(self_obj, 22529, 0);
        end
      end
    end
  George01: |
    gsay_reply(870, 101);
    giq_option(4, 870, 103, George01a, 50);
    giq_option(4, 870, 104, George01b, 50);
    giq_option(4, 870, 105, George06, 50);
    giq_option(-3, 870, 102, George06, 50);
  George01a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call George03;
    end
    else begin
      call George02;
    end
  George01b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 10))) then begin
      call George05;
    end
    else begin
      call George02;
    end
  George02: |
    gsay_reply(870, 106);
    giq_option(4, 870, 107, George02a, 50);
    giq_option(4, 870, 108, George06, 50);
    giq_option(4, 870, 109, George03, 50);
    giq_option(4, 870, 110, GeorgeEnd, 50);
  George02a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call George03;
    end
    else begin
      call George04;
    end
  George03: |
    set_map_var(3, 1);
    gsay_message(870, 111, 50);
  George04: 'gsay_message(870, 112, 51);

    '
  George05: |
    set_map_var(3, 1);
    gsay_message(870, 113, 50);
  George06: 'gsay_message(870, 114, 51);

    '
  George07: 'float_msg(self_obj, message_str(870, random(114, 117)), 2);

    '
  George08: 'float_msg(self_obj, message_str(870, 119), 2);

    '
  GeorgeEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
htwrleon:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (visible == 0) then begin
      script_overrides;
    end
    else begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      if (map_var(5) == 1) then begin
        if ((obj_can_hear_obj(self_obj, dude_obj) == 1) or (obj_can_see_obj(self_obj, dude_obj) == 1)) then begin
          call combat;
        end
      end
      else begin
        if (map_var(1) == 1) then begin
          call LeonPerformDump;
        end
      end
      if ((game_time_hour >= 600) and (game_time_hour < 700) or ((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
        if (tile_num(self_obj) != 22120) then begin
          animate_move_obj_to_tile(self_obj, 22120, 0);
        end
      end
      else begin
        if (tile_num(self_obj) != 16519) then begin
          animate_move_obj_to_tile(self_obj, 16519, 0);
        end
      end
      if (tile_distance_objs(self_obj, dude_obj) < 6) then begin
        if ((local_var(5) == 0) and (tile_num(self_obj) == 22120)) then begin
          set_local_var(5, 1);
          dialogue_system_enter;
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      float_msg(self_obj, message_str(866, 141), 2);
    end
    else begin
      if (global_var(248) == 1) then begin
        float_msg(self_obj, message_str(866, 142), 2);
        call combat;
      end
      else begin
        if (local_var(4) == 0) then begin
          set_local_var(4, 1);
          start_gdialog(866, self_obj, 4, -1, -1);
          gsay_start;
          call Leon01;
          gsay_end;
          end_dialogue;
        end
        else begin
          start_gdialog(866, self_obj, 4, -1, -1);
          gsay_start;
          call Leon08;
          gsay_end;
          end_dialogue;
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(866, 100));
  damage_p_proc: 'set_map_var(5, 1);

    '
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      if (global_var(111) == 5) then begin
        set_obj_visibility(self_obj, 1);
        visible := 0;
      end
      critter_add_trait(self_obj, 1, 6, 42);
      critter_add_trait(self_obj, 1, 5, 16);
    end
  Leon01: |
    gsay_reply(866, 101);
    giq_option(4, 866, 102, Leon01a, 50);
    giq_option(4, 866, 103, LeonCombat, 51);
    giq_option(4, 866, 104, Leon03, 50);
    if (global_var(111) == 1) then begin
      giq_option(4, 866, 140, Leon04, 50);
    end
    giq_option(-3, 866, 138, Leon09, 50);
  Leon01a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Leon02;
    end
    else begin
      call Leon04;
    end
  Leon02: |
    gsay_reply(866, 105);
    giq_option(4, 866, 106, LeonEnd, 50);
    giq_option(4, 866, 107, Leon03, 50);
  Leon03: |
    gsay_reply(866, 108);
    giq_option(4, 866, 109, LeonCombat, 51);
    giq_option(4, 866, 110, LeonKickOut, 50);
    giq_option(4, 866, 111, LeonCombat, 51);
  Leon04: |
    gsay_reply(866, 112);
    giq_option(4, 866, 113, Leon03, 50);
    giq_option(4, 866, 114, Leon04a, 50);
    if (global_var(111) == 1) then begin
      giq_option(4, 866, 115, Leon06, 50);
    end
  Leon04a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Leon02;
    end
    else begin
      call Leon05;
    end
  Leon05: |
    gsay_reply(866, 116);
    giq_option(4, 866, 117, Leon03, 50);
    if (global_var(111) == 1) then begin
      giq_option(4, 866, 118, Leon06, 50);
    end
    giq_option(4, 866, 119, Leon03, 50);
    giq_option(4, 866, 120, LeonKickOut, 50);
  Leon06: |
    gsay_message(866, 121, 50);
    gsay_message(866, 122, 50);
    gsay_reply(866, 123);
    giq_option(4, 866, 124, Leon07, 50);
    giq_option(4, 866, 125, LeonCombat, 51);
    giq_option(4, 866, 126, Leon03, 50);
  Leon07: |
    gsay_reply(866, 127);
    giq_option(4, 866, 128, Leon03, 50);
    giq_option(4, 866, 129, LeonKickOut, 50);
  Leon08: |
    gsay_reply(866, 130);
    giq_option(4, 866, 131, LeonCombat, 51);
    giq_option(4, 866, 132, LeonKickOut, 50);
    giq_option(4, 866, 133, Leon08a, 50);
  Leon08a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call Leon02;
    end
    else begin
      call Leon04;
    end
  Leon09: |
    gsay_reply(866, 134);
    giq_option(4, 866, 135, LeonCombat, 51);
    giq_option(4, 866, 136, LeonKickOut, 50);
    giq_option(4, 866, 137, LeonKickOut, 50);
    giq_option(-3, 866, 139, LeonKickOut, 50);
  LeonEnd: "[]"
  LeonKickOut: 'set_map_var(1, 1);

    '
  LeonPerformDump: |
    set_map_var(1, 0);
    set_map_var(3, 0);
    gfade_out(1000);
    obj_close(Front_Door_Ptr);
    set_local_var(5, 0);
    move_to(dude_obj, 21931, 0);
    gfade_in(1000);
  LeonCombat: |
    set_local_var(5, 1);
    call combat;
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
htwrrick:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (visible == 0) then begin
      script_overrides;
    end
    else begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      if (map_var(5) == 1) then begin
        if ((obj_can_hear_obj(self_obj, dude_obj) == 1) or (obj_can_see_obj(self_obj, dude_obj) == 1)) then begin
          call combat;
        end
      end
      else begin
        if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
          if ((tile_distance_objs(self_obj, dude_obj) <= 7) and (nightWarned == 0)) then begin
            nightWarned := 1;
            dialogue_system_enter;
          end
          if (tile_num(self_obj) != 19713) then begin
            animate_move_obj_to_tile(self_obj, 19713, 0);
          end
        end
        else begin
          if (tile_num(self_obj) != 17892) then begin
            animate_move_obj_to_tile(self_obj, 17892, 0);
          end
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      start_gdialog(871, self_obj, 4, -1, -1);
      gsay_start;
      call Rick09;
      gsay_end;
      end_dialogue;
    end
    else begin
      start_gdialog(871, self_obj, 4, -1, -1);
      gsay_start;
      call Rick01;
      gsay_end;
      end_dialogue;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(871, 100));
  damage_p_proc: 'set_map_var(5, 1);

    '
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      if (global_var(111) == 5) then begin
        set_obj_visibility(self_obj, 1);
        visible := 0;
      end
      critter_add_trait(self_obj, 1, 6, 42);
      critter_add_trait(self_obj, 1, 5, 16);
    end
  Rick01: |
    gsay_reply(871, 101);
    giq_option(4, 871, 103, Rick03, 50);
    giq_option(4, 871, 104, Rick04, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 871, 105, Rick08, 51);
    end
    giq_option(-3, 871, 102, Rick02, 50);
  Rick02: |
    gsay_reply(871, 106);
    giq_option(-3, 871, 107, Rick10, 50);
    giq_option(-3, 871, 108, RickEnd, 50);
  Rick03: |
    gsay_reply(871, 109);
    giq_option(4, 871, 110, Rick05, 50);
    giq_option(4, 871, 111, Rick06, 50);
    giq_option(4, 871, 112, RickEnd, 50);
  Rick04: |
    gsay_reply(871, 113);
    giq_option(4, 871, 114, RickCombat, 51);
    giq_option(4, 871, 115, Rick08, 50);
  Rick05: |
    gsay_reply(871, 116);
    giq_option(4, 871, 117, Rick06, 50);
    giq_option(4, 871, 118, Rick07, 50);
    giq_option(4, 871, 119, RickEnd, 50);
  Rick06: |
    gsay_reply(871, 120);
    giq_option(4, 871, 121, RickCombat, 51);
    giq_option(4, 871, 122, Rick05, 50);
    giq_option(4, 871, 123, RickEnd, 50);
  Rick07: 'gsay_message(871, 124, 51);

    '
  Rick08: |
    gsay_reply(871, 125);
    giq_option(4, 871, 126, RickEnd, 50);
    giq_option(4, 871, 127, RickCombat, 51);
  Rick09: |
    gsay_reply(871, 128);
    giq_option(4, 871, 131, RickCombat, 51);
    giq_option(4, 871, 132, RickEnd, 50);
    giq_option(-3, 871, 129, RickEnd, 50);
    giq_option(-3, 871, 130, RickCombat, 51);
  Rick10: 'gsay_message(871, 133, 51);

    '
  RickEnd: "[]"
  RickCombat: 'call combat;

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
htwrwife:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (visible == 0) then begin
      script_overrides;
    end
    else begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      if (map_var(5) == 1) then begin
        if ((obj_can_hear_obj(self_obj, dude_obj) == 1) or (obj_can_see_obj(self_obj, dude_obj) == 1)) then begin
          call combat;
        end
      end
      else begin
        if ((game_time_hour >= 600) and (game_time_hour < 700) or ((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
          if (tile_num(self_obj) != 22114) then begin
            animate_move_obj_to_tile(self_obj, 22114, 0);
          end
        end
        else begin
          if (tile_num(self_obj) != 25108) then begin
            animate_move_obj_to_tile(self_obj, 25108, 0);
          end
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      call Wife03;
    end
    else begin
      if (global_var(248) == 1) then begin
        call Wife04;
      end
      else begin
        if (local_var(4) == 0) then begin
          set_local_var(4, 1);
          call Wife01;
        end
        else begin
          call Wife02;
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    set_map_var(0, map_var(0) + 1);
    if (map_var(0) > 1) then begin
      set_global_var(111, 2);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(584, 100));
  damage_p_proc: |
    set_map_var(5, 1);
    set_global_var(111, 5);
  combat_p_proc: 'critter_set_flee_state(self_obj, 1);

    '
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      if (global_var(111) == 5) then begin
        set_obj_visibility(self_obj, 1);
        visible := 0;
      end
      critter_add_trait(self_obj, 1, 6, 42);
      critter_add_trait(self_obj, 1, 5, 5);
    end
  Wife01: 'float_msg(self_obj, message_str(584, 101), 2);

    '
  Wife02: 'float_msg(self_obj, message_str(584, 102), 2);

    '
  Wife03: 'float_msg(self_obj, message_str(584, random(103, 105)), 2);

    '
  Wife04: |
    float_msg(self_obj, message_str(584, 106), 2);
    call combat;
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
hubcaptr:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      hostile := 1;
      GunLine := random(105, 108);
      if (GunLine == 108) then begin
        if (get_critter_stat(dude_obj, 34) != 0) then begin
          GunLine := 109;
        end
      end
      float_msg(self_obj, message_str(652, GunLine), 8);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    set_local_var(4, local_var(4) + 1);
    if (local_var(4) < 4) then begin
      float_msg(self_obj, message_str(652, 100 + local_var(4)), 8);
    end
    else begin
      float_msg(self_obj, message_str(652, 104), 8);
      call combat;
    end
  destroy_p_proc: |
    set_map_var(0, map_var(0) + 1);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(652, 100));
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 38);
      critter_add_trait(self_obj, 1, 5, 85);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
hubflrcd:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((map_var(6) == 1) and (obj_can_see_obj(self_obj, dude_obj) == 1)) then begin
      critter_set_flee_state(self_obj, 1);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if ((global_var(195) == 1) or (map_var(0) == 1)) then begin
      call Flower00;
    end
    else begin
      if (global_var(158) == 1) then begin
        call Flower01;
      end
      else begin
        if (obj_is_carrying_obj_pid(dude_obj, 117) == 1) then begin
          float_msg(self_obj, message_str(588, 114), 2);
        end
        else begin
          start_gdialog(588, self_obj, 4, -1, -1);
          gsay_start;
          call Flower02;
          gsay_end;
          end_dialogue;
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(158, global_var(158) + 1);
      set_global_var(155, global_var(155) - 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(588, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_map_var(6, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 72);
      critter_add_trait(self_obj, 1, 5, 68);
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 0);
  Flower00: |
    float_msg(self_obj, message_str(588, 101), 2);
    call flee_dude;
  Flower01: |
    float_msg(self_obj, message_str(588, 102), 2);
    call flee_dude;
  Flower02: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(588, 103);
    end
    else begin
      gsay_reply(588, 104);
    end
    giq_option(7, 588, 106, Flower03, 50);
    giq_option(7, 588, 107, Flower04, 50);
    giq_option(4, 588, 108, Flower05, 50);
    giq_option(4, 588, 109, Flower06, 49);
    giq_option(4, 588, 110, Flower07, 51);
    giq_option(4, 588, 111, Flower07, 51);
    giq_option(-3, 588, 112, Flower08, 49);
    giq_option(-3, 588, 113, Flower09, 51);
  Flower03: |
    gsay_reply(588, 115);
    giq_option(7, 588, 116, Flower03a, 49);
    giq_option(7, 588, 107, Flower04, 50);
    giq_option(4, 588, 109, Flower06, 49);
    giq_option(4, 588, 110, Flower07, 51);
    giq_option(4, 588, 119, Flower07, 51);
  Flower03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 20)) == 1) then begin
      call Flower10;
    end
    else begin
      call Flower11;
    end
  Flower04: |
    gsay_reply(588, 121);
    giq_option(7, 588, 123, Flower12, 50);
    giq_option(7, 588, 124, Flower04a, 49);
    giq_option(4, 588, 125, Flower05, 50);
    giq_option(4, 588, 126, Flower06, 49);
    giq_option(4, 588, 110, Flower07, 51);
    giq_option(4, 588, 119, Flower07, 51);
  Flower04a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0)) == 1) then begin
      call Flower13;
    end
    else begin
      call Flower11;
    end
  Flower05: |
    gsay_reply(588, 129);
    giq_option(7, 588, 130, Flower05a, 49);
    giq_option(7, 588, 131, Flower04a, 49);
    giq_option(4, 588, 132, Flower06, 49);
    giq_option(4, 588, 110, Flower07, 51);
    giq_option(4, 588, 119, Flower07, 51);
  Flower05a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0)) == 1) then begin
      call Flower14;
    end
    else begin
      call Flower11;
    end
  Flower06: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(117, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(588, 135, 49);
  Flower07: |
    gsay_message(588, 136, 51);
    call flee_dude;
  Flower08: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(117, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(588, 137, 49);
  Flower09: |
    gsay_message(588, 138, 51);
    call flee_dude;
  Flower10: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(117, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(588, 139, 49);
  Flower11: |
    gsay_message(588, 140, 51);
    call flee_dude;
  Flower12: |
    gsay_reply(588, 141);
    giq_option(7, 588, 142, Flower05a, 50);
    giq_option(7, 588, 143, Flower04a, 50);
    giq_option(4, 588, 144, Flower06, 49);
    giq_option(4, 588, 145, Flower07, 51);
    giq_option(4, 588, 146, Flower07, 51);
  Flower13: |
    gsay_reply(588, 147);
    giq_option(7, 588, 148, Flower11, 50);
    giq_option(4, 588, 149, Flower06, 49);
    giq_option(4, 588, 150, Flower07, 51);
    giq_option(4, 588, 151, Flower07, 51);
  Flower14: |
    set_global_var(281, 1);
    gsay_reply(588, 152);
    giq_option(7, 588, 153, Flower11, 50);
    giq_option(4, 588, 154, Flower06, 49);
    giq_option(4, 588, 155, Flower07, 51);
    giq_option(4, 588, 151, Flower07, 51);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
hubjake:
  start: "[]"
  combat: |
    hostile := 1;
    set_local_var(5, 1);
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    variable LVar0 := 0;
    gdialog_set_barter_mod(-15);
    call Get_Stuff;
    call get_reaction;
    if (((game_time / 10) - local_var(6)) > (60 * 60 * 24 * 3)) then begin
      set_local_var(6, game_time / 10);
      set_local_var(7, random(2000, 3000));
      LVar0 := item_caps_adjust(self_obj, local_var(7));
    end
    else begin
      LVar0 := item_caps_adjust(self_obj, local_var(7));
    end
    if (local_var(5) == 1) then begin
      call combat;
    end
    else begin
      if (global_var(248) == 1) then begin
        start_gdialog(589, self_obj, 4, -1, -1);
        gsay_start;
        call Jake10;
        gsay_end;
        end_dialogue;
      end
      else begin
        if (local_var(4) == 0) then begin
          set_local_var(4, 1);
          start_gdialog(589, self_obj, 4, -1, -1);
          gsay_start;
          call Jake01;
          gsay_end;
          end_dialogue;
        end
        else begin
          if (local_var(1) == 1) then begin
            start_gdialog(589, self_obj, 4, -1, -1);
            gsay_start;
            call Jake10;
            gsay_end;
            end_dialogue;
          end
          else begin
            start_gdialog(589, self_obj, 4, -1, -1);
            gsay_start;
            call Jake09;
            gsay_end;
            end_dialogue;
          end
        end
      end
    end
    set_local_var(7, item_caps_total(self_obj));
    LVar0 := item_caps_adjust(self_obj, -1 * local_var(7));
    call Put_Stuff;
  destroy_p_proc: |
    move_obj_inven_to_obj(Jake_Desk_Ptr, self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    add_obj_to_inven(self_obj, create_object_sid(2, 0, 0, -1));
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(589, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 48);
      critter_add_trait(self_obj, 1, 5, 50);
    end
  Jake01: |
    gsay_reply(589, 101);
    giq_option(4, 589, 102, Barter, 50);
    giq_option(4, 589, 103, Jake02, 50);
    if (global_var(101) != 2) then begin
      giq_option(4, 589, 104, Jake03, 50);
    end
    giq_option(4, 589, 105, Jake04, 50);
    giq_option(4, 589, 106, Jake13, 50);
    giq_option(-3, 589, 107, Barter, 50);
    giq_option(-3, 589, 108, Jake13, 50);
  Jake02: |
    gsay_reply(589, 109);
    giq_option(4, 589, 110, Barter, 50);
    giq_option(4, 589, 111, Jake05, 50);
    giq_option(4, 589, 112, Jake06, 50);
    giq_option(4, 589, 113, Jake13, 50);
  Jake03: |
    gsay_reply(589, 114);
    giq_option(4, 589, 115, Barter, 50);
    giq_option(4, 589, 116, Jake02, 50);
    giq_option(4, 589, 117, Jake04, 50);
  Jake04: |
    gsay_message(589, 118, 50);
    gsay_reply(589, 162);
    giq_option(4, 589, 119, Barter, 50);
    giq_option(4, 589, 120, Jake02, 50);
    if (global_var(101) != 2) then begin
      giq_option(4, 589, 121, Jake03, 50);
    end
    giq_option(4, 589, 122, Jake13, 50);
  Jake05: |
    gsay_reply(589, 123);
    giq_option(4, 589, 124, Barter, 50);
    giq_option(4, 589, 125, Jake06, 50);
    giq_option(4, 589, 126, Jake13, 50);
  Jake06: |
    gsay_reply(589, 127);
    giq_option(4, 589, 128, Barter, 50);
    giq_option(4, 589, 129, Jake07, 50);
    giq_option(4, 589, 130, Jake08, 50);
    giq_option(4, 589, 131, Jake14, 51);
  Jake07: |
    gsay_reply(589, 132);
    giq_option(4, 589, 133, Barter, 50);
    giq_option(4, 589, 134, Jake08, 50);
    giq_option(4, 589, 135, Jake12, 50);
    giq_option(4, 589, 136, Jake04, 50);
    giq_option(4, 589, 137, Jake13, 50);
  Jake08: |
    gsay_reply(589, 138);
    giq_option(4, 589, 139, Barter, 50);
    giq_option(4, 589, 140, Jake07, 50);
    giq_option(4, 589, 141, Jake14, 51);
    giq_option(4, 589, 142, Jake13, 50);
  Jake09: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(589, 163);
    end
    else begin
      gsay_reply(589, 164);
    end
    giq_option(-3, 589, 144, Barter, 50);
    giq_option(-3, 589, 145, Jake13, 50);
    giq_option(4, 589, 146, Barter, 50);
    giq_option(4, 589, 165, Jake16, 50);
    giq_option(4, 589, 147, Jake13, 50);
  Jake10: |
    gsay_reply(589, 148);
    giq_option(-3, 589, 149, Barter, 50);
    giq_option(-3, 589, 150, Jake13, 50);
    giq_option(4, 589, 151, Barter, 50);
    giq_option(4, 589, 165, Jake16, 50);
    giq_option(4, 589, 152, Jake15, 50);
    giq_option(4, 589, 153, Jake13, 50);
  Jake12: |
    set_global_var(236, 1);
    gsay_reply(589, 155);
    giq_option(4, 589, 156, Jake08, 50);
    giq_option(4, 589, 157, Jake13, 50);
  Jake13: "[]"
  Jake14: 'call BottomReact;

    '
  Jake15: |
    call BottomReact;
    call combat;
  Jake16: |
    if (global_var(74) == 0) then begin
      set_global_var(74, 1);
    end
    if (global_var(75) == 0) then begin
      set_global_var(75, 1);
    end
    gsay_message(589, 166, 50);
  JakeEnd: "[]"
  Barter: |
    gsay_message(589, 158, 50);
    gdialog_mod_barter(-15);
    gsay_reply(589, 159);
    giq_option(4, 589, 160, JakeEnd, 50);
    giq_option(-3, 589, 161, JakeEnd, 50);
  Get_Stuff: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := obj_carrying_pid_obj(self_obj, 115);
    rm_obj_from_inven(self_obj, LVar0);
    destroy_object(LVar0);
    LVar1 := obj_carrying_pid_obj(self_obj, 2);
    rm_obj_from_inven(self_obj, LVar1);
    destroy_object(LVar1);
    move_obj_inven_to_obj(Jake_Desk_Ptr, self_obj);
  Put_Stuff: |
    move_obj_inven_to_obj(self_obj, Jake_Desk_Ptr);
    add_obj_to_inven(self_obj, create_object_sid(115, 0, 0, -1));
    wield_obj_critter(self_obj, obj_carrying_pid_obj(self_obj, 115));
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
hubpatnt:
  start: "[]"
  critter_p_proc: |
    if (GVar0) then begin
      GVar0 := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((map_var(6) == 1) and (obj_can_see_obj(self_obj, dude_obj) == 1)) then begin
      critter_set_flee_state(self_obj, 1);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      GVar0 := 1;
    end
  talk_p_proc: |
    call get_reaction;
    float_msg(self_obj, message_str(590, 101), 2);
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(590, 100));
  use_skill_on_p_proc: |
    script_overrides;
    float_msg(self_obj, message_str(590, 101), 2);
  use_obj_on_p_proc: |
    script_overrides;
    float_msg(self_obj, message_str(590, 101), 2);
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_map_var(6, 1);
    end
  map_enter_p_proc: |
    if (GVar1) then begin
      GVar1 := 0;
      anim(self_obj, 48, 0);
      critter_add_trait(self_obj, 1, 6, 41);
      critter_add_trait(self_obj, 1, 5, 51);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
hubpris:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    float_msg(self_obj, message_str(956, random(101, 107)), 2);
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(956, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 7);
      critter_add_trait(self_obj, 1, 5, 5);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
hubsmity:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (map_var(1) == 1) then begin
      float_msg(self_obj, message_str(591, 101), 2);
    end
    else begin
      if (global_var(107) == 2) then begin
        float_msg(self_obj, message_str(591, 104), 10);
      end
      else begin
        float_msg(self_obj, message_str(591, 103), 2);
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(591, 100));
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 39);
      critter_add_trait(self_obj, 1, 5, 52);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
hunter:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 29);
      if (cur_map_index != 29) then begin
        call Hunter05;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        my_script_mode := 1;
      end
      else begin
        if (global_var(123) == 3) then begin
          move_to(self_obj, 7000, 0);
          removal_ptr := self_obj;
        end
      end
      initialized := 1;
    end
    else begin
      if (not(my_script_mode)) then begin
        if (script_action == 12) then begin
          call critter_p_proc;
        end
        else begin
          if (script_action == 18) then begin
            call destroy_p_proc;
          end
          else begin
            if (script_action == 21) then begin
              call look_at_p_proc;
            end
            else begin
              if (script_action == 4) then begin
                call pickup_p_proc;
              end
              else begin
                if (script_action == 11) then begin
                  call talk_p_proc;
                end
              end
            end
          end
        end
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (obj_can_see_obj(self_obj, dude_obj) and not(my_script_mode) and not(pre_fight) and (global_var(158) > 2)) then begin
        call Hunter05;
        pre_fight := 1;
      end
    end
  destroy_p_proc: |
    set_global_var(123, 3);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(241, 100));
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    start_gdialog(241, self_obj, 4, -1, -1);
    gsay_start;
    call Hunter01;
    gsay_end;
    end_dialogue;
  Hunter01: |
    gsay_reply(241, 101);
    giq_option(3, 241, 102, Hunter02, 50);
    giq_option(3, 241, 103, Hunter03, 50);
    giq_option(3, 241, 104, Hunter04, 50);
    giq_option(0, 241, 105, Hunter04, 50);
  Hunter02: |
    if (not(mad)) then begin
      gsay_message(241, 106, 50);
      mad := 1;
    end
    else begin
      gsay_message(241, 107, 50);
      hostile := 1;
    end
  Hunter03: 'gsay_message(241, 108, 50);

    '
  Hunter04: 'gsay_message(241, 109, 50);

    '
  Hunter05: |
    float_msg(self_obj, message_str(241, 110), 0);
    hostile := 1;
hwmhost:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(816, self_obj, 4, -1, -1);
    gsay_start;
    call HubWMHost00;
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(816, 100));
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 40);
      critter_add_trait(self_obj, 1, 5, 86);
    end
  HubWMHost00: |
    gsay_reply(816, 101);
    giq_option(4, 816, 102, HubWMHost02, 50);
    giq_option(4, 816, 103, HubWMHost05, 50);
    giq_option(-3, 816, 104, HubWMHost01, 50);
  HubWMHost01: 'gsay_message(816, 105, 50);

    '
  HubWMHost02: |
    gsay_reply(816, 106);
    giq_option(4, 816, 107, HubWMHost03, 50);
    giq_option(4, 816, 108, HubWMHost04, 50);
    giq_option(4, 816, 109, HubWMHost05, 50);
  HubWMHost03: |
    gsay_reply(816, 110);
    giq_option(4, 816, 111, HubWMHost04, 50);
    giq_option(4, 816, 112, HubWMHost05, 50);
  HubWMHost04: |
    gsay_reply(816, 113);
    giq_option(4, 816, 114, HubWMHost03, 50);
    giq_option(4, 816, 115, HubWMHost05, 50);
  HubWMHost05: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
ian:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    if (global_var(118) == 0) then begin
      display_msg(message_str(235, 100));
    end
    else begin
      display_msg(message_str(235, 113));
    end
  description_p_proc: |
    if (is_success(do_check(dude_obj, 1, has_trait(0, dude_obj, 0)))) then begin
      script_overrides;
      display_msg(message_str(235, 130));
    end
    if (not(combat_is_initialized)) then begin
      if ((global_var(118) == 2) and (tile_distance_objs(self_obj, dude_obj) > 1)) then begin
        script_overrides;
      end
      else begin
        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 5), 0);
        float_msg(dude_obj, message_str(235, 2016), 3);
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (global_var(118) == 2) then begin
      call map_commentary;
      call follow_player;
    end
    if ((global_var(618) < 2) and (global_var(118) == 2)) then begin
      if ((get_pc_stat(1) - global_var(619)) > 0) then begin
        set_global_var(629, global_var(629) + (get_pc_stat(1) - global_var(619)));
        set_global_var(619, get_pc_stat(1));
      end
      if (global_var(629) > 3) then begin
        set_global_var(629, 0);
        set_global_var(618, global_var(618) + 1);
        armour_ptr := critter_inven_obj(self_obj, 0);
        armour_pid := obj_pid(armour_ptr);
        new_proto := get_proto(armour_ptr);
        tmp := create_object_sid(new_proto, tile_num(self_obj), elevation(self_obj), 235);
        anim(tmp, 1000, has_trait(1, self_obj, 10));
        inven_unwield;
        move_obj_inven_to_obj(self_obj, tmp);
        armour_ptr := obj_carrying_pid_obj(tmp, armour_pid);
        if (armour_ptr) then begin
          wield_obj_critter(tmp, armour_ptr);
        end
        party_remove(self_obj);
        party_add(tmp);
        critter_add_trait(tmp, 1, 6, 0);
        float_msg(tmp, message_str(235, 1999), 3);
        display_msg(message_str(235, 2022));
        Ian_ptr := tmp;
        move_to(self_obj, 0, 0);
        destroy_object(self_obj);
      end
    end
  destroy_p_proc: |
    set_global_var(118, 3);
    party_remove(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  map_enter_p_proc: |
    Ian_ptr := self_obj;
    if (initialized == 0) then begin
      initialized := 1;
      critter_add_trait(self_obj, 1, 5, 89);
    end
    if (global_var(118) == 2) then begin
      critter_add_trait(self_obj, 1, 6, 0);
    end
    else begin
      critter_add_trait(self_obj, 1, 6, 2);
    end
  pickup_p_proc: |
    if (global_var(118) < 2) then begin
      hostile := 1;
    end
    else begin
      script_overrides;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(235, self_obj, 4, -1, -1);
    gsay_start;
    if ((global_var(246) == 1) and (global_var(118) != 2)) then begin
      call Ian14;
    end
    else begin
      if (global_var(118) == 0) then begin
        call Ian02;
      end
      else begin
        if (global_var(118) == 2) then begin
          call Ian15;
        end
        else begin
          if (global_var(118) == 3) then begin
            call Ian21;
          end
          else begin
            call Ian12;
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
    if ((global_var(118) == 2) and (global_var(313) == 0)) then begin
      set_global_var(313, 1);
      display_msg(message_str(235, 169));
      give_exp_points(100);
    end
    if (bestweapon_flag == 1) then begin
      bestweapon_flag := 0;
      inven_unwield;
    end
    if (armour_flag == 1) then begin
      armour_flag := 0;
      new_proto := get_proto(armour_ptr);
      if (new_proto) then begin
        tmp := create_object_sid(new_proto, tile_num(self_obj), elevation(self_obj), 235);
        anim(tmp, 1000, has_trait(1, self_obj, 10));
        inven_unwield;
        move_obj_inven_to_obj(self_obj, tmp);
        wield_obj_critter(tmp, armour_ptr);
        party_remove(self_obj);
        party_add(tmp);
        critter_add_trait(tmp, 1, 6, 0);
        Ian_ptr := tmp;
        move_to(self_obj, 0, 0);
        destroy_object(self_obj);
      end
    end
  use_obj_on_p_proc: |
    if (global_var(118) == 2) then begin
      item := obj_pid(obj_being_used_with);
      if ((item != 40) and (item != 47) and (item != 91)) then begin
        script_overrides;
        if (obj_item_subtype(obj_being_used_with) != 3) then begin
          rm_obj_from_inven(dude_obj, obj_being_used_with);
          add_obj_to_inven(self_obj, obj_being_used_with);
        end
        else begin
          if ((item == 4) or (item == 8) or (item == 18) or (item == 120) or (item == 22) or (item == 9) or (item == 16) or (item == 24) or (item == 241) or (item == 116) or (item == 236) or (item == 234) or (item == 235) or (item == 21)) then begin
            rm_obj_from_inven(dude_obj, obj_being_used_with);
            add_obj_to_inven(self_obj, obj_being_used_with);
          end
          else begin
            float_msg(self_obj, message_str(634, 109), 3);
          end
        end
      end
    end
  join_party: |
    if ((global_var(121) == 2) and (global_var(244) == 2) and (get_critter_stat(dude_obj, 3) <= 5)) then begin
      gsay_message(235, 2017, 50);
    end
    else begin
      if ((global_var(121) == 2) or (global_var(244) == 2) and (get_critter_stat(dude_obj, 3) <= 3)) then begin
        gsay_message(235, 2018, 50);
      end
      else begin
        call join_party2;
      end
    end
  join_party2: |
    set_global_var(118, 2);
    set_global_var(277, 5);
    set_global_var(619, get_pc_stat(1));
    party_add(self_obj);
    critter_add_trait(self_obj, 1, 6, 0);
    gsay_message(235, 150, 50);
  hire_Ian: |
    item_caps_adjust(dude_obj, -100);
    item_caps_adjust(self_obj, 100);
    call join_party2;
  Ian02: |
    gsay_reply(235, 102);
    giq_option(4, 235, 103, Ian03, 51);
    giq_option(4, 235, message_str(235, 104) + proto_data(obj_pid(dude_obj), 1) + message_str(235, 105), Ian04, 50);
    giq_option(-3, 235, 106, Ian05, 50);
  Ian03: 'gsay_message(235, 107, 51);

    '
  Ian04: |
    gsay_reply(235, 108);
    set_global_var(118, 1);
    giq_option(4, 235, 109, Ian06, 50);
    giq_option(5, 235, 110, Ian07, 50);
  Ian05: 'gsay_message(235, 111, 50);

    '
  Ian06: |
    gsay_reply(235, 112);
    giq_option(4, 235, 114, Ian18, 50);
    if (local_var(9) == 0) then begin
      giq_option(4, 235, 115, Ian13, 50);
    end
    giq_option(4, 235, 149, Ian17, 50);
    giq_option(5, 235, 116, Ian08, 50);
  Ian07: |
    gsay_reply(235, 117);
    giq_option(4, 235, 118, Ian09, 50);
    giq_option(4, 235, 119, Ian08, 50);
  Ian08: |
    gsay_reply(235, 120);
    giq_option(4, 235, 121, Ian10, 50);
    giq_option(5, 235, 122, Ian11, 50);
  Ian09: |
    gsay_reply(235, 123);
    giq_option(4, 634, 104, IanEnd, 50);
  Ian10: |
    gsay_reply(235, 125);
    giq_option(4, 235, 126, Ian09, 50);
    giq_option(4, 634, 101, IanEnd, 50);
  Ian11: |
    gsay_reply(235, 128);
    giq_option(4, 235, 129, Ian07, 50);
    giq_option(4, 634, 101, IanEnd, 50);
  Ian12: |
    gsay_reply(235, message_str(235, 131) + proto_data(obj_pid(dude_obj), 1) + message_str(235, 132));
    call Ian12a;
  Ian12a: |
    giq_option(4, 235, 133, Ian11, 50);
    giq_option(4, 235, 134, Ian09, 50);
    giq_option(4, 235, 135, Ian07, 50);
    giq_option(4, 235, 136, Ian10, 50);
    if (local_var(9) == 0) then begin
      giq_option(4, 235, 137, Ian13, 50);
    end
    giq_option(4, 235, 149, Ian17, 50);
    giq_option(4, 235, 138, IanEnd, 50);
  Ian13: |
    set_local_var(9, 1);
    if (not(global_var(73))) then begin
      set_global_var(73, 1);
    end
    if (not(global_var(71))) then begin
      set_global_var(71, 1);
    end
    gsay_reply(235, 139);
    if (global_var(118) == 2) then begin
      giq_option(4, 235, 140, Ian15, 50);
    end
    else begin
      giq_option(4, 235, 140, Ian12, 50);
    end
  Ian14: |
    hostile := 1;
    gsay_message(235, 141, 51);
  Ian15: |
    gsay_reply(235, message_str(235, 142) + proto_data(obj_pid(dude_obj), 1) + message_str(235, 143));
    if (local_var(9) == 0) then begin
      giq_option(4, 235, 146, Ian13, 50);
    end
    giq_option(4, 235, 145, Ian16, 50);
    giq_option(4, 235, 173, Ian20, 50);
    giq_option(4, 235, 2000, IanCombatTactics, 50);
    giq_option(4, 235, 144, IanEnd, 50);
  Ian16: |
    set_global_var(118, 3);
    party_remove(self_obj);
    gsay_message(235, 147, 50);
  Ian17: |
    if (local_var(1) == 1) then begin
      gsay_message(235, 148, 51);
    end
    else begin
      if (local_var(1) == 2) then begin
        gsay_reply(235, 156);
        if (item_caps_total(dude_obj) >= 100) then begin
          giq_option(4, 235, 157, hire_Ian, 49);
        end
        giq_option(6, 235, 159, Ian17a, 50);
        giq_option(4, 235, 158, IanEnd, 50);
      end
      else begin
        call join_party;
      end
    end
  Ian17a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 20))) then begin
      gsay_reply(235, 160);
      giq_option(4, 634, 106, join_party, 49);
    end
    else begin
      call DownReact;
      gsay_message(235, 161, 51);
    end
  Ian18: |
    gsay_reply(235, 124);
    call UpReact;
    giq_option(4, 634, 106, Ian19, 50);
  Ian19: |
    gsay_reply(235, 127);
    call Ian12a;
  Ian20: |
    gsay_message(235, 174, 50);
    call Ian15;
  Ian21: |
    gsay_reply(235, 202);
    giq_option(4, 235, 203, join_party, 50);
    giq_option(4, 235, 204, IanEnd, 50);
  IanEnd: "[]"
  follow_player: |
    if (tile_distance_objs(self_obj, dude_obj) > global_var(277)) then begin
      if (anim_busy(self_obj) == 0) then begin
        dest_tile := tile_num_in_direction(tile_num_in_direction(tile_num(dude_obj), rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)), global_var(277)), random(0, 5), random(0, 2));
        if (tile_distance_objs(self_obj, dude_obj) > (2 * global_var(277))) then begin
          animate_move_obj_to_tile(self_obj, dest_tile, 1 bwor 16);
        end
        else begin
          animate_move_obj_to_tile(self_obj, dest_tile, 0 bwor 16);
        end
      end
    end
  map_commentary: |
    if (cur_map_index == 12) then begin
      if (tile_distance(tile_num(self_obj), 27883) < 4) then begin
        if (not(line151flag)) then begin
          float_msg(self_obj, message_str(235, 151), 0);
          line151flag := 1;
        end
      end
    end
    else begin
      if (cur_map_index == 11) then begin
        if (tile_distance(tile_num(self_obj), 27919) < 4) then begin
          if (not(line152flag)) then begin
            float_msg(self_obj, message_str(235, 152), 0);
            line152flag := 1;
          end
        end
      end
      else begin
        if (cur_map_index == 3) then begin
          if (elevation(self_obj) == 0) then begin
            if (not(line153flag)) then begin
              float_msg(self_obj, message_str(235, 153), 0);
              line153flag := 1;
            end
          end
        end
        else begin
          if (cur_map_index == 27) then begin
            if (not(line154flag)) then begin
              float_msg(self_obj, message_str(235, 154), 0);
              if (global_var(244) == 2) then begin
                float_msg(Katja_ptr, message_str(623, 185), 5);
              end
              line154flag := 1;
            end
          end
          else begin
            if (cur_map_index == 30) then begin
              if (not(line155flag)) then begin
                float_msg(self_obj, message_str(235, 155), 0);
                line155flag := 1;
              end
            end
            else begin
              if ((cur_map_index == 38) and (elevation(self_obj) == 0)) then begin
                if (tile_distance(tile_num(self_obj), 24890) < 4) then begin
                  if (not(line162flag)) then begin
                    float_msg(self_obj, message_str(235, 162), 0);
                    line162flag := 1;
                  end
                end
                else begin
                  if (tile_distance(tile_num(self_obj), 14116) < 4) then begin
                    if (not(line165flag)) then begin
                      float_msg(self_obj, message_str(235, 165), 0);
                      line165flag := 1;
                    end
                  end
                  else begin
                    if (tile_distance(tile_num(self_obj), 18464) < 4) then begin
                      if (not(line166flag)) then begin
                        float_msg(self_obj, message_str(235, 166), 0);
                        line166flag := 1;
                      end
                    end
                    else begin
                      if (tile_distance(tile_num(self_obj), 21730) < 4) then begin
                        if (not(line167flag)) then begin
                          float_msg(self_obj, message_str(235, 167), 0);
                          line167flag := 1;
                        end
                      end
                    end
                  end
                end
              end
              else begin
                if ((cur_map_index == 40) and (elevation(self_obj) == 0)) then begin
                  if (tile_distance(tile_num(self_obj), 16082) < 4) then begin
                    if (line163flag == 0) then begin
                      float_msg(self_obj, message_str(235, 163), 0);
                      line163flag := 1;
                    end
                  end
                end
                else begin
                  if (cur_map_index == 41) then begin
                    if (tile_distance(tile_num(self_obj), 22497) < 4) then begin
                      if (line164flag == 0) then begin
                        float_msg(self_obj, message_str(235, 164), 0);
                        line164flag := 1;
                      end
                    end
                  end
                  else begin
                    if ((cur_map_index == 6) and (elevation(self_obj) == 0)) then begin
                      if (line170flag == 0) then begin
                        float_msg(self_obj, message_str(235, 170), 0);
                        line170flag := 1;
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  IanClose: |
    set_global_var(277, 3);
    gsay_message(235, 201, 50);
    call Ian15;
  IanModerate: |
    set_global_var(277, 5);
    gsay_message(235, 201, 50);
    call Ian15;
  IanFar: |
    set_global_var(277, 7);
    gsay_message(235, 201, 50);
    call Ian15;
  IanCombatTactics: |
    armour_ptr := get_armour_ptr;
    gsay_reply(235, 2001);
    giq_option(4, 235, 2010, IanBestWeapon, 50);
    if (armour_ptr) then begin
      giq_option(4, 235, 2011, IanArmour, 50);
    end
    giq_option(4, 235, 2019, IanClose, 50);
    giq_option(4, 235, 2020, IanModerate, 50);
    giq_option(4, 235, 2021, IanFar, 50);
    giq_option(4, 235, 2015, Ian15, 50);
  IanBestWeapon: |
    gsay_message(235, 2100, 49);
    bestweapon_flag := 1;
    call IanCombatTactics;
  IanArmour: |
    gsay_message(235, 2100, 49);
    armour_flag := 1;
    call IanCombatTactics;
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  get_armour_ptr: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar1 := obj_pid(critter_inven_obj(self_obj, 0));
    if (obj_is_carrying_obj_pid(self_obj, 74) and (LVar1 != 74)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 74);
    end
    if (obj_is_carrying_obj_pid(self_obj, 1) and (LVar1 != 1)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 1);
    end
    if (obj_is_carrying_obj_pid(self_obj, 113) and (LVar1 != 113)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 113);
    end
    if (obj_is_carrying_obj_pid(self_obj, 2) and (LVar1 != 2)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 2);
    end
    if (obj_is_carrying_obj_pid(self_obj, 17) and (LVar1 != 17)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 17);
    end
    if (obj_is_carrying_obj_pid(self_obj, 240) and (LVar1 != 240)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 240);
    end
    if (obj_is_carrying_obj_pid(self_obj, 239) and (LVar1 != 239)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 239);
    end
    if (obj_is_carrying_obj_pid(self_obj, 3) and (LVar1 != 3)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 3);
    end
    if (obj_is_carrying_obj_pid(self_obj, 232) and (LVar1 != 232)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 232);
    end
    return LVar0;
  get_proto: |
    variable LVar1 := 0;
    if (obj_pid(arg0) == 74) then begin
      LVar1 := 16777529 + (9 * global_var(618));
    end
    else begin
      if (obj_pid(arg0) == 1) then begin
        LVar1 := 16777530 + (9 * global_var(618));
      end
      else begin
        if (obj_pid(arg0) == 113) then begin
          LVar1 := 16777531 + (9 * global_var(618));
        end
        else begin
          if (obj_pid(arg0) == 2) then begin
            LVar1 := 16777532 + (9 * global_var(618));
          end
          else begin
            if (obj_pid(arg0) == 17) then begin
              LVar1 := 16777533 + (9 * global_var(618));
            end
            else begin
              if (obj_pid(arg0) == 240) then begin
                LVar1 := 16777534 + (9 * global_var(618));
              end
              else begin
                if (obj_pid(arg0) == 239) then begin
                  LVar1 := 16777535 + (9 * global_var(618));
                end
                else begin
                  if (obj_pid(arg0) == 3) then begin
                    LVar1 := 16777536 + (9 * global_var(618));
                  end
                  else begin
                    if (obj_pid(arg0) == 232) then begin
                      LVar1 := 16777537 + (9 * global_var(618));
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    return LVar1;
invader:
  start: |
    if (not(init_teams)) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, tile_num(self_obj));
      end
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 79);
      init_teams := 1;
    end
    else begin
      if (script_action == 22) then begin
        call timetomove;
      end
    end
    if (script_action == 11) then begin
      call mutant00;
    end
    else begin
      if (script_action == 21) then begin
        script_overrides;
        display_msg(message_str(912, 100));
      end
      else begin
        if (script_action == 4) then begin
          hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            call Critter_Action;
          end
          else begin
            if (script_action == 18) then begin
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(160, global_var(160) + 1);
                if ((global_var(160) % 6) == 0) then begin
                  set_global_var(155, global_var(155) + 1);
                end
              end
            end
          end
        end
      end
    end
  mutant00: |
    rndx := random(0, 1);
    if (rndx == 0) then begin
      float_msg(self_obj, message_str(912, 101), 2);
    end
    else begin
      if (rndx == 1) then begin
        float_msg(self_obj, message_str(912, 102), 2);
      end
    end
    call combat;
  combat: 'hostile := 1;

    '
  timetomove: |
    noevent := 0;
    set_local_var(1, tile_num(self_obj));
    new_tile := tile_num_in_direction(local_var(1), random(0, 5), 2);
    if (tile_distance(local_var(0), new_tile) < maxleash) then begin
      animate_move_obj_to_tile(self_obj, new_tile, 0);
    end
  Critter_Action: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 6)) then begin
        call mutant00;
      end
      else begin
        loopcount := loopcount + 1;
        if (loopcount > 40) then begin
          loopcount := 0;
          if (noevent == 0) then begin
            noevent := 1;
            add_timer_event(self_obj, game_ticks(random(5, 13)), 0);
          end
        end
      end
    end
irwin:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((global_var(307) == 501) and (tile_num(self_obj) != 27759)) then begin
      animate_move_obj_to_tile(self_obj, 27759, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    variable LVar0 := 0;
    call get_reaction;
    call IrwinTalks;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(935, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 41);
      critter_add_trait(self_obj, 1, 5, 51);
    end
  map_update_p_proc: |
    if (tile_num(self_obj) == 27759) then begin
      set_obj_visibility(self_obj, 1);
    end
  IrwinTalks: |
    if (global_var(307) == 0) then begin
      start_gdialog(935, self_obj, 4, -1, -1);
      gsay_start;
      call Irwin00;
      gsay_end;
      end_dialogue;
    end
    else begin
      if ((global_var(307) == 1) or (global_var(307) == 2)) then begin
        start_gdialog(935, self_obj, 4, -1, -1);
        gsay_start;
        call Irwin05;
        gsay_end;
        end_dialogue;
      end
      else begin
        float_msg(self_obj, message_str(935, 117), 8);
      end
    end
  IrwinAccept: |
    gsay_message(935, 109, 50);
    set_global_var(307, 1);
    game_time_advance(10 * 60 * 60 * 1);
    load_map("hubmis1.map", 1);
  IrwinEnd: "[]"
  Irwin00: |
    gsay_reply(935, 101);
    giq_option(4, 935, 102, Irwin01, 50);
    giq_option(4, 935, 103, Irwin03, 50);
    giq_option(4, 935, 104, IrwinEnd, 50);
    giq_option(-3, 935, 118, Irwin07, 50);
  Irwin01: |
    if (get_pc_stat(1) < 5) then begin
      gsay_message(935, 105, 50);
    end
    else begin
      call Irwin02;
    end
  Irwin02: |
    gsay_reply(935, 106);
    giq_option(4, 935, 107, IrwinAccept, 50);
    giq_option(4, 935, 108, Irwin04, 50);
  Irwin03: 'gsay_message(935, 110, 50);

    '
  Irwin04: 'gsay_message(935, 111, 50);

    '
  Irwin05: |
    gsay_reply(935, 112);
    giq_option(4, 935, 113, Irwin06, 50);
    giq_option(4, 935, 114, IrwinEnd, 50);
    giq_option(-3, 935, 120, Irwin06, 50);
    giq_option(-3, 935, 121, IrwinEnd, 50);
  Irwin06: |
    variable LVar0 := 0;
    if (global_var(307) == 2) then begin
      gsay_message(935, 115, 50);
      LVar0 := create_object_sid(241, 0, 0, -1);
      add_obj_to_inven(dude_obj, LVar0);
      give_exp_points(500);
      display_msg(message_str(766, 103) + 500 + message_str(766, 104));
      set_global_var(155, global_var(155) + 2);
      set_global_var(307, 501);
    end
    else begin
      gsay_message(935, 116, 50);
      game_time_advance(10 * 60 * 60 * 1);
      load_map("hubmis1.map", 1);
    end
  Irwin07: 'gsay_message(935, 119, 50);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
ismarc:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(668, 101));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(668, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(4) == 0) then begin
        if (tile_num(self_obj) != home_tile) then begin
          animate_move_obj_to_tile(self_obj, home_tile, 0);
        end
        else begin
          if (has_trait(1, self_obj, 10) != 2) then begin
            anim(self_obj, 1000, 2);
          end
        end
      end
      if ((game_time_hour >= 1500) and (game_time_hour <= 1900) and not(singing)) then begin
        rm_timer_event(self_obj);
        add_timer_event(self_obj, game_ticks(random(30, 60)), 1);
        singing := 1;
        song_line_offset := 0;
        song_line_base := 0;
      end
      call sleeping;
    end
    if (global_var(628) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(628, 1);
      set_global_var(247, 1);
      set_global_var(155, global_var(155) - 5);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  map_enter_p_proc: |
    if (global_var(15) == 1) then begin
      destroy_object(self_obj);
    end
    critter_add_trait(self_obj, 1, 6, 16);
    if (not(metarule(22, 0)) and (obj_is_carrying_obj_pid(self_obj, 41) == 0)) then begin
      item_caps_adjust(self_obj, random(20, 50));
    end
    sleep_tile := 7000;
    home_tile := 19089;
    sleep_time := 2210;
    wake_time := 1420;
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    call get_reaction;
    start_gdialog(668, self_obj, 4, -1, -1);
    gsay_start;
    call Ismarc01;
    gsay_end;
    end_dialogue;
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if (song_line_base == 0) then begin
        song_line_base := (random(0, 2) * 4) + 127;
        song_line_offset := 0;
      end
      if (song_line_offset < 4) then begin
        reg_anim_func(2, self_obj);
        reg_anim_func(1, 1);
        reg_anim_animate(self_obj, 13, -1);
        reg_anim_animate(self_obj, 15, 3);
        reg_anim_animate(self_obj, 14, 3);
        reg_anim_animate(self_obj, 13, 3);
        reg_anim_animate(self_obj, 0, 3);
        reg_anim_func(3, 0);
        float_msg(self_obj, message_str(668, song_line_base + song_line_offset), 0);
        song_line_offset := song_line_offset + 1;
        add_timer_event(self_obj, game_ticks(5), 1);
      end
      else begin
        singing := 0;
        song_line_offset := 0;
        song_line_base := 0;
      end
    end
  Ismarc01: |
    if (local_var(1) < 2) then begin
      gsay_reply(668, 102);
    end
    else begin
      gsay_reply(668, 103);
    end
    giq_option(4, 668, 104, Ismarc02, 49);
    giq_option(4, 668, 105, Ismarc03, 51);
    giq_option(4, 668, 106, IsmarcEnd, 50);
    giq_option(-3, 668, 107, Ismarc04, 51);
  Ismarc02: |
    call UpReact;
    if (local_var(1) == 1) then begin
      call Ismarc03;
    end
    else begin
      gsay_reply(668, 109);
      call Ismarc10;
    end
  Ismarc03: 'gsay_message(668, 108, 51);

    '
  Ismarc04: 'gsay_message(668, 114, 51);

    '
  Ismarc05: |
    line05flag := 1;
    gsay_reply(668, 115);
    call Ismarc09;
  Ismarc06: |
    line06flag := 1;
    if (global_var(73) < 1) then begin
      set_global_var(73, 1);
    end
    gsay_reply(668, 120);
    call Ismarc09;
  Ismarc07: |
    line07flag := 1;
    if (global_var(74) < 1) then begin
      set_global_var(74, 1);
    end
    gsay_reply(668, 121);
    call Ismarc09;
  Ismarc08: |
    line08flag := 1;
    if (global_var(75) < 1) then begin
      set_global_var(75, 1);
    end
    gsay_reply(668, 122);
    call Ismarc09;
  Ismarc09: |
    if (not(line06flag)) then begin
      giq_option(4, 668, 116, Ismarc06, 50);
    end
    if (not(line07flag)) then begin
      giq_option(4, 668, 117, Ismarc07, 50);
    end
    if (not(line08flag)) then begin
      giq_option(4, 668, 118, Ismarc08, 50);
    end
    giq_option(4, 668, 119, IsmarcEnd, 50);
  Ismarc10: |
    if (not(line05flag)) then begin
      giq_option(4, 668, 110, Ismarc05, 50);
    end
    if (not(line11flag)) then begin
      giq_option(4, 668, 111, Ismarc11, 49);
    end
    if (not(line12flag)) then begin
      giq_option(4, 668, 112, Ismarc12, 50);
    end
    giq_option(4, 668, 113, IsmarcEnd, 50);
  Ismarc11: |
    variable LVar0 := 0;
    if (item_caps_total(dude_obj) >= 5) then begin
      call UpReact;
      LVar0 := rm_mult_objs_from_inven(dude_obj, obj_carrying_pid_obj(dude_obj, 41), 5);
      LVar0 := create_object_sid(41, 0, 0, -1);
      add_mult_objs_to_inven(self_obj, LVar0, 5);
      gsay_reply(668, 123);
      giq_option(0, 634, 106, Ismarc10, 49);
    end
    else begin
      gsay_reply(668, 124);
      call Ismarc10;
    end
  Ismarc12: |
    gsay_reply(668, 125);
    call Ismarc10;
  IsmarcEnd: "[]"
  sleeping: |
    if (local_var(4) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(4, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(4, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(4, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(4, 1);
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
izo:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 13);
      if (global_var(104) == 2) then begin
        kill_critter(self_obj, 62);
      end
      initialized := 1;
    end
    else begin
      if (script_action == 3) then begin
        call description_p_proc;
      end
    end
  critter_p_proc: |
    if (global_var(347) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (Gizmo_is_angry) then begin
        Gizmo_is_angry := 0;
        hostile := 1;
      end
      else begin
        if (show_to_door) then begin
          if (tile_distance_objs(dude_obj, Gizmo_ptr) > 8) then begin
            if (tile_num(self_obj) != 16520) then begin
              animate_move_obj_to_tile(self_obj, 16520, 0);
            end
            else begin
              anim(self_obj, 1000, 2);
              line103flag := 0;
              show_to_door := 0;
            end
          end
          else begin
            if (tile_num(self_obj) != 18720) then begin
              animate_move_obj_to_tile(self_obj, 18720, 0);
            end
            else begin
              if (not(line103flag)) then begin
                line103flag := 1;
                display_msg(message_str(622, 103));
              end
            end
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(347, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  description_p_proc: |
    if (is_success(do_check(dude_obj, 1, has_trait(0, dude_obj, 0)))) then begin
      display_msg(message_str(622, 100));
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    variable LVar0 := 0;
    display_msg(message_str(622, 101));
    if ((payment > 0) and (local_var(3) == 0)) then begin
      use_obj(dude_obj);
      LVar0 := create_object_sid(41, 0, 0, -1);
      add_mult_objs_to_inven(dude_obj, LVar0, payment);
      display_msg(message_str(622, 102));
      payment := 0;
      set_local_var(3, 1);
    end
jain:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((map_var(6) == 1) and (obj_can_see_obj(self_obj, dude_obj) == 1)) then begin
      call combat;
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (map_var(0) == 1) then begin
      start_gdialog(46, self_obj, 4, 18, 3);
      gsay_start;
      call Jain29;
      gsay_end;
      end_dialogue;
    end
    else begin
      if (global_var(18) == 1) then begin
        start_gdialog(46, self_obj, 4, 18, 3);
        gsay_start;
        call Jain30;
        gsay_end;
        end_dialogue;
      end
      else begin
        if (local_var(4) == 0) then begin
          set_local_var(4, 1);
          start_gdialog(46, self_obj, 4, 18, 3);
          gsay_start;
          call Jain00;
          gsay_end;
          end_dialogue;
        end
        else begin
          if (local_var(1) >= 2) then begin
            start_gdialog(46, self_obj, 4, 18, 3);
            gsay_start;
            call Jain27;
            gsay_end;
            end_dialogue;
          end
          else begin
            start_gdialog(46, self_obj, 4, 18, 3);
            gsay_start;
            call Jain29;
            gsay_end;
            end_dialogue;
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    set_global_var(112, 2);
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(46, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_map_var(6, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 72);
      critter_add_trait(self_obj, 1, 5, 77);
    end
  Jain00: |
    gsay_reply(46, 101);
    giq_option(4, 46, 102, Jain04, 50);
    giq_option(4, 46, 103, Jain07, 50);
    giq_option(4, 46, 104, Jain10, 50);
    giq_option(-3, 46, 105, Jain01, 50);
  Jain01: |
    gsay_reply(46, 106);
    giq_option(-3, 46, 107, Jain35, 50);
    giq_option(-3, 46, 108, Jain02, 50);
  Jain02: |
    gsay_message(46, 109, 51);
    call JainEndCombat;
  Jain03: |
    set_map_var(0, 1);
    gsay_message(46, 110, 50);
  Jain04: |
    gsay_reply(46, 111);
    giq_option(4, 46, 112, Jain05, 50);
    giq_option(4, 46, 113, Jain03, 50);
  Jain05: |
    set_map_var(0, 1);
    gsay_message(46, 114, 51);
  Jain07: |
    gsay_reply(46, 115);
    giq_option(4, 46, 116, Jain10, 50);
    giq_option(4, 46, 117, Jain09, 50);
    giq_option(4, 46, 118, Jain08, 51);
    giq_option(4, 46, 119, JainEnd, 50);
  Jain08: |
    gsay_message(46, 120, 51);
    call JainEndCombat;
  Jain09: |
    call BigDownReact;
    gsay_message(46, 121, 51);
    call JainEndCombat;
  Jain10: |
    gsay_reply(46, 122);
    giq_option(4, 46, 123, Jain11, 49);
    giq_option(4, 46, 124, Jain26, 51);
    giq_option(4, 46, 125, Jain20, 50);
  Jain11: |
    call UpReact;
    gsay_reply(46, 126);
    giq_option(4, 46, 127, Jain17, 51);
    giq_option(4, 46, 128, Jain13, 50);
    giq_option(4, 46, 129, Jain12, 50);
  Jain12: |
    set_map_var(0, 1);
    gsay_reply(46, 130);
    giq_option(4, 46, 131, JainEnd, 50);
    giq_option(4, 46, 132, JainEndCombat, 51);
  Jain13: |
    gsay_reply(46, 133);
    giq_option(4, 46, 134, Jain14, 50);
    giq_option(4, 46, 135, Jain15, 51);
  Jain14: |
    gsay_reply(46, 136);
    giq_option(4, 46, 137, Jain20, 49);
    giq_option(4, 46, 138, Jain09, 51);
    giq_option(4, 46, 139, Jain15, 51);
  Jain15: |
    call DownReact;
    gsay_message(46, 140, 50);
  Jain17: |
    gsay_reply(46, 141);
    giq_option(4, 46, 142, Jain18, 51);
    giq_option(4, 46, 143, Jain19, 50);
  Jain18: |
    call DownReact;
    gsay_message(46, 144, 51);
  Jain19: |
    gsay_reply(46, 145);
    giq_option(4, 46, 146, Jain13, 50);
    giq_option(4, 46, 147, JainEnd, 50);
  Jain20: |
    call UpReact;
    gsay_reply(46, 148);
    giq_option(4, 46, 149, Jain21, 50);
    giq_option(4, 46, 150, Jain22, 50);
  Jain21: |
    gsay_reply(46, 151);
    giq_option(4, 46, 152, Jain38, 50);
    giq_option(4, 46, 153, JainEndCombat, 51);
    giq_option(4, 46, 154, Jain37, 50);
    giq_option(4, 46, 155, JainEnd, 50);
  Jain22: |
    gsay_reply(46, 156);
    giq_option(4, 46, 157, Jain37, 50);
    giq_option(4, 46, 158, Jain15, 51);
    giq_option(4, 46, 159, JainEnd, 50);
  Jain26: |
    call BigDownReact;
    gsay_reply(46, 161);
    giq_option(4, 46, 161, Jain19, 50);
    giq_option(4, 46, 162, JainEndCombat, 50);
  Jain27: |
    gsay_reply(46, 163);
    giq_option(4, 46, 164, Jain36, 50);
    giq_option(4, 46, 165, Jain28, 51);
    giq_option(4, 46, 166, JainEnd, 50);
    giq_option(-3, 46, 167, Jain39, 50);
    giq_option(-3, 46, 168, Jain34, 50);
  Jain28: |
    call BigDownReact;
    set_map_var(0, 1);
    gsay_message(46, 169, 50);
  Jain29: 'gsay_message(46, 170, 50);

    '
  Jain30: |
    gsay_reply(46, 171);
    giq_option(4, 46, 172, Jain31, 50);
    giq_option(4, 46, 173, Jain32, 50);
    giq_option(-3, 46, 174, Jain39, 50);
    giq_option(-3, 46, 175, JainEnd, 50);
  Jain31: |
    gsay_message(46, 176, 51);
    call JainEndCombat;
  Jain32: |
    gsay_reply(46, 177);
    giq_option(4, 46, 178, Jain33, 50);
    giq_option(4, 46, 179, JainEnd, 50);
  Jain33: 'gsay_message(46, 180, 50);

    '
  Jain34: |
    set_map_var(0, 1);
    gsay_message(46, 181, 51);
  Jain35: |
    set_map_var(0, 1);
    gsay_message(46, 182, 51);
  Jain36: |
    gsay_reply(46, 183);
    giq_option(4, 46, 184, Jain14, 50);
    giq_option(4, 46, 185, JainEnd, 50);
  Jain37: |
    call UpReact;
    gsay_message(46, 186, 49);
  Jain38: 'gsay_message(46, 187, 50);

    '
  Jain39: 'gsay_message(46, 188, 50);

    '
  JainEnd: "[]"
  JainEndCombat: |
    call BottomReact;
    set_map_var(0, 1);
    call combat;
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
jake:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(268, 100));
    end
    else begin
      display_msg(message_str(268, 101));
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (local_var(5) == 1) then begin
      float_msg(self_obj, message_str(268, 143), 2);
    end
    if (not(local_var(5))) then begin
      start_gdialog(268, self_obj, 4, -1, -1);
      gsay_start;
      set_local_var(4, 1);
      if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
        call Jake06;
      end
      else begin
        if (global_var(133) == 2) then begin
          call Jake08;
        end
        else begin
          call Jake00;
        end
      end
      gsay_end;
      end_dialogue;
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(256, 1);
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 5, 34);
      critter_add_trait(self_obj, 1, 6, 46);
      initialized := 1;
    end
  Jake00: |
    gsay_reply(268, 102);
    giq_option(-3, 268, 103, Jake01, 50);
    giq_option(4, 268, 104, Jake02, 50);
    giq_option(4, 268, 106, Jake07, 50);
  Jake01: 'gsay_message(268, 107, 50);

    '
  Jake02: |
    gsay_reply(268, 108);
    giq_option(4, 268, 109, Jake03, 50);
    if (local_var(1) == 0) then begin
      giq_option(6, 268, 145, Jake09, 50);
    end
    giq_option(4, 268, 111, Jake04, 50);
    giq_option(4, 268, 110, JakeEnd, 50);
  Jake03: |
    gsay_reply(268, 112);
    giq_option(4, 268, 113, Jake05, 49);
    giq_option(4, 268, 116, JakeEnd, 50);
  Jake04: |
    gsay_reply(268, 114);
    giq_option(4, 268, 115, Jake05, 50);
    giq_option(4, 268, 116, JakeEnd, 50);
  Jake05: |
    gsay_message(268, 117, 50);
    set_local_var(5, 1);
  Jake06: 'gsay_message(268, 137, 50);

    '
  Jake07: 'gsay_message(268, 126, 50);

    '
  Jake08: 'gsay_message(268, 139, 50);

    '
  Jake09: |
    gsay_message(268, 146, 50);
    critter_mod_skill(dude_obj, 3, 15);
    gfade_out(600);
    game_time_advance(10 * 60 * 60 * 24);
    gfade_in(600);
    set_local_var(1, 1);
    display_msg(message_str(268, 147));
    float_msg(self_obj, message_str(268, 148), 3);
  JakeEnd: "[]"
jarvis:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 0) then begin
      display_msg(message_str(440, 102));
    end
    else begin
      display_msg(message_str(440, 103));
    end
  map_enter_p_proc: |
    if (local_var(5) == 0) then begin
      anim(self_obj, 48, 0);
      add_timer_event(self_obj, game_ticks(3600), 1);
    end
    critter_add_trait(self_obj, 1, 6, 2);
    critter_add_trait(self_obj, 1, 5, 23);
  talk_p_proc: |
    if (local_var(5) == 0) then begin
      call Jarvis01;
    end
    else begin
      start_gdialog(440, self_obj, 4, -1, -1);
      gsay_start;
      if (local_var(4) == 0) then begin
        call Jarvis02;
      end
      else begin
        call Jarvis03;
      end
      gsay_end;
      end_dialogue;
    end
  use_skill_on_p_proc: |
    variable LVar0 := 0;
    LVar0 := roll_vs_skill(dude_obj, action_being_used, 0);
    if (local_var(5) == 0) then begin
      script_overrides;
      if (action_being_used == 6) then begin
        if (is_success(LVar0)) then begin
          display_msg(message_str(440, 112));
        end
        else begin
          display_msg(message_str(440, 113));
        end
      end
      else begin
        if (action_being_used == 7) then begin
          if (is_success(LVar0)) then begin
            display_msg(message_str(440, 114));
          end
          else begin
            display_msg(message_str(440, 115));
          end
        end
        else begin
          display_msg(message_str(440, 116));
        end
      end
    end
  use_obj_on_p_proc: |
    if ((obj_pid(obj_being_used_with) == 49) and (local_var(5) == 0)) then begin
      script_overrides;
      rm_timer_event(self_obj);
      set_local_var(5, 1);
      set_global_var(239, 2);
      rm_obj_from_inven(dude_obj, obj_being_used_with);
      destroy_object(obj_being_used_with);
      display_msg(message_str(440, 117));
      give_exp_points(400);
      set_global_var(155, global_var(155) + 1);
      display_msg(message_str(440, 200));
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    rm_timer_event(self_obj);
  combat_p_proc: |
    if ((fixed_param == 4) and (local_var(5) == 0)) then begin
      script_overrides;
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((local_var(5) == 1) and (anim_busy(self_obj) == 0)) then begin
      if (critter_state(self_obj) == 2) then begin
        reg_anim_func(2, self_obj);
        reg_anim_func(1, 1);
        reg_anim_animate(self_obj, 37, -1);
        reg_anim_func(3, 0);
      end
      else begin
        if (critter_state(self_obj) == 0) then begin
          set_local_var(5, 2);
          anim(self_obj, 1000, 2);
        end
      end
    end
  pickup_p_proc: 'hostile := 1;

    '
  timed_event_p_proc: |
    if (local_var(5) == 0) then begin
      add_timer_event(self_obj, game_ticks(7200), 1);
    end
    if (tile_distance_objs(dude_obj, self_obj) < get_critter_stat(dude_obj, 1)) then begin
      display_msg(message_str(440, 100));
      float_msg(self_obj, message_str(440, 101), 0);
    end
  map_exit_p_proc: 'rm_timer_event(self_obj);

    '
  Jarvis01: 'float_msg(self_obj, message_str(440, 104), 0);

    '
  Jarvis02: |
    gsay_reply(440, 105);
    set_local_var(4, 1);
    call Jarvis04;
  Jarvis03: |
    gsay_reply(440, 106);
    call Jarvis04;
  Jarvis04: |
    giq_option(4, 440, 107, Jarvis05, 50);
    giq_option(4, 440, 108, Jarvis06, 50);
    giq_option(4, 440, 109, Jarvisend, 50);
    giq_option(-3, 440, 118, Jarvis05, 50);
    giq_option(-3, 440, 119, Jarvis06, 50);
    giq_option(-3, 440, 120, Jarvisend, 50);
  Jarvis05: |
    gsay_reply(440, 110);
    call Jarvis04;
  Jarvis06: |
    gsay_reply(440, 111);
    call Jarvis04;
  Jarvisend: "[]"
jasmine:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (map_var(1) == 1) then begin
      call Jasmine01;
    end
    else begin
      if (global_var(107) == 0) then begin
        call Jasmine02;
      end
      else begin
        if ((global_var(107) == 1) and (local_var(6) == 0)) then begin
          start_gdialog(592, self_obj, 4, -1, -1);
          gsay_start;
          call Jasmine03;
          gsay_end;
          end_dialogue;
        end
        else begin
          if (global_var(107) == 1) then begin
            call Jasmine05;
          end
          else begin
            if ((map_var(3) == 1) and (local_var(5) == 0)) then begin
              start_gdialog(592, self_obj, 4, -1, -1);
              gsay_start;
              call Jasmine06;
              gsay_end;
              end_dialogue;
            end
            else begin
              if ((global_var(107) == 2) and (global_var(636) == 0)) then begin
                start_gdialog(592, self_obj, 4, -1, -1);
                gsay_start;
                call clock01;
                gsay_end;
                end_dialogue;
              end
              else begin
                if ((global_var(636) == 1) and obj_is_carrying_obj_pid(dude_obj, 88)) then begin
                  start_gdialog(592, self_obj, 4, -1, -1);
                  gsay_start;
                  call clock04;
                  gsay_end;
                  end_dialogue;
                end
                else begin
                  call Jasmine07;
                end
              end
            end
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(592, 100));
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 39);
      critter_add_trait(self_obj, 1, 5, 52);
    end
  Jasmine01: 'float_msg(self_obj, message_str(592, 103), 2);

    '
  Jasmine02: 'float_msg(self_obj, message_str(592, 104), 2);

    '
  Jasmine03: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(84, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(79, 0, 0, -1);
    add_mult_objs_to_inven(dude_obj, LVar0, 2);
    LVar0 := create_object_sid(106, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    set_local_var(6, 1);
    gsay_reply(592, 105);
    giq_option(4, 592, 106, Jasmine08, 50);
    giq_option(4, 592, 107, Jasmine09, 50);
    giq_option(4, 592, 108, Jasmine10, 50);
    giq_option(4, 592, 109, Jasmine11, 50);
    giq_option(4, 592, 110, Jasmine12, 50);
    giq_option(4, 592, 111, Jasmine13, 50);
    giq_option(-3, 592, 112, Jasmine14, 50);
  Jasmine05: 'float_msg(self_obj, message_str(592, 117), 2);

    '
  Jasmine06: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    set_local_var(5, 1);
    LVar0 := item_caps_adjust(dude_obj, 3000);
    LVar1 := create_object_sid(77, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(592, 118, 50);
    end
    else begin
      gsay_message(592, 119, 50);
    end
    gsay_message(592, 121, 50);
    gsay_message(592, 135, 50);
  Jasmine07: 'float_msg(self_obj, message_str(592, 122), 3);

    '
  Jasmine08: |
    gsay_message(592, 132, 50);
    gsay_message(592, 123, 50);
  Jasmine09: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(592, 124, 50);
    end
    else begin
      gsay_message(592, 134, 50);
    end
  Jasmine10: 'gsay_message(592, 125, 50);

    '
  Jasmine11: 'gsay_message(592, 126, 50);

    '
  Jasmine12: 'gsay_message(592, 127, 50);

    '
  Jasmine13: 'gsay_message(592, 128, 50);

    '
  Jasmine14: 'gsay_message(592, 129, 50);

    '
  clock01: |
    gsay_reply(592, 136);
    giq_option(4, 592, 137, clock02, 50);
    giq_option(4, 592, 138, JasmineEnd, 50);
  clock02: |
    gsay_message(592, 139, 50);
    gsay_reply(592, 140);
    giq_option(4, 592, 141, clock03, 50);
    giq_option(4, 592, 138, JasmineEnd, 50);
  clock03: |
    gsay_message(592, 142, 50);
    set_global_var(636, 1);
  clock04: |
    gsay_reply(592, 143);
    giq_option(4, 592, 144, clock05, 50);
    giq_option(4, 592, 138, JasmineEnd, 50);
  clock05: |
    variable LVar0 := 0;
    LVar0 := obj_carrying_pid_obj(dude_obj, 88);
    if (obj_is_carrying_obj_pid(dude_obj, 88)) then begin
      rm_obj_from_inven(dude_obj, LVar0);
      add_obj_to_inven(self_obj, LVar0);
    end
    item_caps_adjust(dude_obj, 1000);
    give_exp_points(500);
    display_msg(message_str(766, 103) + 500 + message_str(766, 104));
    set_global_var(636, 2);
    gsay_message(592, 145, 50);
    display_msg(message_str(592, 146));
    set_global_var(155, global_var(155) + 5);
  JasmineEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
jason:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 49);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (following) then begin
      call follow_player;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (not(local_var(1))) then begin
      display_msg(message_str(382, 101));
    end
    else begin
      display_msg(message_str(382, 100));
    end
  talk_p_proc: |
    start_gdialog(382, self_obj, 4, -1, -1);
    gsay_start;
    if (cur_map_index == 45) then begin
      if (following) then begin
        call Jason23;
      end
      else begin
        call Jason19;
      end
    end
    if (local_var(0)) then begin
      call Jason18;
    end
    else begin
      if (local_var(1)) then begin
        call Jason16;
      end
      else begin
        call Jason01;
      end
    end
    gsay_end;
    end_dialogue;
  Jason01: |
    gsay_reply(382, 102);
    giq_option(4, 382, 103, Jason05, 50);
    giq_option(4, 382, 104, Jason13, 50);
    giq_option(4, 382, 105, Jason08, 50);
    giq_option(4, 382, 106, Jason07, 50);
    giq_option(-3, 382, 107, Jason02, 50);
  Jason02: 'gsay_message(382, 108, 50);

    '
  Jason03: |
    gsay_message(382, 109, 50);
    gsay_message(382, 110, 50);
  Jason04: |
    gsay_message(382, 111, 50);
    gsay_message(382, 112, 50);
  Jason05: |
    gsay_reply(382, 113);
    giq_option(4, 382, 114, Jason06, 50);
    giq_option(4, 382, 115, Jason14, 50);
  Jason06: |
    gsay_reply(382, 116);
    giq_option(4, 382, 117, Jason07, 50);
    giq_option(4, 382, 118, Jason08, 50);
    giq_option(6, 382, 119, Jason15, 50);
  Jason07: |
    gsay_reply(382, 120);
    giq_option(4, 382, 121, Jason12, 50);
    giq_option(4, 382, 122, Jason08, 50);
  Jason08: |
    gsay_reply(382, 123);
    giq_option(4, 382, 124, Jason12, 50);
  Jason09: |
    gsay_reply(382, 125);
    giq_option(4, 382, 126, Jason10, 50);
    giq_option(4, 382, 127, Jason11, 50);
  Jason10: 'gsay_message(382, 128, 50);

    '
  Jason11: 'gsay_message(382, 129, 50);

    '
  Jason12: 'gsay_message(382, 130, 50);

    '
  Jason13: |
    gsay_message(382, 131, 50);
    set_local_var(0, 1);
  Jason14: |
    gsay_message(382, 132, 50);
    call Jason10;
  Jason15: |
    gsay_message(382, 133, 50);
    call Jason11;
  Jason16: |
    gsay_reply(382, 134);
    giq_option(4, 382, 135, Jason08, 50);
    giq_option(4, 382, 136, Jason17, 50);
  Jason17: 'gsay_message(382, 137, 50);

    '
  Jason18: 'gsay_message(382, 138, 50);

    '
  Jason19: |
    gsay_reply(382, 139);
    giq_option(-3, 382, 140, Jason20, 50);
    giq_option(4, 382, 141, Jason20, 50);
    giq_option(4, 382, 142, Jason21, 50);
    giq_option(4, 382, 143, Jason22, 50);
  Jason20: |
    gsay_message(382, 144, 50);
    critter_add_trait(self_obj, 1, 6, 0);
    following := 1;
  Jason21: 'gsay_message(382, 145, 50);

    '
  Jason22: |
    gsay_reply(382, 146);
    giq_option(4, 382, 147, Jason20, 50);
    giq_option(4, 382, 148, Jason21, 50);
  Jason23: 'gsay_message(382, 149, 50);

    '
  follow_player: |
    if (tile_distance_objs(self_obj, dude_obj) > 7) then begin
      animate_move_obj_to_tile(self_obj, tile_num(dude_obj), 1);
    end
    else begin
      if (tile_distance_objs(self_obj, dude_obj) > 3) then begin
        animate_move_obj_to_tile(self_obj, tile_num(dude_obj), 0);
      end
      else begin
        animate_move_obj_to_tile(self_obj, tile_num(self_obj), 0);
      end
    end
jchidmem:
  start: "[]"
  critter_p_proc: |
    if (scared and (tile_distance_objs(self_obj, dude_obj) < 8) and (local_var(4) == 0)) then begin
      call flee_dude;
    end
    else begin
      call sleeping;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  map_enter_p_proc: |
    if (global_var(15) == 1) then begin
      destroy_object(self_obj);
    end
    wake_time := 700;
    sleep_time := 1900;
    critter_add_trait(self_obj, 1, 6, 20);
    if (local_var(6) == 0) then begin
      set_local_var(6, tile_num(self_obj));
    end
    home_tile := local_var(6);
    sleep_tile := 15275;
    if ((game_time / (10 * 60 * 60 * 24)) < 80) then begin
      set_obj_visibility(self_obj, 1);
    end
    else begin
      set_obj_visibility(self_obj, 0);
    end
  map_update_p_proc: |
    if ((game_time / (10 * 60 * 60 * 24)) < 80) then begin
      set_obj_visibility(self_obj, 1);
    end
    else begin
      set_obj_visibility(self_obj, 0);
    end
  pickup_p_proc: 'scared := 1;

    '
  talk_p_proc: |
    if (scared) then begin
      float_msg(self_obj, message_str(108, 145), 2);
    end
    else begin
      if (local_var(5) == 0) then begin
        start_gdialog(108, self_obj, 4, -1, -1);
        gsay_start;
        call Child00;
        gsay_end;
        end_dialogue;
      end
    end
  ChildEnd: "[]"
  child_heal: |
    game_time_advance(game_ticks(600 * hp_injured));
    critter_heal(dude_obj, hp_injured);
    set_global_var(154, global_var(154) - 1);
  child_pois: |
    if (get_poison(dude_obj) != 0) then begin
      game_time_advance(game_ticks(1800));
    end
    poison(dude_obj, -get_poison(dude_obj));
  Child00: |
    gsay_reply(108, 100);
    giq_option(4, 108, 101, Child04, 50);
    giq_option(5, 108, 102, Child11, 50);
    if ((map_var(2) == 1) and (local_var(7) == 0)) then begin
      giq_option(5, 108, 103, Child15, 50);
    end
    giq_option(-3, 108, 104, Child01, 50);
  Child01: |
    gsay_message(108, 105, 50);
    if (get_critter_stat(dude_obj, 35) < get_critter_stat(dude_obj, 7)) then begin
      call child_heal;
      call Child03;
    end
    else begin
      call Child02;
    end
  Child02: 'gsay_message(108, 106, 50);

    '
  Child03: |
    critter_heal(dude_obj, get_critter_stat(dude_obj, 7) - get_critter_stat(dude_obj, 35));
    poison(dude_obj, -get_poison(dude_obj));
    gsay_message(108, 107, 50);
  Child04: |
    if (local_var(1) == 3) then begin
      healing_cost := 5;
      poison_cost := 12;
    end
    else begin
      if (local_var(1) == 1) then begin
        healing_cost := 20;
        poison_cost := 50;
      end
      else begin
        healing_cost := 10;
        poison_cost := 25;
      end
    end
    hp_injured := get_critter_stat(dude_obj, 7) - get_critter_stat(dude_obj, 35);
    cost := hp_injured * healing_cost;
    if (get_poison(dude_obj) != 0) then begin
      cost := cost + poison_cost;
    end
    if (hp_injured > 0) then begin
      gsay_message(108, 108, 50);
    end
    if (get_poison(dude_obj) != 0) then begin
      gsay_message(108, 109, 50);
    end
    if (get_critter_stat(dude_obj, 37) > 50) then begin
      gsay_message(108, 110, 50);
    end
    if (cost > 0) then begin
      gsay_reply(108, message_str(108, 111) + cost + message_str(108, 112));
      giq_option(4, 108, 113, Child04a, 50);
      giq_option(4, 108, 114, ChildEnd, 50);
      giq_option(4, 108, 115, Child09, 50);
      giq_option(4, 108, message_str(108, 116) + (cost * 0.75000) + message_str(108, 117), Child05, 50);
    end
    else begin
      gsay_message(108, 146, 50);
    end
  Child04a: |
    if (cost > item_caps_total(dude_obj)) then begin
      call Child08;
    end
    else begin
      call Child06;
    end
  Child05: |
    gsay_reply(108, 118);
    giq_option(4, 108, 119, Child05a, 50);
    giq_option(4, 108, 120, Child05b, 51);
  Child05a: |
    if (cost > item_caps_total(dude_obj)) then begin
      call Child08;
    end
    else begin
      call Child06;
    end
  Child05b: |
    set_local_var(5, 1);
    call ChildEnd;
  Child06: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(108, 121);
    end
    else begin
      gsay_reply(108, 122);
    end
    giq_option(0, 634, 106, Child07, 50);
  Child07: |
    gfade_out(600);
    item_caps_adjust(dude_obj, -cost);
    call child_heal;
    call child_pois;
    gfade_in(600);
    gsay_message(108, 123, 50);
  Child08: |
    if (item_caps_total(dude_obj) > 0) then begin
      cost := item_caps_total(dude_obj);
    end
    gsay_reply(108, 124);
    if (item_caps_total(dude_obj) > 0) then begin
      giq_option(4, 108, 125, Child06, 50);
    end
    giq_option(4, 108, 129, ChildEnd, 50);
  Child09: |
    if (item_caps_total(dude_obj) > 0) then begin
      cost := item_caps_total(dude_obj);
    end
    gsay_reply(108, 127);
    if (item_caps_total(dude_obj) > 0) then begin
      giq_option(4, 108, 128, Child09a, 50);
    end
    giq_option(4, 108, 129, ChildEnd, 50);
  Child09a: |
    if (cost > item_caps_total(dude_obj)) then begin
      call Child06;
    end
    else begin
      call Child10;
    end
  Child10: |
    gsay_reply(108, 130);
    giq_option(0, 634, 106, Child06, 50);
  Child11: |
    gsay_reply(108, 131);
    giq_option(4, 108, 132, ChildEnd, 50);
    giq_option(4, 108, 133, Child12, 50);
  Child12: |
    gsay_reply(108, 134);
    giq_option(4, 108, 135, Child14, 50);
    giq_option(4, 108, 136, Child13, 50);
  Child13: 'gsay_message(108, 137, 51);

    '
  Child14: |
    gsay_reply(108, 138);
    giq_option(4, 108, 139, ChildEnd, 50);
  Child15: |
    set_local_var(7, 1);
    gsay_reply(108, 140);
    giq_option(5, 108, 141, Child16, 50);
    giq_option(5, 108, 142, ChildEnd, 50);
  Child16: |
    gsay_reply(108, 143);
    giq_option(5, 108, 144, ChildEnd, 50);
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
  sleeping: |
    if (local_var(4) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(4, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(4, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, sleep_tile, 0);
          end
          else begin
            set_local_var(4, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(4, 1);
          end
        end
      end
    end
jennifer:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 65);
    end
  pre_dialogue: |
    if (local_var(0) >= 0) then begin
      call do_dialogue;
    end
    else begin
      if (local_var(0) < 2) then begin
        call JenniferRandom3;
      end
    end
  do_dialogue: |
    start_gdialog(-1, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(7) == 0) then begin
      call Jennifer01;
    end
    else begin
      call Jennifer25;
    end
    gsay_end;
    end_dialogue;
  weapon_check: |
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      armed := 1;
    end
    else begin
      armed := 0;
    end
  Jennifer00: |
    warned := 1;
    float_msg(self_obj, message_str(462, 102), 0);
    float_msg(self_obj, message_str(462, 103), 0);
  Jennifer01: |
    gsay_reply(462, 104);
    if ((get_critter_stat(dude_obj, 34) == 1) and (local_var(5) == 0)) then begin
      giq_option(5, 462, 105, Jennifer14, 49);
    end
    else begin
      if ((get_critter_stat(dude_obj, 3) > 7) and (local_var(6) == 0)) then begin
        giq_option(5, 462, 106, JenniferCharm, 49);
      end
    end
    giq_option(5, 462, 108, Jennifer01a, 49);
    giq_option(4, 462, 109, Jennifer01b, 51);
    giq_option(4, 462, 115, Jennifer07, 50);
    giq_option(5, 462, 114, UpReact, 50);
    giq_option(-3, 462, 111, Jennifer11, 50);
  Jennifer01a: |
    call UpReact;
    call Jennifer02;
  Jennifer01b: |
    call BigDownReact;
    call Jennifer20;
  Jennifer02: |
    gsay_message(462, 112, 50);
    gsay_reply(462, 113);
    giq_option(5, 462, 114, JenniferEnd, 50);
  Jennifer05: |
    gsay_reply(462, 160);
    giq_option(5, 462, 153, Jennifer22, 49);
    giq_option(4, 462, 179, BigDownReact, 51);
  Jennifer07: |
    gsay_message(462, 116, 50);
    gsay_reply(462, 117);
    giq_option(4, 462, 118, UpReact, 49);
    giq_option(4, 462, 119, Jennifer08, 50);
    giq_option(4, 462, 120, DownReact, 51);
  Jennifer08: |
    gsay_reply(462, 121);
    giq_option(6, 462, 123, Jennifer29, 50);
    if (get_critter_stat(dude_obj, 34) == 1) then begin
      giq_option(5, 462, 124, Jennifer14, 50);
    end
    else begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        giq_option(5, 462, 122, UpReact, 50);
      end
    end
    giq_option(4, 462, 126, JenniferEnd, 50);
  Jennifer11: |
    gsay_reply(462, 127);
    giq_option(-3, 462, 128, Jennifer13, 50);
  Jennifer13: 'gsay_message(462, 129, 50);

    '
  Jennifer14: |
    call TopReact;
    set_local_var(5, 1);
    gsay_message(462, 130, 50);
    gsay_reply(462, 131);
    giq_option(8, 462, 132, Jennifer16, 50);
    giq_option(4, 462, 133, Jennifer15, 50);
    giq_option(4, 462, 134, Jennifer17, 50);
  Jennifer15: |
    gsay_reply(462, 135);
    giq_option(4, 462, 136, Jennifer17, 50);
    giq_option(4, 462, 137, Jennifer17, 50);
  Jennifer16: |
    gsay_reply(462, 138);
    giq_option(8, 462, 139, Jennifer18, 50);
    giq_option(4, 462, 140, Jennifer17, 50);
  Jennifer17: |
    gsay_reply(462, 141);
    giq_option(4, 462, 142, Jennifer02, 50);
    giq_option(4, 462, 143, Jennifer05, 50);
    giq_option(4, 462, 144, JenniferEnd, 50);
  Jennifer18: |
    gsay_message(462, 145, 50);
    gsay_reply(462, 146);
    giq_option(4, 462, 147, Jennifer19, 50);
  Jennifer19: |
    gsay_message(462, 148, 50);
    gsay_reply(462, 149);
    call JenniferEnd;
  Jennifer20: |
    gsay_reply(462, 150);
    giq_option(5, 462, 151, BigDownReact, 51);
    giq_option(4, 462, 152, UpReact, 49);
    giq_option(4, 462, 153, DownReact, 51);
  Jennifer21: |
    variable LVar0 := 0;
    set_local_var(8, 1);
    gsay_message(462, 235, 49);
    gsay_message(462, 240, 49);
    gsay_message(462, 206, 49);
    LVar0 := obj_carrying_pid_obj(dude_obj, 117);
    if (LVar0) then begin
      rm_obj_from_inven(dude_obj, LVar0);
      destroy_object(LVar0);
    end
    LVar0 := obj_carrying_pid_obj(dude_obj, 124);
    if (LVar0) then begin
      rm_obj_from_inven(dude_obj, LVar0);
      destroy_object(LVar0);
    end
    gfade_out(400);
    gfade_in(400);
    game_time_advance(game_ticks(21600));
    float_msg(dude_obj, message_str(462, 233), 3);
    give_exp_points(300);
    display_msg(message_str(462, 242));
  Jennifer22: 'set_local_var(7, 1);

    '
  Jennifer23: |
    call TopReact;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(462, 163, 49);
      gsay_reply(462, 164);
    end
    else begin
      gsay_message(462, 158, 49);
      gsay_reply(462, 159);
    end
    giq_option(4, 462, 165, Jennifer02, 50);
    giq_option(4, 462, 125, Jennifer05, 50);
    giq_option(4, 462, 168, JenniferEnd, 50);
  Jennifer25: |
    gsay_reply(462, 162);
    if (obj_is_carrying_obj_pid(dude_obj, 117) and obj_is_carrying_obj_pid(dude_obj, 124) and (local_var(7) == 1)) then begin
      giq_option(5, 462, 161, Jennifer21, 49);
    end
    else begin
      giq_option(5, 462, 176, JenniferEnd, 50);
    end
  Jennifer26: |
    gsay_reply(462, 169);
    giq_option(4, 462, 170, BigDownReact, 51);
    giq_option(4, 462, 171, Jennifer27, 50);
    giq_option(4, 462, 172, JenniferEnd, 50);
  Jennifer27: |
    gsay_reply(462, 173);
    giq_option(4, 462, 174, Jennifer02, 50);
    giq_option(4, 462, 175, Jennifer07, 50);
    giq_option(4, 462, 176, JenniferEnd, 50);
    set_local_var(6, 1);
  Jennifer29: |
    gsay_reply(462, 181);
    giq_option(4, 462, 182, Jennifer30, 50);
    giq_option(4, 462, 183, BigDownReact, 51);
  Jennifer30: |
    gsay_message(462, 184, 50);
    gsay_message(462, 185, 50);
    gsay_reply(462, 186);
    giq_option(7, 462, 187, Jennifer31, 50);
    giq_option(4, 462, 188, UpReact, 49);
    giq_option(4, 462, 189, DownReact, 51);
    giq_option(4, 462, 190, Jennifer02, 50);
  Jennifer31: |
    gsay_reply(462, 191);
    giq_option(4, 462, 192, JenniferEnd, 50);
    giq_option(4, 462, 193, DownReact, 51);
    giq_option(4, 462, 194, Jennifer02, 50);
  JenniferCharm: |
    set_local_var(6, 1);
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call BigUpReact;
      call Jennifer23;
    end
    else begin
      call Jennifer26;
    end
  JenniferEnd: "[]"
  JenniferRandom1: |
    if ((game_time_hour > 800) and (game_time_hour < 1700)) then begin
      float_msg(self_obj, message_str(462, 194 + random(1, 7)), 4);
    end
    else begin
      float_msg(self_obj, message_str(462, 201 + random(1, 9)), 4);
    end
  JenniferRandom3: 'float_msg(self_obj, message_str(462, 217 + random(1, 8)), 7);

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (warned == 0) then begin
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          if (armed == 0) then begin
            call weapon_check;
          end
          if (armed) then begin
            call Jennifer00;
          end
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    if (local_var(8) == 1) then begin
      call JenniferRandom1;
    end
    else begin
      call pre_dialogue;
    end
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (known) then begin
      display_msg(message_str(462, 100));
    end
    else begin
      display_msg(message_str(462, 101));
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 100);
    call ReactToLevel;
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 150);
    call ReactToLevel;
jerem:
  start: |
    if (local_var(0) == 0) then begin
      set_local_var(0, 1);
      set_local_var(1, 0);
      set_local_var(2, 0);
      set_local_var(3, 7);
      set_local_var(4, 12098);
    end
    if (only_once) then begin
      only_once := 0;
      home_tile := 12098;
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 69);
      if (global_var(233) == 1) then begin
        set_obj_visibility(self_obj, 1);
        moving := 0;
      end
      else begin
        if (global_var(232) == 1) then begin
          set_obj_visibility(self_obj, 1);
          moving := 0;
          add_timer_event(self_obj, game_ticks(300), 1);
        end
      end
    end
    else begin
      if (global_var(233) != 1) then begin
        if (script_action == 11) then begin
          call pre_dialogue;
        end
        else begin
          if (script_action == 22) then begin
            if (fixed_param == 1) then begin
              moving := 1;
              set_global_var(232, 0);
              if (local_var(1) == 0) then begin
                move_to(self_obj, home_tile, 0);
                set_local_var(3, 7);
                set_local_var(4, 12098);
                set_obj_visibility(self_obj, 0);
              end
            end
            else begin
              if (fixed_param == 2) then begin
                set_local_var(2, 2);
              end
              else begin
                if (fixed_param == 3) then begin
                  moving := 1;
                  set_local_var(4, 19685);
                  set_local_var(3, 4);
                  set_local_var(1, 0);
                  animate_move_obj_to_tile(self_obj, local_var(4), 0);
                end
              end
            end
          end
          else begin
            if (script_action == 4) then begin
              HOSTILE := 1;
            end
          end
        end
        if (script_action == 12) then begin
          set_map_var(1, 0);
          if (tile_distance_objs(dude_obj, self_obj) < 8) then begin
            set_map_var(1, 1);
          end
          if (HOSTILE) then begin
            HOSTILE := 0;
            attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
          end
          if (moving) then begin
            my_hex := tile_num(self_obj);
            if (my_hex == local_var(4)) then begin
              if (local_var(1)) then begin
                set_local_var(3, local_var(3) + 1);
              end
              else begin
                set_local_var(3, local_var(3) - 1);
              end
              if (local_var(3) > 7) then begin
                moving := 0;
                set_local_var(1, 0);
                set_local_var(3, 6);
                set_obj_visibility(self_obj, 1);
                set_global_var(232, 1);
                move_to(self_obj, 7000, 0);
                add_timer_event(self_obj, game_ticks(300), 1);
              end
              else begin
                if (local_var(3) < 0) then begin
                  moving := 0;
                  set_local_var(1, 1);
                  set_local_var(3, 1);
                  add_timer_event(self_obj, game_ticks(300), 1);
                end
                else begin
                  if ((local_var(3) == 5) and (local_var(1) == 0)) then begin
                    moving := 0;
                    add_timer_event(self_obj, game_ticks(60), 3);
                  end
                end
              end
              if (local_var(3) == 0) then begin
                set_local_var(4, 20936);
              end
              else begin
                if (local_var(3) == 1) then begin
                  set_local_var(4, 25336);
                end
                else begin
                  if (local_var(3) == 2) then begin
                    set_local_var(4, 25721);
                  end
                  else begin
                    if (local_var(3) == 3) then begin
                      set_local_var(4, 27915);
                    end
                    else begin
                      if (local_var(3) == 4) then begin
                        set_local_var(4, 26094);
                      end
                      else begin
                        if (local_var(3) == 5) then begin
                          set_local_var(4, 19685);
                        end
                        else begin
                          if (local_var(3) == 6) then begin
                            if (local_var(1) == 0) then begin
                              set_local_var(4, 12889);
                            end
                            else begin
                              set_local_var(4, 14689);
                            end
                          end
                          else begin
                            if (local_var(3) == 7) then begin
                              set_local_var(4, 12098);
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
            else begin
              animate_move_obj_to_tile(self_obj, local_var(4), 0);
            end
            if (obj_can_see_obj(self_obj, dude_obj)) then begin
              DISGUISED := 0;
              if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
                if (metarule(16, 0) > 1) then begin
                  DISGUISED := 0;
                end
                else begin
                  DISGUISED := 1;
                end
              end
              if ((DISGUISED == 0) and (again < 2)) then begin
                if (tile_distance_objs(self_obj, dude_obj) < 6) then begin
                  if (local_var(2) < 1) then begin
                    set_local_var(2, 1);
                    add_timer_event(self_obj, game_ticks(15), 2);
                    dialogue_system_enter;
                  end
                  else begin
                    if (local_var(2) > 1) then begin
                      call jerem29;
                    end
                  end
                end
              end
            end
          end
        end
        else begin
          if ((script_action == 21) or (script_action == 3)) then begin
            script_overrides;
            display_msg(message_str(672, 100));
          end
          else begin
            if (script_action == 18) then begin
              set_global_var(233, 1);
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(160, global_var(160) + 1);
                if ((global_var(160) % 6) == 0) then begin
                  set_global_var(155, global_var(155) + 1);
                end
              end
            end
          end
        end
      end
    end
  pre_dialogue: |
    again := again + 1;
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      if (metarule(16, 0) > 1) then begin
        DISGUISED := 0;
      end
      else begin
        DISGUISED := 1;
      end
    end
    if ((DISGUISED == 0) and (again > 1)) then begin
      call jerem29;
    end
    else begin
      again := again - 1;
      call do_dialogue;
    end
  do_dialogue: |
    call checkarea;
    start_gdialog(672, self_obj, 4, -1, -1);
    gsay_start;
    again := again + 1;
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      if (metarule(16, 0) > 1) then begin
        DISGUISED := 0;
      end
      else begin
        DISGUISED := 1;
      end
      if (again == 1) then begin
        call jerem00;
      end
      else begin
        if (again > 2) then begin
          call jerem26;
        end
        else begin
          if ((again == 2) and (global_var(231) == 1)) then begin
            call jerem23;
          end
          else begin
            call jerem00;
          end
        end
      end
    end
    else begin
      if (area == 50) then begin
        if (again > 1) then begin
          call jerem28;
        end
        else begin
          call jerem13;
        end
      end
      else begin
        if (area == 2) then begin
          if (again > 1) then begin
            call jerem28;
          end
          else begin
            call jerem19;
          end
        end
        else begin
          if (area == 1) then begin
            if (again > 1) then begin
              call jerem28;
            end
            else begin
              call jerem20;
            end
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
  checkarea: |
    here := tile_num(dude_obj);
    area := 2;
    if (tile_distance(here, 13475) < 15) then begin
      area := 1;
    end
    else begin
      if (tile_distance(here, 13296) < 15) then begin
        area := 1;
      end
      else begin
        if (tile_distance(here, 16089) < 15) then begin
          area := 1;
        end
        else begin
          if (tile_distance(here, 25726) < 15) then begin
            area := 50;
          end
          else begin
            if (tile_distance(here, 27322) < 15) then begin
              area := 50;
            end
            else begin
              if (tile_distance(here, 25737) < 15) then begin
                area := 50;
              end
              else begin
                if (tile_distance(here, 22136) < 15) then begin
                  area := 50;
                end
              end
            end
          end
        end
      end
    end
  jerem00: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(672, 102);
    end
    else begin
      gsay_reply(672, 192);
    end
    giq_option(-3, 672, 103, jerem01, 50);
    giq_option(4, 672, 104, jerem00a, 50);
  jerem00a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -5))) then begin
      call jerem03;
    end
    else begin
      call jerem02;
    end
  jerem01: 'gsay_message(672, 105, 50);

    '
  jerem02: |
    gsay_reply(672, 106);
    giq_option(7, 672, 107, jerem02a, 50);
    giq_option(4, 672, 108, jerem04, 50);
    giq_option(4, 672, 109, jerem04, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 672, 110, jerem02b, 50);
    end
  jerem02a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call jerem05;
    end
    else begin
      call jerem07;
    end
  jerem02b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call jerem05;
    end
    else begin
      call jerem06;
    end
  jerem03: |
    gsay_reply(672, 111);
    giq_option(4, 672, 112, jerem03a, 50);
    giq_option(4, 672, 113, jerem07, 50);
    giq_option(4, 672, 114, jeremend, 50);
  jerem03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call jerem08;
    end
    else begin
      call jerem09;
    end
  jerem04: 'gsay_message(672, 115, 50);

    '
  jerem05: |
    gsay_reply(672, 116);
    giq_option(4, 672, 117, jerem03, 50);
    giq_option(4, 672, 118, jerem05a, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 672, 119, jeremcbt, 51);
    end
  jerem05a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call jerem08;
    end
    else begin
      call jerem12;
    end
  jerem06: |
    gsay_message(672, 120, 51);
    call jeremcbt;
  jerem07: |
    gsay_reply(672, 121);
    giq_option(4, 672, 122, jerem06, 51);
    giq_option(-4, 672, 103, jerem01, 50);
    giq_option(7, 672, 124, jerem10, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 672, 125, jeremcbt, 51);
    end
  jerem08: |
    gsay_reply(672, 126);
    call jerem09a;
  jerem08a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call jerem11;
    end
    else begin
      call jerem12;
    end
  jerem08b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call jerem11;
    end
    else begin
      call jerem06;
    end
  jerem09: |
    gsay_reply(672, 190);
    call jerem09a;
  jerem09a: |
    giq_option(4, 672, 127, jerem08a, 50);
    giq_option(4, 672, 128, jerem12, 51);
    giq_option(8, 672, 129, jerem11, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 672, 130, jerem08b, 50);
    end
  jerem10: |
    gsay_reply(672, 131);
    giq_option(4, 672, 127, jerem08a, 50);
    giq_option(8, 672, 133, jerem11, 50);
  jerem11: |
    gsay_message(672, 134, 50);
    set_global_var(231, 1);
  jerem12: |
    gsay_message(672, 135, 51);
    call jeremcbt;
  jerem13: |
    gsay_reply(672, 136);
    call jerem19a;
  jerem14: |
    gsay_reply(672, 141);
    giq_option(4, 672, 142, jeremret, 50);
    giq_option(4, 672, 143, jerem14a, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 672, 144, jeremcbt, 51);
    end
  jerem14a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call jerem17;
    end
    else begin
      call jerem18;
    end
  jerem15: |
    gsay_message(672, 145, 51);
    call jeremcbt;
  jerem17: |
    gsay_reply(672, 150);
    call jerem18a;
  jerem18: |
    gsay_reply(672, 156);
    call jerem18a;
  jerem18a: |
    giq_option(4, 672, 151, jeremret, 50);
    giq_option(4, 672, 152, jerem12, 51);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 672, 153, jeremcbt, 51);
    end
  jerem19: |
    gsay_reply(672, 154);
    call jerem19a;
  jerem19a: |
    giq_option(4, 672, 137, jerem14, 50);
    giq_option(4, 672, 138, jerem15, 51);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 672, 139, jeremcbt, 51);
    end
    giq_option(-3, 672, 140, jerem16, 50);
  jerem20: |
    gsay_reply(672, 157);
    giq_option(-3, 672, 158, jerem01, 50);
    giq_option(4, 672, 159, jerem12, 51);
    giq_option(4, 672, 160, jerem15, 51);
    giq_option(7, 672, 161, jerem20a, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 672, 162, jeremcbt, 51);
    end
  jerem20a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call jerem21;
    end
    else begin
      call jerem12;
    end
  jerem21: |
    gsay_reply(672, 163);
    giq_option(4, 672, 164, jerem12, 51);
    giq_option(4, 672, 165, jerem12, 51);
    giq_option(4, 672, 166, jerem21a, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 672, 167, jeremcbt, 51);
    end
  jerem21a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call jerem22;
    end
    else begin
      call jerem12;
    end
  jerem22: |
    gsay_reply(672, 168);
    giq_option(4, 672, 169, jeremret, 50);
    giq_option(4, 672, 170, jerem12, 51);
    giq_option(4, 672, 171, jerem18, 50);
  jerem23: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(672, 172);
    end
    else begin
      gsay_reply(672, 173);
    end
    giq_option(4, 672, 174, jerem24, 50);
    giq_option(4, 672, 175, jeremend, 50);
    giq_option(4, 672, 176, jeremend, 50);
    giq_option(4, 672, 177, jeremcbt, 51);
  jerem24: |
    gsay_reply(672, 178);
    giq_option(4, 672, 179, jeremend, 50);
    giq_option(4, 672, 180, jerem26, 50);
    giq_option(4, 672, 181, jerem25, 50);
  jerem25: |
    gsay_reply(672, 182);
    giq_option(4, 672, 183, jeremend, 50);
    giq_option(4, 672, 184, jerem26, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 672, 185, jerem26, 50);
    end
  jerem26: |
    gsay_message(672, 187, 51);
    call jeremcbt;
  jerem27: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(672, 172);
    end
    else begin
      gsay_reply(672, 173);
    end
    giq_option(4, 672, 174, jerem28, 51);
    giq_option(4, 672, 175, jeremend, 50);
    giq_option(4, 672, 176, jeremend, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 672, 177, jeremcbt, 51);
    end
  jerem28: |
    gsay_message(672, 188, 51);
    call jeremcbt;
  jerem29: |
    float_msg(self_obj, message_str(672, 189), 2);
    call jeremcbt;
  jeremend: "[]"
  jeremcbt: 'HOSTILE := 1;

    '
  jeremret: |
    game_time_advance(game_ticks(120));
    load_map(17, 2);
  jerem16: |
    gsay_reply(672, 146);
    giq_option(-3, 672, 147, jeremret, 50);
    giq_option(-3, 672, 148, jerem19, 50);
    giq_option(-3, 672, 149, jeremcbt, 51);
jnkscout:
  start: |
    if (script_action == 12) then begin
      call critter_p_proc;
    end
    else begin
      if (script_action == 18) then begin
        call destroy_p_proc;
      end
      else begin
        if (script_action == 21) then begin
          call look_at_p_proc;
        end
        else begin
          if (script_action == 4) then begin
            call pickup_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (global_var(247) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  look_at_p_proc: 'display_msg(message_str(437, 100));

    '
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    start_gdialog(437, self_obj, 4, -1, -1);
    gsay_start;
    call Scout01;
    gsay_end;
    end_dialogue;
  Scout01: |
    gsay_reply(437, 101);
    call Scout02;
  Scout02: |
    giq_option(4, 437, 102, Scout03, 50);
    giq_option(4, 437, 103, Scout04, 50);
    giq_option(4, 437, 104, Scout05, 50);
    giq_option(4, 437, 105, ScoutEnd, 50);
    giq_option(-3, 437, 106, ScoutEnd, 50);
  Scout03: |
    gsay_reply(437, 107);
    call Scout02;
  Scout04: |
    gsay_reply(437, 108);
    call Scout02;
  Scout05: |
    gsay_reply(437, 109);
    call Scout02;
  ScoutEnd: "[]"
jon:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(288, 176));
    end
    else begin
      display_msg(message_str(288, 175));
    end
  talk_p_proc: |
    if (global_var(251) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if ((local_var(4) == 1) and (get_critter_stat(dude_obj, 4) < 4)) then begin
        float_msg(self_obj, message_str(288, 139), 0);
      end
      else begin
        if (global_var(612) == 2) then begin
          float_msg(self_obj, message_str(288, random(183, 187)), 0);
        end
        else begin
          call get_reaction;
          start_gdialog(288, self_obj, -1, -1, -1);
          gsay_start;
          DisplayMessage := 100;
          if (local_var(4) == 0) then begin
            call Zim00;
          end
          else begin
            if (global_var(612) == 0) then begin
              call Zim01;
            end
            else begin
              if (obj_is_carrying_obj_pid(dude_obj, 238)) then begin
                if (global_var(612) == 9001) then begin
                  call Zim24;
                end
                else begin
                  call Zim27;
                end
              end
              else begin
                if (global_var(612) == 1) then begin
                  call Zim17;
                end
                else begin
                  if (global_var(612) == 9001) then begin
                    call Zim19;
                  end
                  else begin
                    if (global_var(612) == 9002) then begin
                      call Zim21;
                    end
                  end
                end
              end
            end
          end
          gsay_end;
          end_dialogue;
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      if (global_var(616) != 1) then begin
        set_global_var(251, 1);
        critter_add_trait(self_obj, 1, 6, 49);
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (global_var(616) != 1) then begin
        set_global_var(251, 1);
        critter_add_trait(self_obj, 1, 6, 49);
      end
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if ((global_var(613) == 9103) and (global_var(612) != 9003)) then begin
        critter_add_trait(self_obj, 1, 6, 89);
        float_msg(self_obj, message_str(288, 174), 2);
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      else begin
        if (global_var(251) == 1) then begin
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
      end
    end
    if (global_var(616) == 1) then begin
      critter_add_trait(self_obj, 1, 6, 89);
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: 'set_global_var(251, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      if (obj_is_carrying_obj_pid(self_obj, 41) == 0) then begin
        item_caps_adjust(self_obj, random(50, 150));
      end
      if (global_var(613) == 9103) then begin
        if (global_var(612) != 9003) then begin
          critter_add_trait(self_obj, 1, 6, 89);
        end
        else begin
          critter_add_trait(self_obj, 1, 6, 0);
        end
      end
      else begin
        critter_add_trait(self_obj, 1, 6, 49);
      end
      critter_add_trait(self_obj, 1, 5, 6);
      JonPtr := self_obj;
      Initialize := 0;
    end
  Zim00: |
    DisplayMessage := 182;
    gsay_reply(288, 100);
    giq_option(4, 288, 181, Zim01, 50);
    giq_option(-3, 288, 104, Zim13, 50);
    set_local_var(4, 1);
  Zim01: |
    gsay_reply(288, DisplayMessage);
    giq_option(4, 288, 101, Zim02, 50);
    giq_option(4, 288, 102, Zim14, 50);
    if (obj_is_carrying_obj_pid(dude_obj, 238)) then begin
      giq_option(4, 288, 178, Zim26, 50);
    end
    giq_option(4, 288, 103, ZimEnd, 50);
    giq_option(-3, 288, 104, Zim13, 50);
  Zim02: |
    gsay_reply(288, 105);
    gsay_option(288, 106, Zim03, 50);
    gsay_option(288, 107, Zim03, 50);
    gsay_option(288, 108, Zim04, 50);
  Zim03: |
    gsay_reply(288, 109);
    gsay_option(288, 110, Zim04, 50);
    gsay_option(288, 111, Zim13, 50);
    gsay_option(288, 112, Zim03a, 50);
  Zim03a: 'set_global_var(612, 1);

    '
  Zim04: |
    gsay_reply(288, 113);
    gsay_option(288, 114, Zim07, 50);
    gsay_option(288, 115, Zim05, 50);
    gsay_option(288, 116, Zim05, 50);
  Zim05: |
    gsay_reply(288, 117);
    gsay_option(288, 118, Zim06, 50);
    gsay_option(288, 119, Zim07, 50);
  Zim06: |
    gsay_reply(288, 120);
    gsay_option(288, 121, Zim07, 50);
    gsay_option(288, 122, Zim11, 50);
  Zim07: |
    gsay_reply(288, 123);
    gsay_option(288, 124, Zim09, 50);
    gsay_option(288, 125, Zim08, 50);
    gsay_option(288, 126, Zim10, 50);
  Zim08: |
    gsay_reply(288, 127);
    gsay_option(288, 128, Zim09, 50);
    gsay_option(288, 129, Zim10, 50);
    gsay_option(288, 130, Zim08a, 50);
  Zim08a: |
    call BottomReact;
    set_global_var(612, 1);
  Zim09: |
    gsay_reply(288, 131);
    gsay_option(288, 132, Zim10, 50);
    gsay_option(288, 133, Zim08a, 50);
    set_global_var(612, 1);
  Zim10: |
    gsay_message(288, 134, 50);
    set_global_var(612, 9001);
  Zim11: |
    gsay_reply(288, 135);
    gsay_option(288, 136, Zim16, 50);
    gsay_option(288, 137, Zim08a, 50);
  Zim12: |
    gsay_message(288, 138, 50);
    call BottomReact;
    set_global_var(616, 1);
    gfade_out(600);
    move_to(dude_obj, 10500, 0);
    gfade_in(600);
  Zim13: 'gsay_message(288, 139, 50);

    '
  Zim14: |
    gsay_reply(288, 140);
    gsay_option(288, 141, Zim15, 50);
    gsay_option(288, 142, Zim12, 50);
  Zim15: |
    gsay_reply(288, 143);
    gsay_option(288, 144, Zim03, 50);
    gsay_option(288, 145, Zim03, 50);
    gsay_option(288, 146, Zim04, 50);
    gsay_option(288, 147, Zim12, 50);
  Zim16: |
    gsay_reply(288, 148);
    gsay_option(288, 149, Zim07, 50);
    gsay_option(288, 150, Zim07, 50);
    gsay_option(288, 151, Zim08a, 50);
  Zim17: |
    gsay_reply(288, 152);
    gsay_option(288, 153, Zim18, 50);
    gsay_option(288, 154, Zim14, 50);
    gsay_option(288, 155, ZimEnd, 50);
  Zim18: |
    gsay_message(288, 156, 50);
    set_global_var(612, 9001);
  Zim19: |
    gsay_reply(288, 157);
    gsay_option(288, 158, Zim12, 50);
    gsay_option(288, 159, Zim20, 50);
    gsay_option(288, 160, Zim13, 50);
  Zim20: 'gsay_message(288, 161, 50);

    '
  Zim21: |
    gsay_reply(288, 162);
    gsay_option(288, 163, Zim22, 50);
    gsay_option(288, 164, Zim23, 50);
    gsay_option(288, 165, Zim22, 50);
    set_global_var(612, 2);
  Zim22: |
    gsay_message(288, 166, 50);
    call TopReact;
    item_caps_adjust(dude_obj, 2000);
  Zim23: |
    gsay_message(288, 167, 50);
    call TopReact;
    item_caps_adjust(dude_obj, 2500);
  Zim24: |
    gsay_reply(288, 168);
    gsay_option(288, 169, Zim25, 50);
    gsay_option(288, 170, Zim26, 50);
  Zim25: |
    gsay_reply(288, 171);
    gsay_option(288, 172, Zim26, 50);
  Zim26: |
    variable LVar0 := 0;
    LVar0 := obj_carrying_pid_obj(dude_obj, 238);
    rm_obj_from_inven(dude_obj, LVar0);
    gsay_message(288, 173, 50);
    set_global_var(612, 9003);
    if (global_var(613) == 9102) then begin
      critter_add_trait(self_obj, 1, 6, 0);
      set_global_var(613, 9103);
    end
    else begin
      critter_add_trait(self_obj, 1, 6, 0);
    end
  Zim27: |
    gsay_reply(288, 177);
    gsay_option(288, 178, Zim26, 50);
    gsay_option(288, 179, ZimEnd, 50);
  ZimEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
jtbob:
  start: "[]"
  critter_p_proc: |
    if (global_var(247) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  pickup_p_proc: 'set_global_var(247, 1);

    '
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  talk_p_proc: |
    set_global_var(632, game_time / 10);
    set_local_var(1, 1);
    start_gdialog(341, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(0) == 1) then begin
      call bob15;
    end
    else begin
      if ((global_var(104) == 2) or (global_var(38) != 0)) then begin
        call bob9;
      end
      else begin
        if ((local_var(3) == 0) and ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3))) then begin
          set_local_var(3, 1);
          call bob0;
        end
        else begin
          if (local_var(2) == 1) then begin
            call bob13;
          end
          else begin
            call bob10;
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(341, 100));
  map_enter_p_proc: |
    if ((((game_time / 10) - global_var(632)) > (60 * 60 * 24 * 2)) and (local_var(1) == 1)) then begin
      kill_critter(self_obj, 62);
    end
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 16);
    end
  bob0: |
    gsay_reply(341, 101);
    giq_option(-3, 341, 102, bob1, 50);
    giq_option(4, 341, 103, bob2, 50);
    giq_option(4, 341, 104, bob3, 50);
    giq_option(5, 341, 105, bob3, 50);
  bob1: 'gsay_message(341, 106, 50);

    '
  bob2: |
    set_local_var(0, 1);
    gsay_message(341, 107, 50);
    item_caps_adjust(dude_obj, 100);
  bob3: |
    gsay_reply(341, 108);
    giq_option(4, 341, 109, bob4, 50);
    giq_option(5, 341, 110, bob5, 50);
  bob4: |
    if (obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) then begin
      gsay_message(341, message_str(341, 111) + message_str(341, 112), 50);
    end
  bob5: |
    gsay_reply(341, 115);
    giq_option(5, 341, 116, bob6, 50);
    giq_option(5, 341, 117, bob7, 50);
    giq_option(5, 341, 118, bob8, 50);
    giq_option(5, 341, 119, bobend, 50);
  bob6: |
    gsay_reply(341, 120);
    giq_option(5, 341, 121, bob7, 50);
    giq_option(5, 341, 122, bob8, 50);
    giq_option(5, 341, 123, bobend, 50);
  bob7: |
    gsay_reply(341, 124);
    giq_option(5, 341, 125, bob6, 50);
    giq_option(5, 341, 126, bob8, 50);
    giq_option(5, 341, 127, bobend, 50);
  bob8: |
    gsay_reply(341, 128);
    giq_option(5, 341, 129, bob6, 50);
    giq_option(5, 341, 130, bob7, 50);
    giq_option(5, 341, 158, bob17, 50);
    giq_option(5, 341, 131, bobend, 50);
  bob9: |
    set_local_var(1, 0);
    gsay_message(341, 162, 50);
  bob10: |
    set_local_var(2, 1);
    gsay_reply(341, 133);
    giq_option(-3, 341, 134, bob1, 50);
    giq_option(4, 341, 135, bob2, 50);
    giq_option(4, 341, 136, bob11, 50);
    giq_option(5, 341, 137, bob5, 50);
  bob11: |
    gsay_reply(341, 138);
    giq_option(4, 341, 139, bobend, 50);
    giq_option(5, 341, 140, bob12, 50);
  bob12: |
    gsay_reply(341, 141);
    giq_option(5, 341, 142, bob6, 50);
    giq_option(5, 341, 143, bob7, 50);
    giq_option(5, 341, 144, bob8, 50);
    giq_option(5, 341, 145, bobend, 50);
  bob13: |
    gsay_reply(341, 146);
    giq_option(-3, 341, 147, bob1, 50);
    giq_option(4, 341, 148, bob14, 50);
    giq_option(4, 341, 149, bob15, 50);
    giq_option(5, 341, 150, bob16, 50);
  bob14: 'gsay_message(341, 151, 50);

    '
  bob15: 'gsay_message(341, 152, 50);

    '
  bob16: |
    gsay_reply(341, 153);
    giq_option(5, 341, 154, bob6, 50);
    giq_option(5, 341, 155, bob7, 50);
    giq_option(5, 341, 156, bob8, 50);
    giq_option(5, 341, 157, bobend, 50);
  bob17: |
    gsay_reply(341, 159);
    if (item_caps_total(dude_obj) >= 100) then begin
      giq_option(5, 341, 160, bob18, 50);
      item_caps_adjust(dude_obj, -100);
    end
    giq_option(5, 341, 148, bobend, 50);
  bob18: |
    set_local_var(1, 0);
    gfade_out(600);
    set_obj_visibility(self_obj, 1);
    gfade_in(600);
    give_exp_points(100);
    set_global_var(155, global_var(155) + 5);
    display_msg(message_str(341, 161));
  bobend: "[]"
jtgengrd:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  critter_p_proc: |
    if (GVar1) then begin
      GVar1 := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if ((cur_map_index == 12) or (cur_map_index == 10)) then begin
        if (tile_num(self_obj) != local_var(5)) then begin
          animate_move_obj_to_tile(self_obj, local_var(5), 0);
        end
        if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 12)) then begin
          if (global_var(247) == 1) then begin
            float_msg(self_obj, message_str(37, 138), 2);
            GVar1 := 1;
          end
          else begin
            if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) and (local_var(4) == 0) and (map_var(2) == 0) and (global_var(36) == 0) and (global_var(104) == 0) and (cur_map_index == 12)) then begin
              if (not(weapon_checked)) then begin
                weapon_checked := 1;
                add_timer_event(self_obj, game_ticks(10), 1);
                dialogue_system_enter;
              end
            end
            else begin
              if (using_skill(dude_obj, 8) and not(sneak_checked)) then begin
                GVar3 := 1;
                sneak_checked := 1;
                add_timer_event(self_obj, game_ticks(5), 2);
                dialogue_system_enter;
              end
              else begin
                if (cur_map_index == 12) then begin
                  if ((map_var(8) == 1) and (tile_distance_objs(self_obj, dude_obj) < 8)) then begin
                    set_map_var(8, 0);
                    float_msg(self_obj, message_str(37, 136), 2);
                    if (GVar4) then begin
                      GVar1 := 1;
                    end
                    else begin
                      GVar4 := 1;
                    end
                  end
                end
              end
            end
          end
        end
      end
      else begin
        if (cur_map_index == 11) then begin
          if (map_var(2) == 2) then begin
            if (GVar5 != 0) then begin
              if (tile_distance(tile_num(self_obj), GVar0) > 3) then begin
                animate_move_obj_to_tile(self_obj, GVar0, 0);
              end
              else begin
                if (GVar5 == 1) then begin
                  GVar0 := 23465;
                  GVar5 := 2;
                end
                else begin
                  if (GVar5 == 2) then begin
                    GVar0 := 26855;
                    GVar5 := 3;
                  end
                  else begin
                    if (GVar5 == 3) then begin
                      destroy_object(self_obj);
                    end
                  end
                end
              end
            end
            else begin
              destroy_object(self_obj);
            end
          end
        end
      end
    end
    if (global_var(247) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  description_p_proc: 'display_msg(message_str(37, 100));

    '
  destroy_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_carrying_pid_obj(self_obj, 1);
    if (LVar0) then begin
      rm_obj_from_inven(self_obj, LVar0);
      destroy_object(LVar0);
    end
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
    if (cur_map_index == 11) then begin
      if (map_var(2) == 1) then begin
        set_map_var(1, map_var(1) - 1);
      end
    end
  map_enter_p_proc: |
    if (cur_map_index == 12) then begin
      critter_add_trait(self_obj, 1, 6, 12);
    end
    else begin
      if (cur_map_index == 11) then begin
        critter_add_trait(self_obj, 1, 6, 0);
        GVar0 := 23666;
        GVar5 := 1;
        if (map_var(2) != 1) then begin
          destroy_object(self_obj);
        end
      end
    end
    if (local_var(5) == 0) then begin
      set_local_var(5, tile_num(self_obj));
    end
  pickup_p_proc: |
    float_msg(self_obj, message_str(37, random(136, 138)), 2);
    GVar1 := 1;
  talk_p_proc: |
    call get_reaction;
    if (GVar3 and (times_caught_sneaking >= 3)) then begin
      call JTGenGrd18;
    end
    else begin
      if (not(local_var(4)) and ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) or (GVar3 and (times_caught_sneaking < 3))) then begin
        start_gdialog(37, self_obj, 4, -1, -1);
        gsay_start;
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
          call JTGenGrd00;
        end
        else begin
          if (GVar3) then begin
            call JTGenGrd06;
          end
        end
        gsay_end;
        end_dialogue;
      end
      else begin
        if (global_var(158) > 2) then begin
          call JTGenGrd19;
        end
        else begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1)) or (local_var(1) == 1)) then begin
            call JTGenGrd09;
          end
          else begin
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1)) or (local_var(1) == 3)) then begin
              call JTGenGrd16;
            end
            else begin
              call JTGenGrd20;
            end
          end
        end
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if (weapon_checked) then begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
          float_msg(self_obj, message_str(37, 134), 0);
          add_timer_event(self_obj, game_ticks(5), 3);
        end
        else begin
          weapon_checked := 0;
        end
      end
    end
    else begin
      if (fixed_param == 2) then begin
        sneak_checked := 0;
      end
      else begin
        if (fixed_param == 3) then begin
          GVar1 := 1;
        end
        else begin
          if (fixed_param == 4) then begin
            float_msg(self_obj, message_str(37, 139), 0);
          end
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  JTGenGrd00: |
    call DownReact;
    gsay_reply(37, 110);
    giq_option(4, 37, 111, JTGenGrd01, 50);
    giq_option(4, 37, 112, JTGenGrd00a, 51);
    giq_option(4, 634, 105, JTGenGrdEnd, 50);
    giq_option(6, 37, 113, JTGenGrd00b, 49);
    giq_option(-3, 37, 114, JTGenGrd05, 50);
  JTGenGrd00a: |
    call DownReact;
    call JTGenGrd02;
  JTGenGrd00b: |
    call UpReact;
    call JTGenGrd04;
  JTGenGrd01: |
    gsay_reply(37, 115);
    giq_option(4, 37, 116, JTGenGrd02, 50);
    giq_option(4, 37, 117, JTGenGrd01a, 50);
  JTGenGrd01a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call JTGenGrd03;
    end
    else begin
      call JTGenGrd02;
    end
  JTGenGrd02: |
    gsay_reply(37, 118);
    giq_option(4, 37, 119, JTGenGrd02b, 50);
    giq_option(4, 37, 120, JTGenGrd02a, 51);
  JTGenGrd02a: 'GVar1 := 1;

    '
  JTGenGrd02b: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(37, 132);
      giq_option(4, 37, 131, JTGenGrdEnd, 50);
    end
    else begin
      gsay_reply(37, 133);
      giq_option(4, 37, 131, JTGenGrdEnd, 50);
    end
  JTGenGrd03: |
    set_local_var(4, 1);
    gsay_message(37, 121, 50);
  JTGenGrd04: 'gsay_message(37, 122, 50);

    '
  JTGenGrd05: 'gsay_message(37, 123, 50);

    '
  JTGenGrd06: |
    times_caught_sneaking := times_caught_sneaking + 1;
    add_timer_event(self_obj, game_ticks(5), 2);
    gsay_reply(37, 124);
    giq_option(4, 37, 125, JTGenGrd07, 50);
    giq_option(5, 37, 126, JTGenGrd06a, 50);
    giq_option(-3, 37, 127, JTGenGrd07, 50);
  JTGenGrd06a: |
    variable LVar0 := 0;
    LVar0 := -5 * times_caught_sneaking;
    if (is_success(roll_vs_skill(dude_obj, 14, LVar0))) then begin
      call JTGenGrd08;
    end
    else begin
      call JTGenGrd07;
    end
  JTGenGrd07: 'gsay_message(37, 128, 50);

    '
  JTGenGrd08: |
    gsay_reply(37, 130);
    giq_option(5, 37, 131, JTGenGrdEnd, 50);
  JTGenGrd09: 'float_msg(self_obj, message_str(37, random(101, 103)), 51);

    '
  JTGenGrd16: 'float_msg(self_obj, message_str(37, random(104, 106)), 49);

    '
  JTGenGrd18: |
    float_msg(self_obj, message_str(37, 135), 2);
    add_timer_event(self_obj, game_ticks(5), 3);
  JTGenGrd19: |
    display_msg(message_str(37, 129));
    GVar1 := 1;
  JTGenGrd20: 'float_msg(self_obj, message_str(37, random(107, 109)), 0);

    '
  JTGenGrdEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
jtpeasnt:
  start: |
    variable LVar0 := 0;
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if (script_action == 18) then begin
        if (source_obj == dude_obj) then begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
            set_global_var(156, 1);
            set_global_var(157, 0);
          end
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
            set_global_var(157, 1);
            set_global_var(156, 0);
          end
          set_global_var(159, global_var(159) + 1);
          if ((global_var(159) % 2) == 0) then begin
            set_global_var(155, global_var(155) - 1);
          end
        end
      end
      else begin
        if ((script_action == 21) or (script_action == 3)) then begin
          script_overrides;
          display_msg(message_str(38, 100));
        end
      end
    end
  do_dialogue: 'call guard00;

    '
  guard00: |
    variable LVar0 := 0;
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      LVar0 := random(1, 2);
    end
    else begin
      LVar0 := random(1, 3);
    end
    if (LVar0 == 1) then begin
      float_msg(self_obj, message_str(38, 103), 0);
    end
    else begin
      if (LVar0 == 2) then begin
        float_msg(self_obj, message_str(38, 104), 0);
      end
      else begin
        if (LVar0 == 3) then begin
          float_msg(self_obj, message_str(38, 105), 0);
        end
      end
    end
  first: "[]"
  notfirst: "[]"
jtraider:
  start: |
    if (Initialized == 0) then begin
      Initialized := 1;
      JTRaider_ptr := self_obj;
      critter_add_trait(self_obj, 1, 6, 18);
      critter_add_trait(self_obj, 1, 5, 20);
    end
    if (script_action == 12) then begin
      call critter_p_proc;
    end
    else begin
      if (script_action == 14) then begin
        call damage_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 15) then begin
              call map_enter_p_proc;
            end
            else begin
              if (script_action == 4) then begin
                call pickup_p_proc;
              end
              else begin
                if (script_action == 11) then begin
                  call talk_p_proc;
                end
                else begin
                  if (script_action == 22) then begin
                    call timed_event_p_proc;
                  end
                  else begin
                    if (script_action == 13) then begin
                      call combat_p_proc;
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if ((tile_distance_objs(self_obj, dude_obj) < 8) and (local_var(8) == 0) and (has_skill(dude_obj, 8) >= 50)) then begin
      set_local_var(8, 1);
      display_msg(message_str(337, 184));
    end
    else begin
      if (map_var(1) == 0) then begin
        if ((local_var(5) == 2) and obj_can_see_obj(self_obj, dude_obj)) then begin
          set_local_var(5, 1);
          set_local_var(6, 1);
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
        else begin
          if ((local_var(6) == 1) and (tile_distance_objs(dude_obj, self_obj) < 4)) then begin
            if (not(using_skill(dude_obj, 8))) then begin
              set_local_var(5, 2);
            end
          end
          else begin
            if (obj_can_see_obj(self_obj, dude_obj) and (local_var(4) == 0) and (using_skill(dude_obj, 8) == 0)) then begin
              dialogue_system_enter;
            end
          end
        end
      end
      else begin
        if (map_var(1) == 1) then begin
          if (local_var(9) == 0) then begin
            rm_timer_event(Sinthia_ptr);
            add_timer_event(Sinthia_ptr, game_ticks(2), 2);
            reg_anim_func(2, self_obj);
            reg_anim_func(1, 1);
            reg_anim_animate(self_obj, 21, -1);
            reg_anim_animate(self_obj, 49, -1);
            reg_anim_func(3, 0);
            set_local_var(9, 1);
          end
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      if (using_skill(dude_obj, 8) and (map_var(1) == 0) and (local_var(9) == 0)) then begin
        if (is_success(roll_vs_skill(dude_obj, 8, 0))) then begin
          script_overrides;
          display_msg(message_str(337, 183));
          critter_injure(self_obj, 2);
          critter_injure(self_obj, 1);
          set_map_var(1, 1);
          add_timer_event(self_obj, game_ticks(10), 3);
          terminate_combat;
        end
        else begin
          set_local_var(5, 2);
        end
      end
      else begin
        set_local_var(5, 2);
      end
    end
  destroy_p_proc: |
    if ((source_obj == dude_obj) or (party_member_obj(obj_pid(source_obj)) != 0)) then begin
      set_map_var(1, 2);
    end
    set_global_var(143, 2);
    set_map_var(3, 3);
    if (map_var(0) != 2) then begin
      award := 400;
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(337, 100));
  map_enter_p_proc: |
    JTRaider_ptr := self_obj;
    if (not(metarule(22, 0))) then begin
      if (global_var(143) == 2) then begin
        JTRaider_ptr := 0;
        destroy_object(self_obj);
      end
      else begin
        if (map_var(1) == 1) then begin
          set_map_var(1, 0);
          set_local_var(5, 2);
          set_local_var(6, 1);
          set_local_var(7, 0);
          if (critter_state(self_obj) == 2) then begin
            reg_anim_func(2, self_obj);
            reg_anim_func(1, 1);
            reg_anim_animate(self_obj, 37, -1);
            reg_anim_func(3, 0);
          end
        end
      end
    end
  pickup_p_proc: |
    set_local_var(5, 2);
    set_local_var(6, 1);
    set_local_var(7, 0);
  talk_p_proc: |
    call get_reaction;
    if (local_var(5) != 0) then begin
      call Raider34;
    end
    else begin
      if ((global_var(143) == 1) and (map_var(1) == 0)) then begin
        start_gdialog(337, self_obj, 4, -1, -1);
        gsay_start;
        if (local_var(4) == 0) then begin
          call Raider0;
        end
        else begin
          if (map_var(3) == 1) then begin
            if (local_var(1) < 2) then begin
              call Raider17;
            end
            else begin
              call Raider9;
            end
            set_map_var(3, 2);
          end
          else begin
            if (local_var(7) == 1) then begin
              call Raider21;
            end
            else begin
              call Raider31;
            end
          end
        end
        gsay_end;
        end_dialogue;
      end
      else begin
        display_msg(message_str(337, 178));
      end
    end
    if (shoot_Sinthia) then begin
      game_ui_disable;
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_animate(self_obj, 43, -1);
      reg_anim_animate(self_obj, 45, -1);
      sfx_name := sfx_build_weapon_name(1, obj_carrying_pid_obj(self_obj, 8), 0, Sinthia_ptr);
      reg_anim_play_sfx(self_obj, sfx_name, 0);
      reg_anim_animate(self_obj, 44, -1);
      reg_anim_func(3, 0);
      shoot_Sinthia := 0;
      add_timer_event(self_obj, 5, 2);
    end
    if (Sinthia_is_safe == 1) then begin
      set_map_var(3, 3);
      set_global_var(143, 2);
      gfade_out(600);
      gfade_in(600);
      destroy_object(self_obj);
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      game_ui_enable;
      set_local_var(5, 2);
    end
    else begin
      if (fixed_param == 2) then begin
        critter_dmg(Sinthia_ptr, 75, 0);
        add_timer_event(self_obj, game_ticks(5), 1);
      end
      else begin
        if (fixed_param == 3) then begin
          set_map_var(1, 0);
          set_local_var(5, 2);
          set_local_var(6, 1);
          set_local_var(7, 0);
          if (critter_state(self_obj) == 2) then begin
            reg_anim_func(2, self_obj);
            reg_anim_func(1, 1);
            reg_anim_animate(self_obj, 37, -1);
            reg_anim_func(3, 0);
          end
        end
      end
    end
  combat_p_proc: |
    if ((map_var(1) == 1) and (map_var(3) > 0) and (map_var(3) < 3) and (tile_distance_objs(self_obj, dude_obj) < 4)) then begin
      script_overrides;
      terminate_combat;
    end
  Raider0: |
    set_local_var(4, 1);
    gsay_reply(337, 101);
    giq_option(-3, 337, 102, Raider1, 50);
    giq_option(4, 337, 103, Raider2, 50);
    giq_option(4, 337, 104, Raider8, 50);
    giq_option(7, 337, 105, Raider4, 50);
  Raider1: |
    gsay_message(337, 106, 50);
    call RaiderSnap;
  Raider2: |
    gsay_reply(337, 107);
    giq_option(4, 337, 108, Raider3, 50);
  Raider3: |
    call DownReact;
    gsay_message(337, 109, 51);
    set_local_var(6, 1);
  Raider4: |
    gsay_reply(337, 110);
    giq_option(7, 337, 111, Raider5, 50);
    giq_option(7, 337, 112, Raider7, 50);
  Raider5: |
    gsay_reply(337, 113);
    giq_option(7, 337, 114, Raider6, 49);
  Raider6: |
    call UpReact;
    set_local_var(6, 1);
    gsay_message(337, 115, 49);
  Raider7: |
    gsay_message(337, 116, 51);
    set_local_var(6, 1);
  Raider8: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(337, 119, 51);
    end
    else begin
      gsay_message(337, 120, 51);
    end
    call RaiderSnap;
  Raider9: |
    gsay_reply(337, 121);
    giq_option(4, 337, 122, Raider10, 50);
    giq_option(7, 337, 123, Raider14, 50);
  Raider10: |
    gsay_reply(337, 124);
    giq_option(4, 337, 125, Raider11, 50);
    giq_option(4, 337, 126, Raider10a, 50);
  Raider10a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      set_local_var(7, 1);
      call Raider12;
    end
    else begin
      call Raider13;
    end
  Raider11: |
    gsay_reply(337, 127);
    giq_option(4, 337, 128, RaiderCombat, 51);
  Raider12: 'gsay_message(337, 129, 50);

    '
  Raider13: 'gsay_message(337, 130, 50);

    '
  Raider14: |
    gsay_reply(337, 131);
    giq_option(7, 337, 132, Raider14a, 50);
  Raider14a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 20))) then begin
      set_local_var(7, 1);
      call Raider16;
    end
    else begin
      call Raider15;
    end
  Raider15: 'gsay_message(337, 133, 50);

    '
  Raider16: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(337, 136, 50);
    end
    else begin
      gsay_message(337, 137, 50);
    end
  Raider17: |
    gsay_reply(337, 138);
    giq_option(4, 337, 139, Raider17a, 50);
    giq_option(6, 337, 140, Raider18, 50);
    giq_option(8, 337, 141, Raider17b, 50);
  Raider17a: 'set_local_var(7, 0);

    '
  Raider17b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      set_local_var(7, 1);
      call Raider20;
    end
    else begin
      call Raider19;
    end
  Raider18: |
    gsay_message(337, 142, 51);
    call RaiderSnap;
  Raider19: |
    gsay_message(337, 143, 51);
    set_local_var(7, 0);
  Raider20: |
    call UpReact;
    gsay_message(337, 144, 49);
  Raider21: |
    gsay_reply(337, 145);
    giq_option(4, 337, 146, Raider22, 50);
  Raider22: |
    gsay_reply(337, 147);
    giq_option(4, 337, 148, Raider23, 50);
    giq_option(4, 337, 149, Raider24, 50);
    giq_option(5, 337, 150, Raider22a, 50);
    giq_option(6, 337, 151, Raider27, 50);
  Raider22a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Raider26;
    end
    else begin
      call Raider23;
    end
  Raider23: |
    gsay_message(337, 152, 51);
    call RaiderSnap;
  Raider24: |
    gsay_reply(337, 153);
    giq_option(4, 337, 154, Raider24a, 50);
    giq_option(4, 337, 155, Raider25, 50);
  Raider24a: |
    if (item_caps_total(dude_obj) >= 100) then begin
      item_caps_adjust(dude_obj, -100);
      call safe;
    end
    else begin
      call Raider23;
    end
  Raider25: |
    gsay_message(337, 156, 51);
    call RaiderSnap;
  Raider26: |
    gsay_message(337, 157, 49);
    call safe;
  Raider27: |
    gsay_reply(337, 158);
    giq_option(5, 337, 159, Raider28, 50);
    giq_option(5, 337, 160, Raider27a, 50);
  Raider27a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Raider29;
    end
    else begin
      call Raider28;
    end
  Raider28: |
    gsay_message(337, 161, 51);
    call RaiderSnap;
  Raider29: |
    gsay_reply(337, 162);
    giq_option(5, 337, 163, Raider29a, 50);
    giq_option(5, 337, 164, Raider30, 50);
  Raider29a: |
    if (item_caps_total(dude_obj) >= 100) then begin
      item_caps_adjust(dude_obj, -100);
      call safe;
    end
    else begin
      call Raider23;
    end
  Raider30: |
    gsay_reply(337, 165);
    giq_option(5, 337, 166, Raider23, 50);
    giq_option(5, 337, 167, Raider30a, 50);
  Raider30a: |
    if (item_caps_total(dude_obj) >= 200) then begin
      item_caps_adjust(dude_obj, -200);
      call safe;
    end
    else begin
      call Raider23;
    end
  Raider31: |
    gsay_reply(337, 168);
    giq_option(4, 337, 169, Raider32, 50);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      giq_option(6, 337, 172, Raider33, 51);
    end
    else begin
      giq_option(6, 337, 173, Raider33, 51);
    end
  Raider32: |
    gsay_message(337, 174, 51);
    call RaiderSnap;
  Raider33: |
    gsay_message(337, 175, 51);
    call RaiderCombat;
  Raider34: |
    float_msg(self_obj, message_str(337, 176), 2);
    call RaiderSnap;
  Raiderend: "[]"
  RaiderCombat: 'set_local_var(5, 2);

    '
  RaiderSnap: 'shoot_Sinthia := 1;

    '
  safe: |
    award := 1000;
    set_local_var(6, 0);
    Sinthia_is_safe := 1;
    set_obj_visibility(self_obj, 1);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
julianna:
  start: "[]"
  critter_p_proc: |
    if (local_var(5) and (local_var(6) == 0) and (tile_distance_objs(self_obj, dude_obj) < 8)) then begin
      call flee_dude;
    end
    else begin
      call sleeping;
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(251, 1);
      critter_add_trait(self_obj, 1, 6, 49);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(251, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
      critter_add_trait(self_obj, 1, 6, 49);
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(4)) then begin
      display_msg(message_str(257, 100));
    end
    else begin
      display_msg(message_str(257, 101));
    end
  pickup_p_proc: 'set_local_var(5, 1);

    '
  talk_p_proc: |
    if (local_var(5)) then begin
      float_msg(self_obj, message_str(669, 102), 0);
    end
    else begin
      start_gdialog(257, self_obj, 4, -1, -1);
      gsay_start;
      if (global_var(127) < 3) then begin
        call Julianna01;
      end
      else begin
        call Julianna10;
      end
      gsay_end;
      end_dialogue;
    end
    if (global_var(127) == 2) then begin
      if (local_var(7) == 0) then begin
        set_local_var(7, 1);
        display_msg(message_str(257, 126));
        give_exp_points(250);
      end
    end
  timed_event_p_proc: |
    float_msg(self_obj, message_str(257, 124), 0);
    display_msg(message_str(257, 125));
    critter_dmg(self_obj, 200, 0);
  map_enter_p_proc: |
    if (not(initialized)) then begin
      if ((global_var(613) == 9103) or (global_var(613) == 9102)) then begin
        critter_add_trait(self_obj, 1, 6, 0);
      end
      else begin
        critter_add_trait(self_obj, 1, 6, 49);
      end
      sleep_time := 1930;
      wake_time := 830;
      sleep_tile := 23151;
      home_tile := 22749;
      initialized := 1;
    end
    if (global_var(127) == 3) then begin
      set_obj_visibility(self_obj, 1);
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 0);
  Julianna01: |
    gsay_reply(257, 102);
    giq_option(-3, 257, 103, JuliannaEnd, 50);
    giq_option(4, 257, 104, JuliannaEnd, 50);
    if (global_var(127) == 1) then begin
      giq_option(0, 257, 105, Julianna06, 50);
    end
    if (not(local_var(4))) then begin
      giq_option(4, 257, 106, Julianna02, 50);
    end
  Julianna02: |
    set_local_var(4, 1);
    gsay_reply(257, 107);
    giq_option(4, 257, 108, Julianna03, 50);
    giq_option(4, 257, 109, Julianna04, 50);
  Julianna03: |
    gsay_reply(257, 110);
    giq_option(4, 257, 111, Julianna05, 50);
    call Goodbyes;
    giq_option(4, 634, exit_line, JuliannaEnd, 50);
  Julianna04: |
    gsay_reply(257, 112);
    call Goodbyes;
    giq_option(4, 634, exit_line, JuliannaEnd, 50);
  Julianna05: |
    gsay_reply(257, 113);
    call Goodbyes;
    giq_option(4, 634, exit_line, JuliannaEnd, 50);
  Julianna06: |
    gsay_reply(257, 114);
    giq_option(0, 257, 115, Julianna07, 50);
    giq_option(0, 257, 116, Julianna08, 50);
    if (obj_is_carrying_obj_pid(dude_obj, 99)) then begin
      giq_option(0, 257, 117, Julianna09, 50);
    end
  Julianna07: |
    gsay_message(257, 118, 50);
    set_global_var(637, 1);
    set_global_var(127, 0);
    add_timer_event(self_obj, 1, 1);
  Julianna08: |
    gsay_reply(257, 119);
    giq_option(4, 257, 120, JuliannaEnd, 50);
    if (obj_is_carrying_obj_pid(dude_obj, 99)) then begin
      giq_option(4, 257, 121, Julianna09, 50);
    end
  Julianna09: |
    variable LVar0 := 0;
    LVar0 := obj_carrying_pid_obj(dude_obj, 99);
    rm_obj_from_inven(dude_obj, obj_carrying_pid_obj(dude_obj, 99));
    add_obj_to_inven(self_obj, LVar0);
    gsay_message(257, 122, 50);
    set_global_var(127, 2);
  Julianna10: 'gsay_message(257, 123, 50);

    '
  JuliannaEnd: "[]"
  sleeping: |
    if (local_var(6) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(6, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(6, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(6, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(6, 1);
          end
        end
      end
    end
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
junkdog:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (global_var(5)) then begin
      display_msg(message_str(353, 100));
    end
    else begin
      display_msg(message_str(353, 101));
    end
  critter_p_proc: |
    if ((global_var(639) == 0) and (global_var(5) == 1)) then begin
      call new_proto1;
    end
    else begin
      if ((global_var(639) == 2) and (global_var(5) == 1)) then begin
        call new_proto2;
      end
    end
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (obj_pid(critter_inven_obj(dude_obj, 0)) == 74) then begin
        if (not(global_var(5)) and (local_var(4) == 0)) then begin
          set_local_var(4, 1);
          display_msg(message_str(353, 106));
          call dog_joins_dude;
        end
      end
    end
    if (global_var(5) == 1) then begin
      if (tile_distance_objs(self_obj, dude_obj) > 5) then begin
        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 1), 1);
      end
      else begin
        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 3), 0);
      end
    end
    else begin
      if (local_var(4) == 0) then begin
        if (map_var(8)) then begin
          if (map_var(5)) then begin
            add_timer_event(self_obj, game_ticks(6), 1);
          end
          set_map_var(8, 0);
        end
      end
    end
  destroy_p_proc: |
    set_global_var(5, 0);
    set_global_var(186, 2);
    set_global_var(187, 2);
    party_remove(self_obj);
    if (cur_map_index == 11) then begin
      set_map_var(5, 0);
    end
  map_enter_p_proc: |
    Dog_ptr := self_obj;
    if (global_var(5) == 1) then begin
      critter_add_trait(self_obj, 1, 6, 0);
    end
    else begin
      critter_add_trait(self_obj, 1, 6, 6);
    end
    if ((cur_map_index == 11) and (global_var(5) == 0) and (local_var(4) == 0)) then begin
      set_map_var(5, 1);
    end
  pickup_p_proc: 'script_overrides;

    '
  talk_p_proc: |
    if ((cur_map_index == 26) or (cur_map_index == 25)) then begin
      PartyBackground := 9;
    end
    else begin
      if ((cur_map_index == 10) or (cur_map_index == 11) or (cur_map_index == 12)) then begin
        PartyBackground := 7;
      end
      else begin
        if ((cur_map_index == 0) or (cur_map_index == 1) or (cur_map_index == 2) or (cur_map_index == 13) or (cur_map_index == 7) or (cur_map_index == 20) or (cur_map_index == 21) or (cur_map_index == 22) or (cur_map_index == 23) or (cur_map_index == 27) or (cur_map_index == 30) or (cur_map_index == 47) or (cur_map_index == 48) or (cur_map_index == 51) or (cur_map_index == 52) or (cur_map_index == 53) or (cur_map_index == 54)) then begin
          PartyBackground := 15;
        end
        else begin
          if ((cur_map_index == 3) or (cur_map_index == 4) or (cur_map_index == 5) or (cur_map_index == 19) or (cur_map_index == 24)) then begin
            PartyBackground := 4;
          end
          else begin
            if ((cur_map_index == 6) or (cur_map_index == 8) or (cur_map_index == 9) or (cur_map_index == 33) or (cur_map_index == 34) or (cur_map_index == 42) or (cur_map_index == 43)) then begin
              PartyBackground := 10;
            end
            else begin
              if ((cur_map_index == 14) or (cur_map_index == 15)) then begin
                PartyBackground := 5;
              end
              else begin
                if ((cur_map_index == 16) or (cur_map_index == 35) or (cur_map_index == 49) or (cur_map_index == 50) or (cur_map_index == 37)) then begin
                  PartyBackground := 16;
                end
                else begin
                  if ((cur_map_index == 17) or (cur_map_index == 18)) then begin
                    PartyBackground := 8;
                  end
                  else begin
                    if ((cur_map_index == 28) or (cur_map_index == 44) or (cur_map_index == 45) or (cur_map_index == 46)) then begin
                      PartyBackground := 13;
                    end
                    else begin
                      if (cur_map_index == 29) then begin
                        PartyBackground := 12;
                      end
                      else begin
                        if ((cur_map_index == 31) or (cur_map_index == 32)) then begin
                          PartyBackground := 6;
                        end
                        else begin
                          if ((cur_map_index == 36) or (cur_map_index == 38) or (cur_map_index == 39) or (cur_map_index == 40) or (cur_map_index == 41)) then begin
                            PartyBackground := 3;
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    if ((local_var(4) == 1) or (global_var(5) == 1) and (get_critter_stat(dude_obj, 4) > 3)) then begin
      start_gdialog(353, self_obj, 4, 22, PartyBackground);
      gsay_start;
      call dog00;
      gsay_end;
      end_dialogue;
    end
    else begin
      float_msg(self_obj, message_str(353, 102), 2);
    end
    if (Katja_ptr != 0) then begin
      float_msg(Katja_ptr, message_str(623, 175), 5);
    end
  timed_event_p_proc: |
    float_msg(self_obj, message_str(353, 103), 2);
    set_map_var(9, 1);
    set_map_var(7, 1);
  use_obj_on_p_proc: |
    if ((obj_pid(obj_being_used_with) == 103) or (obj_pid(obj_being_used_with) == 81)) then begin
      if (not(global_var(5)) and (local_var(4) == 0)) then begin
        set_local_var(4, 1);
        display_msg(message_str(353, 105));
        call dog_joins_dude;
      end
    end
  dog_joins_dude: |
    display_msg(message_str(353, 104));
    give_exp_points(100);
    set_global_var(5, 1);
    set_local_var(4, 1);
    set_global_var(187, 2);
    set_global_var(186, 2);
    set_global_var(640, get_pc_stat(1));
    party_add(self_obj);
    critter_add_trait(self_obj, 1, 6, 0);
    set_map_var(5, 0);
  new_proto1: |
    if ((get_pc_stat(1) - global_var(640)) > 0) then begin
      set_global_var(641, global_var(641) + (get_pc_stat(1) - global_var(640)));
      set_global_var(640, get_pc_stat(1));
    end
    if (global_var(641) > 3) then begin
      set_global_var(641, 0);
      set_global_var(639, global_var(639) + 1);
      new_proto := 16777610;
      tmp := create_object_sid(new_proto, tile_num(self_obj), elevation(self_obj), 353);
      anim(tmp, 1000, has_trait(1, self_obj, 10));
      party_remove(self_obj);
      party_add(tmp);
      critter_add_trait(tmp, 1, 6, 0);
      float_msg(tmp, message_str(353, 200), 3);
      display_msg(message_str(353, 201));
      play_sfx("MADDOGAQ");
      Dog_ptr := tmp;
      move_to(self_obj, 0, 0);
      destroy_object(self_obj);
    end
  new_proto2: |
    if ((get_pc_stat(1) - global_var(640)) > 0) then begin
      set_global_var(641, global_var(641) + (get_pc_stat(1) - global_var(640)));
      set_global_var(640, get_pc_stat(1));
    end
    if (global_var(641) > 3) then begin
      set_global_var(641, 0);
      set_global_var(639, global_var(639) + 1);
      new_proto := 16777611;
      tmp := create_object_sid(new_proto, tile_num(self_obj), elevation(self_obj), 353);
      anim(tmp, 1000, has_trait(1, self_obj, 10));
      party_remove(self_obj);
      party_add(tmp);
      critter_add_trait(tmp, 1, 6, 0);
      float_msg(tmp, message_str(353, 200), 3);
      display_msg(message_str(353, 201));
      play_sfx("MADDOGAQ");
      Dog_ptr := tmp;
      move_to(self_obj, 0, 0);
      destroy_object(self_obj);
    end
  dog_remove_party: |
    set_global_var(5, 0);
    party_remove(self_obj);
  dog_join_party: |
    set_global_var(5, 1);
    set_global_var(640, get_pc_stat(1));
    party_add(self_obj);
  dog00: |
    gsay_reply(353, 110);
    if (global_var(5) == 0) then begin
      giq_option(4, 353, 111, dog_join_party, 50);
    end
    else begin
      giq_option(4, 353, 112, dog_remove_party, 50);
    end
    giq_option(4, 353, 114, dog01, 50);
    giq_option(4, 353, 113, dog_end, 50);
  dog01: 'animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj),
    random(0, 5), 10), 0);

    '
  dog_end: 'float_msg(self_obj, message_str(353, 971), 0);

    '
junkie:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    variable LVar0 := 0;
    call get_reaction;
    LVar0 := random(1, 3);
    if (LVar0 == 1) then begin
      float_msg(self_obj, message_str(823, 101), 2);
    end
    else begin
      if (LVar0 == 2) then begin
        float_msg(self_obj, message_str(823, 102), 2);
      end
      else begin
        if (LVar0 == 3) then begin
          float_msg(self_obj, message_str(823, 103), 2);
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(823, 100));
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      anim(self_obj, 48, 0);
      critter_add_trait(self_obj, 1, 6, 22);
      critter_add_trait(self_obj, 1, 5, 5);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
junkjail:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  damage_p_proc: |
    set_global_var(247, 1);
    destroy_object(self_obj);
  description_p_proc: |
    script_overrides;
    display_msg(message_str(789, 101));
  map_enter_p_proc: |
    if (tile_num(self_obj) == 18666) then begin
      obj_close(self_obj);
      obj_lock(self_obj);
      jail_door_ptr := self_obj;
    end
  spatial_p_proc: |
    if ((source_obj == dude_obj) and (triggered == 0) and (map_var(1) == 1)) then begin
      display_msg(message_str(789, 100));
      set_map_var(1, 0);
      set_global_var(155, global_var(155) - 3);
      display_msg(message_str(789, 107));
      give_exp_points(250);
      if (global_var(247) == 0) then begin
        set_global_var(247, 1);
        set_global_var(155, global_var(155) - 5);
      end
      triggered := 1;
      destroy_object(self_obj);
    end
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 84) then begin
      skill_test := roll_vs_skill(dude_obj, 9, -20);
      call lockpicking;
    end
  use_skill_on_p_proc: |
    if (action_being_used == 9) then begin
      skill_test := roll_vs_skill(dude_obj, 9, 0);
      call lockpicking;
    end
  use_p_proc: |
    if (obj_is_locked(self_obj)) then begin
      script_overrides;
      display_msg(message_str(789, 102));
    end
  lockpicking: |
    script_overrides;
    set_map_var(3, map_var(3) + 1);
    if (is_success(skill_test)) then begin
      if (obj_is_locked(self_obj)) then begin
        obj_unlock(self_obj);
        display_msg(message_str(789, 103));
      end
      else begin
        obj_lock(self_obj);
        display_msg(message_str(789, 104));
      end
    end
    else begin
      if (obj_is_locked(self_obj)) then begin
        display_msg(message_str(789, 105));
      end
      else begin
        display_msg(message_str(789, 106));
      end
    end
junkpeas:
  start: "[]"
  map_enter_p_proc: |
    variable LVar0 := 0;
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 16);
      critter_add_trait(self_obj, 1, 5, 6);
      if (not(metarule(22, 0)) and not(obj_is_carrying_obj_pid(self_obj, 41)) and (local_var(4) == 0)) then begin
        LVar0 := create_object_sid(41, 0, 0, -1);
        add_mult_objs_to_inven(self_obj, LVar0, random(0, 10));
        set_local_var(4, 1);
      end
      if (local_var(3) == 0) then begin
        set_local_var(3, tile_num(self_obj));
      end
      sleep_tile := 7000;
      wake_time := random(610, 650);
      sleep_time := random(1710, 1750);
      initialized := 1;
    end
  critter_p_proc: |
    if (local_var(1) and tile_distance_objs(self_obj, dude_obj)) then begin
      call flee_dude;
    end
    if (global_var(628) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        call flee_dude;
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
      set_local_var(1, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(628, 1);
      set_global_var(247, 1);
      set_global_var(155, global_var(155) - 5);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  pickup_p_proc: |
    set_local_var(1, 1);
    set_global_var(247, 1);
  talk_p_proc: |
    if ((local_var(1) == 1) or (global_var(247) == 1)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if (local_var(0) == 0) then begin
        set_local_var(0, random(101, 110));
      end
      float_msg(self_obj, message_str(715, local_var(0)), 0);
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
justin:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(696, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (travel == 1) then begin
      travel := 0;
      call GoToDecker;
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (map_var(53) == 1) then begin
      set_map_var(53, 0);
      start_gdialog(696, self_obj, 4, -1, -1);
      gsay_start;
      call Justin35;
      gsay_end;
      end_dialogue;
    end
    else begin
      if (local_var(7) == 1) then begin
        start_gdialog(696, self_obj, 4, -1, -1);
        gsay_start;
        call Justin29;
        gsay_end;
        end_dialogue;
      end
      else begin
        if (global_var(203) == 1) then begin
          start_gdialog(696, self_obj, 4, -1, -1);
          gsay_start;
          call Justin27;
          gsay_end;
          end_dialogue;
        end
        else begin
          if (local_var(6) == 1) then begin
            start_gdialog(696, self_obj, 4, -1, -1);
            gsay_start;
            call Justin26;
            gsay_end;
            end_dialogue;
          end
          else begin
            if (local_var(6) == 2) then begin
              start_gdialog(696, self_obj, 4, -1, -1);
              gsay_start;
              call Justin28;
              gsay_end;
              end_dialogue;
            end
            else begin
              if (local_var(4) == 0) then begin
                set_local_var(4, 1);
                start_gdialog(696, self_obj, 4, -1, -1);
                gsay_start;
                call Justin00;
                gsay_end;
                end_dialogue;
              end
              else begin
                if (global_var(158) > 2) then begin
                  call Justin03;
                end
                else begin
                  if ((local_var(1) == 3) or (local_var(1) == 0)) then begin
                    start_gdialog(696, self_obj, 4, -1, -1);
                    gsay_start;
                    call Justin31;
                    gsay_end;
                    end_dialogue;
                  end
                  else begin
                    if (local_var(1) == 2) then begin
                      start_gdialog(696, self_obj, 4, -1, -1);
                      gsay_start;
                      call Justin32;
                      gsay_end;
                      end_dialogue;
                    end
                    else begin
                      if (local_var(1) == 1) then begin
                        start_gdialog(696, self_obj, 4, -1, -1);
                        gsay_start;
                        call Justin33;
                        gsay_end;
                        end_dialogue;
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    set_global_var(221, 1);
  combat_p_proc: |
    if (map_var(54) == 1) then begin
      script_overrides;
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if ((party_member_obj(LVar0) != 0) and (map_var(52) == 0)) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      Justin_Ptr := self_obj;
      if (global_var(221) == 1) then begin
        set_obj_visibility(self_obj, 0);
      end
      critter_add_trait(self_obj, 1, 6, 40);
      critter_add_trait(self_obj, 1, 5, 86);
    end
  combat: 'hostile := 1;

    '
  Justin00: |
    if (global_var(158) > 2) then begin
      gsay_message(696, 101, 50);
    end
    else begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        gsay_reply(696, 102);
      end
      else begin
        gsay_reply(696, 103);
      end
      call Justin30;
    end
  Justin01: |
    gsay_reply(696, 104);
    if ((global_var(203) == 0) and ((map_var(46) > 0) and (map_var(46) != 6))) then begin
      giq_option(4, 696, 105, Justin01a, 50);
    end
    if ((global_var(203) == 0) and ((map_var(47) > 0) and (map_var(47) != 7))) then begin
      giq_option(4, 696, 106, Justin01b, 50);
    end
    if (global_var(305) == 2) then begin
      giq_option(4, 696, 180, Justin36, 50);
    end
    giq_option(4, 696, 107, JustinEnd, 50);
    giq_option(4, 696, 108, Justin04, 50);
  Justin01a: |
    if (global_var(111) != 2) then begin
      call Justin05a;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
        call Justin06;
      end
      else begin
        call Justin07;
      end
    end
  Justin01b: |
    if (global_var(112) != 2) then begin
      call Justin05a;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
        call Justin06;
      end
      else begin
        call Justin08;
      end
    end
  Justin02: |
    if (local_var(5) == 0) then begin
      call UpReact;
      set_local_var(5, 1);
      gsay_message(696, 109, 49);
    end
    else begin
      gsay_message(696, 110, 49);
    end
  Justin03: 'float_msg(self_obj, message_str(696, 111), 2);

    '
  Justin04: 'gsay_message(696, 112, 50);

    '
  Justin05a: |
    gsay_reply(696, 170);
    giq_option(4, 696, 171, Justin05b, 50);
  Justin05b: |
    gsay_reply(696, 113);
    call Justin09;
  Justin06: |
    gsay_reply(696, 114);
    call Justin09;
  Justin07: |
    gsay_reply(696, 115);
    call Justin15;
  Justin08: |
    gsay_reply(696, 116);
    call Justin15;
  Justin09: |
    giq_option(4, 696, 117, Justin11, 50);
    giq_option(4, 696, 118, Justin10, 50);
    giq_option(4, 696, 119, Justin12, 50);
  Justin10: |
    gsay_reply(696, 120);
    giq_option(4, 696, 121, Justin11, 50);
    giq_option(4, 696, 122, Justin12, 50);
  Justin11: |
    variable LVar0 := 0;
    set_local_var(6, 1);
    LVar0 := item_caps_adjust(dude_obj, 300);
    gsay_message(696, 123, 50);
    gsay_reply(696, 174);
    giq_option(4, 696, 124, Justin20, 50);
    giq_option(4, 696, 125, JustinEnd, 50);
  Justin12: |
    set_local_var(6, 2);
    gsay_reply(696, 126);
    giq_option(4, 696, 127, Justin13, 50);
    giq_option(4, 696, 128, Justin14, 50);
    giq_option(4, 696, 129, JustinEnd, 50);
  Justin13: |
    variable LVar0 := 0;
    set_local_var(6, 1);
    LVar0 := item_caps_adjust(dude_obj, 300);
    gsay_message(696, 130, 49);
    gsay_message(696, 175, 50);
  Justin14: 'gsay_message(696, 131, 50);

    '
  Justin15: |
    giq_option(4, 696, 132, JustinCombat, 50);
    giq_option(4, 696, 133, Justin15a, 50);
    giq_option(4, 696, 134, Justin15b, 50);
    giq_option(4, 696, 135, Justin15c, 50);
    giq_option(4, 696, 136, Justin15d, 50);
  Justin15a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 30))) then begin
      call Justin16;
    end
    else begin
      call Justin17;
    end
  Justin15b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Justin16;
    end
    else begin
      call Justin17;
    end
  Justin15c: |
    if (is_success(roll_vs_skill(dude_obj, 14, 15))) then begin
      call Justin16;
    end
    else begin
      call Justin17;
    end
  Justin15d: |
    if (is_success(roll_vs_skill(dude_obj, 14, -50))) then begin
      call Justin18;
    end
    else begin
      call Justin19;
    end
  Justin16: |
    gsay_reply(696, 137);
    call Justin09;
  Justin17: |
    set_local_var(7, 1);
    gsay_message(696, 138, 51);
  Justin18: |
    gsay_reply(696, 139);
    call Justin09;
  Justin19: |
    set_local_var(7, 1);
    gsay_message(696, 140, 51);
  Justin20: |
    gsay_message(696, 141, 50);
    call JustinTravel;
  Justin26: |
    gsay_reply(696, 151);
    giq_option(4, 696, 152, JustinTravel, 50);
    giq_option(4, 696, 153, JustinEnd, 50);
    giq_option(-3, 696, 154, Justin34, 50);
  Justin27: 'gsay_message(696, 155, 49);

    '
  Justin28: |
    gsay_reply(696, 156);
    giq_option(4, 696, 157, Justin11, 50);
    giq_option(4, 696, 158, JustinEnd, 50);
    giq_option(-3, 696, 159, Justin34, 50);
  Justin29: 'gsay_message(696, 160, 50);

    '
  Justin30: |
    giq_option(4, 696, 161, Justin01, 50);
    giq_option(4, 696, 162, Justin02, 50);
    giq_option(4, 696, 163, JustinEnd, 50);
    giq_option(-3, 696, 164, Justin34, 50);
  Justin31: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(696, 165);
    end
    else begin
      gsay_reply(696, 166);
    end
    call Justin30;
  Justin32: |
    gsay_reply(696, 167);
    call Justin30;
  Justin33: |
    gsay_reply(696, 168);
    call Justin30;
  Justin34: 'gsay_message(696, 169, 50);

    '
  Justin35: |
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, 1000);
    set_global_var(155, global_var(155) + 4);
    give_exp_points(1400);
    display_msg(message_str(766, 103) + 1400 + message_str(766, 104));
    gsay_message(696, 172, 49);
    gsay_message(696, 173, 49);
  Justin36: |
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, 500);
    set_global_var(155, global_var(155) + 5);
    give_exp_points(500);
    display_msg(message_str(766, 103) + 500 + message_str(766, 104));
    gsay_message(696, 181, 49);
    set_global_var(305, 3);
    gfade_out(1);
    game_time_advance(10 * 60 * 60 * 2);
    gfade_in(1);
  JustinEnd: "[]"
  JustinCombat: 'call combat;

    '
  JustinTravel: 'travel := 1;

    '
  GoToDecker: |
    set_map_var(52, 1);
    gfade_out(1000);
    set_obj_visibility(Fry_Stub_Ptr, 0);
    move_to(self_obj, 23926, 1);
    anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(Decker_Ptr)));
    critter_add_trait(self_obj, 1, 6, 0);
    if (map_var(49) == 0) then begin
      move_to(Kane_Ptr, 22526, 1);
      anim(Kane_Ptr, 1000, rotation_to_tile(tile_num(Kane_Ptr), tile_num(Decker_Ptr)));
    end
    move_to(dude_obj, 24125, 1);
    anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(Decker_Ptr)));
    gfade_in(1000);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
kane:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(594, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (map_var(51) == 1) then begin
      dialogue_system_enter;
    end
    if (travel == 1) then begin
      travel := 0;
      call GoToDecker;
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (map_var(51) == 1) then begin
      set_map_var(51, 0);
      float_msg(self_obj, message_str(594, 300), 2);
    end
    else begin
      if ((map_var(11) == 1) or (map_var(44) == 1) or (map_var(45) == 4) or (map_var(45) == 5) or (map_var(46) == 1) or (map_var(47) == 2)) then begin
        call Kane10;
      end
      else begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
          if (local_var(6) == 0) then begin
            set_local_var(6, 1);
            call Kane61;
          end
          else begin
            if (local_var(6) == 1) then begin
              set_local_var(6, 2);
              call Kane62;
            end
            else begin
              call Kane63;
            end
          end
        end
        else begin
          if (local_var(4) == 0) then begin
            set_local_var(4, 1);
            if (((global_var(37) == 0) and (global_var(38) == 0)) == 1) then begin
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                start_gdialog(594, self_obj, 4, -1, -1);
                gsay_start;
                call Kane11;
                gsay_end;
                end_dialogue;
              end
              else begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  start_gdialog(594, self_obj, 4, -1, -1);
                  gsay_start;
                  call Kane15;
                  gsay_end;
                  end_dialogue;
                end
                else begin
                  start_gdialog(594, self_obj, 4, -1, -1);
                  gsay_start;
                  call Kane60;
                  gsay_end;
                  end_dialogue;
                end
              end
            end
            else begin
              if (((global_var(37) == 1) == 1) and ((global_var(38) == 1) == 0)) then begin
                start_gdialog(594, self_obj, 4, -1, -1);
                gsay_start;
                call Kane12;
                gsay_end;
                end_dialogue;
              end
              else begin
                if (((global_var(38) == 1) == 1) and ((global_var(37) == 1) == 0)) then begin
                  start_gdialog(594, self_obj, 4, -1, -1);
                  gsay_start;
                  call Kane13;
                  gsay_end;
                  end_dialogue;
                end
                else begin
                  if (((global_var(37) == 1) and (global_var(38) == 1)) == 1) then begin
                    start_gdialog(594, self_obj, 4, -1, -1);
                    gsay_start;
                    call Kane14;
                    gsay_end;
                    end_dialogue;
                  end
                  else begin
                    start_gdialog(594, self_obj, 4, -1, -1);
                    gsay_start;
                    call Kane60;
                    gsay_end;
                    end_dialogue;
                  end
                end
              end
            end
          end
          else begin
            if ((map_var(44) == 1) or (map_var(11) == 1)) then begin
              call Kane10;
            end
            else begin
              if (map_var(45) == 2) then begin
                start_gdialog(594, self_obj, 4, -1, -1);
                gsay_start;
                call Kane93;
                gsay_end;
                end_dialogue;
              end
              else begin
                if (map_var(45) == 5) then begin
                  start_gdialog(594, self_obj, 4, -1, -1);
                  gsay_start;
                  call Kane100;
                  gsay_end;
                  end_dialogue;
                end
                else begin
                  if (map_var(45) == 4) then begin
                    start_gdialog(594, self_obj, 4, -1, -1);
                    gsay_start;
                    call Kane106;
                    gsay_end;
                    end_dialogue;
                  end
                  else begin
                    if ((global_var(111) != 2) and (local_var(7) == 0)) then begin
                      if (map_var(46) == 0) then begin
                        start_gdialog(594, self_obj, 4, -1, -1);
                        gsay_start;
                        call Kane60;
                        gsay_end;
                        end_dialogue;
                      end
                      else begin
                        if (map_var(46) == 1) then begin
                          start_gdialog(594, self_obj, 4, -1, -1);
                          gsay_start;
                          call Kane10;
                          gsay_end;
                          end_dialogue;
                        end
                        else begin
                          if (map_var(46) == 2) then begin
                            if (global_var(111) == 5) then begin
                              start_gdialog(594, self_obj, 4, -1, -1);
                              gsay_start;
                              call Kane153;
                              gsay_end;
                              end_dialogue;
                            end
                            else begin
                              start_gdialog(594, self_obj, 4, -1, -1);
                              gsay_start;
                              call Kane86;
                              gsay_end;
                              end_dialogue;
                            end
                          end
                          else begin
                            if (map_var(46) == 4) then begin
                              if (global_var(111) == 5) then begin
                                start_gdialog(594, self_obj, 4, -1, -1);
                                gsay_start;
                                call Kane153;
                                gsay_end;
                                end_dialogue;
                              end
                              else begin
                                start_gdialog(594, self_obj, 4, -1, -1);
                                gsay_start;
                                call Kane135;
                                gsay_end;
                                end_dialogue;
                              end
                            end
                          end
                        end
                      end
                    end
                    else begin
                      if ((global_var(111) == 2) and (local_var(7) == 0)) then begin
                        if (map_var(46) == 0) then begin
                          start_gdialog(594, self_obj, 4, -1, -1);
                          gsay_start;
                          call Kane71;
                          gsay_end;
                          end_dialogue;
                        end
                        else begin
                          if (map_var(46) == 1) then begin
                            start_gdialog(594, self_obj, 4, -1, -1);
                            gsay_start;
                            call Kane79;
                            gsay_end;
                            end_dialogue;
                          end
                          else begin
                            if (map_var(46) == 2) then begin
                              start_gdialog(594, self_obj, 4, -1, -1);
                              gsay_start;
                              call Kane89;
                              gsay_end;
                              end_dialogue;
                            end
                            else begin
                              if (map_var(46) == 4) then begin
                                start_gdialog(594, self_obj, 4, -1, -1);
                                gsay_start;
                                call Kane87;
                                gsay_end;
                                end_dialogue;
                              end
                            end
                          end
                        end
                      end
                      else begin
                        if ((global_var(112) != 2) and (local_var(7) == 112)) then begin
                          if (map_var(47) == 0) then begin
                            start_gdialog(594, self_obj, 4, -1, -1);
                            gsay_start;
                            call Kane134;
                            gsay_end;
                            end_dialogue;
                          end
                          else begin
                            if (map_var(47) == 2) then begin
                              start_gdialog(594, self_obj, 4, -1, -1);
                              gsay_start;
                              call Kane10;
                              gsay_end;
                              end_dialogue;
                            end
                            else begin
                              if (map_var(47) == 3) then begin
                                start_gdialog(594, self_obj, 4, -1, -1);
                                gsay_start;
                                call Kane91;
                                gsay_end;
                                end_dialogue;
                              end
                              else begin
                                if (map_var(47) == 5) then begin
                                  start_gdialog(594, self_obj, 4, -1, -1);
                                  gsay_start;
                                  call Kane135;
                                  gsay_end;
                                  end_dialogue;
                                end
                              end
                            end
                          end
                        end
                        else begin
                          if ((global_var(112) == 2) and (local_var(7) == 112)) then begin
                            if (map_var(47) == 0) then begin
                              start_gdialog(594, self_obj, 4, -1, -1);
                              gsay_start;
                              call Kane80;
                              gsay_end;
                              end_dialogue;
                            end
                            else begin
                              if (map_var(47) == 2) then begin
                                start_gdialog(594, self_obj, 4, -1, -1);
                                gsay_start;
                                call Kane79;
                                gsay_end;
                                end_dialogue;
                              end
                              else begin
                                if (map_var(47) == 3) then begin
                                  start_gdialog(594, self_obj, 4, -1, -1);
                                  gsay_start;
                                  call Kane90;
                                  gsay_end;
                                  end_dialogue;
                                end
                                else begin
                                  if (map_var(47) == 5) then begin
                                    start_gdialog(594, self_obj, 4, -1, -1);
                                    gsay_start;
                                    call Kane92;
                                    gsay_end;
                                    end_dialogue;
                                  end
                                  else begin
                                    if (map_var(47) == 6) then begin
                                      start_gdialog(594, self_obj, 4, -1, -1);
                                      gsay_start;
                                      call Kane134;
                                      gsay_end;
                                      end_dialogue;
                                    end
                                  end
                                end
                              end
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    set_map_var(49, 1);
    if ((map_var(49) == 1) and (map_var(50) == 1)) then begin
      set_global_var(202, 1);
      set_map_var(11, 1);
      set_map_var(44, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      Kane_Ptr := self_obj;
      if (map_var(49) == 1) then begin
        set_obj_visibility(self_obj, 1);
      end
      critter_add_trait(self_obj, 1, 6, 38);
      critter_add_trait(self_obj, 1, 5, 88);
    end
  combat: 'hostile := 1;

    '
  Kane00: |
    giq_option(4, 594, 101, Kane02, 50);
    giq_option(4, 594, 102, Kane04, 51);
    giq_option(4, 594, 104, Kane07, 50);
    giq_option(4, 594, 105, KaneEndDeclined, 50);
    giq_option(-3, 594, 106, Kane01, 50);
  Kane01: |
    gsay_message(594, 107, 50);
    call KaneEndRefuses;
  Kane02: |
    gsay_reply(594, 108);
    giq_option(4, 594, 109, Kane03, 50);
    giq_option(4, 594, 110, Kane06, 50);
    giq_option(6, 594, 111, Kane09, 50);
    giq_option(4, 594, 112, Kane08, 50);
  Kane03: |
    gsay_message(594, 113, 50);
    call KaneTravel;
  Kane04: |
    gsay_reply(594, 114);
    giq_option(4, 594, 115, Kane02, 50);
    giq_option(4, 594, 116, Kane05, 51);
  Kane05: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(594, 117);
    end
    else begin
      gsay_reply(594, 118);
    end
    giq_option(4, 594, 119, KaneEndHostile, 51);
    giq_option(4, 594, 120, Kane02, 50);
    giq_option(4, 594, 121, KaneEndNotAcceptedOrDeclined, 50);
  Kane06: |
    gsay_message(594, 123, 50);
    call KaneEndNotAcceptedOrDeclined;
  Kane07: |
    gsay_message(594, 124, 50);
    call KaneEndNotAcceptedOrDeclined;
  Kane08: |
    gsay_reply(594, 125);
    giq_option(4, 594, 126, Kane03, 50);
    giq_option(4, 594, 127, KaneEndDeclined, 50);
    giq_option(4, 594, 128, Kane06, 50);
  Kane09: |
    gsay_reply(594, 129);
    giq_option(4, 594, 130, KaneTravel, 50);
    giq_option(4, 594, 131, KaneEndDeclined, 50);
    giq_option(4, 594, 132, Kane06, 50);
  Kane10: |
    if (local_var(5) < 3) then begin
      set_local_var(5, local_var(5) + 1);
      float_msg(self_obj, message_str(594, random(133, 136)), 2);
    end
    else begin
      set_map_var(11, 1);
      set_map_var(45, 4);
      set_map_var(44, 1);
      float_msg(self_obj, message_str(594, 137), 2);
      call combat;
    end
  Kane11: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(594, 138);
    end
    else begin
      gsay_reply(594, 139);
    end
    call Kane00;
  Kane12: |
    gsay_reply(594, 140);
    call Kane00;
  Kane13: |
    gsay_reply(594, 141);
    call Kane00;
  Kane14: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(594, 143);
    end
    else begin
      gsay_reply(594, 142);
    end
    call Kane00;
  Kane15: |
    gsay_reply(594, 144);
    call Kane16;
  Kane16: |
    if (global_var(101) != 2) then begin
      giq_option(4, 594, 145, Kane17, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 594, 146, Kane36, 50);
    end
    else begin
      giq_option(4, 594, 147, Kane32, 50);
    end
    giq_option(4, 594, 151, Kane29, 50);
    giq_option(4, 594, 152, KaneEndNotAcceptedOrDeclined, 50);
    giq_option(-3, 594, 154, Kane01, 50);
    giq_option(-3, 594, 155, Kane01, 50);
  Kane17: |
    gsay_reply(594, 156);
    giq_option(6, 594, 157, Kane18, 50);
    giq_option(4, 594, 158, Kane19, 50);
    giq_option(4, 594, 159, Kane16, 50);
    giq_option(4, 594, 160, KaneEndNotAcceptedOrDeclined, 50);
  Kane18: |
    gsay_reply(594, 161);
    call Kane16;
  Kane19: |
    gsay_reply(594, 162);
    call Kane16;
  Kane29: |
    gsay_reply(594, 200);
    giq_option(4, 594, 201, Kane59, 50);
    giq_option(4, 594, 202, Kane31, 50);
    giq_option(4, 594, 203, Kane30, 50);
  Kane30: |
    gsay_reply(594, 204);
    call Kane16;
  Kane31: |
    gsay_message(594, 205, 51);
    call KaneEndRefuses;
  Kane32: |
    gsay_reply(594, 206);
    giq_option(4, 594, 207, Kane33, 51);
    giq_option(4, 594, 208, Kane35, 50);
  Kane33: |
    gsay_reply(594, 209);
    giq_option(4, 594, 210, Kane34, 51);
    giq_option(4, 594, 211, Kane35, 50);
  Kane34: |
    gsay_message(594, 212, 51);
    call KaneEndHostile;
  Kane35: |
    gsay_reply(594, 213);
    call Kane16;
  Kane36: |
    gsay_reply(594, 214);
    giq_option(4, 594, 215, Kane41, 50);
    giq_option(4, 594, 216, Kane39, 50);
    giq_option(4, 594, 217, Kane36a, 50);
  Kane36a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -15))) then begin
      call Kane37;
    end
    else begin
      call Kane38;
    end
  Kane37: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(594, 218, 50);
    end
    else begin
      gsay_message(594, 219, 50);
    end
    call KaneTravel;
  Kane38: |
    gsay_message(594, 220, 51);
    call KaneEndTakeHike;
  Kane39: |
    gsay_reply(594, 221);
    giq_option(4, 594, 222, Kane41, 50);
    giq_option(4, 594, 223, Kane40, 50);
  Kane40: |
    gsay_message(594, 224, 50);
    call KaneEndAnnoyed;
  Kane41: |
    gsay_reply(594, 225);
    if (map_var(33) == 1) then begin
      giq_option(4, 594, 226, Kane42, 50);
    end
    if (map_var(18) == 1) then begin
      giq_option(4, 594, 227, Kane41a, 50);
    end
    if (global_var(207) == 1) then begin
      giq_option(4, 594, 228, Kane47, 50);
    end
    giq_option(4, 594, 229, Kane45, 50);
    giq_option(4, 594, 230, Kane44, 50);
  Kane41a: |
    if (map_var(21) == 1) then begin
      call Kane57;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, -15))) then begin
        call Kane57;
      end
      else begin
        call Kane58;
      end
    end
  Kane42: |
    gsay_reply(594, 231);
    giq_option(4, 594, 232, Kane43, 50);
    giq_option(4, 594, 233, Kane46, 50);
  Kane43: |
    gsay_message(594, 234, 51);
    call KaneEndAnnoyed;
  Kane44: |
    gsay_message(594, 235, 51);
    call KaneEndAnnoyed;
  Kane45: |
    gsay_message(594, 236, 51);
    call KaneEndHostile;
  Kane46: |
    gsay_message(594, 237, 50);
    call KaneEndAnnoyed;
  Kane47: |
    gsay_reply(594, 238);
    giq_option(4, 594, 239, Kane47a, 50);
    giq_option(4, 594, 240, Kane49, 50);
    giq_option(4, 594, 241, KaneEndRefuses, 51);
    giq_option(4, 594, 242, Kane48, 50);
  Kane47a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Kane50;
    end
    else begin
      call Kane53;
    end
  Kane48: |
    gsay_message(594, 243, 51);
    call KaneEndRefuses;
  Kane49: |
    gsay_message(594, 244, 50);
    call KaneTravel;
  Kane50: |
    gsay_reply(594, 245);
    giq_option(4, 594, 246, Kane51, 50);
    giq_option(4, 594, 247, Kane52, 50);
  Kane51: |
    gsay_message(594, 248, 51);
    call KaneEndRefuses;
  Kane52: |
    gsay_message(594, 249, 50);
    call KaneTravel;
  Kane53: |
    gsay_reply(594, 250);
    giq_option(4, 594, 251, Kane55, 50);
    giq_option(4, 594, 252, Kane54, 50);
    giq_option(4, 594, 253, Kane56, 50);
    giq_option(4, 594, 254, Kane54, 50);
  Kane54: |
    gsay_message(594, 255, 50);
    call KaneEndAnnoyed;
  Kane55: |
    gsay_message(594, 256, 50);
    call KaneEndAnnoyed;
  Kane56: |
    gsay_message(594, 257, 50);
    call KaneTravel;
  Kane57: |
    gsay_message(594, 258, 50);
    call KaneTravel;
  Kane58: |
    gsay_message(594, 259, 51);
    call KaneEndRefuses;
  Kane59: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(594, 260, 49);
    end
    else begin
      gsay_message(594, 261, 49);
    end
    call KaneEndNotAcceptedOrDeclined;
  Kane60: |
    gsay_reply(594, 262);
    call Kane16;
  Kane61: 'float_msg(self_obj, message_str(594, 263), 2);

    '
  Kane62: 'float_msg(self_obj, message_str(594, 264), 2);

    '
  Kane63: 'float_msg(self_obj, message_str(594, 265), 2);

    '
  Kane71: |
    set_map_var(46, 6);
    gsay_reply(594, 278);
    call Kane72;
  Kane72: |
    giq_option(4, 594, 279, Kane73, 51);
    giq_option(4, 594, 280, Kane74, 51);
    giq_option(4, 594, 281, Kane78, 51);
  Kane73: |
    gsay_message(594, 282, 51);
    call KaneEndHostile;
  Kane74: |
    gsay_message(594, 283, 51);
    call KaneEndHostile;
  Kane78: |
    gsay_message(594, 291, 51);
    call KaneEndHostile;
  Kane79: |
    set_map_var(46, 6);
    gsay_message(594, 292, 51);
    call KaneEndHostile;
  Kane80: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    give_exp_points(350);
    display_msg(message_str(766, 103) + 350 + message_str(766, 104));
    set_global_var(155, global_var(155) - 1);
    LVar1 := item_caps_adjust(dude_obj, 1000);
    set_map_var(47, 7);
    gsay_reply(594, 293);
    call Kane81;
  Kane81: |
    giq_option(4, 594, 294, Kane82, 51);
    giq_option(4, 594, 295, Kane83, 51);
    giq_option(-3, 594, 296, Kane84, 51);
  Kane82: |
    gsay_message(594, 297, 51);
    call KaneEndRefuses;
  Kane83: |
    gsay_message(594, 298, 51);
    call KaneEndRefuses;
  Kane84: |
    gsay_message(594, 299, 51);
    call KaneEndRefuses;
  Kane86: |
    variable LVar0 := 0;
    set_map_var(46, 4);
    set_global_var(579, 1);
    LVar0 := item_caps_adjust(dude_obj, 500);
    gsay_message(594, 301, 50);
  Kane87: |
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, 2500);
    give_exp_points(600);
    display_msg(message_str(766, 103) + 600 + message_str(766, 104));
    set_global_var(155, global_var(155) - 2);
    set_map_var(46, 5);
    set_local_var(7, 112);
    gsay_message(594, 302, 50);
  Kane89: |
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, 3000);
    give_exp_points(600);
    display_msg(message_str(766, 103) + 600 + message_str(766, 104));
    set_global_var(155, global_var(155) - 2);
    set_map_var(46, 5);
    set_local_var(7, 112);
    gsay_message(594, 304, 50);
  Kane90: |
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, 5000);
    give_exp_points(700);
    display_msg(message_str(766, 103) + 700 + message_str(766, 104));
    set_global_var(155, global_var(155) - 2);
    set_map_var(47, 6);
    gsay_message(594, 305, 50);
    gsay_message(594, 306, 50);
  Kane91: |
    variable LVar0 := 0;
    set_global_var(581, 1);
    LVar0 := item_caps_adjust(dude_obj, 1000);
    set_map_var(47, 5);
    gsay_message(594, 308, 50);
  Kane92: |
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, 4000);
    give_exp_points(700);
    display_msg(message_str(766, 103) + 700 + message_str(766, 104));
    set_global_var(155, global_var(155) - 2);
    set_map_var(47, 6);
    gsay_message(594, 309, 50);
  Kane93: |
    gsay_reply(594, 310);
    giq_option(4, 594, 311, Kane95, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 594, 312, Kane148, 51);
    end
    giq_option(4, 594, 313, Kane93a, 50);
    giq_option(4, 594, 314, Kane149, 51);
    giq_option(-3, 594, 315, Kane94, 50);
    giq_option(-3, 594, 316, Kane94, 50);
  Kane93a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Kane151;
    end
    else begin
      call Kane152;
    end
  Kane94: |
    gsay_message(594, 317, 50);
    call KaneEndRefuses;
  Kane95: |
    gsay_reply(594, 318);
    giq_option(4, 594, 319, Kane98, 51);
    giq_option(4, 594, 320, Kane99, 51);
    giq_option(4, 594, 321, Kane97, 51);
    giq_option(4, 594, 322, Kane98, 51);
    if (map_var(48) == 1) then begin
      giq_option(4, 594, 323, Kane96, 51);
    end
  Kane96: |
    gsay_message(594, 324, 51);
    call KaneEndHostile;
  Kane97: |
    gsay_message(594, 325, 51);
    call KaneEndRefuses;
  Kane98: |
    gsay_message(594, 326, 51);
    call KaneEndRefuses;
  Kane99: |
    gsay_message(594, 327, 51);
    call KaneEndHostile;
  Kane100: |
    gsay_reply(594, 328);
    giq_option(4, 594, 330, Kane103, 51);
    giq_option(4, 594, 331, Kane102, 50);
    giq_option(4, 594, 332, Kane104, 51);
    giq_option(4, 594, 333, Kane105, 50);
    giq_option(4, 594, 334, Kane101, 50);
  Kane101: |
    gsay_message(594, 335, 50);
    call KaneEnd;
  Kane102: |
    gsay_message(594, 336, 50);
    call KaneTravel;
  Kane103: |
    gsay_message(594, 337, 51);
    call KaneEndHostile;
  Kane104: |
    gsay_message(594, 338, 51);
    call KaneEndHostile;
  Kane105: |
    gsay_message(594, 339, 51);
    call KaneEndHostile;
  Kane106: |
    gsay_reply(594, 340);
    if (map_var(21) == 1) then begin
      giq_option(4, 594, 341, Kane57, 50);
    end
    else begin
      giq_option(4, 594, 343, Kane132, 50);
    end
    giq_option(4, 594, 344, KaneEnd, 50);
    giq_option(-3, 594, 345, Kane101, 50);
  Kane131: |
    gsay_message(594, random(403, 407), 50);
    call KaneTravel;
  Kane132: |
    gsay_message(594, 408, 50);
    call KaneEndTakeHike;
  Kane133: |
    giq_option(4, 594, 409, Kane131, 50);
    giq_option(4, 594, 411, KaneEnd, 50);
    giq_option(-3, 594, 412, Kane101, 50);
  Kane134: |
    gsay_reply(594, 413);
    call Kane133;
  Kane135: 'gsay_message(594, 415, 51);

    '
  Kane148: |
    gsay_message(594, 453, 51);
    call KaneEndHostile;
  Kane149: |
    gsay_message(594, 454, 51);
    call KaneEndHostile;
  Kane151: |
    gsay_message(594, 456, 50);
    call KaneTravel;
  Kane152: |
    gsay_message(594, 457, 50);
    call KaneEndRefuses;
  Kane153: |
    gsay_reply(594, 458);
    giq_option(4, 594, 459, Kane154, 50);
    giq_option(-3, 594, 460, Kane154, 50);
  Kane154: |
    gsay_reply(594, 461);
    giq_option(4, 594, 462, Kane155, 50);
    giq_option(-3, 594, 463, Kane155, 50);
  Kane155: |
    gsay_message(594, 464, 51);
    call KaneEndHostile;
  KaneEnd: "[]"
  KaneEndHostile: |
    set_map_var(11, 1);
    set_map_var(44, 1);
    set_map_var(45, 4);
  KaneEndNotAcceptedOrDeclined: 'set_map_var(45, 3);

    '
  KaneEndDeclined: 'set_map_var(45, 2);

    '
  KaneEndAnnoyed: 'set_map_var(45, 6);

    '
  KaneEndTakeHike: 'set_map_var(45, 5);

    '
  KaneEndRefuses: |
    set_map_var(45, 4);
    set_map_var(11, 1);
  KaneTravel: 'travel := 1;

    '
  GoToDecker: |
    set_map_var(45, 1);
    gfade_out(1000);
    move_to(self_obj, 22526, 1);
    anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(Decker_Ptr)));
    move_to(dude_obj, 23722, 1);
    anim(dude_obj, 1000, rotation_to_tile(tile_num(dude_obj), tile_num(Decker_Ptr)));
    gfade_in(1000);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
katja:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    if (global_var(244) > 0) then begin
      display_msg(message_str(623, 101));
    end
    else begin
      display_msg(message_str(623, 100));
    end
  description_p_proc: |
    if (not(combat_is_initialized)) then begin
      if ((global_var(244) == 2) and (tile_distance_objs(self_obj, dude_obj) > 1)) then begin
        script_overrides;
      end
      else begin
        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 5), 0);
        float_msg(dude_obj, message_str(623, 2016), 3);
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (global_var(244) == 2) then begin
      call map_commentary;
      call follow_player;
    end
    if ((global_var(620) < 2) and (global_var(244) == 2)) then begin
      if ((get_pc_stat(1) - global_var(621)) > 3) then begin
        set_global_var(630, global_var(630) + (get_pc_stat(1) - global_var(621)));
        set_global_var(621, get_pc_stat(1));
      end
      if (global_var(630) > 3) then begin
        set_global_var(630, 0);
        set_global_var(620, global_var(620) + 1);
        armour_ptr := critter_inven_obj(self_obj, 0);
        armour_pid := obj_pid(armour_ptr);
        new_proto := get_proto(armour_ptr);
        tmp := create_object_sid(new_proto, tile_num(self_obj), elevation(self_obj), 623);
        anim(tmp, 1000, has_trait(1, self_obj, 10));
        inven_unwield;
        move_obj_inven_to_obj(self_obj, tmp);
        armour_ptr := obj_carrying_pid_obj(tmp, armour_pid);
        if (armour_ptr) then begin
          wield_obj_critter(tmp, armour_ptr);
        end
        party_remove(self_obj);
        party_add(tmp);
        critter_add_trait(tmp, 1, 6, 0);
        float_msg(tmp, message_str(623, 1999), 3);
        display_msg(message_str(623, 2022));
        Katja_ptr := tmp;
        move_to(self_obj, 0, 0);
        destroy_object(self_obj);
      end
    end
  pickup_p_proc: |
    if (global_var(244) < 2) then begin
      hostile := 1;
    end
    else begin
      script_overrides;
    end
  destroy_p_proc: |
    set_global_var(244, 3);
    party_remove(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  map_enter_p_proc: |
    if (initialized == 0) then begin
      initialized := 1;
      critter_add_trait(self_obj, 1, 5, 4);
    end
    if (global_var(244) < 2) then begin
      critter_add_trait(self_obj, 1, 6, 49);
    end
    else begin
      critter_add_trait(self_obj, 1, 6, 0);
    end
    Katja_ptr := self_obj;
  use_obj_on_p_proc: |
    if (global_var(244) == 2) then begin
      item := obj_pid(obj_being_used_with);
      if ((item != 40) and (item != 47) and (item != 91)) then begin
        script_overrides;
        if (obj_item_subtype(obj_being_used_with) == 3) then begin
          if ((item == 4) or (item == 9) or (item == 22) or (item == 45) or (item == 7) or (item == 159) or (item == 25) or (item == 26) or (item == 27) or (item == 19) or (item == 21) or (item == 234) or (item == 235) or (item == 116) or (item == 236) or (item == 241)) then begin
            rm_obj_from_inven(dude_obj, obj_being_used_with);
            add_obj_to_inven(self_obj, obj_being_used_with);
          end
          else begin
            float_msg(self_obj, message_str(634, 109), 5);
          end
        end
        else begin
          rm_obj_from_inven(dude_obj, obj_being_used_with);
          add_obj_to_inven(self_obj, obj_being_used_with);
        end
      end
    end
  talk_p_proc: |
    start_gdialog(623, self_obj, 4, -1, -1);
    gsay_start;
    if (global_var(244) == 3) then begin
      call Katja28;
    end
    else begin
      if (global_var(244) == 2) then begin
        call Katja24;
      end
      else begin
        if (global_var(244) == 1) then begin
          call Katja25;
        end
        else begin
          call Katja01;
        end
      end
    end
    gsay_end;
    end_dialogue;
    if (bestweapon_flag == 1) then begin
      bestweapon_flag := 0;
      inven_unwield;
    end
    if (armour_flag == 1) then begin
      armour_flag := 0;
      new_proto := get_proto(armour_ptr);
      if (new_proto) then begin
        tmp := create_object_sid(new_proto, tile_num(self_obj), elevation(self_obj), 623);
        anim(tmp, 1000, has_trait(1, self_obj, 10));
        inven_unwield;
        move_obj_inven_to_obj(self_obj, tmp);
        wield_obj_critter(tmp, armour_ptr);
        party_remove(self_obj);
        party_add(tmp);
        critter_add_trait(tmp, 1, 6, 0);
        Katja_ptr := tmp;
        move_to(self_obj, 0, 0);
        destroy_object(self_obj);
      end
    end
    if (lock) then begin
      call pick_lock;
    end
    if (global_var(244) == 2) then begin
      if (global_var(315) == 0) then begin
        set_global_var(315, 1);
        give_exp_points(200);
        display_msg(message_str(623, 180));
      end
    end
  join_party: |
    set_global_var(244, 2);
    set_global_var(279, 5);
    set_global_var(621, get_pc_stat(1));
    critter_add_trait(self_obj, 1, 6, 0);
    party_add(self_obj);
    gsay_message(623, 153, 50);
  Katja01: |
    set_global_var(244, 1);
    gsay_reply(623, 102);
    giq_option(4, 623, message_str(623, 103) + proto_data(obj_pid(dude_obj), 1) + message_str(623, 104), Katja02, 50);
    giq_option(4, 623, 105, Katja02, 50);
    giq_option(5, 623, 106, Katja05, 50);
    giq_option(-3, 623, 189, KatjaExit, 50);
  Katja02: |
    gsay_reply(623, 107);
    giq_option(5, 623, 108, Katja03, 50);
    giq_option(5, 623, 109, Katja04, 50);
    giq_option(4, 623, 110, Katja07, 50);
    if ((global_var(101) != 2) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 623, 111, Katja06, 50);
    end
  Katja03: |
    gsay_reply(623, 112);
    giq_option(5, 623, 109, Katja04, 50);
    giq_option(4, 623, 110, Katja07, 50);
    if ((global_var(101) != 2) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 623, 111, Katja06, 50);
    end
  Katja04: |
    gsay_reply(623, 113);
    giq_option(5, 623, 114, Katja21, 50);
    giq_option(4, 623, 116, Katja09, 50);
    giq_option(4, 623, 115, KatjaEnd, 50);
  Katja05: |
    gsay_reply(623, 117);
    giq_option(4, 623, message_str(623, 103) + proto_data(obj_pid(dude_obj), 1) + message_str(623, 104), Katja02, 50);
    giq_option(4, 623, 118, Katja07, 50);
    giq_option(4, 623, 115, KatjaEnd, 50);
  Katja06: |
    gsay_reply(623, 119);
    giq_option(5, 623, 121, Katja11, 50);
    giq_option(4, 623, 122, Katja10, 50);
    giq_option(4, 623, 120, KatjaEnd, 50);
  Katja07: |
    gsay_reply(623, 123);
    giq_option(4, 623, 124, Katja06, 50);
    giq_option(4, 623, 125, Katja08, 50);
  Katja08: 'gsay_message(623, 126, 51);

    '
  Katja09: |
    gsay_reply(623, 127);
    if ((global_var(101) != 2) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 623, 128, Katja06, 50);
    end
    giq_option(4, 623, 129, Katja10, 50);
    giq_option(4, 623, 130, Katja17, 50);
  Katja10: |
    giq_option(4, 623, 131, Katja13, 50);
    giq_option(4, 623, 133, Katja15, 50);
    giq_option(4, 623, 134, Katja16, 50);
    giq_option(4, 623, 135, Katja12, 50);
    giq_option(4, 623, 130, Katja17, 50);
    giq_option(4, 623, 136, KatjaEnd, 50);
  Katja11: |
    gsay_reply(623, 137);
    giq_option(4, 623, 135, Katja12, 50);
    giq_option(4, 623, 138, KatjaEnd, 50);
  Katja12: |
    gsay_reply(623, 139);
    call Katja10;
  Katja13: |
    gsay_reply(623, 140);
    call Katja10;
  Katja15: |
    gsay_reply(623, 142);
    call Katja10;
  Katja16: |
    gsay_reply(623, 143);
    call Katja10;
  Katja17: |
    gsay_reply(623, 144);
    if (not(global_var(77))) then begin
      set_global_var(77, 1);
    end
    giq_option(4, 623, 145, Katja18, 50);
    giq_option(4, 623, 147, Katja10, 50);
    giq_option(4, 623, 146, KatjaEnd, 50);
  Katja18: |
    gsay_reply(623, 148);
    giq_option(4, 623, 149, Katja20, 50);
    giq_option(4, 623, 151, Katja10, 50);
    giq_option(4, 623, 150, KatjaEnd, 50);
  Katja20: |
    if ((global_var(118) == 2) and (global_var(121) == 2) and (get_critter_stat(dude_obj, 3) <= 5)) then begin
      gsay_message(623, 2017, 50);
    end
    else begin
      if ((global_var(118) == 2) or (global_var(121) == 2) and (get_critter_stat(dude_obj, 3) <= 3)) then begin
        gsay_message(623, 2018, 50);
      end
      else begin
        call join_party;
      end
    end
  Katja21: |
    gsay_reply(623, 154);
    giq_option(4, 623, 156, Katja22, 50);
    giq_option(6, 623, 157, Katja23, 50);
    giq_option(4, 623, 155, KatjaEnd, 50);
  Katja22: |
    gsay_reply(623, 158);
    call Katja10;
  Katja23: |
    gsay_reply(623, 159);
    giq_option(4, 623, 160, Katja09, 50);
    if ((global_var(101) == 0) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 623, 161, Katja06, 50);
    end
    giq_option(4, 623, 162, KatjaEnd, 50);
  Katja24: |
    gsay_reply(623, 163);
    if (cur_map_index == 30) then begin
      if (map_var(3)) then begin
        giq_option(4, 623, 164, set_lock, 50);
      end
    end
    if ((cur_map_index == 10) and (elevation(dude_obj) == 1)) then begin
      if (map_var(4)) then begin
        giq_option(4, 623, 164, set_lock, 50);
      end
    end
    giq_option(4, 623, 167, KatjaLeave, 50);
    giq_option(4, 623, 177, Katja26, 50);
    giq_option(4, 623, 2000, KatjaCombatTactics, 50);
    giq_option(4, 623, 168, KatjaEnd, 50);
    giq_option(-3, 623, 190, KatjaLeave, 50);
    giq_option(-3, 623, 168, KatjaEnd, 50);
  Katja25: |
    gsay_reply(623, 169);
    giq_option(4, 623, 171, Katja10, 50);
    giq_option(4, 623, 170, KatjaEnd, 50);
    giq_option(-3, 623, 189, KatjaExit, 50);
  Katja26: |
    gsay_message(623, 178, 50);
    call Katja24;
  Katja28: |
    gsay_reply(623, 181);
    giq_option(4, 623, 182, Katja20, 50);
    giq_option(4, 623, 183, KatjaEnd, 50);
    giq_option(-3, 623, 189, KatjaExit, 50);
  KatjaEnd: "[]"
  KatjaLeave: |
    set_global_var(244, 3);
    party_remove(self_obj);
  KatjaClose: |
    set_global_var(279, 3);
    call Katja24;
  KatjaModerate: |
    set_global_var(279, 5);
    call Katja24;
  KatjaFar: |
    set_global_var(279, 7);
    call Katja24;
  KatjaExit: 'gsay_message(623, 191, 50);

    '
  follow_player: |
    if (tile_distance_objs(self_obj, dude_obj) > global_var(279)) then begin
      if (anim_busy(self_obj) == 0) then begin
        dest_tile := tile_num_in_direction(tile_num_in_direction(tile_num(dude_obj), rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)), global_var(279)), random(0, 5), random(0, 2));
        if (tile_distance_objs(self_obj, dude_obj) > (2 * global_var(279))) then begin
          animate_move_obj_to_tile(self_obj, dest_tile, 1 bwor 16);
        end
        else begin
          animate_move_obj_to_tile(self_obj, dest_tile, 0 bwor 16);
        end
      end
    end
  map_commentary: |
    if (cur_map_index == 33) then begin
      if (elevation(self_obj) == 0) then begin
        if ((tile_distance(tile_num(self_obj), 27317) < 4) and (line173flag == 0)) then begin
          float_msg(self_obj, message_str(623, 173), 5);
          line173flag := 1;
        end
      end
    end
    else begin
      if (cur_map_index == 6) then begin
        if (elevation(self_obj) == 1) then begin
          if (tile_distance(tile_num(self_obj), 19111) < 4) then begin
            if ((line174flag == 0) and (global_var(238) != 2) and (Ian_ptr != 0)) then begin
              float_msg(self_obj, message_str(623, 172), 5);
              line174flag := 1;
            end
          end
        end
      end
      else begin
        if (cur_map_index == 38) then begin
          if (elevation(self_obj) == 0) then begin
            if ((tile_distance(tile_num(self_obj), 28104) < 5) and (line176flag == 0)) then begin
              float_msg(self_obj, message_str(623, 176), 5);
              if (global_var(121) == 2) then begin
                float_msg(Tycho_ptr, message_str(389, 167), 12);
              end
              line176flag := 1;
            end
          end
        end
        else begin
          if (cur_map_index == 32) then begin
            if (elevation(self_obj) == 1) then begin
              if (line184flag == 0) then begin
                float_msg(self_obj, message_str(623, 184), 5);
                if (global_var(118) == 2) then begin
                  float_msg(Ian_ptr, message_str(235, 175), 0);
                end
                line184flag := 1;
              end
            end
          end
          else begin
            if (cur_map_index == 34) then begin
              if (elevation(self_obj) == 0) then begin
                if (line186flag == 0) then begin
                  float_msg(self_obj, message_str(623, 186), 5);
                  line186flag := 1;
                end
              end
            end
            else begin
              if (cur_map_index == 3) then begin
                if (elevation(self_obj) == 1) then begin
                  if ((tile_distance(tile_num(self_obj), 17274) < 4) and (line187flag == 0)) then begin
                    float_msg(self_obj, message_str(623, 187), 5);
                    line187flag := 1;
                  end
                end
              end
              else begin
                if (cur_map_index == 45) then begin
                  if (elevation(self_obj) == 0) then begin
                    if (line188flag == 0) then begin
                      float_msg(self_obj, message_str(623, 188), 5);
                      line188flag := 1;
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  pick_lock: |
    reg_anim_func(2, self_obj);
    reg_anim_func(1, 1);
    reg_anim_obj_move_to_obj(self_obj, lock, -1);
    reg_anim_animate(self_obj, 11, -1);
    reg_anim_func(3, 0);
    use_obj(lock);
    obj_unlock(lock);
    lock := 0;
  set_lock: |
    if (cur_map_index == 30) then begin
      lock := map_var(3);
    end
    else begin
      if (cur_map_index == 10) then begin
        lock := map_var(4);
      end
    end
  KatjaCombatTactics: |
    armour_ptr := get_armour_ptr;
    gsay_reply(623, 2001);
    giq_option(4, 623, 2010, KatjaBestWeapon, 50);
    if (armour_ptr) then begin
      giq_option(4, 623, 2011, KatjaArmour, 50);
    end
    giq_option(4, 623, 2019, KatjaClose, 50);
    giq_option(4, 623, 2020, KatjaModerate, 50);
    giq_option(4, 623, 2021, KatjaFar, 50);
    giq_option(4, 623, 2015, Katja24, 50);
  KatjaBestWeapon: |
    gsay_message(623, 2100, 49);
    bestweapon_flag := 1;
    call KatjaCombatTactics;
  KatjaArmour: |
    gsay_message(623, 2100, 49);
    armour_flag := 1;
    call KatjaCombatTactics;
  get_armour_ptr: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar1 := obj_pid(critter_inven_obj(self_obj, 0));
    if (obj_is_carrying_obj_pid(self_obj, 74) and (LVar1 != 74)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 74);
    end
    if (obj_is_carrying_obj_pid(self_obj, 1) and (LVar1 != 1)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 1);
    end
    if (obj_is_carrying_obj_pid(self_obj, 113) and (LVar1 != 113)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 113);
    end
    if (obj_is_carrying_obj_pid(self_obj, 2) and (LVar1 != 2)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 2);
    end
    if (obj_is_carrying_obj_pid(self_obj, 17) and (LVar1 != 17)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 17);
    end
    if (obj_is_carrying_obj_pid(self_obj, 240) and (LVar1 != 240)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 240);
    end
    if (obj_is_carrying_obj_pid(self_obj, 239) and (LVar1 != 239)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 239);
    end
    if (obj_is_carrying_obj_pid(self_obj, 3) and (LVar1 != 3)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 3);
    end
    if (obj_is_carrying_obj_pid(self_obj, 232) and (LVar1 != 232)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 232);
    end
    return LVar0;
  get_proto: |
    variable LVar1 := 0;
    if (obj_pid(arg0) == 74) then begin
      LVar1 := 16777583 + (9 * global_var(620));
    end
    else begin
      if (obj_pid(arg0) == 1) then begin
        LVar1 := 16777584 + (9 * global_var(620));
      end
      else begin
        if (obj_pid(arg0) == 113) then begin
          LVar1 := 16777585 + (9 * global_var(620));
        end
        else begin
          if (obj_pid(arg0) == 2) then begin
            LVar1 := 16777586 + (9 * global_var(620));
          end
          else begin
            if (obj_pid(arg0) == 17) then begin
              LVar1 := 16777587 + (9 * global_var(620));
            end
            else begin
              if (obj_pid(arg0) == 240) then begin
                LVar1 := 16777588 + (9 * global_var(620));
              end
              else begin
                if (obj_pid(arg0) == 239) then begin
                  LVar1 := 16777589 + (9 * global_var(620));
                end
                else begin
                  if (obj_pid(arg0) == 3) then begin
                    LVar1 := 16777590 + (9 * global_var(620));
                  end
                  else begin
                    if (obj_pid(arg0) == 232) then begin
                      LVar1 := 16777591 + (9 * global_var(620));
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    return LVar1;
kenji:
  start: |
    if (script_action == 12) then begin
      call critter_p_proc;
    end
    else begin
      if (script_action == 14) then begin
        call damage_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (tile_distance(tile_num(self_obj), 26281) > 3) then begin
      animate_move_obj_to_tile(self_obj, 26281, 0);
    end
    else begin
      if (obj_on_screen(self_obj)) then begin
        float_msg(self_obj, message_str(510, 103), 2);
        attack_complex(Killian_ptr, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_map_var(2, 1);
    end
    else begin
      set_map_var(2, 2);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    if (map_var(2) == 1) then begin
      set_global_var(155, global_var(155) + 2);
      display_msg(message_str(510, 104));
      give_exp_points(400);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(510, 102));
  talk_p_proc: 'display_msg(message_str(510, random(100, 101)));

    '
kenny:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (global_var(221) == 0) then begin
      float_msg(self_obj, message_str(950, 101), 2);
    end
    else begin
      if (map_var(53) == 1) then begin
        set_map_var(53, 0);
        start_gdialog(950, self_obj, 4, -1, -1);
        gsay_start;
        call Kenny00;
        gsay_end;
        end_dialogue;
      end
      else begin
        float_msg(self_obj, message_str(950, 102), 2);
      end
    end
  destroy_p_proc: |
    display_msg(message_str(950, 106));
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(950, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 40);
      critter_add_trait(self_obj, 1, 5, 86);
    end
  Kenny00: |
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, 1000);
    set_global_var(155, global_var(155) + 4);
    give_exp_points(1400);
    display_msg(message_str(766, 103) + 1400 + message_str(766, 104));
    gsay_message(950, 103, 50);
    gsay_message(950, 104, 50);
    gsay_message(950, 105, 50);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
keri:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(595, 100));
  critter_p_proc: |
    variable LVar0 := 0;
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (SetDayNight == 0) then begin
      add_timer_event(self_obj, game_ticks(random(3, 8)), 1);
      SetDayNight := 1;
    end
    LVar0 := tile_num(self_obj);
    if (LVar0 == 12126) then begin
      if (anim_busy(self_obj) == 0) then begin
        if (has_trait(1, self_obj, 10) != 0) then begin
          anim(self_obj, 1000, 0);
        end
      end
    end
    else begin
      if (LVar0 == 11927) then begin
        if (anim_busy(self_obj) == 0) then begin
          if (has_trait(1, self_obj, 10) != 5) then begin
            anim(self_obj, 1000, 5);
          end
        end
      end
      else begin
        if (LVar0 == 12127) then begin
          if (anim_busy(self_obj) == 0) then begin
            if (has_trait(1, self_obj, 10) != 2) then begin
              anim(self_obj, 1000, 2);
            end
          end
        end
      end
    end
  pickup_p_proc: |
    if (local_var(5) == 0) then begin
      dialogue_system_enter;
    end
    else begin
      call Keri10;
    end
  talk_p_proc: |
    variable LVar0 := 0;
    call get_reaction;
    if (local_var(13) == 1) then begin
      if (local_var(11) < (game_time / (10 * 60 * 60 * 24 * 365))) then begin
        set_local_var(13, 0);
      end
      else begin
        if ((local_var(10) < get_month) or (local_var(10) == 12) and (get_month == 1) and ((local_var(10) != 1) or (get_month != 12))) then begin
          set_local_var(13, 0);
        end
        else begin
          if ((local_var(9) < get_day) and ((local_var(10) != 1) or (get_month != 12))) then begin
            set_local_var(13, 0);
          end
        end
      end
    end
    call RecalcDate;
    LVar0 := local_var(9);
    if ((map_var(24) == 1) and (map_var(28) == 0)) then begin
      call Keri13;
    end
    else begin
      if (local_var(5) == 1) then begin
        call Keri14;
      end
      else begin
        if (map_var(25) == 1) then begin
          call Keri15;
        end
        else begin
          if (global_var(204) == 5) then begin
            set_global_var(204, 6);
            set_map_var(25, 1);
            call BottomReact;
            call Keri19;
          end
          else begin
            if (global_var(204) == 3) then begin
              set_global_var(204, 6);
              set_map_var(25, 1);
              call BottomReact;
              start_gdialog(595, self_obj, 4, -1, -1);
              gsay_start;
              call Keri35;
              gsay_end;
              end_dialogue;
            end
            else begin
              if (map_var(26) == 0) then begin
                call Keri00;
              end
              else begin
                if (global_var(204) == 4) then begin
                  start_gdialog(595, self_obj, 4, -1, -1);
                  gsay_start;
                  call Keri27;
                  gsay_end;
                  end_dialogue;
                end
                else begin
                  if ((map_var(26) == 1) and (local_var(13) == 0)) then begin
                    start_gdialog(595, self_obj, 4, -1, -1);
                    gsay_start;
                    if (local_var(12) == 0) then begin
                      call Keri01;
                    end
                    else begin
                      call Keri03;
                    end
                    gsay_end;
                    end_dialogue;
                  end
                  else begin
                    if ((local_var(13) == 1) and (LVar0 == get_day)) then begin
                      start_gdialog(595, self_obj, 4, -1, -1);
                      gsay_start;
                      call Keri28;
                      gsay_end;
                      end_dialogue;
                    end
                    else begin
                      if ((local_var(13) == 1) and (LVar0 != get_day)) then begin
                        start_gdialog(595, self_obj, 4, -1, -1);
                        gsay_start;
                        call Keri29;
                        gsay_end;
                        end_dialogue;
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    set_map_var(28, 1);
  timed_event_p_proc: 'call SendAroundHouse;

    '
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 36);
      critter_add_trait(self_obj, 1, 5, 50);
      LastMove := 12127;
    end
  combat: 'hostile := 1;

    '
  Keri00: |
    if (local_var(7) == 0) then begin
      set_local_var(7, 1);
      float_msg(self_obj, message_str(595, 101), 2);
    end
    else begin
      float_msg(self_obj, message_str(595, 102), 2);
    end
  Keri01: |
    if (global_var(71) == 0) then begin
      set_global_var(71, 1);
    end
    if (global_var(74) == 0) then begin
      set_global_var(74, 1);
    end
    if (global_var(72) == 0) then begin
      set_global_var(72, 1);
    end
    if (global_var(75) == 0) then begin
      set_global_var(75, 1);
    end
    if (get_critter_stat(dude_obj, 34) == 1) then begin
      gsay_reply(595, 103);
    end
    else begin
      gsay_reply(595, 104);
    end
    giq_option(4, 595, 105, Keri02, 50);
    giq_option(-3, 595, 106, Keri02, 50);
  Keri02: |
    variable LVar0 := 0;
    call RecalcDateString;
    LVar0 := local_var(9);
    if (LVar0 == get_day) then begin
      gsay_reply(595, message_str(595, 107) + message_str(595, 108));
    end
    else begin
      gsay_reply(595, message_str(595, 107) + message_str(595, 109) + DayString + message_str(595, 112));
    end
    call Keri04;
  Keri03: |
    variable LVar0 := 0;
    if (local_var(1) != 1) then begin
      call RecalcDateString;
      LVar0 := local_var(9);
      if (LVar0 == get_day) then begin
        gsay_reply(595, message_str(595, 113));
      end
      else begin
        gsay_reply(595, message_str(595, 114) + DayString + message_str(595, 117));
      end
      call Keri04;
    end
    else begin
      gsay_reply(595, 118);
      call Keri04;
    end
  Keri04: |
    giq_option(4, 595, 119, Keri04a, 50);
    giq_option(4, 595, 120, Keri05, 50);
    if ((get_critter_stat(dude_obj, 34) == 0) and (local_var(14) == 0)) then begin
      giq_option(4, 595, 121, Keri04b, 50);
    end
    giq_option(4, 595, 122, Keri06, 50);
    giq_option(-3, 595, 123, Keri07, 50);
  Keri04a: |
    variable LVar0 := 0;
    set_local_var(13, 1);
    call RecalcDate;
    LVar0 := local_var(9);
    if (LVar0 == get_day) then begin
      call Keri17;
    end
    else begin
      call Keri18;
    end
  Keri04b: |
    variable LVar0 := 0;
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      call Keri08;
    end
    else begin
      LVar0 := get_critter_stat(dude_obj, 3);
      if (LVar0 <= 6) then begin
        call Keri16;
      end
      else begin
        if (is_success(do_check(dude_obj, 3, 0))) then begin
          call Keri09;
        end
        else begin
          call Keri16;
        end
      end
    end
  Keri05: |
    set_local_var(13, 0);
    gsay_message(595, 124, 50);
  Keri06: |
    set_local_var(13, 0);
    gsay_message(595, 126, 50);
  Keri07: 'gsay_message(595, 127, 50);

    '
  Keri08: |
    variable LVar0 := 0;
    set_local_var(14, 1);
    gsay_message(595, 130, 50);
    gfade_out(600);
    game_time_advance(game_ticks(60 * 60 * 2));
    gfade_in(600);
    LVar0 := create_object_sid(53, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(87, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(110, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    display_msg(message_str(595, 229));
    gsay_message(595, 131, 50);
    gsay_message(595, 132, 50);
  Keri09: |
    variable LVar0 := 0;
    set_local_var(14, 1);
    gsay_message(595, 133, 50);
    gfade_out(600);
    game_time_advance(game_ticks(60 * 60 * 2));
    gfade_in(600);
    LVar0 := create_object_sid(53, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(87, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(110, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    display_msg(message_str(595, 229));
    gsay_message(595, 131, 50);
    gsay_message(595, 132, 50);
  Keri10: |
    if (local_var(5) == 0) then begin
      set_local_var(5, 1);
      set_map_var(25, 1);
      gsay_reply(595, 136);
      giq_option(4, 595, 137, Keri10a, 50);
      giq_option(4, 595, 138, KeriCombat, 51);
      giq_option(4, 595, 139, KeriCombat, 51);
      giq_option(-3, 595, 141, KeriCombat, 51);
    end
    else begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        float_msg(self_obj, message_str(595, 143), 2);
      end
      else begin
        float_msg(self_obj, message_str(595, 142), 2);
      end
      call KeriCombat;
    end
  Keri10a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call Keri11;
    end
    else begin
      call Keri12;
    end
  Keri11: 'gsay_message(595, 144, 50);

    '
  Keri12: |
    gsay_reply(595, 145);
    call KeriCombat;
  Keri13: |
    float_msg(self_obj, message_str(595, 148), 2);
    call KeriCombat;
  Keri14: |
    float_msg(self_obj, message_str(595, random(149, 150)), 2);
    call KeriCombat;
  Keri15: |
    if (local_var(6) != 3) then begin
      float_msg(self_obj, message_str(595, 151 + local_var(6)), 2);
      set_local_var(6, local_var(6) + 1);
    end
    else begin
      float_msg(self_obj, message_str(595, 154), 2);
    end
  Keri16: 'gsay_message(595, 155, 50);

    '
  Keri17: |
    gsay_reply(595, 156);
    call Keri33;
    call Keri20;
  Keri18: |
    call RecalcDateString;
    gsay_reply(595, message_str(595, 157) + DayString + message_str(595, 158));
    giq_option(4, 595, 159, Keri30, 50);
    giq_option(4, 595, 160, Keri34, 50);
  Keri19: |
    if (get_critter_stat(dude_obj, 34) == 1) then begin
      float_msg(self_obj, message_str(595, 161), 2);
    end
    else begin
      float_msg(self_obj, message_str(595, 162), 2);
    end
  Keri20: |
    giq_option(4, 595, 163, Keri21a, 50);
    giq_option(4, 595, 164, Keri21b, 50);
    giq_option(4, 595, 165, Keri21c, 50);
    giq_option(4, 595, 166, Keri21d, 50);
    giq_option(4, 595, 167, Keri34, 50);
  Keri21a: |
    variable LVar0 := 0;
    set_global_var(199, 1);
    LVar0 := random(1, 8);
    if (LVar0 == 1) then begin
      gsay_message(595, 168, 50);
    end
    else begin
      if (LVar0 == 2) then begin
        gsay_message(595, 169, 50);
      end
      else begin
        if (LVar0 == 3) then begin
          gsay_message(595, 170, 50);
        end
        else begin
          if (LVar0 == 4) then begin
            gsay_message(595, 171, 50);
          end
          else begin
            if (LVar0 == 5) then begin
              gsay_message(595, 172, 50);
            end
            else begin
              if (LVar0 == 6) then begin
                gsay_message(595, 173, 50);
              end
              else begin
                if (LVar0 == 7) then begin
                  gsay_message(595, 174, 50);
                end
                else begin
                  if (LVar0 == 8) then begin
                    gsay_message(595, 175, 50);
                  end
                end
              end
            end
          end
        end
      end
    end
    load_map(59, 3);
  Keri21b: |
    variable LVar0 := 0;
    set_global_var(199, 1);
    LVar0 := random(1, 7);
    if (LVar0 == 1) then begin
      gsay_message(595, 168, 50);
    end
    else begin
      if (LVar0 == 2) then begin
        gsay_message(595, 169, 50);
      end
      else begin
        if (LVar0 == 3) then begin
          gsay_message(595, 170, 50);
        end
        else begin
          if (LVar0 == 4) then begin
            gsay_message(595, 171, 50);
          end
          else begin
            if (LVar0 == 5) then begin
              gsay_message(595, 176, 50);
            end
            else begin
              if (LVar0 == 6) then begin
                gsay_message(595, 177, 50);
              end
              else begin
                if (LVar0 == 7) then begin
                  gsay_message(595, 178, 50);
                end
              end
            end
          end
        end
      end
    end
    load_map(58, 3);
  Keri21c: |
    variable LVar0 := 0;
    set_global_var(199, 1);
    LVar0 := random(1, 7);
    if (LVar0 == 1) then begin
      gsay_message(595, 168, 50);
    end
    else begin
      if (LVar0 == 2) then begin
        gsay_message(595, 169, 50);
      end
      else begin
        if (LVar0 == 3) then begin
          gsay_message(595, 170, 50);
        end
        else begin
          if (LVar0 == 4) then begin
            gsay_message(595, 171, 50);
          end
          else begin
            if (LVar0 == 5) then begin
              gsay_message(595, 179, 50);
            end
            else begin
              if (LVar0 == 6) then begin
                gsay_message(595, 180, 50);
              end
              else begin
                if (LVar0 == 7) then begin
                  gsay_message(595, 181, 50);
                end
              end
            end
          end
        end
      end
    end
    load_map(57, 3);
  Keri21d: |
    variable LVar0 := 0;
    set_global_var(199, 1);
    LVar0 := random(1, 7);
    if (LVar0 == 1) then begin
      gsay_message(595, 168, 50);
    end
    else begin
      if (LVar0 == 2) then begin
        gsay_message(595, 169, 50);
      end
      else begin
        if (LVar0 == 3) then begin
          gsay_message(595, 170, 50);
        end
        else begin
          if (LVar0 == 4) then begin
            gsay_message(595, 171, 50);
          end
          else begin
            if (LVar0 == 5) then begin
              gsay_message(595, 182, 50);
            end
            else begin
              if (LVar0 == 6) then begin
                gsay_message(595, 183, 50);
              end
              else begin
                if (LVar0 == 7) then begin
                  gsay_message(595, 184, 50);
                end
              end
            end
          end
        end
      end
    end
    load_map(56, 3);
  Keri27: |
    gsay_reply(595, 198);
    giq_option(4, 595, 199, Keri04a, 50);
    giq_option(4, 595, 200, Keri05, 50);
    giq_option(4, 595, 201, Keri06, 50);
    giq_option(-3, 595, 202, Keri07, 50);
    giq_option(-3, 595, 203, Keri07, 50);
  Keri28: |
    gsay_reply(595, 204);
    giq_option(4, 595, 205, Keri17, 50);
    giq_option(4, 595, 206, KeriEnd, 50);
    giq_option(-3, 595, 207, Keri07, 50);
  Keri29: |
    variable LVar0 := 0;
    call RecalcDateString;
    LVar0 := local_var(9);
    gsay_message(595, message_str(595, 209) + DayString + message_str(595, 212), 50);
  Keri30: 'set_local_var(13, 1);

    '
  Keri33: |
    variable LVar0 := 0;
    set_local_var(13, 0);
    set_global_var(204, 1);
    LVar0 := local_var(12);
    set_local_var(12, LVar0 + 1);
  Keri34: 'set_local_var(13, 0);

    '
  Keri35: |
    gsay_reply(595, 185);
    giq_option(4, 595, 186, KeriCombat, 51);
    giq_option(4, 595, 187, Keri36, 50);
    giq_option(4, 595, 188, KeriEnd, 50);
    giq_option(-3, 595, 189, KeriEnd, 50);
    giq_option(-3, 595, 190, KeriEnd, 50);
  Keri36: |
    gsay_reply(595, 191);
    giq_option(4, 595, 192, Keri37, 50);
    giq_option(4, 595, 193, Keri38, 50);
    giq_option(4, 595, 194, Keri39, 50);
  Keri37: 'gsay_message(595, 195, 50);

    '
  Keri38: 'gsay_message(595, 196, 50);

    '
  Keri39: 'gsay_message(595, 197, 50);

    '
  KeriEnd: "[]"
  KeriCombat: |
    set_map_var(24, 1);
    set_map_var(25, 1);
    call combat;
  RecalcDate: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    LVar0 := get_day;
    if (LVar0 <= 3) then begin
      LVar0 := 3;
      LVar1 := get_month;
      LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
    end
    else begin
      if ((LVar0 > 3) and (LVar0 <= 17)) then begin
        LVar0 := 17;
        LVar1 := get_month;
        LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
      end
      else begin
        if (LVar0 > 17) then begin
          LVar0 := 3;
          LVar1 := get_month;
          if (LVar1 == 12) then begin
            LVar1 := 1;
            LVar2 := (game_time / (10 * 60 * 60 * 24 * 365)) + 1;
          end
          else begin
            LVar1 := LVar1 + 1;
            LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
          end
        end
      end
    end
    set_local_var(9, LVar0);
    set_local_var(10, LVar1);
    set_local_var(11, LVar2);
  RecalcDateString: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    call RecalcDate;
    LVar0 := local_var(10);
    LVar1 := local_var(9);
    if (LVar0 == 1) then begin
      DayString := message_str(595, 217);
    end
    else begin
      if (LVar0 == 2) then begin
        DayString := message_str(595, 218);
      end
      else begin
        if (LVar0 == 3) then begin
          DayString := message_str(595, 219);
        end
        else begin
          if (LVar0 == 4) then begin
            DayString := message_str(595, 220);
          end
          else begin
            if (LVar0 == 5) then begin
              DayString := message_str(595, 221);
            end
            else begin
              if (LVar0 == 6) then begin
                DayString := message_str(595, 222);
              end
              else begin
                if (LVar0 == 7) then begin
                  DayString := message_str(595, 223);
                end
                else begin
                  if (LVar0 == 8) then begin
                    DayString := message_str(595, 224);
                  end
                  else begin
                    if (LVar0 == 9) then begin
                      DayString := message_str(595, 225);
                    end
                    else begin
                      if (LVar0 == 10) then begin
                        DayString := message_str(595, 226);
                      end
                      else begin
                        if (LVar0 == 11) then begin
                          DayString := message_str(595, 227);
                        end
                        else begin
                          if (LVar0 == 12) then begin
                            DayString := message_str(595, 228);
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    if (LVar1 == 3) then begin
      DayString := DayString + message_str(595, 210);
    end
    else begin
      if (LVar1 == 17) then begin
        DayString := DayString + message_str(595, 211);
      end
    end
  SendAroundHouse: |
    variable LVar0 := 0;
    Destination := 0;
    LVar0 := random(10, 20);
    while(Destination == 0) do begin
      Destination := random(1, 3);
      if (Destination == 1) then begin
        Destination := 12127;
      end
      else begin
        if (Destination == 2) then begin
          Destination := 12126;
        end
        else begin
          if (Destination == 3) then begin
            Destination := 11927;
          end
        end
      end
      if (Destination == LastMove) then begin
        Destination := 0;
      end
    end
    LastMove := Destination;
    reg_anim_func(2, self_obj);
    reg_anim_func(1, 1);
    reg_anim_obj_move_to_tile(self_obj, Destination, -1);
    reg_anim_func(3, 0);
    rm_timer_event(self_obj);
    add_timer_event(self_obj, game_ticks(LVar0), 1);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
kildoor1:
  start: "[]"
  damage_p_proc: 'destroy_object(self_obj);

    '
  map_enter_p_proc: |
    if ((game_time_hour >= 1900) or (game_time_hour < 700)) then begin
      obj_close(self_obj);
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
    obj_close(self_obj);
    set_local_var(0, 0);
  map_update_p_proc: |
    if ((game_time_hour >= 1900) or (game_time_hour < 700) and (local_var(0) == 0)) then begin
      obj_close(self_obj);
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
  use_p_proc: |
    if (obj_is_locked(self_obj)) then begin
      script_overrides;
      display_msg(message_str(873, 100));
    end
    else begin
      if ((game_time_hour >= 1900) or (game_time_hour < 700)) then begin
        set_map_var(8, 1);
      end
    end
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 84) then begin
      script_overrides;
      set_map_var(8, 1);
      if (not(obj_is_locked(self_obj))) then begin
        display_msg(message_str(873, 104));
      end
      else begin
        GVar0 := roll_vs_skill(source_obj, 9, 0);
        if (is_success(GVar0)) then begin
          display_msg(message_str(873, 101));
          obj_unlock(self_obj);
          set_local_var(0, 1);
        end
        else begin
          if (is_critical(GVar0)) then begin
            display_msg(message_str(873, 103));
            jam_lock(self_obj);
          end
          else begin
            display_msg(message_str(873, 102));
          end
        end
      end
    end
  use_skill_on_p_proc: |
    if (action_being_used == 9) then begin
      script_overrides;
      set_map_var(8, 1);
      if (not(obj_is_locked(self_obj))) then begin
        display_msg(message_str(873, 104));
      end
      else begin
        GVar0 := roll_vs_skill(source_obj, 9, -20);
        if (is_success(GVar0)) then begin
          display_msg(message_str(873, 101));
          obj_unlock(self_obj);
          set_local_var(0, 1);
        end
        else begin
          if (is_critical(GVar0)) then begin
            display_msg(message_str(873, 103));
            jam_lock(self_obj);
          end
          else begin
            display_msg(message_str(873, 102));
          end
        end
      end
    end
killian:
  start: "[]"
  critter_p_proc: |
    if (global_var(247) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    else begin
      if (GVar8) then begin
        GVar8 := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      else begin
        if ((game_time_hour >= GVar13) or (game_time_hour < 700) and (tile_distance_objs(self_obj, dude_obj) < 12) and obj_can_see_obj(self_obj, dude_obj) and (cur_map_index == 12)) then begin
          GVar5 := 1;
          GVar7 := 1;
          dialogue_system_enter;
        end
        if (map_var(9) == 1) then begin
          if ((cur_map_index == 12) and (local_var(7) == 0) and (tile_distance_objs(self_obj, dude_obj) < 12) and obj_can_see_obj(self_obj, dude_obj)) then begin
            set_map_var(9, 0);
            GVar5 := 1;
            GVar7 := 1;
            dialogue_system_enter;
          end
          else begin
            GVar5 := 0;
            GVar7 := 0;
            set_map_var(9, 0);
          end
        end
        if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 12) and map_var(2) and (cur_map_index == 12)) then begin
          dialogue_system_enter;
        end
        call sleeping;
        if ((game_time_hour >= GVar12) and (game_time_hour < GVar13) and (local_var(7) == 0)) then begin
          if (tile_num(self_obj) != GVar14) then begin
            animate_move_obj_to_tile(self_obj, GVar14, 0);
          end
          else begin
            if (has_trait(1, self_obj, 10) != 2) then begin
              anim(self_obj, 1000, 2);
            end
          end
        end
        if (Killian_barter_var != 0) then begin
          if ((local_var(7) == 0) and (cur_map_index == 12)) then begin
            if (tile_distance_objs(self_obj, dude_obj) < 12) then begin
              dialogue_system_enter;
            end
            else begin
              animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 1), 0);
            end
          end
          else begin
            Killian_barter_var := 0;
          end
        end
      end
    end
  destroy_p_proc: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(56, 0, 0, -1);
    add_obj_to_inven(self_obj, LVar0);
    set_global_var(37, 1);
    Killian_ptr := 0;
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
      set_global_var(155, global_var(155) - 5);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    if (global_var(105) == 1) then begin
      set_global_var(105, 2);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(47, 100));
  map_enter_p_proc: |
    remove_dude := 0;
    GVar15 := 27896;
    GVar13 := 1900;
    GVar12 := 650;
    GVar14 := 25683;
    Killian_ptr := self_obj;
    if (global_var(37) == 1) then begin
      destroy_object(self_obj);
    end
    else begin
      if (cur_map_index == 11) then begin
        if (global_var(38) == 1) then begin
          destroy_object(self_obj);
        end
        else begin
          critter_add_trait(self_obj, 1, 6, 0);
          float_msg(self_obj, message_str(47, 271), 3);
        end
      end
      else begin
        critter_add_trait(self_obj, 1, 6, 12);
        if (not(metarule(22, 0)) and (item_caps_total(self_obj) == 0)) then begin
          item_caps_adjust(self_obj, random(10, 150));
        end
        if (global_var(625) == 1) then begin
          set_obj_visibility(self_obj, 1);
        end
        else begin
          set_obj_visibility(self_obj, 0);
        end
      end
    end
  pickup_p_proc: |
    GVar5 := 1;
    GVar6 := 1;
    GVar7 := 0;
    dialogue_system_enter;
  talk_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    call get_stuff_from_safe;
    if ((local_var(7) == 1) and (GVar7 == 0) and not(Killian_barter_var == -1)) then begin
      float_msg(self_obj, message_str(185, 166), 0);
    end
    else begin
      if ((global_var(42) != 1) and (global_var(41) != 1) and (global_var(38) == 1) and (local_var(9) == 0)) then begin
        call Killian89;
      end
      else begin
        call get_reaction;
        if (Killian_barter_var >= 0) then begin
          if (Killian_barter_var == 1) then begin
            move_obj_inven_to_obj(Killian_store1_ptr, self_obj);
          end
          else begin
            if (Killian_barter_var == 2) then begin
              move_obj_inven_to_obj(Killian_store2_ptr, self_obj);
            end
            else begin
              if (Killian_barter_var == 3) then begin
                move_obj_inven_to_obj(Killian_store3_ptr, self_obj);
              end
            end
          end
        end
        start_gdialog(47, self_obj, 4, 10, 7);
        gsay_start;
        if (GVar5) then begin
          if (GVar6) then begin
            call Killian30;
          end
          else begin
            GVar6 := 1;
            if (GVar7) then begin
              call Killian31;
            end
            else begin
              call Killian29;
            end
          end
        end
        else begin
          if (Killian_barter_var == -1) then begin
            set_local_var(8, local_var(8) + 1);
            Killian_barter_var := 0;
            if (local_var(8) == 1) then begin
              call Killian42;
            end
            else begin
              if (local_var(8) == 2) then begin
                call Killian43;
              end
              else begin
                if (local_var(8) == 3) then begin
                  call Killian44;
                end
                else begin
                  call Killian30;
                end
              end
            end
          end
          else begin
            if (Killian_barter_var != 0) then begin
              gsay_reply(47, 115);
              giq_option(4, 47, 118, Killian_barter, 50);
              giq_option(4, 47, 121, Killianx, 50);
              giq_option(-3, 47, 110, Killian_barter, 50);
              giq_option(-3, 47, 122, Killianx, 50);
            end
            else begin
              if (map_var(2) == 1) then begin
                call Killian47;
              end
              else begin
                if (map_var(2) == 2) then begin
                  call gizmo0;
                end
                else begin
                  if (local_var(5) == 1) then begin
                    if ((global_var(42) == 1) or (global_var(41) == 1) and (map_var(6) == 0)) then begin
                      call Killian54;
                    end
                    else begin
                      if (local_var(1) >= 2) then begin
                        call Killian24;
                      end
                      else begin
                        call Killian26;
                      end
                    end
                  end
                  else begin
                    call Killian01;
                  end
                end
              end
            end
          end
        end
        gsay_end;
        end_dialogue;
      end
    end
    if ((map_var(5) == 1) and (local_var(7) == 0) and (global_var(39) == 0)) then begin
      LVar1 := create_object_sid(16777528, 0, 0, 510);
      GVar9 := create_object_sid(10, 0, 0, -1);
      add_obj_to_inven(LVar1, GVar9);
      critter_add_trait(LVar1, 1, 6, 13);
      critter_add_trait(LVar1, 1, 5, 1);
      critter_attempt_placement(LVar1, 28283, 0);
      set_map_var(5, 2);
    end
    if (map_var(6) == 1) then begin
      set_map_var(6, 2);
      display_msg(message_str(47, 270));
      give_exp_points(500);
    end
    call put_stuff_in_safe;
    if (Killian_barter_var >= 0) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 18);
      rm_obj_from_inven(self_obj, LVar0);
      if (Killian_barter_var == 1) then begin
        move_obj_inven_to_obj(self_obj, Killian_store1_ptr);
      end
      else begin
        if (Killian_barter_var == 2) then begin
          move_obj_inven_to_obj(self_obj, Killian_store2_ptr);
        end
        else begin
          if (Killian_barter_var == 3) then begin
            move_obj_inven_to_obj(self_obj, Killian_store3_ptr);
          end
        end
      end
      Killian_barter_var := 0;
      add_obj_to_inven(self_obj, LVar0);
    end
    if (GVar10) then begin
      set_global_var(155, global_var(155) - 1);
      GVar10 := 0;
      load_map(10, 6);
    end
    if (remove_dude) then begin
      remove_dude := 0;
      move_to(dude_obj, 28083, elevation(self_obj));
    end
  KillianCbt: 'GVar8 := 1;

    '
  Killian0a: |
    gsay_reply(47, 109);
    gsay_option(47, 110, Killian21, 50);
    gsay_option(47, 111, Killianx, 50);
  Killian01: |
    set_local_var(5, 1);
    if ((map_var(5) == 0) and (global_var(38) == 0) and (map_var(6) == 0) and (global_var(36) == 0)) then begin
      set_map_var(5, 1);
    end
    if (local_var(1) == 3) then begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        gsay_reply(47, 112);
      end
      else begin
        gsay_reply(47, 113);
      end
    end
    else begin
      if (local_var(1) == 1) then begin
        gsay_reply(47, 114);
      end
      else begin
        gsay_reply(47, 115);
      end
    end
    call killian00;
  Killian02: |
    set_local_var(4, 1);
    gsay_reply(47, 123);
    giq_option(4, 47, message_str(47, 124) + proto_data(obj_pid(dude_obj), 1) + message_str(47, 125), Killian02b, 50);
    giq_option(4, 47, message_str(47, 126) + proto_data(obj_pid(dude_obj), 1) + message_str(47, 127), Killian03, 50);
    giq_option(5, 47, 128, Killian02a, 51);
  Killian03: |
    gsay_reply(47, 129);
    giq_option(4, 47, 130, Killian05, 51);
    giq_option(6, 47, 131, Killian03aa, 50);
    giq_option(5, 47, 132, Killian03ba, 50);
    giq_option(5, 47, 133, Killian03ca, 51);
  Killian03a: |
    gsay_message(47, 134, 50);
    call Killian08;
  Killian04: |
    gsay_message(47, 135, 50);
    call killian00;
  Killian05: |
    gsay_reply(47, 136);
    giq_option(4, 47, 137, Killian06, 49);
    giq_option(5, 47, 138, Killian04, 49);
  Killian06: |
    gsay_reply(47, 139);
    call killian00;
  Killian08: |
    gsay_reply(47, 140);
    giq_option(5, 47, 141, Killian09, 50);
    giq_option(4, 47, 142, killian00, 50);
  Killian09: |
    if (not(global_var(73))) then begin
      set_global_var(73, 1);
    end
    if (not(global_var(72))) then begin
      set_global_var(72, 1);
    end
    gsay_reply(47, 143);
    giq_option(5, 47, 144, Killian10, 50);
    giq_option(5, 47, 145, Killian09a, 51);
    giq_option(4, 47, 146, Killianx, 50);
  Killian09a: |
    call DownReactLevel;
    call Killian04;
  Killian10: |
    if (local_var(1) >= 2) then begin
      gsay_reply(47, 147);
    end
    else begin
      gsay_reply(47, 148);
    end
    call killian00;
  Killian11: |
    gsay_reply(47, 149);
    giq_option(4, 47, 150, Killian12, 50);
    giq_option(5, 47, 151, Killian13, 50);
    giq_option(6, 47, 152, Killian08, 50);
    giq_option(4, 47, 153, Killian11a, 50);
  Killian11a: |
    gsay_reply(47, " ");
    call killian00;
  Killian12: |
    gsay_reply(47, 154);
    call killian00;
  Killian13: |
    gsay_reply(47, 155);
    giq_option(4, 47, 156, Killian13b, 50);
    giq_option(6, 47, 157, Killian13a, 51);
  Killian13a: |
    call DownReactLevel;
    call Killian14;
  Killian13b: |
    gsay_reply(0, 0);
    call killian00;
  Killian14: |
    gsay_reply(47, 158);
    giq_option(4, 47, 159, Killian15, 50);
    giq_option(6, 47, 160, Killian16, 51);
  Killian15: |
    gsay_reply(47, 161);
    call killian00;
  Killian16: 'gsay_message(47, 162, 51);

    '
  Killian21: |
    gsay_reply(47, 163);
    giq_option(0, 634, 106, Killian_barter, 50);
  Killian22: 'gsay_message(47, 164, 50);

    '
  Killian23: 'gsay_message(47, 165, 50);

    '
  Killian24: |
    gsay_reply(47, 166);
    call killian00;
  Killian26: |
    gsay_reply(47, 167);
    call killian00;
  Killian29: 'gsay_message(47, 170, 50);

    '
  Killian30: |
    GVar5 := 0;
    GVar6 := 0;
    gsay_reply(47, 171);
    call Killianx1;
  Killian31: |
    GVar5 := 0;
    GVar7 := 0;
    gsay_reply(47, 172);
    giq_option(4, 47, 173, Killian34, 50);
    giq_option(5, 47, 174, Killian32, 50);
    giq_option(4, 47, 175, Killian35, 50);
    giq_option(-3, 47, 122, Killianx2, 50);
  Killian32: |
    gsay_reply(47, 176);
    giq_option(4, 47, 177, Killian32a, 51);
    giq_option(5, 47, 178, KillianCbt, 51);
  Killian34: |
    gsay_reply(47, 179);
    giq_option(4, 47, 180, Killianx2, 50);
    giq_option(5, 47, 181, KillianCbt, 51);
  Killian35: |
    gsay_reply(47, 182);
    call Killianx1;
  Killian42: |
    gsay_message(47, 191, 50);
    call Killianx;
  Killian43: |
    gsay_message(47, 192, 50);
    call Killianx;
  Killian44: |
    gsay_reply(47, 193);
    call Killianx1;
  Killian47: |
    set_map_var(2, 0);
    gsay_reply(47, 198);
    giq_option(4, 47, 199, Killian48, 50);
    giq_option(4, 47, 200, Killian50, 50);
    giq_option(4, 47, 201, Killian90, 49);
    giq_option(-3, 47, 110, Killian90, 49);
    giq_option(-3, 47, 111, Killian52, 50);
  Killian48: |
    gsay_reply(47, 202);
    giq_option(4, 47, 203, Killian49, 50);
    giq_option(4, 47, 204, Killian51, 50);
    giq_option(6, 47, 205, Killian52, 50);
  Killian49: |
    gsay_reply(47, 206);
    giq_option(4, 47, 207, Killian50, 50);
    giq_option(5, 47, 208, Killian51, 50);
    giq_option(4, 47, 209, Killian52, 50);
  Killian50: |
    gsay_reply(47, 210);
    giq_option(4, 47, 211, Killian53, 50);
    giq_option(4, 47, 212, Killian52, 50);
    giq_option(5, 47, 213, Killian51, 50);
  Killian51: |
    gsay_reply(47, 214);
    giq_option(4, 47, 215, Killian53, 50);
    giq_option(4, 47, 216, Killian52, 51);
  Killian52: |
    set_global_var(104, 2);
    set_map_var(6, 2);
    gsay_message(47, 217, 51);
    set_global_var(348, 1);
    call Killianx1;
  Killian53: |
    gsay_message(47, 218, 50);
    call Killianx4;
  Killian54: |
    gsay_reply(47, 219);
    giq_option(4, 47, 220, Killian55, 50);
    giq_option(-3, 47, 111, Killian55, 50);
    if ((global_var(41) == 1) or (global_var(42) == 1)) then begin
      giq_option(4, 47, 221, Killian56, 49);
      giq_option(-3, 47, 110, Killian56, 49);
    end
  Killian55: |
    gsay_message(47, 222, 50);
    call Killianx;
  Killian56: |
    gsay_reply(47, 223);
    if (global_var(41)) then begin
      giq_option(4, 47, 224, Killian57, 50);
      giq_option(-3, 47, 108, Killian57, 50);
    end
    if (global_var(42)) then begin
      giq_option(4, 47, 225, Killian58, 50);
    end
  Killian57: |
    gsay_message(47, 226, 49);
    call soundcheck;
  Killian58: |
    gsay_message(47, 228, 49);
    call playback;
  Killian59: |
    if (map_var(6) == 0) then begin
      set_map_var(6, 1);
    end
    gsay_reply(47, 230);
    giq_option(4, 47, 231, Killian60, 50);
    giq_option(4, 47, 232, Killian61, 50);
    giq_option(5, 47, 233, Killian64, 50);
    giq_option(-3, 47, 110, Killian60, 50);
    giq_option(-3, 47, 111, Killian64, 50);
  Killian60: |
    set_local_var(1, 3);
    call LevelToReact;
    set_global_var(104, 1);
    gsay_message(47, 234, 49);
    call Killianx;
  Killian61: |
    gsay_reply(47, 235);
    giq_option(4, 47, 236, Killian62, 50);
    giq_option(4, 47, 237, Killian63, 50);
  Killian62: |
    set_global_var(104, 1);
    gsay_message(47, 238, 50);
    call Killianx;
  Killian63: |
    gsay_reply(47, 239);
    giq_option(4, 47, 240, Killian62, 50);
    giq_option(4, 47, 241, Killian63a, 51);
  Killian64: |
    gsay_message(47, 242, 50);
    call Killianx;
  Killian88: |
    gsay_reply(47, 243);
    giq_option(4, 47, 273, Killianx, 50);
    giq_option(4, 47, 274, KillianCbt, 51);
    giq_option(4, 47, 275, Killian48, 49);
  Killian89: |
    set_local_var(9, 1);
    set_map_var(2, 0);
    float_msg(self_obj, message_str(47, 284), 0);
  Killian90: |
    gsay_reply(47, 165);
    giq_option(1, 634, 106, Killian53, 49);
  Killianx: "[]"
  Killianx1: |
    giq_option(4, 47, 183, Killianx3, 50);
    giq_option(4, 47, 184, KillianCbt, 51);
    giq_option(-3, 47, 108, KillianCbt, 51);
  Killianx2: |
    if ((game_time_hour >= GVar13) or (game_time_hour < 700)) then begin
      remove_dude := 1;
    end
  Killianx3: 'GVar10 := 1;

    '
  Killianx4: |
    GVar9 := create_object_sid(57, 0, 0, -1);
    add_obj_to_inven(dude_obj, GVar9);
    if (get_critter_stat(dude_obj, 4) > 3) then begin
      GVar9 := create_object_sid(104, 0, 0, -1);
      add_obj_to_inven(dude_obj, GVar9);
    end
    set_global_var(36, 1);
    set_global_var(635, 1);
  Killian_barter: |
    gdialog_mod_barter(0);
    gsay_reply(47, " ");
    giq_option(0, 634, 108, Killianx, 50);
  Killian_give_stuff: |
    set_global_var(635, 2);
    if (obj_is_carrying_obj_pid(dude_obj, 104)) then begin
      destroy_object(obj_carrying_pid_obj(dude_obj, 104));
    end
    if (obj_is_carrying_obj_pid(dude_obj, 57)) then begin
      destroy_object(obj_carrying_pid_obj(dude_obj, 57));
    end
    giq_option(4, 47, 276, Killian_give_shotgun, 49);
    giq_option(4, 47, 277, Killian_give_armor, 49);
    giq_option(4, 47, 278, Killian_give_doctor_bag, 49);
    giq_option(4, 47, 279, Killian_give_stimpaks, 49);
    giq_option(4, 47, 280, Killian59, 49);
    giq_option(-3, 47, 111, Killian59, 49);
  Killian_give_shotgun: |
    GVar9 := create_object_sid(94, 0, 0, -1);
    add_obj_to_inven(dude_obj, GVar9);
    GVar9 := create_object_sid(95, 0, 0, -1);
    add_mult_objs_to_inven(dude_obj, GVar9, 5);
    call Killian59;
  Killian_give_armor: |
    GVar9 := create_object_sid(1, 0, 0, -1);
    add_obj_to_inven(dude_obj, GVar9);
    call Killian59;
  Killian_give_doctor_bag: |
    GVar9 := create_object_sid(91, 0, 0, -1);
    add_obj_to_inven(dude_obj, GVar9);
    call Killian59;
  Killian_give_stimpaks: |
    GVar9 := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(dude_obj, GVar9, 5);
    call Killian59;
  soundcheck: |
    gsay_reply(47, 227);
    call Killian_give_stuff;
  playback: |
    gsay_reply(47, 229);
    call Killian_give_stuff;
  Killian02a: |
    call DownReactLevel;
    call Killian16;
  Killian02b: |
    gsay_reply(0, 0);
    call killian00;
  Killian03aa: |
    call DownReactLevel;
    call Killian04;
  Killian03ba: 'call Killian03a;

    '
  Killian03ca: |
    call DownReactLevel;
    call Killian16;
  Killian32a: |
    call DownReactLevel;
    call Killianx2;
  Killian63a: |
    call DownReactLevel;
    call Killian64;
  get_stuff_from_safe: |
    variable LVar0 := 0;
    if (item_caps_total(KillSafe_ptr) != 0) then begin
      item_caps_adjust(self_obj, item_caps_total(KillSafe_ptr));
      item_caps_adjust(KillSafe_ptr, -item_caps_total(KillSafe_ptr));
    end
    if (obj_is_carrying_obj_pid(KillSafe_ptr, 18) != 0) then begin
      GVar9 := obj_carrying_pid_obj(KillSafe_ptr, 18);
      rm_obj_from_inven(KillSafe_ptr, GVar9);
      add_obj_to_inven(self_obj, GVar9);
    end
    if (obj_is_carrying_obj_pid(KillSafe_ptr, 40) != 0) then begin
      GVar9 := obj_carrying_pid_obj(KillSafe_ptr, 40);
      rm_obj_from_inven(KillSafe_ptr, GVar9);
      add_obj_to_inven(self_obj, GVar9);
    end
    if (obj_is_carrying_obj_pid(KillSafe_ptr, 31) != 0) then begin
      GVar9 := obj_carrying_pid_obj(KillSafe_ptr, 31);
      rm_obj_from_inven(KillSafe_ptr, GVar9);
      add_obj_to_inven(self_obj, GVar9);
    end
    if (obj_is_carrying_obj_pid(KillSafe_ptr, 34) != 0) then begin
      GVar9 := obj_carrying_pid_obj(KillSafe_ptr, 34);
      rm_obj_from_inven(KillSafe_ptr, GVar9);
      add_obj_to_inven(self_obj, GVar9);
    end
    if (obj_is_carrying_obj_pid(KillSafe_ptr, 30) != 0) then begin
      GVar9 := obj_carrying_pid_obj(KillSafe_ptr, 30);
      rm_obj_from_inven(KillSafe_ptr, GVar9);
      add_obj_to_inven(self_obj, GVar9);
    end
    if (obj_is_carrying_obj_pid(KillSafe_ptr, 4) != 0) then begin
      GVar9 := obj_carrying_pid_obj(KillSafe_ptr, 4);
      rm_obj_from_inven(KillSafe_ptr, GVar9);
      add_obj_to_inven(self_obj, GVar9);
    end
  put_stuff_in_safe: |
    variable LVar0 := 0;
    if (item_caps_total(self_obj) != 0) then begin
      item_caps_adjust(KillSafe_ptr, item_caps_total(self_obj));
      item_caps_adjust(self_obj, -item_caps_total(self_obj));
    end
    if (obj_is_carrying_obj_pid(self_obj, 18) > 1) then begin
      GVar9 := obj_carrying_pid_obj(self_obj, 18);
      rm_obj_from_inven(self_obj, GVar9);
      add_obj_to_inven(KillSafe_ptr, GVar9);
    end
    if (obj_is_carrying_obj_pid(self_obj, 40) > 1) then begin
      GVar9 := obj_carrying_pid_obj(self_obj, 40);
      rm_obj_from_inven(self_obj, GVar9);
      add_obj_to_inven(KillSafe_ptr, GVar9);
    end
    if (obj_is_carrying_obj_pid(self_obj, 31) > 1) then begin
      GVar9 := obj_carrying_pid_obj(self_obj, 31);
      rm_obj_from_inven(self_obj, GVar9);
      add_obj_to_inven(KillSafe_ptr, GVar9);
    end
    if (obj_is_carrying_obj_pid(self_obj, 34) > 1) then begin
      GVar9 := obj_carrying_pid_obj(self_obj, 34);
      rm_obj_from_inven(self_obj, GVar9);
      add_obj_to_inven(KillSafe_ptr, GVar9);
    end
    if (obj_is_carrying_obj_pid(self_obj, 30) > 1) then begin
      GVar9 := obj_carrying_pid_obj(self_obj, 30);
      rm_obj_from_inven(self_obj, GVar9);
      add_obj_to_inven(KillSafe_ptr, GVar9);
    end
    if (obj_is_carrying_obj_pid(self_obj, 4) > 1) then begin
      GVar9 := obj_carrying_pid_obj(self_obj, 4);
      rm_obj_from_inven(self_obj, GVar9);
      add_obj_to_inven(KillSafe_ptr, GVar9);
    end
  sleeping: |
    if (local_var(7) == 1) then begin
      if (not(GVar11) and (game_time_hour >= GVar12) and (game_time_hour < GVar13) or (GVar11 and ((game_time_hour >= GVar12) or (game_time_hour < GVar13)))) then begin
        if (((game_time_hour - GVar12) < 10) and ((game_time_hour - GVar12) >= 0)) then begin
          if (tile_num(self_obj) != GVar14) then begin
            animate_move_obj_to_tile(self_obj, GVar14, 0);
          end
          else begin
            set_local_var(7, 0);
          end
        end
        else begin
          move_to(self_obj, GVar14, elevation(self_obj));
          if (tile_num(self_obj) == GVar14) then begin
            set_local_var(7, 0);
          end
        end
      end
    end
    else begin
      if (GVar11 and (game_time_hour >= GVar13) and (game_time_hour < GVar12) or (not(GVar11) and ((game_time_hour >= GVar13) or (game_time_hour < GVar12)))) then begin
        if (((game_time_hour - GVar13) < 10) and ((game_time_hour - GVar13) >= 0)) then begin
          if (tile_num(self_obj) != GVar15) then begin
            animate_move_obj_to_tile(self_obj, GVar15, 0);
          end
          else begin
            set_local_var(7, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != GVar15) then begin
            move_to(self_obj, GVar15, elevation(self_obj));
          end
          else begin
            set_local_var(7, 1);
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  killian00: |
    if (local_var(4) == 0) then begin
      giq_option(4, 47, 101, Killian02, 50);
    end
    giq_option(5, 47, 102, Killian11, 50);
    giq_option(5, 47, 103, Killian22, 50);
    giq_option(4, 47, 104, Killian21, 50);
    giq_option(5, 47, 105, Killian13, 50);
    if ((global_var(39) == 1) and (global_var(38) == 0) and (global_var(36) == 0)) then begin
      giq_option(4, 47, 272, Killian88, 50);
    end
    if ((global_var(36) == 1) and (global_var(38) == 0) and (map_var(6) == 0)) then begin
      giq_option(5, 47, 106, Killian23, 50);
    end
    giq_option(4, 47, 107, Killianx, 50);
    giq_option(-3, 47, 108, Killian0a, 50);
  gizmo0: |
    gsay_reply(47, 166);
    giq_option(1, 47, 1130, gizmo1, 50);
  gizmo1: |
    set_map_var(2, 0);
    gsay_reply(47, 1131);
    giq_option(4, 47, 199, Killian48, 50);
    giq_option(4, 47, 200, Killian50, 50);
    giq_option(4, 47, 201, Killian90, 49);
    giq_option(4, 47, 1132, Killianx, 50);
    giq_option(-3, 47, 110, Killian90, 49);
    giq_option(-3, 47, 111, Killian52, 50);
killsafe:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  description_p_proc: |
    script_overrides;
    if (obj_is_locked(self_obj)) then begin
      display_msg(message_str(340, 105));
    end
    else begin
      display_msg(message_str(340, 101));
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(340, 100));
  map_enter_p_proc: |
    KillSafe_ptr := self_obj;
    obj_close(self_obj);
    obj_lock(self_obj);
    if (local_var(0) == 0) then begin
      if (random(0, 3) == 3) then begin
        item := create_object_sid(40, 0, 0, -1);
        add_obj_to_inven(self_obj, item);
      end
      if (random(0, 3) == 3) then begin
        item := create_object_sid(31, 0, 0, -1);
        add_obj_to_inven(self_obj, item);
      end
      if (random(0, 3) == 3) then begin
        item := create_object_sid(30, 0, 0, -1);
        add_obj_to_inven(self_obj, item);
      end
      if (random(0, 3) == 3) then begin
        item := create_object_sid(34, 0, 0, -1);
        add_obj_to_inven(self_obj, item);
      end
      if (random(0, 3) == 3) then begin
        item := create_object_sid(4, 0, 0, -1);
        add_obj_to_inven(self_obj, item);
      end
    end
  pickup_p_proc: |
    if (obj_is_locked(self_obj)) then begin
      script_overrides;
    end
  use_p_proc: |
    if (obj_is_locked(self_obj)) then begin
      script_overrides;
      display_msg(message_str(340, 105));
      set_map_var(9, 1);
    end
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 84) then begin
      script_overrides;
      set_map_var(9, 1);
      if (not(obj_is_locked(self_obj))) then begin
        display_msg(message_str(340, 101));
      end
      else begin
        test := roll_vs_skill(dude_obj, 9, -10);
        if (is_success(test)) then begin
          obj_unlock(self_obj);
          display_msg(message_str(340, 103));
          call safe_bonus;
        end
        else begin
          if (is_critical(test)) then begin
            jam_lock(self_obj);
            display_msg(message_str(340, 107));
          end
          else begin
            display_msg(message_str(340, 104));
          end
        end
      end
    end
  use_skill_on_p_proc: |
    if (action_being_used == 9) then begin
      script_overrides;
      set_map_var(9, 1);
      if (not(obj_is_locked(self_obj))) then begin
        display_msg(message_str(340, 101));
      end
      else begin
        test := roll_vs_skill(dude_obj, 9, -30);
        if (is_success(test)) then begin
          obj_unlock(self_obj);
          display_msg(message_str(340, 103));
          call safe_bonus;
        end
        else begin
          if (is_critical(test)) then begin
            jam_lock(self_obj);
            display_msg(message_str(340, 107));
          end
          else begin
            display_msg(message_str(340, 104));
          end
        end
      end
    end
  safe_bonus: |
    if (local_var(0) == 0) then begin
      display_msg(message_str(340, 106));
      set_local_var(0, 1);
      give_exp_points(500);
    end
knighta:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 64);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
    if (script_action == 11) then begin
      call KnightARandom;
    end
  KnightARandom: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (not(LVar0)) then begin
      LVar0 := random(1, 8);
    end
    if (LVar0 > 8) then begin
      LVar0 := 1;
    end
    LVar1 := message_str(329, 101);
    if (LVar0 == 2) then begin
      LVar1 := message_str(329, 102);
    end
    else begin
      if (LVar0 == 3) then begin
        LVar1 := message_str(329, 103);
      end
      else begin
        if (LVar0 == 4) then begin
          LVar1 := message_str(329, 104);
        end
        else begin
          if (LVar0 == 5) then begin
            LVar1 := message_str(329, 105);
          end
          else begin
            if (LVar0 == 6) then begin
              LVar1 := message_str(329, 106);
            end
            else begin
              if (LVar0 == 7) then begin
                LVar1 := message_str(329, 107);
              end
              else begin
                if (LVar0 == 8) then begin
                  LVar1 := message_str(329, 108);
                end
                else begin
                  LVar0 := 1;
                end
              end
            end
          end
        end
      end
    end
    LVar0 := LVar0 + 1;
    float_msg(self_obj, LVar1, 0);
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: 'call KnightARandom;

    '
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(329, 100));
knightb:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 64);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  KnightBRandom: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (not(LVar0)) then begin
      LVar0 := random(1, 11);
    end
    if (LVar0 > 11) then begin
      LVar0 := 1;
    end
    LVar1 := message_str(330, 101);
    if (LVar0 == 2) then begin
      LVar1 := message_str(330, 102);
    end
    else begin
      if (LVar0 == 3) then begin
        LVar1 := message_str(330, 103);
      end
      else begin
        if (LVar0 == 4) then begin
          LVar1 := message_str(330, 104);
        end
        else begin
          if (LVar0 == 5) then begin
            LVar1 := message_str(330, 105);
          end
          else begin
            if (LVar0 == 6) then begin
              LVar1 := message_str(330, 106);
            end
            else begin
              if (LVar0 == 7) then begin
                LVar1 := message_str(330, 107);
              end
              else begin
                if (LVar0 == 8) then begin
                  LVar1 := message_str(330, 108);
                end
                else begin
                  if (LVar0 == 9) then begin
                    LVar1 := message_str(330, 109);
                  end
                  else begin
                    if (LVar0 == 10) then begin
                      LVar1 := message_str(330, 110);
                    end
                    else begin
                      if (LVar0 == 11) then begin
                        LVar1 := message_str(330, 111);
                      end
                      else begin
                        LVar0 := 1;
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    LVar0 := LVar0 + 1;
    float_msg(self_obj, LVar1, 0);
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: 'call KnightBRandom;

    '
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(330, 100));
krupper:
  start: "[]"
  critter_p_proc: |
    if ((local_var(4) == 0) and obj_can_see_obj(self_obj, dude_obj)) then begin
      dialogue_system_enter;
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(434, 100));
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      call krupper01;
    end
    else begin
      call krupper00;
    end
    set_local_var(4, 1);
  timed_event_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      hostile := 1;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 48);
      initialized := 1;
    end
  krupper00: |
    float_msg(self_obj, message_str(434, 101), 0);
    call kruppercombat;
  krupper01: |
    start_gdialog(434, self_obj, 4, -1, -1);
    gsay_start;
    gsay_reply(434, 102);
    giq_option(4, 434, 103, krupper03, 50);
    giq_option(4, 434, 104, kruppercombat, 50);
    giq_option(-3, 434, 105, krupper02, 50);
    gsay_end;
    end_dialogue;
  krupper02: |
    gsay_message(434, 106, 50);
    call kruppercombat;
  krupper03: |
    gsay_reply(434, 107);
    giq_option(4, 434, 108, krupper02, 50);
    giq_option(4, 434, 109, krupper04, 50);
  krupper04: |
    gsay_message(434, 110, 50);
    add_timer_event(self_obj, game_ticks(20), 1);
  kruppercombat: 'hostile := 1;

    '
kyle:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 64);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    if (global_var(304) == 4) then begin
      call smalltalk;
    end
    else begin
      if ((local_var(4) == 1) and (local_var(1) < 2)) then begin
        call goto22;
      end
      else begin
        start_gdialog(845, self_obj, 4, -1, -1);
        gsay_start;
        if (local_var(4) == 0) then begin
          set_local_var(4, 1);
          call goto01;
        end
        else begin
          if (global_var(304) == 2) then begin
            call goto26;
          end
          else begin
            if (global_var(304) == 3) then begin
              call goto26;
            end
            else begin
              if (obj_carrying_pid_obj(dude_obj, 229)) then begin
                call goto23;
              end
              else begin
                if (global_var(304)) then begin
                  call goto17;
                end
                else begin
                  call goto27;
                end
              end
            end
          end
        end
        gsay_end;
        end_dialogue;
      end
    end
  goto01: |
    gsay_reply(845, 102);
    giq_option(-3, 845, 103, goto02, 50);
    giq_option(4, 845, 103, goto02, 50);
    giq_option(4, 845, 104, goto13, 50);
  goto02: |
    gsay_reply(845, 105);
    giq_option(4, 845, 106, goto04, 50);
    giq_option(4, 845, 107, goto03, 50);
    giq_option(4, 845, 108, goto14, 50);
    giq_option(-3, 845, 103, gotoend, 50);
  goto03: |
    gsay_reply(845, 109);
    giq_option(4, 845, 110, goto04, 50);
    giq_option(4, 845, 111, goto06, 50);
    giq_option(4, 845, 112, goto09, 51);
  goto04: |
    gsay_reply(845, 113);
    if (global_var(30) != 1) then begin
      giq_option(4, 845, 114, goto12, 50);
    end
    giq_option(4, 845, 115, goto05, 50);
    giq_option(4, 845, 116, gotoend, 50);
  goto05: |
    gsay_reply(845, 117);
    giq_option(4, 845, 118, goto06, 50);
    if (global_var(30) != 1) then begin
      giq_option(4, 845, 114, goto12, 50);
    end
  goto06: |
    gsay_reply(845, 119);
    giq_option(4, 845, 120, goto07, 50);
    giq_option(4, 845, 121, gotoend, 50);
  goto07: |
    gsay_reply(845, 122);
    giq_option(4, 845, 123, goto08, 50);
    giq_option(4, 845, 124, goto10, 50);
  goto08: |
    gsay_reply(845, 125);
    giq_option(4, 845, 124, goto10, 50);
    giq_option(4, 845, 126, goto09, 51);
  goto09: |
    call BottomReact;
    gsay_message(845, 127, 51);
  goto10: |
    gsay_reply(845, 128);
    giq_option(4, 845, 129, goto11, 50);
    giq_option(4, 845, 130, gotopart, 50);
  goto11: |
    gsay_reply(845, 131);
    giq_option(4, 845, 132, gotopart, 50);
  goto12: |
    gsay_reply(845, 133);
    giq_option(4, 845, 134, gotoend, 50);
    giq_option(4, 845, 135, goto09, 51);
    giq_option(4, 845, 136, goto06, 50);
  goto13: |
    gsay_reply(845, 137);
    giq_option(4, 845, 138, goto02, 50);
    giq_option(4, 845, 139, goto04, 51);
    giq_option(4, 845, 140, gotoend, 50);
  goto14: |
    gsay_reply(845, 141);
    giq_option(4, 845, 142, goto15, 50);
  goto15: |
    gsay_reply(845, 143);
    giq_option(4, 845, message_str(845, 144) + proto_data(obj_pid(dude_obj), 1) + message_str(845, 145), goto13, 50);
    giq_option(4, 845, 146, goto16, 50);
  goto16: |
    gsay_reply(845, 147);
    giq_option(4, 845, 148, goto06, 50);
  goto17: |
    gsay_reply(845, 149);
    giq_option(4, 845, 150, goto18, 50);
    giq_option(4, 845, 151, gotoend, 50);
    giq_option(4, 845, 152, gotoend, 50);
    giq_option(-3, 845, 103, gotoend, 50);
  goto18: |
    gsay_reply(845, 153);
    giq_option(4, 845, 154, goto09, 51);
    giq_option(4, 845, 155, goto19, 50);
    giq_option(4, 845, 156, goto11, 50);
    giq_option(4, 845, 157, gotoend, 50);
  goto19: |
    gsay_reply(845, 158);
    giq_option(4, 845, 159, gotoend, 50);
    giq_option(4, 845, 160, goto11, 50);
  goto20: "[]"
  goto21: 'float_msg(self_obj, message_str(845, 161), 2);

    '
  goto22: 'float_msg(self_obj, message_str(845, 162), 2);

    '
  goto23: |
    loot := 0;
    gsay_reply(845, 163);
    loot := obj_carrying_pid_obj(dude_obj, 229);
    if (loot) then begin
      giq_option(4, 845, 164, goto24, 50);
    end
    giq_option(4, 845, 165, goto25, 50);
    giq_option(-3, 845, 103, gotoend, 50);
  goto24: |
    rm_obj_from_inven(dude_obj, loot);
    gsay_reply(845, 166);
    giq_option(4, 845, 300, goto24a, 50);
  goto24a: |
    gfade_out(600);
    gfade_in(600);
    stuff := create_object_sid(76, 0, 0, -1);
    add_obj_to_inven(dude_obj, stuff);
    set_global_var(304, 2);
    gsay_message(845, 167, 50);
  goto25: 'gsay_message(845, 168, 50);

    '
  goto26: |
    gsay_reply(845, 169);
    giq_option(4, 845, 170, gotoend, 50);
    giq_option(-3, 845, 103, gotoend, 50);
  goto27: |
    gsay_reply(845, 171);
    giq_option(4, 845, 106, goto04, 50);
    giq_option(4, 845, 104, goto13, 50);
    giq_option(-3, 845, 103, gotoend, 50);
  goto75: "[]"
  gotoend: "[]"
  gotopart: 'set_global_var(304, 1);

    '
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: 'call do_dialogue;

    '
  destroy_p_proc: |
    set_global_var(250, 1);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (known) then begin
      display_msg(message_str(845, 100));
    end
    else begin
      display_msg(message_str(845, 101));
    end
  smalltalk: |
    ccount := ccount + 1;
    if (ccount < 6) then begin
      float_msg(self_obj, message_str(723, 200 + random(0, 2)), 2);
    end
    else begin
      if (ccount < 9) then begin
        float_msg(self_obj, message_str(723, 203 + random(0, 4)), 2);
      end
      else begin
        if (ccount < 12) then begin
          float_msg(self_obj, message_str(723, 209 + random(0, 3)), 2);
        end
        else begin
          display_msg(message_str(723, 213));
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
ladder:
  start: |
    if (script_action == 6) then begin
      script_overrides;
      call do_stuff;
    end
  do_stuff: |
    manhole_open := map_var(local_var(0));
    if (manhole_open) then begin
      call ladder00;
    end
    else begin
      call ladder01;
    end
  ladderend: "[]"
  ladder00: 'move_to(dude_obj, local_var(1), local_var(2));

    '
  ladder01: |
    bonus := 1 - local_var(0);
    testa := do_check(dude_obj, 0, bonus);
    call ladder01a;
  ladder01a: |
    if (is_success(testa)) then begin
      set_local_var(0, 0);
      display_msg(message_str(20, 100));
      call ladder00;
    end
    else begin
      set_local_var(0, local_var(0) + 1);
      if (is_critical(testa)) then begin
        display_msg(message_str(20, 101));
        damage := random(1, 6) - 4;
        if (damage < 1) then begin
          damage := 1;
        end
        critter_dmg(dude_obj, damage, 0);
      end
      else begin
        display_msg(message_str(20, 102));
        testb := do_check(dude_obj, 5, 0);
        if (is_success(testb)) then begin
          display_msg(message_str(20, 103));
        end
        else begin
          display_msg(message_str(20, 104));
        end
      end
    end
lance:
  start: |
    if (global_var(332) != 0) then begin
      set_obj_visibility(self_obj, 0);
    end
    else begin
      if (not(initialized)) then begin
        critter_add_trait(self_obj, 1, 6, 2);
        critter_add_trait(self_obj, 1, 5, 4);
        initialized := 1;
      end
      else begin
        if (script_action == 12) then begin
          call critter_p_proc;
        end
        else begin
          if (script_action == 18) then begin
            call destroy_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    set_global_var(332, 1);
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    call get_reaction;
    if (global_var(12)) then begin
      if (herebefore) then begin
        call Lance52;
      end
      else begin
        start_gdialog(699, self_obj, 4, -1, -1);
        gsay_start;
        call Lance49;
        gsay_end;
        end_dialogue;
      end
    end
    else begin
      if (herebefore) then begin
        if (local_var(1) == 1) then begin
          call Lance02;
        end
        else begin
          start_gdialog(699, self_obj, 4, -1, -1);
          gsay_start;
          call Lance03;
          gsay_end;
          end_dialogue;
        end
      end
      else begin
        if (global_var(246) or (global_var(155) < -30) or (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) or (global_var(158) > 2)) then begin
          if ((global_var(103) == 2) and (global_var(43) == 2)) then begin
            start_gdialog(699, self_obj, 4, -1, -1);
            gsay_start;
            call Lance00;
            gsay_end;
            end_dialogue;
          end
          else begin
            call Lance01;
          end
        end
        else begin
          if (global_var(68) < 2) then begin
            if (local_var(1) >= 2) then begin
              start_gdialog(699, self_obj, 4, -1, -1);
              gsay_start;
              call Lance04;
              gsay_end;
              end_dialogue;
            end
            else begin
              call Lance05;
            end
          end
          else begin
            start_gdialog(699, self_obj, 4, -1, -1);
            gsay_start;
            if (local_var(1) >= 2) then begin
              call Lance07;
            end
            else begin
              call Lance06;
            end
            gsay_end;
            end_dialogue;
          end
        end
      end
    end
    if (go_to_Shady) then begin
      gfade_out(600);
      game_time_advance(game_ticks(86400));
      load_map(26, 0);
    end
    if (go_to_Raiders) then begin
      gfade_out(600);
      game_time_advance(game_ticks(86400));
      load_map(24, 0);
    end
  Lance00: |
    call BottomReact;
    herebefore := 1;
    gsay_reply(699, 102);
    giq_option(4, 699, 103, Lance00a, 51);
    giq_option(4, 699, 104, Lance10, 50);
    giq_option(4, 699, 105, Lance11, 50);
    giq_option(4, 699, 106, Lance12, 50);
    giq_option(-3, 699, 107, Lance13, 50);
  Lance00a: |
    if ((get_critter_stat(dude_obj, 0) > 7) or obj_is_carrying_obj_pid(dude_obj, 15) or obj_is_carrying_obj_pid(dude_obj, 118) or obj_is_carrying_obj_pid(dude_obj, 13) or obj_is_carrying_obj_pid(dude_obj, 12)) then begin
      call Lance08;
    end
    else begin
      call Lance09;
    end
  Lance01: |
    call BottomReact;
    float_msg(self_obj, message_str(699, 108), 0);
    hostile := 1;
  Lance02: 'float_msg(self_obj, message_str(699, 109), 0);

    '
  Lance03: |
    gsay_reply(699, 110);
    if ((global_var(101) == 1) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 699, 111, Lance14, 50);
    end
    if ((global_var(26) == 1) and (global_var(103) == 1)) then begin
      giq_option(4, 699, 112, Lance15, 50);
    end
    if (global_var(103) == 2) then begin
      giq_option(4, 699, 113, Lance16, 50);
    end
    giq_option(4, 699, 114, Lance17, 50);
    giq_option(-3, 699, 115, Lance18, 50);
  Lance04: |
    herebefore := 1;
    gsay_reply(699, 116);
    if ((global_var(101) == 1) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 699, 111, Lance14, 50);
    end
    giq_option(4, 699, 118, Lance04a, 50);
    giq_option(4, 699, 119, Lance22, 50);
    giq_option(4, 699, 120, Lance23, 50);
    giq_option(-3, 699, 121, Lance24, 50);
  Lance04a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Lance19;
    end
    else begin
      call Lance20;
    end
  Lance05: 'float_msg(self_obj, message_str(699, 122), 0);

    '
  Lance06: |
    gsay_reply(699, message_str(699, 123) + proto_data(obj_pid(dude_obj), 1) + message_str(699, 124));
    giq_option(4, 699, 125, Lance25, 50);
    giq_option(4, 699, 113, Lance16, 50);
    giq_option(4, 699, 127, Lance26, 50);
    giq_option(4, 699, 128, Lance28, 50);
    giq_option(4, 699, 121, Lance18, 51);
  Lance07: |
    herebefore := 1;
    gsay_reply(699, message_str(699, 123) + proto_data(obj_pid(dude_obj), 1) + message_str(699, 130));
    giq_option(4, 699, 131, Lance29, 50);
    giq_option(4, 699, 113, Lance16, 50);
    if ((global_var(101) == 1) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 699, 111, Lance14, 50);
    end
    giq_option(4, 699, 132, Lance00a, 51);
    giq_option(4, 699, 133, Lance30, 50);
    giq_option(-3, 699, 121, Lance18, 50);
  Lance08: |
    gsay_reply(699, 134);
    giq_option(0, 634, 106, LanceLoot, 51);
  Lance09: |
    gsay_message(699, 135, 51);
    hostile := 1;
  Lance10: |
    gsay_reply(699, 126);
    giq_option(4, 699, 136, Lance00a, 51);
    giq_option(4, 699, 137, Lance31, 50);
    giq_option(4, 699, 105, Lance11, 50);
    giq_option(4, 699, 106, Lance12, 50);
    giq_option(4, 699, 138, LanceCombat, 51);
  Lance11: |
    call BottomReact;
    gsay_message(699, 139, 51);
  Lance12: 'gsay_message(699, 140, 51);

    '
  Lance13: 'gsay_message(699, 141, 50);

    '
  Lance14: |
    gsay_reply(699, 142);
    giq_option(4, 699, 143, Lance14, 50);
    if ((global_var(103) == 1) and (global_var(26) == 1)) then begin
      giq_option(4, 699, 112, Lance15, 50);
    end
    if (global_var(103) == 2) then begin
      giq_option(4, 699, 113, Lance16, 50);
    end
    giq_option(4, 699, 114, Lance17, 50);
    if (global_var(43) == 2) then begin
      giq_option(4, 699, 144, Lance32, 50);
    end
  Lance15: |
    gsay_reply(699, 145);
    giq_option(4, 699, 146, Lance33, 50);
    giq_option(4, 699, 147, Lance34, 50);
    giq_option(4, 699, 148, Lance35, 50);
    giq_option(4, 699, 149, Lance36, 50);
  Lance16: |
    gsay_reply(699, 150);
    giq_option(4, 699, 151, Lance37, 50);
    giq_option(4, 699, 152, Lance38, 50);
    giq_option(4, 699, 144, Lance32, 50);
    giq_option(4, 699, 153, Lance39, 50);
  Lance17: |
    gsay_reply(699, 154);
    if ((global_var(101) == 1) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 699, 111, Lance14, 50);
    end
    if ((global_var(103) == 1) and (global_var(26) == 1)) then begin
      giq_option(4, 699, 112, Lance15, 50);
    end
    if (global_var(103) == 2) then begin
      giq_option(4, 699, 113, Lance16, 50);
    end
    giq_option(4, 699, 155, Lance17, 50);
    giq_option(4, 699, 156, Lance36, 50);
  Lance18: 'gsay_message(699, 157, 51);

    '
  Lance19: |
    gsay_reply(699, 158);
    giq_option(4, 699, 159, Lance19a, 50);
    giq_option(4, 699, 160, Lance42, 50);
    if ((global_var(101) == 1) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 699, 161, Lance43, 50);
    end
    giq_option(4, 699, 162, Lance48, 50);
  Lance19a: |
    if (get_critter_stat(dude_obj, 3) > 6) then begin
      call Lance40;
    end
    else begin
      call Lance41;
    end
  Lance20: |
    call BottomReact;
    gsay_message(699, 163, 51);
  Lance21: |
    call BottomReact;
    gsay_message(699, 164, 51);
  Lance22: |
    if (global_var(71) < 1) then begin
      set_global_var(71, 1);
    end
    gsay_message(699, 165, 50);
  Lance23: |
    call BottomReact;
    gsay_message(699, 166, 51);
  Lance24: 'gsay_message(699, 167, 51);

    '
  Lance25: |
    gsay_reply(699, 168);
    giq_option(4, 699, 169, Lance44, 50);
    giq_option(4, 699, 170, LanceCombat, 51);
    giq_option(4, 699, 171, Lance28, 50);
    giq_option(4, 699, 172, Lance31, 50);
  Lance26: |
    gsay_reply(699, 173);
    giq_option(4, 699, 169, Lance44, 50);
    giq_option(4, 699, 170, Lance45, 51);
    giq_option(4, 699, 171, Lance28, 50);
    giq_option(4, 699, 172, Lance31, 50);
  Lance27: |
    call BottomReact;
    gsay_reply(699, 174);
    giq_option(0, 634, 106, LanceLoot, 51);
  Lance28: 'gsay_message(699, 175, 50);

    '
  Lance29: |
    gsay_reply(699, 176);
    giq_option(4, 699, 177, Lance46, 50);
    giq_option(4, 699, 178, Lance47, 50);
  Lance30: |
    gsay_reply(699, 179);
    giq_option(0, 634, 106, Lance29, 50);
  Lance31: |
    gsay_reply(699, 180);
    giq_option(0, 634, 106, Lance31a, 51);
  Lance31a: 'gsay_message(699, 181, 50);

    '
  Lance32: |
    gsay_reply(699, 182);
    if ((global_var(101) == 1) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 699, 161, Lance43, 50);
    end
    if ((global_var(103) == 1) and (global_var(26) == 1)) then begin
      giq_option(4, 699, 112, Lance15, 50);
    end
    if (global_var(103) == 2) then begin
      giq_option(4, 699, 113, Lance16, 50);
    end
    giq_option(4, 699, 114, Lance17, 50);
    giq_option(4, 699, 183, Lance36, 50);
  Lance33: |
    gsay_message(699, 184, 50);
    go_to_Shady := 1;
  Lance34: |
    gsay_message(699, 185, 50);
    go_to_Raiders := 1;
  Lance35: 'gsay_message(699, 186, 50);

    '
  Lance36: 'gsay_message(699, 187, 50);

    '
  Lance37: |
    gsay_reply(699, 188);
    giq_option(0, 634, 106, LanceLoot, 50);
  Lance38: 'gsay_message(699, 189, 50);

    '
  Lance39: 'gsay_message(699, 190, 49);

    '
  Lance40: |
    gsay_message(699, 191, 50);
    go_to_Shady := 1;
  Lance41: 'gsay_message(699, 192, 50);

    '
  Lance42: 'gsay_message(699, 193, 50);

    '
  Lance43: |
    gsay_reply(699, 194);
    giq_option(0, 634, 106, Lance36, 50);
  Lance44: 'gsay_message(699, 195, 50);

    '
  Lance45: |
    call BottomReact;
    gsay_message(699, 196, 51);
  Lance46: |
    gsay_message(699, 197, 50);
    go_to_Shady := 1;
  Lance47: 'gsay_message(699, 198, 50);

    '
  Lance48: 'gsay_message(699, 199, 50);

    '
  Lance49: |
    herebefore := 1;
    gsay_reply(699, 200);
    giq_option(4, 699, 201, Lance50, 50);
    giq_option(4, 699, 202, Lance51, 50);
    giq_option(4, 699, 203, Lance50, 50);
    giq_option(4, 699, 204, Lance51, 50);
    giq_option(-3, 699, 205, Lance51, 50);
  Lance50: 'gsay_message(699, 206, 50);

    '
  Lance51: 'gsay_message(699, 207, 50);

    '
  Lance52: 'float_msg(self_obj, message_str(699, 208), 0);

    '
  LanceCombat: 'hostile := 1;

    '
  LanceEnd: "[]"
  LanceLoot: |
    gdialog_mod_barter(0);
    giq_option(4, 634, 103, LanceEnd, 50);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
larry:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 79);
      set_local_var(1, 0);
      init_teams := 1;
    end
    if ((script_action == 11) and (global_var(35) < 1)) then begin
      if (global_var(306) == 0) then begin
        call do_dialogue;
      end
      else begin
        display_msg(message_str(80, 108));
      end
    end
    else begin
      if (script_action == 21) then begin
        script_overrides;
        display_msg(message_str(80, 101));
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            call Critter_Action;
          end
          else begin
            if (script_action == 18) then begin
              set_global_var(35, global_var(35) + 1);
              if (global_var(35) > global_var(551)) then begin
                set_global_var(155, global_var(155) + 3);
                set_global_var(29, 2);
                set_global_var(225, game_time / (10 * 60 * 60 * 24));
              end
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(160, global_var(160) + 1);
                if ((global_var(160) % 6) == 0) then begin
                  set_global_var(155, global_var(155) + 1);
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: 'call mutant00;

    '
  mutant00: 'float_msg(self_obj, message_str(80, 102), 3);

    '
  mutant01: |
    float_msg(self_obj, message_str(80, 103), 3);
    call combat;
  mutant02: |
    float_msg(self_obj, message_str(80, 107), 3);
    call combat;
  combat: 'Hostile := 1;

    '
  Critter_Action: |
    if ((global_var(35) > 0) and obj_can_see_obj(self_obj, dude_obj) and (global_var(306) < 1)) then begin
      Hostile := 1;
    end
    if (Hostile > 0) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if ((global_var(306) == 1) and (tile_num(self_obj) != 15507)) then begin
        animate_move_obj_to_tile(self_obj, 15507, 0);
      end
      else begin
        if ((global_var(306) == 1) and (tile_num(self_obj) == 15507)) then begin
          set_global_var(306, 2);
        end
        else begin
          if ((global_var(306) == 2) and (tile_num(self_obj) != 12536)) then begin
            animate_move_obj_to_tile(self_obj, 12536, 0);
          end
          else begin
            if ((tile_num(self_obj) == 12536) and (global_var(306) == 2)) then begin
              set_obj_visibility(self_obj, 1);
            end
          end
        end
      end
    end
lars:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  combat_p_proc: |
    if (cur_map_index != 11) then begin
      if (fixed_param == 4) then begin
        GVar2 := GVar2 + 1;
      end
      if (GVar2 > 3) then begin
        if (global_var(247) == 0) then begin
          set_global_var(247, 1);
          set_global_var(155, global_var(155) - 5);
        end
      end
    end
  critter_p_proc: |
    if ((global_var(38) == 1) and (global_var(624) == 0) and (cur_map_index == 11) and (combat_is_initialized == 0)) then begin
      destroy_object(self_obj);
    end
    if (GVar0) then begin
      GVar0 := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (map_var(0) == 1) then begin
        item_caps_adjust(dude_obj, 500);
        float_msg(self_obj, message_str(518, 162), 3);
        set_map_var(0, 2);
      end
    end
    if (global_var(247) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  description_p_proc: |
    if (is_success(do_check(dude_obj, 1, has_trait(0, dude_obj, 0)))) then begin
      display_msg(message_str(518, 103));
    end
    else begin
      display_msg(message_str(518, 102));
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    if (cur_map_index == 11) then begin
      script_overrides;
      display_msg(message_str(518, 168));
    end
    set_global_var(624, 1);
  look_at_p_proc: |
    script_overrides;
    if (local_var(4)) then begin
      display_msg(message_str(518, 101));
    end
    else begin
      display_msg(message_str(518, 100));
    end
  map_enter_p_proc: |
    if (global_var(624) == 1) then begin
      destroy_object(self_obj);
    end
    else begin
      if (cur_map_index == 11) then begin
        if (global_var(38) == 1) then begin
          destroy_object(self_obj);
        end
        else begin
          critter_add_trait(self_obj, 1, 6, 0);
        end
      end
      else begin
        critter_add_trait(self_obj, 1, 6, 12);
        if (global_var(625) == 1) then begin
          set_obj_visibility(self_obj, 1);
        end
        else begin
          set_obj_visibility(self_obj, 0);
        end
      end
    end
  pickup_p_proc: |
    float_msg(self_obj, message_str(518, 104), 0);
    GVar0 := 1;
  talk_p_proc: |
    call get_reaction;
    start_gdialog(518, self_obj, 4, -1, -1);
    gsay_start;
    if (global_var(158) > 2) then begin
      call Lars01;
    end
    else begin
      if (global_var(247) == 1) then begin
        call Lars27;
      end
      else begin
        if ((global_var(38) == 1) and (global_var(104) != 2)) then begin
          call Lars26;
        end
        else begin
          if (global_var(104) == 1) then begin
            set_local_var(4, 1);
            call Lars21;
          end
          else begin
            if (local_var(4) == 0) then begin
              call Lars00;
            end
            else begin
              if (global_var(555) == 2) then begin
                call Lars19;
              end
              else begin
                call Lars12;
              end
            end
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
    if (GVar5) then begin
      GVar5 := 0;
      set_global_var(625, 1);
      load_map(11, 4);
    end
    else begin
      if ((global_var(555) == 2) and (local_var(5) == 0)) then begin
        set_local_var(5, 1);
        gfade_out(600);
        give_exp_points(500);
        set_global_var(155, global_var(155) + 3);
        display_msg(message_str(518, 174));
        game_time_advance(game_ticks(7200));
        gfade_in(600);
      end
      else begin
        if (GVar6) then begin
          gfade_out(600);
          game_time_advance(game_ticks(3000));
          set_global_var(104, 2);
          gfade_in(600);
          GVar6 := 0;
        end
        else begin
          if (GVar4) then begin
            GVar4 := 0;
            set_global_var(625, 1);
            load_map(11, 7);
          end
          else begin
            if (GVar3) then begin
              GVar3 := 0;
              gfade_out(600);
              set_global_var(555, 2);
              set_global_var(283, 0);
              display_msg(message_str(518, 167));
              gfade_in(600);
            end
          end
        end
      end
    end
  timed_event_p_proc: 'GVar0 := 1;

    '
  Lars00: |
    gsay_reply(518, 105);
    giq_option(4, 518, 106, Lars02, 50);
    giq_option(4, 518, 107, Lars05, 50);
    giq_option(4, 518, 108, Lars10, 50);
    giq_option(-3, 518, 109, Lars20, 50);
    if (global_var(555) == 1) then begin
      giq_option(6, 518, 110, Lars13, 50);
    end
    if (global_var(104) == 1) then begin
      giq_option(4, 518, 161, Lars22, 49);
    end
    if (global_var(283) > (game_time / (10 * 60 * 60 * 24))) then begin
      giq_option(4, 518, 166, Lars24, 49);
    end
  Lars01: |
    gsay_message(518, 111, 51);
    GVar0 := 1;
  Lars02: |
    gsay_reply(518, 112);
    giq_option(4, 518, 113, Lars03, 50);
    call Goodbyes;
    giq_option(4, 518, GVar7, LarsEnd, 50);
  Lars03: |
    gsay_reply(518, 114);
    giq_option(4, 518, 115, Lars04, 50);
    call Goodbyes;
    giq_option(4, 518, GVar7, LarsEnd, 50);
  Lars04: |
    call DownReact;
    gsay_message(518, 116, 51);
  Lars05: |
    gsay_reply(518, 117);
    giq_option(4, 518, 118, Lars04, 50);
    giq_option(4, 518, 119, Lars06, 50);
    giq_option(6, 518, 120, Lars07, 50);
  Lars06: 'gsay_message(518, 121, 50);

    '
  Lars07: |
    gsay_reply(518, 122);
    giq_option(4, 518, 123, Lars08, 50);
    giq_option(4, 518, 124, Lars09, 50);
  Lars08: |
    set_global_var(555, 1);
    gsay_message(518, 125, 50);
  Lars09: 'gsay_message(518, 126, 50);

    '
  Lars10: |
    variable LVar0 := 0;
    set_local_var(4, 1);
    LVar0 := message_str(518, 128) + proto_data(obj_pid(dude_obj), 1) + message_str(518, 129);
    gsay_reply(518, 127);
    giq_option(4, 518, LVar0, Lars11, 50);
    giq_option(4, 518, 130, Lars04, 50);
    if (global_var(104) == 1) then begin
      giq_option(4, 518, 160, Lars22, 49);
    end
  Lars11: |
    variable LVar0 := 0;
    LVar0 := message_str(518, 131) + proto_data(obj_pid(dude_obj), 1) + message_str(518, 132);
    gsay_reply(518, LVar0);
    giq_option(4, 518, 133, Lars05, 50);
    giq_option(4, 518, 134, Lars02, 50);
    call Goodbyes;
    giq_option(4, 518, GVar7, LarsEnd, 50);
  Lars12: |
    if (local_var(1) > 1) then begin
      gsay_reply(518, 135);
    end
    else begin
      if (global_var(104) == 2) then begin
        gsay_reply(518, 171);
      end
      else begin
        gsay_reply(518, 136);
      end
    end
    if (not(global_var(555))) then begin
      giq_option(4, 518, 137, Lars18, 50);
    end
    giq_option(4, 518, 138, LarsEnd, 50);
    if (global_var(257) and (global_var(555) == 1)) then begin
      giq_option(4, 518, 139, Lars14, 50);
    end
    if (global_var(283) > (game_time / (10 * 60 * 60 * 24))) then begin
      giq_option(4, 518, 166, Lars24, 49);
    end
  Lars13: |
    set_local_var(4, 1);
    gsay_reply(518, 140);
    giq_option(4, 518, 141, Lars17, 50);
    if (global_var(257)) then begin
      giq_option(4, 518, 142, Lars16, 50);
    end
  Lars14: |
    gsay_reply(518, 143);
    giq_option(4, 518, 144, Lars15, 50);
    if (global_var(257)) then begin
      giq_option(4, 518, 145, Lars16, 50);
    end
  Lars15: |
    gsay_reply(518, 146);
    giq_option(4, 518, 147, LarsEnd, 50);
    if (global_var(257)) then begin
      giq_option(4, 518, 148, Lars16, 50);
    end
  Lars16: |
    set_global_var(555, 2);
    gsay_message(518, 149, 49);
  Lars17: |
    call DownReact;
    gsay_message(518, 150, 51);
  Lars18: |
    set_global_var(555, 1);
    gsay_reply(518, 151);
    call Goodbyes;
    giq_option(4, 518, GVar7, LarsEnd, 50);
  Lars19: 'gsay_message(518, 152, 50);

    '
  Lars20: 'gsay_message(518, 153, 50);

    '
  Lars21: |
    gsay_reply(518, 155);
    giq_option(4, 518, 156, Lars22, 49);
    giq_option(4, 518, 157, Lars23, 50);
    giq_option(-3, 518, 172, Lars22, 50);
    giq_option(-3, 518, 173, Lars23, 50);
  Lars22: |
    gsay_message(518, 158, 49);
    GVar5 := 1;
  Lars23: |
    gsay_message(518, 159, 50);
    GVar6 := 1;
  Lars24: |
    set_global_var(287, 1);
    gsay_reply(518, 163);
    giq_option(4, 518, 164, Lars25, 50);
    giq_option(4, 518, 165, LarsKillNeal, 49);
    set_local_var(4, 1);
  Lars25: |
    GVar3 := 1;
    set_local_var(5, 1);
  Lars26: 'gsay_message(518, 169, 51);

    '
  Lars27: |
    gsay_message(518, 170, 51);
    rm_timer_event(self_obj);
    add_timer_event(self_obj, game_ticks(15), 1);
  LarsEnd: "[]"
  LarsKillNeal: 'GVar4 := 1;

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  Goodbyes: 'GVar7 := message_str(634, random(100, 105));

    '
laryknig:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 64);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 12) then begin
          call critter_p_proc;
        end
        else begin
          if (script_action == 11) then begin
            call talk_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    if (local_var(0)) then begin
      call goto05;
    end
    else begin
      if (local_var(1) == 0) then begin
        call do_dialogue;
      end
      else begin
        call goto06;
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(250, 1);
    end
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(770, 100));
  do_dialogue: |
    start_gdialog(770, self_obj, 4, -1, -1);
    gsay_start;
    call goto00;
    gsay_end;
    end_dialogue;
  goto00: |
    gsay_reply(770, 101);
    giq_option(4, 770, 102, goto02, 50);
    giq_option(4, 770, 103, goto00b, 50);
    giq_option(-3, 770, 104, goto01, 50);
  goto00b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call goto03;
    end
    else begin
      call goto04;
    end
  goto01: 'gsay_message(770, 105, 50);

    '
  goto02: |
    set_local_var(1, 1);
    critter_mod_skill(dude_obj, 2, 5);
    game_time_advance(game_ticks(1800));
    gsay_message(770, 106, 50);
  goto03: |
    set_local_var(1, 1);
    critter_mod_skill(dude_obj, 2, 5);
    game_time_advance(game_ticks(1800));
    gsay_message(770, 107, 50);
  goto04: |
    set_local_var(0, 1);
    gsay_message(770, 108, 50);
  goto05: 'float_msg(self_obj, message_str(770, 109), 2);

    '
  goto06: 'float_msg(self_obj, message_str(770, random(216, 223)), 2);

    '
lasher:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 83);
      Only_Once := 0;
    end
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(384, 100));
    end
    else begin
      if (script_action == 4) then begin
        Hostile := 1;
      end
      else begin
        if (script_action == 18) then begin
          if (source_obj == dude_obj) then begin
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
              set_global_var(156, 1);
              set_global_var(157, 0);
            end
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
              set_global_var(157, 1);
              set_global_var(156, 0);
            end
            set_global_var(160, global_var(160) + 1);
            if ((global_var(160) % 6) == 0) then begin
              set_global_var(155, global_var(155) + 1);
            end
          end
        end
        else begin
          if (script_action == 12) then begin
            if ((local_var(1) == 0) and obj_can_see_obj(self_obj, dude_obj)) then begin
              set_local_var(1, 1);
              dialogue_system_enter;
            end
            else begin
              if (obj_can_see_obj(self_obj, dude_obj) and ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3))) then begin
                Hostile := 1;
              end
            end
            if (Hostile) then begin
              Hostile := 0;
              attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
            end
          end
          else begin
            if (script_action == 11) then begin
              script_overrides;
              if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
                if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
                  start_gdialog(384, self_obj, 4, -1, -1);
                  gsay_start;
                  call lasher04;
                  gsay_end;
                  end_dialogue;
                end
                else begin
                  start_gdialog(384, self_obj, 4, -1, -1);
                  gsay_start;
                  call lasher05;
                  gsay_end;
                  end_dialogue;
                end
              end
              else begin
                if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
                  start_gdialog(384, self_obj, 4, -1, -1);
                  gsay_start;
                  call lasher06;
                  gsay_end;
                  end_dialogue;
                end
                else begin
                  if (global_var(195) == 1) then begin
                    start_gdialog(384, self_obj, 4, -1, -1);
                    gsay_start;
                    call lasher00;
                    gsay_end;
                    end_dialogue;
                  end
                  else begin
                    if (global_var(158) > 2) then begin
                      start_gdialog(384, self_obj, 4, -1, -1);
                      gsay_start;
                      call lasher01;
                      gsay_end;
                      end_dialogue;
                    end
                    else begin
                      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                        start_gdialog(384, self_obj, 4, -1, -1);
                        gsay_start;
                        call lasher02;
                        gsay_end;
                        end_dialogue;
                      end
                      else begin
                        if (local_var(0) == 1) then begin
                          start_gdialog(384, self_obj, 4, -1, -1);
                          gsay_start;
                          call lasher03;
                          gsay_end;
                          end_dialogue;
                        end
                        else begin
                          start_gdialog(384, self_obj, 4, -1, -1);
                          gsay_start;
                          call lasher07;
                          gsay_end;
                          end_dialogue;
                        end
                      end
                    end
                  end
                end
              end
              set_local_var(0, 1);
            end
          end
        end
      end
    end
  lasher00: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(384, 101);
    end
    else begin
      gsay_reply(384, 102);
    end
    gsay_option(384, 223, lasherend, 50);
  lasher01: |
    gsay_message(384, 103, 50);
    call combat;
  lasher02: |
    gsay_message(384, 104, 50);
    call combat;
  lasher03: |
    gsay_reply(384, 105);
    gsay_option(384, 223, lasherend, 50);
  lasher04: |
    gsay_reply(384, 106);
    giq_option(7, 384, 107, lasher08, 50);
    giq_option(4, 384, 108, lasher09, 50);
    giq_option(4, 384, 109, lasher10, 50);
    giq_option(4, 384, 110, lasher11, 50);
    if (Lasher_Abuse) then begin
      giq_option(4, 384, 111, lasher12, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 384, 112, lasher02, 50);
    end
    giq_option(-3, 384, 113, lasher13, 50);
  lasher05: |
    gsay_reply(384, 114);
    giq_option(7, 384, 115, lasher14, 50);
    giq_option(7, 384, 116, lasher15, 50);
    if (Lasher_Abuse) then begin
      giq_option(4, 384, 117, lasher12, 50);
    end
    giq_option(4, 384, 118, lasher16, 50);
    giq_option(4, 384, 119, lasher11, 50);
    giq_option(4, 384, 109, lasher10, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 384, 120, lasher02, 50);
    end
    giq_option(-3, 384, 121, lasher13, 50);
  lasher06: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(384, 122);
    end
    else begin
      gsay_reply(384, 123);
    end
    giq_option(7, 384, 124, lasher06a, 50);
    giq_option(7, 384, 125, lasher15, 50);
    if (Lasher_Abuse) then begin
      giq_option(4, 384, 126, lasher12, 50);
    end
    giq_option(4, 384, 127, lasher16, 50);
    giq_option(4, 384, 128, lasher11, 50);
    giq_option(4, 384, 109, lasher10, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 384, 129, lasher02, 50);
    end
    giq_option(-3, 384, 130, lasher13, 50);
  lasher06a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call lasher17;
    end
    else begin
      call lasher18;
    end
  lasher07: |
    gsay_reply(384, 131);
    giq_option(7, 384, 132, lasher07a, 50);
    if (Lasher_Abuse) then begin
      giq_option(4, 384, 133, lasher12, 50);
    end
    giq_option(4, 384, 134, lasher19, 50);
    giq_option(4, 384, 109, lasher10, 50);
    giq_option(4, 384, 135, lasher11, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 384, 136, lasher02, 50);
    end
    giq_option(-3, 384, 137, lasher13, 50);
  lasher07a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call lasher17;
    end
    else begin
      call lasher18;
    end
  lasher08: |
    gsay_reply(384, 138);
    giq_option(7, 384, 139, lasher08a, 50);
    if (Lasher_Abuse) then begin
      giq_option(4, 384, 140, lasher12, 50);
    end
    giq_option(4, 384, 141, lasher19, 50);
    giq_option(4, 384, 142, lasher22, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 384, 143, lasher13, 50);
    end
  lasher08a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call lasher20_1;
    end
    else begin
      call lasher18;
    end
  lasher09: |
    gsay_reply(384, 144);
    gsay_option(384, 223, lasherend, 50);
  lasher10: |
    gsay_reply(384, 145);
    giq_option(7, 384, 146, lasher10a, 50);
    if (Lasher_Abuse) then begin
      giq_option(4, 384, 147, lasher26, 50);
    end
    giq_option(4, 384, 148, lasher27, 50);
    giq_option(4, 384, 149, lasher28, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 384, 150, lasher29, 50);
    end
  lasher10a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call lasher24;
    end
    else begin
      call lasher25;
    end
  lasher11: |
    gsay_reply(384, 151);
    giq_option(4, 384, 152, lasher09, 50);
    giq_option(4, 384, 153, lasher30, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 384, 154, lasher02, 50);
    end
  lasher12: |
    gsay_reply(384, 155);
    giq_option(7, 384, 156, lasher31, 50);
    giq_option(4, 384, 157, lasher30, 50);
    giq_option(4, 384, 158, lasher02, 50);
    giq_option(4, 384, 159, lasher32, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 384, 160, lasher33, 50);
    end
  lasher13: 'gsay_message(384, 161, 50);

    '
  lasher14: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(384, 163);
    end
    else begin
      gsay_reply(384, 162);
    end
    giq_option(7, 384, 164, lasher31, 50);
    giq_option(4, 384, 165, lasher30, 50);
    giq_option(4, 384, 166, lasher02, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 384, 167, lasher33, 50);
    end
  lasher14a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call lasher34;
    end
    else begin
      call lasher18;
    end
  lasher15: |
    gsay_reply(384, 168);
    giq_option(7, 384, 169, lasher18, 50);
    giq_option(4, 384, 170, lasher35, 50);
    giq_option(4, 384, 171, lasher36, 50);
    giq_option(4, 384, 172, lasher09, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 384, 173, lasher37, 50);
    end
  lasher16: 'gsay_message(384, 174, 50);

    '
  lasher17: |
    gsay_reply(384, 175);
    if (global_var(196) == 1) then begin
      giq_option(7, 384, 176, lasher17a, 50);
    end
    giq_option(4, 384, 177, lasher40_1, 50);
    giq_option(4, 384, 178, lasher41_1, 50);
    giq_option(4, 384, 179, lasher12, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 384, 180, lasher35, 50);
    end
  lasher17a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call lasher38;
    end
    else begin
      call lasher39;
    end
  lasher18: 'gsay_message(384, 181, 50);

    '
  lasher19: 'gsay_message(384, 182, 50);

    '
  lasher20_1: 'gsay_message(384, message_str(384, 183) + message_str(384, 183), 50);

    '
  lasher20_2: "[]"
  lasher21: 'gsay_message(384, 186, 50);

    '
  lasher22: 'gsay_message(384, 187, 50);

    '
  lasher23: 'gsay_message(384, 188, 50);

    '
  lasher24: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(142, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(384, 189, 50);
  lasher25: 'gsay_message(384, 190, 50);

    '
  lasher26: |
    gsay_reply(384, 191);
    giq_option(7, 384, 192, lasher26a, 50);
    giq_option(4, 384, 193, lasher25, 50);
    giq_option(4, 384, 194, lasher27, 50);
    giq_option(4, 384, 195, lasher28, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 384, 196, lasher23, 50);
    end
  lasher26a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call lasher24;
    end
    else begin
      call lasher25;
    end
  lasher27: 'gsay_message(384, 197, 50);

    '
  lasher28: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(142, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(384, 198, 50);
  lasher29: 'gsay_message(384, 199, 50);

    '
  lasher30: 'gsay_message(384, 200, 50);

    '
  lasher31: 'gsay_message(384, 201, 50);

    '
  lasher32: |
    gsay_reply(384, 202);
    giq_option(7, 384, 203, lasher21, 50);
    giq_option(4, 384, 204, lasher42, 50);
    giq_option(4, 384, 205, lasher43, 50);
    giq_option(4, 384, 206, lasher44, 50);
    giq_option(4, 384, 207, lasher28, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 384, 208, lasher35, 50);
    end
  lasher33: |
    if (get_critter_stat(dude_obj, 34) == 1) then begin
      gsay_message(384, 209, 50);
    end
    else begin
      gsay_message(384, 210, 50);
    end
  lasher34: 'gsay_message(384, 211, 50);

    '
  lasher35: 'gsay_message(384, 212, 50);

    '
  lasher36: 'gsay_message(384, 213, 50);

    '
  lasher37: 'gsay_message(384, 214, 50);

    '
  lasher38: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(142, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(384, 224, 50);
  lasher39: 'gsay_message(384, 215, 50);

    '
  lasher40_1: 'gsay_message(384, message_str(384, 216) + message_str(384, 217), 50);

    '
  lasher40_2: "[]"
  lasher41_1: 'gsay_message(384, message_str(384, 218) + message_str(384, 219), 50);

    '
  lasher41_2: "[]"
  lasher42: 'gsay_message(384, 220, 50);

    '
  lasher43: 'gsay_message(384, 221, 50);

    '
  lasher44: 'gsay_message(384, 222, 50);

    '
  lasherend: "[]"
  combat: 'Hostile := 1;

    '
laura:
  start: |
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if (script_action == 18) then begin
        if (source_obj == dude_obj) then begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
            set_global_var(156, 1);
            set_global_var(157, 0);
          end
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
            set_global_var(157, 1);
            set_global_var(156, 0);
          end
          set_global_var(159, global_var(159) + 1);
          if ((global_var(159) % 2) == 0) then begin
            set_global_var(155, global_var(155) - 1);
          end
        end
      end
      else begin
        if ((script_action == 21) or (script_action == 3)) then begin
          script_overrides;
          display_msg(message_str(48, 100));
        end
        else begin
          if (script_action == 4) then begin
            GVar5 := 1;
          end
          else begin
            if (script_action == 12) then begin
              Laura_Ptr := self_obj;
              if (local_var(4) == 1) then begin
                set_local_var(4, 2);
                set_local_var(9, 1);
                animate_move_obj_to_tile(self_obj, 14089, 0);
              end
              else begin
                if ((local_var(4) == 2) and (tile_num(self_obj) != 14089)) then begin
                  animate_move_obj_to_tile(self_obj, 14089, 0);
                end
                else begin
                  if ((local_var(4) == 2) and (tile_num(self_obj) == 14089)) then begin
                    set_local_var(4, 3);
                    obj_unlock(Red_Door_Ptr);
                    use_obj(Red_Door_Ptr);
                    animate_move_obj_to_tile(self_obj, 12495, 0);
                  end
                  else begin
                    if ((local_var(4) == 3) and (tile_num(self_obj) != 12495)) then begin
                      animate_move_obj_to_tile(self_obj, 12495, 0);
                    end
                    else begin
                      if ((local_var(4) == 3) and (tile_num(self_obj) == 12495)) then begin
                        set_local_var(4, 4);
                        animate_move_obj_to_tile(self_obj, 12302, 0);
                      end
                      else begin
                        if (local_var(4) == 4) then begin
                          float_msg(self_obj, message_str(766, 178), 8);
                          set_local_var(4, 5);
                          set_local_var(9, 2);
                        end
                        else begin
                          if (local_var(4) == 5) then begin
                            set_local_var(4, 6);
                            animate_move_obj_to_tile(self_obj, 15099, 0);
                          end
                          else begin
                            if ((local_var(4) == 6) and (tile_num(self_obj) != 15099)) then begin
                              animate_move_obj_to_tile(self_obj, 15099, 0);
                            end
                            else begin
                              if ((local_var(4) == 6) and (tile_num(self_obj) == 15099)) then begin
                                set_local_var(4, 7);
                                animate_move_obj_to_tile(self_obj, 23301, 0);
                              end
                              else begin
                                if ((local_var(4) == 7) and (tile_num(self_obj) != 23301)) then begin
                                  animate_move_obj_to_tile(self_obj, 23301, 0);
                                end
                                else begin
                                  if ((local_var(4) == 7) and (tile_num(self_obj) == 23301)) then begin
                                    set_local_var(4, 8);
                                    animate_move_obj_to_tile(self_obj, 27106, 0);
                                  end
                                  else begin
                                    if ((local_var(4) == 8) and (tile_num(self_obj) != 27106)) then begin
                                      animate_move_obj_to_tile(self_obj, 27106, 0);
                                    end
                                    else begin
                                      if ((local_var(4) == 8) and (tile_num(self_obj) == 27106)) then begin
                                        set_local_var(4, 9);
                                        set_obj_visibility(self_obj, 1);
                                      end
                                      else begin
                                        if (local_var(5) == 1) then begin
                                          set_local_var(5, 2);
                                          animate_move_obj_to_tile(self_obj, 22090, 0);
                                        end
                                        else begin
                                          if ((local_var(5) == 2) and (tile_num(self_obj) != 22090)) then begin
                                            animate_move_obj_to_tile(self_obj, 22090, 0);
                                          end
                                          else begin
                                            if ((local_var(5) == 2) and (tile_num(self_obj) == 22090)) then begin
                                              set_local_var(5, 3);
                                            end
                                            else begin
                                              if (local_var(9) == 1) then begin
                                                if ((tile_num(self_obj) == 22090) or (tile_num(self_obj) == 12495)) then begin
                                                  set_local_var(9, 0);
                                                end
                                              end
                                            end
                                          end
                                        end
                                      end
                                    end
                                  end
                                end
                              end
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
              if (GVar5) then begin
                GVar5 := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
            end
            else begin
              if (script_action == 22) then begin
                GVar5 := 1;
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    if (local_var(9) == 1) then begin
      float_msg(self_obj, message_str(766, 177), 8);
    end
    else begin
      if (local_var(9) == 2) then begin
        float_msg(self_obj, message_str(766, 179), 8);
      end
      else begin
        start_gdialog(48, self_obj, 4, 3, 8);
        gsay_start;
        GVar4 := get_critter_stat(dude_obj, 34) == 0;
        if (GVar10) then begin
          if (GVar11) then begin
            call laura63;
          end
          else begin
            GVar11 := 1;
            if (GVar13 == GVar12) then begin
              call laura65;
            end
            if (GVar13 > GVar12) then begin
              call laura64;
            end
          end
        end
        else begin
          if (local_var(6)) then begin
            if (local_var(7) == 1) then begin
              call laura61;
            end
            else begin
              if (local_var(8) == 1) then begin
                call laura21;
              end
              else begin
                call laura16;
              end
            end
          end
          else begin
            set_local_var(6, 1);
            call laura01;
          end
        end
        gsay_end;
        end_dialogue;
      end
    end
  lauracbt: 'GVar5 := 1;

    '
  laura01: |
    if (GVar4) then begin
      gsay_reply(48, 102);
    end
    else begin
      gsay_reply(48, 104);
    end
    if (global_var(61) == 1) then begin
      giq_option(4, 48, 105, laura02, 50);
    end
    giq_option(5, 48, 106, laura14, 50);
    giq_option(4, 48, 107, laura15, 51);
    giq_option(-3, 48, 108, laura01a, 50);
  laura01a: |
    gsay_message(48, 110, 50);
    call laurax;
  laura02: |
    gsay_reply(48, 112);
    if (global_var(61) == 1) then begin
      giq_option(4, 48, 113, laura03, 50);
    end
    giq_option(4, 48, 114, laura10, 50);
  laura03: |
    gsay_reply(48, 116);
    if (global_var(61) == 1) then begin
      giq_option(4, 48, 117, laura04, 50);
    end
    giq_option(4, 48, 118, laura09, 50);
  laura04: |
    gsay_message(48, 120, 50);
    set_local_var(7, 1);
    call laurax1;
  laura09: |
    gsay_reply(48, 122);
    call laurax;
  laura10: |
    gsay_reply(48, 124);
    giq_option(4, 48, 125, laura03, 50);
    giq_option(4, 48, 126, laura11, 50);
  laura11: |
    call DownReact;
    gsay_message(48, 128, 50);
    call laurax;
  laura14: |
    gsay_message(48, 130, 50);
    call laurax;
  laura15: |
    call DownReact;
    gsay_message(48, 132, 50);
    call laurax;
  laura16: |
    if (local_var(1) > 1) then begin
      gsay_reply(48, 134);
    end
    else begin
      gsay_reply(48, 136);
    end
    if (global_var(61) == 1) then begin
      giq_option(4, 48, 137, laura02, 50);
    end
    giq_option(4, 48, 138, laura14, 50);
    giq_option(4, 48, 139, laurax, 50);
    giq_option(-3, 48, 140, laura16a, 50);
  laura16a: |
    gsay_message(48, 142, 50);
    call laurax;
  laura21: |
    gsay_message(48, 144, 50);
    giq_option(4, 48, 145, laura22, 50);
  laura22: |
    gsay_message(48, 147, 50);
    call laura23;
  laura23: |
    giq_option(5, 48, 148, laura24, 50);
    giq_option(4, 48, 149, laura33, 50);
    giq_option(4, 48, 150, laura23_1, 50);
    if (GVar4) then begin
      giq_option(4, 48, 151, laura60, 50);
    end
    giq_option(4, 48, 152, laura59, 50);
  laura23_1: |
    if (global_var(52) == 0) then begin
      call laura51;
    end
    if (global_var(52) == 1) then begin
      call laura38;
    end
    if (global_var(52) == 2) then begin
      call laura46;
    end
  laura24: |
    gsay_reply(48, 154);
    giq_option(4, 48, 155, laura25, 50);
  laura25: |
    gsay_reply(48, 157);
    giq_option(4, 48, 158, laura26, 50);
    giq_option(4, 48, 159, laura28, 50);
  laura26: |
    gsay_reply(48, 161);
    giq_option(4, 48, 162, laura27, 50);
    giq_option(4, 48, 163, laura31, 50);
  laura27: |
    gsay_reply(48, 165);
    giq_option(4, 48, 166, laura28, 50);
  laura28: |
    gsay_reply(48, 168);
    giq_option(4, 48, 169, laura29, 50);
    giq_option(4, 48, 170, laura30, 50);
  laura29: |
    gsay_reply(48, 172);
    call laurax4;
  laura30: |
    GVar3 := random(1, 2);
    if (GVar3 == 1) then begin
      gsay_reply(48, 174);
    end
    if (GVar3 == 2) then begin
      gsay_reply(48, 176);
    end
    call laura23;
  laura31: |
    gsay_reply(48, 178);
    giq_option(4, 48, 179, laura32a, 51);
    giq_option(4, 48, 180, laura30, 50);
  laura32: |
    gsay_reply(48, 182);
    giq_option(4, 48, 183, laurax2, 51);
    giq_option(4, 48, 184, laurax8, 50);
    giq_option(4, 48, 185, laura30, 50);
  laura32a: |
    call DownReact;
    call laura32;
  laura33: |
    gsay_reply(48, 187);
    giq_option(4, 48, 188, laura34, 50);
    giq_option(4, 48, 189, laura35, 50);
  laura34: |
    gsay_reply(48, 191);
    giq_option(6, 48, 192, laura36, 50);
    giq_option(4, 48, 193, laura36, 50);
  laura35: |
    gsay_reply(48, 195);
    giq_option(6, 48, 196, laura36, 50);
    giq_option(4, 48, 197, laura36, 50);
  laura36: |
    gsay_reply(48, 199);
    giq_option(4, 48, 200, laura37, 50);
  laura37: |
    gsay_reply(48, 202);
    giq_option(4, 48, 203, laura28, 50);
    giq_option(4, 48, 204, laura27, 50);
  laura38: |
    gsay_reply(48, 206);
    giq_option(4, 48, 207, laura39, 50);
    giq_option(4, 48, 208, laura43, 50);
  laura39: |
    gsay_reply(48, 210);
    giq_option(4, 48, 211, laura40, 50);
    giq_option(4, 48, 212, laura42, 50);
  laura40: |
    gsay_reply(48, 214);
    giq_option(4, 48, 215, laura30, 50);
    giq_option(4, 48, 216, laura41, 50);
  laura41: |
    gsay_message(48, 218, 50);
    call laurax6;
  laura42: |
    gsay_reply(48, 220);
    giq_option(4, 48, 221, laura30, 50);
    giq_option(4, 48, 222, laura41, 50);
  laura43: |
    gsay_reply(48, 224);
    giq_option(4, 48, 225, laura44, 50);
    giq_option(4, 48, 226, laura45, 50);
  laura44: |
    gsay_reply(48, 228);
    giq_option(4, 48, 229, laura42, 50);
    giq_option(4, 48, 230, laura45, 50);
  laura45: |
    gsay_reply(48, 232);
    giq_option(4, 48, 233, laura37, 50);
    giq_option(4, 48, 234, laura30, 50);
    giq_option(4, 48, 235, laura41, 50);
  laura46: |
    gsay_reply(48, 237);
    giq_option(4, 48, 238, laura46_1, 50);
  laura46_1: |
    if (global_var(7) == 1) then begin
      call laura46;
    end
    if (global_var(14) == 1) then begin
      call laura49;
    end
  laura47: |
    gsay_reply(48, 240);
    giq_option(4, 48, 241, laura48, 50);
    giq_option(4, 48, 242, laura45, 50);
  laura48: |
    gsay_reply(48, 244);
    giq_option(4, 48, 245, laura45, 50);
  laura49: |
    gsay_reply(48, 247);
    giq_option(4, 48, 248, laura50, 50);
    giq_option(4, 48, 249, laura45, 50);
  laura50: |
    gsay_reply(48, 251);
    giq_option(4, 48, 252, laura45, 50);
  laura51: |
    gsay_reply(48, 254);
    giq_option(4, 48, 255, laura52, 50);
    giq_option(4, 48, 256, laura55, 50);
    giq_option(4, 48, 257, laura57, 50);
  laura52: |
    gsay_reply(48, 259);
    giq_option(4, 48, 260, laura53, 50);
    giq_option(4, 48, 261, laura55, 50);
  laura53: |
    gsay_reply(48, 263);
    giq_option(4, 48, 264, laura54, 50);
    giq_option(4, 48, 265, laura30, 50);
  laura54: |
    gsay_reply(48, 267);
    call laura23;
  laura55: |
    gsay_reply(48, 269);
    giq_option(4, 48, 270, laura33, 50);
    giq_option(4, 48, 271, laura56, 50);
  laura56: |
    gsay_reply(48, 273);
    call laura23;
  laura57: |
    gsay_reply(48, 275);
    giq_option(4, 48, 276, laura57_01, 50);
    giq_option(4, 48, 277, laura56, 50);
    giq_option(4, 48, 278, laura55, 50);
  laura57_01: |
    call DownReact;
    if (local_var(1) > 1) then begin
      call laura58;
    end
    else begin
      call laura32;
    end
  laura58: |
    gsay_reply(48, 280);
    giq_option(6, 48, 281, laura32, 50);
    giq_option(4, 48, 282, laura23, 50);
  laura59: |
    gsay_reply(48, 284);
    call laurax7;
  laura60: |
    gsay_reply(48, 286);
    call laura23;
  laura61: |
    if (local_var(1) > 1) then begin
      gsay_reply(48, 288);
    end
    else begin
      gsay_reply(48, 290);
    end
    giq_option(4, 48, 291, laura30, 50);
    giq_option(4, 48, 292, laura41, 50);
  laura62: |
    call DownReact;
    gsay_message(48, 294, 50);
  laura63: |
    call DownReact;
    gsay_reply(48, 296);
    giq_option(4, 48, 297, laurax2, 50);
    giq_option(4, 48, 298, laurax5, 50);
  laura64: |
    call DownReact;
    gsay_message(48, 300, 50);
  laura65: |
    call DownReact;
    gsay_reply(48, 302);
    giq_option(4, 48, 303, laurax2, 50);
    giq_option(4, 48, 304, laurax5, 50);
  laura67: 'gsay_message(48, 306, 50);

    '
  laura68: 'gsay_message(48, 309, 50);

    '
  laura69: 'gsay_message(48, 311, 50);

    '
  laura70: 'gsay_message(48, 313, 50);

    '
  laura71: 'gsay_message(48, 315, 50);

    '
  laura72: 'gsay_message(48, 317, 50);

    '
  laura73: 'gsay_message(48, 319, 50);

    '
  laura74: 'gsay_message(48, 321, 50);

    '
  laura75: 'gsay_message(48, 323, 50);

    '
  laura76: 'gsay_message(48, 325, 50);

    '
  laura77: 'gsay_message(48, 327, 50);

    '
  laura78: 'gsay_message(48, 329, 50);

    '
  laura79: 'gsay_message(48, 331, 50);

    '
  lauraxx: "[]"
  laurax: "[]"
  laurax1: |
    set_local_var(8, 1);
    set_local_var(5, 1);
    set_local_var(9, 1);
  laurax2: 'add_timer_event(self_obj, 5, 1);

    '
  laurax3: "[]"
  laurax4: |
    set_local_var(4, 1);
    set_local_var(9, 1);
  laurax5: |
    gfade_out(400);
    gfade_in(400);
  laurax6: |
    set_local_var(5, 1);
    set_local_var(9, 1);
  laurax7: "[]"
  laurax8: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'GVar15 := message_str(634, random(100, 105));

    '
  laura67a: 'gsay_message(48, 308, 50);

    '
  laura68a: 'gsay_message(48, 310, 50);

    '
  laura69a: 'gsay_message(48, 312, 50);

    '
  laura70a: 'gsay_message(48, 314, 50);

    '
  laura71a: 'gsay_message(48, 316, 50);

    '
  laura72a: 'gsay_message(48, 318, 50);

    '
  laura73a: 'gsay_message(48, 320, 50);

    '
  laura74a: 'gsay_message(48, 322, 50);

    '
  laura75a: 'gsay_message(48, 324, 50);

    '
  laura76a: 'gsay_message(48, 326, 50);

    '
  laura77a: 'gsay_message(48, 328, 50);

    '
  laura78a: 'gsay_message(48, 330, 50);

    '
  laura79a: 'gsay_message(48, 332, 50);

    '
  laura80: 'gsay_message(48, 333, 50);

    '
  laura80a: 'gsay_message(48, 334, 50);

    '
  laura81: 'gsay_message(48, 335, 50);

    '
  laura81a: 'gsay_message(48, 336, 50);

    '
  laura82: 'gsay_message(48, 337, 50);

    '
  laura82a: 'gsay_message(48, 338, 50);

    '
  laura83: 'gsay_message(48, 339, 50);

    '
  laura83a: 'gsay_message(48, 340, 50);

    '
  laura84: 'gsay_message(48, 341, 50);

    '
  laura84a: 'gsay_message(48, 342, 50);

    '
  laura85: 'gsay_message(48, 343, 50);

    '
  laura85a: 'gsay_message(48, 344, 50);

    '
  laura86: 'gsay_message(48, 345, 50);

    '
  laura86a: 'gsay_message(48, 346, 50);

    '
  laura87: 'gsay_message(48, 347, 50);

    '
  laura87a: 'gsay_message(48, 348, 50);

    '
  laura88: 'gsay_message(48, 349, 50);

    '
  laura88a: 'gsay_message(48, 350, 50);

    '
  lauraend: "[]"
lazrtrap:
  start: "[]"
  spatial_p_proc: |
    if (global_var(140) == 1) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
        Damage := random(3, 9);
        float_msg(dude_obj, message_str(336, 100), 0);
        display_msg(message_str(336, 101));
        critter_dmg(source_obj, Damage, 1);
      end
    end
leader:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 31);
      critter_add_trait(self_obj, 1, 5, 41);
      init_teams := 1;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if (script_action == 21) then begin
        script_overrides;
        display_msg(message_str(81, 100));
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            if (Hostile) then begin
              Hostile := 0;
              attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
            end
            else begin
              if (obj_can_see_obj(self_obj, dude_obj)) then begin
                if (local_var(7) == 0) then begin
                  set_local_var(7, 1);
                  if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
                    float_msg(self_obj, message_str(81, 193), 8);
                  end
                  else begin
                    float_msg(self_obj, message_str(81, 194), 8);
                  end
                end
              end
            end
          end
          else begin
            if (script_action == 18) then begin
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(159, global_var(159) + 1);
                if ((global_var(159) % 2) == 0) then begin
                  set_global_var(155, global_var(155) - 1);
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    has_parts := obj_carrying_pid_obj(dude_obj, 98);
    start_gdialog(81, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4)) then begin
      if (local_var(1) < 2) then begin
        call leader30;
      end
      else begin
        if (global_var(31) == 2) then begin
          call leader26;
        end
        else begin
          if (local_var(6) == 1) then begin
            call leader20;
          end
          else begin
            if (global_var(30) == 1) then begin
              call leader29;
            end
            else begin
              if (local_var(5) == 1) then begin
                if (has_parts) then begin
                  call leader18;
                end
                else begin
                  call leader16;
                end
              end
              else begin
                call leader00;
              end
            end
          end
        end
      end
    end
    else begin
      set_local_var(4, 1);
      call leader00;
    end
    gsay_end;
    end_dialogue;
  leadercbt: |
    call BigDownReact;
    Hostile := 1;
  leaderend: "[]"
  leader00: |
    gsay_reply(81, 101);
    giq_option(4, 81, 102, leader04, 50);
    giq_option(4, 81, 103, leader03, 50);
    giq_option(-3, 81, 104, leader02, 50);
  leader02: |
    gsay_reply(81, 105);
    giq_option(-3, 81, 106, leaderend, 50);
  leader03: |
    gsay_reply(81, 107);
    giq_option(4, 81, 108, leader04, 50);
    giq_option(4, 81, 109, leader03a, 51);
    giq_option(4, 81, 110, leaderend, 50);
  leader03a: |
    call DownReact;
    call leader30;
  leader04: |
    gsay_reply(81, 111);
    if (global_var(553) != 1) then begin
      giq_option(4, 81, 112, leader05, 50);
    end
    else begin
      giq_option(4, 81, 113, leader23, 50);
    end
    giq_option(5, 81, 114, leader04a, 50);
    giq_option(5, 81, 115, leader04b, 51);
  leader04a: |
    if (global_var(553) != 1) then begin
      call leader06;
    end
    else begin
      call leader07;
    end
  leader04b: |
    call DownReact;
    call leader05;
  leader05: |
    gsay_reply(81, 116);
    giq_option(4, 81, 117, leader05a, 51);
    giq_option(4, 81, 118, leader06, 50);
  leader05a: |
    call DownReact;
    call leader06;
  leader06: |
    gsay_reply(81, 119);
    giq_option(4, 81, 120, leader07, 50);
    giq_option(4, 81, 121, leader06a, 51);
    giq_option(4, 81, 122, leader08, 50);
    giq_option(4, 81, 123, leader06b, 51);
  leader06a: |
    call DownReact;
    call leader08;
  leader06b: |
    call DownReact;
    call leader07;
  leader07: |
    gsay_reply(81, 124);
    giq_option(6, 81, 125, leader25, 50);
    giq_option(4, 81, 126, leader09, 50);
    giq_option(4, 81, 127, leader24, 50);
  leader08: |
    gsay_reply(81, 128);
    giq_option(4, 81, 129, leaderend, 50);
    giq_option(4, 81, 130, leader09, 50);
  leader09: |
    gsay_reply(81, 131);
    giq_option(4, 81, 129, leader10, 50);
  leader10: |
    gsay_reply(81, 132);
    giq_option(4, 81, 133, leader10a, 51);
    giq_option(4, 81, 134, leader11, 50);
    giq_option(4, 81, 135, leader11, 50);
  leader10a: |
    call DownReact;
    call leader13;
  leader11: |
    gsay_reply(81, 136);
    giq_option(4, 81, 137, leader12, 50);
    giq_option(4, 81, 138, leader14, 50);
  leader12: |
    gsay_message(81, 139, 50);
    call leadercbt;
  leader13: |
    gsay_reply(81, 140);
    giq_option(4, 81, 141, leader11, 50);
    giq_option(4, 81, 142, leadercbt, 51);
  leader14: |
    gsay_reply(81, 143);
    giq_option(4, 81, 144, leader15, 50);
    if (has_parts) then begin
      giq_option(4, 81, 145, leader21, 50);
    end
  leader15: |
    gsay_reply(81, 146);
    giq_option(4, 81, 147, leader12, 50);
    giq_option(4, 81, 148, leader15b, 50);
    giq_option(4, 81, 149, leader15a, 51);
  leader15a: |
    call DownReact;
    call leader15b;
  leader15b: |
    if (global_var(31) != 2) then begin
      set_global_var(31, 1);
    end
    set_local_var(5, 1);
    gsay_reply(81, 150);
    giq_option(4, 81, 151, leaderend, 50);
  leader16: |
    gsay_reply(81, 152);
    giq_option(4, 81, 153, leader17, 50);
    giq_option(4, 81, 154, leader12, 50);
    giq_option(4, 81, 155, leader22, 50);
  leader17: 'gsay_message(81, 156, 50);

    '
  leader18: |
    gsay_reply(81, 157);
    giq_option(4, 81, 158, leader19, 50);
    giq_option(4, 81, 159, leader12, 50);
  leader19: |
    set_local_var(6, 1);
    repair_skill := has_skill(dude_obj, 13);
    if (repair_skill < 60) then begin
      call leader19a;
    end
    else begin
      call leader19b;
    end
  leader19a: |
    stuff := create_object_sid(76, 0, 0, -1);
    add_obj_to_inven(dude_obj, stuff);
    stuff := create_object_sid(76, 0, 0, -1);
    add_obj_to_inven(dude_obj, stuff);
    stuff := create_object_sid(76, 0, 0, -1);
    add_obj_to_inven(dude_obj, stuff);
    gsay_message(81, 160, 50);
  leader19b: 'gsay_message(81, 161, 50);

    '
  leader20: |
    gsay_reply(81, 162);
    giq_option(4, 81, 163, leader17, 50);
    giq_option(4, 81, 164, leader12, 50);
  leader21: |
    gsay_reply(81, 165);
    giq_option(4, 81, 166, leader19, 50);
    giq_option(4, 81, 167, leader12, 50);
  leader22: |
    gsay_reply(81, 168);
    giq_option(4, 81, 169, leaderend, 50);
  leader23: |
    gsay_reply(81, 170);
    giq_option(4, 81, 171, leader07, 50);
  leader24: |
    gsay_reply(81, 172);
    giq_option(4, 81, 173, leader09, 50);
    giq_option(4, 81, 129, leader10, 50);
  leader25: |
    gsay_reply(81, 174);
    giq_option(4, 81, 175, leader09, 50);
    giq_option(4, 81, 176, leader24, 50);
  leader26: |
    gsay_reply(81, 177);
    giq_option(4, 81, 178, leaderend, 50);
  leader27: |
    gsay_reply(81, 179);
    giq_option(4, 81, 180, leader28, 50);
  leader28: |
    gsay_reply(81, 181);
    giq_option(4, 81, 129, leaderend, 50);
  leader29: |
    gsay_reply(81, 182);
    if (local_var(5) == 1) then begin
      giq_option(4, 81, 183, leader22, 50);
    end
    giq_option(4, 81, 184, leader12, 50);
    giq_option(4, 81, 185, leader31, 50);
  leader30: 'gsay_message(81, 186, 50);

    '
  leader31: |
    gsay_reply(81, 187);
    giq_option(4, 81, 189, leader15, 50);
    if (has_parts) then begin
      giq_option(4, 81, 145, leader21, 50);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
lemmy:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(846, 100));
  critter_p_proc: |
    variable LVar0 := 0;
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (SetDayNight == 0) then begin
      add_timer_event(self_obj, game_ticks(random(5, 20)), 1);
      SetDayNight := 1;
    end
    if (local_var(6) == 0) then begin
      if ((((game_time / 10) - lastPsst) >= 10) and (tile_distance_objs(self_obj, dude_obj) <= 6)) then begin
        lastPsst := game_time / 10;
        float_msg(self_obj, message_str(846, 101), 2);
      end
    end
    LVar0 := tile_num(self_obj);
    if ((LVar0 == 21917) or (LVar0 == 20116) or (LVar0 == 25318)) then begin
      if (anim_busy(self_obj) == 0) then begin
        if (has_trait(1, self_obj, 10) != 3) then begin
          anim(self_obj, 1000, 3);
        end
      end
    end
    else begin
      if (LVar0 == 26327) then begin
        if (anim_busy(self_obj) == 0) then begin
          if (has_trait(1, self_obj, 10) != 2) then begin
            anim(self_obj, 1000, 2);
          end
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    set_local_var(6, 1);
    if (local_var(4) == 0) then begin
      set_local_var(4, 1);
      start_gdialog(846, self_obj, 4, -1, -1);
      gsay_start;
      call Lemmy01;
      gsay_end;
      end_dialogue;
    end
    else begin
      if (local_var(5) == 1) then begin
        start_gdialog(846, self_obj, 4, -1, -1);
        gsay_start;
        call Lemmy26;
        gsay_end;
        end_dialogue;
      end
      else begin
        start_gdialog(846, self_obj, 4, -1, -1);
        gsay_start;
        call Lemmy27;
        gsay_end;
        end_dialogue;
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    variable LVar0 := 0;
    if (Only_Once) then begin
      Only_Once := 0;
      if (local_var(7) == 0) then begin
        set_local_var(7, 1);
        LVar0 := item_caps_adjust(self_obj, 500);
      end
      critter_add_trait(self_obj, 1, 6, 41);
      critter_add_trait(self_obj, 1, 5, 51);
      LastMove := 21325;
    end
  timed_event_p_proc: 'call SendLemmyAtDay;

    '
  combat: 'hostile := 1;

    '
  SendLemmyAtDay: |
    variable LVar0 := 0;
    Destination := 0;
    LVar0 := random(25, 45);
    while(Destination == 0) do begin
      Destination := random(1, 9);
      if (Destination == 1) then begin
        Destination := 25931;
      end
      else begin
        if (Destination == 2) then begin
          Destination := 25551;
        end
        else begin
          if (Destination == 3) then begin
            Destination := 21325;
          end
          else begin
            if (Destination == 4) then begin
              Destination := 21917;
            end
            else begin
              if (Destination == 5) then begin
                Destination := 18925;
              end
              else begin
                if (Destination == 6) then begin
                  Destination := 23322;
                end
                else begin
                  if (Destination == 7) then begin
                    Destination := 26327;
                  end
                  else begin
                    if (Destination == 8) then begin
                      Destination := 20116;
                    end
                    else begin
                      if (Destination == 9) then begin
                        Destination := 25318;
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
      if (Destination == LastMove) then begin
        Destination := 0;
      end
    end
    LastMove := Destination;
    reg_anim_func(2, self_obj);
    reg_anim_func(1, 1);
    reg_anim_obj_move_to_tile(self_obj, Destination, -1);
    reg_anim_func(3, 0);
    rm_timer_event(self_obj);
    add_timer_event(self_obj, game_ticks(LVar0), 1);
  Lemmy01: |
    gsay_reply(846, 102);
    giq_option(4, 846, 103, Lemmy03, 50);
    giq_option(4, 846, 104, Lemmy04, 50);
    giq_option(4, 846, 105, Lemmy05, 50);
    giq_option(-3, 846, 106, Lemmy02, 50);
  Lemmy02: |
    gsay_reply(846, 107);
    giq_option(-3, 846, 108, LemmyEnd, 50);
  Lemmy03: |
    set_local_var(5, 1);
    gsay_message(846, 109, 50);
  Lemmy04: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(846, 110);
    end
    else begin
      gsay_reply(846, 178);
    end
    giq_option(4, 846, 111, Lemmy06, 50);
    giq_option(4, 846, 112, LemmyCombat, 51);
    giq_option(5, 846, 113, Lemmy03, 50);
  Lemmy05: |
    gsay_reply(846, 114);
    if (global_var(236) != 1) then begin
      giq_option(4, 846, 116, Lemmy23, 50);
    end
    giq_option(4, 846, 117, Lemmy09, 50);
    giq_option(4, 846, 118, Lemmy03, 50);
  Lemmy06: |
    gsay_reply(846, 119);
    giq_option(4, 846, 120, Lemmy05, 50);
    giq_option(4, 846, 121, Lemmy09, 50);
    giq_option(4, 846, 123, Lemmy08, 50);
  Lemmy08: 'gsay_message(846, 128, 50);

    '
  Lemmy09: |
    gsay_reply(846, 129);
    call Lemmy18;
  Lemmy10: |
    gsay_reply(846, 130);
    giq_option(4, 846, 131, Lemmy10a, 50);
    giq_option(4, 846, 132, Lemmy10b, 50);
    giq_option(4, 846, 133, Lemmy10c, 50);
    giq_option(4, 846, 134, Lemmy08, 50);
  Lemmy10a: |
    variable LVar0 := 0;
    if (item_caps_total(dude_obj) >= 500) then begin
      LVar0 := item_caps_adjust(dude_obj, -500);
      call Lemmy13;
    end
    else begin
      call Lemmy11;
    end
  Lemmy10b: |
    variable LVar0 := 0;
    if (is_success(do_check(dude_obj, 3, -3)) or is_success(roll_vs_skill(dude_obj, 15, -30))) then begin
      if (item_caps_total(dude_obj) >= 400) then begin
        LVar0 := item_caps_adjust(dude_obj, -400);
        call Lemmy14;
      end
      else begin
        call Lemmy11;
      end
    end
    else begin
      call Lemmy11;
    end
  Lemmy10c: |
    if (is_success(do_check(dude_obj, 0, -3))) then begin
      call Lemmy15;
    end
    else begin
      call Lemmy12;
    end
  Lemmy11: 'gsay_message(846, 135, 50);

    '
  Lemmy12: |
    set_local_var(5, 1);
    gsay_message(846, 136, 51);
  Lemmy13: |
    gsay_message(846, 137, 50);
    call Lemmy16;
  Lemmy14: |
    gsay_message(846, 138, 50);
    call Lemmy16;
  Lemmy15: |
    gsay_message(846, 139, 50);
    call Lemmy16;
  Lemmy16: |
    gsay_reply(846, 140);
    giq_option(4, 846, 141, Lemmy17, 50);
    giq_option(4, 846, 142, Lemmy08, 50);
  Lemmy17: |
    gsay_message(846, 143, 50);
    call Lemmy18;
  Lemmy18: |
    if (global_var(101) != 2) then begin
      giq_option(4, 846, 144, Lemmy10, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 846, 145, Lemmy19, 50);
    end
    if (map_var(41) == 1) then begin
      giq_option(4, 846, 146, Lemmy20, 50);
    end
    if (global_var(236) != 1) then begin
      giq_option(4, 846, 147, Lemmy23, 50);
    end
    giq_option(4, 846, 148, Lemmy08, 50);
    giq_option(-3, 846, 106, Lemmy02, 50);
  Lemmy19: |
    gsay_reply(846, 149);
    giq_option(4, 846, 150, Lemmy17, 50);
    giq_option(4, 846, 151, Lemmy08, 50);
  Lemmy20: |
    gsay_reply(846, 152);
    giq_option(4, 846, 153, Lemmy20a, 50);
    giq_option(4, 846, 154, Lemmy20b, 50);
    giq_option(4, 846, 155, Lemmy20c, 50);
    giq_option(4, 846, 156, Lemmy08, 50);
  Lemmy20a: |
    variable LVar0 := 0;
    if (item_caps_total(dude_obj) >= 300) then begin
      LVar0 := item_caps_adjust(dude_obj, -300);
      call Lemmy20d;
    end
    else begin
      call Lemmy11;
    end
  Lemmy20b: |
    variable LVar0 := 0;
    if (is_success(do_check(dude_obj, 3, -3)) or is_success(roll_vs_skill(dude_obj, 15, -30))) then begin
      if (item_caps_total(dude_obj) >= 240) then begin
        LVar0 := item_caps_adjust(dude_obj, -240);
        call Lemmy20e;
      end
      else begin
        call Lemmy11;
      end
    end
    else begin
      call Lemmy11;
    end
  Lemmy20c: |
    if (is_success(do_check(dude_obj, 0, -3))) then begin
      call Lemmy20f;
    end
    else begin
      call Lemmy12;
    end
  Lemmy20d: |
    gsay_message(846, 137, 50);
    call Lemmy21;
  Lemmy20e: |
    gsay_message(846, 138, 50);
    call Lemmy21;
  Lemmy20f: |
    gsay_message(846, 139, 50);
    call Lemmy21;
  Lemmy21: |
    gsay_reply(846, 157);
    giq_option(4, 846, 158, Lemmy22, 50);
    giq_option(4, 846, 159, Lemmy17, 50);
    giq_option(4, 846, 160, Lemmy08, 50);
  Lemmy22: |
    gsay_reply(846, 161);
    giq_option(4, 846, 162, Lemmy17, 50);
    giq_option(4, 846, 163, LemmyCombat, 51);
    giq_option(4, 846, 164, Lemmy08, 50);
  Lemmy23: |
    gsay_reply(846, 165);
    giq_option(4, 846, 166, Lemmy24, 50);
    giq_option(4, 846, 167, Lemmy08, 50);
  Lemmy24: |
    gsay_reply(846, 168);
    giq_option(4, 846, 169, Lemmy24a, 50);
    giq_option(4, 846, 170, Lemmy24b, 50);
    giq_option(4, 846, 171, Lemmy24c, 50);
    giq_option(4, 846, 172, Lemmy08, 50);
  Lemmy24a: |
    variable LVar0 := 0;
    if (item_caps_total(dude_obj) >= 1000) then begin
      LVar0 := item_caps_adjust(dude_obj, -1000);
      call Lemmy24d;
    end
    else begin
      call Lemmy11;
    end
  Lemmy24b: |
    variable LVar0 := 0;
    if (is_success(do_check(dude_obj, 3, -3)) or is_success(roll_vs_skill(dude_obj, 15, -30))) then begin
      if (item_caps_total(dude_obj) >= 800) then begin
        LVar0 := item_caps_adjust(dude_obj, -800);
        call Lemmy24e;
      end
      else begin
        call Lemmy11;
      end
    end
    else begin
      call Lemmy11;
    end
  Lemmy24c: |
    if (is_success(do_check(dude_obj, 0, -3))) then begin
      call Lemmy24f;
    end
    else begin
      call Lemmy12;
    end
  Lemmy24d: |
    gsay_message(846, 137, 50);
    call Lemmy25;
  Lemmy24e: |
    gsay_message(846, 138, 50);
    call Lemmy25;
  Lemmy24f: |
    gsay_message(846, 139, 50);
    call Lemmy25;
  Lemmy25: |
    set_global_var(236, 1);
    gsay_reply(846, 173);
    giq_option(4, 846, 174, Lemmy17, 50);
    giq_option(4, 846, 175, Lemmy08, 50);
  Lemmy26: 'gsay_message(846, 176, 50);

    '
  Lemmy27: |
    gsay_reply(846, 177);
    call Lemmy18;
  LemmyEnd: "[]"
  LemmyCombat: |
    set_local_var(5, 1);
    call combat;
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
lenore:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(890, 108));
  talk_p_proc: |
    if (global_var(5)) then begin
      call Lenore02;
    end
    else begin
      if (not(map_var(5))) then begin
        call Lenore04;
      end
      else begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
          call Lenore01;
        end
        else begin
          call Lenore03;
        end
      end
    end
  critter_p_proc: |
    if (map_var(7)) then begin
      call Lenore00;
    end
    if (not(map_var(5))) then begin
      call go_inside;
    end
  pickup_p_proc: 'attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);

    '
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 7) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  map_enter_p_proc: |
    if (not(GVar2)) then begin
      critter_add_trait(self_obj, 1, 6, 5);
      GVar2 := 1;
    end
  go_inside: |
    animate_move_obj_to_tile(self_obj, home_tile, 0);
    if (anim_busy(self_obj) == 0) then begin
      anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), home_tile));
    end
  Lenore00: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 3);
    if (LVar0 == 1) then begin
      LVar1 := message_str(890, 101);
    end
    else begin
      if (LVar0 == 2) then begin
        LVar1 := message_str(890, 102);
      end
      else begin
        set_global_var(187, 1);
        LVar1 := message_str(890, 103);
      end
    end
    if (map_var(5)) then begin
      float_msg(self_obj, LVar1, 0);
    end
    set_map_var(7, 0);
  Lenore01: |
    if (map_var(5)) then begin
      float_msg(self_obj, message_str(890, 104), 0);
    end
  Lenore02: |
    if (not(map_var(5))) then begin
      float_msg(self_obj, message_str(890, 105), 0);
    end
  Lenore03: |
    float_msg(self_obj, message_str(890, 106), 0);
    set_map_var(6, 1);
  Lenore04: 'float_msg(self_obj, message_str(890, 107), 0);

    '
leon:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(596, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (map_var(16) == 0) then begin
      set_map_var(16, 1);
      call Leon00;
    end
    else begin
      call Leon01;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      call Leon02;
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      Leon_Ptr := self_obj;
      critter_add_trait(self_obj, 1, 6, 73);
      critter_add_trait(self_obj, 1, 5, 4);
    end
  Leon00: |
    float_msg(Guido_Ptr, message_str(576, 101), 2);
    float_msg(self_obj, message_str(596, 105), 3);
    add_timer_event(self_obj, game_ticks(3), 1);
    add_timer_event(Guido_Ptr, game_ticks(3), 1);
  Leon01: 'float_msg(self_obj, message_str(596, 101), 3);

    '
  Leon02: |
    float_msg(Guido_Ptr, message_str(576, 102), 2);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      float_msg(self_obj, message_str(596, 102), 3);
    end
    else begin
      float_msg(self_obj, message_str(596, 103), 3);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
libcomp:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(134, 100));
  use_p_proc: |
    script_overrides;
    display_msg(message_str(134, 105));
  use_skill_on_p_proc: |
    if (action_being_used == 12) then begin
      script_overrides;
      display_msg(message_str(134, 101));
      if (local_var(0)) then begin
        display_msg(message_str(134, 102));
        game_time_advance(game_ticks(3600));
      end
      else begin
        if (is_success(do_check(dude_obj, 4, 0))) then begin
          gfade_out(600);
          display_msg(message_str(134, 103));
          game_time_advance(game_ticks(21600));
          give_exp_points(350);
          display_msg(message_str(766, 103) + 350 + message_str(766, 104));
          set_local_var(0, 1);
          gfade_in(600);
        end
        else begin
          gfade_out(600);
          display_msg(message_str(134, 104));
          game_time_advance(game_ticks(21600));
          set_local_var(0, 1);
          gfade_in(600);
        end
      end
    end
library:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
        display_msg(message_str(806, 100));
      end
    end
livingq:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
        if (is_success(do_check(dude_obj, 4, 0))) then begin
          display_msg(message_str(144, 100));
        end
      end
    end
locker:
  start: |
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 6) then begin
        call use_p_proc;
      end
      else begin
        if (script_action == 4) then begin
          call pickup_p_proc;
        end
        else begin
          if (script_action == 7) then begin
            call use_obj_on_p_proc;
          end
          else begin
            if (script_action == 8) then begin
              call use_skill_on_p_proc;
            end
          end
        end
      end
    end
  use_p_proc: |
    if (local_var(0) == 0) then begin
      script_overrides;
      display_msg(message_str(734, 100));
    end
  pickup_p_proc: 'call use_p_proc;

    '
  use_skill_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar1 := action_being_used;
    LVar0 := roll_vs_skill(dude_obj, 9, -20);
    if (LVar1 == 9) then begin
      script_overrides;
      if (is_success(LVar0)) then begin
        set_local_var(0, 1);
        display_msg(message_str(734, 102));
      end
      else begin
        display_msg(message_str(734, 103));
      end
    end
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := obj_being_used_with;
    LVar1 := roll_vs_skill(dude_obj, 9, 0);
    if (obj_pid(LVar0) == 84) then begin
      script_overrides;
      if (is_success(LVar1)) then begin
        set_local_var(0, 1);
        display_msg(message_str(734, 102));
      end
      else begin
        if (is_critical(LVar1)) then begin
          rm_obj_from_inven(dude_obj, LVar0);
          destroy_object(LVar0);
          display_msg(message_str(734, 101));
        end
        else begin
          display_msg(message_str(734, 103));
        end
      end
    end
  look_at_p_proc: |
    if (local_var(0) == 0) then begin
      script_overrides;
      display_msg(message_str(734, 100));
    end
loneraid:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 6);
      critter_add_trait(self_obj, 1, 5, 20);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 4) then begin
            call pickup_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if ((tile_distance_objs(self_obj, dude_obj) > 8) and (tile_distance_objs(self_obj, dude_obj) < 24)) then begin
        call flee_dude;
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (broken) then begin
      call LoneRaid01;
    end
    else begin
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
        call LoneRaid00;
      end
      else begin
        if (known) then begin
          call LoneRaid02;
        end
        else begin
          start_gdialog(700, self_obj, 4, -1, -1);
          gsay_start;
          known := 1;
          if (global_var(12)) then begin
            call LoneRaid06;
          end
          else begin
            if ((global_var(26) == 2) or global_var(254)) then begin
              call LoneRaid05;
            end
            else begin
              if (global_var(611)) then begin
                call LoneRaid04;
              end
              else begin
                call LoneRaid03;
              end
            end
          end
          gsay_end;
          end_dialogue;
        end
      end
    end
  LoneRaid00: 'float_msg(self_obj, message_str(700, 100), 0);

    '
  LoneRaid01: 'float_msg(self_obj, message_str(700, 101), 0);

    '
  LoneRaid02: 'float_msg(self_obj, message_str(700, 102), 0);

    '
  LoneRaid03: |
    gsay_reply(700, 103);
    giq_option(7, 700, 104, LoneRaid07, 50);
    giq_option(4, 700, 105, LoneRaid03a, 51);
    giq_option(4, 700, 106, LoneRaid09, 50);
    giq_option(4, 700, 107, LoneRaid10, 51);
    giq_option(-3, 700, 108, LoneRaid11, 51);
    giq_option(-3, 700, 109, LoneRaid12, 50);
  LoneRaid03a: |
    if ((get_critter_stat(dude_obj, 0) + get_critter_stat(dude_obj, 2)) > 13) then begin
      call LoneRaid08;
    end
    else begin
      call LoneRaidCombat;
    end
  LoneRaid04: |
    gsay_reply(700, 110 + (get_critter_stat(dude_obj, 34) == 1));
    giq_option(7, 700, 112, LoneRaid13, 49);
    giq_option(4, 700, 113, LoneRaid04a, 50);
    giq_option(4, 700, 114, LoneRaid16, 50);
    giq_option(4, 700, 115, LoneRaid17, 50);
    giq_option(-3, 700, 109, LoneRaid12, 50);
  LoneRaid04a: |
    if (get_critter_stat(dude_obj, 6) < 5) then begin
      call LoneRaid14;
    end
    else begin
      call LoneRaid15;
    end
  LoneRaid05: |
    gsay_reply(700, 116);
    if ((global_var(103) == 1) and (global_var(26) == 1)) then begin
      giq_option(7, 700, 117, LoneRaid18, 50);
    end
    giq_option(4, 700, 118, LoneRaid03a, 51);
    giq_option(4, 700, 119, LoneRaid09, 50);
    giq_option(4, 700, 120, LoneRaid10, 51);
    giq_option(-3, 700, 108, LoneRaid11, 51);
    giq_option(-3, 700, 109, LoneRaid12, 50);
  LoneRaid06: |
    gsay_reply(700, 121);
    giq_option(7, 700, 122, LoneRaid18, 50);
    giq_option(4, 700, 123, LoneRaid19, 51);
    giq_option(4, 700, 124, LoneRaid20, 50);
    giq_option(4, 700, 125, LoneRaid21, 50);
    giq_option(-3, 700, 109, LoneRaid12, 50);
  LoneRaid07: |
    gsay_reply(700, 126);
    giq_option(4, 700, 127, LoneRaid03a, 50);
    giq_option(4, 700, 128, LoneRaid09, 50);
    giq_option(4, 700, 129, LoneRaid22, 51);
  LoneRaid08: |
    broken := 1;
    gsay_reply(700, 130);
    giq_option(0, 634, 106, LoneRaidLoot, 50);
  LoneRaid09: 'gsay_message(700, 131, 50);

    '
  LoneRaid10: 'gsay_message(700, 132, 51);

    '
  LoneRaid11: 'gsay_message(700, 133, 51);

    '
  LoneRaid12: 'gsay_message(700, 135, 50);

    '
  LoneRaid13: 'gsay_message(700, 135 + (get_critter_stat(dude_obj, 34) == 1), 49);

    '
  LoneRaid14: |
    gsay_message(700, 137, 51);
    hostile := 1;
  LoneRaid15: 'gsay_message(700, 138 + (get_critter_stat(dude_obj, 34) == 1), 50);

    '
  LoneRaid16: 'gsay_message(700, 140, 50);

    '
  LoneRaid17: 'gsay_message(700, 141 + (get_critter_stat(dude_obj, 34) == 1), 49);

    '
  LoneRaid18: 'gsay_message(700, 143, 50);

    '
  LoneRaid19: |
    gsay_message(700, 144, 51);
    hostile := 1;
  LoneRaid20: 'gsay_message(700, 145, 50);

    '
  LoneRaid21: 'gsay_message(700, 146, 49);

    '
  LoneRaid22: |
    gsay_message(700, 147, 51);
    hostile := 1;
  LoneRaidCombat: 'hostile := 1;

    '
  LoneRaidEnd: "[]"
  LoneRaidLoot: |
    gdialog_mod_barter(0);
    giq_option(0, 634, 103, LoneRaidEnd, 51);
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 0);
lookout:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 31);
      critter_add_trait(self_obj, 1, 5, 41);
      init_teams := 1;
    end
    if (script_action == 11) then begin
      call talk_p_proc;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(109, 100));
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            if (Hostile) then begin
              Hostile := 0;
              attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
            end
            else begin
              if (local_var(0) == 0) then begin
                if ((global_var(30) == 1) and (global_var(31) != 2)) then begin
                  if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 5)) then begin
                    set_local_var(0, 1);
                    call guilt;
                  end
                end
              end
            end
          end
          else begin
            if (script_action == 18) then begin
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(159, global_var(159) + 1);
                if ((global_var(159) % 2) == 0) then begin
                  set_global_var(155, global_var(155) - 1);
                end
              end
            end
          end
        end
      end
    end
  spies: 'float_msg(self_obj, message_str(109, 101), 0);

    '
  guilt: |
    if (random(0, 1)) then begin
      float_msg(self_obj, message_str(109, 200), 0);
    end
    else begin
      float_msg(self_obj, message_str(109, 201), 0);
    end
  talk_p_proc: |
    if ((global_var(30) == 1) and (global_var(31) != 2)) then begin
      call guilt;
    end
    else begin
      call spies;
    end
lorenzo:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(597, 100));
  critter_p_proc: |
    variable LVar0 := 0;
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (SetDayNight == 0) then begin
      add_timer_event(self_obj, game_ticks(random(5, 20)), 1);
      SetDayNight := 1;
    end
    if (map_var(55) == 2) then begin
      hostile := 1;
      float_msg(self_obj, message_str(597, 247), 2);
    end
    else begin
      if (map_var(55) == 1) then begin
        set_map_var(55, 0);
        VaultCount := VaultCount + 1;
        float_msg(self_obj, message_str(597, 246), 2);
        if (VaultCount >= 2) then begin
          hostile := 1;
          float_msg(self_obj, message_str(597, 247), 2);
        end
      end
    end
    LVar0 := tile_num(self_obj);
    if ((LVar0 == 22312) or (LVar0 == 23106) or (LVar0 == 24106)) then begin
      if (anim_busy(self_obj) == 0) then begin
        if (has_trait(1, self_obj, 10) != 0) then begin
          anim(self_obj, 1000, 0);
        end
      end
    end
    else begin
      if (LVar0 == 21112) then begin
        if (anim_busy(self_obj) == 0) then begin
          if (has_trait(1, self_obj, 10) != 5) then begin
            anim(self_obj, 1000, 5);
          end
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    variable LVar0 := 0;
    call Get_Stuff;
    call get_reaction;
    if (((game_time / 10) - local_var(16)) > (60 * 60 * 24 * 3)) then begin
      set_local_var(16, game_time / 10);
      set_local_var(17, random(1000, 3000));
      LVar0 := item_caps_adjust(self_obj, local_var(17));
    end
    else begin
      LVar0 := item_caps_adjust(self_obj, local_var(17));
    end
    if (map_var(22) == 1) then begin
      call Lorenzo04;
    end
    else begin
      if ((map_var(22) == 0) and ((map_var(11) == 1) or (map_var(44) == 1))) then begin
        call Lorenzo00;
      end
      else begin
        if ((local_var(6) > 0) and (((game_time / (10 * 60 * 60 * 24)) - local_var(5)) > 10)) then begin
          call Lorenzo01;
        end
        else begin
          if (local_var(6) > 0) then begin
            call Lorenzo02;
          end
          else begin
            call Lorenzo05;
          end
        end
      end
    end
    set_local_var(17, item_caps_total(self_obj));
    LVar0 := item_caps_adjust(self_obj, -1 * local_var(17));
    call Put_Stuff;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  timed_event_p_proc: 'call SendInsideHouse;

    '
  map_enter_p_proc: |
    variable LVar0 := 0;
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 73);
      critter_add_trait(self_obj, 1, 5, 85);
      LastMove := 23309;
    end
  combat: 'hostile := 1;

    '
  Get_Stuff: |
    variable LVar0 := 0;
    LVar0 := obj_carrying_pid_obj(self_obj, 9);
    rm_obj_from_inven(self_obj, LVar0);
    destroy_object(LVar0);
    move_obj_inven_to_obj(Loren_Box_Ptr, self_obj);
  Put_Stuff: |
    move_obj_inven_to_obj(self_obj, Loren_Box_Ptr);
    add_obj_to_inven(self_obj, create_object_sid(9, 0, 0, -1));
    wield_obj_critter(self_obj, obj_carrying_pid_obj(self_obj, 9));
  SendInsideHouse: |
    variable LVar0 := 0;
    Destination := 0;
    LVar0 := random(10, 30);
    while(Destination == 0) do begin
      Destination := random(1, 5);
      if (Destination == 1) then begin
        Destination := 23309;
      end
      else begin
        if (Destination == 2) then begin
          Destination := 21112;
        end
        else begin
          if (Destination == 3) then begin
            Destination := 22312;
          end
          else begin
            if (Destination == 4) then begin
              Destination := 23106;
            end
            else begin
              if (Destination == 5) then begin
                Destination := 24104;
              end
            end
          end
        end
      end
      if (Destination == LastMove) then begin
        Destination := 0;
      end
    end
    LastMove := Destination;
    reg_anim_func(2, self_obj);
    reg_anim_func(1, 1);
    reg_anim_obj_move_to_tile(self_obj, Destination, -1);
    reg_anim_func(3, 0);
    rm_timer_event(self_obj);
    add_timer_event(self_obj, game_ticks(LVar0), 1);
  Lorenzo00: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      float_msg(self_obj, message_str(597, 101), 2);
    end
    else begin
      float_msg(self_obj, message_str(597, 102), 2);
    end
    set_map_var(22, 1);
    set_map_var(18, 1);
  Lorenzo01: |
    variable LVar0 := 0;
    start_gdialog(597, self_obj, 4, -1, -1);
    gsay_start;
    LVar0 := (local_var(6) / 10 * ((game_time / (10 * 60 * 60 * 24)) - local_var(5))) + local_var(6);
    gsay_reply(597, 103);
    giq_option(4, 597, 104, Lorenzo14, 51);
    giq_option(4, 597, 105, Lorenzo15, 51);
    if ((local_var(6) > 0) == 1) then begin
      giq_option(4, 597, message_str(597, 106) + LVar0 + message_str(597, 107), Lorenzo16, 50);
    end
    giq_option(4, 597, 108, Lorenzo15, 51);
    gsay_end;
    end_dialogue;
  Lorenzo02: |
    variable LVar0 := 0;
    start_gdialog(597, self_obj, 4, -1, -1);
    gsay_start;
    LVar0 := (local_var(6) / 10 * ((game_time / (10 * 60 * 60 * 24)) - local_var(5))) + local_var(6);
    gsay_reply(597, 109);
    giq_option(4, 597, 110, Lorenzo02a, 50);
    giq_option(4, 597, 111, Lorenzo08, 50);
    if (local_var(6) > 0) then begin
      giq_option(4, 597, message_str(597, 106) + LVar0 + message_str(597, 107), Lorenzo09, 50);
    end
    giq_option(4, 597, 112, Lorenzo12, 50);
    giq_option(-3, 597, 113, Lorenzo13, 50);
    gsay_end;
    end_dialogue;
  Lorenzo02a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Lorenzo06;
    end
    else begin
      call Lorenzo07;
    end
  Lorenzo04: |
    float_msg(self_obj, message_str(597, 114), 2);
    call combat;
  Lorenzo05: |
    start_gdialog(597, self_obj, 4, -1, -1);
    gsay_start;
    set_map_var(18, 1);
    if (local_var(10) == 0) then begin
      gsay_reply(597, 115);
      set_local_var(10, 1);
    end
    else begin
      gsay_reply(597, 1115);
    end
    giq_option(4, 597, 110, Lorenzo02a, 50);
    giq_option(4, 597, 116, Lorenzo19, 50);
    giq_option(4, 597, 117, Lorenzo20, 51);
    giq_option(4, 597, 112, Lorenzo12, 50);
    giq_option(-3, 597, 113, Lorenzo21, 50);
    if ((global_var(636) == 1) and (map_var(55) == 0)) then begin
      giq_option(4, 597, 300, seif00, 50);
      giq_option(-3, 597, 305, Lorenzo21, 50);
    end
    gsay_end;
    end_dialogue;
  Lorenzo06: |
    gsay_reply(597, 118);
    if (global_var(106) == 1) then begin
      giq_option(4, 597, 119, Lorenzo22, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 597, 120, Lorenzo23, 50);
    end
    giq_option(4, 597, 121, Lorenzo24, 50);
    giq_option(4, 597, 122, Lorenzo25, 50);
    giq_option(4, 597, 123, Lorenzo26, 50);
    giq_option(4, 597, 124, Lorenzo27, 50);
  Lorenzo07: |
    if (map_var(19) == 0) then begin
      gsay_message(597, 125, 51);
      set_map_var(19, 1);
    end
    else begin
      set_map_var(22, 1);
      gsay_message(597, 126, 51);
    end
  Lorenzo08: 'gsay_message(597, 127, 50);

    '
  Lorenzo09: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := (local_var(6) / 10 * ((game_time / (10 * 60 * 60 * 24)) - local_var(5))) + local_var(6);
    if (item_caps_total(dude_obj) >= LVar0) then begin
      LVar1 := item_caps_adjust(dude_obj, -1 * LVar0);
      set_local_var(6, 0);
      set_local_var(5, 0);
      gsay_reply(597, 128);
      giq_option(4, 597, 130, Lorenzo09a, 50);
      giq_option(4, 597, 131, Lorenzo19, 50);
      giq_option(4, 597, 132, Lorenzo12, 50);
    end
    else begin
      gsay_reply(597, 129);
      giq_option(4, 597, 130, Lorenzo07, 50);
      giq_option(4, 597, 131, Lorenzo08, 50);
      giq_option(4, 597, 132, Lorenzo12, 50);
    end
  Lorenzo09a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 20))) then begin
      call Lorenzo06;
    end
    else begin
      call Lorenzo07;
    end
  Lorenzo12: 'gsay_message(597, 133, 50);

    '
  Lorenzo13: |
    set_map_var(22, 1);
    gsay_message(597, 134, 51);
  Lorenzo14: |
    set_map_var(44, 1);
    set_map_var(11, 1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(597, 135, 51);
    end
    else begin
      gsay_message(597, 136, 51);
    end
    call combat;
  Lorenzo15: |
    variable LVar0 := 0;
    LVar0 := (local_var(6) / 10 * ((game_time / (10 * 60 * 60 * 24)) - local_var(5))) + local_var(6);
    gsay_reply(597, 248);
    if (item_caps_total(dude_obj) < LVar0) then begin
      giq_option(4, 597, 249, Lorenzo15a, 50);
    end
    else begin
      giq_option(4, 597, 250, Lorenzo15b, 50);
      giq_option(4, 597, message_str(597, 251) + (LVar0 * 3 / 4) + message_str(597, 252), Lorenzo15c, 50);
      giq_option(4, 597, message_str(597, 251) + (LVar0 / 2) + message_str(597, 252), Lorenzo15d, 50);
      giq_option(4, 597, message_str(597, 251) + (LVar0 / 4) + message_str(597, 252), Lorenzo15e, 50);
    end
    giq_option(4, 597, 253, Lorenzo15f, 51);
  Lorenzo15a: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := (local_var(6) / 10 * ((game_time / (10 * 60 * 60 * 24)) - local_var(5))) + local_var(6);
    LVar1 := item_caps_adjust(dude_obj, -item_caps_total(dude_obj));
    set_map_var(22, 1);
    set_local_var(6, 0);
    set_local_var(5, 0);
    gsay_message(597, 254, 50);
    gsay_message(597, 259, 51);
  Lorenzo15b: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := (local_var(6) / 10 * ((game_time / (10 * 60 * 60 * 24)) - local_var(5))) + local_var(6);
    LVar1 := item_caps_adjust(dude_obj, -1 * LVar0);
    set_map_var(22, 1);
    set_local_var(6, 0);
    set_local_var(5, 0);
    gsay_message(597, 260, 51);
  Lorenzo15c: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := (local_var(6) / 10 * ((game_time / (10 * 60 * 60 * 24)) - local_var(5))) + local_var(6);
    if (is_success(roll_vs_skill(dude_obj, 14, -20)) or is_success(do_check(dude_obj, 3, -1))) then begin
      LVar1 := item_caps_adjust(dude_obj, -1 * (LVar0 * 3 / 4));
      set_map_var(22, 1);
      set_local_var(6, 0);
      set_local_var(5, 0);
      gsay_message(597, message_str(597, 255) + (LVar0 * 3 / 4) + message_str(597, 256), 50);
      gsay_message(597, 259, 51);
    end
    else begin
      set_map_var(22, 1);
      set_map_var(44, 1);
      set_map_var(11, 1);
      set_local_var(6, 0);
      set_local_var(5, 0);
      gsay_message(597, 257, 51);
      call combat;
    end
  Lorenzo15d: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := (local_var(6) / 10 * ((game_time / (10 * 60 * 60 * 24)) - local_var(5))) + local_var(6);
    if (is_success(roll_vs_skill(dude_obj, 14, -30)) or is_success(do_check(dude_obj, 3, -2))) then begin
      LVar1 := item_caps_adjust(dude_obj, -1 * (LVar0 / 2));
      set_map_var(22, 1);
      set_local_var(6, 0);
      set_local_var(5, 0);
      gsay_message(597, message_str(597, 255) + (LVar0 / 2) + message_str(597, 256), 50);
      gsay_message(597, 259, 51);
    end
    else begin
      set_map_var(22, 1);
      set_map_var(44, 1);
      set_map_var(11, 1);
      set_local_var(6, 0);
      set_local_var(5, 0);
      gsay_message(597, 257, 51);
      call combat;
    end
  Lorenzo15e: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := (local_var(6) / 10 * ((game_time / (10 * 60 * 60 * 24)) - local_var(5))) + local_var(6);
    if (is_success(roll_vs_skill(dude_obj, 14, -40)) or is_success(do_check(dude_obj, 3, -3))) then begin
      LVar1 := item_caps_adjust(dude_obj, -1 * (LVar0 / 4));
      set_map_var(22, 1);
      set_local_var(6, 0);
      set_local_var(5, 0);
      gsay_message(597, message_str(597, 255) + (LVar0 / 4) + message_str(597, 256), 50);
      gsay_message(597, 259, 51);
    end
    else begin
      set_map_var(22, 1);
      set_map_var(44, 1);
      set_map_var(11, 1);
      set_local_var(6, 0);
      set_local_var(5, 0);
      gsay_message(597, 257, 51);
      call combat;
    end
  Lorenzo15f: |
    set_map_var(22, 1);
    set_map_var(44, 1);
    set_map_var(11, 1);
    set_local_var(6, 0);
    set_local_var(5, 0);
    gsay_message(597, 258, 51);
    call combat;
  Lorenzo16: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := (local_var(6) / 10 * ((game_time / (10 * 60 * 60 * 24)) - local_var(5))) + local_var(6);
    if (item_caps_total(dude_obj) >= LVar0) then begin
      LVar1 := item_caps_adjust(dude_obj, -1 * LVar0);
      set_local_var(6, 0);
      set_local_var(5, 0);
      gsay_reply(597, 138);
      giq_option(4, 597, 139, Lorenzo16a, 50);
      giq_option(4, 597, 140, Lorenzo28, 50);
      giq_option(4, 597, 141, Lorenzo15, 50);
    end
    else begin
      gsay_message(597, 261, 51);
      call Lorenzo15;
    end
  Lorenzo16a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call Lorenzo06;
    end
    else begin
      call Lorenzo07;
    end
  Lorenzo19: |
    gsay_reply(597, 143);
    if (local_var(7) >= 800) then begin
      giq_option(4, 597, message_str(597, 144) + message_str(597, 145) + message_str(597, 150), Lorenzo29, 50);
    end
    if (local_var(7) >= 600) then begin
      giq_option(4, 597, message_str(597, 144) + message_str(597, 146) + message_str(597, 150), Lorenzo30, 50);
    end
    if (local_var(7) >= 400) then begin
      giq_option(4, 597, message_str(597, 144) + message_str(597, 147) + message_str(597, 150), Lorenzo31, 50);
    end
    if (local_var(7) >= 200) then begin
      giq_option(4, 597, message_str(597, 144) + message_str(597, 148) + message_str(597, 150), Lorenzo32, 50);
    end
    giq_option(4, 597, message_str(597, 144) + message_str(597, 149) + message_str(597, 150), Lorenzo33, 50);
    giq_option(4, 597, 151, Lorenzo34, 50);
  Lorenzo20: |
    set_map_var(44, 1);
    set_map_var(11, 1);
    gsay_message(597, 152, 51);
    call combat;
  Lorenzo21: |
    set_map_var(22, 1);
    gsay_message(597, 153, 50);
  Lorenzo22: |
    gsay_reply(597, 154);
    if (global_var(106) == 1) then begin
      giq_option(4, 597, 155, Lorenzo35, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 597, 156, Lorenzo23, 50);
    end
    giq_option(4, 597, 157, Lorenzo24, 50);
    giq_option(4, 597, 158, Lorenzo25, 50);
    giq_option(4, 597, 159, Lorenzo26, 50);
    giq_option(4, 597, 160, Lorenzo27, 50);
  Lorenzo23: |
    set_map_var(21, 1);
    gsay_reply(597, 161);
    if (global_var(106) == 1) then begin
      giq_option(4, 597, 162, Lorenzo22, 50);
    end
    giq_option(4, 597, 163, Lorenzo36, 50);
    giq_option(4, 597, 164, Lorenzo24, 50);
    giq_option(4, 597, 165, Lorenzo25, 50);
    giq_option(4, 597, 166, Lorenzo26, 50);
    giq_option(4, 597, 167, Lorenzo27, 50);
  Lorenzo24: |
    gsay_reply(597, 168);
    if (global_var(106) == 1) then begin
      giq_option(4, 597, 169, Lorenzo22, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 597, 170, Lorenzo23, 50);
    end
    giq_option(4, 597, 171, Lorenzo37, 50);
    giq_option(4, 597, 172, Lorenzo25, 50);
    giq_option(4, 597, 173, Lorenzo26, 50);
    giq_option(4, 597, 174, Lorenzo27, 50);
  Lorenzo25: |
    gsay_reply(597, 175);
    if (global_var(106) == 1) then begin
      giq_option(4, 597, 176, Lorenzo22, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 597, 177, Lorenzo23, 50);
    end
    giq_option(4, 597, 178, Lorenzo24, 50);
    giq_option(4, 597, 179, Lorenzo38, 50);
    giq_option(4, 597, 180, Lorenzo26, 50);
    giq_option(4, 597, 181, Lorenzo27, 50);
  Lorenzo26: |
    gsay_reply(597, 182);
    if (global_var(106) == 1) then begin
      giq_option(4, 597, 183, Lorenzo22, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 597, 184, Lorenzo23, 50);
    end
    giq_option(4, 597, 185, Lorenzo24, 50);
    giq_option(4, 597, 186, Lorenzo25, 50);
    giq_option(4, 597, 187, Lorenzo39, 50);
    giq_option(4, 597, 188, Lorenzo27, 50);
  Lorenzo27: |
    set_global_var(219, 1);
    set_map_var(21, 1);
    gsay_reply(597, 189);
    if (global_var(106) == 1) then begin
      giq_option(4, 597, 190, Lorenzo22, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 597, 191, Lorenzo23, 50);
    end
    giq_option(4, 597, 192, Lorenzo24, 50);
    giq_option(4, 597, 193, Lorenzo25, 50);
    giq_option(4, 597, 194, Lorenzo26, 50);
    giq_option(4, 597, 195, Lorenzo40, 50);
  Lorenzo28: |
    set_map_var(22, 1);
    gsay_message(597, 196, 51);
  Lorenzo29: |
    variable LVar0 := 0;
    set_local_var(6, 1000);
    set_local_var(5, game_time / (10 * 60 * 60 * 24));
    LVar0 := item_caps_adjust(dude_obj, 1000);
    if (local_var(7) <= 1000) then begin
      set_local_var(7, 1000);
    end
    gsay_message(597, 197, 50);
  Lorenzo30: |
    variable LVar0 := 0;
    set_local_var(6, 800);
    set_local_var(5, game_time / (10 * 60 * 60 * 24));
    LVar0 := item_caps_adjust(dude_obj, 800);
    if (local_var(7) <= 800) then begin
      set_local_var(7, 800);
    end
    gsay_message(597, 198, 50);
  Lorenzo31: |
    variable LVar0 := 0;
    set_local_var(6, 600);
    set_local_var(5, game_time / (10 * 60 * 60 * 24));
    LVar0 := item_caps_adjust(dude_obj, 600);
    if (local_var(7) <= 600) then begin
      set_local_var(7, 600);
    end
    gsay_message(597, 199, 50);
  Lorenzo32: |
    variable LVar0 := 0;
    set_local_var(6, 400);
    set_local_var(5, game_time / (10 * 60 * 60 * 24));
    LVar0 := item_caps_adjust(dude_obj, 400);
    if (local_var(7) <= 400) then begin
      set_local_var(7, 400);
    end
    gsay_message(597, 200, 50);
  Lorenzo33: |
    variable LVar0 := 0;
    set_local_var(6, 200);
    set_local_var(5, game_time / (10 * 60 * 60 * 24));
    LVar0 := item_caps_adjust(dude_obj, 200);
    if (local_var(7) <= 200) then begin
      set_local_var(7, 200);
    end
    gsay_message(597, 201, 50);
  Lorenzo34: 'gsay_message(597, 202, 50);

    '
  Lorenzo35: |
    gsay_reply(597, 203);
    if (global_var(219) == 1) then begin
      giq_option(4, 597, 204, Lorenzo23, 50);
    end
    giq_option(4, 597, 205, Lorenzo24, 50);
    giq_option(4, 597, 206, Lorenzo25, 50);
    giq_option(4, 597, 207, Lorenzo26, 50);
    giq_option(4, 597, 208, Lorenzo27, 50);
    giq_option(4, 597, 209, Lorenzo41, 50);
  Lorenzo36: |
    gsay_reply(597, 210);
    if (global_var(106) == 1) then begin
      giq_option(4, 597, 211, Lorenzo22, 50);
    end
    giq_option(4, 597, 212, Lorenzo24, 50);
    giq_option(4, 597, 213, Lorenzo25, 50);
    giq_option(4, 597, 214, Lorenzo26, 50);
    giq_option(4, 597, 215, Lorenzo27, 50);
    giq_option(4, 597, 216, Lorenzo41, 50);
  Lorenzo37: |
    set_global_var(219, 1);
    gsay_reply(597, 217);
    if (global_var(106) == 1) then begin
      giq_option(4, 597, 218, Lorenzo22, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 597, 219, Lorenzo23, 50);
    end
    giq_option(4, 597, 220, Lorenzo25, 50);
    giq_option(4, 597, 221, Lorenzo26, 50);
    giq_option(4, 597, 222, Lorenzo27, 50);
    giq_option(4, 597, 223, Lorenzo41, 50);
  Lorenzo38: |
    set_global_var(196, 1);
    if (global_var(75) == 0) then begin
      set_global_var(75, 1);
    end
    gsay_reply(597, 224);
    if (global_var(106) == 1) then begin
      giq_option(4, 597, 225, Lorenzo22, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 597, 226, Lorenzo23, 50);
    end
    giq_option(4, 597, 227, Lorenzo24, 50);
    giq_option(4, 597, 228, Lorenzo26, 50);
    giq_option(4, 597, 229, Lorenzo27, 50);
    giq_option(4, 597, 230, Lorenzo41, 50);
  Lorenzo39: |
    gsay_reply(597, 231);
    if (global_var(106) == 1) then begin
      giq_option(4, 597, 232, Lorenzo22, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 597, 233, Lorenzo23, 50);
    end
    giq_option(4, 597, 234, Lorenzo24, 50);
    giq_option(4, 597, 235, Lorenzo25, 50);
    giq_option(4, 597, 236, Lorenzo27, 50);
    giq_option(4, 597, 237, Lorenzo41, 50);
  Lorenzo40: |
    gsay_reply(597, 238);
    if (global_var(106) == 1) then begin
      giq_option(4, 597, 239, Lorenzo22, 50);
    end
    if (global_var(219) == 1) then begin
      giq_option(4, 597, 240, Lorenzo23, 50);
    end
    giq_option(4, 597, 241, Lorenzo24, 50);
    giq_option(4, 597, 242, Lorenzo25, 50);
    giq_option(4, 597, 243, Lorenzo26, 50);
    giq_option(4, 597, 244, Lorenzo41, 50);
  Lorenzo41: 'gsay_message(597, 245, 50);

    '
  seif00: |
    if ((has_skill(dude_obj, 14) > 99) and (get_critter_stat(dude_obj, 4) >= 8)) then begin
      gsay_message(597, 304, 50);
      call seif03;
    end
    else begin
      gsay_reply(597, 301);
      giq_option(1, 597, 302, seif02, 50);
      giq_option(1, 597, 303, seif01, 50);
    end
  seif01: "[]"
  seif02: 'hostile := 1;

    '
  seif03: |
    set_map_var(55, 3);
    gfade_out(400);
    play_sfx("SCWDOXX1");
    gfade_in(400);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
lorri:
  start: |
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        if (not(known)) then begin
          display_msg(message_str(0, 100));
        end
        else begin
          display_msg(message_str(0, 101));
        end
      end
      else begin
        if (script_action == 22) then begin
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
      end
    end
  do_dialogue: |
    start_gdialog(-1, self_obj, 4, -1, -1);
    gsay_start;
    if (known) then begin
      call Lorri04;
    end
    else begin
      call Lorri01;
    end
    gsay_end;
    end_dialogue;
  Lorri01: |
    gsay_reply(0, 102);
    giq_option(4, 0, 103, Lorri02, 50);
    giq_option(4, 0, message_str(0, 104) + proto_data(obj_pid(dude_obj), 1) + message_str(0, 105), Lorri03, 50);
    giq_option(-3, 0, message_str(0, 106), Lorri15, 50);
  Lorri02: |
    gsay_reply(0, 107);
    if (not(known)) then begin
      giq_option(4, 0, 108, Lorri03, 50);
    end
    giq_option(4, 0, 109, Lorri16, 50);
    giq_option(4, 0, 110, Lorri20, 50);
    giq_option(4, 0, 111, Lorri04, 50);
    giq_option(4, 0, 112, Lorri05, 50);
  Lorri03: |
    known := 1;
    gsay_reply(0, 113);
    giq_option(4, 0, 114, Lorri02, 50);
    call Goodbyes;
    giq_option(4, 0, exit_line, Lorri05, 50);
  Lorri04: |
    gsay_reply(0, 115);
    giq_option(4, 0, 116, Lorri06, 50);
    giq_option(4, 0, 117, Lorri07, 50);
    giq_option(4, 0, 118, Lorri02, 50);
  Lorri05: 'gsay_message(0, 119, 50);

    '
  Lorri06: |
    gsay_reply(0, 120);
    giq_option(4, 0, 121, Lorri08, 50);
    giq_option(4, 0, 122, Lorri10, 50);
    giq_option(4, 0, 123, Lorri02, 50);
    giq_option(4, 0, 124, Lorri05, 50);
  Lorri07: |
    gsay_reply(0, 125);
    giq_option(4, 0, 126, Lorri02, 50);
    giq_option(4, 0, 127, Lorri05, 50);
  Lorri08: |
    gsay_message(0, 128, 50);
    gsay_reply(0, 129);
    giq_option(4, 0, 130, Lorri09, 50);
    giq_option(4, 0, 131, Lorri02, 50);
    giq_option(4, 0, 132, Lorri05, 50);
  Lorri09: |
    gsay_reply(0, 133);
    giq_option(4, 0, 134, Lorri12, 50);
    giq_option(4, 0, 135, Lorri02, 50);
    giq_option(4, 0, 136, Lorri05, 50);
  Lorri10: |
    gsay_reply(0, 137);
    giq_option(4, 0, 138, Lorri11, 50);
    giq_option(4, 0, 139, Lorri06, 50);
    giq_option(4, 0, 140, Lorri02, 50);
    giq_option(4, 0, message_str(0, 141), Lorri05, 50);
  Lorri11: |
    gsay_reply(0, 142);
    giq_option(4, 0, 143, Lorri13, 50);
    giq_option(4, 0, 144, Lorri14, 50);
    giq_option(4, 0, 145, Lorri02, 50);
    giq_option(4, 0, 146, Lorri05, 50);
  Lorri12: 'gsay_message(0, 147, 50);

    '
  Lorri13: 'gsay_message(0, 148, 50);

    '
  Lorri14: |
    gsay_reply(0, 149);
    giq_option(4, 0, message_str(0, 150), Lorri02, 50);
    giq_option(4, 0, 151, Lorri05, 50);
  Lorri15: 'gsay_message(0, 152, 50);

    '
  Lorri16: |
    gsay_reply(0, 153);
    giq_option(4, 0, 154, Lorri17, 50);
    giq_option(4, 0, 155, Lorri05, 50);
  Lorri17: |
    gsay_message(0, 156, 50);
    gsay_reply(0, 157);
    giq_option(4, 0, 158, Lorri18, 50);
    giq_option(4, 0, 159, Lorri08, 50);
    giq_option(4, 0, 160, Lorri19, 50);
    giq_option(4, 0, 161, Lorri27, 50);
    giq_option(4, 0, 162, Lorri05, 50);
  Lorri18: |
    gsay_reply(0, 163);
    giq_option(4, 0, 164, Lorri02, 50);
    giq_option(4, 0, 165, Lorri05, 50);
  Lorri19: |
    gsay_reply(0, 166);
    giq_option(4, 0, 167, Lorri08, 50);
    giq_option(4, 0, 168, Lorri02, 50);
    giq_option(4, 0, 169, Lorri05, 50);
  Lorri20: |
    gsay_reply(0, 170);
    if (not(line21flag)) then begin
      giq_option(4, 0, 171, Lorri21, 50);
    end
    if (not(line22flag)) then begin
      giq_option(4, 0, 172, Lorri22, 50);
    end
    if (not(line23flag)) then begin
      giq_option(4, 0, 173, Lorri23, 50);
    end
    if (not(line24flag)) then begin
      giq_option(4, 0, 174, Lorri24, 50);
    end
    if (not(line25flag)) then begin
      giq_option(4, 0, 175, Lorri25, 50);
    end
    giq_option(4, 0, 176, Lorri05, 50);
  Lorri21: |
    gsay_reply(0, 177);
    line21flag := 1;
    call Lorri26;
  Lorri22: |
    gsay_reply(0, 178);
    line22flag := 1;
    call Lorri26;
  Lorri23: |
    gsay_reply(0, 179);
    line23flag := 1;
    call Lorri26;
  Lorri24: |
    gsay_reply(0, 180);
    line24flag := 1;
    call Lorri26;
  Lorri25: |
    gsay_reply(0, 181);
    line25flag := 1;
    call Lorri26;
  Lorri26: |
    giq_option(4, 0, 182, Lorri20, 50);
    giq_option(4, 0, 183, Lorri02, 50);
    call Goodbyes;
    giq_option(4, 0, exit_line, Lorri05, 50);
  Lorri27: 'gsay_message(0, 184, 50);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
lorrian:
  start: |
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        if (known) then begin
          display_msg(message_str(174, 100));
        end
        else begin
          display_msg(message_str(174, 101));
        end
      end
      else begin
        if (script_action == 22) then begin
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
      end
    end
  do_dialogue: |
    start_gdialog(174, self_obj, 4, -1, -1);
    sayStart;
    if (known) then begin
      call Lorri04;
    end
    else begin
      call Lorri01;
    end
    sayEnd;
    end_dialogue;
  Lorri01: |
    sayReply(0, message_str(174, 102));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 103), Lorri02);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 104) + proto_data(obj_pid(dude_obj), 1) + message_str(174, 105), Lorri03);
    end
    if (get_critter_stat(dude_obj, 4) >= -3) then begin
      sayOption(message_str(174, 106), Lorri15);
    end
  Lorri02: |
    sayReply(0, message_str(174, 107));
    if (not(known)) then begin
      if (get_critter_stat(dude_obj, 4) >= 4) then begin
        sayOption(message_str(174, 108), Lorri03);
      end
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 109), Lorri16);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 110), Lorri20);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 111), Lorri04);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 112), Lorri05);
    end
  Lorri03: |
    known := 1;
    sayReply(0, message_str(174, 113));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 114), Lorri02);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 115), Lorri05);
    end
  Lorri04: |
    sayReply(0, message_str(174, 116));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 117), Lorri06);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 118), Lorri07);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 119), Lorri02);
    end
  Lorri05: 'sayMessage(0, message_str(174, 120));

    '
  Lorri06: |
    sayReply(0, message_str(174, 121));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 122), Lorri08);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 123), Lorri10);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 124), Lorri02);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 125), Lorri05);
    end
  Lorri07: |
    sayReply(0, message_str(174, 126));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 127), Lorri02);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 128), Lorri05);
    end
  Lorri08: |
    sayMessage(0, message_str(174, 129));
    sayReply(0, message_str(174, 130));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 131), Lorri09);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 132), Lorri02);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 133), Lorri05);
    end
  Lorri09: |
    sayReply(0, message_str(174, 134));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 135), Lorri12);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 136), Lorri02);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 137), Lorri05);
    end
  Lorri10: |
    sayReply(0, message_str(174, 138));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 139), Lorri11);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 140), Lorri06);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 141), Lorri02);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 142), Lorri05);
    end
  Lorri11: |
    sayReply(0, message_str(174, 143));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 144), Lorri13);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 145), Lorri14);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 146), Lorri02);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 147), Lorri05);
    end
  Lorri12: 'sayMessage(0, message_str(174, 148));

    '
  Lorri13: 'sayMessage(0, message_str(174, 149));

    '
  Lorri14: |
    sayReply(0, message_str(174, 150));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 151), Lorri02);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 152), Lorri05);
    end
  Lorri15: 'sayMessage(0, message_str(174, 153));

    '
  Lorri16: |
    sayReply(0, message_str(174, 154));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 155), Lorri17);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 156), Lorri05);
    end
  Lorri17: |
    sayMessage(0, message_str(174, 157));
    sayReply(0, message_str(174, 158));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 159), Lorri18);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 160), Lorri08);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 161), Lorri19);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 162), Lorri27);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 163), Lorri05);
    end
  Lorri18: |
    sayReply(0, message_str(174, 164));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 165), Lorri02);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 166), Lorri05);
    end
  Lorri19: |
    sayReply(0, message_str(174, 167));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 168), Lorri08);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 169), Lorri02);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 170), Lorri05);
    end
  Lorri20: |
    sayReply(0, message_str(174, 171));
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 172), Lorri21);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 173), Lorri22);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 174), Lorri23);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 175), Lorri24);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 176), Lorri25);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 177), Lorri05);
    end
  Lorri21: |
    sayReply(0, message_str(174, 178));
    call Lorri26;
  Lorri22: |
    sayReply(0, message_str(174, 179));
    call Lorri26;
  Lorri23: |
    sayReply(0, message_str(174, 180));
    call Lorri26;
  Lorri24: |
    sayReply(0, message_str(174, 181));
    call Lorri26;
  Lorri25: |
    sayReply(0, message_str(174, 182));
    call Lorri26;
  Lorri26: |
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 183), Lorri20);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 184), Lorri02);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption(message_str(174, 185), Lorri05);
    end
  Lorri27: 'sayMessage(0, message_str(174, 186));

    '
loser:
  start: "[]"
  combat_p_proc: |
    if (fixed_param == 4) then begin
      round_counter := round_counter + 1;
      if (round_counter > 3) then begin
        if ((global_var(246) == 0) and ((cur_map_index == 26) or (cur_map_index == 25))) then begin
          set_global_var(246, 1);
          set_global_var(155, global_var(155) - 5);
        end
      end
    end
  critter_p_proc: |
    variable LVar0 := 0;
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(0)) then begin
        if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
          call flee_dude;
        end
      end
    end
    LVar0 := global_var(343);
    if ((((game_time / 10) - LVar0) >= 10) and (tile_distance_objs(self_obj, dude_obj) <= 4) and (global_var(246) == 0) and ((cur_map_index == 26) or (cur_map_index == 25))) then begin
      float_msg(self_obj, message_str(115, random(110, 114)), 0);
      LVar0 := game_time / 10;
      set_global_var(343, LVar0);
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(0, 1);
    end
  destroy_p_proc: |
    if ((source_obj == dude_obj) and ((cur_map_index == 26) or (cur_map_index == 25))) then begin
      set_global_var(246, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(9, 100));
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (local_var(0) or global_var(246)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 0);
    end
    else begin
      float_msg(self_obj, message_str(9, random(101, 106)), 0);
    end
  timed_event_p_proc: |
    if (obj_on_screen(self_obj)) then begin
      animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), random(0, 5), random(1, 5)), 0);
    end
    add_timer_event(self_obj, game_ticks(random(6, 10)), 1);
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 6);
      add_timer_event(self_obj, game_ticks(random(15, 60)), 1);
      add_timer_event(self_obj, game_ticks(random(3, 5)), 1);
      initialized := 1;
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
lowcraps:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(0, 100));
    end
    else begin
      if (script_action == 6) then begin
        call point_run;
      end
      else begin
        if (script_action == 11) then begin
          script_overrides;
          call point_run;
        end
      end
    end
  point_run: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    variable LVar3 := 0;
    variable LVar4 := 0;
    variable LVar5 := 0;
    LVar5 := random(1, 20) - random(5, 15);
    LVar4 := roll_vs_skill(dude_obj, 16, LVar5);
    LVar0 := random(1, 6) + random(1, 6);
    if (is_critical(LVar4)) then begin
      if (is_success(LVar4)) then begin
        display_msg(message_str(0, 101));
      end
      else begin
        display_msg(message_str(0, 102));
      end
    end
    else begin
      if ((LVar0 == 7) or (LVar0 == 11)) then begin
        display_msg(message_str(0, 103) + LVar0 + message_str(0, 104));
      end
      else begin
        if ((LVar0 == 2) or (LVar0 == 3) or (LVar0 == 12)) then begin
          display_msg(message_str(0, 105) + LVar0 + message_str(0, 106));
        end
        else begin
          while(not(LVar3)) do begin
            if (LVar2) then begin
              if ((LVar0 == 7) or (LVar0 == 11)) then begin
                LVar3 := 1;
                display_msg(message_str(0, 107) + LVar0 + message_str(0, 108));
              end
              else begin
                if (LVar0 == LVar1) then begin
                  LVar3 := 1;
                  display_msg(message_str(0, 109));
                end
                else begin
                  LVar0 := random(1, 6) + random(1, 6);
                end
              end
            end
            else begin
              LVar2 := 1;
              LVar1 := LVar0;
              display_msg(message_str(0, 110) + LVar0 + message_str(0, 111));
            end
          end
        end
      end
    end
loxley:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(49, 100));
  critter_p_proc: |
    if (HOSTILE) then begin
      HOSTILE := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: 'call combat;

    '
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 39);
      critter_add_trait(self_obj, 1, 5, 52);
    end
  talk_p_proc: |
    call get_reaction;
    set_global_var(207, 1);
    MALE := get_critter_stat(dude_obj, 34) == 0;
    if (ILLEGAL) then begin
      if (ILLEGBEFORE) then begin
        start_gdialog(49, self_obj, 4, 17, 3);
        gsay_start;
        call loxley57;
        gsay_end;
        end_dialogue;
      end
      else begin
        if (CRIME == TRESPASS) then begin
          start_gdialog(49, self_obj, 4, 17, 3);
          gsay_start;
          call loxley59;
          gsay_end;
          end_dialogue;
        end
        if (CRIME > TRESPASS) then begin
          start_gdialog(49, self_obj, 4, 17, 3);
          gsay_start;
          call loxley58;
          gsay_end;
          end_dialogue;
        end
      end
    end
    else begin
      if (local_var(4) == 1) then begin
        if (global_var(107) == 1) then begin
          start_gdialog(49, self_obj, 4, 17, 3);
          gsay_start;
          call loxley27;
          gsay_end;
          end_dialogue;
        end
        else begin
          if (global_var(107) == 0) then begin
            if (local_var(1) > 1) then begin
              start_gdialog(49, self_obj, 4, 17, 3);
              gsay_start;
              call loxley01;
              gsay_end;
              end_dialogue;
            end
            else begin
              start_gdialog(49, self_obj, 4, 17, 3);
              gsay_start;
              call loxley24;
              gsay_end;
              end_dialogue;
            end
          end
          else begin
            display_msg(message_str(49, 267));
            float_msg(self_obj, message_str(49, 1135), 10);
          end
        end
      end
      else begin
        set_local_var(4, 1);
        if (local_var(1) > 1) then begin
          start_gdialog(49, self_obj, 4, 17, 3);
          gsay_start;
          call loxley01;
          gsay_end;
          end_dialogue;
        end
        else begin
          start_gdialog(49, self_obj, 4, 17, 3);
          gsay_start;
          call loxley24;
          gsay_end;
          end_dialogue;
        end
      end
    end
    if (floatReward == 1) then begin
      floatReward := 0;
      float_msg(self_obj, message_str(49, 268), 2);
    end
  combat: 'HOSTILE := 1;

    '
  loxley00a: |
    gsay_reply(49, 104);
    giq_option(4, 49, message_str(49, 105) + proto_data(obj_pid(dude_obj), 1) + message_str(49, 106), loxley02, 50);
    giq_option(4, 49, 107, loxley00a1, 51);
    giq_option(4, 49, 108, loxley22, 50);
  loxley01: |
    if (MALE) then begin
      gsay_reply(49, 109);
    end
    else begin
      gsay_reply(49, 110);
    end
    giq_option(4, 49, message_str(49, 111) + proto_data(obj_pid(dude_obj), 1) + message_str(49, 112), loxley02, 50);
    giq_option(4, 49, 113, loxley01a, 51);
    giq_option(4, 49, 114, loxley22, 50);
    giq_option(5, 49, 115, loxley01b, 49);
    giq_option(4, 49, 116, loxley01c, 51);
    giq_option(-3, 49, 117, loxley90, 50);
  loxley02: |
    gsay_reply(49, 118);
    giq_option(4, 49, 119, loxley03, 49);
    giq_option(4, 49, 120, loxley02_1, 50);
    giq_option(4, 49, 121, loxley18, 51);
  loxley02_1: |
    if (local_var(1) > 2) then begin
      call loxley08;
    end
    else begin
      call loxley09;
    end
  loxley03: |
    gsay_reply(49, 122);
    giq_option(4, 49, 123, loxley04, 50);
    giq_option(4, 49, 124, loxley03a, 51);
    giq_option(4, 49, 125, loxley17, 50);
  loxley04: |
    gsay_reply(49, 126);
    giq_option(4, 49, 127, loxley05, 50);
    giq_option(4, 49, 128, loxley04a, 51);
    giq_option(4, 49, 129, loxley10, 50);
  loxley05: |
    gsay_reply(49, 130);
    giq_option(4, 49, 131, loxley06, 50);
    giq_option(4, 49, 132, loxley07, 50);
  loxley06: |
    if (MALE) then begin
      gsay_message(49, 133, 50);
    end
    else begin
      gsay_message(49, 134, 50);
    end
    give_exp_points(900);
    display_msg(message_str(766, 103) + 900 + message_str(766, 104));
    set_global_var(107, 1);
    call loxley06b;
  loxley06b: |
    gsay_message(49, 135, 50);
    call loxleyx;
  loxley07: |
    gsay_reply(49, 136);
    giq_option(4, 49, 137, loxley02_1, 50);
    giq_option(4, 49, 138, loxley07a, 51);
    giq_option(4, 49, 139, loxley03, 50);
  loxley08: |
    gsay_message(49, 140, 50);
    call loxley34;
  loxley09: |
    call BigDownReact;
    gsay_message(49, 141, 51);
    call loxleyx1;
  loxley10: |
    gsay_reply(49, 142);
    giq_option(4, 49, 143, loxley11, 51);
    giq_option(4, 49, 144, loxley12, 49);
  loxley11: |
    call BigDownReact;
    gsay_message(49, 145, 51);
    call loxleyx1;
  loxley12: |
    gsay_reply(49, 146);
    giq_option(4, 49, 147, loxley12b, 50);
    giq_option(4, 49, 148, loxley13, 51);
  loxley12b: |
    gsay_message(49, 149, 50);
    call loxley06;
  loxley13: |
    call BigDownReact;
    gsay_message(49, 150, 50);
    call loxleyx1;
  loxley14: |
    set_global_var(219, 1);
    gsay_reply(49, 151);
    giq_option(4, 49, 152, loxley05, 50);
    giq_option(4, 49, 153, loxley07, 51);
  loxley16: |
    call BigDownReact;
    gsay_message(49, 154, 50);
    call loxleyx1;
  loxley17: |
    gsay_reply(49, 155);
    giq_option(4, 49, 156, loxley06, 50);
    giq_option(4, 49, 157, loxley05, 50);
    giq_option(4, 49, 158, loxley02_1, 50);
  loxley18: |
    gsay_reply(49, 159);
    giq_option(4, 49, 160, loxley18a, 51);
    giq_option(4, 49, 161, loxley12, 50);
  loxley21: |
    gsay_reply(49, 162);
    giq_option(4, 49, message_str(49, 163) + proto_data(obj_pid(dude_obj), 1) + message_str(49, 164), loxley02, 50);
    giq_option(4, 49, 165, loxley10, 51);
  loxley22: |
    gsay_reply(49, 166);
    giq_option(4, 49, 167, loxley04, 50);
    giq_option(4, 49, 168, loxley02_1, 50);
    giq_option(4, 49, 169, loxley10, 51);
  loxley23: |
    gsay_reply(49, 170);
    giq_option(4, 49, message_str(49, 171) + proto_data(obj_pid(dude_obj), 1) + message_str(49, 172), loxley02, 50);
    giq_option(4, 49, 173, loxley23a, 51);
    giq_option(4, 49, 174, loxley22, 50);
    giq_option(5, 49, 175, loxley23b, 49);
    giq_option(4, 49, 176, loxley23c, 51);
  loxley24: |
    gsay_reply(49, 177);
    giq_option(4, 49, 178, loxley25, 51);
    giq_option(4, 49, 179, loxley26, 50);
    giq_option(4, 49, 180, loxley24a, 49);
  loxley25: |
    gsay_reply(49, 181);
    giq_option(4, 49, 182, loxley25a, 49);
    giq_option(4, 49, 183, loxley26, 51);
  loxley26: |
    call BigDownReact;
    gsay_message(49, 184, 50);
    call loxleyx1;
  loxley27: |
    gsay_reply(49, 185);
    giq_option(4, 49, 186, loxley32, 51);
    giq_option(4, 49, 187, loxley33, 50);
    giq_option(4, 49, 188, loxley27a, 50);
  loxley29: |
    variable LVar0 := 0;
    LVar0 := obj_carrying_pid_obj(dude_obj, 119);
    call UpReact;
    if (obj_is_carrying_obj_pid(dude_obj, 119)) then begin
      rm_obj_from_inven(dude_obj, LVar0);
      add_obj_to_inven(self_obj, LVar0);
    end
    give_exp_points(500);
    display_msg(message_str(766, 103) + 500 + message_str(766, 104));
    set_global_var(107, 2);
    gsay_message(49, 189, 49);
    call loxleyx3;
  loxley30: 'gsay_message(49, 190, 50);

    '
  loxley31: |
    gsay_message(49, 191, 51);
    call loxleyx1;
  loxley32: |
    gsay_message(49, 192, 50);
    set_global_var(107, 2);
    call loxleyx1;
  loxley33: |
    gsay_message(49, 193, 51);
    call loxleyx4;
  loxley34: |
    gsay_reply(0, 0);
    giq_option(4, 49, 194, loxley34_1, 50);
    giq_option(4, 49, 195, loxley43, 50);
    giq_option(4, 49, 196, loxley51, 50);
    giq_option(4, 49, 197, loxley34_2, 50);
    if (global_var(106) == 1) then begin
      giq_option(4, 49, 198, loxley55, 50);
    end
    giq_option(4, 667, 114, loxleyx1, 50);
  loxley34_1: |
    if (global_var(51) == 1) then begin
      if (local_var(1) > 1) then begin
        call loxley35;
      end
      else begin
        call loxley40;
      end
    end
    else begin
      call loxley42;
    end
  loxley34_2: |
    if (local_var(1) > 2) then begin
      call loxley53;
    end
    else begin
      call loxley54;
    end
  loxley35: |
    gsay_reply(49, 199);
    giq_option(4, 49, 200, loxley36, 50);
    giq_option(4, 49, 201, loxley35_1, 50);
  loxley35_1: |
    if (local_var(1) > 2) then begin
      call loxley38;
    end
    else begin
      call loxley39;
    end
  loxley36: |
    gsay_reply(49, 202);
    giq_option(4, 49, 203, loxley37, 50);
    giq_option(4, 49, 204, loxley35_1, 50);
  loxley37: |
    gsay_reply(49, 205);
    giq_option(4, 49, 206, loxley35_1, 50);
  loxley38: |
    set_local_var(6, local_var(6) + 1);
    if (local_var(6) == 1) then begin
      gsay_message(49, 207, 50);
    end
    if (local_var(6) == 2) then begin
      gsay_message(49, 208, 50);
    end
    if (local_var(6) > 2) then begin
      gsay_message(49, 209, 50);
    end
    call loxley34;
  loxley39: |
    gsay_message(49, 210, 50);
    call loxleyend;
  loxley40: |
    gsay_reply(49, 211);
    giq_option(4, 49, 212, loxley41, 50);
    giq_option(4, 49, 213, loxley39, 50);
  loxley41: |
    gsay_reply(49, 214);
    giq_option(4, 49, 215, loxley39, 50);
  loxley42: |
    set_global_var(219, 1);
    gsay_message(49, 216, 50);
    call loxley34;
  loxley43: |
    set_global_var(219, 1);
    gsay_reply(49, 217);
    giq_option(4, 49, 218, loxley44, 50);
    giq_option(4, 49, 219, loxley43a, 50);
  loxley43a: |
    gsay_message(49, 220, 50);
    call loxley34;
  loxley44: |
    gsay_reply(49, 221);
    giq_option(4, 49, 222, loxley44a, 51);
    giq_option(4, 49, 223, loxley44b, 49);
  loxley47: |
    gsay_message(49, 224, 51);
    call loxleyx1;
  loxley48: |
    gsay_message(49, 225, 50);
    call loxley34;
  loxley51: |
    gsay_message(49, 226, 50);
    call loxley34;
  loxley53: |
    gsay_message(49, 227, 50);
    call loxley34;
  loxley54: |
    gsay_message(49, 228, 50);
    call loxley34;
  loxley55: |
    if (local_var(1) > 1) then begin
      gsay_message(49, 229, 50);
    end
    else begin
      gsay_message(49, 230, 51);
    end
  loxley57: 'gsay_message(49, 232, 50);

    '
  loxley58: 'gsay_message(49, 233, 50);

    '
  loxley59: 'gsay_message(49, 234, 50);

    '
  loxley90: |
    gsay_message(49, 265, 50);
    call loxleyx1;
  loxleyx: "[]"
  loxleyx1: "[]"
  loxleyx3: |
    set_map_var(3, 1);
    floatReward := 1;
  loxleyx4: "[]"
  loxley00aa: |
    call UpReact;
    call loxley00a;
  loxley00ab: |
    call BigDownReact;
    call loxley10;
  loxley00a1: |
    call DownReact;
    call loxley21;
  loxley01a: |
    call DownReact;
    call loxley21;
  loxley01b: |
    call UpReact;
    call loxley00;
  loxley01c: |
    call BigDownReact;
    call loxley00;
  loxley03a: |
    call DownReact;
    call loxley16;
  loxley04a: |
    call DownReact;
    call loxley14;
  loxley07a: |
    call DownReact;
    call loxley10;
  loxley18a: |
    call DownReact;
    call loxley10;
  loxley23a: |
    call DownReact;
    call loxley21;
  loxley23b: |
    call UpReact;
    call loxley00;
  loxley23c: |
    call BigDownReact;
    call loxley00;
  loxley24a: |
    call UpReact;
    call loxley23;
  loxley25a: |
    call UpReact;
    call loxley23;
  loxley27a: |
    if (obj_is_carrying_obj_pid(dude_obj, 119)) then begin
      call loxley29;
    end
    else begin
      set_local_var(5, local_var(5) + 1);
      if (local_var(5) == 1) then begin
        call loxley30;
      end
      else begin
        call loxley31;
      end
    end
  loxley44a: |
    call DownReact;
    call loxley47;
  loxley44b: |
    call UpReact;
    call loxley48;
  loxleyend: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  loxley00: |
    gsay_reply(49, 101);
    giq_option(4, 49, 102, loxley00aa, 49);
    giq_option(4, 49, 103, loxley00ab, 51);
lt:
  start: "[]"
  combat_p_proc: |
    if (fixed_param == 2) then begin
      if (global_var(276)) then begin
        if (random(0, 3) == 3) then begin
          critter_injure(dude_obj, 1);
        end
      end
    end
  critter_p_proc: |
    variable LVar0 := 0;
    if (obj_is_carrying_obj_pid(self_obj, 195) and (local_var(10) == 0)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 195);
      rm_obj_from_inven(self_obj, LVar0);
      destroy_object(LVar0);
      set_local_var(10, 1);
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        if (torture_setting > 0) then begin
          if (hit_dude == 0) then begin
            call Torture;
          end
        end
        else begin
          if (tile_distance_objs(self_obj, dude_obj) < 12) then begin
            if (not(global_var(276))) then begin
              if (not(local_var(4))) then begin
                dialogue_system_enter;
              end
              else begin
                if (not(local_var(5))) then begin
                  dialogue_system_enter;
                end
              end
            end
            else begin
              hostile := 1;
            end
          end
        end
      end
      else begin
        if ((global_var(57) != 0) and (local_var(7) != 2)) then begin
          set_global_var(146, 1);
          hostile := 1;
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    set_global_var(54, 1);
    Lt_ptr := 0;
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(50, 100));
  talk_p_proc: |
    call get_reaction;
    if (local_var(7) == 0) then begin
      start_gdialog(50, self_obj, 4, 11, 6);
      gsay_start;
      if (torture_setting == 2) then begin
        call Lt36;
        torture_setting := 3;
      end
      else begin
        if (torture_setting == 3) then begin
          call Lt37b;
          torture_setting := 4;
        end
        else begin
          if (torture_setting == 4) then begin
            call Lt38;
            torture_setting := 5;
          end
          else begin
            if (global_var(57) == 1) then begin
              call Lt01;
            end
            else begin
              if (global_var(57) == 2) then begin
                call Lt41;
              end
              else begin
                if (global_var(57) == 3) then begin
                  call Lt46;
                end
                else begin
                  call Lt45;
                end
              end
            end
          end
        end
      end
      gsay_end;
      end_dialogue;
    end
    else begin
      float_msg(self_obj, message_str(50, 236), 2);
      hostile := 1;
    end
    if (local_var(7) == 1) then begin
      set_local_var(7, 2);
      gfade_out(600);
      move_obj_inven_to_obj(dude_obj, VWeapLocker_ptr);
      move_to(dude_obj, 25543, 0);
      critter_injure(dude_obj, 2);
      reg_anim_func(2, dude_obj);
      reg_anim_func(1, 1);
      reg_anim_animate(dude_obj, 48, -1);
      reg_anim_animate(dude_obj, 37, -1);
      reg_anim_func(3, 0);
      if (global_var(118) == 2) then begin
        if (Ian_ptr == 0) then begin
        end
        else begin
          move_obj_inven_to_obj(Ian_ptr, VWeapLocker_ptr);
        end
      end
      if (global_var(121) == 2) then begin
        if (Tycho_ptr == 0) then begin
        end
        else begin
          move_obj_inven_to_obj(Tycho_ptr, VWeapLocker_ptr);
        end
      end
      if (global_var(244) == 2) then begin
        if (Katja_ptr == 0) then begin
        end
        else begin
          move_obj_inven_to_obj(Katja_ptr, VWeapLocker_ptr);
        end
      end
      gfade_in(600);
    end
    if (End_The_Game == 1) then begin
      set_obj_visibility(dude_obj, 1);
      move_to(dude_obj, 12528, 1);
      move_to(self_obj, 12528, 1);
      play_gmovie(10);
      play_gmovie(7);
      metarule(13, 0);
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if (torture_setting == 1) then begin
        critter_dmg(dude_obj, get_critter_stat(dude_obj, 35) / 3, 0);
      end
      else begin
        if (torture_setting == 2) then begin
          critter_dmg(dude_obj, get_critter_stat(dude_obj, 35) / 2, 0);
        end
        else begin
          if (torture_setting == 3) then begin
            critter_dmg(dude_obj, get_critter_stat(dude_obj, 35) - 1, 0);
          end
        end
      end
      anim(dude_obj, 37, 0);
      torture_setting := torture_setting + 1;
      add_timer_event(self_obj, game_ticks(3), 2);
    end
    else begin
      if (fixed_param == 2) then begin
        hit_dude := 0;
        game_ui_enable;
        dialogue_system_enter;
      end
    end
  map_enter_p_proc: |
    variable LVar0 := 0;
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 49);
      Lt_ptr := self_obj;
      if (local_var(6) == 0) then begin
        LVar0 := create_object_sid(58, 0, 0, 947);
        add_obj_to_inven(self_obj, LVar0);
        set_local_var(6, 1);
      end
      initialized := 1;
    end
  Lt01: |
    gsay_reply(50, 101);
    giq_option(4, 50, 102, Lt02, 50);
    giq_option(4, 50, 103, Lt01a, 50);
    giq_option(5, 50, 104, Lt03, 50);
    giq_option(-3, 50, 105, Lt48, 50);
  Lt01a: |
    gsay_reply(50, 106);
    giq_option(4, 50, 107, Lt35, 50);
    giq_option(4, 50, 108, Lt03, 50);
    giq_option(4, 50, 109, Lt01b, 49);
  Lt01b: |
    gsay_message(50, 110, 50);
    call Ltx3;
  Lt02: |
    gsay_reply(50, 111);
    giq_option(4, 50, 112, Lt35a, 50);
    giq_option(4, 50, 113, Lt03, 50);
    giq_option(4, 50, 114, Lt35, 50);
    giq_option(4, 50, 115, Lt40, 50);
  Lt03: |
    gsay_reply(50, 116);
    giq_option(4, 50, 117, Lt04, 50);
    giq_option(4, 50, 118, Lt04, 50);
    giq_option(4, 50, 119, Lt05, 50);
  Lt04: |
    gsay_reply(50, 120);
    giq_option(4, 50, 121, Lt05, 50);
    giq_option(4, 50, 122, Lt35, 50);
    giq_option(5, 50, 123, Lt35a, 50);
  Lt05: |
    gsay_message(50, 124, 50);
    call Lt06;
  Lt06: |
    giq_option(5, 50, 125, Lt07, 50);
    giq_option(6, 50, 126, Lt20, 50);
    giq_option(4, 50, 127, Lt27, 50);
    giq_option(4, 50, 128, Lt34, 50);
  Lt07: |
    gsay_reply(50, 129);
    giq_option(5, 50, 130, Lt10, 50);
    giq_option(5, 50, 131, Lt08, 50);
    giq_option(4, 50, 132, Lt20, 50);
  Lt08: |
    gsay_reply(50, 133);
    giq_option(4, 50, 134, Lt08a, 50);
  Lt08a: |
    gsay_message(50, 135, 50);
    call Lt06;
  Lt09: |
    gsay_message(50, 136, 50);
    call Lt06;
  Lt10: |
    gsay_reply(50, 137);
    giq_option(4, 50, 138, Lt11, 50);
  Lt11: |
    gsay_reply(50, 139);
    giq_option(4, 50, 140, Lt12, 50);
    giq_option(6, 50, 141, Lt14, 50);
    giq_option(6, 50, 142, Lt13, 50);
  Lt12: |
    gsay_reply(50, 143);
    giq_option(6, 50, 144, Lt13, 50);
    giq_option(4, 50, 145, Lt19, 50);
  Lt13: |
    gsay_reply(50, 146);
    giq_option(6, 50, 147, Lt14, 50);
    giq_option(5, 50, 148, Lt18a, 51);
  Lt14: |
    gsay_reply(50, 149);
    giq_option(6, 50, 150, Lt15, 50);
  Lt15: |
    gsay_reply(50, 151);
    giq_option(6, 50, 152, Lt16, 50);
  Lt16: |
    gsay_reply(50, 153);
    giq_option(6, 50, 154, Lt17, 50);
  Lt17: |
    gsay_reply(50, 155);
    giq_option(6, 50, 156, Lt09, 50);
    giq_option(6, 50, 157, Lt18a, 51);
  Lt18: |
    gsay_reply(50, 158);
    giq_option(6, 50, 159, Lt35, 51);
    giq_option(6, 50, 160, Lt09, 50);
  Lt18a: |
    call DownReact;
    call Lt18;
  Lt19: |
    gsay_reply(50, 161);
    giq_option(4, 50, 162, Lt18, 50);
    giq_option(4, 50, 163, Lt14, 50);
  Lt20: |
    gsay_reply(50, 164);
    giq_option(6, 50, 165, Lt21, 50);
    giq_option(4, 50, 166, Lt10, 50);
  Lt21: |
    gsay_reply(50, 167);
    giq_option(6, 50, 168, Lt22, 50);
    giq_option(6, 50, 169, Lt29, 50);
  Lt22: |
    gsay_reply(50, 170);
    giq_option(6, 50, 171, Lt23, 50);
    giq_option(6, 50, 172, Lt26, 50);
  Lt23: |
    gsay_reply(50, 173);
    giq_option(6, 50, 174, Lt24, 50);
    giq_option(6, 50, 175, Lt25, 50);
  Lt24: |
    gsay_reply(50, 176);
    giq_option(6, 50, 177, Lt18a, 51);
    giq_option(6, 50, 178, Lt09, 50);
  Lt25: |
    gsay_reply(50, 179);
    giq_option(4, 50, 180, Lt18, 50);
    giq_option(6, 50, 181, Lt28, 50);
  Lt26: |
    gsay_reply(50, 182);
    giq_option(5, 50, 183, Lt27, 50);
    giq_option(6, 50, 184, Lt28, 50);
  Lt27: |
    gsay_reply(50, 185);
    giq_option(4, 50, 186, Lt35, 50);
    giq_option(6, 50, 187, Lt08a, 50);
    giq_option(6, 50, 188, Lt30, 50);
  Lt28: |
    gsay_reply(50, 189);
    call Lt06;
  Lt29: |
    gsay_reply(50, 190);
    giq_option(4, 50, 191, Lt22, 50);
    giq_option(4, 50, 192, Lt28, 50);
    giq_option(4, 50, 193, Lt23, 50);
  Lt30: |
    gsay_reply(50, 194);
    giq_option(6, 50, 195, Lt31, 50);
    giq_option(7, 50, 196, Lt33, 50);
  Lt31: |
    gsay_reply(50, 197);
    giq_option(6, 50, 198, Lt32, 50);
  Lt32: |
    gsay_reply(50, 199);
    giq_option(6, 50, 200, Lt35, 51);
    giq_option(6, 50, 201, Lt28, 50);
  Lt33: |
    gsay_reply(50, 202);
    giq_option(6, 50, 203, Lt35, 51);
    giq_option(6, 50, 204, Lt08a, 50);
  Lt34: |
    gsay_reply(50, 205);
    giq_option(4, 50, 206, Lt35, 51);
  Lt35: |
    gsay_message(50, 207, 51);
    torture_setting := 1;
  Lt35a: |
    gsay_message(50, 208, 50);
    torture_setting := 1;
  Lt36: |
    gsay_reply(50, 209);
    giq_option(4, 50, 210, Lt37, 51);
    giq_option(4, 50, 211, Lt40, 49);
  Lt37: |
    gsay_message(50, 212, 49);
    torture_setting := 2;
  Lt37b: |
    gsay_reply(50, 213);
    giq_option(4, 50, 214, Ltx1, 51);
    giq_option(4, 50, 215, Lt40, 49);
  Lt38: |
    gsay_reply(50, 216);
    giq_option(4, 50, 217, Lt39, 50);
    giq_option(4, 50, 218, Lt40, 50);
  Lt39: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(50, 272);
    end
    else begin
      gsay_reply(50, 271);
    end
    giq_option(6, 50, 220, Lt39a, 50);
    giq_option(4, 766, 111, Ltx2, 51);
  Lt39a: |
    gsay_reply(50, 221);
    giq_option(7, 50, 222, Lt39b, 50);
    giq_option(6, 50, 223, Ltx2, 51);
  Lt39b: |
    gsay_reply(50, 224);
    giq_option(7, 50, 225, Lt40, 49);
    giq_option(7, 50, 226, Ltx2, 51);
  Lt40: |
    gsay_reply(50, 227);
    giq_option(4, 50, 228, Ltx3, 49);
    giq_option(4, 50, 229, Lt35, 50);
    giq_option(5, 50, 230, Lt09, 50);
  Lt41: |
    gsay_reply(50, 235);
    giq_option(4, 50, 236, Lt42, 51);
    giq_option(5, 50, 237, Lt43, 50);
    giq_option(-3, 50, 238, Lt48, 50);
  Lt42: |
    gsay_reply(50, 239);
    giq_option(6, 50, 240, Lt43, 50);
    giq_option(4, 50, 241, Lt44, 50);
  Lt43: |
    gsay_reply(50, 242);
    giq_option(4, 50, 243, Lt35, 50);
    giq_option(5, 50, 244, Lt03, 50);
  Lt44: |
    gsay_reply(50, 245);
    giq_option(4, 50, 246, Lt35, 50);
    giq_option(4, 50, 247, Lt03, 50);
  Lt45: |
    set_global_var(57, 3);
    set_local_var(4, 1);
    if (get_critter_stat(dude_obj, 34) == 1) then begin
      gsay_message(50, 248, 50);
    end
    else begin
      gsay_message(50, 270, 50);
    end
    call Ltx4;
  Lt46: |
    set_local_var(5, 1);
    gsay_reply(50, 249);
    giq_option(4, 50, 251, Lt43, 50);
  Lt48: |
    gsay_message(50, 252, 50);
    call Ltx2;
  Ltx1: 'torture_setting := 3;

    '
  Ltx2: |
    torture_setting := 0;
    set_local_var(7, 1);
  Ltx3: 'End_The_Game := 1;

    '
  Ltx4: 'set_global_var(276, 1);

    '
  Torture: |
    game_ui_disable;
    if (tile_num(self_obj) != tile_num_in_direction(tile_num(dude_obj), 1, 1)) then begin
      animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), 1, 1), 0);
    end
    else begin
      game_ui_disable;
      anim(self_obj, 1000, 4);
      anim(self_obj, 16, 0);
      anim(dude_obj, 20, 0);
      add_timer_event(self_obj, game_ticks(torture_setting), 1);
      hit_dude := 1;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
lyle:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(5)) then begin
        if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
          call flee_dude;
        end
        else begin
          if (tile_distance(tile_num(dude_obj), home_tile) > 4) then begin
            if (local_var(4) == 0) then begin
              animate_move_obj_to_tile(self_obj, home_tile, 0);
            end
          end
        end
      end
    end
    call sleeping;
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(5, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    if (source_obj == dude_obj) then begin
      set_global_var(261, 1);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(507, 100));
  map_enter_p_proc: |
    critter_add_trait(self_obj, 1, 6, 1);
    sleep_time := 1920;
    wake_time := 710;
    home_tile := 24911;
    sleep_tile := home_tile;
  pickup_p_proc: |
    if ((game_time / (10 * 60 * 60 * 24)) >= 30) then begin
      float_msg(self_obj, message_str(507, 101), 0);
    end
    set_global_var(261, 1);
    hostile := 1;
  talk_p_proc: |
    if (local_var(4) == 1) then begin
      float_msg(self_obj, message_str(185, 166), 0);
    end
    else begin
      if (global_var(261) or local_var(5)) then begin
        float_msg(self_obj, message_str(507, 114), 0);
      end
      else begin
        if (global_var(101) == 2) then begin
          float_msg(self_obj, message_str(507, 102), 0);
        end
        else begin
          if (global_var(188) == 2) then begin
            float_msg(self_obj, message_str(507, 113), 0);
          end
          else begin
            start_gdialog(507, self_obj, 4, -1, -1);
            gsay_start;
            call Lyle01;
            gsay_end;
            end_dialogue;
          end
        end
      end
    end
  Lyle01: |
    gsay_reply(507, message_str(507, 103) + proto_data(obj_pid(dude_obj), 1) + message_str(507, 104));
    giq_option(4, 507, 105, Lyle02, 50);
    giq_option(-3, 507, 107, LyleEnd, 50);
  Lyle02: |
    if ((game_time / (10 * 60 * 60 * 24)) < 30) then begin
      gsay_message(507, 106, 50);
    end
    else begin
      gsay_reply(507, 108);
      giq_option(4, 507, 109, Lyle03, 50);
      giq_option(4, 507, 110, Lyle04, 49);
    end
  Lyle03: 'gsay_message(507, 111, 50);

    '
  Lyle04: |
    set_global_var(188, 1);
    gsay_message(507, 112, 49);
  LyleEnd: "[]"
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
  sleeping: |
    if (local_var(4) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(4, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(4, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(4, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(4, 1);
          end
        end
      end
    end
machiv:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(110, 100));
  use_p_proc: |
    variable LVar0 := 0;
    script_overrides;
    LVar0 := random(1, 2);
    if (LVar0 == 1) then begin
      display_msg(message_str(110, 103));
    end
    else begin
      if (LVar0 == 2) then begin
        display_msg(message_str(110, 104));
      end
    end
  use_skill_on_p_proc: |
    variable LVar0 := 0;
    if (action_being_used == 12) then begin
      script_overrides;
      LVar0 := random(1, 2);
      if (LVar0 == 1) then begin
        display_msg(message_str(110, 101));
      end
      else begin
        if (LVar0 == 2) then begin
          display_msg(message_str(110, 102));
        end
      end
    end
macrae:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(918, 101));
    end
    else begin
      display_msg(message_str(918, 100));
    end
  talk_p_proc: |
    if (global_var(253) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if (local_var(5) == 2) then begin
        float_msg(self_obj, message_str(918, 141), 0);
      end
      else begin
        call get_reaction;
        start_gdialog(918, self_obj, -1, -1, -1);
        gsay_start;
        if (global_var(613) == 2) then begin
          call MacRae12;
        end
        else begin
          if (local_var(4) == 0) then begin
            if (get_critter_stat(dude_obj, 34) == 0) then begin
              DisplayMessage := 102;
            end
            else begin
              DisplayMessage := 103;
            end
            call MacRae02;
          end
          else begin
            DisplayMessage := 104;
            call MacRae02;
          end
        end
        gsay_end;
        end_dialogue;
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(253) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  pickup_p_proc: 'set_global_var(253, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      critter_add_trait(self_obj, 1, 6, 47);
      critter_add_trait(self_obj, 1, 5, 27);
      Initialize := 0;
    end
  MacRae01: |
    DisplayMessage := 104;
    call MacRae02;
  MacRae02: |
    gsay_reply(918, DisplayMessage);
    if (local_var(4) == 0) then begin
      giq_option(4, 918, 105, MacRae03, 50);
    end
    giq_option(4, 918, 106, MacRae11, 50);
    giq_option(4, 918, 107, MacRaeEnd, 50);
    giq_option(-3, 918, 141, MacRaeEnd, 50);
  MacRae03: |
    gsay_reply(918, 108);
    gsay_option(918, 109, MacRae04, 50);
    gsay_option(918, 110, MacRae08, 50);
    gsay_option(918, 111, MacRae09, 50);
    gsay_option(918, 112, MacRae01, 50);
  MacRae04: |
    gsay_reply(918, 113);
    gsay_option(918, 114, MacRae05, 50);
    gsay_option(918, 115, MacRae06, 50);
    gsay_option(918, 116, MacRae01, 50);
  MacRae05: |
    gsay_message(918, 117, 50);
    call DownReactLevel;
  MacRae06: |
    DisplayMessage := 118;
    set_local_var(5, 1);
    call MacRae07;
  MacRae07: |
    gsay_reply(918, DisplayMessage);
    gsay_option(918, 119, MacRae01, 50);
    gsay_option(918, 120, MacRaeEnd, 50);
  MacRae08: |
    DisplayMessage := 121;
    call MacRae07;
  MacRae09: |
    gsay_reply(918, 122);
    gsay_option(918, 123, MacRae10, 50);
    gsay_option(918, 124, MacRae01, 50);
    gsay_option(918, 125, MacRaeEnd, 50);
  MacRae10: |
    DisplayMessage := 126;
    call MacRae07;
  MacRae11: |
    DisplayMessage := 127;
    call MacRae07;
  MacRae12: |
    gsay_reply(918, 128);
    if (local_var(5 == 1)) then begin
      gsay_option(918, 129, MacRae15, 50);
    end
    if (local_var(4) == 1) then begin
      gsay_option(918, 130, MacRae13, 50);
    end
    else begin
      gsay_option(918, 131, MacRae16, 50);
    end
    gsay_option(918, 132, MacRaeEnd, 50);
  MacRae13: |
    gsay_reply(918, 133);
    gsay_option(918, 134, MacRae14, 50);
    gsay_option(918, 135, MacRaeEnd, 50);
  MacRae14: |
    gsay_reply(918, 113);
    gsay_option(918, 136, MacRae15, 50);
    gsay_option(918, 137, MacRaeEnd, 50);
  MacRae15: |
    gsay_message(918, 138, 50);
    critter_mod_skill(dude_obj, 3, 10);
    critter_mod_skill(dude_obj, 4, 10);
    gfade_out(600);
    game_time_advance(10 * 60 * 60 * 24);
    gfade_in(600);
    set_local_var(5, 2);
    gsay_message(918, 139, 50);
    display_msg(message_str(918, 142));
    float_msg(self_obj, message_str(918, 143), 3);
  MacRae16: |
    gsay_reply(918, 140);
    gsay_option(918, 109, MacRae15, 50);
    gsay_option(918, 137, MacRaeEnd, 50);
  MacRaeEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
madsci:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 69);
      home_tile := tile_num(self_obj);
      if (home_tile == 22093) then begin
        sleep_tile := 21881;
      end
      else begin
        if (home_tile == 22704) then begin
          sleep_tile := 22281;
        end
        else begin
          sleep_tile := 22083;
        end
      end
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
        if (local_var(6)) then begin
          set_local_var(6, 0);
          animate_move_obj_to_tile(self_obj, home_tile, 0);
        end
        else begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
        end
      end
      else begin
        if (local_var(6)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, sleep_tile, 0);
          end
        end
        else begin
          set_local_var(6, 1);
          animate_move_obj_to_tile(self_obj, sleep_tile, 0);
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    if (tile_num(self_obj) == sleep_tile) then begin
      float_msg(self_obj, message_str(679, 303), 2);
    end
    else begin
      call get_reaction;
      start_gdialog(679, self_obj, 4, -1, -1);
      gsay_start;
      if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
        if (local_var(5) == 1) then begin
          call madsci01;
        end
        else begin
          call madsci00;
        end
        set_local_var(5, 1);
      end
      else begin
        if (local_var(4) == 1) then begin
          call madsci01;
        end
        else begin
          call madsci12;
        end
        set_local_var(4, 1);
      end
      gsay_end;
      end_dialogue;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (tile_num(self_obj) == sleep_tile) then begin
      display_msg(message_str(679, 300));
    end
    else begin
      display_msg(message_str(679, 100));
    end
  dialog_end: "[]"
  madsci00: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(679, 101);
    end
    else begin
      gsay_reply(679, 102);
    end
    giq_option(7, 679, 103, madsci00a, 50);
    giq_option(4, 679, 104, madsci04, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 679, 105, madsci00b, 50);
    end
    giq_option(-3, 679, 106, madsci06, 50);
  madsci00a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call madsci02;
    end
    else begin
      call madsci09;
    end
  madsci00b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call madsci03;
    end
    else begin
      call madsci08;
    end
  madsci01: |
    gsay_reply(679, 107);
    giq_option(4, 679, 108, madsci01a, 50);
    giq_option(4, 679, 109, madsci02, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 679, 110, combat, 51);
    end
    giq_option(-3, 679, 111, madsci06, 50);
  madsci01a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call madsci03;
    end
    else begin
      call madsci09;
    end
  madsci02: |
    gsay_reply(679, 112);
    giq_option(7, 679, 113, madsci07, 50);
    giq_option(4, 679, 114, madsci02a, 50);
    giq_option(4, 679, 115, madsci02b, 50);
    giq_option(4, 679, 116, madsci14, 50);
  madsci02a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call madsci07;
    end
    else begin
      call madsci09;
    end
  madsci02b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call madsci04;
    end
    else begin
      call madsci06;
    end
  madsci03: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(679, 117);
    end
    else begin
      gsay_reply(679, 118);
    end
    giq_option(4, 679, 103, madsci03a, 50);
    giq_option(4, 679, 104, madsci04, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 679, 119, madsci03b, 50);
    end
  madsci03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call madsci02;
    end
    else begin
      call madsci06;
    end
  madsci03b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call madsci09;
    end
    else begin
      call madsci08;
    end
  madsci04: |
    gsay_reply(679, 120);
    giq_option(4, 679, 121, madsci04a, 50);
    giq_option(4, 679, 122, madsci05, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 679, 123, combat, 51);
    end
  madsci04a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call madsci09;
    end
    else begin
      call madsci08;
    end
  madsci05: |
    gsay_reply(679, 124);
    giq_option(4, 679, 125, dialog_end, 50);
    giq_option(4, 679, 126, madsci09, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 679, 127, combat, 51);
    end
  madsci06: 'gsay_message(679, 128, 50);

    '
  madsci07: |
    gsay_reply(679, 129);
    giq_option(4, 679, 130, madsci05, 50);
    giq_option(4, 679, 131, dialog_end, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 679, 132, combat, 51);
    end
  madsci08: 'gsay_message(679, 133, 50);

    '
  madsci09: |
    gsay_reply(679, 134);
    giq_option(4, 679, 135, madsci09a, 50);
    giq_option(4, 679, 136, madsci09b, 51);
    giq_option(4, 679, 137, madsci09c, 51);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 679, 138, combat, 51);
    end
  madsci09a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -5))) then begin
      call madsci06;
    end
    else begin
      call madsci08;
    end
  madsci09b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call madsci10;
    end
    else begin
      call madsci11;
    end
  madsci09c: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call madsci10;
    end
    else begin
      call madsci11;
    end
  madsci10: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(679, 117);
    end
    else begin
      gsay_reply(679, 118);
    end
    giq_option(4, 679, 139, madsci10a, 50);
    giq_option(4, 679, 140, dialog_end, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 679, 119, madsci10b, 50);
    end
  madsci10a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call madsci02;
    end
    else begin
      call madsci06;
    end
  madsci10b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call madsci06;
    end
    else begin
      call madsci08;
    end
  madsci11: |
    gsay_message(679, 141, 51);
    call combat;
  madsci12: |
    gsay_reply(679, 142);
    giq_option(4, 679, 143, madsci12a, 50);
    giq_option(4, 679, 144, madsci12b, 51);
    giq_option(4, 679, 145, madsci12c, 50);
    giq_option(4, 679, 146, combat, 50);
  madsci12a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call madsci03;
    end
    else begin
      call madsci09;
    end
  madsci12b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -25))) then begin
      call madsci10;
    end
    else begin
      call madsci11;
    end
  madsci12c: |
    if (is_success(roll_vs_skill(dude_obj, 14, -15))) then begin
      call madsci13;
    end
    else begin
      call madsci08;
    end
  madsci13: |
    gsay_reply(679, 147);
    giq_option(4, 679, 148, madsci02, 50);
    giq_option(4, 679, 144, madsci13a, 51);
    giq_option(4, 679, 149, madsci13b, 50);
  madsci13a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -25))) then begin
      call madsci10;
    end
    else begin
      call madsci11;
    end
  madsci13b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call madsci10;
    end
    else begin
      call madsci08;
    end
  madsci14: |
    gsay_reply(679, 150);
    giq_option(4, 679, 151, madsci14a, 50);
    giq_option(4, 679, 122, madsci05, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 679, 123, combat, 50);
    end
  madsci14a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call madsci09;
    end
    else begin
      call madsci08;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
  madscinull: "[]"
manager:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 32);
      initialized := 1;
    end
    if (script_action == 22) then begin
      call timeforwhat;
    end
    else begin
      if (script_action == 11) then begin
        call do_dialogue;
      end
      else begin
        if ((script_action == 21) or (script_action == 3)) then begin
          script_overrides;
          display_msg(message_str(82, 100));
        end
        else begin
          if (script_action == 4) then begin
            Hostile := 1;
          end
          else begin
            if (script_action == 12) then begin
              if (Hostile) then begin
                Hostile := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
              else begin
                loopcount := loopcount + 1;
                if (loopcount > 40) then begin
                  loopcount := 0;
                  if (tile_distance_objs(self_obj, dude_obj) < 7) then begin
                    if (obj_can_see_obj(self_obj, dude_obj)) then begin
                      if (noevent == 0) then begin
                        noevent := 1;
                        add_timer_event(self_obj, game_ticks(5), 0);
                      end
                    end
                  end
                end
              end
            end
            else begin
              if (script_action == 18) then begin
                if (source_obj == dude_obj) then begin
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                    set_global_var(156, 1);
                    set_global_var(157, 0);
                  end
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                    set_global_var(157, 1);
                    set_global_var(156, 0);
                  end
                  set_global_var(160, global_var(160) + 1);
                  if ((global_var(160) % 6) == 0) then begin
                    set_global_var(155, global_var(155) + 1);
                  end
                end
              end
            end
          end
        end
      end
    end
  timeforwhat: |
    if (fixed_param == 1) then begin
      Hostile := 1;
    end
    else begin
      if (local_var(0) == 0) then begin
        dialogue_system_enter;
      end
    end
  do_dialogue: |
    start_gdialog(82, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(0)) then begin
      call ghoul08;
    end
    else begin
      set_local_var(0, 1);
      call ghoul00;
    end
    gsay_end;
    end_dialogue;
  ghoulcbt: 'add_timer_event(self_obj, game_ticks(2), 1);

    '
  ghoul00: |
    gsay_reply(82, 101);
    giq_option(6, 82, 102, ghoul01, 50);
    giq_option(4, 82, 103, ghoul04, 50);
    giq_option(4, 82, 118, ghoul09, 50);
    giq_option(3, 82, 104, ghoul05, 50);
    giq_option(-3, 82, 105, ghoul01, 50);
  ghoul01: |
    gsay_reply(82, 106);
    giq_option(6, 82, 107, ghoul02, 50);
    giq_option(6, 82, 108, ghoul03, 50);
  ghoul02: 'gsay_message(82, 109, 50);

    '
  ghoul03: 'gsay_message(82, 110, 50);

    '
  ghoul04: 'gsay_message(82, 111, 50);

    '
  ghoul05: |
    gsay_reply(82, 112);
    giq_option(6, 82, 113, ghoul07, 50);
    giq_option(8, 82, 114, ghoul05a, 50);
  ghoul05a: |
    if (is_success(do_check(dude_obj, 14, 0))) then begin
      call ghoul06;
    end
    else begin
      call ghoul07;
    end
  ghoul06: 'gsay_message(82, 115, 50);

    '
  ghoul07: |
    gsay_message(82, 116, 50);
    call ghoulcbt;
  ghoul08: 'gsay_message(82, 117, 50);

    '
  ghoul09: |
    gsay_reply(82, 119);
    giq_option(4, 82, 120, ghoul10, 50);
    giq_option(4, 82, 121, ghoul11, 50);
  ghoul10: 'gsay_message(82, 122, 50);

    '
  ghoul11: 'gsay_message(82, 123, 50);

    '
mangled:
  start: |
    variable LVar0 := 0;
    if (script_action == 3) then begin
      script_overrides;
      call dead00;
    end
    else begin
      if (script_action == 21) then begin
        script_overrides;
        display_msg(message_str(83, 100));
      end
    end
  dead00: |
    if (is_success(do_check(dude_obj, 4, 0))) then begin
      display_msg(message_str(83, 101));
    end
marcelle:
  start: "[]"
  critter_p_proc: |
    if (global_var(628) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (Shooting == 0) then begin
        if ((global_var(143) != 2) and (map_var(3) != 0)) then begin
          sleeping_disabled := 1;
          dest_tile := waiting_tile;
          if (tile_num(self_obj) != waiting_tile) then begin
            if (local_var(5)) then begin
              set_local_var(5, 0);
              sleeping_disabled := 1;
            end
            else begin
              showing_room := 0;
              rm_timer_event(self_obj);
              dest_tile := waiting_tile;
            end
          end
          if (global_var(143) == 0) then begin
            if (obj_can_see_obj(self_obj, dude_obj)) then begin
              if (tile_distance_objs(self_obj, dude_obj) < 12) then begin
                if (not(line00flag)) then begin
                  if (tile_num(self_obj) == waiting_tile) then begin
                    dialogue_system_enter;
                  end
                end
              end
            end
          end
        end
        else begin
          if ((global_var(143) == 2) or (map_var(0) == 2)) then begin
            if (tile_num(self_obj) == waiting_tile) then begin
              sleeping_disabled := 0;
              moving_disabled := 0;
              dest_tile := desk_tile;
            end
          end
        end
        if (sleeping_disabled == 0) then begin
          call sleeping;
        end
        if ((moving_disabled == 0) and ((local_var(5) == 0) or sleeping_disabled)) then begin
          if (tile_num(self_obj) != dest_tile) then begin
            animate_move_obj_to_tile(self_obj, dest_tile, 0);
          end
        end
        if (showing_room) then begin
          dest_tile := room_tile;
          if (tile_num(self_obj) != dest_tile) then begin
            animate_move_obj_to_tile(self_obj, dest_tile, 0);
          end
          else begin
            add_timer_event(self_obj, game_ticks(5), 1);
            showing_room := 0;
          end
        end
        else begin
          if (obj_can_see_obj(self_obj, dude_obj) and messing_with_fridge) then begin
            call Marcelles33;
          end
        end
        if (tile_distance(tile_num(dude_obj), desk_tile) < 8) then begin
          if (local_var(5) == 1) then begin
            dest_tile := desk_tile;
            moving_disabled := 0;
            sleeping_disabled := 1;
          end
        end
        else begin
          sleeping_disabled := 0;
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(628, 1);
      set_global_var(247, 1);
      set_global_var(155, global_var(155) - 5);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(4)) then begin
      display_msg(message_str(339, 100));
    end
    else begin
      display_msg(message_str(339, 101));
    end
  map_enter_p_proc: |
    if (obj_carrying_pid_obj(self_obj, 94)) then begin
      Bessy := obj_carrying_pid_obj(self_obj, 94);
    end
    else begin
      Bessy := create_object_sid(94, 0, 0, -1);
      add_obj_to_inven(self_obj, Bessy);
    end
    critter_add_trait(self_obj, 1, 6, 16);
    sleep_tile := 20509;
    home_tile := 19901;
    wake_time := 600;
    sleep_time := 1900;
  map_update_p_proc: |
    if ((global_var(143) == 0) and (line00flag == 0) and (map_var(3) != 0)) then begin
      move_to(self_obj, waiting_tile, 0);
      dest_tile := waiting_tile;
      showing_room := 0;
      if (local_var(5)) then begin
        set_local_var(5, 0);
        sleeping_disabled := 1;
      end
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (local_var(5) == 1) then begin
      float_msg(self_obj, message_str(185, 166), 0);
    end
    else begin
      if ((tile_num(self_obj) != home_tile) and (tile_num(self_obj) != waiting_tile)) then begin
        script_overrides;
      end
      else begin
        call get_reaction;
        start_gdialog(339, self_obj, 4, -1, -1);
        gsay_start;
        if ((global_var(143) == 0) and not(line00flag) and (map_var(3) != 0)) then begin
          call Marcelles00;
        end
        else begin
          if (global_var(143) == 1) then begin
            call Marcelles03;
          end
          else begin
            if ((global_var(143) == 2) and not(line04flag) and (map_var(0) != 2) and (local_var(7) == 0)) then begin
              call Marcelles04;
            end
            else begin
              if ((map_var(0) == 2) and not(line06flag)) then begin
                call Marcelles06;
              end
              else begin
                if ((global_var(105) == 2) and not(line29flag)) then begin
                  call Marcelles29;
                end
                else begin
                  if (not(local_var(4))) then begin
                    call Marcelles07;
                  end
                  else begin
                    if (local_var(1) < 2) then begin
                      call Marcelles22;
                    end
                    else begin
                      call Marcelles17;
                    end
                  end
                end
              end
            end
          end
        end
        gsay_end;
        end_dialogue;
      end
    end
    sleeping_disabled := 0;
    if (showing_room) then begin
      call go_to_room;
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      add_timer_event(self_obj, game_ticks(2), 2);
    end
    else begin
      if (fixed_param == 2) then begin
        dest_tile := home_tile;
        moving_disabled := 0;
      end
      else begin
        if (fixed_param == 3) then begin
          if (tile_distance(tile_num(self_obj), 18089) > 2) then begin
            animate_move_obj_to_tile(self_obj, 18089, 1);
            add_timer_event(self_obj, 5, 3);
          end
          else begin
            add_timer_event(self_obj, 5, 4);
          end
        end
        else begin
          if (fixed_param == 4) then begin
            reg_anim_func(2, JTRaider_ptr);
            reg_anim_func(1, 1);
            reg_anim_animate(JTRaider_ptr, 43, -1);
            reg_anim_animate(JTRaider_ptr, 45, -1);
            reg_anim_animate(JTRaider_ptr, 44, -1);
            reg_anim_func(3, 0);
            critter_dmg(Sinthia_ptr, random(75, 100), 0);
            add_timer_event(self_obj, 5, 5);
            if (obj_is_carrying_obj_pid(self_obj, 94) == 0) then begin
              Bessy := create_object_sid(94, 0, 0, -1);
              add_obj_to_inven(self_obj, Bessy);
            end
            wield_obj_critter(self_obj, obj_carrying_pid_obj(self_obj, 94));
          end
          else begin
            if (fixed_param == 5) then begin
              reg_anim_func(2, self_obj);
              reg_anim_func(1, 1);
              reg_anim_animate(self_obj, 43, -1);
              reg_anim_animate(self_obj, 45, -1);
              sfx_name := sfx_build_weapon_name(1, obj_carrying_pid_obj(self_obj, 94), 0, JTRaider_ptr);
              reg_anim_play_sfx(self_obj, sfx_name, 0);
              reg_anim_animate(self_obj, 44, -1);
              reg_anim_func(3, 0);
              critter_dmg(JTRaider_ptr, random(75, 100), 0);
              Shooting := 0;
              game_ui_enable;
            end
            else begin
              if (fixed_param == 6) then begin
                if (global_var(143) != 2) then begin
                  call Marcelles_charge_raider;
                end
              end
            end
          end
        end
      end
    end
  Marcelles00: |
    line00flag := 1;
    set_global_var(143, 1);
    gsay_reply(339, 102);
    giq_option(4, 339, 103, Marcelles02, 50);
    giq_option(4, 339, 104, UpReact, 50);
    giq_option(-3, 339, 105, Marcelles01, 50);
  Marcelles01: 'gsay_message(339, 106, 50);

    '
  Marcelles02: |
    call DownReact;
    gsay_reply(339, 107);
    giq_option(4, 339, 108, Marcelles02a, 51);
    giq_option(4, 339, 109, MarcellesEnd, 50);
  Marcelles02a: |
    call BigDownReact;
    call Marcelles_charge_raider;
  Marcelles03: 'gsay_message(339, 110, 50);

    '
  Marcelles04: |
    line04flag := 1;
    set_local_var(7, 1);
    gsay_reply(339, 111);
    giq_option(-3, 339, 112, Marcelles05, 50);
    giq_option(4, 339, 113, Marcelles05, 50);
  Marcelles05: |
    gsay_message(339, 114, 50);
    if (global_var(168) < (game_time / (10 * 60 * 60 * 24))) then begin
      set_global_var(168, (game_time / (10 * 60 * 60 * 24)) + 1);
    end
    else begin
      set_global_var(168, global_var(168) + 1);
    end
    showing_room := 1;
    message := message_str(339, 115);
  Marcelles06: |
    line06flag := 1;
    call BigDownReact;
    gsay_reply(339, 116);
    giq_option(4, 339, 117, MarcellesEnd, 50);
    giq_option(-3, 339, 118, MarcellesEnd, 50);
  Marcelles07: |
    set_local_var(4, 1);
    gsay_reply(339, 119);
    giq_option(4, 339, 120, Marcelles12, 50);
    giq_option(4, 339, 121, Marcelles13, 50);
    giq_option(7, 339, 122, Marcelles14, 50);
    giq_option(-3, 339, 123, Marcelles08, 50);
  Marcelles08: |
    gsay_reply(339, 124);
    giq_option(-3, 339, 125, Marcelles09, 50);
    giq_option(-3, 339, 126, Marcelles08a, 50);
    giq_option(-3, 339, 127, Marcelles08b, 50);
  Marcelles08a: |
    if (item_caps_total(dude_obj) >= 25) then begin
      item_caps_adjust(dude_obj, -25);
      if (global_var(168) < (game_time / (10 * 60 * 60 * 24))) then begin
        set_global_var(168, (game_time / (10 * 60 * 60 * 24)) + 1);
      end
      else begin
        set_global_var(168, global_var(168) + 1);
      end
      call Marcelles10;
    end
    else begin
      call Marcelles11;
    end
  Marcelles08b: |
    if (item_caps_total(dude_obj) >= 150) then begin
      item_caps_adjust(dude_obj, -150);
      if (global_var(168) < (game_time / (10 * 60 * 60 * 24))) then begin
        set_global_var(168, (game_time / (10 * 60 * 60 * 24)) + 7);
      end
      else begin
        set_global_var(168, global_var(168) + 7);
      end
      call Marcelles10;
    end
    else begin
      call Marcelles11;
    end
  Marcelles09: 'gsay_message(339, 128, 50);

    '
  Marcelles10: |
    gsay_message(339, 129, 50);
    showing_room := 1;
    message := message_str(339, 130);
  Marcelles11: 'gsay_message(339, 131, 50);

    '
  Marcelles12: 'gsay_message(339, 132, 50);

    '
  Marcelles13: |
    gsay_reply(339, 133);
    giq_option(4, 339, 134, Marcelles08b, 50);
    giq_option(4, 339, 135, Marcelles08a, 50);
    giq_option(4, 339, 136, MarcellesEnd, 50);
  Marcelles14: |
    gsay_reply(339, 137);
    giq_option(5, 339, 138, Marcelles14a, 50);
    giq_option(4, 339, 182, MarcellesEnd, 50);
  Marcelles14a: |
    if (item_caps_total(dude_obj) >= 50) then begin
      call Marcelles15;
    end
    else begin
      call Marcelles16;
    end
  Marcelles15: |
    item_caps_adjust(dude_obj, -50);
    gsay_message(339, 139, 50);
  Marcelles16: |
    call DownReact;
    gsay_message(339, 140, 50);
  Marcelles17: |
    gsay_reply(339, 141);
    giq_option(4, 339, 142, Marcelles17a, 50);
    giq_option(4, 339, 184, MarcellesEnd, 50);
    giq_option(-3, 339, 143, Marcelles17a, 50);
  Marcelles17a: |
    if (global_var(168) > (game_time / (10 * 60 * 60 * 24))) then begin
      call Marcelles18;
    end
    else begin
      call Marcelles20;
    end
  Marcelles18: |
    gsay_reply(339, 144);
    giq_option(4, 339, 145, Marcelles18a, 50);
    giq_option(4, 339, 146, MarcellesEnd, 50);
    giq_option(-3, 339, 147, Marcelles18a, 50);
    giq_option(-3, 339, 148, MarcellesEnd, 50);
  Marcelles18a: |
    call DownReact;
    showing_room := 1;
    message := message_str(339, 149);
  Marcelles19a: |
    if (item_caps_total(dude_obj) >= 25) then begin
      item_caps_adjust(dude_obj, -25);
      if (global_var(168) < (game_time / (10 * 60 * 60 * 24))) then begin
        set_global_var(168, (game_time / (10 * 60 * 60 * 24)) + 1);
      end
      else begin
        set_global_var(168, global_var(168) + 1);
      end
      call Marcelles21;
    end
    else begin
      call Marcelles11;
    end
  Marcelles19b: |
    if (item_caps_total(dude_obj) >= 150) then begin
      item_caps_adjust(dude_obj, -150);
      if (global_var(168) < (game_time / (10 * 60 * 60 * 24))) then begin
        set_global_var(168, (game_time / (10 * 60 * 60 * 24)) + 7);
      end
      else begin
        set_global_var(168, global_var(168) + 7);
      end
      call Marcelles21;
    end
    else begin
      call Marcelles11;
    end
  Marcelles20: |
    gsay_reply(339, 154);
    giq_option(4, 339, 155, Marcelles19b, 50);
    giq_option(4, 339, 156, Marcelles19a, 50);
    giq_option(4, 339, 157, MarcellesEnd, 50);
  Marcelles21: |
    call UpReact;
    gsay_message(339, 158, 50);
  Marcelles22: |
    gsay_reply(339, 159);
    giq_option(4, 339, 160, Marcelles24, 50);
    giq_option(4, 339, 184, MarcellesEnd, 50);
    giq_option(-3, 339, 161, Marcelles23, 50);
  Marcelles23: 'gsay_message(339, 162, 50);

    '
  Marcelles24: |
    gsay_reply(339, 163);
    giq_option(4, 339, 164, Marcelles24a, 50);
  Marcelles24a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Marcelles26;
    end
    else begin
      call Marcelles25;
    end
  Marcelles25: 'gsay_message(339, 165, 50);

    '
  Marcelles26: |
    gsay_reply(339, 166);
    giq_option(4, 339, 167, Marcelles27, 50);
    giq_option(4, 339, 168, Marcelles26a, 50);
  Marcelles26a: |
    if (item_caps_total(dude_obj) >= 100) then begin
      item_caps_adjust(dude_obj, -100);
      if (global_var(168) < (game_time / (10 * 60 * 60 * 24))) then begin
        set_global_var(168, (game_time / (10 * 60 * 60 * 24)) + 1);
      end
      else begin
        set_global_var(168, global_var(168) + 1);
      end
      call Marcelles28;
    end
    else begin
      call Marcelles11;
    end
  Marcelles27: |
    gsay_reply(339, 169);
    giq_option(4, 339, 170, MarcellesEnd, 50);
    giq_option(4, 339, 171, Marcelles26a, 50);
  Marcelles28: 'gsay_message(339, 172, 50);

    '
  Marcelles29: |
    line29flag := 1;
    gsay_reply(339, 173);
    giq_option(4, 339, 174, Marcelles31, 50);
    giq_option(4, 339, 175, Marcelles29a, 50);
    giq_option(-3, 339, 176, Marcelles30, 50);
  Marcelles29a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Marcelles32;
    end
    else begin
      call Marcelles31;
    end
  Marcelles30: |
    call BottomReact;
    gsay_message(339, 177, 51);
  Marcelles31: |
    call BottomReact;
    gsay_message(339, 178, 51);
  Marcelles32: |
    call BigDownReact;
    gsay_message(339, 179, 51);
  Marcelles33: |
    messing_with_fridge := 0;
    if (global_var(168) <= (game_time / (10 * 60 * 60 * 24))) then begin
      float_msg(self_obj, message_str(339, 181), 2);
      if (local_var(6) == 1) then begin
        hostile := 1;
      end
      else begin
        set_local_var(6, 1);
      end
    end
  go_to_room: |
    showing_room := 1;
    sleeping_disabled := 1;
    moving_disabled := 1;
  MarcellesEnd: "[]"
  Marcelles_charge_raider: |
    display_msg(message_str(339, 183));
    add_timer_event(self_obj, 5, 3);
    game_ui_disable;
    Shooting := 1;
  sleeping: |
    if (local_var(5) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) >= 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(5, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(5, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) >= 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, sleep_tile, 0);
          end
          else begin
            set_local_var(5, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
            set_local_var(5, 1);
          end
          else begin
            set_local_var(5, 1);
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
marney:
  start: "[]"
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(256) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(0)) then begin
      display_msg(message_str(270, 100));
    end
    else begin
      display_msg(message_str(270, 102));
    end
  talk_p_proc: |
    start_gdialog(270, self_obj, 4, -1, -1);
    gsay_start;
    set_local_var(0, 1);
    if (global_var(155) <= -30) then begin
      call Marney08;
    end
    else begin
      call Marney00;
    end
    gsay_end;
    end_dialogue;
  pickup_p_proc: 'set_global_var(256, 1);

    '
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(256, 1);
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 46);
      critter_add_trait(self_obj, 1, 5, 33);
      initialized := 1;
    end
  map_update_p_proc: |
    if ((game_time_hour >= 2000) or (game_time_hour < 800)) then begin
      animate_move_obj_to_tile(self_obj, 22654, 0);
    end
    else begin
      animate_move_obj_to_tile(self_obj, 20467, 0);
      if (anim_busy(self_obj) == 0) then begin
        anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), 19868));
      end
    end
  Marney00: |
    variable LVar0 := 0;
    LVar0 := get_critter_stat(dude_obj, 7) - get_critter_stat(dude_obj, 35);
    gsay_reply(270, 104);
    giq_option(-3, 270, 105, Marney01, 50);
    giq_option(4, 270, 125, MarneyEnd, 50);
    if (LVar0 > 0) then begin
      giq_option(4, 270, 106, Marney01, 50);
    end
    if (not(local_var(2))) then begin
      giq_option(5, 270, 107, Marney06, 50);
    end
  Marney01: |
    gsay_reply(270, 108);
    giq_option(-3, 270, 109, Marney02, 50);
    giq_option(-3, 270, 110, Marney05, 50);
    giq_option(4, 270, 111, Marney02, 50);
    giq_option(4, 270, 112, Marney05, 50);
  Marney02: |
    variable LVar0 := 0;
    gfade_out(600);
    gfade_in(600);
    LVar0 := get_critter_stat(dude_obj, 7) - get_critter_stat(dude_obj, 35);
    game_time_advance(game_ticks(60 * 20 * LVar0));
    critter_heal(dude_obj, LVar0);
    gsay_message(270, 113, 50);
    if (not(local_var(1))) then begin
      giq_option(4, 270, 114, Marney03, 50);
    end
    giq_option(4, 270, 115, MarneyEnd, 50);
  Marney03: |
    gsay_reply(270, 116);
    giq_option(4, 270, 117, Marney04, 50);
    giq_option(4, 270, 118, Marney05, 50);
  Marney04: |
    gfade_out(600);
    gfade_in(600);
    game_time_advance(game_ticks(18000));
    critter_mod_skill(dude_obj, 7, 15);
    set_local_var(1, 1);
    gsay_message(270, 119, 50);
  Marney05: 'gsay_message(270, 120, 50);

    '
  Marney06: |
    gsay_reply(270, 121);
    giq_option(5, 270, 122, Marney07, 50);
    giq_option(5, 270, 123, Marney05, 50);
  Marney07: |
    gfade_out(600);
    gfade_in(600);
    game_time_advance(game_ticks(25200));
    critter_mod_skill(dude_obj, 6, 15);
    set_local_var(2, 1);
    gsay_message(270, 124, 50);
  Marney08: 'gsay_message(270, 126, 50);

    '
  MarneyEnd: "[]"
master:
  start: |
    if (Only_ONce) then begin
      Only_ONce := 0;
      Master_Ptr := self_obj;
      critter_add_trait(self_obj, 1, 6, 55);
      critter_add_trait(self_obj, 1, 5, 70);
    end
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    if (script_action == 14) then begin
      call damage_p_proc;
    end
    if (script_action == 13) then begin
      call combat_p_proc;
    end
    if (script_action == 11) then begin
      if (global_var(18) == 0) then begin
        call do_dialogue;
      end
    end
    else begin
      if (script_action == 18) then begin
        if (source_obj == dude_obj) then begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
            set_global_var(156, 1);
            set_global_var(157, 0);
          end
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
            set_global_var(157, 1);
            set_global_var(156, 0);
          end
          set_global_var(160, global_var(160) + 1);
          if ((global_var(160) % 6) == 0) then begin
            set_global_var(155, global_var(155) + 1);
          end
        end
        set_global_var(18, 1);
        if (global_var(17) == 1) then begin
          set_global_var(51, 1);
        end
        set_global_var(309, 2);
        if (global_var(55) == 0) then begin
          set_global_var(55, game_time / 10);
        end
      end
      else begin
        if (script_action == 21) then begin
          script_overrides;
          display_msg(message_str(51, 100));
        end
        else begin
          if (script_action == 22) then begin
            if (global_var(241) == 2) then begin
              set_global_var(241, 3);
              dialogue_system_enter;
            end
          end
          else begin
            if (script_action == 12) then begin
              if (local_var(5)) then begin
                if (obj_can_see_obj(self_obj, dude_obj)) then begin
                  HOSTILE := 1;
                end
              end
              if (HOSTILE) then begin
                set_local_var(5, 1);
                HOSTILE := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
              if (global_var(241) == 2) then begin
                if (tile_distance_objs(self_obj, dude_obj) > 10) then begin
                  set_global_var(241, 3);
                  dialogue_system_enter;
                end
              end
              else begin
                if (global_var(241) == 1) then begin
                end
                else begin
                  if (leave != 1) then begin
                    if (tile_distance_objs(self_obj, dude_obj) < 10) then begin
                      dialogue_system_enter;
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  gameover: 'so_long := 1;

    '
  giveme: |
    variable LVar0 := 0;
    if (obj_is_carrying_obj_pid(dude_obj, 194)) then begin
      LVar0 := obj_carrying_pid_obj(dude_obj, 194);
      rm_obj_from_inven(dude_obj, LVar0);
      destroy_object(LVar0);
      call master14;
    end
    else begin
      call master13;
    end
  do_dialogue: |
    if (global_var(241) == 2) then begin
      set_global_var(241, 3);
    end
    call get_reaction;
    start_gdialog(51, self_obj, 4, 6, 11);
    gsay_start;
    MALE := get_critter_stat(dude_obj, 34) == 0;
    if (local_var(5)) then begin
      call master203;
    end
    else begin
      if (local_var(4)) then begin
        if (global_var(56)) then begin
          call master46;
        end
        else begin
          if (is_success(do_check(dude_obj, 3, -1))) then begin
            call master43;
          end
          else begin
            call master44;
          end
        end
      end
      else begin
        set_local_var(4, 1);
        call master00;
      end
    end
    gsay_end;
    end_dialogue;
    if (so_long) then begin
      play_gmovie(10);
      play_gmovie(7);
      metarule(13, 0);
    end
  master00: |
    gsay_reply(51, 101);
    giq_option(4, 51, 102, master01, 50);
    giq_option(6, 51, 103, master04, 50);
    giq_option(4, 51, 104, mastercbt, 51);
    giq_option(5, 51, 105, master38, 50);
    giq_option(-3, 51, 106, master42, 50);
  master01: |
    gsay_reply(51, 107);
    giq_option(4, 51, 108, master02, 50);
    giq_option(4, 51, 109, gameover, 50);
  master02: |
    gsay_reply(51, 110);
    giq_option(4, 51, 111, master03, 51);
    giq_option(4, 51, 112, gameover, 50);
  master03: |
    gsay_message(51, 113, 51);
    call mastercbt;
  master04: |
    gsay_reply(51, 114);
    giq_option(6, 51, 115, master36, 50);
    giq_option(5, 51, 116, master05, 50);
  master05: |
    gsay_reply(51, 117);
    giq_option(4, 51, 118, master06, 50);
  master06: |
    gsay_reply(51, 119);
    giq_option(6, 51, 120, master06_1, 50);
    giq_option(4, 51, 121, master27, 51);
  master06_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call master07;
    end
    else begin
      call master35;
    end
  master07: |
    gsay_reply(51, 122);
    giq_option(7, 51, 123, master08, 50);
    giq_option(6, 51, 124, master33, 51);
    giq_option(5, 51, 125, master31, 50);
  master08: |
    gsay_reply(51, 126);
    giq_option(5, 51, 127, master08_1, 50);
    giq_option(4, 51, 128, master01, 49);
    giq_option(4, 51, 129, mastercbt, 51);
  master08_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call master09;
    end
    else begin
      call master30;
    end
  master09: |
    gsay_reply(51, 130);
    giq_option(5, 51, 131, mastercbt, 51);
    giq_option(6, 51, 132, master10, 50);
    if (obj_carrying_pid_obj(dude_obj, 194) or global_var(310)) then begin
      giq_option(7, 51, 133, master11, 50);
    end
  master10: |
    gsay_message(51, 134, 51);
    call mastercbt;
  master11: |
    gsay_reply(51, 135);
    giq_option(6, 51, 136, master11_1, 50);
    giq_option(6, 51, 137, master20, 50);
    giq_option(4, 51, 138, master28, 50);
  master11_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call master12;
    end
    else begin
      call master29;
    end
  master12: |
    gsay_reply(51, 139);
    giq_option(6, 51, 140, giveme, 50);
    giq_option(5, 51, 141, master26, 50);
    giq_option(6, 51, 142, master20, 50);
  master13: |
    gsay_message(51, 143, 51);
    call mastercbt;
  master14: |
    game_time_advance(game_ticks(180));
    gsay_reply(51, 145);
    giq_option(5, 51, 146, master16, 50);
    giq_option(5, 51, 147, master17, 50);
  master16: |
    gsay_message(51, 148, 51);
    call mastercbt;
  master17: |
    gsay_reply(51, 149);
    giq_option(6, 51, 150, master17_1, 50);
    giq_option(6, 51, 151, master18, 50);
  master17_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call master19;
    end
    else begin
      call master16;
    end
  master18: |
    gsay_message(51, 152, 51);
    call mastercbt;
  master19: |
    gsay_message(51, 153, 50);
    MASTER_HAS_ARMED := 1;
    if (global_var(55) == 0) then begin
      set_global_var(55, game_time / 10);
      set_global_var(18, 1);
      if (global_var(17) == 1) then begin
        set_global_var(51, 1);
      end
      set_global_var(309, 2);
    end
  master20: |
    gsay_message(51, 154, 50);
    call master21;
  master21: |
    gsay_reply(51, 155);
    giq_option(6, 51, 156, master25, 50);
    giq_option(6, 51, 157, master21_1, 50);
    giq_option(6, 51, 158, master24, 50);
  master21_1: |
    if (global_var(54) == 1) then begin
      call master22;
    end
    else begin
      call master23;
    end
  master22: |
    gsay_message(51, 159, 51);
    call mastercbt;
  master23: |
    gsay_message(51, 160, 51);
    call mastercbt;
  master24: |
    gsay_message(51, 161, 51);
    call mastercbt;
  master25: |
    gsay_reply(51, 162);
    giq_option(6, 51, 163, master17, 50);
    giq_option(6, 51, 164, master16, 50);
  master26: |
    gsay_reply(51, 165);
    giq_option(4, 51, 166, mastercbt, 51);
    giq_option(4, 51, 167, master01, 49);
  master27: |
    gsay_reply(51, 168);
    giq_option(4, 51, 169, mastercbt, 51);
    giq_option(4, 51, 170, master01, 50);
  master28: |
    gsay_message(51, 171, 51);
    call mastercbt;
  master29: |
    gsay_message(51, 172, 51);
    call mastercbt;
  master30: |
    gsay_reply(51, 173);
    giq_option(4, 51, 174, mastercbt, 51);
    giq_option(4, 51, 175, master01, 50);
  master31: |
    gsay_reply(51, 176);
    giq_option(5, 51, 177, master32, 50);
    giq_option(5, 51, 178, mastercbt, 51);
  master32: |
    gsay_reply(51, 179);
    giq_option(5, 51, 180, mastercbt, 51);
    giq_option(5, 51, 181, master01, 49);
  master33: |
    gsay_reply(51, 182);
    giq_option(4, 51, 183, master34, 50);
  master34: |
    gsay_reply(51, 184);
    giq_option(4, 51, 185, master01, 50);
    giq_option(4, 51, 186, mastercbt, 51);
  master35: |
    gsay_reply(51, 187);
    giq_option(4, 51, 188, master01, 50);
    giq_option(4, 51, 189, mastercbt, 51);
    giq_option(5, 51, 190, master33, 50);
  master36: |
    gsay_reply(51, 191);
    giq_option(5, 51, 192, master06, 50);
    giq_option(5, 51, 193, master37, 51);
  master37: |
    gsay_message(51, 194, 51);
    call mastercbt;
  master38: |
    gsay_reply(51, 195);
    giq_option(5, 51, 197, mastercbt, 51);
    if ((global_var(108) == 1) or (global_var(108) == 2)) then begin
      giq_option(5, 51, 198, master38_2, 50);
    end
  master38_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call master41;
    end
    else begin
      call master40;
    end
  master38_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call master39;
    end
    else begin
      call master40;
    end
  master39: |
    leave := 1;
    gsay_message(51, 199, 50);
    call masterend;
  master40: |
    gsay_message(51, 200, 51);
    call mastercbt;
  master41: |
    gsay_message(51, 201, 50);
    call masterend;
  master42: |
    gsay_message(51, 202, 51);
    call mastercbt;
  master43: |
    gsay_message(51, 203, 51);
    call mastercbt;
  master44: |
    gsay_reply(51, 204);
    giq_option(4, 51, 300, masterend, 50);
    giq_option(4, 51, 205, master01, 50);
    giq_option(4, 51, 206, master05, 51);
  master45: |
    gsay_message(51, 207, 51);
    call mastercbt;
  master46: |
    gsay_reply(51, 208);
    giq_option(4, 51, 209, master47, 50);
    giq_option(4, 51, 210, mastercbt, 51);
  master47: |
    gsay_message(51, 211, 51);
    call mastercbt;
  master200: 'gsay_message(51, 212, 50);

    '
  master201: 'gsay_message(51, 213, 50);

    '
  master202: 'gsay_message(51, 214, 50);

    '
  master203: |
    gsay_message(51, 215, 51);
    call mastercbt;
  mastercbt: 'HOSTILE := 1;

    '
  masterend: "[]"
  damage_p_proc: 'set_local_var(6, 1);

    '
  combat_p_proc: |
    if (fixed_param == 4) then begin
      if (everyother == 1) then begin
        everyother := 0;
        if (combat_difficulty == 0) then begin
          if (wimpyother == 1) then begin
            wimpyother := 0;
            set_map_var(4, 1);
          end
          else begin
            wimpyother := 1;
          end
        end
        else begin
          set_map_var(4, 1);
        end
      end
      else begin
        everyother := 1;
      end
    end
  map_enter_p_proc: 'animate_stand_obj(self_obj);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
master1:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 16) then begin
          call map_exit_p_proc;
        end
      end
    end
  map_enter_p_proc: |
    set_global_var(79, 2);
    call Darkness;
    Player_Elevation := elevation(dude_obj);
    if (Player_Elevation == 0) then begin
      if ((game_time_hour >= 700) and (game_time_hour < 1800) and (metarule(22, 0) == 0)) then begin
        if (map_var(10) == 0) then begin
          set_map_var(10, 1);
          monstr_ptr := create_object_sid(16777259, 0, 0, 686);
          critter_attempt_placement(monstr_ptr, 24678, 0);
          critter_add_trait(monstr_ptr, 1, 6, 34);
          monstr_ptr := create_object_sid(16777261, 0, 0, 686);
          critter_attempt_placement(monstr_ptr, 25680, 0);
          critter_add_trait(monstr_ptr, 1, 6, 34);
          monstr_ptr := create_object_sid(16777261, 0, 0, 686);
          critter_attempt_placement(monstr_ptr, 25276, 0);
          critter_add_trait(monstr_ptr, 1, 6, 34);
        end
      end
    end
    if (global_var(32) == 0) then begin
      override_map_start(136, 107, 0, 3);
    end
    else begin
      if (global_var(32) == 4) then begin
        override_map_start(98, 60, 0, 3);
      end
      else begin
        if (global_var(32) == 1) then begin
          override_map_start(94, 98, 1, 3);
        end
        else begin
          override_map_start(136, 107, 0, 3);
        end
      end
    end
    call add_party;
  map_update_p_proc: |
    call Darkness;
    if (global_var(55) != 0) then begin
      cur_count := 240 - ((game_time / 10) - global_var(55));
      if (cur_count != prev_count) then begin
        display_msg(message_str(447, 100) + cur_count + message_str(447, 101));
        prev_count := cur_count;
      end
      if (((game_time / 10) - global_var(55)) > 240) then begin
        display_msg(message_str(446, 106));
        play_gmovie(4);
        metarule(13, 0);
      end
    end
  map_exit_p_proc: |
    kill_critter_type(16777259, 0);
    kill_critter_type(16777261, 0);
  Darkness: 'set_light_level(40);

    '
  add_party: |
    if (global_var(26) == 5) then begin
      if (Tandi_ptr == 0) then begin
      end
      critter_add_trait(Tandi_ptr, 1, 6, 0);
    end
master2:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 16) then begin
          call map_exit_p_proc;
        end
      end
    end
  map_enter_p_proc: |
    Player_Elevation := elevation(dude_obj);
    if (Player_Elevation == 0) then begin
      if ((game_time_hour >= 700) and (game_time_hour < 1800) and (metarule(22, 0) == 0)) then begin
        if (map_var(10) == 0) then begin
          set_map_var(10, 1);
          mutan_ptr := create_object_sid(16777408, 0, 0, 524);
          critter_attempt_placement(mutan_ptr, 20532, 0);
          critter_add_trait(mutan_ptr, 1, 6, 34);
          stuff := create_object_sid(15, 0, 0, -1);
          add_obj_to_inven(mutan_ptr, stuff);
          stuff := create_object_sid(39, 0, 0, -1);
          add_obj_to_inven(mutan_ptr, stuff);
          stuff := create_object_sid(40, 0, 0, -1);
          add_obj_to_inven(mutan_ptr, stuff);
          mutan_ptr := create_object_sid(16777408, 0, 0, 524);
          critter_attempt_placement(mutan_ptr, 19337, 0);
          critter_add_trait(mutan_ptr, 1, 6, 34);
          stuff := create_object_sid(28, 0, 0, -1);
          add_obj_to_inven(mutan_ptr, stuff);
          stuff := create_object_sid(39, 0, 0, -1);
          add_obj_to_inven(mutan_ptr, stuff);
          stuff := create_object_sid(40, 0, 0, -1);
          add_obj_to_inven(mutan_ptr, stuff);
          mutan_ptr := create_object_sid(16777408, 0, 0, 524);
          critter_attempt_placement(mutan_ptr, 18740, 0);
          critter_add_trait(mutan_ptr, 1, 6, 34);
          stuff := create_object_sid(28, 0, 0, -1);
          add_obj_to_inven(mutan_ptr, stuff);
          stuff := create_object_sid(39, 0, 0, -1);
          add_obj_to_inven(mutan_ptr, stuff);
          stuff := create_object_sid(40, 0, 0, -1);
          add_obj_to_inven(mutan_ptr, stuff);
          mutan_ptr := create_object_sid(16777408, 0, 0, 524);
          critter_attempt_placement(mutan_ptr, 21339, 0);
          critter_add_trait(mutan_ptr, 1, 6, 34);
          stuff := create_object_sid(28, 0, 0, -1);
          add_obj_to_inven(mutan_ptr, stuff);
          stuff := create_object_sid(39, 0, 0, -1);
          add_obj_to_inven(mutan_ptr, stuff);
          stuff := create_object_sid(40, 0, 0, -1);
          add_obj_to_inven(mutan_ptr, stuff);
        end
      end
    end
    if (global_var(32) == 2) then begin
      override_map_start(112, 84, 0, 3);
    end
    else begin
      if (global_var(32) == 3) then begin
        override_map_start(140, 78, 1, 4);
      end
      else begin
        if (global_var(32) == 5) then begin
          override_map_start(140, 78, 0, 4);
        end
        else begin
          if (global_var(32) == 12) then begin
            override_map_start(55, 68, 0, 5);
            if ((metarule(22, 0) == 0) and (global_var(241) == 100)) then begin
              set_global_var(241, 1);
              create_object_sid(16777363, 13854, 0, 53);
              mutan_ptr := create_object_sid(16777409, 0, 0, 524);
              critter_attempt_placement(mutan_ptr, 15468, 0);
              critter_add_trait(mutan_ptr, 1, 6, 55);
              stuff := create_object_sid(15, 0, 0, -1);
              add_obj_to_inven(mutan_ptr, stuff);
              stuff := create_object_sid(39, 0, 0, -1);
              add_obj_to_inven(mutan_ptr, stuff);
              stuff := create_object_sid(40, 0, 0, -1);
              add_obj_to_inven(mutan_ptr, stuff);
              mutan_ptr := create_object_sid(16777409, 0, 0, 524);
              critter_attempt_placement(mutan_ptr, 15450, 0);
              critter_add_trait(mutan_ptr, 1, 6, 55);
              stuff := create_object_sid(15, 0, 0, -1);
              add_obj_to_inven(mutan_ptr, stuff);
              stuff := create_object_sid(39, 0, 0, -1);
              add_obj_to_inven(mutan_ptr, stuff);
              stuff := create_object_sid(40, 0, 0, -1);
              add_obj_to_inven(mutan_ptr, stuff);
            end
          end
          else begin
            override_map_start(112, 84, 0, 3);
          end
        end
      end
    end
    call Darkness;
    call add_party;
  map_update_p_proc: |
    call Darkness;
    if (global_var(55) != 0) then begin
      cur_count := 240 - ((game_time / 10) - global_var(55));
      if (cur_count != prev_count) then begin
        display_msg(message_str(447, 100) + cur_count + message_str(447, 101));
        prev_count := cur_count;
      end
      if (((game_time / 10) - global_var(55)) > 240) then begin
        display_msg(message_str(447, 106));
        play_gmovie(4);
        metarule(13, 0);
      end
    end
  map_exit_p_proc: 'kill_critter_type(16777408, 0);

    '
  Darkness: 'set_light_level(40);

    '
  add_party: |
    if (global_var(26) == 5) then begin
      if (Tandi_ptr == 0) then begin
      end
      critter_add_trait(Tandi_ptr, 1, 6, 0);
    end
mathia:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 65);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if ((map_var(20) == 1) and (local_var(5) == 0)) then begin
        dialogue_system_enter;
      end
      if ((map_var(19) == 1) and (local_var(6) == 0)) then begin
        dialogue_system_enter;
      end
    end
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(939, self_obj, 4, -1, -1);
    gsay_start;
    if ((map_var(19) == 1) and (local_var(6) == 0)) then begin
      set_local_var(6, 1);
      call Mathia09;
    end
    else begin
      if ((map_var(20) == 1) and (local_var(5) == 0)) then begin
        call Mathia08;
      end
      else begin
        if (local_var(4) == 0) then begin
          set_local_var(4, 1);
          call Mathia01;
        end
        else begin
          call Mathia06;
        end
      end
    end
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(939, 100));
  Mathia01: |
    gsay_reply(939, 101);
    giq_option(-3, 939, 102, Mathia05, 50);
    giq_option(4, 939, 103, Mathia02, 50);
    giq_option(4, 939, 104, MathiaEnd, 50);
  Mathia02: |
    gsay_reply(939, 105);
    giq_option(4, 939, 106, Mathia03, 50);
    giq_option(4, 939, 107, Mathia04, 50);
    giq_option(4, 939, 108, MathiaEnd, 50);
  Mathia03: |
    gsay_reply(939, 109);
    giq_option(4, 939, 110, Mathia04, 50);
    giq_option(4, 939, 111, MathiaEnd, 50);
  Mathia04: |
    gsay_reply(939, 112);
    giq_option(4, 939, 113, MathiaEnd, 50);
  Mathia05: 'gsay_message(939, 114, 51);

    '
  Mathia06: |
    gsay_reply(939, 115);
    giq_option(-3, 939, 116, Mathia05, 50);
    giq_option(4, 939, 117, Mathia02, 50);
    giq_option(4, 939, 118, MathiaEnd, 50);
  Mathia07: |
    gsay_reply(939, 119);
    giq_option(-3, 939, 120, Mathia11, 50);
    giq_option(-3, 939, 121, combat, 51);
    giq_option(4, 939, 122, Mathia11, 50);
    giq_option(4, 939, 123, combat, 51);
  Mathia08: |
    gsay_reply(939, 124);
    giq_option(-3, 939, 125, Mathia05, 50);
    giq_option(4, 939, 126, Mathia08a, 50);
    giq_option(4, 939, 127, Mathia08b, 50);
    giq_option(4, 939, 128, Mathia08c, 50);
    giq_option(4, 939, 129, Mathia08d, 50);
    giq_option(4, 939, 130, Mathia08e, 50);
  Mathia08a: |
    variable LVar0 := 0;
    set_local_var(5, 1);
    LVar0 := create_object_sid(143, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(939, 131, 50);
  Mathia08b: |
    variable LVar0 := 0;
    set_local_var(5, 1);
    LVar0 := create_object_sid(13, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(939, 131, 50);
  Mathia08c: |
    variable LVar0 := 0;
    set_local_var(5, 1);
    LVar0 := create_object_sid(16, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(939, 131, 50);
  Mathia08d: |
    variable LVar0 := 0;
    set_local_var(5, 1);
    LVar0 := create_object_sid(235, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(939, 131, 50);
  Mathia08e: |
    variable LVar0 := 0;
    set_local_var(5, 1);
    LVar0 := create_object_sid(116, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(939, 131, 50);
  Mathia09: |
    gsay_reply(939, 132);
    giq_option(4, 939, 133, Mathia10, 50);
    giq_option(4, 939, 134, MathiaEnd, 50);
    giq_option(-3, 939, 116, Mathia05, 50);
  Mathia10: |
    gsay_reply(939, 135);
    giq_option(4, 939, 134, MathiaEnd, 50);
  Mathia11: |
    set_global_var(108, 5);
    world_map;
  MathiaEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
maxson:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 80);
    end
  critter_p_proc: |
    variable LVar0 := 0;
    if (local_var(15) == 0) then begin
      LVar0 := create_object_sid(195, 0, 0, -1);
      add_obj_to_inven(self_obj, LVar0);
      set_local_var(15, 1);
    end
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(52, self_obj, 4, 12, 5);
    gsay_start;
    if ((global_var(223) == 1) or (global_var(223) == 2)) then begin
      call Maxson34;
    end
    else begin
      if (local_var(5) == 1) then begin
        call Maxson24;
      end
      else begin
        if (local_var(9) == 1) then begin
          call Maxson22;
        end
        else begin
          if (global_var(78) == 2) then begin
            call Maxson20;
          end
          else begin
            if (local_var(4) == 0) then begin
              set_local_var(4, 1);
              call Maxson01;
            end
            else begin
              if (local_var(1) == 1) then begin
                call Maxson21;
              end
              else begin
                call Maxson19;
              end
            end
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
    if (local_var(8) == 1) then begin
      set_local_var(8, 2);
      temp := 1500;
      display_msg(message_str(52, 351) + temp + message_str(52, 352));
      give_exp_points(temp);
    end
    if (Denounce_Player == 1) then begin
      call Remove_Player;
    end
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(52, 100));
  Maxson01: |
    gsay_reply(52, 106);
    giq_option(-3, 52, 333, Maxson32, 50);
    if ((global_var(106) == 2) and (local_var(9) == 0)) then begin
      giq_option(4, 52, 300, Maxson14, 50);
    end
    if ((global_var(106) == 1) and (local_var(9) == 0)) then begin
      giq_option(4, 52, 301, Maxson06, 50);
    end
    giq_option(4, 52, 349, Maxson27, 50);
    giq_option(4, 52, 350, Maxson18, 50);
  Maxson02: |
    gsay_reply(52, 162);
    giq_option(4, 52, 302, Maxson04, 50);
    giq_option(4, 52, 303, Maxson09, 50);
    giq_option(4, 52, 304, Maxson02a, 51);
    giq_option(4, 52, 305, Maxson08, 50);
  Maxson02a: |
    if (is_success(roll_vs_skill(dude_obj, 15, 0))) then begin
      Asked_For_1000 := 1;
      call Maxson09;
    end
    else begin
      call Maxson12;
    end
  Maxson04: |
    set_local_var(9, 1);
    gsay_reply(52, 133);
    giq_option(4, 52, 306, Maxson04a, 50);
    giq_option(4, 52, 307, Maxson27, 50);
    giq_option(4, 52, 308, MaxsonEnd, 50);
  Maxson04a: |
    set_local_var(9, 1);
    set_map_var(20, 1);
    call Maxson05;
  Maxson05: |
    gsay_reply(52, 276);
    giq_option(4, 52, 309, MaxsonEnd, 50);
  Maxson06: |
    gsay_reply(52, 122);
    giq_option(4, 52, 310, Maxson07, 50);
    giq_option(4, 52, 311, Maxson02, 50);
  Maxson07: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(52, 355);
    end
    else begin
      gsay_reply(52, 356);
    end
    giq_option(4, 52, 312, Maxson14, 50);
    giq_option(4, 52, 313, Maxson13, 50);
  Maxson08: |
    gsay_reply(52, 184);
    giq_option(4, 52, 314, Maxson18, 50);
    giq_option(4, 52, 315, Maxson04a, 50);
    giq_option(4, 52, 316, Maxson08a, 50);
  Maxson08a: |
    if (is_success(roll_vs_skill(dude_obj, 15, -20))) then begin
      Asked_For_1000 := 1;
      call Maxson09;
    end
    else begin
      call Maxson12;
    end
  Maxson09: |
    gsay_reply(52, 223);
    giq_option(4, 52, 317, Maxson09a, 51);
    giq_option(4, 52, 318, Maxson18, 50);
    giq_option(4, 52, 319, MaxsonAccept, 50);
  Maxson09a: |
    if (is_success(roll_vs_skill(dude_obj, 15, -10))) then begin
      call Maxson10;
    end
    else begin
      call Maxson11;
    end
  Maxson10: |
    set_local_var(9, 1);
    if (Asked_For_1000) then begin
      item_caps_adjust(dude_obj, 1000);
    end
    else begin
      item_caps_adjust(dude_obj, 500);
    end
    call DownReact;
    gsay_reply(52, 226);
    giq_option(4, 52, 320, MaxsonEnd, 51);
  Maxson11: |
    gsay_message(52, 229, 51);
    Denounce_Player := 1;
  Maxson12: |
    gsay_message(52, 229, 51);
    Denounce_Player := 1;
  Maxson13: |
    gsay_message(52, 231, 51);
    Denounce_Player := 1;
  Maxson14: |
    gsay_reply(52, 146);
    giq_option(4, 52, 321, Maxson02, 50);
  Maxson18: 'gsay_message(52, 222, 50);

    '
  Maxson19: |
    gsay_reply(52, 201);
    giq_option(-3, 52, 333, Maxson32, 50);
    if ((global_var(106) == 2) and (local_var(9) == 0)) then begin
      giq_option(4, 52, 329, Maxson14, 50);
    end
    if ((global_var(106) == 1) and (local_var(9) == 0)) then begin
      giq_option(4, 52, 330, Maxson06, 50);
    end
    giq_option(4, 52, 332, Maxson27, 50);
    giq_option(4, 52, 331, Maxson18, 50);
  Maxson20: |
    gsay_reply(52, 193);
    giq_option(-3, 52, 333, Maxson32, 50);
    if (local_var(7) == 0) then begin
      giq_option(4, 52, 334, Maxson22, 50);
    end
    giq_option(4, 52, 335, Maxson27, 50);
    giq_option(4, 52, 336, Maxson18, 50);
  Maxson21: |
    gsay_reply(52, 201);
    giq_option(-3, 52, 333, Maxson32, 50);
    giq_option(4, 52, 334, Maxson22, 50);
    giq_option(4, 52, 335, Maxson27, 50);
    giq_option(4, 52, 336, Maxson18, 50);
  Maxson22: |
    temp := local_var(7);
    gsay_reply(52, 205);
    if ((temp == 0) and (global_var(17) == 1)) then begin
      giq_option(4, 52, 400, Maxson35, 50);
    end
    else begin
      if ((temp == 0) and (global_var(78) != 2)) then begin
        giq_option(4, 52, 337, Maxson18, 50);
      end
      else begin
        if ((temp == 0) and (global_var(78) == 2) and (global_var(79) == 2)) then begin
          giq_option(4, 52, 339, Maxson23, 50);
        end
        else begin
          if ((temp == 0) and (global_var(78) == 2) and (global_var(79) != 2)) then begin
            giq_option(4, 52, 338, Maxson23, 50);
          end
        end
      end
    end
    giq_option(4, 52, 335, Maxson27, 50);
    giq_option(4, 52, 336, Maxson18, 50);
  Maxson23: |
    set_local_var(7, 1);
    set_local_var(8, 1);
    gsay_reply(52, 213);
    giq_option(4, 52, 340, Maxson24, 50);
  Maxson24: |
    set_local_var(5, 1);
    gsay_reply(52, 219);
    giq_option(4, 52, 341, Maxson25, 50);
    giq_option(4, 52, 342, MaxsonEnd, 50);
  Maxson25: |
    set_local_var(5, 0);
    set_map_var(19, 1);
    gsay_message(52, 221, 50);
  Maxson27: |
    gsay_reply(52, random(138, 140));
    if (local_var(6) == 0) then begin
      giq_option(4, 52, 344, Maxson28, 50);
    end
    giq_option(4, 52, 345, Maxson29, 50);
    giq_option(4, 52, 346, Maxson30, 50);
    giq_option(4, 52, 347, Maxson31, 50);
    giq_option(4, 52, 348, Maxson18, 50);
  Maxson28: |
    variable LVar0 := 0;
    set_local_var(6, 1);
    LVar0 := create_object_sid(216, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_reply(52, 186);
    giq_option(4, 52, 349, Maxson27, 50);
    giq_option(4, 52, 350, Maxson18, 50);
  Maxson29: |
    gsay_reply(52, 172);
    giq_option(4, 52, 349, Maxson27, 50);
    giq_option(4, 52, 350, Maxson18, 50);
  Maxson30: |
    gsay_reply(52, 244);
    giq_option(4, 52, 349, Maxson27, 50);
    giq_option(4, 52, 350, Maxson18, 50);
  Maxson31: |
    gsay_reply(52, 262);
    giq_option(4, 52, 349, Maxson27, 50);
    giq_option(4, 52, 350, Maxson18, 50);
  Maxson32: 'gsay_message(52, 275, 50);

    '
  Maxson34: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(52, 359);
    end
    else begin
      gsay_reply(52, 360);
    end
    giq_option(4, 52, 349, Maxson27, 50);
    giq_option(4, 52, 350, Maxson18, 50);
  Maxson35: |
    set_local_var(7, 1);
    set_local_var(8, 1);
    gsay_reply(52, 133);
    giq_option(4, 52, 335, Maxson27, 50);
    giq_option(4, 52, 336, Maxson18, 50);
  MaxsonEnd: "[]"
  Remove_Player: |
    set_global_var(108, 5);
    set_global_var(583, 0);
    set_global_var(584, 0);
    set_global_var(585, 0);
    set_global_var(586, 0);
    load_map(13, 1);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  MaxsonAccept: 'set_local_var(9, 1);

    '
mbent:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 16) then begin
          call map_exit_p_proc;
        end
      end
    end
  map_enter_p_proc: |
    set_global_var(78, 2);
    if (metarule(14, 0)) then begin
      display_msg(message_str(194, 109));
    end
    radio_trick := map_var(0);
    know_door_code := map_var(1);
    if (global_var(32) == 0) then begin
      override_map_start(133, 111, 0, 5);
    end
    else begin
      if (global_var(32) == 1) then begin
        override_map_start(73, 107, 0, 2);
      end
      else begin
        override_map_start(133, 111, 0, 5);
      end
    end
    call add_party;
    call Lighting;
  map_update_p_proc: |
    call Lighting;
    if (global_var(147) != 0) then begin
      display_msg(message_str(443, 103) + (300 - ((game_time / 10) - global_var(147))) + message_str(443, 104));
      if (((game_time / 10) - global_var(147)) >= 300) then begin
        play_gmovie(3);
        metarule(13, 0);
      end
    end
    if (removal_ptr != 0) then begin
      destroy_object(removal_ptr);
      removal_ptr := 0;
    end
  map_exit_p_proc: 'set_map_var(0, radio_trick);

    '
  Lighting: |
    variable LVar0 := 0;
    LVar0 := game_time_hour;
    if ((LVar0 >= 600) and (LVar0 < 700)) then begin
      set_light_level(LVar0 - 600 + 40);
    end
    else begin
      if ((LVar0 >= 700) and (LVar0 < 1800)) then begin
        set_light_level(100);
      end
      else begin
        if ((LVar0 >= 1800) and (LVar0 < 1900)) then begin
          set_light_level(100 - (LVar0 - 1800));
        end
        else begin
          set_light_level(40);
        end
      end
    end
  add_party: |
    if (global_var(26) == 5) then begin
      if (Tandi_ptr == 0) then begin
      end
      critter_add_trait(Tandi_ptr, 1, 6, 0);
    end
mbout2in:
  start: "[]"
  look_at_p_proc: 'set_map_var(3, self_obj);

    '
  use_p_proc: |
    script_overrides;
    if (source_obj == Katja_ptr) then begin
      float_msg(Katja_ptr, message_str(623, 172), 0);
      set_global_var(271, 2);
      obj_unlock(self_obj);
    end
    else begin
      if (not(obj_is_locked(self_obj))) then begin
        load_map(31, 12);
      end
      else begin
        if ((map_var(1) == 1) or (global_var(271) == 1)) then begin
          display_msg(message_str(526, 101));
          set_global_var(271, 2);
          obj_unlock(self_obj);
        end
        else begin
          display_msg(message_str(526, 100));
        end
      end
    end
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 77) then begin
      if (not(obj_is_locked(self_obj))) then begin
        script_overrides;
        display_msg(message_str(526, 102));
      end
      else begin
        if (is_success(roll_vs_skill(dude_obj, 9, -40))) then begin
          script_overrides;
          display_msg(message_str(526, 103));
          set_global_var(271, 2);
          obj_unlock(self_obj);
          display_msg(message_str(766, 103) + "65" + message_str(766, 104));
          give_exp_points(65);
        end
        else begin
          script_overrides;
          display_msg(message_str(526, 104));
          set_local_var(0, local_var(0) + 1);
        end
      end
    end
    call alert;
  use_skill_on_p_proc: |
    if (action_being_used == 9) then begin
      if (not(obj_is_locked(self_obj))) then begin
        display_msg(message_str(526, 102));
      end
      else begin
        if (is_success(roll_vs_skill(dude_obj, 9, -60))) then begin
          script_overrides;
          set_global_var(271, 2);
          obj_unlock(self_obj);
          display_msg(message_str(526, 103));
          give_exp_points(85);
          display_msg(message_str(766, 103) + "85" + message_str(766, 104));
        end
        else begin
          script_overrides;
          display_msg(message_str(526, 105));
          set_local_var(0, local_var(0) + 1);
        end
      end
    end
    call alert;
  damage_p_proc: |
    set_local_var(0, local_var(0) + 1);
    display_msg(message_str(526, 106));
    call alert;
  alert: |
    if (local_var(0) > 2) then begin
      set_global_var(146, 1);
    end
mbstrong:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 16) then begin
          call map_exit_p_proc;
        end
      end
    end
  map_enter_p_proc: |
    if (metarule(14, 0)) then begin
      field_change := "off";
    end
    if (global_var(146)) then begin
      field_change := "on";
    end
    if (global_var(609)) then begin
      field_change := "off";
    end
    if (global_var(32) == 0) then begin
      override_map_start(120, 75, 0, 2);
    end
    else begin
      if (global_var(32) == 1) then begin
        override_map_start(120, 75, 1, 2);
      end
      else begin
        if (global_var(32) == 12) then begin
          override_map_start(92, 135, 0, 5);
        end
        else begin
          override_map_start(93, 143, 0, 5);
        end
      end
    end
    radio_room_attacked := map_var(13);
    call add_party;
  map_update_p_proc: |
    if (global_var(146) == 0) then begin
      if (elevation(dude_obj) == 0) then begin
        set_global_var(588, 1);
      end
      else begin
        set_global_var(589, 1);
      end
    end
    else begin
      if (map_var(24) == 0) then begin
        display_msg(message_str(766, 186));
        set_map_var(24, 1);
      end
      set_global_var(588, 0);
      set_global_var(589, 0);
    end
    if (global_var(147) != 0) then begin
      display_msg(message_str(441, 108) + (300 - ((game_time / 10) - global_var(147))) + message_str(441, 109));
      if (((game_time / 10) - global_var(147)) >= 300) then begin
        play_gmovie(3);
        metarule(13, 0);
      end
    end
    if (removal_ptr != 0) then begin
      destroy_object(removal_ptr);
      removal_ptr := 0;
    end
  map_exit_p_proc: "[]"
  combat_p_proc: |
    if (global_var(276)) then begin
      script_overrides;
      set_global_var(276, 0);
      set_global_var(57, 3);
      load_map(32, 5);
    end
  add_party: |
    if (global_var(26) == 5) then begin
      if (Tandi_ptr == 0) then begin
      end
      critter_add_trait(Tandi_ptr, 1, 6, 0);
    end
mbvats:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 16) then begin
          call map_exit_p_proc;
        end
      end
    end
  map_enter_p_proc: |
    if (metarule(14, 0)) then begin
      field_change := "off";
    end
    if (global_var(146)) then begin
      field_change := "on";
    end
    if (global_var(609)) then begin
      field_change := "off";
    end
    Player_Elevation := elevation(dude_obj);
    if (global_var(32) == 0) then begin
      override_map_start(144, 64, 0, 3);
    end
    else begin
      if (global_var(32) == 1) then begin
        override_map_start(120, 122, 0, 3);
      end
      else begin
        if (global_var(32) == 2) then begin
          override_map_start(92, 122, 0, 2);
        end
        else begin
          if (global_var(32) == 3) then begin
            override_map_start(120, 122, 1, 3);
          end
          else begin
            if (global_var(32) == 4) then begin
              override_map_start(92, 122, 1, 2);
            end
            else begin
              if (global_var(32) == 5) then begin
                override_map_start(71, 116, 1, 0);
              end
              else begin
                override_map_start(144, 64, 0, 3);
              end
            end
          end
        end
      end
    end
    call add_party;
    if (metarule(14, 0) and global_var(57)) then begin
      move_party := 1;
    end
  map_update_p_proc: |
    if (global_var(146) == 0) then begin
      if (elevation(dude_obj) == 0) then begin
        set_global_var(590, 1);
      end
      else begin
        set_global_var(591, 1);
        if (not(map_var(4)) and not(global_var(57))) then begin
          display_msg(message_str(361, 140));
          give_exp_points(2000);
          set_map_var(4, 1);
        end
      end
    end
    else begin
      if (map_var(19) == 0) then begin
        display_msg(message_str(766, 186));
        set_map_var(19, 1);
      end
      set_global_var(590, 0);
      set_global_var(591, 0);
    end
    if (global_var(147) != 0) then begin
      display_msg(message_str(442, 107) + (300 - ((game_time / 10) - global_var(147))) + message_str(442, 108));
      if (((game_time / 10) - global_var(147)) >= 300) then begin
        play_gmovie(3);
        metarule(13, 0);
      end
    end
    if (removal_ptr != 0) then begin
      destroy_object(removal_ptr);
      removal_ptr := 0;
    end
    if (move_party == 1) then begin
      move_party := 0;
      if ((global_var(118) == 2) and not(Ian_ptr == 0)) then begin
        move_to(Ian_ptr, 26141, 1);
      end
      if (global_var(5) and not(Dog_ptr == 0)) then begin
        move_to(Dog_ptr, 25745, 1);
      end
      if ((global_var(121) == 2) and not(Tycho_ptr == 0)) then begin
        move_to(Tycho_ptr, 26143, 1);
      end
      if ((global_var(244) == 2) and not(Katja_ptr == 0)) then begin
        move_to(Katja_ptr, 26145, 1);
      end
      if ((global_var(26) == 5) and not(Tandi_ptr == 0)) then begin
        move_to(Tandi_ptr, 25947, 1);
      end
    end
  map_exit_p_proc: "[]"
  combat_p_proc: |
    if (global_var(276) == 1) then begin
      script_overrides;
      set_global_var(276, 0);
      set_global_var(57, 3);
      load_map(32, 5);
    end
  add_party: |
    if (global_var(26) == 5) then begin
      if (Tandi_ptr == 0) then begin
      end
      critter_add_trait(Tandi_ptr, 1, 6, 0);
    end
meander:
  start: |
    if (not(initialized)) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
      end
      critter_add_trait(self_obj, 1, 6, 32);
      initialized := 1;
    end
    curtime := DAY;
    if (prevtime != curtime) then begin
      noevent := curtime;
      prevtime := curtime;
      animate_move_obj_to_tile(self_obj, local_var(0), 0);
    end
    if (script_action == 22) then begin
      call timeforwhat;
    end
    else begin
      if (script_action == 11) then begin
        call do_dialogue;
      end
      else begin
        if (script_action == 4) then begin
          hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            if (hostile) then begin
              hostile := 0;
              attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
            end
            else begin
              loopcount := loopcount + 1;
              if (loopcount > 40) then begin
                loopcount := 0;
                if (noevent == 0) then begin
                  noevent := 1;
                  rndx := 5 + random(1, 10);
                  add_timer_event(self_obj, game_ticks(rndx), 0);
                end
              end
            end
          end
          else begin
            if (script_action == 18) then begin
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(160, global_var(160) + 1);
                if ((global_var(160) % 6) == 0) then begin
                  set_global_var(155, global_var(155) + 1);
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    start_gdialog(84, self_obj, 4, -1, -1);
    gsay_start;
    if (hostile) then begin
      call generic01;
    end
    else begin
      call generic00;
    end
    gsay_end;
    end_dialogue;
  timeforwhat: |
    noevent := curtime;
    rndy := random(1, 6);
    if (rndy > 1) then begin
      dist := 2;
    end
    if (rndy > 5) then begin
      dist := 3;
    end
    rndz := random(0, 5);
    prev_tile := tile_num(self_obj);
    new_tile := tile_num_in_direction(prev_tile, rndz, dist);
    if (tile_distance(local_var(0), new_tile) < MAXLEASH) then begin
      animate_move_obj_to_tile(self_obj, new_tile, 0);
    end
  genericend: "[]"
  genericcbt: "[]"
  generic00: |
    rndx := random(1, 7);
    if (rndx == 1) then begin
      gsay_message(84, 100, 50);
    end
    if (rndx == 2) then begin
      gsay_message(84, 101, 50);
    end
    if (rndx == 3) then begin
      gsay_message(84, 102, 50);
    end
    if (rndx == 4) then begin
      gsay_message(84, 103, 50);
    end
    if (rndx == 5) then begin
      gsay_message(84, 104, 50);
    end
    if (rndx == 6) then begin
      call generic02;
    end
    if (rndx == 7) then begin
      call generic03;
    end
  generic01: |
    rndx := random(1, 4);
    if (rndx == 1) then begin
      gsay_message(84, 105, 50);
    end
    if (rndx == 2) then begin
      gsay_message(84, 106, 50);
    end
    if (rndx == 3) then begin
      gsay_message(84, 107, 50);
    end
    if (rndx == 4) then begin
      gsay_message(84, 108, 50);
    end
  generic02: |
    if (SET == 0) then begin
      rndx := random(1, 2);
      if (rndx == 1) then begin
        gsay_message(84, 109, 50);
      end
      if (rndx == 2) then begin
        gsay_message(84, 110, 50);
      end
    end
    else begin
      gsay_message(84, 111, 50);
    end
  generic03: |
    if (MUTANTS == 0) then begin
      rndx := random(1, 2);
      if (rndx == 1) then begin
        gsay_message(84, 112, 50);
      end
      if (rndx == 2) then begin
        gsay_message(84, 113, 50);
      end
    end
    else begin
      gsay_message(84, 114, 50);
    end
medic:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 1);
      initialized := 1;
    end
  critter_p_proc: |
    if (local_var(5)) then begin
      if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
        call flee_dude;
      end
      else begin
        if (tile_distance(tile_num(dude_obj), home_tile) > 4) then begin
          animate_move_obj_to_tile(self_obj, home_tile, 0);
        end
      end
    end
    else begin
      if (tile_num(self_obj) != home_tile) then begin
        animate_move_obj_to_tile(self_obj, home_tile, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(4, 1);
      set_local_var(5, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    if (source_obj == dude_obj) then begin
      set_global_var(261, 1);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(184, 136));
  pickup_p_proc: |
    float_msg(self_obj, message_str(184, 160), 0);
    set_local_var(5, 1);
  talk_p_proc: |
    if (not(local_var(4))) then begin
      call get_reaction;
      start_gdialog(184, self_obj, 4, -1, -1);
      gsay_start;
      player_hits := get_critter_stat(dude_obj, 35);
      player_max_hits := get_critter_stat(dude_obj, 7);
      if ((local_var(5) == 1) or (global_var(261) == 1)) then begin
        call Medic00;
      end
      else begin
        damage := player_max_hits - player_hits;
        if (damage > 7) then begin
          call Medic03;
        end
        else begin
          if (global_var(101) == 2) then begin
            call Medic24;
          end
          else begin
            call Medic04;
          end
        end
      end
      gsay_end;
      end_dialogue;
    end
    else begin
      display_msg(message_str(184, 159));
    end
  Medic00: |
    gsay_reply(184, 100);
    giq_option(4, 184, 101, Medic01, -10);
    giq_option(-3, 184, 102, Medic02, -10);
  Medic01: |
    set_local_var(4, 1);
    gsay_message(184, 103, -10);
  Medic02: |
    set_local_var(4, 1);
    gsay_message(184, 104, -10);
  Medic03: |
    gsay_message(184, 105, 0);
    call Medic16;
  Medic04: |
    gsay_reply(184, message_str(184, 106) + proto_data(obj_pid(dude_obj), 1) + message_str(184, 107));
    giq_option(4, 184, 108, Medic06, 0);
    giq_option(4, 184, 114, Medic04a, 0);
    giq_option(4, 184, 115, Medic08, 0);
    giq_option(-3, 184, 110, Medic05, 0);
  Medic04a: |
    if (damage > 3) then begin
      call Medic14;
    end
    else begin
      call Medic13;
    end
  Medic05: |
    gsay_message(184, 111, 0);
    call pushdrugs;
  Medic06: 'gsay_message(184, 112, 0);

    '
  Medic08: |
    gsay_reply(184, 119);
    giq_option(4, 184, 120, medicend, 0);
    if (global_var(519) == 0) then begin
      giq_option(6, 184, 121, Medic08a, 0);
    end
  Medic08a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -60))) then begin
      call Medic10;
    end
    else begin
      call Medic09;
    end
  Medic09: 'gsay_message(184, 122, 0);

    '
  Medic10: |
    gsay_reply(184, 123);
    giq_option(4, 184, 124, pushdrugs2, 0);
    set_global_var(519, 1);
  Medic13: 'gsay_message(184, 127, 0);

    '
  Medic14: |
    gsay_message(184, 128, 0);
    call Medic16;
  Medic16: |
    gsay_reply(184, 130);
    call Medic17;
  Medic17: |
    gfade_out(600);
    game_time_advance(game_ticks(damage * 10));
    critter_heal(dude_obj, damage);
    gfade_in(600);
    gsay_message(184, 131, 0);
    if (get_critter_stat(dude_obj, 37) > 30) then begin
      call Medic18;
    end
  Medic18: |
    removal := 70 + random(1, 6) + random(1, 6) + random(1, 6);
    rads := get_critter_stat(dude_obj, 37);
    rndx := rads * 20;
    if (rads > 400) then begin
      intensity := message_str(184, 132);
    end
    else begin
      if (rads > 200) then begin
        intensity := message_str(184, 133);
      end
      else begin
        if (rads > 100) then begin
          intensity := message_str(184, 134);
        end
        else begin
          if (rads > 30) then begin
            intensity := message_str(184, 135);
          end
        end
      end
    end
    gsay_reply(184, intensity);
    giq_option(4, 184, 138, Medic19, 0);
    giq_option(4, 184, 139, Medic22, 0);
    giq_option(4, 184, 140, Medic20, 0);
    giq_option(6, 184, 141, Medic21, 0);
    giq_option(-3, 184, 142, Medic19, 0);
    giq_option(-3, 184, 143, Medic22, 0);
  Medic19: 'gsay_message(184, 144, 0);

    '
  Medic20: |
    gsay_reply(184, message_str(184, 145) + rndx + message_str(184, 146));
    giq_option(4, 184, 147, Medic19, 0);
    giq_option(4, 184, 148, Medic22, 0);
  Medic21: |
    gsay_reply(184, message_str(184, 149) + rndx + message_str(184, 150) + removal + message_str(184, 151));
    giq_option(4, 184, 152, Medic19, 0);
    giq_option(4, 184, 153, Medic22, 0);
  Medic22: |
    gsay_message(184, random(154, 155), 0);
    call Medic23;
    radiation_inc(dude_obj, -removal);
  Medic23: |
    gfade_out(600);
    game_time_advance(game_ticks(rndx));
    gfade_in(600);
    gsay_message(184, 156, 0);
  Medic24: |
    gsay_reply(184, 157);
    giq_option(4, 184, 114, Medic04a, 50);
    giq_option(4, 634, 103, medicend, 50);
    giq_option(-3, 184, 110, Medic05, 50);
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
  pushdrugs: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
  pushdrugs2: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(87, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
  medicend: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
medlab:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if (local_var(0) == 0) then begin
          display_msg(message_str(195, 100));
          set_local_var(0, 1);
        end
      end
    end
meeting:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if (local_var(0) == 0) then begin
          set_local_var(0, 1);
          if (is_success(do_check(dude_obj, 4, 0))) then begin
            display_msg(message_str(145, 100));
          end
        end
      end
    end
michael:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 64);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  goto3: |
    gsay_reply(0, message_str(320, 106));
    if (local_var(6) == 0) then begin
      giq_option(5, 320, message_str(320, 107), goto3a, 49);
      giq_option(4, 320, message_str(320, 108), goto11, 50);
      giq_option(4, 320, message_str(320, 109), goto10, 50);
    end
    if (map_var(9) > 0) then begin
      giq_option(4, 320, message_str(320, 146), goto48, 50);
    end
    giq_option(-3, 320, message_str(320, 110), goto4, 50);
  goto3a: |
    call UpReact;
    call goto11;
  goto4: |
    gsay_reply(0, message_str(320, 111));
    giq_option(-3, 320, message_str(320, 112), goto5, 50);
    giq_option(-3, 320, message_str(320, 113), goto5, 50);
  goto5: 'gsay_message(0, message_str(320, 114), 50);

    '
  goto10: 'gsay_message(0, message_str(320, 115), 50);

    '
  goto11: |
    set_local_var(6, 1);
    gsay_reply(0, message_str(320, 116));
    giq_option(4, 320, message_str(320, 118), goto26, 50);
    giq_option(4, 320, message_str(320, 119), gotoend, 50);
  goto11a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call goto13;
    end
    else begin
      call goto12;
    end
  goto12: 'gsay_message(0, message_str(320, 120), 50);

    '
  goto13: |
    gsay_reply(0, message_str(320, 121));
    giq_option(5, 320, message_str(320, 122), goto13a, 50);
    giq_option(4, 320, message_str(320, 123), goto13b, 50);
    giq_option(4, 320, message_str(320, 124), goto22, 50);
  goto13a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        call goto16;
      end
      else begin
        call goto18;
      end
    end
    else begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        call goto14;
      end
      else begin
        call goto17;
      end
    end
  goto13b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call goto22;
    end
    else begin
      call goto15;
    end
  goto14: |
    gsay_message(0, message_str(320, 125), 51);
    call DownReact;
  goto15: |
    gsay_message(0, message_str(320, 126), 51);
    call DownReact;
  goto16: |
    gsay_reply(0, message_str(320, 127));
    giq_option(4, 320, message_str(320, 128), goto16a, 49);
    giq_option(4, 320, message_str(320, 129), goto16b, 51);
  goto16a: |
    call BigUpReact;
    call goto19;
  goto16b: |
    call DownReact;
    call goto20;
  goto17: |
    gsay_message(0, message_str(320, 130), 51);
    call DownReact;
  goto18: |
    gsay_reply(0, message_str(320, 131));
    giq_option(4, 320, message_str(320, 132), goto16a, 49);
    giq_option(4, 320, message_str(320, 133), goto16b, 51);
  goto19: |
    gsay_message(0, message_str(320, 134), 49);
    call TopReact;
    item := create_object_sid(27, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    item := create_object_sid(27, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    item := create_object_sid(27, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
  goto20: 'gsay_message(0, message_str(320, 135), 50);

    '
  goto22: |
    gsay_reply(0, message_str(320, 137));
    giq_option(6, 320, message_str(320, 138), goto23, 50);
    giq_option(4, 320, message_str(320, 139), goto24, 50);
    giq_option(4, 320, message_str(320, 140), gotoend, 50);
  goto23: |
    gsay_message(0, message_str(320, 141), 50);
    call TopReact;
    item := create_object_sid(110, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    item := create_object_sid(110, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
  goto24: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(0, message_str(320, 142), 50);
    end
    else begin
      gsay_message(0, message_str(320, 143), 50);
    end
  goto26: |
    gsay_reply(0, message_str(320, 144));
    if ((get_critter_stat(dude_obj, 3) > 6) and (local_var(5) == 0)) then begin
      giq_option(5, 320, message_str(320, 117), goto11a, 50);
      set_local_var(5, 1);
    end
    giq_option(4, 320, message_str(320, 145), goto27, 50);
    if (map_var(9) > 0) then begin
      giq_option(4, 320, message_str(320, 146), goto48, 50);
    end
    giq_option(4, 320, message_str(320, 147), goto27, 50);
  goto27: |
    gsay_reply(0, message_str(320, 148));
    giq_option(4, 320, message_str(320, 149), goto28, 50);
    giq_option(4, 320, message_str(320, 150), goto29, 50);
    giq_option(4, 320, message_str(320, 151), gotoend, 50);
  goto28: |
    Hear_28 := 1;
    gsay_reply(0, message_str(320, 152));
    if (Hear_29 == 0) then begin
      giq_option(4, 320, message_str(320, 153), goto29, 50);
    end
    giq_option(4, 320, message_str(320, 154), gotoend, 50);
  goto29: |
    Hear_29 := 1;
    gsay_reply(0, message_str(320, 155));
    if (Hear_28 == 0) then begin
      giq_option(8, 320, message_str(320, 156), goto30, 50);
      giq_option(4, 320, message_str(320, 157), goto28, 50);
    end
    giq_option(4, 320, message_str(320, 158), gotoend, 50);
  goto30: |
    gsay_reply(0, message_str(320, 159));
    giq_option(8, 320, message_str(320, 160), UpReact, 50);
  goto38: |
    gsay_reply(0, message_str(320, 167));
    temp2 := map_var(11) + 1;
    set_map_var(11, temp2);
    temp2 := map_var(9) - 1;
    set_map_var(9, temp2);
    item := create_object_sid(temp, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    giq_option(4, 320, message_str(320, 168), gotoend, 50);
    if (map_var(9) > 0) then begin
      giq_option(4, 320, message_str(320, 169), goto43, 50);
    end
  goto43: |
    gsay_message(0, message_str(320, 182), 50);
    call goto49;
  goto44a: |
    temp := 29;
    call goto38;
  goto44b: |
    temp := 30;
    call goto38;
  goto44c: |
    temp := 31;
    call goto38;
  goto44d: |
    temp := 111;
    call goto38;
  goto44e: |
    temp := 33;
    call goto38;
  goto44f: |
    temp := 34;
    call goto38;
  goto44g: |
    temp := 35;
    call goto38;
  goto44h: |
    temp := 36;
    call goto38;
  goto44i: |
    temp := 95;
    call goto38;
  goto47: |
    gsay_reply(0, message_str(320, 183));
    if (map_var(9) > 0) then begin
      giq_option(4, 320, message_str(320, 185), goto48, 50);
    end
    giq_option(4, 320, message_str(320, 108), goto11, 50);
    giq_option(4, 320, message_str(320, 109), goto10, 50);
    giq_option(4, 320, message_str(320, 187), goto47a, 51);
    giq_option(4, 320, message_str(320, 186), gotoend, 50);
    if ((global_var(304) == 1) and (local_var(8) == 0)) then begin
      giq_option(4, 320, message_str(320, 240), goto72, 50);
    end
    giq_option(-3, 320, message_str(320, 110), goto4, 50);
  goto47a: |
    call BigDownReact;
    call gotoend;
  goto48: |
    gsay_message(0, message_str(320, 188), 50);
    call goto49;
  goto49: |
    gsay_message(0, message_str(320, 189), 50);
    if (map_var(20) > 0) then begin
      call goto146a;
    end
    if (map_var(12) > 0) then begin
      call goto146b;
    end
    else begin
      if (map_var(13) > 0) then begin
        call goto147;
      end
      else begin
        if (map_var(14) > 0) then begin
          call goto148;
        end
        else begin
          if (map_var(15) > 0) then begin
            call goto149;
          end
          else begin
            if (map_var(16) > 0) then begin
              call goto150;
            end
            else begin
              if (map_var(10) > map_var(11)) then begin
                call goto144;
              end
            end
          end
        end
      end
    end
  goto60: |
    gsay_reply(0, message_str(320, 207));
    if (map_var(9) > 0) then begin
      giq_option(4, 320, message_str(320, 208), goto61, 50);
    end
    giq_option(4, 320, message_str(320, 209), gotoend, 50);
  goto61: |
    gsay_message(0, message_str(320, 210), 50);
    call goto49;
  goto72: |
    femmod := (get_critter_stat(dude_obj, 3) - 5) * 10;
    gsay_reply(0, message_str(320, 241));
    giq_option(4, 320, message_str(320, 242), goto73, 50);
    giq_option(4, 320, message_str(320, 243), goto76, 50);
    giq_option(4, 320, message_str(320, 244), goto77, 50);
    giq_option(4, 320, message_str(320, 245), goto79, 50);
  goto73: |
    gsay_reply(0, message_str(320, 246));
    giq_option(4, 320, message_str(320, 247), goto73a, 50);
    giq_option(6, 320, message_str(320, 248), goto73b, 50);
    giq_option(7, 320, message_str(320, 249), gotoend, 50);
    giq_option(4, 320, message_str(320, 250), goto73c, 50);
  goto73a: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      conmod := -30;
    end
    else begin
      conmod := femmod;
    end
    if (is_success(roll_vs_skill(dude_obj, 14, conmod))) then begin
      call goto74;
    end
    else begin
      call goto80;
    end
  goto73b: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      conmod := -20;
    end
    else begin
      conmod := femmod;
    end
    if (is_success(roll_vs_skill(dude_obj, 14, conmod))) then begin
      call goto74;
    end
    else begin
      call goto80;
    end
  goto73c: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      conmod := -10;
    end
    else begin
      conmod := femmod;
    end
    if (is_success(roll_vs_skill(dude_obj, 14, conmod))) then begin
      call goto74;
    end
    else begin
      call goto75;
    end
  goto74: |
    item := create_object_sid(229, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    gsay_reply(0, message_str(320, 251));
    giq_option(4, 320, message_str(320, 252), gotoend, 50);
    set_local_var(8, 1);
  goto75: |
    gsay_reply(0, message_str(320, 253));
    giq_option(6, 320, message_str(320, 254), goto75a, 50);
    giq_option(4, 320, message_str(320, 255), goto75b, 50);
    giq_option(4, 320, message_str(320, 256), goto75c, 50);
  goto75a: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      conmod := 0;
    end
    else begin
      conmod := femmod;
    end
    if (is_success(roll_vs_skill(dude_obj, 14, conmod))) then begin
      call goto74;
    end
    else begin
      call goto80;
    end
  goto75b: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      conmod := -100;
    end
    else begin
      conmod := femmod;
    end
    if (is_success(roll_vs_skill(dude_obj, 14, conmod))) then begin
      call goto74;
    end
    else begin
      call goto80;
    end
  goto75c: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      conmod := -20;
    end
    else begin
      conmod := femmod;
    end
    if (is_success(roll_vs_skill(dude_obj, 14, conmod))) then begin
      call goto74;
    end
    else begin
      call goto80;
    end
  goto76: |
    gsay_reply(0, message_str(320, 257));
    giq_option(4, 320, message_str(320, 258), goto76a, 50);
    giq_option(4, 320, message_str(320, 259), gotoend, 50);
  goto76a: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      conmod := -20;
    end
    else begin
      conmod := femmod;
    end
    if (is_success(roll_vs_skill(dude_obj, 14, conmod))) then begin
      call goto74;
    end
    else begin
      call goto75;
    end
  goto77: |
    gsay_reply(0, message_str(320, 260));
    giq_option(4, 320, message_str(320, 261), goto78, 50);
    giq_option(4, 320, message_str(320, 262), goto73, 50);
  goto78: 'gsay_message(0, message_str(320, 263), 50);

    '
  goto79: |
    gsay_reply(0, message_str(320, 264));
    giq_option(4, 320, message_str(320, 265), gotoend, 50);
    giq_option(4, 320, message_str(320, 266), goto79a, 50);
    giq_option(4, 320, message_str(320, 267), goto76, 50);
  goto79a: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      conmod := -20;
    end
    else begin
      conmod := femmod;
    end
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call goto73;
    end
    else begin
      call goto77;
    end
  goto80: 'gsay_message(0, message_str(320, 268), 50);

    '
  goto144: |
    gsay_reply(0, message_str(320, 211));
    giq_option(4, 320, message_str(320, 212), goto145, 50);
    if (map_var(10) > map_var(11)) then begin
      giq_option(4, 320, message_str(320, 213), goto44a, 50);
      giq_option(4, 320, message_str(320, 214), goto44b, 50);
      giq_option(4, 320, message_str(320, 215), goto44c, 50);
      giq_option(4, 320, message_str(320, 216), goto44d, 50);
      giq_option(4, 320, message_str(320, 217), goto44e, 50);
      giq_option(4, 320, message_str(320, 218), goto44f, 50);
      giq_option(4, 320, message_str(320, 500), goto144more, 50);
    end
  goto145: 'gsay_message(0, message_str(320, 222), 50);

    '
  goto146a: |
    gsay_reply(0, message_str(320, 235));
    temp2 := map_var(20) - 1;
    set_map_var(20, temp2);
    temp2 := map_var(9) - 1;
    set_map_var(9, temp2);
    item := create_object_sid(115, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    giq_option(4, 320, message_str(320, 224), gotoend, 50);
    if (map_var(9) > 0) then begin
      giq_option(4, 320, message_str(320, 225), goto43, 50);
    end
  goto146b: |
    gsay_reply(0, message_str(320, 223));
    temp2 := map_var(12) - 1;
    set_map_var(12, temp2);
    temp2 := map_var(9) - 1;
    set_map_var(9, temp2);
    item := create_object_sid(13, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    giq_option(4, 320, message_str(320, 224), gotoend, 50);
    if (map_var(9) > 0) then begin
      giq_option(4, 320, message_str(320, 225), goto43, 50);
    end
  goto147: |
    gsay_reply(0, message_str(320, 226));
    temp2 := map_var(13) - 1;
    set_map_var(13, temp2);
    temp2 := map_var(9) - 1;
    set_map_var(9, temp2);
    item := create_object_sid(16, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    giq_option(4, 320, message_str(320, 227), gotoend, 50);
    if (map_var(9) > 0) then begin
      giq_option(4, 320, message_str(320, 228), goto43, 50);
    end
  goto148: |
    gsay_reply(0, message_str(320, 229));
    temp2 := map_var(14) - 1;
    set_map_var(14, temp2);
    temp2 := map_var(9) - 1;
    set_map_var(9, temp2);
    item := create_object_sid(239, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    giq_option(4, 320, message_str(320, 230), gotoend, 50);
    if (map_var(9) > 0) then begin
      giq_option(4, 320, message_str(320, 231), goto43, 50);
    end
  goto149: |
    gsay_reply(0, message_str(320, 232));
    temp2 := map_var(15) - 1;
    set_map_var(15, temp2);
    temp2 := map_var(9) - 1;
    set_map_var(9, temp2);
    item := create_object_sid(3, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    giq_option(4, 320, message_str(320, 233), gotoend, 50);
    if (map_var(9) > 0) then begin
      giq_option(4, 320, message_str(320, 234), goto43, 50);
    end
  goto150: |
    gsay_reply(0, message_str(320, 235));
    temp2 := map_var(16) - 1;
    set_map_var(16, temp2);
    temp2 := map_var(9) - 1;
    set_map_var(9, temp2);
    item := create_object_sid(52, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    giq_option(4, 320, message_str(320, 236), gotoend, 50);
    if (map_var(9) > 0) then begin
      giq_option(4, 320, message_str(320, 237), goto43, 50);
    end
  do_dialogue: |
    if (local_var(7)) then begin
      if (local_var(1) < 2) then begin
        call goto60;
      end
      else begin
        call goto47;
      end
    end
    else begin
      set_local_var(7, 1);
      call goto3;
    end
  gotoend: "[]"
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(320, self_obj, 4, -1, -1);
    gsay_start;
    call do_dialogue;
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(320, 100));
  goto144more: |
    gsay_reply(0, message_str(320, 211));
    giq_option(4, 320, message_str(320, 212), goto145, 50);
    giq_option(4, 320, message_str(320, 219), goto44g, 50);
    giq_option(4, 320, message_str(320, 220), goto44h, 50);
    giq_option(4, 320, message_str(320, 221), goto44i, 50);
    giq_option(4, 320, message_str(320, 501), goto144, 50);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
michelle:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 47);
      critter_add_trait(self_obj, 1, 5, 27);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
              else begin
                if (script_action == 22) then begin
                  call timed_event_p_proc;
                end
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj) and (global_var(136) < 41)) then begin
      hostile := 1;
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    set_global_var(136, global_var(136) - 1);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    if (((global_var(135) == 2) or get_critter_stat(dude_obj, 6)) > 6) then begin
      call show_true_name;
    end
    else begin
      if (get_critter_stat(dude_obj, 6) < 4) then begin
        call show_false_name;
      end
      else begin
        if (get_critter_stat(dude_obj, 4) < 5) then begin
          call show_false_name;
        end
        else begin
          if (random(0, 1)) then begin
            call show_false_name;
          end
          else begin
            call show_true_name;
          end
        end
      end
    end
  pickup_p_proc: 'hostile := 1;

    '
  timed_event_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      hostile := 1;
    end
  talk_p_proc: |
    start_gdialog(283, self_obj, 4, -1, -1);
    gsay_start;
    set_local_var(0, 1);
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      call Michelle15;
    end
    else begin
      if (global_var(135) == 1) then begin
        call Michelle16;
      end
      else begin
        if (global_var(135) == 2) then begin
          call Michelle17;
        end
        else begin
          call Michelle00;
        end
      end
    end
    gsay_end;
    end_dialogue;
  show_true_name: |
    script_overrides;
    if (local_var(0)) then begin
      display_msg(message_str(283, 100));
    end
    else begin
      display_msg(message_str(283, 103));
    end
  show_false_name: |
    script_overrides;
    display_msg(message_str(283, random(104, 110)));
  Michelle00: |
    gsay_reply(283, 111);
    giq_option(-3, 283, 112, Michelle01, 50);
    giq_option(4, 283, 113, Michelle02, 50);
    giq_option(5, 283, 114, Michelle09, 50);
    giq_option(4, 283, 115, MichelleCombat, 50);
  Michelle01: |
    gsay_reply(283, 116);
    giq_option(-3, 283, 117, MichelleCombat, 50);
    giq_option(-3, 283, 118, MichelleEnd, 50);
  Michelle02: |
    gsay_reply(283, 119);
    giq_option(4, 283, 120, Michelle03, 50);
    giq_option(5, 283, 121, Michelle04, 50);
    giq_option(5, 283, 122, Michelle08, 50);
    giq_option(4, 283, 123, MichelleCombat, 50);
  Michelle03: |
    gsay_message(283, 124, 50);
    call MichelleCombat;
  Michelle04: |
    gsay_reply(283, 125);
    giq_option(5, 283, 126, Michelle05, 50);
    giq_option(5, 283, 127, Michelle06, 50);
    giq_option(7, 283, 128, Michelle07, 50);
  Michelle05: |
    gsay_reply(283, 129);
    giq_option(5, 283, 130, MichelleEnd, 50);
    giq_option(5, 283, 131, MichelleEnd, 50);
  Michelle06: |
    gsay_message(283, 132, 50);
    call MichelleCombat;
  Michelle07: |
    gsay_message(283, 133, 50);
    call MichelleCombat;
  Michelle08: |
    gsay_message(283, 134, 50);
    call MichelleCombat;
  Michelle09: |
    gsay_reply(283, 135);
    giq_option(5, 283, 136, Michelle10, 50);
    giq_option(5, 283, 137, Michelle11, 50);
    giq_option(5, 283, 138, Michelle04, 50);
    giq_option(5, 283, 139, Michelle12, 50);
    giq_option(5, 283, 140, MichelleCombat, 50);
  Michelle10: |
    gsay_message(283, 141, 50);
    call MichelleCombat;
  Michelle11: |
    gsay_message(283, message_str(283, 142) + " " + message_str(283, 143), 50);
    call MichelleCombat;
  Michelle12: |
    gsay_reply(283, 144);
    giq_option(5, 283, 145, Michelle13, 50);
    giq_option(5, 283, 146, Michelle14, 50);
    giq_option(5, 283, 147, MichelleCombat, 50);
  Michelle13: 'gsay_message(283, 148, 50);

    '
  Michelle14: |
    gsay_message(283, 149, 50);
    call MichelleCombat;
  Michelle15: |
    gsay_message(283, 150, 50);
    add_timer_event(self_obj, game_ticks(10), 1);
  Michelle16: 'gsay_message(283, 151, 50);

    '
  Michelle17: 'gsay_message(283, 152, 50);

    '
  MichelleCombat: 'hostile := 1;

    '
  MichelleEnd: "[]"
mike:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 40);
      critter_add_trait(self_obj, 1, 5, 4);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(821, self_obj, 4, -1, -1);
    gsay_start;
    call Mike01;
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(821, 100));
  Mike01: |
    gsay_reply(821, 101);
    giq_option(-3, 821, 102, Mike02, 50);
    giq_option(4, 821, 103, Mike03, 50);
    if (global_var(101) != 2) then begin
      giq_option(4, 821, 104, Mike04, 50);
    end
    giq_option(4, 821, 105, Mike05, 50);
  Mike02: 'gsay_message(821, 106, 50);

    '
  Mike03: |
    gsay_reply(821, 107);
    if (global_var(101) != 2) then begin
      giq_option(4, 821, 108, Mike04, 50);
    end
    giq_option(4, 821, 109, Mike05, 50);
  Mike04: |
    gsay_reply(821, 110);
    giq_option(4, 821, 111, Mike06, 50);
    giq_option(4, 821, 112, Mike03, 50);
    giq_option(4, 821, 113, Mike05, 50);
  Mike05: "[]"
  Mike06: 'call combat;

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
miles:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(249, 100));
    end
    else begin
      display_msg(message_str(249, 101));
    end
  talk_p_proc: |
    if (global_var(251) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if ((local_var(4) == 1) and (get_critter_stat(dude_obj, 4) < 4)) then begin
        float_msg(self_obj, message_str(249, 152), 0);
      end
      else begin
        if (local_var(5) == 2) then begin
          float_msg(self_obj, message_str(249, 152), 0);
        end
        else begin
          call get_reaction;
          start_gdialog(249, self_obj, -1, -1, -1);
          gsay_start;
          if (local_var(4) == 0) then begin
            call Miles01;
          end
          else begin
            if (global_var(138) == 0) then begin
              DisplayMessage := 118;
              call Miles04;
            end
            else begin
              if (global_var(138) == 1) then begin
                call Miles13;
              end
              else begin
                if (global_var(138) == 9302) then begin
                  call Miles18;
                end
                else begin
                  if (global_var(138) == 9303) then begin
                    call Miles19;
                  end
                  else begin
                    if (global_var(138) == 9304) then begin
                      if (local_var(5) == 0) then begin
                        if (obj_is_carrying_obj_pid(dude_obj, 3)) then begin
                          call Miles22;
                        end
                        else begin
                          call Miles22a;
                        end
                      end
                      else begin
                        if (local_var(5) == 9305) then begin
                          if (obj_is_carrying_obj_pid(dude_obj, 3)) then begin
                            call Miles24;
                          end
                          else begin
                            call Miles29;
                          end
                        end
                        else begin
                          if (obj_is_carrying_obj_pid(dude_obj, 3)) then begin
                            call Miles28;
                          end
                          else begin
                            call Miles29;
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
          gsay_end;
          end_dialogue;
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(251, 1);
      critter_add_trait(self_obj, 1, 6, 49);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(251, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
      critter_add_trait(self_obj, 1, 6, 49);
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(251) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  pickup_p_proc: 'set_global_var(251, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      if (obj_is_carrying_obj_pid(self_obj, 41) == 0) then begin
        item_caps_adjust(self_obj, random(500, 750));
      end
      if ((global_var(613) == 9103) or (global_var(613) == 9102)) then begin
        critter_add_trait(self_obj, 1, 6, 0);
      end
      else begin
        critter_add_trait(self_obj, 1, 6, 49);
      end
      critter_add_trait(self_obj, 1, 5, 6);
      Initialize := 0;
    end
  Miles01: |
    gsay_reply(249, 102);
    giq_option(4, 249, 103, Miles02, 50);
    giq_option(4, 249, 104, Miles03, 50);
    giq_option(-3, 249, 105, Miles09, 50);
    set_local_var(4, 1);
  Miles02: 'gsay_message(249, 106, 50);

    '
  Miles03: |
    DisplayMessage := 107;
    call Miles04;
  Miles04: |
    gsay_reply(249, DisplayMessage);
    gsay_option(249, 108, Miles05, 50);
    gsay_option(249, 109, Miles06, 50);
    gsay_option(249, 110, Miles07, 50);
    gsay_option(249, 111, Miles08, 50);
  Miles05: |
    gsay_reply(249, 112);
    gsay_option(249, 113, Miles11, 50);
  Miles06: |
    DisplayMessage := 114;
    call Miles04;
  Miles07: |
    DisplayMessage := 115;
    call Miles04;
  Miles08: 'gsay_message(249, 116, 50);

    '
  Miles09: 'gsay_message(249, 117, 50);

    '
  Miles11: |
    gsay_reply(249, 119);
    gsay_option(249, 120, Miles12, 50);
    gsay_option(249, 121, MilesEnd, 50);
  Miles12: |
    gsay_message(249, 122, 50);
    set_global_var(138, 1);
  Miles13: |
    gsay_reply(249, 123);
    if (obj_is_carrying_obj_pid(dude_obj, 98)) then begin
      gsay_option(249, 124, Miles15, 50);
    end
    else begin
      gsay_option(249, 125, Miles14, 50);
    end
  Miles14: 'gsay_message(249, 126, 50);

    '
  Miles15: |
    gsay_reply(249, 127);
    set_global_var(138, 9302);
    gsay_option(249, 128, Miles16, 50);
    gsay_option(249, 129, MilesEnd, 50);
  Miles16: |
    gsay_reply(249, 130);
    gsay_option(249, 131, Miles17, 50);
    gsay_option(249, 132, Miles17a, 50);
  Miles17: |
    variable LVar0 := 0;
    gsay_message(249, 133, 50);
    LVar0 := obj_carrying_pid_obj(dude_obj, 98);
    rm_obj_from_inven(dude_obj, LVar0);
    destroy_object(LVar0);
    item_caps_adjust(dude_obj, 125);
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(dude_obj, LVar0, 3);
    set_global_var(138, 9304);
    gsay_message(249, 137, 50);
  Miles17a: |
    variable LVar0 := 0;
    call UpReactLevel;
    gsay_message(249, 133, 50);
    LVar0 := obj_carrying_pid_obj(dude_obj, 98);
    rm_obj_from_inven(dude_obj, LVar0);
    destroy_object(LVar0);
    item_caps_adjust(dude_obj, 150);
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(dude_obj, LVar0, 4);
    set_global_var(138, 9304);
    gsay_message(249, 137, 50);
  Miles18: |
    gsay_reply(249, 134);
    gsay_option(249, 128, Miles16, 50);
    gsay_option(249, 129, MilesEnd, 50);
  Miles19: |
    variable LVar0 := 0;
    gsay_message(249, 135, 50);
    gsay_message(249, 136, 50);
    LVar0 := obj_carrying_pid_obj(dude_obj, 98);
    rm_obj_from_inven(dude_obj, LVar0);
    destroy_object(LVar0);
    item_caps_adjust(dude_obj, 250);
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(dude_obj, LVar0, 6);
    set_global_var(138, 9304);
    gsay_message(249, 137, 50);
  Miles22: |
    gsay_reply(249, 138);
    set_local_var(5, 9305);
    set_global_var(615, 1);
    gsay_option(249, 139, MilesEnd, 50);
    gsay_option(249, 140, Miles23, 50);
  Miles22a: 'gsay_message(249, 153, 50);

    '
  Miles23: 'gsay_message(249, 141, 50);

    '
  Miles24: |
    gsay_reply(249, 142);
    if (obj_is_carrying_obj_pid(dude_obj, 237)) then begin
      gsay_option(249, 143, Miles25, 50);
    end
    else begin
      gsay_option(249, 144, MilesEnd, 50);
    end
  Miles25: |
    variable LVar0 := 0;
    gsay_reply(249, 145);
    LVar0 := obj_carrying_pid_obj(dude_obj, 237);
    rm_obj_from_inven(dude_obj, LVar0);
    add_obj_to_inven(self_obj, LVar0);
    set_local_var(5, 9306);
    gsay_option(249, 146, Miles28, 50);
    gsay_option(249, 147, Miles27, 50);
  Miles27: 'gsay_message(249, 148, 50);

    '
  Miles28: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    gsay_message(249, 149, 50);
    gfade_out(600);
    game_time_advance(10 * 60 * 60 * 24);
    gfade_in(600);
    gsay_message(249, 150, 50);
    LVar1 := create_object_sid(42, 0, 0, -1);
    move_obj_inven_to_obj(dude_obj, LVar1);
    move_obj_inven_to_obj(LVar1, dude_obj);
    LVar0 := obj_carrying_pid_obj(dude_obj, 3);
    rm_obj_from_inven(dude_obj, LVar0);
    destroy_object(LVar0);
    destroy_object(LVar1);
    LVar0 := create_object_sid(232, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    set_local_var(5, 2);
  Miles29: 'gsay_message(249, 151, 50);

    '
  MilesEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
missbro:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (local_var(5) == 1) then begin
      if (tile_num(self_obj) != 17145) then begin
        animate_move_obj_to_tile(self_obj, 17145, 0);
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (local_var(4) == 1) then begin
      float_msg(self_obj, message_str(651, random(134, 136)), 2);
    end
    else begin
      set_local_var(4, 1);
      start_gdialog(651, self_obj, 4, -1, -1);
      gsay_start;
      call Brother00;
      gsay_end;
      end_dialogue;
    end
    animate_move_obj_to_tile(self_obj, 17145, 0);
    set_local_var(5, 1);
  destroy_p_proc: |
    set_global_var(109, 5);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(651, 100));
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      if (local_var(5) == 1) then begin
        visible := 0;
      end
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 62);
    end
  Brother00: |
    gsay_reply(651, 101);
    if (global_var(74) < 1) then begin
      giq_option(4, 651, 102, Brother01, 50);
    end
    else begin
      if (global_var(109) == 0) then begin
        giq_option(4, 651, 103, Brother03, 50);
        giq_option(4, 651, 104, Brother04, 50);
      end
      else begin
        giq_option(4, 651, 105, Brother02, 50);
      end
    end
    giq_option(4, 651, 106, Brother03, 50);
    giq_option(-3, 651, 107, BrotherEnd, 50);
    set_global_var(109, 2);
  Brother01: |
    gsay_reply(651, 108);
    if (global_var(74) < 1) then begin
      set_global_var(74, 1);
    end
    call Brother08;
  Brother02: |
    gsay_reply(651, 109);
    giq_option(4, 651, 110, Brother05, 50);
    giq_option(4, 651, 111, Brother11, 50);
    giq_option(4, 651, 112, Brother12, 50);
  Brother03: 'gsay_message(651, 113, 50);

    '
  Brother04: 'gsay_message(651, 114, 50);

    '
  Brother05: |
    gsay_reply(651, 115);
    giq_option(4, 651, 116, Brother07, 50);
    giq_option(4, 651, 117, Brother06, 50);
    giq_option(4, 651, 118, Brother10, 50);
    giq_option(4, 651, 119, Brother09, 50);
  Brother06: |
    gsay_reply(651, 120);
    call Brother08;
  Brother07: |
    gsay_reply(651, 121);
    call Brother08;
  Brother08: |
    giq_option(4, 651, 122, Brother03, 50);
    giq_option(4, 651, 123, Brother04, 50);
  Brother09: 'gsay_message(651, 124, 50);

    '
  Brother10: 'gsay_message(651, 125, 50);

    '
  Brother11: |
    gsay_reply(651, 126);
    giq_option(4, 651, 127, Brother05, 50);
    giq_option(4, 651, 128, Brother03, 50);
    giq_option(4, 651, 129, Brother04, 50);
  Brother12: |
    gsay_reply(651, 130);
    giq_option(4, 651, 131, Brother05, 50);
    giq_option(4, 651, 132, Brother03, 50);
    giq_option(4, 651, 133, Brother04, 50);
  BrotherEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
mlops:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 34);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      if (local_var(0) == 1) then begin
        float_msg(self_obj, message_str(811, 102), 2);
      end
      else begin
        float_msg(self_obj, message_str(811, 101), 2);
      end
      set_local_var(0, 1);
    end
    else begin
      float_msg(self_obj, message_str(811, 103), 2);
      call combat;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(811, 100));
  dialog_end: "[]"
  gotonull: "[]"
mlprison:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 6);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (tile_num(self_obj) < 25000) then begin
      call explode;
    end
    else begin
      if ((map_var(2) == 1) or (map_var(7) == 1)) then begin
        call escape;
      end
      else begin
        if (hostile == 1) then begin
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(682, self_obj, 4, -1, -1);
    gsay_start;
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      if (local_var(5) == 1) then begin
        call goto05;
      end
      else begin
        call goto01;
      end
      set_local_var(5, 1);
    end
    else begin
      if (local_var(4) == 1) then begin
        call goto09;
      end
      else begin
        call goto07;
      end
      set_local_var(4, 1);
    end
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: 'script_overrides;

    '
  goto01: |
    gsay_reply(682, 108);
    giq_option(-3, 682, 109, goto02, 51);
    giq_option(4, 682, 110, goto03, 51);
    giq_option(4, 682, 111, goto04, 51);
  goto02: |
    gsay_message(682, 112, 51);
    call dialog_end;
  goto03: |
    gsay_message(682, 113, 51);
    call dialog_end;
  goto04: |
    gsay_message(682, 128, 51);
    call dialog_end;
  goto05: |
    gsay_reply(682, 114);
    giq_option(-3, 682, 115, goto02, 51);
    giq_option(4, 682, 116, goto06, 51);
    giq_option(4, 682, 117, dialog_end, 51);
  goto06: |
    gsay_message(682, 118, 51);
    call dialog_end;
  goto07: |
    gsay_reply(682, 119);
    giq_option(-3, 682, 115, goto02, 51);
    giq_option(4, 682, 120, goto08, 51);
  goto08: |
    gsay_message(682, 122, 51);
    call dialog_end;
  goto09: |
    gsay_reply(682, 123);
    giq_option(-3, 682, 115, goto02, 51);
    giq_option(4, 682, 124, goto11, 51);
    giq_option(4, 682, 125, dialog_end, 51);
  goto10: |
    gsay_message(682, 126, 51);
    call dialog_end;
  goto11: |
    gsay_message(682, 127, 51);
    call dialog_end;
  explode: 'critter_dmg(self_obj, 128, 6);

    '
  escape: |
    if (said == 0) then begin
      said := 1;
      float_msg(self_obj, message_str(682, 107), 2);
    end
    target_hex := 22912;
    animate_move_obj_to_tile(self_obj, target_hex, 1);
  dialog_end: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
moatgrd:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(6, 100));
  talk_p_proc: |
    if (global_var(617) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      call get_reaction;
      start_gdialog(6, self_obj, -1, -1, -1);
      gsay_start;
      call Moat00;
      gsay_end;
      end_dialogue;
    end
  critter_p_proc: |
    if (tile_num(self_obj) != DestTile) then begin
      animate_move_obj_to_tile(self_obj, DestTile, 0);
    end
    else begin
      anim(self_obj, 1000, 2);
    end
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(617) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(617, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(617, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if (tile_distance_objs(self_obj, dude_obj) < 5) then begin
        set_global_var(617, 1);
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  map_enter_p_proc: |
    if (Initialize) then begin
      if (obj_is_carrying_obj_pid(self_obj, 41) == 0) then begin
        item_caps_adjust(self_obj, random(2, 20));
      end
      critter_add_trait(self_obj, 1, 6, 48);
      critter_add_trait(self_obj, 1, 5, 28);
      if (local_var(4) == 0) then begin
        DestTile := tile_num(self_obj);
        set_local_var(4, DestTile);
      end
      Initialize := 0;
    end
    if (not(metarule(22, 0))) then begin
      move_to(self_obj, local_var(4), 0);
      anim(self_obj, 1000, 2);
    end
    if ((global_var(265) == 2) and (days_since_visited > 1)) then begin
      set_obj_visibility(self_obj, 1);
      move_to(self_obj, 3846, 1);
    end
  pickup_p_proc: 'set_global_var(617, 1);

    '
  Moat00: |
    gsay_reply(6, 101);
    giq_option(4, 6, 103, Moat02, 50);
    if (local_var(5) == 0) then begin
      giq_option(4, 6, 104, Moat05, 50);
      giq_option(4, 6, 115, Moat03, 50);
    end
    else begin
      giq_option(4, 6, 119, Moat04, 50);
      giq_option(4, 6, 118, Moat04, 50);
    end
    giq_option(4, 6, 111, MoatCombat, 51);
    giq_option(-3, 6, 102, Moat01, 50);
  Moat01: |
    gsay_message(6, 107, 50);
    add_timer_event(self_obj, game_ticks(10), 1);
    call BottomReact;
  Moat02: |
    gsay_message(6, 107, 50);
    add_timer_event(self_obj, game_ticks(10 * 2), 1);
    call BottomReact;
  Moat03: |
    gsay_message(6, 116, 50);
    DestTile := 26299;
    set_local_var(5, 1);
  Moat04: |
    gsay_message(6, 117, 50);
    DestTile := 26299;
  Moat05: |
    gsay_message(6, 113, 50);
    DestTile := 26299;
    set_local_var(5, 1);
  MoatCombat: |
    add_timer_event(self_obj, game_ticks(10), 1);
    call BottomReact;
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
modreact:
  start: "[]"
morbcool:
  start: "[]"
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      script_overrides;
      display_msg(message_str(877, 100));
      messing_with_Morbid_stuff := 1;
    end
  use_p_proc: |
    if (source_obj == dude_obj) then begin
      script_overrides;
      display_msg(message_str(877, 101));
      messing_with_Morbid_stuff := 1;
    end
  use_skill_on_p_proc: |
    if (action_being_used == 10) then begin
      script_overrides;
      display_msg(message_str(877, 101));
    end
    else begin
      if (action_being_used == 7) then begin
        test := roll_vs_skill(source_obj, action_being_used, 0);
        if (is_success(test)) then begin
          script_overrides;
          if (is_critical(test)) then begin
            display_msg(message_str(877, 102));
          end
          else begin
            display_msg(message_str(877, 104));
          end
        end
        else begin
          script_overrides;
          display_msg(message_str(877, 103));
        end
      end
    end
morbid:
  start: "[]"
  critter_p_proc: |
    if (global_var(346) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if (GVar5) then begin
      GVar5 := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (GVar11) then begin
        call get_eye;
      end
      else begin
        if ((game_time_hour > 2000) and (game_time_hour < 2330)) then begin
          if (elevation(self_obj) != 1) then begin
            use_obj(ladder_down);
          end
          else begin
            if ((local_var(9) == 0) or (local_var(9) == 3)) then begin
              if (tile_num(self_obj) != 12702) then begin
                animate_move_obj_to_tile(self_obj, 12702, 0);
              end
            end
          end
        end
        else begin
          if ((local_var(9) == 0) or (local_var(9) == 3)) then begin
            call sleeping;
          end
        end
        if (local_var(9) == 1) then begin
          set_local_var(9, 2);
          add_timer_event(self_obj, 10 * 60 * 10, 3);
        end
      end
    end
    if (global_var(346) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        if (GVar13 == 0) then begin
          GVar5 := 1;
          GVar13 := 1;
        end
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(104, 100));
  map_enter_p_proc: |
    critter_add_trait(self_obj, 1, 6, 19);
    Morbid_ptr := self_obj;
    GVar2 := 2330;
    GVar1 := 800;
    GVar3 := 13501;
    GVar4 := 14098;
    if (combat_is_initialized == 0) then begin
      call sleeping;
      if ((game_time_hour > 1700) and (game_time_hour < 2330)) then begin
        move_to(self_obj, 12702, 1);
      end
      else begin
        if ((game_time_hour >= 2330) or (game_time_hour < 800)) then begin
          move_to(self_obj, GVar4, 1);
        end
        else begin
          if ((local_var(9) == 0) or (local_var(9) == 3)) then begin
            move_to(self_obj, GVar3, 0);
          end
        end
      end
    end
    rm_timer_event(self_obj);
    add_timer_event(self_obj, game_ticks(random(10, 30)), 2);
  map_update_p_proc: |
    if (combat_is_initialized == 0) then begin
      if ((game_time_hour > 1700) and (game_time_hour < 2330)) then begin
        move_to(self_obj, 12702, 1);
      end
      else begin
        if ((game_time_hour >= 2330) or (game_time_hour < 800)) then begin
          move_to(self_obj, GVar4, 1);
        end
        else begin
          if ((local_var(9) == 0) or (local_var(9) == 3)) then begin
            move_to(self_obj, GVar3, 0);
          end
        end
      end
    end
  pickup_p_proc: 'GVar5 := 1;

    '
  talk_p_proc: |
    if (local_var(6) == 1) then begin
      start_gdialog(104, self_obj, 4, -1, -1);
      gsay_start;
      call Morbid25;
      gsay_end;
      end_dialogue;
    end
    else begin
      if (local_var(9) != 0) then begin
        float_msg(self_obj, message_str(669, 101), 2);
      end
      else begin
        call get_reaction;
        start_gdialog(104, self_obj, 4, -1, -1);
        gsay_start;
        if (GVar12) then begin
          call Morbid09L;
        end
        else begin
          if (elevation(self_obj) == 1) then begin
            if (not(local_var(5))) then begin
              call Morbid00L;
            end
            else begin
              call Morbid01L;
            end
          end
          else begin
            if ((game_time / (10 * 60 * 60 * 24)) >= 80) then begin
              if (not(local_var(7))) then begin
                call Morbid17;
              end
              else begin
                call Morbid21;
              end
            end
            else begin
              if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
                if (local_var(4)) then begin
                  call Morbid04N;
                end
                else begin
                  call Morbid00N;
                end
              end
              else begin
                if (local_var(4)) then begin
                  if (local_var(1) > 1) then begin
                    call Morbid13;
                  end
                  else begin
                    call Morbid16;
                  end
                end
                else begin
                  if (local_var(1) > 1) then begin
                    call Morbid00;
                  end
                  else begin
                    call Morbid15;
                  end
                end
              end
            end
          end
        end
        gsay_end;
        end_dialogue;
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      critter_injure(dude_obj, 64);
      game_ui_enable;
      GVar12 := 1;
      dialogue_system_enter;
      add_timer_event(self_obj, game_ticks(random(10, 30)), 2);
    end
    else begin
      if (fixed_param == 2) then begin
        if ((elevation(self_obj) == 1) and (game_time_hour > 1700) and (game_time_hour < 2330)) then begin
          reg_anim_func(2, self_obj);
          reg_anim_func(1, 1);
          reg_anim_animate(self_obj, 11, -1);
          reg_anim_obj_move_to_tile(self_obj, 12901, -1);
          reg_anim_animate(self_obj, 10, -1);
          reg_anim_obj_move_to_tile(self_obj, 12702, -1);
          reg_anim_func(3, 0);
        end
        add_timer_event(self_obj, game_ticks(random(10, 30)), 2);
      end
      else begin
        if (fixed_param == 3) then begin
          set_local_var(9, 3);
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(346, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  combat_p_proc: |
    if (fixed_param == 4) then begin
      set_local_var(9, 1);
      if (elevation(self_obj) == 0) then begin
        script_overrides;
        use_obj(ladder_down);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(346, 1);
    end
  Morbid00: |
    set_local_var(4, 1);
    gsay_reply(104, 101);
    giq_option(4, 104, 102, Morbid03, 50);
    giq_option(5, 104, 103, Morbid03, 50);
    giq_option(4, 104, 104, Morbid02, 50);
    giq_option(-3, 104, 105, Morbid00a, 51);
    giq_option(-3, 104, 106, Morbid03, 50);
    if ((global_var(305) == 1) and (local_var(8) == 0)) then begin
      giq_option(4, 104, 233, Morbid27, 51);
    end
  Morbid00a: |
    call DownReact;
    call Morbid01;
  Morbid01: 'gsay_message(104, 107, 50);

    '
  Morbid02: |
    gsay_reply(104, 108);
    giq_option(4, 104, 109, MorbidEnd, 50);
    giq_option(4, 104, 110, DownReact, 51);
  Morbid03: |
    gsay_message(104, 111, 0);
    if ((get_critter_stat(dude_obj, 35) == get_critter_stat(dude_obj, 7)) and not(get_poison(dude_obj)) and (get_critter_stat(dude_obj, 37) < 31)) then begin
      call Morbid04;
    end
    else begin
      call Morbid09;
    end
  Morbid04: |
    gsay_reply(104, 112);
    giq_option(4, 104, 113, Morbid04a, 51);
    giq_option(4, 104, 114, Morbid07, 50);
    giq_option(-3, 104, 129, Morbid04a, 51);
    giq_option(-3, 104, 128, Morbid07, 50);
  Morbid04a: |
    call DownReact;
    call DownReact;
    call Morbid05;
  Morbid05: |
    gsay_reply(104, 115);
    giq_option(4, 104, 116, Morbid07, 50);
    giq_option(4, 104, 117, Morbid05a, 51);
    giq_option(-3, 104, 128, Morbid07, 50);
    giq_option(-3, 104, 129, Morbid05a, 51);
  Morbid05a: |
    call DownReact;
    call DownReact;
    call Morbid06;
  Morbid06: |
    fetch_dude := 1;
    gsay_message(104, 118, 50);
  Morbid07: |
    if (item_caps_total(dude_obj) < 10) then begin
      call Morbid08;
    end
    else begin
      item_caps_adjust(dude_obj, -10);
      gsay_message(104, 119, 50);
    end
  Morbid08: |
    fetch_dude := 1;
    gsay_message(104, 120, 50);
  Morbid09: |
    variable LVar0 := 0;
    gsay_message(104, 121, 50);
    GVar9 := message_str(104, 122);
    if (get_critter_stat(dude_obj, 35) == get_critter_stat(dude_obj, 7)) then begin
      GVar9 := GVar9 + message_str(104, 178);
    end
    else begin
      if (get_critter_stat(dude_obj, 35) > (get_critter_stat(dude_obj, 7) * 0.70000)) then begin
        GVar9 := GVar9 + message_str(104, 179);
      end
      else begin
        if (get_critter_stat(dude_obj, 35) > (get_critter_stat(dude_obj, 7) * 0.50000)) then begin
          GVar9 := GVar9 + message_str(104, 180);
        end
        else begin
          if (get_critter_stat(dude_obj, 35) > (get_critter_stat(dude_obj, 7) * 0.30000)) then begin
            GVar9 := GVar9 + message_str(104, 181);
          end
          else begin
            GVar9 := GVar9 + message_str(104, 182);
          end
        end
      end
    end
    GVar9 := GVar9 + message_str(104, random(183, 186));
    if (get_poison(dude_obj)) then begin
      GVar9 := GVar9 + message_str(104, random(187, 190));
    end
    LVar0 := get_critter_stat(dude_obj, 37);
    if (LVar0 > 30) then begin
      if (LVar0 < 101) then begin
        GVar9 := GVar9 + message_str(104, 191);
      end
      else begin
        if (LVar0 < 201) then begin
          GVar9 := GVar9 + message_str(104, 192);
        end
        else begin
          if (LVar0 < 401) then begin
            GVar9 := GVar9 + message_str(104, 193);
          end
          else begin
            GVar9 := GVar9 + message_str(104, 194);
          end
        end
      end
    end
    if ((LVar0 > 30) and (LVar0 < 251)) then begin
      GVar9 := GVar9 + message_str(104, 195);
    end
    GVar6 := get_critter_stat(dude_obj, 7) - get_critter_stat(dude_obj, 35);
    if (local_var(1) >= 2) then begin
      GVar7 := 20 * GVar6;
      if (get_poison(dude_obj)) then begin
        GVar7 := GVar7 + 50;
      end
    end
    else begin
      GVar7 := 25 * GVar6;
      if (get_poison(dude_obj)) then begin
        GVar7 := GVar7 + 75;
      end
    end
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      GVar7 := GVar7 * (3 / 2);
    end
    gsay_message(104, GVar9, 50);
    call Morbid09a;
  Morbid09a: |
    gsay_reply(104, message_str(104, 123) + GVar7 + message_str(104, 124));
    giq_option(4, 104, 125, Morbid12, 50);
    giq_option(4, 104, 126, Morbid10, 51);
    giq_option(4, 104, 127, Morbid11, 50);
    giq_option(-3, 104, 128, Morbid12, 50);
    giq_option(-3, 104, 129, Morbid11, 50);
  Morbid10: |
    call DownReact;
    gsay_message(104, 130, 51);
  Morbid11: 'gsay_message(104, 131, 50);

    '
  Morbid12: |
    if (item_caps_total(dude_obj) < GVar7) then begin
      call Morbid08;
    end
    else begin
      item_caps_adjust(dude_obj, -GVar7);
      call UpReact;
      gsay_message(104, 132, 50);
      gfade_out(600);
      GVar10 := 300 * GVar6;
      if (get_poison(dude_obj)) then begin
        GVar10 := GVar10 + 1200;
      end
      critter_heal(dude_obj, get_critter_stat(dude_obj, 7) - get_critter_stat(dude_obj, 35));
      poison(dude_obj, -get_poison(dude_obj));
      game_time_advance(game_ticks(GVar10));
      gfade_in(600);
      gsay_message(104, 133, 50);
    end
  Morbid13: |
    gsay_reply(104, 134);
    giq_option(4, 104, 135, Morbid03, 50);
    giq_option(4, 104, 136, Morbid14, 50);
    giq_option(-3, 104, 137, Morbid03, 50);
    if ((global_var(305) == 1) and (local_var(8) == 0)) then begin
      giq_option(4, 104, 233, Morbid27, 51);
    end
  Morbid14: 'gsay_message(104, 138, 50);

    '
  Morbid15: |
    gsay_reply(104, 139);
    giq_option(4, 104, 140, Morbid03, 50);
    giq_option(4, 104, 141, Morbid03, 50);
    giq_option(4, 104, 142, Morbid02, 50);
    giq_option(-3, 104, 143, Morbid03, 50);
  Morbid16: |
    gsay_reply(104, 144);
    giq_option(4, 104, 145, Morbid03, 50);
    giq_option(4, 104, 146, Morbid14, 50);
    giq_option(-3, 104, 147, Morbid03, 50);
  Morbid17: |
    set_local_var(7, 1);
    if (local_var(1) < 2) then begin
      call UpReactLevel;
    end
    gsay_reply(104, 148);
    giq_option(4, 104, 149, Morbid03, 50);
    giq_option(4, 104, 150, Morbid19, 50);
    giq_option(5, 104, 151, Morbid18, 50);
    giq_option(-3, 104, 152, Morbid03, 50);
    if ((global_var(305) == 1) and (local_var(8) == 0)) then begin
      giq_option(4, 104, 233, Morbid27, 51);
    end
  Morbid18: |
    gsay_reply(104, 153);
    giq_option(5, 104, 154, Morbid03, 50);
    giq_option(5, 104, 155, Morbid20, 50);
    giq_option(5, 104, 156, Morbid19, 50);
  Morbid19: 'gsay_message(104, 157, 50);

    '
  Morbid20: |
    variable LVar0 := 0;
    LVar0 := message_str(104, 158);
    if (not(global_var(37))) then begin
      LVar0 := LVar0 + message_str(104, 159);
    end
    LVar0 := LVar0 + message_str(104, 160);
    gsay_reply(104, LVar0);
    giq_option(4, 104, 161, Morbid03, 50);
    giq_option(5, 104, 162, Morbid19, 50);
  Morbid21: |
    gsay_reply(104, 163);
    giq_option(4, 104, 164, Morbid03, 50);
    giq_option(4, 104, 165, Morbid19, 50);
    giq_option(-3, 104, 166, Morbid03, 50);
    if ((global_var(305) == 1) and (local_var(8) == 0)) then begin
      giq_option(4, 104, 233, Morbid27, 51);
    end
  Morbid25: 'gsay_message(104, 173, 50);

    '
  Morbid27: |
    set_local_var(8, 1);
    gsay_reply(104, 234);
    giq_option(4, 104, 235, Morbid28, 51);
  Morbid28: |
    call BottomReact;
    gsay_message(104, 236, 51);
  Morbid00L: |
    gsay_reply(104, 204);
    set_local_var(5, 1);
    giq_option(4, 104, 207, MorbidCombat, 51);
    giq_option(6, 104, 208, Morbid00La, 50);
    giq_option(-3, 104, 209, MorbidCombat, 50);
  Morbid00La: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Morbid02L;
    end
    else begin
      call Morbid01L;
    end
  Morbid01L: |
    gsay_message(104, 210, 51);
    Gretch_call := 1;
  Morbid02L: |
    gsay_reply(104, 211);
    giq_option(5, 104, 212, Morbid02La, 50);
    if (global_var(305) == 1) then begin
      giq_option(5, 104, 213, Morbid03L, 51);
    end
  Morbid02La: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Morbid04L;
    end
    else begin
      call Morbid01L;
    end
  Morbid03L: |
    gsay_message(104, 214, 51);
    Gretch_call := 1;
  Morbid04L: |
    gsay_reply(104, 215);
    giq_option(5, 104, 216, Morbid06L, 50);
    giq_option(5, 104, 217, Morbid05L, 50);
  Morbid05L: |
    variable LVar0 := 0;
    LVar0 := message_str(104, 218);
    LVar0 := LVar0 + message_str(104, 220);
    gsay_reply(104, LVar0);
    giq_option(5, 104, 221, Morbid07L, 50);
    giq_option(5, 104, 222, Morbid06L, 50);
  Morbid06L: |
    gsay_message(104, 223, 51);
    Gretch_call := 1;
  Morbid07L: |
    gsay_reply(104, 224);
    giq_option(5, 104, 225, Morbid08L, 50);
    giq_option(5, 104, 226, Morbid06L, 50);
  Morbid08L: |
    gsay_message(104, 227, 50);
    GVar11 := 1;
  Morbid09L: |
    GVar12 := 0;
    gsay_reply(104, 229);
    giq_option(5, 104, 230, Morbid10L, 50);
  Morbid10L: 'gsay_message(104, 231, 50);

    '
  Morbid00N: |
    gsay_reply(104, 196);
    giq_option(4, 104, 197, Morbid00Na, 50);
    giq_option(5, 104, 198, Morbid00Nb, 50);
    giq_option(-3, 104, 199, Morbid03N, 50);
  Morbid00Na: |
    if (get_critter_stat(dude_obj, 35) < (get_critter_stat(dude_obj, 7) - 7)) then begin
      call Morbid03;
    end
    else begin
      call Morbid01;
    end
  Morbid00Nb: |
    if (get_critter_stat(dude_obj, 35) < (get_critter_stat(dude_obj, 7) - 3)) then begin
      call Morbid03;
    end
    else begin
      call Morbid02N;
    end
  Morbid02N: 'gsay_message(104, 201, 50);

    '
  Morbid03N: 'gsay_message(104, 202, 50);

    '
  Morbid04N: |
    gsay_reply(104, 203);
    giq_option(4, 104, 197, Morbid00Na, 50);
    giq_option(5, 104, 198, Morbid00Nb, 50);
    giq_option(-3, 104, 199, Morbid03N, 50);
  get_eye: |
    game_ui_disable;
    GVar11 := 0;
    reg_anim_func(2, dude_obj);
    reg_anim_func(2, self_obj);
    reg_anim_func(1, 1);
    reg_anim_obj_move_to_obj(self_obj, dude_obj, -1);
    reg_anim_animate(self_obj, 12, -1);
    reg_anim_func(3, 0);
    rm_timer_event(self_obj);
    add_timer_event(self_obj, game_ticks(3), 1);
    display_msg(message_str(104, 228));
  MorbidCombat: 'GVar5 := 1;

    '
  MorbidEnd: "[]"
  sleeping: |
    if (local_var(6) == 1) then begin
      if (not(GVar0) and (game_time_hour >= GVar1) and (game_time_hour < GVar2) or (GVar0 and ((game_time_hour >= GVar1) or (game_time_hour < GVar2)))) then begin
        if (((game_time_hour - GVar1) < 10) and ((game_time_hour - GVar1) > 0)) then begin
          if (tile_num(self_obj) != GVar3) then begin
            animate_move_obj_to_tile(self_obj, GVar3, 0);
          end
          else begin
            set_local_var(6, 0);
          end
        end
        else begin
          move_to(self_obj, GVar3, elevation(self_obj));
          if (tile_num(self_obj) == GVar3) then begin
            set_local_var(6, 0);
          end
        end
      end
    end
    else begin
      if (GVar0 and (game_time_hour >= GVar2) and (game_time_hour < GVar1) or (not(GVar0) and ((game_time_hour >= GVar2) or (game_time_hour < GVar1)))) then begin
        if (((game_time_hour - GVar2) < 10) and ((game_time_hour - GVar2) > 0)) then begin
          if (tile_num(self_obj) != GVar4) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(6, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != GVar4) then begin
            move_to(self_obj, GVar4, elevation(self_obj));
          end
          else begin
            set_local_var(6, 1);
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
morpcomp:
  start: |
    if (script_action == 21) then begin
      script_overrides;
      display_msg(message_str(110, 100));
    end
    else begin
      if (script_action == 6) then begin
        call use_p_proc;
      end
      else begin
        if (script_action == 8) then begin
          if (action_being_used == 12) then begin
            call use_skill_on_p_proc;
          end
        end
      end
    end
  use_p_proc: |
    variable LVar0 := 0;
    if (Hacked == 0) then begin
      script_overrides;
      display_msg(message_str(910, 105));
    end
    else begin
      script_overrides;
      display_msg(message_str(910, 107));
    end
  use_skill_on_p_proc: |
    variable LVar0 := 0;
    LVar0 := roll_vs_skill(dude_obj, 12, 0);
    if (is_success(LVar0)) then begin
      script_overrides;
      display_msg(message_str(910, 107));
      Hacked := 1;
    end
    else begin
      script_overrides;
      display_msg(message_str(910, 106));
    end
morph:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      if (cur_map_index == 18) then begin
        critter_add_trait(self_obj, 1, 6, 20);
      end
      else begin
        critter_add_trait(self_obj, 1, 6, 55);
      end
      critter_add_trait(self_obj, 1, 5, 82);
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(53, 100));
      end
      else begin
        if (script_action == 22) then begin
          if (fixed_param == 1) then begin
            if (obj_can_see_obj(self_obj, dude_obj)) then begin
              dialogue_system_enter;
            end
            else begin
              Signal_wait := 0;
            end
          end
          else begin
            if ((fixed_param == 2) and not(combat_is_initialized)) then begin
              set_obj_visibility(self_obj, 1);
            end
          end
        end
        else begin
          if (script_action == 18) then begin
            if (source_obj == dude_obj) then begin
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                set_global_var(156, 1);
                set_global_var(157, 0);
              end
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                set_global_var(157, 1);
                set_global_var(156, 0);
              end
              set_global_var(160, global_var(160) + 1);
              if ((global_var(160) % 6) == 0) then begin
                set_global_var(155, global_var(155) + 1);
              end
            end
            display_msg(message_str(53, 500));
            give_exp_points(1000);
            set_global_var(241, 200);
          end
          else begin
            if (script_action == 4) then begin
              set_local_var(5, 2);
            end
            else begin
              if (script_action == 14) then begin
                set_local_var(5, 1);
              end
              else begin
                if (script_action == 12) then begin
                  if (global_var(241) == 200) then begin
                    destroy_object(self_obj);
                  end
                  if (global_var(241) == 3) then begin
                    set_obj_visibility(self_obj, 1);
                  end
                  if (global_var(241) == 1) then begin
                    set_global_var(241, 2);
                    add_timer_event(Master_Ptr, game_ticks(5), 1);
                    add_timer_event(self_obj, game_ticks(5), 2);
                    dialogue_system_enter;
                  end
                  if (local_var(5) == 2) then begin
                    set_local_var(5, 1);
                    attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
                  end
                  if (tile_num(self_obj) == 23457) then begin
                    set_obj_visibility(self_obj, 1);
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    MALE := get_critter_stat(dude_obj, 34) == 0;
    if (local_var(5) != 0) then begin
      float_msg(self_obj, message_str(766, 172), 2);
      call morphcbt;
    end
    else begin
      if (global_var(241) == 2) then begin
        call morph66;
        animate_move_obj_to_tile(self_obj, 23457, 0);
      end
      else begin
        if (Signal_wait) then begin
          Signal_wait := 0;
          call morph04a;
        end
        else begin
          if (cur_map_index == 17) then begin
            start_gdialog(53, self_obj, 4, 2, 8);
            gsay_start;
            call morph28;
            gsay_end;
            end_dialogue;
          end
          else begin
            if (global_var(241) == 3) then begin
              float_msg(self_obj, message_str(766, 171), 2);
            end
            else begin
              start_gdialog(53, self_obj, 4, 2, 8);
              gsay_start;
              call morph02;
              gsay_end;
              end_dialogue;
            end
          end
        end
      end
    end
  morphend: "[]"
  morphcbt: 'set_local_var(5, 2);

    '
  morph02: |
    gsay_reply(53, 101);
    giq_option(4, 53, 102, morph02_1, 50);
    giq_option(5, 53, 103, morph02_3, 50);
    giq_option(4, 53, message_str(53, 104) + proto_data(obj_pid(dude_obj), 1) + message_str(53, 105), morph27, 50);
    giq_option(4, 53, 106, morph06, 51);
    giq_option(-3, 53, 107, morph02a, 50);
  morph02a: |
    gsay_message(53, 108, 51);
    call morphcbt;
  morph02_1: |
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      call morph02_2;
    end
    else begin
      call morph06;
    end
  morph02_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call morph03;
    end
    else begin
      call morph06;
    end
  morph02_3: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call morph07;
    end
    else begin
      call morph26;
    end
  morph03: |
    gsay_reply(53, 109);
    giq_option(4, 53, 110, morph03_1, 50);
    giq_option(5, 53, 111, morph03_2, 50);
    giq_option(4, 53, 112, morph23, 50);
    giq_option(4, 53, 113, morph24, 51);
    giq_option(4, 53, 114, morph06, 50);
  morph03_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call morph04;
    end
    else begin
      call morph05;
    end
  morph03_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call morph04;
    end
    else begin
      call morph05;
    end
  morph04: |
    gsay_message(53, 115, 50);
    call morphx;
  morph04a: |
    float_msg(self_obj, message_str(53, 116), 7);
    call morphcbt;
  morph05: |
    gsay_reply(53, 117);
    giq_option(4, 53, 118, morph05a, 51);
    giq_option(4, 53, 119, morph05b, 50);
    giq_option(4, 53, 120, morph06, 51);
  morph06: |
    gsay_message(53, 121, 51);
    call morphcbt;
  morph07: |
    gsay_reply(53, 122);
    giq_option(4, 53, 123, morph08, 50);
    giq_option(4, 53, 124, morph16, 50);
    giq_option(6, 53, 125, morph07_1, 50);
  morph07_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call morph20;
    end
    else begin
      call morph21;
    end
  morph08: |
    gsay_reply(53, 126);
    giq_option(5, 53, 127, morph08a, 50);
    giq_option(4, 53, 128, morph12, 50);
    giq_option(5, 53, 129, morph14, 50);
  morph09: |
    gsay_reply(53, 130);
    giq_option(5, 53, 131, morph10, 50);
    giq_option(5, 53, 132, morph10, 50);
    giq_option(4, 53, 133, morph06, 51);
    giq_option(4, 53, 134, morph11, 51);
  morph10: |
    gsay_reply(53, 135);
    giq_option(4, 53, 136, morph11, 51);
    giq_option(4, 53, 137, morph12, 50);
    giq_option(4, 53, 138, morph10_1, 50);
  morph10_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      set_local_var(1, 2);
      call morph13;
    end
    else begin
      call morph11;
    end
  morph11: |
    gsay_message(53, 139, 51);
    call morphcbt;
  morph12: |
    gsay_reply(53, 140);
    giq_option(4, 53, 141, morphx2, 50);
    giq_option(4, 53, 142, morphcbt, 51);
  morph13: |
    gsay_message(53, 143, 50);
    call morphx2;
  morph14: |
    gsay_reply(53, 144);
    giq_option(4, 53, 145, morph12, 50);
    giq_option(4, 53, 146, morph11, 51);
    giq_option(4, 53, 147, morph15, 51);
  morph15: |
    gsay_message(53, 148, 51);
    call morphcbt;
  morph16: |
    gsay_reply(53, 149);
    giq_option(4, 53, 150, morph17, 50);
    giq_option(4, 53, 151, morph17, 50);
  morph17: |
    gsay_reply(53, 152);
    giq_option(4, 53, 153, morph18, 50);
    giq_option(4, 53, 154, morph18, 50);
  morph18: |
    gsay_reply(53, 155);
    giq_option(4, 53, 156, morph18_1, 50);
    giq_option(4, 53, 157, morph18_2, 50);
  morph18_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, -5))) then begin
      call morph19;
    end
    else begin
      call morph15;
    end
  morph18_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -15))) then begin
      call morph12;
    end
    else begin
      call morph15;
    end
  morph19: |
    gsay_reply(53, 158);
    giq_option(4, 53, 159, morphcbt, 51);
    giq_option(4, 53, 160, morphx2, 50);
  morph20: |
    gsay_message(53, 161, 51);
    call morphcbt;
  morph21: |
    gsay_reply(53, 162);
    giq_option(4, 53, 163, morph08, 50);
    giq_option(4, 53, 164, morph16, 50);
  morph23: |
    gsay_reply(53, 165);
    giq_option(4, 53, 166, morph12, 50);
    giq_option(4, 53, 167, morph16, 50);
    giq_option(4, 53, 168, morph11, 51);
    giq_option(4, 53, 169, morph15, 51);
  morph24: |
    gsay_reply(53, 170);
    giq_option(4, 53, 171, morphcbt, 51);
    giq_option(7, 53, 172, morphcbt, 51);
    giq_option(4, 53, 173, morphcbt, 51);
  morph26: |
    gsay_reply(53, 174);
    giq_option(4, 53, 175, morph12, 50);
    giq_option(5, 53, 176, morph16, 50);
    giq_option(4, 53, 177, morph11, 51);
    giq_option(4, 53, 178, morph15, 51);
  morph27: |
    gsay_reply(53, 179);
    giq_option(4, 53, 180, morph02_1, 50);
    giq_option(4, 53, 181, morph27_1, 50);
  morph27_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call morph07;
    end
    else begin
      call morph06;
    end
  morph28: |
    gsay_reply(53, 182);
    giq_option(5, 53, 183, morph29, 50);
    giq_option(4, 53, 184, morphend, 50);
    giq_option(-3, 53, 185, morph42c, 50);
  morph29: |
    gsay_reply(53, 186);
    giq_option(4, 53, 187, morph30, 50);
    giq_option(4, 53, 188, morphend, 50);
  morph30: |
    gsay_reply(0, 0);
    giq_option(4, 53, 189, morph31, 50);
    giq_option(4, 53, 190, morphend, 50);
    giq_option(4, 53, 191, morph42a, 50);
  morph31: |
    gsay_reply(53, 192);
    giq_option(4, 53, 193, morph32, 50);
    giq_option(4, 53, 194, morph39, 50);
  morph32: |
    gsay_reply(53, 195);
    giq_option(4, 53, 196, morph32a, 51);
    giq_option(4, 53, 197, morph38, 50);
  morph33: |
    gsay_reply(53, 198);
    giq_option(4, 53, 199, morph34, 50);
    giq_option(4, 53, 200, morph33_1, 50);
  morph33_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, -5))) then begin
      call morph35;
    end
    else begin
      call morph37;
    end
  morph34: |
    gsay_message(53, 201, 50);
    call morphx4;
  morph35: |
    gsay_reply(53, 202);
    giq_option(4, 53, 203, morph36, 50);
    giq_option(4, 53, 204, morphend, 50);
  morph36: |
    gsay_message(53, 205, 50);
    call morph30;
  morph37: |
    gsay_message(53, 206, 49);
    call morphx4;
  morph38: |
    gsay_reply(53, 207);
    giq_option(4, 53, 208, morph36, 50);
    giq_option(4, 53, 209, morphend, 50);
  morph39: |
    gsay_reply(53, 210);
    giq_option(4, 53, 211, morph39a, 51);
    giq_option(4, 53, 212, morph39_1, 50);
  morph39_1: "[]"
  morph40: |
    gsay_message(53, 213, 50);
    call morph30;
  morph41: |
    gsay_reply(53, 214);
    giq_option(4, 53, 215, morph30, 50);
    giq_option(4, 53, 216, morphend, 50);
  morph42: |
    gsay_reply(53, 217);
    giq_option(4, 53, 218, morph36, 50);
    giq_option(4, 53, 219, morphend, 50);
  morph42a: |
    gsay_reply(53, 220);
    giq_option(4, 53, 221, morph42a_1, 50);
  morph42a_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call morph42b;
    end
    else begin
      call morph42c;
    end
  morph42b: |
    gsay_message(53, 222, 50);
    call morphx2;
  morph42c: |
    gsay_message(53, 223, 50);
    call morphx4;
  morph45: 'gsay_message(53, 224, 50);

    '
  morph46: 'gsay_message(53, 225, 50);

    '
  morph47: 'gsay_message(53, 226, 50);

    '
  morph48: 'gsay_message(53, 227, 50);

    '
  morph49: 'gsay_message(53, 228, 50);

    '
  morph50: 'gsay_message(53, 229, 50);

    '
  morph51: 'gsay_message(53, 230, 50);

    '
  morph52: 'gsay_message(53, 231, 50);

    '
  morph53: 'gsay_message(53, 232, 50);

    '
  morph54: 'gsay_message(53, 233, 50);

    '
  morph55: 'gsay_message(53, 234, 50);

    '
  morph56: 'gsay_message(53, 235, 50);

    '
  morph57: 'gsay_message(53, 236, 50);

    '
  morph58: 'gsay_message(53, 237, 50);

    '
  morph59: 'gsay_message(53, 238, 50);

    '
  morph60: 'gsay_message(53, 239, 50);

    '
  morph61: 'gsay_message(53, 240, 50);

    '
  morph62: 'gsay_message(53, 241, 50);

    '
  morph63: 'gsay_message(53, 242, 50);

    '
  morph64: 'gsay_message(53, 243, 50);

    '
  morph65: 'gsay_message(53, 244, 50);

    '
  morphx: |
    Signal_wait := 1;
    add_timer_event(self_obj, game_ticks(15), 1);
  morphx2: |
    deliver_player := 1;
    set_global_var(241, 100);
    load_map("mstrlr34.map", 12);
  morphx4: "[]"
  morph66: 'float_msg(self_obj, message_str(53, 245), 2);

    '
  morph05a: |
    call DownReact;
    call morph06;
  morph08a: |
    call DownReact;
    call morph09;
  morph32a: |
    call DownReact;
    call morph33;
  morph39a: |
    call DownReact;
    call morph33;
  morph05b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call morph07;
    end
    else begin
      call morph26;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
mrhandya:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (global_var(275) != 0) then begin
      if ((critter_state(self_obj) bwand 64) == 0) then begin
        critter_injure(self_obj, 64);
      end
    end
    if (global_var(274) != 0) then begin
      if ((critter_state(self_obj) bwand 4) == 0) then begin
        critter_injure(self_obj, 4);
      end
    end
    if (global_var(274) == 2) then begin
      if ((critter_state(self_obj) bwand 8) == 0) then begin
        critter_injure(self_obj, 8);
      end
    end
    if (global_var(146) == 1) then begin
      if (global_var(275) == 0) then begin
        if (global_var(273) == 0) then begin
          if (obj_can_see_obj(self_obj, dude_obj)) then begin
            hostile := 1;
          end
        end
        else begin
          if (global_var(273) == 1) then begin
            if (obj_can_see_obj(self_obj, valid_target)) then begin
              attack_complex(valid_target, 0, 1, 0, 0, 30000, 0, 0);
            end
          end
          else begin
            if (global_var(273) == 2) then begin
              if (obj_can_see_obj(self_obj, valid_target)) then begin
                attack_complex(valid_target, 0, 1, 0, 0, 30000, 0, 0);
              end
            end
            else begin
              if (global_var(273) == 3) then begin
                if (obj_can_see_obj(self_obj, dude_obj)) then begin
                  hostile := 1;
                end
              end
            end
          end
        end
      end
      if (global_var(274) != 2) then begin
        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), random(0, 5), random(1, 3)), 0);
      end
    end
  description_p_proc: |
    script_overrides;
    if (local_var(0)) then begin
      display_msg(message_str(365, 100));
    end
    else begin
      display_msg(message_str(365, 101));
    end
  use_skill_on_p_proc: |
    if (action_being_used == 13) then begin
      if (local_var(0) == 0) then begin
        call Repair_Attempt;
      end
    end
    else begin
      if (action_being_used == 10) then begin
        script_overrides;
      end
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 71);
      initialized := 1;
    end
    if (global_var(273) == 2) then begin
      critter_add_trait(self_obj, 1, 6, 85);
    end
  Repair_Attempt: |
    variable LVar0 := 0;
    game_time_advance(game_ticks(1200));
    LVar0 := roll_vs_skill(dude_obj, 13, 0);
    if (not(local_var(1)) and is_success(LVar0)) then begin
      display_msg(message_str(365, 102));
      set_local_var(0, 1);
    end
    else begin
      display_msg(message_str(365, 103));
      set_local_var(1, 1);
    end
mrhandyc:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  combat_p_proc: |
    if (fixed_param == 4) then begin
      if ((local_var(0) == 0) or (local_var(1) == 0)) then begin
        script_overrides;
      end
    end
  critter_p_proc: |
    if (local_var(0) and local_var(1) and (local_var(2) == 0) and (local_var(3) == 0) and (tile_distance_objs(self_obj, dude_obj) < 12)) then begin
      set_local_var(2, 1);
      dialogue_system_enter;
    end
    if (local_var(3) == 1) then begin
      if (tile_num(self_obj) != 20530) then begin
        animate_move_obj_to_tile(self_obj, 20530, 0);
      end
      else begin
        field_change := "off";
        explosion(tile_num(self_obj), elevation(self_obj), 0);
        explosion(tile_num_in_direction(tile_num(self_obj), 5, 1), elevation(self_obj), 0);
        explosion(tile_num_in_direction(tile_num(self_obj), 0, 1), elevation(self_obj), 0);
        explosion(tile_num_in_direction(tile_num(self_obj), 5, 2), elevation(self_obj), 0);
        explosion(tile_num_in_direction(tile_num(self_obj), 0, 2), elevation(self_obj), 0);
        display_msg(message_str(631, 117));
        give_exp_points(1000);
        critter_dmg(self_obj, 250, 6);
        set_local_var(3, 2);
      end
    end
  description_p_proc: |
    if (not(local_var(0))) then begin
      display_msg(message_str(631, 100));
    end
    else begin
      if (not(local_var(1))) then begin
        display_msg(message_str(631, 101));
        if (get_critter_stat(dude_obj, 4) > (get_critter_stat(dude_obj, 1) + has_trait(0, dude_obj, 0))) then begin
          if (is_success(do_check(dude_obj, 4, 0))) then begin
            display_msg(message_str(631, 102));
          end
        end
        else begin
          if (is_success(do_check(dude_obj, 1, has_trait(0, dude_obj, 0)))) then begin
            display_msg(message_str(631, 102));
          end
        end
      end
    end
  talk_p_proc: |
    if (local_var(0) and local_var(1)) then begin
      start_gdialog(631, self_obj, 4, -1, -1);
      gsay_start;
      call MrHandyC00;
      gsay_end;
      end_dialogue;
    end
  use_skill_on_p_proc: |
    if (action_being_used == 10) then begin
      script_overrides;
    end
    if (action_being_used == 12) then begin
      if (not(local_var(0))) then begin
        script_overrides;
        display_msg(message_str(631, 103));
      end
      else begin
        if (not(local_var(1))) then begin
          script_overrides;
          game_time_advance(game_ticks(300));
          if (is_success(roll_vs_skill(dude_obj, 12, 0))) then begin
            display_msg(message_str(631, 105));
            set_local_var(1, 1);
          end
          else begin
            display_msg(message_str(631, 106));
          end
        end
      end
    end
    else begin
      if (action_being_used == 13) then begin
        if (not(local_var(0))) then begin
          script_overrides;
          game_time_advance(game_ticks(12000));
          if (is_success(roll_vs_skill(dude_obj, 13, 0))) then begin
            display_msg(message_str(631, 101));
            set_local_var(0, 1);
          end
          else begin
            display_msg(message_str(631, 104));
          end
        end
      end
    end
  map_enter_p_proc: |
    if (not(GVar0)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 71);
      GVar0 := 1;
    end
  MrHandyC00: |
    gsay_reply(631, 107);
    giq_option(-3, 631, 108, MrHandyC01, 0);
    giq_option(4, 631, 109, MrHandyC02, 0);
    giq_option(4, 631, 110, MrHandyC01, 0);
  MrHandyC01: |
    gsay_message(631, 111, 0);
    set_local_var(3, 1);
  MrHandyC02: |
    gsay_reply(631, 112);
    giq_option(4, 631, 113, MrHandyC01, 0);
    giq_option(6, 631, 114, MrHandyC03, 0);
  MrHandyC03: |
    gsay_reply(631, 115);
    giq_option(6, 631, 116, MrHandyC01, 0);
mstmerch:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    call MasterMerch00;
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (map_var(2) == 0) then begin
      float_msg(self_obj, message_str(598, 156), 2);
    end
    else begin
      if (global_var(205) == 5) then begin
        start_gdialog(598, self_obj, 4, -1, -1);
        gsay_start;
        call Lost;
        gsay_end;
        end_dialogue;
      end
      else begin
        if (global_var(205) == 3) then begin
          start_gdialog(598, self_obj, 4, -1, -1);
          gsay_start;
          call Abandoned;
          gsay_end;
          end_dialogue;
        end
        else begin
          if (local_var(4) == 0) then begin
            set_local_var(4, 1);
            start_gdialog(598, self_obj, 4, -1, -1);
            gsay_start;
            call MasterMerch01;
            gsay_end;
            end_dialogue;
          end
          else begin
            if ((local_var(5) > 0) and (global_var(101) < 1)) then begin
              start_gdialog(598, self_obj, 4, -1, -1);
              gsay_start;
              call MasterMerch19;
              gsay_end;
              end_dialogue;
            end
            else begin
              start_gdialog(598, self_obj, 4, -1, -1);
              gsay_start;
              call MasterMerch10;
              gsay_end;
              end_dialogue;
            end
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(598, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 35);
      critter_add_trait(self_obj, 1, 5, 50);
    end
  MasterMerch00: |
    float_msg(self_obj, message_str(598, 101), 2);
    call combat;
  MasterMerch01: |
    gsay_reply(598, 102);
    giq_option(4, 598, 103, MasterMerch02, 50);
    if ((global_var(101) != 2) or ((global_var(30) == 1) and (global_var(31) == 0))) then begin
      giq_option(4, 598, 104, MasterMerch04, 50);
    end
    giq_option(4, 598, 105, MasterMerchEnd, 50);
    giq_option(-3, 598, 106, MasterMerch03, 50);
  MasterMerch02: |
    set_map_var(1, 1);
    gsay_reply(598, 107);
    giq_option(4, 598, 108, MasterMerchEnd, 50);
    if ((global_var(101) != 2) or ((global_var(30) == 1) and (global_var(31) == 0))) then begin
      giq_option(4, 598, 109, MasterMerch04, 50);
    end
    giq_option(-3, 598, 110, MasterMerch03, 50);
  MasterMerch03: 'gsay_message(598, 111, 50);

    '
  MasterMerch04: |
    if (global_var(72) == 0) then begin
      set_global_var(72, 1);
    end
    gsay_reply(598, 112);
    giq_option(4, 598, 113, MasterMerch13, 50);
    giq_option(4, 598, 114, MasterMerch05, 50);
    giq_option(4, 598, 115, MasterMerch06, 50);
    giq_option(4, 598, 116, MasterMerch07, 50);
  MasterMerch05: |
    set_local_var(6, 1);
    gsay_reply(598, 117);
    giq_option(4, 598, 118, MasterMerch14, 50);
    giq_option(4, 598, 119, MasterMerch08, 50);
    giq_option(4, 598, 120, MasterMerch07, 50);
  MasterMerch06: 'gsay_message(598, 121, 50);

    '
  MasterMerch07: 'gsay_message(598, 122, 50);

    '
  MasterMerch08: |
    gsay_reply(598, 123);
    giq_option(4, 598, 124, MasterMerch14, 50);
    giq_option(4, 598, 125, MasterMerch09, 50);
  MasterMerch09: 'gsay_message(598, 126, 50);

    '
  MasterMerch10: |
    gsay_reply(598, 127);
    if ((global_var(101) != 2) and (global_var(101) != 1) and (local_var(6) == 0)) then begin
      giq_option(4, 598, 128, MasterMerch04, 50);
    end
    else begin
      if ((global_var(101) != 2) and (global_var(101) != 1) and (local_var(6) == 1)) then begin
        giq_option(4, 598, 129, MasterMerch12, 50);
      end
    end
    giq_option(4, 598, 130, MasterMerch11, 50);
    giq_option(4, 598, 131, MasterMerchEnd, 50);
    giq_option(-3, 598, 106, MasterMerch03, 50);
  MasterMerch11: |
    set_map_var(1, 1);
    gsay_message(598, 132, 50);
  MasterMerch12: |
    gsay_reply(598, 133);
    giq_option(4, 598, 134, MasterMerch13, 50);
    giq_option(4, 598, 135, MasterMerch14, 50);
    giq_option(4, 598, 136, MasterMerchEnd, 50);
  MasterMerch13: |
    gsay_reply(598, 137);
    giq_option(4, 598, 138, MasterMerch14, 50);
    giq_option(4, 598, 139, MasterMerch07, 50);
  MasterMerch14: |
    gsay_reply(598, 140);
    call MasterMerch15;
  MasterMerch15: |
    if (local_var(5) == 0) then begin
      set_local_var(5, 2000);
    end
    giq_option(4, 598, 141, MasterMerch16, 50);
    if (local_var(7) == 0) then begin
      giq_option(4, 598, 142, MasterMerch17, 50);
    end
    if (local_var(7) == 0) then begin
      giq_option(4, 598, 143, MasterMerch18, 50);
    end
    giq_option(4, 598, 144, MasterMerchEnd, 50);
  MasterMerch16: |
    if (item_caps_total(dude_obj) < local_var(5)) then begin
      gsay_message(598, message_str(598, 145) + local_var(5) + message_str(598, 146), 50);
      call MasterMerchEnd;
    end
    else begin
      gsay_reply(598, 147);
      giq_option(4, 598, 148, MasterMerchEnd, 50);
      if (global_var(101) != 2) then begin
        giq_option(4, 598, 149, MasterMerch20, 50);
      end
    end
  MasterMerch17: |
    set_local_var(7, 1);
    if (is_success(roll_vs_skill(dude_obj, 15, -15))) then begin
      set_local_var(5, 1000);
      gsay_message(598, 150, 50);
      call MasterMerch16;
    end
    else begin
      gsay_reply(598, 151);
      call MasterMerch15;
    end
  MasterMerch18: |
    set_local_var(7, 1);
    if (is_success(roll_vs_skill(dude_obj, 15, -30))) then begin
      set_local_var(5, 500);
      gsay_message(598, 152, 50);
      call MasterMerch16;
    end
    else begin
      gsay_reply(598, 153);
      call MasterMerch15;
    end
  MasterMerch19: |
    gsay_reply(598, message_str(598, 157) + local_var(5) + message_str(598, 158));
    call MasterMerch15;
  MasterMerch20: |
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, -1 * local_var(5));
    set_global_var(101, 1);
    set_global_var(10, global_var(10) + 100);
    if (global_var(154) >= 100) then begin
      set_global_var(154, global_var(154) - 90);
    end
    give_exp_points(1000);
    display_msg(message_str(766, 103) + 1000 + message_str(766, 104));
    gsay_message(598, 155, 50);
  MasterMerchEnd: "[]"
  Lost: |
    set_map_var(2, 0);
    set_global_var(205, 6);
    gsay_message(598, 200, 50);
  Abandoned: 'gsay_message(598, 201, 50);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
mutant2:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      init_teams := 1;
    end
    if (script_action == 22) then begin
      call timeforwhat;
    end
    else begin
      if (local_var(2) == 0) then begin
        set_local_var(2, tile_num(self_obj));
      end
      if (script_action == 11) then begin
        call do_dialogue;
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            if (global_var(13) == 0) then begin
              set_obj_visibility(self_obj, 1);
            end
            else begin
              maxsight := get_critter_stat(self_obj, 1);
              time := game_time_hour;
              if ((time > 2300) or (time < 600)) then begin
                maxsight := 4;
              end
              if ((tile_distance_objs(self_obj, dude_obj) <= maxsight) and obj_can_see_obj(self_obj, dude_obj)) then begin
                if ((Hostile > 0) or (local_var(0) > 0)) then begin
                  Hostile := 0;
                  attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
                end
                else begin
                  call do_dialogue;
                end
              end
              loopcount := loopcount + 1;
              if (loopcount > 40) then begin
                loopcount := 0;
                if (noevent == 0) then begin
                  noevent := 1;
                  rndx := 5 + random(1, 10);
                  add_timer_event(self_obj, game_ticks(rndx), 0);
                end
              end
            end
          end
          else begin
            if (script_action == 18) then begin
              set_global_var(35, global_var(35) + 1);
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(160, global_var(160) + 1);
                if ((global_var(160) % 6) == 0) then begin
                  set_global_var(155, global_var(155) + 1);
                end
              end
            end
            else begin
              if (script_action == 21) then begin
                display_msg(message_str(13, 100));
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    start_gdialog(13, self_obj, 4, -1, -1);
    gsay_start;
    set_local_var(0, 1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(13, 101, 50);
    end
    else begin
      gsay_message(13, 102, 50);
    end
    gsay_end;
    end_dialogue;
  timeforwhat: |
    noevent := 0;
    rndy := random(1, 6);
    if (rndy > 1) then begin
      dist := 2;
    end
    if (rndy > 5) then begin
      dist := 3;
    end
    rndz := random(0, 5);
    set_local_var(3, tile_num(self_obj));
    new_tile := tile_num_in_direction(local_var(3), rndz, dist);
    if (tile_distance(local_var(2), new_tile) < maxleash) then begin
      animate_move_obj_to_tile(self_obj, new_tile, 0);
    end
  genericend: "[]"
  genericcbt: "[]"
mutant3:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      init_teams := 1;
    end
    else begin
      if (script_action == 22) then begin
        call timeforwhat;
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            if (Hostile) then begin
              Hostile := 0;
              attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
            end
            else begin
              if (global_var(13) == 0) then begin
                set_obj_visibility(self_obj, 1);
              end
              else begin
                if (local_var(0) != 1) then begin
                  couple_of_minutes := 150 + random(1, 60);
                  add_timer_event(self_obj, game_ticks(couple_of_minutes), 0);
                end
              end
            end
          end
          else begin
            if (script_action == 18) then begin
              set_global_var(35, global_var(35) + 1);
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(160, global_var(160) + 1);
                if ((global_var(160) % 6) == 0) then begin
                  set_global_var(155, global_var(155) + 1);
                end
              end
            end
            else begin
              if (script_action == 21) then begin
                display_msg(message_str(232, 100));
              end
            end
          end
        end
      end
    end
  timeforwhat: |
    if (local_var(0) == 1) then begin
      animate_move_obj_to_tile(self_obj, 16929, 0);
      set_local_var(0, 0);
    end
    else begin
      animate_move_obj_to_tile(self_obj, 10917, 0);
      set_local_var(0, 1);
      add_timer_event(self_obj, game_ticks(40), 0);
    end
  supercbt: 'Hostile := 1;

    '
  superx: 'call supercbt;

    '
mutant4:
  start: |
    if (script_action == 12) then begin
      if (global_var(13) == 0) then begin
        set_obj_visibility(self_obj, 1);
      end
      else begin
        if ((tile_num(self_obj) != 16929) and (Times == 0)) then begin
          Times := 1;
          animate_move_obj_to_tile(self_obj, 16929, 0);
          add_timer_event(self_obj, game_ticks(60), 1);
        end
      end
    end
    else begin
      if (script_action == 22) then begin
        if (fixed_param == 1) then begin
          animate_move_obj_to_tile(self_obj, 10917, 0);
          add_timer_event(self_obj, game_ticks(60), 2);
        end
        else begin
          if (fixed_param == 2) then begin
            animate_move_obj_to_tile(self_obj, 16929, 0);
            add_timer_event(self_obj, game_ticks(60), 1);
          end
        end
      end
      else begin
        if (script_action == 21) then begin
          script_overrides;
          display_msg(message_str(0, 100));
        end
        else begin
          if (script_action == 18) then begin
            set_global_var(35, global_var(35) + 1);
          end
        end
      end
    end
mutant5:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      init_teams := 1;
    end
    else begin
      if (script_action == 4) then begin
        Hostile := 1;
      end
    end
    if (script_action == 12) then begin
      if (global_var(13) == 0) then begin
        set_obj_visibility(self_obj, 1);
      end
      else begin
        if (Hostile) then begin
          Hostile := 0;
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
        if ((tile_num(self_obj) != 16929) and (Times == 0)) then begin
          Times := 1;
          animate_move_obj_to_tile(self_obj, 16929, 0);
          add_timer_event(self_obj, game_ticks(60), 1);
        end
      end
    end
    else begin
      if (script_action == 22) then begin
        if (fixed_param == 1) then begin
          animate_move_obj_to_tile(self_obj, 10917, 0);
          add_timer_event(self_obj, game_ticks(60), 2);
        end
        else begin
          if (fixed_param == 2) then begin
            animate_move_obj_to_tile(self_obj, 16929, 0);
            add_timer_event(self_obj, game_ticks(60), 1);
          end
        end
      end
      else begin
        if (script_action == 21) then begin
          script_overrides;
          display_msg(message_str(234, 100));
        end
        else begin
          if (script_action == 18) then begin
            set_global_var(35, global_var(35) + 1);
            if (source_obj == dude_obj) then begin
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                set_global_var(156, 1);
                set_global_var(157, 0);
              end
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                set_global_var(157, 1);
                set_global_var(156, 0);
              end
              set_global_var(160, global_var(160) + 1);
              if ((global_var(160) % 6) == 0) then begin
                set_global_var(155, global_var(155) + 1);
              end
            end
          end
        end
      end
    end
mutdisk:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(641, 100));
    end
    else begin
      if (script_action == 6) then begin
        script_overrides;
        if (local_var(0) == 1) then begin
          display_msg(message_str(641, 101));
        end
        else begin
          set_local_var(0, 1);
          display_msg(message_str(641, 102));
          set_global_var(209, 1);
          display_msg(message_str(766, 103) + "100" + message_str(766, 104));
          give_exp_points(100);
        end
      end
    end
mutejar:
  start: |
    if (script_action == 6) then begin
      call use_p_proc;
    end
    else begin
      if ((script_action == 3) or (script_action == 21)) then begin
      end
    end
  use_p_proc: |
    add_obj_to_inven(dude_obj, create_object_sid(21, 0, 0, -1));
    display_msg(message_str(123, 101));
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(123, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(123, 100));
mutfruit:
  start: |
    if (script_action == 7) then begin
      script_overrides;
      display_msg(message_str(239, 100));
      critter_heal(dude_obj, random(1, 6));
      radiation_inc(dude_obj, 10);
      rm_obj_from_inven(dude_obj, self_obj);
    end
mvairloc:
  start: |
    if (script_action == 15) then begin
      MVAirlock_ptr := self_obj;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(427, 100));
      end
      else begin
        if (script_action == 6) then begin
          call use_stuff;
        end
        else begin
          if (script_action == 8) then begin
            if (obj_pid(obj_being_used_with) == 77) then begin
              call pick_lock;
            end
          end
        end
      end
    end
  use_stuff: |
    if (not(unlocked)) then begin
      script_overrides;
      display_msg(message_str(427, 101));
    end
  pick_lock: |
    script_overrides;
    if (unlocked) then begin
      display_msg(message_str(427, 102));
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 9, -30))) then begin
        display_msg(message_str(427, 103));
        unlocked := 1;
      end
      else begin
        display_msg(message_str(427, 104));
      end
    end
mvbshelf:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(428, 100));
    end
    else begin
      if (script_action == 8) then begin
        script_overrides;
        display_msg(message_str(428, 101));
      end
    end
mvcomp:
  start: |
    if (script_action == 6) then begin
      set_map_var(5, 1);
      script_overrides;
      display_msg(message_str(448, 100));
      my_iq := get_critter_stat(dude_obj, 4);
      my_pe := get_critter_stat(dude_obj, 1);
      if (my_iq < my_pe) then begin
        test := do_check(dude_obj, 4, 0);
      end
      else begin
        test := do_check(dude_obj, 1, 0);
      end
      if (is_success(test)) then begin
        display_msg(message_str(448, 101));
      end
    end
    else begin
      if (script_action == 8) then begin
        set_map_var(5, 1);
        use_skill := action_being_used;
        script_overrides;
        call skills;
      end
      else begin
        if (script_action == 7) then begin
          set_map_var(5, 1);
          if (obj_pid(obj_being_used_with) == 105) then begin
            script_overrides;
            if (BOMB_ARMED == 1) then begin
              if (MASTER_HAS_ARMED == 1) then begin
                display_msg(message_str(448, 105));
              end
              else begin
                call disarmit;
              end
            end
            else begin
              call armit;
            end
          end
          else begin
            if (obj_pid(obj_being_used_with) == 77) then begin
              lockmod := 40;
            end
            else begin
              display_msg(message_str(448, 105));
            end
          end
        end
      end
    end
  skills: |
    if (BOMB_ARMED == 1) then begin
      display_msg(message_str(448, 105));
    end
    else begin
      if (use_skill == 12) then begin
        if (has_skill(dude_obj, 12) < 70) then begin
          display_msg(message_str(448, 112));
        end
        else begin
          test := roll_vs_skill(dude_obj, 12, -40);
          if (is_success(test)) then begin
            call armit;
          end
          else begin
            display_msg(message_str(448, 112));
          end
        end
      end
      else begin
        if (use_skill == 9) then begin
          if (has_skill(dude_obj, 9) < 70) then begin
            display_msg(message_str(448, 112));
          end
          else begin
            test := roll_vs_skill(dude_obj, 9, lockmod - 60);
            if (is_success(test)) then begin
              call armit;
            end
            else begin
              display_msg(message_str(448, 112));
            end
          end
        end
        else begin
          if (use_skill == 11) then begin
            display_msg(message_str(448, 111));
          end
          else begin
            if (use_skill == 13) then begin
              display_msg(message_str(448, 110));
            end
            else begin
              display_msg(message_str(448, 105));
            end
          end
        end
      end
    end
  armit: |
    display_msg(message_str(448, 102));
    if (global_var(55) == 0) then begin
      set_global_var(55, game_time / 10);
    end
    set_global_var(18, 1);
    if (global_var(17) == 0) then begin
      set_global_var(51, 1);
    end
  disarmit: |
    if ((((game_time / 10) - global_var(55)) > 30) or (SKILL_USED == 1)) then begin
      call reset;
    end
    else begin
      KEY_USED := 1;
      display_msg(message_str(448, 105));
    end
  reset: |
    display_msg(message_str(448, 103));
    set_global_var(55, 0);
    set_global_var(18, 0);
mvnews:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
    else begin
      if (script_action == 6) then begin
        call use_p_proc;
      end
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(656, 100));
  use_p_proc: |
    script_overrides;
    display_msg(message_str(656, 101));
mvnuke:
  start: |
    if (script_action == 21) then begin
      script_overrides;
      display_msg(message_str(449, 100));
    end
    else begin
      if (script_action == 8) then begin
        set_map_var(5, 1);
        GVar0 := action_being_used;
        script_overrides;
        call skills;
      end
    end
  skills: |
    if (GVar0 == 12) then begin
      display_msg(message_str(449, 108));
    end
    else begin
      if (GVar0 == 13) then begin
        display_msg(message_str(449, 109));
      end
      else begin
        if (GVar0 == 9) then begin
          display_msg(message_str(449, 110));
        end
        else begin
          if (GVar0 == 11) then begin
            display_msg(message_str(449, 111));
          end
          else begin
            display_msg(message_str(449, 105));
          end
        end
      end
    end
  reset: |
    display_msg(message_str(449, 103));
    set_global_var(55, 0);
    set_global_var(18, 0);
mvrcrdor:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(431, 100));
    end
    else begin
      if (script_action == 6) then begin
        call use_stuff;
      end
      else begin
        if (script_action == 7) then begin
          if (obj_pid(obj_being_used_with) == 77) then begin
            call pick_lock;
          end
        end
      end
    end
  use_stuff: |
    if (not(unlocked)) then begin
      script_overrides;
      display_msg(message_str(431, 101));
    end
  pick_lock: |
    script_overrides;
    if (unlocked) then begin
      display_msg(message_str(431, 102));
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 9, -20))) then begin
        display_msg(message_str(431, 103));
        unlocked := 1;
      end
      else begin
        display_msg(message_str(431, 104));
      end
    end
mvsctshf:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(428, 100));
    end
    else begin
      if (script_action == 8) then begin
        call use_stuff;
      end
    end
  use_stuff: |
    script_overrides;
    if (not(unlocked)) then begin
      display_msg(message_str(428, 101));
      if (is_success(roll_vs_skill(dude_obj, 11, 0)) or is_success(roll_vs_skill(dude_obj, 9, 0))) then begin
        display_msg(message_str(429, 100));
        unlocked := 1;
      end
    end
    else begin
      display_msg(message_str(429, 101));
      if (is_success(do_check(dude_obj, 1, 0))) then begin
        display_msg(message_str(429, 102));
      end
      if (open) then begin
        animate_stand_reverse_obj(self_obj);
        open := 0;
      end
      else begin
        animate_stand_obj(self_obj);
        open := 1;
      end
    end
ndebris:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if (map_var(0) == 0) then begin
          set_map_var(0, 1);
          set_map_var(4, map_var(4) + 1);
          if (map_var(4) > 3) then begin
            display_msg(message_str(824, 104));
          end
          else begin
            display_msg(message_str(824, 100));
          end
        end
      end
    end
neal:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  critter_p_proc: |
    if ((map_var(0) == 0) and (change_team == 1)) then begin
      critter_add_trait(Neal_ptr, 1, 6, 16);
      change_team := 0;
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (sleeping_disabled == 0) then begin
      call sleeping;
    end
    if ((game_time_hour > wake_time) or (game_time_hour < sleep_time) and (moving_disabled == 0)) then begin
      if (tile_num(self_obj) != home_tile) then begin
        animate_move_obj_to_tile(self_obj, home_tile, 0);
      end
      else begin
        if (has_trait(1, self_obj, 10) != 2) then begin
          anim(self_obj, 1000, 2);
        end
      end
    end
    if ((map_var(4) == 1) and (local_var(10) == 0) and (tile_distance_objs(self_obj, dude_obj) < 20)) then begin
      float_msg(self_obj, message_str(508, 133), 2);
      hostile := 1;
      set_local_var(10, 1);
    end
    if (obj_is_carrying_obj_pid(self_obj, 112)) then begin
      destroy_object(obj_carrying_pid_obj(self_obj, 112));
    end
    if (messing_with_SkumDoor == 1) then begin
      reg_anim_func(2, self_obj);
      messing_with_SkumDoor := 2;
      moving_disabled := 1;
      sleeping_disabled := 1;
      if (SkumDoor_ptr == 0) then begin
        annoyed := 1;
      end
      if (annoyed) then begin
        float_msg(self_obj, message_str(508, 149), 2);
        Neal_closing_door := 0;
        if (SkumDoor_ptr != 0) then begin
          use_obj(SkumDoor_ptr);
        end
        else begin
          messing_with_SkumDoor := 3;
        end
      end
      else begin
        float_msg(self_obj, message_str(508, 148), 2);
        Neal_closing_door := 1;
        if (SkumDoor_ptr != 0) then begin
          use_obj(SkumDoor_ptr);
        end
        else begin
          messing_with_SkumDoor := 3;
        end
      end
    end
    if (messing_with_SkumDoor == 3) then begin
      messing_with_SkumDoor := 0;
      sleeping_disabled := 0;
      moving_disabled := 0;
      if (annoyed) then begin
        annoyed := 0;
        hostile := 1;
      end
      else begin
        float_msg(self_obj, message_str(508, 147), 2);
        annoyed := 1;
      end
    end
    if (SkumDoor_ptr != 0) then begin
      if ((game_time_hour == 409) and obj_is_open(SkumDoor_ptr)) then begin
        moving_disabled := 1;
        sleeping_disabled := 1;
        Neal_closing_door := 1;
        use_obj(SkumDoor_ptr);
      end
      if ((game_time_hour == 1400) and not(obj_is_open(SkumDoor_ptr))) then begin
        moving_disabled := 1;
        sleeping_disabled := 1;
        Neal_closing_door := 0;
        use_obj(SkumDoor_ptr);
      end
    end
    if (global_var(628) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if ((map_var(2) == 1) and (flag149 == 0)) then begin
      float_msg(self_obj, message_str(508, 149), 7);
      flag149 := 1;
    end
  description_p_proc: 'display_msg(message_str(508, 102));

    '
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(628, 1);
      set_global_var(247, 1);
      set_global_var(155, global_var(155) - 5);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    set_global_var(284, 1);
    Neal_ptr := 0;
  look_at_p_proc: |
    if (local_var(4) == 1) then begin
      display_msg(message_str(508, 100));
    end
    else begin
      display_msg(message_str(508, 101));
    end
  map_enter_p_proc: |
    night_person := 1;
    wake_time := 1300;
    sleep_time := 410;
    home_tile := 19477;
    sleep_tile := 17876;
    Neal_ptr := self_obj;
    change_team := 0;
    if ((global_var(287) == 1) and (map_var(0) == 4)) then begin
      critter_add_trait(Neal_ptr, 1, 6, 0);
      change_team := 1;
    end
    else begin
      critter_add_trait(self_obj, 1, 6, 16);
    end
    critter_add_trait(self_obj, 1, 5, 56);
  pickup_p_proc: |
    float_msg(self_obj, message_str(508, 103), 2);
    hostile := 1;
  talk_p_proc: |
    if (tile_num(self_obj) == home_tile) then begin
      if ((game_time_hour >= 1300) and (game_time_hour < 1600)) then begin
        float_msg(self_obj, message_str(508, 104), 0);
      end
      else begin
        if (obj_is_carrying_obj_pid(self_obj, 112)) then begin
          float_msg(self_obj, message_str(508, 143), 4);
          set_local_var(11, 1);
          set_global_var(286, 2);
        end
        else begin
          if ((game_time_hour >= 410) and (game_time_hour <= 1300)) then begin
            float_msg(self_obj, message_str(508, 105), 0);
          end
          else begin
            start_gdialog(508, self_obj, 4, -1, -1);
            gsay_start;
            call Neal01;
            gsay_end;
            end_dialogue;
            if (local_var(4) == 0) then begin
              if (Skul_target != 0) then begin
                if (tile_distance_objs(self_obj, Skul_target) < 12) then begin
                  rm_timer_event(Skul_target);
                  add_timer_event(Skul_target, game_ticks(3), 2);
                  set_local_var(4, 1);
                end
              end
            end
          end
        end
      end
      if (item) then begin
        add_obj_to_inven(dude_obj, item);
        item := 0;
        float_msg(self_obj, message_str(508, 132), 3);
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      float_msg(Trish_ptr, message_str(342, 150), 4);
      if ((global_var(557) bwand 2) == 0) then begin
        set_global_var(557, global_var(557) + 2);
      end
      moving_disabled := 1;
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_obj_move_to_tile(self_obj, home_tile, -1);
      reg_anim_func(3, 0);
      set_global_var(282, 1);
      add_timer_event(self_obj, 5, 2);
    end
    else begin
      if (fixed_param == 2) then begin
        if (tile_num(self_obj) != home_tile) then begin
          animate_move_obj_to_tile(self_obj, home_tile, 0);
          add_timer_event(self_obj, 5, 2);
        end
        else begin
          if (has_trait(1, self_obj, 10) != 3) then begin
            anim(self_obj, 1000, 3);
            add_timer_event(self_obj, 5, 2);
          end
          else begin
            if (obj_is_carrying_obj_pid(self_obj, 22) == 0) then begin
              item := create_object_sid(22, 0, 0, -1);
              add_obj_to_inven(self_obj, item);
              item := 0;
            end
            wield_obj_critter(self_obj, obj_carrying_pid_obj(self_obj, 22));
            add_timer_event(self_obj, 5, 3);
          end
        end
      end
      else begin
        if (fixed_param == 3) then begin
          reg_anim_func(2, self_obj);
          reg_anim_func(1, 1);
          reg_anim_animate(self_obj, 43, -1);
          reg_anim_animate(self_obj, 45, -1);
          sfx_name := sfx_build_weapon_name(1, obj_carrying_pid_obj(self_obj, 22), 0, Skul_target);
          reg_anim_play_sfx(self_obj, sfx_name, 0);
          reg_anim_animate(self_obj, 44, -1);
          reg_anim_func(3, 0);
          add_timer_event(self_obj, 5, 4);
        end
        else begin
          if (fixed_param == 4) then begin
            critter_dmg(Skul_target, random(50, 75), 0);
            float_msg(self_obj, message_str(508, 146), 2);
            moving_disabled := 0;
          end
          else begin
            if (fixed_param == 5) then begin
              float_msg(self_obj, message_str(508, 147), 2);
            end
            else begin
              if (fixed_param == 6) then begin
                annoyed := 0;
                sleeping_disabled := 0;
              end
              else begin
                if (fixed_param == 6) then begin
                  hostile := 1;
                end
                else begin
                  if (fixed_param == 8) then begin
                    moving_disabled := 0;
                    sleeping_disabled := 0;
                  end
                end
              end
            end
          end
        end
      end
    end
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 112) then begin
      rm_obj_from_inven(source_obj, obj_being_used_with);
      add_obj_to_inven(self_obj, obj_being_used_with);
      dialogue_system_enter;
    end
  Neal01: |
    gsay_reply(508, 106);
    giq_option(4, 508, 107, Neal02, 50);
    giq_option(4, 508, 108, Neal03, 50);
    giq_option(4, 508, message_str(508, 109) + proto_data(obj_pid(dude_obj), 1) + message_str(508, 110), Neal04, 50);
    if (global_var(286) == 0) then begin
      giq_option(4, 508, 125, Neal09, 50);
    end
    else begin
      if (global_var(286) == 1) then begin
        giq_option(4, 508, 142, Neal09, 50);
      end
    end
    giq_option(-3, 508, 111, NealEnd, 50);
    call Goodbyes;
    if (obj_is_carrying_obj_pid(dude_obj, 112)) then begin
      giq_option(4, 508, 144, Neal11, 49);
    end
    giq_option(4, 508, exit_line, NealEnd, 50);
  Neal02: |
    gsay_reply(508, 112);
    giq_option(0, 508, 113, NealCola, 50);
    giq_option(0, 508, 114, NealBeer, 50);
    giq_option(0, 508, 115, NealBooze, 50);
    call Goodbyes;
    giq_option(0, 508, exit_line, NealEnd, 50);
  Neal03: |
    gsay_reply(508, 116);
    if (not(local_var(5))) then begin
      giq_option(4, 508, 117, Neal06, 50);
    end
    if ((global_var(121) == 0) and not(local_var(6)) and (tile_distance_objs(self_obj, Tycho_ptr) < 12)) then begin
      giq_option(4, 508, 118, Neal07, 50);
    end
    if (not(local_var(8))) then begin
      if ((global_var(555) != 2) and (global_var(282) == 1)) then begin
        giq_option(4, 508, 119, Neal08, 50);
      end
    end
    call Goodbyes;
    giq_option(0, 508, exit_line, NealEnd, 50);
  Neal04: |
    gsay_reply(508, 120);
    giq_option(4, 508, 121, Neal02, 50);
    giq_option(4, 508, 122, Neal03, 50);
    giq_option(4, 508, 123, NealEnd, 50);
  Neal06: |
    set_local_var(5, 1);
    gsay_reply(508, 126);
    giq_option(4, 508, 127, Neal02, 0);
    giq_option(4, 508, 128, Neal10, 0);
  Neal07: |
    set_local_var(6, 1);
    gsay_reply(508, 129);
    giq_option(4, 508, 130, Neal03, 50);
    call Goodbyes;
    giq_option(0, 508, exit_line, NealEnd, 50);
  Neal08: |
    set_local_var(8, 1);
    gsay_reply(508, 131);
    giq_option(4, 508, 130, Neal03, 50);
    call Goodbyes;
    giq_option(0, 508, exit_line, NealEnd, 50);
  Neal09: |
    if (global_var(286) == 1) then begin
      gsay_reply(508, 145);
    end
    else begin
      gsay_reply(508, 134);
    end
    giq_option(4, 508, 138, Neal10, 50);
  Neal10: |
    gsay_reply(508, 135);
    giq_option(4, 508, 139, Neal02, 50);
    giq_option(4, 508, 136, Neal03, 50);
    giq_option(4, 508, 137, NealEnd, 50);
  Neal11: |
    gsay_message(508, 143, 49);
    set_local_var(11, 1);
    set_global_var(286, 2);
    item := obj_carrying_pid_obj(dude_obj, 112);
    set_global_var(155, global_var(155) + 2);
    rm_obj_from_inven(dude_obj, item);
    add_obj_to_inven(self_obj, item);
  NealEnd: "[]"
  NealCola: |
    if (local_var(11) == 0) then begin
      if (item_caps_total(dude_obj) >= 3) then begin
        item_caps_adjust(dude_obj, -3);
        item := create_object_sid(106, 0, 0, -1);
      end
      else begin
        float_msg(self_obj, message_str(508, 140), 0);
      end
    end
    else begin
      item := create_object_sid(106, 0, 0, -1);
    end
  NealBeer: |
    if (local_var(11) == 0) then begin
      if (item_caps_total(dude_obj) >= 5) then begin
        item_caps_adjust(dude_obj, -5);
        item := create_object_sid(124, 0, 0, -1);
      end
      else begin
        float_msg(self_obj, message_str(508, 140), 0);
      end
    end
    else begin
      item := create_object_sid(124, 0, 0, -1);
    end
  NealBooze: |
    if (local_var(11) == 0) then begin
      if (item_caps_total(dude_obj) >= 20) then begin
        item_caps_adjust(dude_obj, -20);
        item := create_object_sid(125, 0, 0, -1);
      end
      else begin
        float_msg(self_obj, message_str(508, 140), 0);
      end
    end
    else begin
      item := create_object_sid(125, 0, 0, -1);
    end
  sleeping: |
    if (local_var(9) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) >= 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(9, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(9, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) >= 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, sleep_tile, 0);
          end
          else begin
            set_local_var(9, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(9, 1);
          end
        end
      end
    end
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
neil:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 46);
      initialized := 1;
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(4)) then begin
      display_msg(message_str(271, 100));
    end
    else begin
      display_msg(message_str(271, 101));
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    set_local_var(4, 1);
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      call Neil00;
    end
    else begin
      if (global_var(133) == 1) then begin
        call Neil27;
      end
      else begin
        if ((global_var(133) == 2) and (local_var(5) == 0)) then begin
          set_local_var(5, 1);
          start_gdialog(271, self_obj, 4, -1, -1);
          gsay_start;
          call Neil28;
          gsay_end;
          end_dialogue;
        end
        else begin
          if ((global_var(132) == 1) and (local_var(6) == 0)) then begin
            call Neil31;
          end
          else begin
            if (global_var(133) == 2) then begin
              start_gdialog(271, self_obj, 4, -1, -1);
              gsay_start;
              call NeilFixed;
              gsay_end;
              end_dialogue;
            end
            else begin
              start_gdialog(271, self_obj, 4, -1, -1);
              gsay_start;
              call Neil01;
              gsay_end;
              end_dialogue;
            end
          end
        end
      end
    end
  NeilFixed: 'gsay_reply(271, 201);

    '
  Neil00: 'float_msg(self_obj, message_str(271, 102), 2);

    '
  Neil01: |
    gsay_reply(271, 103);
    giq_option(-3, 271, 104, Neil02, 50);
    giq_option(-3, 271, 105, Neil03, 50);
    giq_option(-3, 271, 106, NeilCombat, 50);
    giq_option(4, 271, message_str(271, 107) + proto_data(obj_pid(dude_obj), 1) + message_str(271, 108), Neil07, 50);
    giq_option(4, 271, message_str(271, 109) + proto_data(obj_pid(dude_obj), 1) + message_str(271, 110), NeilCombat, 50);
    giq_option(5, 271, 111, Neil16, 50);
    giq_option(6, 271, 112, Neil24, 50);
    giq_option(8, 271, 113, Neil26, 50);
  Neil02: |
    gsay_reply(271, 114);
    giq_option(0, 271, 115, Neil03, 50);
    giq_option(0, 271, 116, NeilCombat, 50);
    giq_option(0, 271, 117, Neil04, 50);
  Neil03: 'gsay_message(271, 118, 50);

    '
  Neil04: |
    gsay_reply(271, 119);
    giq_option(0, 271, 120, Neil05, 50);
    giq_option(0, 271, 121, Neil06, 50);
  Neil05: |
    gsay_message(271, 122, 50);
    set_global_var(133, 1);
  Neil06: 'gsay_message(271, 123, 50);

    '
  Neil07: |
    gsay_reply(271, 124);
    giq_option(4, 271, 125, Neil08, 50);
    giq_option(4, 271, 126, Neil14, 50);
    giq_option(4, 271, 127, Neil15, 50);
  Neil08: |
    gsay_reply(271, 128);
    giq_option(4, 271, 129, Neil09, 50);
    giq_option(4, 271, 130, NeilEnd, 50);
    giq_option(4, 271, 131, NeilCombat, 50);
    giq_option(4, 271, 132, Neil13, 50);
  Neil09: |
    gsay_reply(271, 133);
    giq_option(4, 271, 134, NeilQuest, 50);
    giq_option(4, 271, 135, Neil10, 50);
    giq_option(4, 271, 136, Neil13, 50);
  Neil10: |
    gsay_reply(271, 137);
    giq_option(4, 271, 138, Neil11, 50);
    giq_option(4, 271, 139, NeilEnd, 50);
    giq_option(4, 271, 140, NeilCombat, 50);
  Neil11: |
    gsay_reply(271, 141);
    giq_option(4, 271, 142, Neil12, 50);
    giq_option(4, 271, 143, Neil13, 50);
  Neil12: |
    gsay_message(271, 144, 50);
    call NeilQuest;
  Neil13: |
    gsay_message(271, 145, 50);
    call NeilCombat;
  Neil14: |
    gsay_reply(271, 146);
    giq_option(4, 271, 147, Neil09, 50);
    giq_option(4, 271, 148, NeilEnd, 50);
    giq_option(4, 271, 149, NeilCombat, 50);
    giq_option(4, 271, 150, Neil13, 50);
  Neil15: |
    gsay_reply(271, 151);
    giq_option(4, 271, 152, Neil09, 50);
    giq_option(4, 271, 153, NeilCombat, 50);
    giq_option(4, 271, 154, Neil13, 50);
  Neil16: |
    gsay_reply(271, 155);
    giq_option(5, 271, 156, Neil17, 50);
    giq_option(5, 271, 157, Neil18, 50);
    giq_option(5, 271, 158, Neil16a, 50);
  Neil16a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Neil19;
    end
    else begin
      call Neil23;
    end
  Neil17: |
    variable LVar0 := 0;
    item_caps_adjust(dude_obj, -200);
    gsay_message(271, message_str(271, 159) + " " + message_str(271, 160), 50);
    call NeilCombat;
  Neil18: 'gsay_message(271, 161, 50);

    '
  Neil19: |
    gsay_reply(271, 162);
    giq_option(5, 271, 163, Neil20, 50);
    giq_option(5, 271, 164, Neil21, 50);
    giq_option(5, 271, 165, Neil22, 50);
    giq_option(5, 271, 166, NeilCombat, 50);
    giq_option(5, 271, 167, NeilEnd, 50);
  Neil20: |
    gsay_reply(271, 168);
    giq_option(5, 271, 169, Neil21, 50);
    giq_option(5, 271, 170, Neil22, 50);
    giq_option(5, 271, 171, NeilCombat, 50);
    giq_option(5, 271, 172, NeilEnd, 50);
  Neil21: |
    gsay_reply(271, 173);
    giq_option(5, 271, 174, Neil20, 50);
    giq_option(5, 271, 175, Neil22, 50);
    giq_option(5, 271, 176, NeilCombat, 50);
    giq_option(5, 271, 177, NeilEnd, 50);
  Neil22: |
    gsay_reply(271, 178);
    giq_option(5, 271, 179, Neil20, 50);
    giq_option(5, 271, 180, Neil21, 50);
    giq_option(5, 271, 181, NeilCombat, 50);
    giq_option(5, 271, 182, NeilEnd, 50);
  Neil23: |
    gsay_message(271, 183, 50);
    call NeilCombat;
  Neil24: |
    gsay_reply(271, 184);
    giq_option(6, 271, 185, Neil08, 50);
    giq_option(6, 271, 186, Neil14, 50);
    giq_option(6, 271, 187, Neil25, 50);
    giq_option(6, 271, 188, NeilEnd, 50);
  Neil25: 'gsay_message(271, 189, 50);

    '
  Neil26: 'gsay_message(271, 190, 50);

    '
  Neil27: 'float_msg(self_obj, message_str(271, 191), 8);

    '
  Neil28: |
    gsay_reply(271, 192);
    giq_option(4, 271, 193, Neil29, 50);
    giq_option(4, 271, 194, NeilEnd, 50);
  Neil29: |
    gsay_reply(271, 195);
    giq_option(4, 271, 196, Neil30, 50);
    giq_option(4, 271, 197, NeilEnd, 50);
  Neil30: |
    gsay_reply(271, 198);
    gfade_out(20);
    game_time_advance(game_ticks(24 * 3600));
    set_global_var(132, 1);
    gfade_in(20);
    giq_option(4, 271, 199, Neil31, 50);
  Neil31: 'float_msg(self_obj, message_str(271, 200), 8);

    '
  NeilQuest: 'set_global_var(133, 1);

    '
  NeilCombat: 'hostile := 1;

    '
  NeilEnd: "[]"
ngarfrdg:
  start: |
    if (script_action == 15) then begin
      call Initialize_Fridge;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 4) then begin
          call Looting_Fridge;
        end
        else begin
          if (script_action == 6) then begin
            call Open_Fridge;
          end
          else begin
            if (script_action == 22) then begin
              float_msg(Garret_ptr, message_str(420, 105), 0);
            end
            else begin
              if (script_action == 7) then begin
                if (obj_pid(obj_being_used_with) == 84) then begin
                  call pick_lock;
                end
              end
              else begin
                if (script_action == 8) then begin
                  if (action_being_used == 9) then begin
                    call pick_lock;
                  end
                end
              end
            end
          end
        end
      end
    end
  Initialize_Fridge: 'Fridge_ptr := self_obj;

    '
  Looting_Fridge: |
    if (source_obj != Garret_ptr) then begin
      if (local_var(0) == 0) then begin
        script_overrides;
      end
      else begin
        if (local_var(1) == 0) then begin
          script_overrides;
        end
      end
    end
  Open_Fridge: |
    last_user := source_obj;
    if (source_obj == Garret_ptr) then begin
      if (local_var(1) == 0) then begin
        set_local_var(0, 1);
        set_local_var(1, 1);
      end
      else begin
        if (last_user == Garret_ptr) then begin
          set_local_var(1, 0);
          set_local_var(0, 0);
        end
        else begin
          script_overrides;
          float_msg(Garret_ptr, message_str(420, 104), 0);
        end
      end
    end
    else begin
      if (local_var(0) == 0) then begin
        script_overrides;
        display_msg(message_str(420, 100));
      end
      else begin
        if (local_var(1)) then begin
          set_local_var(1, 0);
        end
        else begin
          set_local_var(1, 1);
        end
      end
    end
  pick_lock: |
    script_overrides;
    if (local_var(0)) then begin
      display_msg(message_str(420, 101));
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 9, 0))) then begin
        display_msg(message_str(420, 102));
        set_local_var(0, 1);
        display_msg(message_str(766, 103) + "25" + message_str(766, 104));
        give_exp_points(25);
      end
      else begin
        display_msg(message_str(420, 103));
      end
    end
  map_update_p_proc: 'Fridge_ptr := self_obj;

    '
nh2ocomp:
  start: |
    if (script_action == 21) then begin
      script_overrides;
      display_msg(message_str(86, 112));
    end
    if (script_action == 3) then begin
      script_overrides;
      if (tile_distance_objs(self_obj, dude_obj) < 2) then begin
        call search;
      end
      else begin
        display_msg(message_str(86, 107));
      end
    end
    else begin
      if (script_action == 6) then begin
        script_overrides;
        call removal;
      end
      else begin
        if (script_action == 8) then begin
          use_skill := action_being_used;
          script_overrides;
          if (use_skill == 13) then begin
            call removal;
          end
          else begin
            call skills;
          end
        end
        else begin
          if (script_action == 7) then begin
            if (obj_pid(obj_being_used_with) == 55) then begin
              script_overrides;
              display_msg(message_str(86, 110));
              rm_obj_from_inven(dude_obj, obj_being_used_with);
              add_obj_to_inven(self_obj, obj_being_used_with);
              set_global_var(30, 0);
              set_global_var(101, 0);
            end
            else begin
              display_msg(message_str(86, 111));
            end
          end
        end
      end
    end
  search: |
    test := do_check(dude_obj, 1, 0);
    if (global_var(30)) then begin
      display_msg(message_str(86, 100));
    end
    else begin
      if (is_success(test)) then begin
        display_msg(message_str(86, 101));
        set_local_var(1, 1);
      end
      else begin
        game_time_advance(game_ticks(1200));
        display_msg(message_str(86, 102));
        set_local_var(1, 1);
      end
    end
  removal: |
    test := do_check(dude_obj, 4, 0);
    test1 := do_check(dude_obj, 5, 0);
    test2 := roll_vs_skill(dude_obj, 13, bonus);
    if (global_var(30) == 1) then begin
      display_msg(message_str(86, 103));
    end
    else begin
      if (is_success(test) or is_success(test1) or is_success(test2)) then begin
        if (global_var(31) == 2) then begin
          display_msg(message_str(86, 117));
        end
        else begin
          display_msg(message_str(86, 104));
        end
        add_obj_to_inven(dude_obj, create_object_sid(55, 0, 0, -1));
        set_global_var(30, 1);
        set_global_var(552, game_time / (10 * 60 * 60 * 24));
        if (local_var(2) < 1) then begin
          set_local_var(2, 1);
          temp := 2500 - (global_var(35) * 250);
          set_global_var(155, global_var(155) + 3);
          give_exp_points(temp);
          display_msg(message_str(86, 113) + temp + message_str(86, 114));
        end
        Character_Point := Character_Point + 1;
      end
      else begin
        if (is_critical(test) or is_critical(test1) or is_critical(test2)) then begin
          game_time_advance(game_ticks(3600));
          display_msg(message_str(86, 105));
        end
        else begin
          display_msg(message_str(86, 106));
          game_time_advance(game_ticks(1800));
        end
      end
    end
  skills: |
    if (use_skill == 12) then begin
      if (global_var(30)) then begin
        display_msg(message_str(86, 116));
      end
      else begin
        test := roll_vs_skill(dude_obj, 12, 20);
        if (is_success(test)) then begin
          bonus := 40;
          display_msg(message_str(86, 115));
        end
        else begin
          display_msg(message_str(86, 109));
        end
      end
    end
    else begin
      display_msg(message_str(86, 109));
    end
nh2opump:
  start: |
    if (script_action == 21) then begin
      script_overrides;
      call search;
    end
    else begin
      if (script_action == 8) then begin
        use_skill := action_being_used;
        script_overrides;
        call skills;
      end
      else begin
        if (script_action == 6) then begin
          if (global_var(31) != 2) then begin
            script_overrides;
            display_msg(message_str(87, 112));
          end
        end
        else begin
          if (script_action == 7) then begin
            if (obj_pid(obj_being_used_with) == 98) then begin
              script_overrides;
              test2 := roll_vs_skill(dude_obj, 13, -5);
              if (is_success(test2)) then begin
                display_msg(message_str(87, 114));
                rm_obj_from_inven(dude_obj, obj_being_used_with);
                add_obj_to_inven(self_obj, obj_being_used_with);
                set_global_var(31, 2);
                set_global_var(227, 0);
                set_global_var(155, global_var(155) + 1);
                give_exp_points(1000);
                display_msg(message_str(87, 118));
              end
              else begin
                if (is_critical(test2)) then begin
                  display_msg(message_str(87, 115));
                  game_time_advance(game_ticks(240));
                  rm_obj_from_inven(dude_obj, obj_being_used_with);
                  critter_dmg(dude_obj, 1, 0);
                end
                else begin
                  display_msg(message_str(87, 116));
                  game_time_advance(game_ticks(180));
                end
              end
            end
            else begin
              display_msg(message_str(87, 117));
            end
          end
        end
      end
    end
  map_update_p_proc: |
    if ((combat_is_initialized == 0) and (global_var(31) == 2)) then begin
      reg_anim_func(1, 1);
      reg_anim_animate_forever(self_obj, 0);
      reg_anim_func(3, 0);
    end
  search: |
    script_overrides;
    if (global_var(31) == 2) then begin
      display_msg(message_str(87, 100));
    end
    else begin
      display_msg(message_str(87, 101));
    end
  skills: |
    script_overrides;
    if (global_var(31) == 2) then begin
      display_msg(message_str(87, 100));
    end
    else begin
      test2 := roll_vs_skill(dude_obj, 13, -5);
      test3 := roll_vs_skill(dude_obj, 12, -5);
      if (use_skill == 13) then begin
        if (is_success(test2)) then begin
          display_msg(message_str(87, 108));
        end
        else begin
          if (is_critical(test2)) then begin
            display_msg(message_str(87, 107));
          end
          else begin
            display_msg(message_str(87, 109));
          end
        end
      end
      else begin
        if (use_skill == 12) then begin
          if (is_success(test3)) then begin
            display_msg(message_str(87, 111));
          end
          else begin
            if (is_critical(test3)) then begin
              display_msg(message_str(87, 110));
            end
            else begin
              display_msg(message_str(87, 112));
            end
          end
        end
        else begin
          display_msg(message_str(87, 113));
        end
      end
    end
nicole:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(54, 100));
  talk_p_proc: |
    if (global_var(256) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 104)), 2);
    end
    else begin
      if ((local_var(4) == 1) and (get_critter_stat(dude_obj, 4) < 4)) then begin
        float_msg(self_obj, message_str(54, 286), 0);
      end
      else begin
        if (local_var(2) == 0) then begin
          set_local_var(2, 1);
          set_local_var(1, 3);
          call LevelToReact;
        end
        start_gdialog(54, self_obj, 4, 19, 12);
        gsay_start;
        if (local_var(4) == 0) then begin
          call Nicole01;
        end
        else begin
          DisplayMessage := 132;
          call Nicole00;
        end
        gsay_end;
        end_dialogue;
        if (local_var(5) == 1) then begin
          gfade_in(600);
          set_local_var(5, 0);
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(256, 1);
    end
  destroy_p_proc: |
    set_global_var(492, 0);
    if (source_obj == dude_obj) then begin
      set_global_var(256, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(256) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  pickup_p_proc: 'set_global_var(256, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      if (not(metarule(22, 0)) and (obj_is_carrying_obj_pid(self_obj, 41) == 0)) then begin
        item_caps_adjust(self_obj, random(50, 150));
      end
      critter_add_trait(self_obj, 1, 6, 46);
      set_global_var(492, 99);
      Initialize := 0;
    end
  Nicole00: |
    gsay_reply(54, DisplayMessage);
    gsay_option(54, 101, Nicole29, 50);
    gsay_option(54, 102, Nicole02, 50);
    if (global_var(18) == 0) then begin
      giq_option(4, 54, 319, Nicole50, 50);
    end
    gsay_option(54, 131, Nicole14, 50);
  Nicole01: |
    gsay_reply(54, 105);
    giq_option(4, 54, 106, Nicole02, 50);
    giq_option(4, 54, 107, Nicole11, 51);
    giq_option(4, 54, 108, Nicole09, 50);
    giq_option(4, 54, 109, Nicole15, 50);
    giq_option(-3, 54, 110, Nicole78, 50);
    set_local_var(4, 1);
  Nicole02: |
    gsay_reply(54, 111);
    gsay_option(54, 112, Nicole04, 50);
  Nicole04: |
    gsay_reply(54, 113);
    gsay_option(54, 114, Nicole05, 50);
    gsay_option(54, 115, Nicole11, 51);
  Nicole05: |
    gsay_reply(54, 116);
    gsay_option(54, 117, Nicole06, 50);
  Nicole06: |
    gsay_reply(54, 118);
    gsay_option(54, 119, Nicole07, 50);
    gsay_option(54, 123, Nicole08, 50);
    if (local_var(1) >= 2) then begin
      gsay_option(54, 121, Nicole08a, 50);
    end
    else begin
      gsay_option(54, 121, Nicole11, 51);
    end
  Nicole07: |
    gsay_reply(54, 122);
    gsay_option(54, 123, Nicole08, 50);
    gsay_option(54, 124, Nicole28, 50);
    gsay_option(54, 125, Nicole19, 49);
    if (local_var(1) >= 2) then begin
      gsay_option(54, 126, Nicole08a, 50);
    end
    else begin
      gsay_option(54, 126, Nicole11, 51);
    end
  Nicole08: |
    gsay_message(54, 127, 50);
    DisplayMessage := 129;
    call NicoleMore;
  Nicole08a: |
    gsay_message(54, 128, 50);
    DisplayMessage := 129;
    call NicoleMore;
  Nicole09: |
    DisplayMessage := 132;
    call Nicole00;
  Nicole10: |
    gsay_message(54, 133, 50);
    call NicoleShowOut;
  Nicole11: |
    call DownReactLevel;
    gsay_reply(54, 134);
    gsay_option(54, 135, Nicole12, 50);
    gsay_option(54, 136, Nicole13, 50);
  Nicole12: |
    call BottomReact;
    gsay_message(54, 137, 50);
    call NicoleShowOut;
  Nicole13: |
    DisplayMessage := 138;
    call NicoleMore;
  Nicole14: 'gsay_message(54, 141, 50);

    '
  Nicole15: |
    gsay_reply(54, 142);
    gsay_option(54, 143, Nicole16, 50);
  Nicole16: |
    gsay_reply(54, 144);
    gsay_option(54, 145, Nicole17, 50);
    gsay_option(54, 146, Nicole25, 50);
  Nicole17: |
    gsay_reply(54, 147);
    gsay_option(54, 148, Nicole07, 50);
    gsay_option(54, 149, Nicole18, 50);
  Nicole18: |
    gsay_reply(54, 151);
    gsay_option(54, 152, Nicole19, 49);
    gsay_option(54, 153, Nicole20, 50);
  Nicole19: |
    DisplayMessage := 154;
    call NicoleMore;
  Nicole20: |
    gsay_reply(54, 157);
    gsay_option(54, 158, Nicole21, 50);
    gsay_option(54, 159, Nicole21a, 51);
    if (local_var(1) >= 2) then begin
      gsay_option(54, 160, Nicole09, 50);
    end
    else begin
      gsay_option(54, 160, Nicole10, 51);
    end
    gsay_option(54, 164, Nicole14, 50);
  Nicole21: |
    gsay_reply(54, 161);
    if (local_var(1) >= 2) then begin
      gsay_option(54, 163, Nicole09, 50);
    end
    else begin
      gsay_option(54, 163, Nicole10, 51);
    end
    gsay_option(54, 164, Nicole14, 50);
  Nicole21a: |
    gsay_reply(54, 162);
    if (local_var(1) >= 2) then begin
      gsay_option(54, 163, Nicole09, 50);
    end
    else begin
      gsay_option(54, 163, Nicole10, 51);
    end
    gsay_option(54, 164, Nicole14, 50);
  Nicole25: |
    gsay_reply(54, 175);
    gsay_option(54, 176, Nicole26, 50);
    gsay_option(54, 177, Nicole11, 50);
    gsay_option(54, 178, Nicole27, 50);
  Nicole26: |
    DisplayMessage := 179;
    call NicoleMore;
  Nicole27: |
    DisplayMessage := 182;
    call NicoleMore;
  Nicole28: |
    gsay_reply(54, 185);
    gsay_option(54, 186, Nicole19, 49);
    if (local_var(1) >= 2) then begin
      gsay_option(54, 187, Nicole09, 50);
    end
    else begin
      gsay_option(54, 187, Nicole10, 51);
    end
    gsay_option(54, 188, Nicole14, 50);
  Nicole29: |
    gsay_reply(54, 189);
    gsay_option(54, 190, Nicole30, 50);
    gsay_option(54, 191, Nicole31, 50);
    gsay_option(54, 192, Nicole04, 50);
  Nicole30: |
    gsay_reply(54, 193);
    gsay_option(54, 194, Nicole31, 50);
    gsay_option(54, 195, Nicole36, 50);
  Nicole31: |
    gsay_reply(54, 196);
    gsay_option(54, 197, Nicole39, 50);
    gsay_option(54, 198, Nicole11, 50);
    gsay_option(54, 199, Nicole32, 50);
    gsay_option(54, 195, Nicole36, 50);
  Nicole32: |
    gsay_reply(54, 201);
    gsay_option(54, 202, Nicole33, 50);
    gsay_option(54, 195, Nicole36, 50);
  Nicole33: |
    gsay_reply(54, 204);
    gsay_option(54, 205, Nicole11, 50);
    gsay_option(54, 206, Nicole34, 50);
    gsay_option(54, 207, Nicole36, 50);
  Nicole34: |
    gsay_reply(54, 208);
    gsay_option(54, 209, Nicole36, 50);
    gsay_option(54, 210, Nicole35, 50);
    if (local_var(1) >= 2) then begin
      gsay_option(54, 211, Nicole09, 50);
    end
    else begin
      gsay_option(54, 211, Nicole10, 51);
    end
    gsay_option(54, 212, Nicole14, 50);
  Nicole35: |
    gsay_message(54, 213, 50);
    call DownReactLevel;
  Nicole36: |
    gsay_reply(54, 214);
    gsay_option(54, 215, Nicole37, 50);
    gsay_option(54, 216, Nicole41, 50);
  Nicole37: |
    gsay_reply(54, 217);
    gsay_option(54, 218, Nicole39, 50);
    gsay_option(54, 219, Nicole41, 50);
  Nicole39: |
    DisplayMessage := 220;
    call TopReact;
    call NicoleMore;
  Nicole41: |
    gsay_reply(54, 223);
    gsay_option(54, 224, Nicole00, 50);
    gsay_option(54, 225, NicoleEnd, 50);
  Nicole50: |
    DisplayMessage := 132;
    gsay_reply(54, 307);
    gsay_option(54, 320, Nicole51, 50);
    gsay_option(54, 321, Nicole00, 50);
  Nicole51: |
    gsay_reply(54, DisplayMessage);
    gsay_option(54, 322, Nicole52, 50);
    gsay_option(54, 323, Nicole53, 50);
    gsay_option(54, 324, Nicole54, 50);
    gsay_option(54, 321, Nicole00, 50);
    gsay_option(54, 326, Nicole14, 50);
  Nicole52: |
    DisplayMessage := 299;
    call Nicole51;
  Nicole53: |
    DisplayMessage := 185;
    call Nicole51;
  Nicole54: |
    gsay_reply(54, 251);
    gsay_option(54, 325, Nicole55, 50);
    set_global_var(63, 1);
  Nicole55: |
    set_global_var(61, 1);
    gsay_message(54, 254, 50);
  Nicole78: 'gsay_message(54, 291, 50);

    '
  NicoleMore: |
    gsay_reply(54, DisplayMessage);
    if (local_var(1) >= 2) then begin
      gsay_option(54, 155, Nicole09, 50);
    end
    else begin
      gsay_option(54, 155, Nicole10, 51);
    end
    gsay_option(54, 131, Nicole14, 50);
  NicoleShowOut: |
    gfade_out(600);
    move_to(dude_obj, 23883, 0);
    set_local_var(5, 1);
  NicoleEnd: "[]"
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
obj_dude:
  start: "[]"
  timed_event_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    if (fixed_param == 3) then begin
      metarule(13, 0);
    end
    else begin
      if (fixed_param == 4) then begin
        float_msg(self_obj, message_str(1, 500), -2);
        add_timer_event(dude_obj, game_ticks(15), 3);
      end
      else begin
        if (fixed_param == 5) then begin
          game_ui_disable;
          animate_move_obj_to_tile(map_var(0), 16890, 0);
          add_timer_event(dude_obj, 5, 6);
        end
        else begin
          if (fixed_param == 6) then begin
            LVar0 := 0;
            if (has_trait(2, dude_obj, 8)) then begin
              LVar0 := 1;
            end
            else begin
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                LVar0 := 1;
              end
              else begin
                if (global_var(155) < -1) then begin
                  LVar0 := 1;
                end
                else begin
                  if (global_var(158) > 2) then begin
                    LVar0 := 1;
                  end
                end
              end
            end
            if (LVar0 == 1) then begin
              gun_ptr := create_object_sid(8, 0, 0, -1);
              add_obj_to_inven(dude_obj, gun_ptr);
              wield_obj_critter(dude_obj, gun_ptr);
              add_timer_event(dude_obj, 25, 7);
            end
            else begin
              add_timer_event(dude_obj, 25, 8);
            end
          end
          else begin
            if (fixed_param == 7) then begin
              reg_anim_func(2, map_var(0));
              reg_anim_func(1, 1);
              reg_anim_animate(dude_obj, 43, -1);
              LVar1 := sfx_build_weapon_name(1, gun_ptr, LVar2, map_var(0));
              reg_anim_play_sfx(dude_obj, LVar1, -1);
              reg_anim_animate(dude_obj, 45, -1);
              LVar1 := sfx_build_char_name(map_var(0), 20, 3);
              reg_anim_play_sfx(map_var(0), LVar1, 0);
              reg_anim_animate(map_var(0), 20, 0);
              reg_anim_animate(dude_obj, 44, 0);
              reg_anim_func(3, 0);
              add_timer_event(dude_obj, game_ticks(11), 8);
            end
            else begin
              if (fixed_param == 8) then begin
                game_ui_enable;
                endgame_movie;
                metarule(13, 0);
              end
            end
          end
        end
      end
    end
  map_update_p_proc: |
    if (global_var(14) == 0) then begin
      if ((global_var(511) == 100) and (global_var(203) >= 1)) then begin
        set_global_var(606, 1);
      end
      else begin
        set_global_var(606, 0);
      end
    end
    else begin
      set_global_var(606, 0);
    end
    if (global_var(7) == 0) then begin
      if ((global_var(133) >= 2) and (global_var(492) == 99) and (global_var(24) >= 12)) then begin
        set_global_var(132, 2);
      end
      else begin
        set_global_var(132, 0);
      end
    end
    else begin
      set_global_var(132, 0);
    end
oddwall:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if (local_var(0) != 1) then begin
          display_msg(message_str(88, 100));
          set_local_var(0, 1);
        end
      end
    end
officer:
  start: |
    if (script_action == 12) then begin
      call critter_p_proc;
    end
    else begin
      if (script_action == 18) then begin
        call destroy_p_proc;
      end
      else begin
        if (script_action == 15) then begin
          call map_enter_p_proc;
        end
        else begin
          if (script_action == 4) then begin
            call pickup_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (global_var(261)) then begin
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          dialogue_system_enter;
        end
      end
      else begin
        if ((armory_access == 1) and not(obj_is_open(SecDoor_ptr))) then begin
          use_obj(SecDoor_ptr);
        end
        else begin
          if (armory_access == 2) then begin
            anim(self_obj, 1000, 5);
            float_msg(self_obj, message_str(178, 159), 0);
            armory_access := 0;
            set_map_var(1, armory_access);
          end
          else begin
            if (not(armory_access) and (elevation(dude_obj) == elevation(self_obj))) then begin
              if (tile_distance(tile_num(dude_obj), 21292) < 2) then begin
                hostile := 1;
              end
            end
          end
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(261, 1);
    end
  destroy_p_proc: |
    Officer_ptr := 0;
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    if (source_obj == dude_obj) then begin
      set_global_var(261, 1);
    end
  map_enter_p_proc: |
    critter_add_trait(self_obj, 1, 6, 1);
    Officer_ptr := self_obj;
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    call get_reaction;
    start_gdialog(178, self_obj, 4, -1, -1);
    gsay_start;
    if (global_var(261)) then begin
      call Officer00;
    end
    else begin
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
        call Officer27;
      end
      else begin
        if ((global_var(101) != 0) and (global_var(101) != 1)) then begin
          call Officer01;
        end
        else begin
          if (local_var(1) > 1) then begin
            if (armory_access) then begin
              call Officer25;
            end
            else begin
              call Officer02;
            end
          end
          else begin
            if (armory_access) then begin
              call Officer26;
            end
            else begin
              call Officer18;
            end
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
  Officer00: |
    gsay_message(178, 100, 51);
    hostile := 1;
  Officer01: 'gsay_message(178, 101, 0);

    '
  Officer02: |
    gsay_reply(178, 102);
    giq_option(4, 178, 103, Officer04, 0);
    giq_option(5, 178, 104, Officer08, 0);
    giq_option(6, 178, 105, Officer11, 0);
    giq_option(-3, 178, 106, Officer03, 0);
  Officer03: |
    gsay_reply(178, 107);
    giq_option(4, 178, 159, OfficerEnd, 0);
  Officer04: |
    gsay_reply(178, 108);
    giq_option(4, 178, 109, OfficerEnd, 0);
    giq_option(5, 178, 110, Officer05, 0);
  Officer05: |
    gsay_reply(178, 111);
    giq_option(5, 178, 112, Officer06, 0);
    giq_option(6, 178, 113, Officer07, 0);
  Officer06: |
    gsay_reply(178, 114);
    giq_option(5, 178, 115, OfficerEnd, 0);
  Officer07: |
    call UpReact;
    gsay_message(178, 116, 10);
  Officer08: |
    gsay_reply(178, 117);
    giq_option(4, 178, 118, Officer09, 0);
    giq_option(4, 178, 119, Officer10, 0);
  Officer09: |
    call DownReact;
    gsay_message(178, 120, -10);
  Officer10: 'gsay_message(178, 121, 0);

    '
  Officer11: |
    gsay_reply(178, 122);
    giq_option(5, 178, 123, Officer13, 0);
    giq_option(5, 178, 124, Officer12, 0);
  Officer12: 'gsay_message(178, 125, 0);

    '
  Officer13: |
    gsay_reply(178, 126);
    giq_option(5, 178, 127, Officer15, 0);
    giq_option(5, 178, 128, Officer14, 0);
  Officer14: 'gsay_message(178, 129, 0);

    '
  Officer15: |
    gsay_reply(178, 130);
    giq_option(5, 178, 131, Officer15a, 0);
  Officer15a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Officer17;
    end
    else begin
      call Officer16;
    end
  Officer16: 'gsay_message(178, 132, 0);

    '
  Officer17: |
    armory_access := 1;
    set_map_var(1, armory_access);
    gsay_message(178, 133, 0);
  Officer18: |
    gsay_reply(178, message_str(178, 134) + proto_data(obj_pid(dude_obj), 1) + message_str(178, 135));
    giq_option(4, 178, 136, Officer20, 0);
    giq_option(5, 178, 137, Officer21, 0);
    giq_option(-3, 178, 138, Officer19, 0);
  Officer19: 'gsay_message(178, 139, 0);

    '
  Officer20: 'gsay_message(178, 140, 0);

    '
  Officer21: |
    gsay_reply(178, 141);
    giq_option(5, 178, 142, Officer22, 0);
    giq_option(5, 178, 143, Officer21a, 0);
  Officer21a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Officer23;
    end
    else begin
      call Officer24;
    end
  Officer22: |
    gsay_reply(178, 144);
    giq_option(5, 178, 145, OfficerEnd, 0);
    giq_option(5, 178, 146, OfficerCombat, -10);
  Officer23: 'gsay_message(178, 147, 0);

    '
  Officer24: 'gsay_message(178, 148, 0);

    '
  Officer25: 'gsay_message(178, 149, 0);

    '
  Officer26: 'gsay_message(178, 150, 0);

    '
  Officer27: 'gsay_message(178, 151, 0);

    '
  Officer28: |
    gsay_reply(178, 152);
    giq_option(4, 178, 153, Officer30, 0);
    giq_option(5, 178, 154, Officer31, 0);
    giq_option(-3, 178, 155, Officer29, 0);
  Officer29: 'gsay_message(178, 156, 0);

    '
  Officer30: 'gsay_message(178, 157, 0);

    '
  Officer31: 'gsay_message(178, 158, 0);

    '
  OfficerCombat: 'hostile := 1;

    '
  OfficerEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
orfeo:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    if (local_var(0)) then begin
      script_overrides;
      display_msg(message_str(269, 100));
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    script_overrides;
    if (local_var(0)) then begin
      call Orfeo3;
    end
    else begin
      set_local_var(0, 1);
      start_gdialog(269, self_obj, 4, -1, -1);
      gsay_start;
      call Orfeo0;
      gsay_end;
      end_dialogue;
    end
  Orfeo0: |
    gsay_reply(269, 101);
    giq_option(-3, 269, 102, combat, 50);
    giq_option(4, 269, 103, Orfeo1, 50);
    giq_option(4, 269, 104, Orfeo2, 50);
  Orfeo1: |
    gsay_message(269, 105, 50);
    call combat;
  Orfeo2: |
    gsay_message(269, 106, 50);
    call combat;
  Orfeo3: |
    float_msg(self_obj, message_str(269, 107), 0);
    call combat;
  Orfeoend: "[]"
  combat: 'hostile := hostile + 1;

    '
over:
  start: "[]"
  combat_p_proc: |
    variable LVar0 := 0;
    if (fixed_param == 4) then begin
      if (obj_is_carrying_obj_pid(self_obj, 36) == 0) then begin
        LVar0 := create_object_sid(36, 0, 0, -1);
        add_mult_objs_to_inven(self_obj, LVar0, 2);
      end
    end
  critter_p_proc: |
    if (HOSTILE) then begin
      HOSTILE := 0;
      attack_complex(dude_obj, 0, 1, 100, 250, 300, 0, 128);
    end
    else begin
      if ((global_var(261) == 1) and (tile_distance_objs(self_obj, dude_obj) < 12)) then begin
        if (local_var(8) == 0) then begin
          dialogue_system_enter;
        end
      end
      else begin
        if (global_var(17) and global_var(18) and (local_var(6) == 0)) then begin
          dialogue_system_enter;
        end
      end
    end
  damage_p_proc: |
    script_overrides;
    critter_heal(self_obj, 100);
    if (source_obj == dude_obj) then begin
      set_global_var(261, 1);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(55, 100));
  map_enter_p_proc: 'critter_add_trait(self_obj, 1, 6, 1);

    '
  pickup_p_proc: |
    stealing := 1;
    dialogue_system_enter;
  talk_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    call get_reaction;
    start_gdialog(55, self_obj, 4, 1, 10);
    gsay_start;
    SEED := 0;
    if (global_var(17) and global_var(18)) then begin
      call over81;
    end
    else begin
      if (global_var(261)) then begin
        call over72;
      end
      else begin
        if (stealing) then begin
          call over71;
        end
        else begin
          if (global_var(101) == 0) then begin
            if (obj_is_carrying_obj_pid(dude_obj, 55)) then begin
              call over28;
            end
            else begin
              if (Visits_without_chip == 1) then begin
                call over07;
              end
              else begin
                if (Visits_without_chip == 2) then begin
                  call over12;
                end
                else begin
                  if (Visits_without_chip > 2) then begin
                    call over19;
                  end
                end
              end
              Visits_without_chip := Visits_without_chip + 1;
            end
          end
          else begin
            if (global_var(101) == 1) then begin
              if (obj_is_carrying_obj_pid(dude_obj, 55)) then begin
                call over28;
              end
              else begin
                if (Visits_with_caravans == 1) then begin
                  call over73;
                end
                else begin
                  if (Visits_with_caravans > 1) then begin
                    call over80;
                  end
                end
              end
              Visits_with_caravans := Visits_with_caravans + 1;
            end
            else begin
              if (not(global_var(17))) then begin
                if (global_var(18)) then begin
                  call over54;
                end
                else begin
                  if (Visits_master_alive == 1) then begin
                    call over42;
                  end
                  else begin
                    call over50;
                  end
                end
                Visits_master_alive := Visits_master_alive + 1;
              end
              else begin
                if (global_var(18)) then begin
                  call over81;
                end
                else begin
                  if (Visits_vats_blown == 1) then begin
                    call over62;
                  end
                  else begin
                    call over68;
                  end
                end
                Visits_vats_blown := Visits_vats_blown + 1;
              end
            end
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
    if (Ian_ptr != 0) then begin
      if (local_var(7) == 0) then begin
        float_msg(Ian_ptr, message_str(235, 171), 0);
        set_local_var(7, 1);
      end
    end
    if (local_var(4) == 1) then begin
      LVar0 := obj_carrying_pid_obj(dude_obj, 55);
      rm_obj_from_inven(dude_obj, LVar0);
      gfade_out(600);
      display_msg(message_str(55, 252));
      give_exp_points(7500);
      set_local_var(4, 2);
      move_to(dude_obj, 21135, 2);
      display_msg(message_str(163, 117));
      gfade_in(600);
    end
  use_skill_on_p_proc: |
    if (action_being_used == 10) then begin
      script_overrides;
      stealing := 1;
      dialogue_system_enter;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  overend: "[]"
  overcbt: 'HOSTILE := 1;

    '
  over07: |
    gsay_reply(55, 111);
    giq_option(7, 55, 112, over10, 51);
    giq_option(6, 55, 113, over09, 50);
    giq_option(4, 55, 114, over08, 50);
    giq_option(-3, 55, 115, over08, 50);
  over08: |
    gsay_reply(55, 116);
    giq_option(4, 55, 260, overend, 50);
  over09: |
    gsay_reply(55, 117);
    giq_option(4, 55, 118, over08, 50);
  over10: |
    gsay_reply(55, 119);
    giq_option(4, 55, 120, over08, 50);
  over12: |
    gsay_reply(55, 121);
    giq_option(4, 55, 122, over13, 50);
    giq_option(5, 55, 123, over14, 50);
    giq_option(4, 55, 124, over16, 51);
    giq_option(-3, 55, 125, over16, 51);
  over13: 'gsay_message(55, 126, 50);

    '
  over14: |
    gsay_reply(55, 127);
    giq_option(6, 55, 128, overend, 50);
  over16: 'gsay_message(55, 129, 50);

    '
  over19: |
    gsay_reply(55, 130);
    giq_option(5, 55, 131, over21, 51);
    giq_option(6, 55, 132, over22, 50);
    giq_option(4, 55, 133, over20, 50);
    giq_option(-3, 55, 134, over20, 50);
  over20: 'gsay_message(55, 135, 50);

    '
  over21: 'gsay_message(55, 136, 51);

    '
  over22: |
    gsay_reply(55, 137);
    giq_option(6, 55, 138, over23, 50);
    if (not(local_var(5))) then begin
      giq_option(6, 55, 139, over24, 50);
    end
    giq_option(6, 55, 140, over25, 50);
  over23: 'gsay_message(55, 141, 50);

    '
  over24: |
    variable LVar0 := 0;
    set_local_var(5, 1);
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(29, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(29, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(55, 142, 50);
  over25: |
    gsay_reply(55, 143);
    giq_option(5, 55, 144, over26, 50);
    giq_option(5, 55, 145, over27, 50);
  over26: |
    gsay_reply(55, 146);
    giq_option(5, 55, 147, overend, 50);
    giq_option(6, 55, 148, overend, 50);
  over27: 'gsay_message(55, 149, 50);

    '
  over28: |
    gsay_reply(55, 150);
    giq_option(4, 55, 151, over29, 50);
    giq_option(6, 55, 152, over34, 50);
    giq_option(-3, 55, 153, over37, 50);
  over29: |
    gsay_message(55, 154, 50);
    call over31;
  over30: |
    gsay_reply(55, 155);
    giq_option(4, 55, 164, over29, 50);
    giq_option(4, 55, 165, over30, 50);
  over31: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    Visits_with_chip := Visits_with_chip + 1;
    set_global_var(101, 2);
    if (global_var(238) != 2) then begin
      set_global_var(238, 3);
    end
    if (global_var(188) != 2) then begin
      set_global_var(188, 3);
    end
    set_local_var(4, 1);
    gsay_reply(55, 156);
    giq_option(6, 55, 157, over32, 50);
    giq_option(4, 55, 158, over33, 50);
  over32: |
    gsay_reply(55, 159);
    giq_option(4, 55, 160, overend, 50);
  over33: |
    gsay_reply(55, 161);
    giq_option(4, 55, 162, overend, 50);
  over34: |
    gsay_reply(55, 163);
    giq_option(4, 55, 164, over29, 50);
    giq_option(4, 55, 165, over30, 50);
  over37: |
    gsay_reply(55, 166);
    giq_option(0, 55, 196, over38, 50);
  over38: |
    gsay_reply(55, 167);
    giq_option(0, 55, 196, over38a, 50);
  over38a: |
    gsay_reply(55, 168);
    giq_option(0, 55, 196, over39, 50);
  over39: |
    gsay_reply(55, 169);
    giq_option(0, 55, 196, over40, 50);
  over40: |
    variable LVar0 := 0;
    Visits_with_chip := Visits_with_chip + 1;
    set_global_var(101, 2);
    if (global_var(238) != 2) then begin
      set_global_var(238, 3);
    end
    if (global_var(188) != 2) then begin
      set_global_var(188, 3);
    end
    set_local_var(4, 1);
    gsay_reply(55, 170);
    giq_option(-3, 55, 171, over41, 50);
    giq_option(-3, 55, 172, over41a, 50);
  over41: 'gsay_message(55, 173, 50);

    '
  over41a: 'gsay_message(55, 174, 50);

    '
  over42: |
    set_global_var(308, 1);
    set_global_var(309, 1);
    gsay_reply(55, 175);
    giq_option(4, 55, 176, over43, 50);
    giq_option(-3, 55, 177, over49, 50);
  over43: |
    gsay_reply(55, 178);
    giq_option(4, 55, 179, over44, 50);
  over44: |
    gsay_reply(55, 180);
    giq_option(4, 55, 181, over45, 50);
    giq_option(7, 55, 182, over46, 50);
  over45: |
    gsay_reply(55, 183);
    giq_option(4, 55, 184, over47, 50);
  over46: |
    gsay_reply(55, 185);
    giq_option(6, 55, 186, over47, 50);
  over47: |
    gsay_reply(55, 187);
    giq_option(4, 55, 188, overend, 50);
    giq_option(6, 55, 189, over48, 50);
  over48: 'gsay_message(55, 190, 50);

    '
  over49: 'gsay_message(55, 191, 50);

    '
  over50: |
    gsay_reply(55, 192);
    giq_option(4, 55, 193, over51, 50);
    giq_option(6, 55, 194, over52, 50);
    giq_option(5, 55, 195, over53, 50);
    giq_option(-3, 55, 196, over51, 50);
  over51: 'gsay_message(55, 197, 50);

    '
  over52: 'gsay_message(55, 198, 50);

    '
  over53: 'gsay_message(55, 199, 50);

    '
  over54: |
    gsay_reply(55, 200);
    giq_option(4, 55, 201, over55, 50);
    giq_option(6, 55, 202, over55, 50);
    giq_option(-3, 55, 203, over61, 50);
  over55: |
    gsay_reply(55, 204);
    giq_option(4, 55, 205, over60, 50);
  over60: 'gsay_message(55, 209, 50);

    '
  over61: |
    gsay_reply(55, 210);
    giq_option(-3, 55, 211, over61a, 50);
  over61a: 'gsay_message(55, 212, 50);

    '
  over62: |
    gsay_reply(55, 213);
    giq_option(4, 55, 214, over63, 50);
    giq_option(6, 55, 215, over64, 50);
    giq_option(-3, 55, 216, over63, 50);
  over63: |
    gsay_reply(55, 217);
    giq_option(4, 55, 218, over64, 50);
    giq_option(-3, 55, 219, over64, 50);
  over64: |
    gsay_reply(55, 220);
    giq_option(4, 55, 221, over66, 50);
    giq_option(-3, 55, 222, over66, 50);
  over66: 'gsay_message(55, 223, 50);

    '
  over68: |
    gsay_reply(55, 224);
    giq_option(4, 55, 225, over69, 50);
    giq_option(4, 55, 226, over70, 50);
    giq_option(-3, 55, 227, over69, 50);
  over69: 'gsay_message(55, 228, 50);

    '
  over70: 'gsay_message(55, 229, 50);

    '
  over71: |
    stealing := 0;
    gsay_message(55, 230, 51);
  over72: |
    gsay_reply(55, 231);
    set_local_var(8, 1);
    giq_option(4, 55, 259, overcbt, 51);
    giq_option(-3, 55, 234, overcbt, 51);
  over73: |
    gsay_reply(55, 232);
    giq_option(4, 55, 233, over75, 50);
    giq_option(-3, 55, 234, over74, 50);
  over74: 'gsay_message(55, 235, 50);

    '
  over75: |
    gsay_reply(55, 236);
    giq_option(4, 55, 237, over76, 50);
    giq_option(6, 55, 238, over77, 50);
  over76: 'gsay_message(55, 239, 50);

    '
  over77: |
    gsay_reply(55, 240);
    giq_option(5, 55, 241, over78, 50);
    giq_option(6, 55, 242, over79, 50);
  over78: 'gsay_message(55, 243, 50);

    '
  over79: 'gsay_message(55, 244, 50);

    '
  over80: 'gsay_message(55, 245, 50);

    '
  over81: |
    set_local_var(6, 1);
    set_local_var(8, 1);
    call TopReact;
    gsay_reply(55, 261);
    giq_option(0, 634, 106, Over81b, 49);
  Over81b: |
    set_local_var(1, 50);
    call LevelToReact;
    gsay_reply(55, 262);
    giq_option(0, 634, 106, Over81c, 51);
  Over81c: |
    call BottomReact;
    gsay_reply(55, 263);
    giq_option(0, 634, 106, Over81d, 51);
  Over81d: |
    gsay_reply(55, 264);
    giq_option(0, 634, 106, Over81e, 51);
  Over81e: |
    gsay_message(55, 265, 51);
    add_timer_event(dude_obj, 10, 5);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
paladina:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 65);
      add_timer_event(self_obj, game_ticks(300), 1);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
      end
    end
    if (script_action == 22) then begin
      call time_p_proc;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
      end
    end
  PaladinARandom: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (not(LVar0)) then begin
      LVar0 := random(1, 9);
    end
    if (LVar0 > 10) then begin
      LVar0 := 1;
    end
    LVar1 := message_str(325, 101);
    if (LVar0 == 2) then begin
      LVar1 := message_str(325, 102);
    end
    else begin
      if (LVar0 == 3) then begin
        LVar1 := message_str(325, 103);
      end
      else begin
        if (LVar0 == 4) then begin
          LVar1 := message_str(325, 104) + proto_data(obj_pid(dude_obj), 1) + message_str(325, 105);
        end
        else begin
          if (LVar0 == 5) then begin
            LVar1 := message_str(325, 106);
          end
          else begin
            if (LVar0 == 6) then begin
              LVar1 := message_str(325, 107);
            end
            else begin
              if (LVar0 == 7) then begin
                LVar1 := message_str(325, 108);
              end
              else begin
                if (LVar0 == 8) then begin
                  LVar1 := message_str(325, 109);
                end
                else begin
                  if (LVar0 == 9) then begin
                    LVar1 := message_str(325, 110);
                  end
                  else begin
                    LVar0 := 1;
                  end
                end
              end
            end
          end
        end
      end
    end
    LVar0 := LVar0 + 1;
    float_msg(self_obj, LVar1, 0);
  PaladinABackground: |
    variable LVar0 := 0;
    add_timer_event(self_obj, game_ticks(300), 1);
    if (random(0, 1)) then begin
      LVar0 := message_str(325, 112);
    end
    else begin
      LVar0 := message_str(325, 113);
    end
    float_msg(self_obj, LVar0, 0);
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: 'call PaladinARandom;

    '
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(325, 100));
  time_p_proc: 'call PaladinABackground;

    '
paladinb:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 65);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  PaladinBRandom: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (not(LVar0)) then begin
      LVar0 := random(1, 6);
    end
    if (LVar0 > 6) then begin
      LVar0 := 1;
    end
    LVar1 := message_str(326, 101);
    if (LVar0 == 2) then begin
      LVar1 := message_str(326, 102);
    end
    else begin
      if (LVar0 == 3) then begin
        LVar1 := message_str(326, 103);
      end
      else begin
        if (LVar0 == 4) then begin
          LVar1 := message_str(326, 104);
        end
        else begin
          if (LVar0 == 5) then begin
            LVar1 := message_str(326, 105);
          end
          else begin
            if (LVar0 == 6) then begin
              if (get_critter_stat(dude_obj, 34) == 0) then begin
                LVar1 := message_str(326, 106);
              end
              else begin
                LVar1 := message_str(326, 107);
              end
            end
            else begin
              LVar0 := 1;
            end
          end
        end
      end
    end
    LVar0 := LVar0 + 1;
    float_msg(self_obj, LVar1, 0);
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: 'call PaladinBRandom;

    '
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(326, 100));
paladinc:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 65);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  PaladinCRandom: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (not(LVar0)) then begin
      LVar0 := random(1, 7);
    end
    if (LVar0 > 7) then begin
      LVar0 := 1;
    end
    LVar1 := message_str(327, 101);
    if (LVar0 == 2) then begin
      LVar1 := message_str(327, 102);
    end
    else begin
      if (LVar0 == 3) then begin
        LVar1 := message_str(327, 103);
      end
      else begin
        if (LVar0 == 4) then begin
          LVar1 := message_str(327, 104);
        end
        else begin
          if (LVar0 == 5) then begin
            LVar1 := message_str(327, 105);
          end
          else begin
            if (LVar0 == 6) then begin
              LVar1 := message_str(327, 106);
            end
            else begin
              if (LVar0 == 7) then begin
                if (get_critter_stat(dude_obj, 34) == 0) then begin
                  LVar1 := message_str(327, 107);
                end
                else begin
                  LVar1 := message_str(327, 108);
                end
              end
              else begin
                LVar0 := 1;
              end
            end
          end
        end
      end
    end
    LVar0 := LVar0 + 1;
    float_msg(self_obj, LVar1, 0);
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: 'call PaladinCRandom;

    '
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(327, 100));
palguard:
  start: |
    if (Only_Once == 0) then begin
      Only_Once := 1;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 65);
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if (script_action == 18) then begin
        if (source_obj == dude_obj) then begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
            set_global_var(156, 1);
            set_global_var(157, 0);
          end
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
            set_global_var(157, 1);
            set_global_var(156, 0);
          end
          set_global_var(159, global_var(159) + 1);
          if ((global_var(159) % 2) == 0) then begin
            set_global_var(155, global_var(155) - 1);
          end
        end
      end
      else begin
        if ((script_action == 21) or (script_action == 3)) then begin
          script_overrides;
          display_msg(message_str(317, 100));
        end
        else begin
          if (script_action == 22) then begin
            attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    if (local_var(1) < 2) then begin
      call PalGuard01;
    end
    else begin
      call PalGuard02;
    end
  PalGuard01: |
    if (not(line)) then begin
      line := random(1, 9);
    end
    else begin
      line := line + 1;
    end
    if (line > 9) then begin
      line := 1;
    end
    if (line == 1) then begin
      float_msg(self_obj, message_str(317, 101), 2);
    end
    else begin
      if (line == 2) then begin
        float_msg(self_obj, message_str(317, 102), 2);
      end
      else begin
        if (line == 3) then begin
          float_msg(self_obj, message_str(317, 103), 2);
        end
        else begin
          if (line == 4) then begin
            float_msg(self_obj, message_str(317, 104), 2);
          end
          else begin
            if (line == 5) then begin
              float_msg(self_obj, message_str(317, 105), 2);
            end
            else begin
              if (line == 6) then begin
                if (get_critter_stat(dude_obj, 34) == 1) then begin
                  float_msg(self_obj, message_str(317, 106), 2);
                end
                else begin
                  line := line + 1;
                end
              end
              else begin
                if (line == 7) then begin
                  if (global_var(108) == 2) then begin
                    float_msg(self_obj, message_str(317, 107), 2);
                  end
                  else begin
                    line := line + 1;
                  end
                end
                else begin
                  if (line == 8) then begin
                    if (global_var(108) < 2) then begin
                      float_msg(self_obj, message_str(317, 108), 2);
                    end
                    else begin
                      line := line + 1;
                    end
                  end
                  else begin
                    if (line == 9) then begin
                      if (global_var(108) < 2) then begin
                        float_msg(self_obj, message_str(317, 109), 2);
                      end
                      else begin
                        line := 1;
                        float_msg(self_obj, message_str(317, 110), 2);
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  PalGuard02: |
    if (not(line)) then begin
      line := random(1, 10);
    end
    else begin
      line := line + 1;
    end
    if (line > 10) then begin
      line := 1;
    end
    if (line == 1) then begin
      float_msg(self_obj, message_str(317, 111), 2);
    end
    else begin
      if (line == 2) then begin
        float_msg(self_obj, message_str(317, 112), 2);
      end
      else begin
        if (line == 3) then begin
          float_msg(self_obj, message_str(317, 113), 2);
        end
        else begin
          if (line == 4) then begin
            float_msg(self_obj, message_str(317, 114), 2);
          end
          else begin
            if (line == 5) then begin
              float_msg(self_obj, message_str(317, 115), 2);
            end
            else begin
              if (line == 7) then begin
                if (global_var(108) == 2) then begin
                  float_msg(self_obj, message_str(317, 116), 2);
                end
                else begin
                  float_msg(self_obj, message_str(317, 117), 2);
                end
              end
              else begin
                if (line == 7) then begin
                  if (global_var(108) == 2) then begin
                    float_msg(self_obj, message_str(317, 118), 2);
                  end
                  else begin
                    float_msg(self_obj, message_str(317, 119), 2);
                  end
                end
              end
            end
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
patrick:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 87);
      critter_add_trait(self_obj, 1, 5, 2);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (scared) then begin
      if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
        call flee_dude;
      end
    end
    else begin
      if (hostile) then begin
        hostile := 0;
        scared := 1;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  destroy_p_proc: |
    set_global_var(297, 1);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    known := global_var(330);
    if (known) then begin
      display_msg(message_str(667, 101));
    end
    else begin
      display_msg(message_str(667, 100));
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    known := global_var(330);
    if (scared) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      start_gdialog(667, self_obj, 4, -1, -1);
      gsay_start;
      if (known) then begin
        call Patrick17;
      end
      else begin
        call Patrick01;
      end
      gsay_end;
      end_dialogue;
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
  Patrick01: |
    known := 1;
    set_global_var(330, known);
    gsay_reply(667, 102);
    giq_option(4, 667, 103, Patrick02, 50);
    giq_option(4, 667, 104, Patrick03, 50);
    if ((global_var(101) == 0) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 667, 105, Patrick04, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 667, 106, PatrickCombat, 51);
    end
    giq_option(-3, 667, 107, PatrickEnd, 50);
  Patrick02: |
    gsay_reply(667, 108);
    giq_option(4, 667, 109, Patrick05, 50);
    giq_option(4, 667, 110, Patrick06, 50);
    giq_option(4, 667, 111, Patrick05, 50);
    giq_option(4, 667, 112, PatrickEnd, 50);
  Patrick03: |
    gsay_reply(667, 113);
    giq_option(4, 667, 114, PatrickEnd, 50);
    giq_option(4, 667, 115, Patrick05, 50);
  Patrick04: |
    gsay_reply(667, 116);
    if (get_critter_stat(dude_obj, 4) > 6) then begin
      giq_option(7, 667, 117, Patrick07, 50);
    end
    else begin
      giq_option(4, 667, 118, Patrick07, 50);
    end
  Patrick05: |
    gsay_reply(667, 119);
    giq_option(4, 667, 120, Patrick08, 50);
    giq_option(4, 667, 121, Patrick09, 50);
    giq_option(4, 667, 110, Patrick06, 50);
    giq_option(4, 667, 122, PatrickEnd, 50);
  Patrick06: |
    gsay_reply(667, 123);
    if (global_var(68) < 1) then begin
      set_global_var(68, 1);
    end
    if (global_var(71) < 1) then begin
      set_global_var(71, 1);
    end
    if (global_var(73) < 1) then begin
      set_global_var(73, 1);
    end
    if (global_var(72) < 1) then begin
      set_global_var(72, 1);
    end
    call Patrick06a;
  Patrick06a: |
    giq_option(4, 667, 124, Patrick10, 50);
    giq_option(4, 667, 125, Patrick11, 50);
    giq_option(4, 667, 126, Patrick12, 50);
    giq_option(4, 667, 127, Patrick13, 50);
    giq_option(4, 634, 100, PatrickEnd, 50);
  Patrick07: |
    gsay_reply(667, 128);
    giq_option(4, 634, 100, PatrickEnd, 50);
    giq_option(4, 667, 115, Patrick05, 50);
  Patrick08: |
    gsay_reply(667, 129);
    if ((global_var(101) == 0) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 667, 130, Patrick07, 50);
    end
    giq_option(4, 667, 110, Patrick05, 50);
    giq_option(4, 667, 112, PatrickEnd, 50);
  Patrick09: |
    gsay_reply(667, 131);
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      giq_option(7, 667, 132, Patrick15, 49);
    end
    giq_option(4, 667, 133, Patrick05, 50);
    giq_option(4, 667, 122, PatrickEnd, 50);
  Patrick10: |
    if (global_var(12) == 1) then begin
      gsay_reply(667, 141);
    end
    else begin
      if (global_var(26) == 27) then begin
        gsay_reply(667, 135);
      end
      else begin
        gsay_reply(667, 134);
      end
    end
    call Patrick06a;
  Patrick11: |
    if (global_var(15) == 1) then begin
      gsay_reply(667, 141);
    end
    else begin
      if (global_var(37)) then begin
        if (global_var(38)) then begin
          gsay_reply(667, 138);
        end
        else begin
          gsay_reply(667, 137);
        end
      end
      else begin
        gsay_reply(667, 136);
      end
    end
    call Patrick06a;
  Patrick12: |
    if (global_var(14) == 1) then begin
      gsay_reply(667, 141);
    end
    else begin
      gsay_reply(667, 139);
    end
    call Patrick06a;
  Patrick13: |
    if (global_var(13) == 1) then begin
      gsay_reply(667, 141);
    end
    else begin
      gsay_reply(667, 140);
    end
    if (get_critter_stat(dude_obj, 4) > 5) then begin
      giq_option(6, 667, 142, Patrick14, 50);
    end
    else begin
      call Patrick06a;
    end
  Patrick14: |
    gsay_reply(667, 143);
    call Patrick06a;
  Patrick15: |
    gsay_reply(667, 144);
    giq_option(4, 667, 145, Patrick16, 49);
    giq_option(4, 667, 146, PatrickEnd, 50);
  Patrick16: |
    gfade_out(600);
    set_critter_stat(dude_obj, 3, 1);
    gfade_in(600);
    gsay_message(667, 147, 49);
  Patrick17: |
    gsay_reply(667, 148);
    giq_option(4, 667, 149, Patrick06, 50);
    giq_option(4, 667, 150, PatrickEnd, 50);
    giq_option(-3, 667, 107, PatrickEnd, 50);
  PatrickCombat: 'hostile := 1;

    '
  PatrickEnd: "[]"
paul:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 64);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(865, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4) == 0) then begin
      set_local_var(4, 1);
      call Paul01;
    end
    else begin
      call Paul14;
    end
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(865, 100));
  Paul01: |
    gsay_reply(865, 101);
    giq_option(4, 865, 102, Paul02, 50);
    giq_option(4, 865, 103, Paul04, 50);
    if (map_var(0) == 1) then begin
      giq_option(4, 865, 104, Paul07, 50);
    end
    if (global_var(30) != 1) then begin
      giq_option(4, 865, 105, Paul09, 50);
    end
    if (global_var(304) == 1) then begin
      giq_option(4, 865, 106, Paul12, 50);
    end
    giq_option(4, 865, 108, PaulEnd, 50);
    giq_option(-3, 865, 107, Paul15, 50);
  Paul02: |
    gsay_reply(865, 109);
    giq_option(4, 865, 110, Paul03, 50);
    if (map_var(0) == 1) then begin
      giq_option(4, 865, 111, Paul07, 50);
    end
  Paul03: |
    gsay_reply(865, 112);
    giq_option(4, 865, 113, Paul04, 50);
    giq_option(4, 865, 114, PaulEnd, 50);
  Paul04: |
    gsay_reply(865, 115);
    giq_option(4, 865, 116, Paul05, 50);
    giq_option(4, 865, 117, PaulEnd, 50);
  Paul05: |
    gsay_reply(865, 118);
    giq_option(4, 865, 119, Paul06, 50);
    giq_option(4, 865, 120, PaulEnd, 50);
  Paul06: |
    gsay_reply(865, 121);
    giq_option(4, 865, 122, Paul04, 50);
    if (global_var(30) != 1) then begin
      giq_option(4, 865, 123, Paul09, 50);
    end
    if (global_var(304) == 1) then begin
      giq_option(4, 865, 124, Paul12, 50);
    end
    if (map_var(0) == 1) then begin
      giq_option(4, 865, 125, Paul07, 50);
    end
    giq_option(4, 865, 126, PaulEnd, 50);
  Paul07: |
    gsay_reply(865, 127);
    giq_option(4, 865, 128, Paul08, 50);
    giq_option(4, 865, 129, Paul11, 50);
  Paul08: |
    gsay_reply(865, 130);
    giq_option(4, 865, 131, Paul05, 50);
    giq_option(4, 865, 132, PaulEnd, 50);
    giq_option(4, 865, 133, Paul06, 50);
  Paul09: |
    gsay_reply(865, 134);
    giq_option(4, 865, 135, Paul10, 50);
  Paul10: |
    gsay_reply(865, 136);
    giq_option(4, 865, 138, Paul06, 50);
    giq_option(4, 865, 137, PaulEnd, 50);
  Paul11: |
    gsay_reply(865, 139);
    giq_option(4, 865, 140, Paul08, 50);
  Paul12: |
    gsay_reply(865, 141);
    giq_option(4, 865, 142, Paul13, 50);
    giq_option(4, 865, 143, PaulEnd, 50);
  Paul13: |
    gsay_reply(865, 144);
    giq_option(4, 865, 146, Paul06, 50);
    giq_option(4, 865, 145, PaulEnd, 50);
  Paul14: |
    gsay_reply(865, message_str(865, 147) + proto_data(obj_pid(dude_obj), 1) + message_str(865, 148));
    giq_option(4, 865, 149, Paul02, 50);
    giq_option(4, 865, 150, Paul04, 50);
    if (map_var(0) == 1) then begin
      giq_option(4, 865, 151, Paul07, 50);
    end
    if (global_var(30) != 1) then begin
      giq_option(4, 865, 152, Paul09, 50);
    end
    if (global_var(304) == 1) then begin
      giq_option(4, 865, 153, Paul12, 50);
    end
    giq_option(4, 865, 155, PaulEnd, 50);
    giq_option(-3, 865, 154, Paul15, 50);
  Paul15: 'gsay_message(865, 156, 50);

    '
  PaulEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
peasantc:
  start: "[]"
  critter_p_proc: |
    if (global_var(628) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        call flee_dude;
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(628, 1);
      set_global_var(247, 1);
      set_global_var(155, global_var(155) - 5);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  map_enter_p_proc: |
    if (map_var(2) == 1) then begin
      set_obj_visibility(self_obj, 1);
      removal_ptr := self_obj;
    end
    else begin
      sleep_time := random(2215, 2230);
      wake_time := random(715, 730);
      if ((game_time / (10 * 60 * 60 * 24)) < 80) then begin
        sleep_tile := 15275;
        home_tile := 14267;
      end
      else begin
        sleep_tile := 23524;
        home_tile := 23923;
      end
    end
    critter_add_trait(self_obj, 1, 6, 16);
    critter_add_trait(self_obj, 1, 5, 6);
    if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
      move_to(self_obj, home_tile, elevation(self_obj));
    end
    if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
      move_to(self_obj, sleep_tile, elevation(self_obj));
    end
  map_update_p_proc: 'call sleeping;

    '
  pickup_p_proc: |
    set_local_var(1, 1);
    float_msg(self_obj, message_str(438, 124), 2);
  talk_p_proc: |
    if (local_var(2) == 1) then begin
      float_msg(self_obj, message_str(185, 166), 0);
    end
    else begin
      if (local_var(1) == 1) then begin
        float_msg(self_obj, message_str(438, 124), 2);
      end
      else begin
        if ((game_time / (10 * 60 * 60 * 24)) < 80) then begin
          set_local_var(0, 1);
          if (global_var(628) == 1) then begin
            float_msg(self_obj, message_str(438, 100), 2);
          end
          else begin
            if (global_var(155) < -10) then begin
              float_msg(self_obj, message_str(438, 101), 7);
            end
            else begin
              if (get_critter_stat(dude_obj, 34) == 0) then begin
                float_msg(self_obj, message_str(438, random(102, 103)), 3);
              end
              else begin
                float_msg(self_obj, message_str(438, random(102, 104)), 3);
              end
            end
          end
        end
        else begin
          set_map_var(2, 1);
          start_gdialog(438, self_obj, 4, -1, -1);
          gsay_start;
          call PeasantC00;
          gsay_end;
          end_dialogue;
        end
      end
    end
  PeasantC00: |
    gsay_reply(438, 105);
    giq_option(4, 438, 106, PeasantCEnd, 50);
    giq_option(5, 438, 107, PeasantC00a, 50);
    giq_option(-3, 438, 108, PeasantC01, 50);
  PeasantC00a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call PeasantC03;
    end
    else begin
      call PeasantC02;
    end
  PeasantC01: 'gsay_message(438, 109, 50);

    '
  PeasantC02: 'gsay_message(438, 110, 50);

    '
  PeasantC03: |
    gsay_reply(438, 111);
    giq_option(5, 438, 112, PeasantC04, 51);
    giq_option(6, 438, 113, PeasantC03a, 50);
    giq_option(4, 438, 106, PeasantCEnd, 50);
  PeasantC03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call PeasantC06;
    end
    else begin
      call PeasantC05;
    end
  PeasantC04: |
    set_local_var(1, 1);
    gsay_message(438, 114, 51);
  PeasantC05: 'gsay_message(438, 115, 50);

    '
  PeasantC06: |
    variable LVar0 := 0;
    LVar0 := message_str(438, 116);
    if (global_var(37) == 1) then begin
      if (global_var(38) == 1) then begin
        LVar0 := LVar0 + message_str(438, 120);
      end
      else begin
        LVar0 := LVar0 + message_str(438, 119);
      end
    end
    else begin
      if (global_var(38) == 1) then begin
        LVar0 := LVar0 + message_str(438, 118);
      end
      else begin
        LVar0 := LVar0 + message_str(438, 117);
      end
    end
    gsay_reply(438, LVar0);
    giq_option(5, 438, 121, PeasantC07, 50);
    giq_option(5, 438, 122, PeasantCEnd, 50);
  PeasantC07: 'gsay_message(438, 123, 50);

    '
  PeasantCEnd: "[]"
  sleeping: |
    if (local_var(2) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(2, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(2, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, sleep_tile, 0);
          end
          else begin
            set_local_var(2, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(2, 1);
          end
        end
      end
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
peasantd:
  start: |
    if (not(GVar2)) then begin
      smartass := 0;
      smartass2 := 0;
      GVar2 := 1;
    end
    else begin
      if (script_action == 11) then begin
        call do_dialogue;
      end
      else begin
        if (script_action == 18) then begin
          if (source_obj == dude_obj) then begin
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
              set_global_var(156, 1);
              set_global_var(157, 0);
            end
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
              set_global_var(157, 1);
              set_global_var(156, 0);
            end
            set_global_var(159, global_var(159) + 1);
            if ((global_var(159) % 2) == 0) then begin
              set_global_var(155, global_var(155) - 1);
            end
          end
        end
        else begin
          if ((script_action == 21) or (script_action == 3)) then begin
            script_overrides;
            display_msg(message_str(372, 100));
          end
          else begin
            if (script_action == 12) then begin
              if (smartass2) then begin
                call PeasantD00;
              end
              if (not(dog_is_angry)) then begin
                call go_inside;
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call weapon_check;
    if (global_var(5)) then begin
      call PeasantD02;
    end
    else begin
      if (not(dog_is_angry)) then begin
        call PeasantD04;
      end
      else begin
        if (GVar1) then begin
          call PeasantD01;
        end
        else begin
          call PeasantD03;
        end
      end
    end
  go_inside: 'animate_move_obj_to_tile(self_obj, 15484, 0);

    '
  weapon_check: |
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      GVar1 := 1;
    end
    else begin
      GVar1 := 0;
    end
  PeasantD00: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 3);
    if (LVar0 == 1) then begin
      LVar1 := message_str(372, 101);
    end
    else begin
      if (LVar0 == 2) then begin
        LVar1 := message_str(372, 102);
      end
      else begin
        LVar1 := message_str(372, 103);
      end
    end
    float_msg(self_obj, LVar1, 0);
    smartass2 := 0;
  PeasantD01: 'float_msg(self_obj, message_str(372, 104), 0);

    '
  PeasantD02: 'float_msg(self_obj, message_str(372, 105), 0);

    '
  PeasantD03: |
    float_msg(self_obj, message_str(372, 106), 0);
    smartass := 1;
  PeasantD04: 'float_msg(self_obj, message_str(372, 107), 0);

    '
pensmell:
  start: |
    if (script_action == 2) then begin
      call spatial_p_proc;
    end
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (local_var(0) == 0) then begin
        display_msg(message_str(128, 100));
        set_local_var(0, 1);
      end
    end
pernpwr:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      if ((global_var(74) == 2) and is_success(do_check(dude_obj, 1, 0))) then begin
        display_msg(message_str(297, 100));
      end
      else begin
        display_msg(message_str(297, 101));
      end
    end
    else begin
      if (script_action == 8) then begin
        script_overrides;
        if (action_being_used == 7) then begin
          if (is_success(roll_vs_skill(dude_obj, 7, 0))) then begin
            display_msg(message_str(297, 102));
          end
          else begin
            display_msg(message_str(297, 103));
          end
        end
        else begin
          display_msg(message_str(297, 104));
        end
      end
    end
peter:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 46);
      critter_add_trait(self_obj, 1, 5, 33);
      initialized := 1;
      if (global_var(129) == 2) then begin
        if (random(0, 1)) then begin
          kill_critter(self_obj, 59);
        end
        else begin
          kill_critter(self_obj, 57);
        end
      end
    end
    else begin
      if (script_action == 18) then begin
        call destroy_p_proc;
      end
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 11) then begin
        call talk_p_proc;
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    if (local_var(0)) then begin
      script_overrides;
      display_msg(message_str(267, 100));
    end
  talk_p_proc: |
    set_local_var(0, 1);
    script_overrides;
    if (global_var(133) == 1) then begin
      call peter9;
    end
    else begin
      if (global_var(133) == 2) then begin
        call peter10;
      end
      else begin
        if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
          start_gdialog(267, self_obj, 4, -1, -1);
          gsay_start;
          call peter0;
          gsay_end;
          end_dialogue;
        end
        else begin
          call peter8;
        end
      end
    end
  peter0: |
    gsay_reply(267, 101);
    giq_option(-3, 267, 102, peter1, 50);
    giq_option(4, 267, 103, peterend, 50);
    giq_option(4, 267, 104, peter2, 50);
    giq_option(4, 267, 105, peter7, 50);
  peter1: 'gsay_message(267, 106, 50);

    '
  peter2: |
    gsay_reply(267, 107);
    giq_option(4, 267, 108, peter3, 50);
    giq_option(4, 267, 109, peter4, 50);
    giq_option(4, 267, 110, peter6, 50);
  peter3: 'gsay_message(267, 111, 50);

    '
  peter4: |
    gsay_reply(267, 112);
    giq_option(4, 267, 113, peter4a, 50);
    giq_option(4, 267, 114, peter5, 50);
  peter4a: 'set_global_var(133, 1);

    '
  peter5: 'gsay_message(267, 115, 50);

    '
  peter6: |
    gsay_reply(267, 116);
    giq_option(4, 267, 117, peter4a, 50);
    giq_option(4, 267, 118, peter5, 50);
  peter7: 'gsay_message(267, 119, 50);

    '
  peter8: 'float_msg(self_obj, message_str(267, 120), 0);

    '
  peter9: 'float_msg(self_obj, message_str(267, 121), 0);

    '
  peter10: |
    variable LVar0 := 0;
    float_msg(self_obj, message_str(267, 122), 0);
    if (local_var(1) == 0) then begin
      set_local_var(1, 1);
      LVar0 := create_object_sid(40, 0, 0, -1);
      add_obj_to_inven(dude_obj, LVar0);
      LVar0 := create_object_sid(40, 0, 0, -1);
      add_obj_to_inven(dude_obj, LVar0);
      LVar0 := create_object_sid(40, 0, 0, -1);
      add_obj_to_inven(dude_obj, LVar0);
    end
  peterend: "[]"
petrox:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 6);
      critter_add_trait(self_obj, 1, 5, 20);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(139, 100));
  talk_p_proc: |
    if (global_var(116) == 1) then begin
      float_msg(self_obj, message_str(136, random(102, 106)), 8);
    end
    else begin
      call do_dialogue;
    end
  pickup_p_proc: 'HOSTILE := 1;

    '
  critter_p_proc: |
    call Critter_Action;
    if (HOSTILE) then begin
      HOSTILE := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    set_global_var(254, 1);
    set_global_var(611, 0);
    set_global_var(115, global_var(115) - 1);
  damage_p_proc: |
    if (global_var(116) == 0) then begin
      set_global_var(254, 1);
    end
  do_dialogue: |
    set_local_var(3, 1);
    call get_reaction;
    start_gdialog(139, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4) == 5) then begin
      call petrox10;
    end
    else begin
      set_local_var(4, local_var(4) + 1);
      call petrox00;
    end
    gsay_end;
    end_dialogue;
  petrox00: |
    gsay_reply(139, 101);
    giq_option(4, 139, message_str(139, 102) + proto_data(obj_pid(dude_obj), 1) + message_str(139, 103), petrox01, 50);
    giq_option(5, 139, 104, petrox02, 50);
    giq_option(-3, 139, 105, petrox03, 50);
  petrox01: |
    gsay_reply(139, 106);
    giq_option(4, 139, 107, petrox04, 50);
    giq_option(4, 139, 108, petroxend, 50);
    giq_option(4, 139, 109, petrox05, 50);
  petrox02: |
    gsay_reply(139, 110);
    giq_option(4, 139, 111, petrox07, 50);
    giq_option(4, 139, 112, petrox08, 50);
  petrox03: 'gsay_message(139, 113, 50);

    '
  petrox04: |
    gsay_reply(139, 114);
    giq_option(4, 139, 115, petrox06, 50);
    giq_option(4, 139, 116, petroxend, 50);
  petrox05: |
    gsay_reply(139, 117);
    giq_option(4, 139, 118, petrox07, 50);
    giq_option(4, 139, 119, petrox08, 50);
  petrox06: |
    gsay_message(139, 120, 50);
    call combat;
  petrox07: |
    gsay_reply(139, 121);
    giq_option(4, 139, 122, petrox08, 50);
  petrox08: |
    if (get_critter_stat(dude_obj, 34) == 1) then begin
      gsay_reply(139, 124);
      giq_option(4, 139, 125, petrox09, 50);
      giq_option(4, 139, 127, petrox09, 50);
    end
    else begin
      gsay_message(139, 123, 50);
    end
  petrox09: 'gsay_message(139, 126, 50);

    '
  petrox10: 'gsay_message(139, 128, 50);

    '
  petroxend: "[]"
  combat: |
    if (global_var(116) == 1) then begin
      critter_add_trait(self_obj, 1, 6, 87);
    end
    HOSTILE := 1;
  Critter_Action: |
    variable LVar0 := 0;
    if (global_var(26) == 2) then begin
      set_global_var(254, 1);
    end
    else begin
      if (global_var(116)) then begin
        set_global_var(254, 0);
        if (tile_distance_objs(self_obj, dude_obj) < 3) then begin
          LVar0 := tile_num_in_direction(tile_num(self_obj), random(0, 5), 3);
          if (tile_distance(tile_num(self_obj), LVar0) > 2) then begin
            if (random(0, 9) == 0) then begin
              float_msg(self_obj, message_str(136, random(102, 106)), 8);
            end
            animate_move_obj_to_tile(self_obj, LVar0, 0);
          end
        end
      end
      else begin
        if (global_var(213)) then begin
          set_global_var(254, 1);
        end
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          if (global_var(214)) then begin
            set_global_var(254, 1);
          end
        end
        if (map_var(2) == 1) then begin
          set_global_var(254, 1);
        end
      end
    end
    if (global_var(254) and obj_can_see_obj(self_obj, dude_obj)) then begin
      HOSTILE := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      HOSTILE := 0;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
phil:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (map_var(9) == 1) then begin
      call run_away;
    end
    if (map_var(6) == 1) then begin
      add_timer_event(self_obj, game_ticks(2), 2);
      set_map_var(6, 0);
    end
    if (map_var(5) == 0) then begin
      animate_move_obj_to_tile(self_obj, home_tile, 0);
      if (anim_busy(self_obj) == 0) then begin
        anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), home_tile));
      end
    end
    if (global_var(628) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(628, 1);
      set_global_var(247, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(352, 100));
    end
    else begin
      display_msg(message_str(352, 101));
    end
  map_enter_p_proc: |
    critter_add_trait(self_obj, 1, 6, 16);
    if (map_var(5) == 1) then begin
      add_timer_event(self_obj, game_ticks(10), 1);
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (global_var(5)) then begin
      call Phil01;
    end
    else begin
      if (not(map_var(5))) then begin
        call Phil09;
      end
      else begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
          call Phil00;
        end
        else begin
          if (local_var(4) == 0) then begin
            start_gdialog(352, self_obj, 4, -1, -1);
            gsay_start;
            call Phil02;
            gsay_end;
            end_dialogue;
          end
          else begin
            call Phil08;
          end
        end
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 2) then begin
      float_msg(self_obj, message_str(352, 102), 0);
    end
    else begin
      if (map_var(5)) then begin
        call go_forward;
      end
    end
  run_away: |
    animate_move_obj_to_tile(self_obj, 31096, 1);
    set_map_var(9, 0);
    add_timer_event(self_obj, game_ticks(random(10, 30)), 1);
  go_forward: |
    set_map_var(8, 1);
    animate_move_obj_to_tile(self_obj, 30889, 0);
  Phil00: 'float_msg(self_obj, message_str(352, 103), 0);

    '
  Phil01: 'float_msg(self_obj, message_str(352, 104), 0);

    '
  Phil02: |
    variable LVar0 := 0;
    set_local_var(4, 1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      LVar0 := message_str(352, 105);
    end
    else begin
      LVar0 := message_str(352, 106);
    end
    gsay_reply(352, LVar0 + message_str(352, 107));
    giq_option(4, 352, 108, Phil04, 50);
    giq_option(4, 352, 109, PhilEnd, 50);
    giq_option(6, 352, 110, Phil05, 50);
    giq_option(-3, 352, 111, Phil03, 50);
  Phil03: 'gsay_message(352, 112, 50);

    '
  Phil04: |
    gsay_reply(352, 113);
    giq_option(4, 352, 114, PhilEnd, 50);
    giq_option(4, 352, 115, Phil05, 50);
  Phil05: |
    gsay_reply(352, 116);
    giq_option(4, 352, 117, PhilEnd, 50);
    giq_option(5, 352, 118, Phil06, 50);
    giq_option(6, 352, 119, Phil07, 50);
  Phil06: |
    gsay_message(352, 120, 50);
    gsay_reply(352, 121);
    call Goodbyes;
    giq_option(7, 352, 122, Phil07, 50);
    giq_option(4, 634, exit_line, PhilEnd, 50);
  Phil07: |
    gsay_message(352, 123, 50);
    gsay_reply(352, 124);
    giq_option(4, 352, 125, PhilEnd, 50);
  Phil08: 'float_msg(self_obj, message_str(352, 126), 0);

    '
  Phil09: 'float_msg(self_obj, message_str(352, 127), 0);

    '
  PhilEnd: "[]"
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
pleasant:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 6);
      add_timer_event(self_obj, game_ticks(random(15, 60)), 1);
      add_timer_event(self_obj, game_ticks(random(3, 5)), 1);
      initialized := 1;
    end
  combat_p_proc: |
    if (fixed_param == 4) then begin
      round_counter := round_counter + 1;
      if (round_counter > 3) then begin
        if ((global_var(246) == 0) and ((cur_map_index == 26) or (cur_map_index == 25))) then begin
          set_global_var(246, 1);
          set_global_var(155, global_var(155) - 5);
        end
      end
    end
  critter_p_proc: |
    variable LVar0 := 0;
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if ((global_var(246) == 1) and ((cur_map_index == 26) or (cur_map_index == 25))) then begin
        hostile := 1;
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(0)) then begin
        if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
          call flee_dude;
        end
      end
    end
    LVar0 := global_var(343);
    if ((((game_time / 10) - LVar0) >= 10) and (tile_distance_objs(self_obj, dude_obj) <= 4) and (global_var(246) == 0) and ((cur_map_index == 26) or (cur_map_index == 25))) then begin
      float_msg(self_obj, message_str(115, random(110, 114)), 0);
      LVar0 := game_time / 10;
      set_global_var(343, LVar0);
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(0, 1);
    end
  destroy_p_proc: |
    if ((source_obj == dude_obj) and ((cur_map_index == 26) or (cur_map_index == 25))) then begin
      set_global_var(246, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(9, 100));
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (local_var(0) or global_var(246)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 0);
    end
    else begin
      if (global_var(43) == 2) then begin
        float_msg(self_obj, message_str(9, random(101, 104)), 0);
      end
      else begin
        float_msg(self_obj, message_str(9, random(101, 107)), 0);
      end
    end
  timed_event_p_proc: |
    if (obj_on_screen(self_obj)) then begin
      animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), random(0, 5), random(1, 5)), 0);
    end
    add_timer_event(self_obj, game_ticks(random(6, 10)), 1);
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 1);
powermut:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(838, 101));
  talk_p_proc: 'float_msg(self_obj, message_str(838, 100), 2);

    '
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      else begin
        if (global_var(146)) then begin
          hostile := 1;
        end
      end
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      initialized := 1;
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 48);
    end
prisonr:
  start: |
    if (not(init_teams)) then begin
      init_teams := 1;
      if (local_var(3) > 9) then begin
        set_obj_visibility(self_obj, 1);
      end
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 40);
    end
    if (local_var(3) < 10) then begin
      if (script_action == 22) then begin
        call timeforwhat;
      end
      else begin
        if (script_action == 11) then begin
          if (local_var(1) == 0) then begin
            call do_dialogue;
          end
          else begin
            float_msg(self_obj, message_str(89, 126), 2);
          end
        end
        else begin
          if ((script_action == 21) or (script_action == 3)) then begin
            script_overrides;
            display_msg(message_str(89, 100));
          end
          else begin
            if (script_action == 4) then begin
              Hostile := 1;
            end
            else begin
              if (script_action == 12) then begin
                if (map_var(6) != 0) then begin
                  if (local_var(1) == 1) then begin
                    call leave_map;
                  end
                  else begin
                    if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 5)) then begin
                      dialogue_system_enter;
                    end
                  end
                end
                else begin
                  if (Hostile) then begin
                    Hostile := 0;
                    attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
                  end
                end
              end
              else begin
                if (script_action == 18) then begin
                  if (source_obj == dude_obj) then begin
                    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                      set_global_var(156, 1);
                      set_global_var(157, 0);
                    end
                    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                      set_global_var(157, 1);
                      set_global_var(156, 0);
                    end
                    set_global_var(159, global_var(159) + 1);
                    if ((global_var(159) % 2) == 0) then begin
                      set_global_var(155, global_var(155) - 1);
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  timeforwhat: |
    if (fixed_param == 1) then begin
      Hostile := 1;
    end
  do_dialogue: |
    start_gdialog(89, self_obj, 4, -1, -1);
    gsay_start;
    if (map_var(6) != 0) then begin
      call prisonr06;
    end
    else begin
      if (local_var(0)) then begin
        call prisonr05;
      end
      else begin
        set_local_var(0, 1);
        call prisonr00;
      end
    end
    gsay_end;
    end_dialogue;
  prisonrcbt: 'add_timer_event(self_obj, game_ticks(2), 1);

    '
  prisonrend: "[]"
  prisonr00: |
    gsay_reply(89, 101);
    giq_option(4, 89, 102, prisonrend, 50);
    giq_option(-3, 89, 103, prisonr01, 50);
    giq_option(4, 89, 104, prisonr02, 50);
    giq_option(6, 89, 105, prisonr03, 50);
  prisonr01: 'gsay_message(89, 106, 50);

    '
  prisonr02: 'gsay_message(89, 107, 50);

    '
  prisonr03: |
    gsay_reply(89, 108);
    giq_option(6, 89, 109, prisonr04, 50);
    giq_option(6, 89, 110, prisonr02, 50);
  prisonr04: |
    gsay_reply(89, 111);
    giq_option(6, 89, 112, prisonr02, 50);
    giq_option(6, 89, 113, prisonrend, 50);
  prisonr05: 'gsay_message(89, 114, 50);

    '
  prisonr06: |
    set_local_var(2, 15863);
    set_local_var(3, 0);
    set_local_var(1, 1);
    give_exp_points(500);
    display_msg(message_str(89, 124) + 500 + message_str(89, 125));
    gsay_reply(89, 115);
    giq_option(4, 89, 116, prisonrend, 50);
    giq_option(5, 89, 117, prisonr07, 50);
    giq_option(-3, 89, 118, prisonrend, 50);
  prisonr07: |
    gsay_reply(89, 119);
    giq_option(5, 89, 120, prisonr08, 50);
    giq_option(5, 89, 121, prisonrend, 50);
  prisonr08: |
    gsay_reply(89, 122);
    giq_option(5, 89, 123, prisonrend, 50);
  leave_map: |
    my_hex := tile_num(self_obj);
    if (my_hex == local_var(2)) then begin
      set_local_var(3, local_var(3) + 1);
      if (local_var(3) > 7) then begin
        set_global_var(155, global_var(155) + 1);
        set_local_var(3, 10);
        set_obj_visibility(self_obj, 1);
        move_to(self_obj, 0, 0);
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(2, 15863);
        end
        else begin
          if (local_var(3) == 2) then begin
            set_local_var(2, 13065);
          end
          else begin
            if (local_var(3) == 3) then begin
              set_local_var(2, 13081);
            end
            else begin
              if (local_var(3) == 4) then begin
                set_local_var(2, 14496);
              end
              else begin
                if (local_var(3) == 5) then begin
                  set_local_var(2, 11900);
                end
                else begin
                  if (local_var(3) == 6) then begin
                    set_local_var(2, 8700);
                  end
                  else begin
                    if (local_var(3) == 7) then begin
                      set_local_var(2, 5900);
                    end
                  end
                end
              end
            end
          end
        end
        animate_move_obj_to_tile(self_obj, local_var(2), 0);
      end
    end
    animate_move_obj_to_tile(self_obj, local_var(2), 0);
radio:
  start: "[]"
  talk_p_proc: |
    if (cur_map_index == 30) then begin
      call RadioEnt;
    end
    else begin
      if (cur_map_index == 31) then begin
        if (elevation(dude_obj) == 0) then begin
          call RadioStrg1;
        end
        else begin
          call RadioStrg2;
        end
      end
      else begin
        if (cur_map_index == 32) then begin
          if (elevation(dude_obj) == 0) then begin
            call RadioVats1;
          end
          else begin
            call Radio08;
          end
        end
        else begin
          call Radio08;
        end
      end
    end
    if (GVar1) then begin
      GVar1 := 0;
      display_msg(message_str(361, 139));
      give_exp_points(1500);
    end
  use_p_proc: |
    if (cur_map_index == 30) then begin
      dialogue_system_enter;
    end
    else begin
      if (cur_map_index == 31) then begin
        if (elevation(dude_obj) == 0) then begin
          call RadioStrg1;
        end
        else begin
          call RadioStrg2;
        end
      end
      else begin
        if (cur_map_index == 32) then begin
          if (elevation(dude_obj) == 0) then begin
            call RadioVats1;
          end
          else begin
            call Radio08;
          end
        end
        else begin
          call Radio08;
        end
      end
    end
  Radio01: |
    set_map_var(0, 1);
    GVar1 := 1;
    gsay_message(361, 106, 0);
  Radio02: |
    gsay_reply(361, 107);
    giq_option(4, 361, 108, RadioAlert, 0);
    giq_option(5, 361, 109, Radio04, 0);
    giq_option(4, 361, 110, Radio02a, 0);
  Radio02a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Radio06;
    end
    else begin
      call Radio04;
    end
  Radio03: |
    gsay_reply(361, 111);
    giq_option(6, 361, 112, Radio04, 0);
    giq_option(6, 361, 113, Radio05, 0);
    giq_option(6, 361, 114, Radio03a, 0);
  Radio03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Radio05;
    end
    else begin
      call Radio04;
    end
  Radio04: |
    set_global_var(146, 1);
    gsay_message(361, 115, 0);
  Radio05: |
    set_map_var(0, 1);
    GVar1 := 1;
    gsay_message(361, 116, 0);
  Radio06: |
    set_map_var(0, 1);
    GVar1 := 1;
    gsay_message(361, 117, 0);
  Radio07: |
    set_map_var(0, 1);
    GVar1 := 1;
    gsay_message(361, 118, 0);
  Radio08: 'display_msg(message_str(361, 119));

    '
  Radio11: |
    variable LVar0 := 0;
    LVar0 := message_str(361, 121);
    if (is_success(do_check(dude_obj, 4, 0))) then begin
      LVar0 := LVar0 + message_str(361, 122);
    end
    display_msg(LVar0);
  Radio12: |
    if (global_var(262) == 0) then begin
      set_global_var(262, 1);
    end
    else begin
      set_global_var(262, 0);
    end
    display_msg(message_str(361, 123));
  Radio13: 'display_msg(message_str(361, 124));

    '
  Radio14: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (get_critter_stat(dude_obj, 4) > get_critter_stat(dude_obj, 1)) then begin
      LVar0 := 4;
    end
    else begin
      LVar0 := 1;
    end
    LVar1 := message_str(361, 125);
    if (is_success(do_check(dude_obj, LVar0, 0))) then begin
      LVar1 := LVar1 + message_str(361, 126);
    end
    display_msg(LVar1);
  Radio21: |
    if (global_var(262) == 0) then begin
      set_global_var(262, 1);
    end
    else begin
      set_global_var(262, 0);
    end
  Radio22: 'display_msg(message_str(361, 127));

    '
  Radio23: |
    gsay_reply(361, 128);
    giq_option(-3, 361, 129, Radio24, 0);
    giq_option(4, 361, 130, Radio23a, 0);
  Radio23a: |
    if (local_var(1) or not(is_success(roll_vs_skill(dude_obj, 14, 10)))) then begin
      call Radio24;
    end
    else begin
      call Radio25;
    end
  Radio24: |
    set_global_var(146, 1);
    gsay_message(361, 131, 0);
  Radio25: |
    set_local_var(1, 1);
    gsay_message(361, 132, 0);
  Radio31: |
    if (global_var(262) == 0) then begin
      set_global_var(262, 1);
    end
    else begin
      set_global_var(262, 0);
    end
    display_msg(message_str(361, 123));
  Radio36: |
    gsay_reply(361, 133);
    giq_option(-3, 361, 134, Radio37, 0);
    giq_option(4, 361, 135, Radio37, 0);
    if (map_var(6)) then begin
      giq_option(4, 361, 136, Radio36a, 0);
    end
    giq_option(4, 361, 137, RadioEnd, 0);
  Radio36a: 'set_map_var(7, 0);

    '
  Radio37: |
    gsay_message(361, 138, 0);
    set_local_var(0, 1);
  RadioEnd: "[]"
  RadioAlert: 'set_global_var(146, 1);

    '
  RadioEnt: |
    if (map_var(2)) then begin
      call Radio08;
    end
    else begin
      set_map_var(2, 1);
      start_gdialog(361, self_obj, 4, -1, -1);
      gsay_start;
      gsay_reply(361, 101);
      giq_option(-3, 361, 102, Radio01, 0);
      giq_option(4, 361, 103, Radio02, 0);
      giq_option(5, 361, 104, Radio03, 0);
      giq_option(6, 361, 105, Radio07, 0);
      gsay_end;
      end_dialogue;
    end
  RadioStrg1: |
    if (global_var(608)) then begin
      call Radio14;
    end
    else begin
      if (global_var(610)) then begin
        call Radio12;
      end
      else begin
        if (global_var(146)) then begin
          if (map_var(12) == 3) then begin
            call Radio13;
          end
          else begin
            call Radio11;
          end
        end
      end
    end
  RadioStrg2: |
    if (global_var(608)) then begin
      call Radio14;
    end
    else begin
      if (global_var(610)) then begin
        call Radio21;
      end
      else begin
        if (global_var(146)) then begin
          call Radio22;
        end
        else begin
          call Radio23;
        end
      end
    end
  RadioVats1: |
    if (global_var(608)) then begin
      call Radio12;
    end
    else begin
      if (map_var(6) and map_var(7) and not(local_var(0))) then begin
        call Radio36;
      end
      else begin
        if (global_var(610)) then begin
          call Radio31;
        end
        else begin
          if (global_var(146)) then begin
            call Radio22;
          end
          else begin
            call Radio23;
          end
        end
      end
    end
radiocom:
  start: |
    if (not(initialized)) then begin
      radio_computer := self_obj;
      initialized := 1;
    end
    else begin
      if (script_action == 3) then begin
        call description_p_proc;
      end
      else begin
        if (script_action == 6) then begin
          call use_p_proc;
        end
      end
    end
  description_p_proc: |
    variable LVar0 := 0;
    LVar0 := message_str(607, 100);
    if (is_success(do_check(dude_obj, 1, has_trait(0, dude_obj, 0)))) then begin
      if (global_var(608)) then begin
        LVar0 := LVar0 + message_str(607, 101);
      end
      else begin
        LVar0 := LVar0 + message_str(607, 102);
      end
    end
    display_msg(LVar0);
  use_p_proc: |
    if (source_obj == dude_obj) then begin
      if (is_success(roll_vs_skill(dude_obj, 12, 0))) then begin
        if (global_var(608)) then begin
          display_msg(message_str(607, 103));
          set_global_var(608, 0);
        end
        else begin
          display_msg(message_str(607, 104));
          set_global_var(608, 1);
        end
      end
      else begin
        display_msg(message_str(607, 105));
      end
    end
    else begin
      set_global_var(608, 1);
    end
radscorp:
  start: |
    if (script_action == 13) then begin
      call combat_p_proc;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 8) then begin
            call use_skill_on_p_proc;
          end
        end
      end
    end
  combat_p_proc: |
    if (fixed_param == 2) then begin
      if (target_obj == dude_obj) then begin
        if (not(is_success(do_check(dude_obj, 6, -1)))) then begin
          poison(target_obj, random(1, 6));
        end
      end
    end
  critter_p_proc: |
    variable LVar0 := 0;
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 5, 14);
      critter_add_trait(self_obj, 1, 6, 5);
      add_timer_event(self_obj, game_ticks(random(1, 5)), 1);
      initialized := 1;
    end
    else begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      else begin
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          if (has_trait(0, dude_obj, 44) == 0) then begin
            hostile := 1;
          end
        end
      end
    end
  destroy_p_proc: |
    variable LVar0 := 0;
    if (cur_map_index == 83) then begin
      set_global_var(2, global_var(2) - 1);
      if (global_var(2) < 0) then begin
        set_global_var(2, 0);
      end
    end
    LVar0 := create_object_sid(92, 0, 0, -1);
    add_obj_to_inven(self_obj, LVar0);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  timed_event_p_proc: |
    if (not(combat_is_initialized)) then begin
      critter_tile := tile_num_in_direction(tile_num(self_obj), random(0, 5), 3);
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_obj_move_to_tile(self_obj, critter_tile, -1);
      reg_anim_func(3, 0);
    end
    add_timer_event(self_obj, game_ticks(random(3, 5)), 1);
  use_skill_on_p_proc: |
    if (action_being_used == 10) then begin
      script_overrides;
    end
rae:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (local_var(5) == 1) then begin
      if (tile_distance_objs(self_obj, dude_obj) > 8) then begin
        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 1), 1);
      end
      else begin
        if (random(1, 100) == 1) then begin
          animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), random(0, 5), random(3, 6)), 0);
          add_timer_event(self_obj, game_ticks(6), 1);
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(688, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4) == 0) then begin
      call rae00;
    end
    else begin
      call rae01;
    end
    if (local_var(5) == 1) then begin
      call rae15;
    end
    set_local_var(4, 1);
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    party_remove(self_obj);
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(688, 100));
  map_enter_p_proc: |
    if (local_var(5) == 1) then begin
      if ((cur_map_index == 6) or (cur_map_index == 10) or (cur_map_index == 11) or (cur_map_index == 12) or (cur_map_index == 13) or (cur_map_index == 14) or (cur_map_index == 15) or (cur_map_index == 25) or (cur_map_index == 26) or (cur_map_index == 28) or (cur_map_index == 29) or (cur_map_index == 35) or (cur_map_index == 36) or (cur_map_index == 38) or (cur_map_index == 39) or (cur_map_index == 40) or (cur_map_index == 41) or (cur_map_index == 44) or (cur_map_index == 46)) then begin
        set_obj_visibility(self_obj, 1);
      end
      else begin
        set_obj_visibility(self_obj, 0);
      end
    end
  special_end: |
    gfade_out(600);
    set_obj_visibility(self_obj, 1);
    gfade_in(600);
    float_msg(dude_obj, message_str(688, 179), 9);
    give_exp_points(700);
    display_msg(message_str(688, 176));
    if (global_var(55) == 0) then begin
      set_global_var(55, game_time / 10);
    end
    set_global_var(18, 1);
    if (global_var(17) == 0) then begin
      set_global_var(51, 1);
    end
  raejoin: |
    set_local_var(5, 1);
    party_add(self_obj);
    float_msg(dude_obj, message_str(688, 178), 3);
    give_exp_points(1000);
    display_msg(message_str(688, 177));
  raetym: 'add_timer_event(self_obj, game_ticks(15), 1);

    '
  rae00: |
    gsay_reply(688, 102);
    giq_option(7, 688, 103, rae02, 50);
    giq_option(4, 688, 104, rae00a, 50);
    giq_option(4, 688, 105, rae00b, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 688, 106, combat, 50);
    end
    giq_option(4, 688, 107, dialog_end, 50);
    giq_option(-3, 688, 108, dialog_end, 50);
  rae00a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call rae08;
    end
    else begin
      call rae12;
    end
  rae00b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -35))) then begin
      call rae02;
    end
    else begin
      call rae12;
    end
  rae01: |
    gsay_reply(688, 109);
    giq_option(7, 688, 110, rae01a, 50);
    giq_option(4, 688, 111, dialog_end, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 688, 112, combat, 50);
    end
    giq_option(4, 688, 113, rae02, 50);
    giq_option(4, 688, 114, dialog_end, 50);
  rae01a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -35))) then begin
      call rae03;
    end
    else begin
      call rae05;
    end
  rae02: |
    gsay_reply(688, 115);
    giq_option(8, 688, 116, rae03, 50);
    giq_option(7, 688, 117, rae03, 50);
    giq_option(4, 688, 118, rae04, 50);
    giq_option(4, 688, 119, rae08, 50);
    giq_option(4, 688, 120, rae05, 50);
  rae03: |
    gsay_reply(688, 121);
    giq_option(8, 688, 122, rae04, 50);
    giq_option(7, 688, 123, rae03a, 50);
    giq_option(4, 688, 124, rae03b, 50);
    giq_option(4, 688, 125, rae03c, 50);
  rae03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call rae04;
    end
    else begin
      call rae08;
    end
  rae03b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -35))) then begin
      call rae05;
    end
    else begin
      call rae08;
    end
  rae03c: |
    if (is_success(roll_vs_skill(dude_obj, 14, -40))) then begin
      call rae08;
    end
    else begin
      call rae12;
    end
  rae04: |
    gsay_reply(688, 126);
    giq_option(8, 688, 127, rae04a, 50);
    giq_option(4, 688, 128, rae12, 50);
    giq_option(4, 688, 129, rae04b, 50);
    giq_option(4, 688, 130, rae04c, 50);
  rae04a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -25))) then begin
      call rae05;
    end
    else begin
      call rae08;
    end
  rae04b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call rae05;
    end
    else begin
      call rae08;
    end
  rae04c: |
    if (is_success(roll_vs_skill(dude_obj, 14, -35))) then begin
      call rae08;
    end
    else begin
      call rae12;
    end
  rae05: |
    gsay_reply(688, 131);
    giq_option(9, 688, 132, rae06, 50);
    giq_option(8, 688, 133, rae05a, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 688, 134, combat, 50);
    end
    giq_option(4, 688, 135, rae05b, 50);
    giq_option(4, 688, 136, rae07, 50);
    giq_option(4, 688, 137, dialog_end, 50);
  rae05a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -25))) then begin
      call rae08;
    end
    else begin
      call rae12;
    end
  rae05b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -35))) then begin
      call rae06;
    end
    else begin
      call rae12;
    end
  rae06: |
    gsay_reply(688, 138);
    giq_option(9, 688, 139, rae07, 50);
    giq_option(7, 688, 140, rae06a, 50);
    giq_option(4, 688, 141, rae06b, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 688, 142, rae06c, 50);
    end
  rae06a: |
    if (has_skill(dude_obj, 14) < 100) then begin
      call rae12;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
        call rae14;
      end
      else begin
        call rae10;
      end
    end
  rae06b: |
    if (has_skill(dude_obj, 14) < 100) then begin
      call rae12;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, -40))) then begin
        call rae11;
      end
      else begin
        call rae08;
      end
    end
  rae06c: |
    if (has_skill(dude_obj, 14) < 100) then begin
      call rae12;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
        call rae14;
      end
      else begin
        call rae10;
      end
    end
  rae07: |
    gsay_reply(688, 143);
    giq_option(9, 688, 144, rae11, 50);
    giq_option(7, 688, 145, rae08, 50);
    giq_option(4, 688, 146, rae07a, 50);
    giq_option(4, 688, 147, rae07b, 50);
    giq_option(4, 688, 148, rae07c, 50);
  rae07a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -25))) then begin
      call rae08;
    end
    else begin
      call rae12;
    end
  rae07b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call rae10;
    end
    else begin
      call rae12;
    end
  rae07c: |
    if (is_success(roll_vs_skill(dude_obj, 14, -25))) then begin
      call dialog_end;
    end
    else begin
      call rae12;
    end
  rae08: |
    gsay_reply(688, 149);
    giq_option(8, 688, 150, rae13, 50);
    giq_option(7, 688, 151, rae08a, 50);
    giq_option(4, 688, 152, rae08b, 50);
    giq_option(4, 688, 153, rae08c, 50);
    giq_option(4, 688, 154, dialog_end, 50);
  rae08a: |
    if (has_skill(dude_obj, 14) < 100) then begin
      call rae12;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
        call rae14;
      end
      else begin
        call rae10;
      end
    end
  rae08b: |
    if (has_skill(dude_obj, 14) < 100) then begin
      call rae12;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
        call rae11;
      end
      else begin
        call rae10;
      end
    end
  rae08c: |
    if (has_skill(dude_obj, 14) < 100) then begin
      call rae12;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, -35))) then begin
        call rae13;
      end
      else begin
        call rae10;
      end
    end
  rae09: |
    gsay_message(688, 155, 50);
    call raejoin;
  rae10: |
    gsay_reply(688, 156);
    giq_option(4, 688, 157, dialog_end, 50);
    giq_option(4, 688, 158, rae10a, 50);
    giq_option(4, 688, 159, rae11, 50);
  rae10a: |
    if (has_skill(dude_obj, 14) < 100) then begin
      call rae12;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
        call rae14;
      end
      else begin
        call rae10;
      end
    end
  rae11: |
    gsay_reply(688, 160);
    giq_option(9, 688, 161, rae13, 50);
    giq_option(7, 688, 162, rae11a, 50);
    giq_option(4, 688, 163, rae11b, 50);
    giq_option(4, 688, 164, dialog_end, 50);
  rae11a: |
    if (has_skill(dude_obj, 14) < 100) then begin
      call rae08;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, -25))) then begin
        call rae13;
      end
      else begin
        call rae10;
      end
    end
  rae11b: |
    if (has_skill(dude_obj, 14) < 100) then begin
      call rae10;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, -35))) then begin
        call rae13;
      end
      else begin
        call rae12;
      end
    end
  rae12: |
    gsay_message(688, 165, 50);
    call raetym;
  rae13: |
    gsay_reply(688, 166);
    giq_option(9, 688, 167, rae13b, 50);
    giq_option(7, 688, 168, rae13a, 50);
    giq_option(4, 688, 169, rae13b, 50);
    giq_option(4, 688, 170, dialog_end, 50);
    giq_option(4, 688, 171, rae13c, 50);
  rae13a: |
    if (has_skill(dude_obj, 14) < 100) then begin
      call rae12;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
        call rae14;
      end
      else begin
        call rae10;
      end
    end
  rae13b: |
    if (has_skill(dude_obj, 14) < 100) then begin
      call rae12;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, -25))) then begin
        call rae14;
      end
      else begin
        call rae10;
      end
    end
  rae13c: |
    if (has_skill(dude_obj, 14) < 100) then begin
      call rae12;
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
        call rae14;
      end
      else begin
        call rae10;
      end
    end
  rae14: |
    gsay_reply(688, 172);
    giq_option(4, 688, 173, special_end, 50);
    giq_option(4, 688, 174, rae09, 50);
  rae15: |
    gsay_reply(688, 180);
    giq_option(4, 688, 137, dialog_end, 50);
  dialog_end: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
raidgrd:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 6);
      critter_add_trait(self_obj, 1, 5, 21);
      initialized := 1;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(240, 101));
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
        call combat;
      end
    end
    else begin
      if (fixed_param == 2) then begin
        if (tile_distance_objs(self_obj, dude_obj) < 6) then begin
          call combat;
        end
      end
      else begin
        if (fixed_param == 3) then begin
          if (tile_distance_objs(self_obj, dude_obj) < 8) then begin
            call combat;
          end
        end
      end
    end
  talk_p_proc: |
    if (local_var(5) == 1) then begin
      display_msg(message_str(240, 100));
    end
    else begin
      call do_dialogue;
    end
  pickup_p_proc: 'hostile := 1;

    '
  critter_p_proc: |
    call Critter_Action;
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (obj_can_see_obj(self_obj, dude_obj) and (global_var(611) != 1)) then begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) and ((Weapons == 0) and (killing_women == 0))) then begin
          Weapons := 1;
          dialogue_system_enter;
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    set_global_var(254, 1);
    set_global_var(611, 0);
    set_global_var(115, global_var(115) - 1);
  damage_p_proc: |
    if (global_var(116) == 0) then begin
      set_global_var(254, 1);
    end
  do_dialogue: |
    if (global_var(116) == 1) then begin
      call guard00;
    end
    else begin
      if ((Weapons == 1) and (killing_women == 0) and (global_var(611) != 1)) then begin
        call guard02;
      end
      else begin
        call sys_dialog;
      end
    end
  sys_dialog: |
    set_local_var(3, 1);
    call get_reaction;
    start_gdialog(240, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4) == 0) then begin
      set_local_var(4, 1);
      call guard04;
    end
    else begin
      call guard15;
    end
    gsay_end;
    end_dialogue;
  guard00: 'float_msg(self_obj, message_str(240, random(102, 106)), 8);

    '
  guard02: |
    float_msg(self_obj, message_str(240, random(112, 115)), 8);
    add_timer_event(self_obj, game_ticks(9), 1);
  guard04: |
    gsay_reply(240, 119);
    if ((global_var(103) == 1) and (global_var(218) == 1)) then begin
      giq_option(4, 240, 120, guard07, 50);
    end
    giq_option(4, 240, 121, guard06, 50);
    giq_option(-3, 240, 122, guard05, 50);
  guard05: 'gsay_message(240, 123, 50);

    '
  guard06: |
    gsay_message(240, 124, 50);
    call DownReact;
  guard07: |
    gsay_reply(240, 125);
    giq_option(4, 240, 126, guard08, 50);
    giq_option(6, 240, 127, guard07a, 50);
    if (is_success(do_check(dude_obj, 1, 0))) then begin
      giq_option(4, 240, 128, guard07b, 50);
    end
  guard07a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call guard09;
    end
    else begin
      call guard11;
    end
  guard07b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call guard12;
    end
    else begin
      call guard13;
    end
  guard08: 'gsay_message(240, 129, 50);

    '
  guard09: |
    gsay_reply(240, 130);
    giq_option(6, 240, 131, guard10, 50);
  guard10: 'gsay_message(240, 132, 50);

    '
  guard11: 'gsay_message(240, 133, 50);

    '
  guard12: |
    gsay_message(240, 134, 50);
    set_local_var(5, 1);
  guard13: |
    gsay_message(240, 135, 50);
    call combat;
  guard15: 'gsay_message(240, 137, 50);

    '
  combat: |
    if (global_var(116) == 1) then begin
      critter_add_trait(self_obj, 1, 6, 87);
    end
    hostile := 1;
  Critter_Action: |
    variable LVar0 := 0;
    if (global_var(26) == 2) then begin
      set_global_var(254, 1);
    end
    else begin
      if (global_var(116)) then begin
        set_global_var(254, 0);
        if (tile_distance_objs(self_obj, dude_obj) < 3) then begin
          LVar0 := tile_num_in_direction(tile_num(self_obj), random(0, 5), 3);
          if (tile_distance(tile_num(self_obj), LVar0) > 2) then begin
            if (random(0, 9) == 0) then begin
              float_msg(self_obj, message_str(136, random(102, 106)), 8);
            end
            animate_move_obj_to_tile(self_obj, LVar0, 0);
          end
        end
      end
      else begin
        if (global_var(213)) then begin
          set_global_var(254, 1);
        end
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          if (global_var(214)) then begin
            set_global_var(254, 1);
          end
        end
        if (map_var(2) == 1) then begin
          set_global_var(254, 1);
        end
      end
    end
    if (global_var(254) and obj_can_see_obj(self_obj, dude_obj)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
raidjack:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(971, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(971, 112));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: 'hostile := 1;

    '
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  talk_p_proc: |
    if (local_var(0) == 0) then begin
      start_gdialog(971, self_obj, 4, -1, -1);
      gsay_start;
      call prisoner00;
      gsay_end;
      end_dialogue;
    end
    else begin
      call prisoner05;
    end
  map_enter_p_proc: |
    if (global_var(633) == 0) then begin
      set_obj_visibility(self_obj, 1);
    end
    else begin
      set_obj_visibility(self_obj, 0);
      critter_add_trait(self_obj, 1, 5, 17);
    end
    if (global_var(633) == 2) then begin
      destroy_object(self_obj);
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if (local_var(0) == 1) then begin
        animate_move_obj_to_tile(self_obj, 32541, 0);
        set_global_var(633, 2);
      end
    end
    add_timer_event(self_obj, game_ticks(1), 1);
  prisoner00: |
    gsay_reply(971, 101);
    giq_option(4, 971, 102, prisoner01, 50);
    giq_option(-3, 971, 103, prisonerend, 50);
    giq_option(4, 971, 104, prisoner04, 50);
    add_timer_event(self_obj, game_ticks(1), 1);
  prisoner01: |
    gsay_reply(971, 105);
    giq_option(4, 971, 106, prisoner02, 50);
    giq_option(4, 971, 107, prisoner03, 50);
  prisoner02: |
    set_local_var(0, 1);
    give_exp_points(50);
    set_global_var(155, global_var(155) + 2);
    display_msg(message_str(971, 108));
  prisoner03: |
    set_local_var(0, 1);
    item_caps_adjust(dude_obj, 70);
    give_exp_points(50);
    display_msg(message_str(971, 109));
  prisoner04: |
    set_global_var(155, global_var(155) - 10);
    float_msg(self_obj, message_str(971, 110), 2);
    hostile := 1;
  prisoner05: 'float_msg(self_obj, message_str(971, 111), 0);

    '
  prisonerend: "[]"
raidmap:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 16) then begin
          call map_exit_p_proc;
        end
      end
    end
  map_enter_p_proc: |
    set_global_var(69, 2);
    if (metarule(14, 0)) then begin
      display_msg(message_str(194, 103));
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        if ((get_critter_stat(dude_obj, 6) > 8) and random(0, 1)) then begin
          set_global_var(116, 1);
        end
      end
    end
    if (metarule(22, 0) == 0) then begin
      if ((global_var(114) == 1) and (global_var(115) <= 12) or (global_var(115) <= 6)) then begin
        kill_critter_type(16777254, 0);
        kill_critter_type(16777235, 0);
        kill_critter_type(16777233, 0);
        kill_critter_type(16777248, 0);
        kill_critter_type(16777249, 0);
        kill_critter_type(16777243, 0);
        kill_critter_type(16777236, 0);
        kill_critter_type(16777247, 0);
        kill_critter_type(16777238, 0);
        kill_critter_type(16777253, 0);
        kill_critter_type(16777218, 0);
        kill_critter_type(16777248, 0);
      end
    end
    if (global_var(32) == 1) then begin
      override_map_start(96, 133, 0, 5);
    end
    else begin
      override_map_start(96, 133, 0, 5);
    end
    call add_party;
    call Lighting;
  map_update_p_proc: 'call Lighting;

    '
  map_exit_p_proc: |
    if ((global_var(26) == 5) and (map_var(1) != 1)) then begin
      set_map_var(1, 1);
      set_global_var(26, 5);
      set_global_var(103, 2);
      temp := (16 - global_var(115)) * 50;
      if (temp < 500) then begin
        temp := 500 - temp;
        display_msg(message_str(238, 100) + temp + message_str(238, 101));
        set_global_var(155, global_var(155) + 1);
        give_exp_points(temp);
      end
      else begin
        temp := 0;
        set_global_var(155, global_var(155) + 1);
        display_msg(message_str(238, 100) + temp + message_str(238, 101));
      end
    end
    if ((global_var(114) == 1) and (global_var(115) <= 8) or (global_var(115) <= 4)) then begin
      kill_critter_type(16777254, 0);
      kill_critter_type(16777235, 0);
      kill_critter_type(16777233, 0);
      kill_critter_type(16777248, 0);
      kill_critter_type(16777249, 0);
      kill_critter_type(16777243, 0);
      kill_critter_type(16777236, 0);
      kill_critter_type(16777247, 0);
      kill_critter_type(16777238, 0);
      kill_critter_type(16777253, 0);
      kill_critter_type(16777218, 0);
    end
  Lighting: |
    variable LVar0 := 0;
    LVar0 := game_time_hour;
    if ((LVar0 >= 600) and (LVar0 < 700)) then begin
      set_light_level(LVar0 - 600 + 40);
    end
    else begin
      if ((LVar0 >= 700) and (LVar0 < 1800)) then begin
        set_light_level(100);
      end
      else begin
        if ((LVar0 >= 1800) and (LVar0 < 1900)) then begin
          set_light_level(100 - (LVar0 - 1800));
        end
        else begin
          set_light_level(40);
        end
      end
    end
  add_party: |
    if (global_var(26) == 5) then begin
      if (Tandi_ptr == 0) then begin
      end
      critter_add_trait(Tandi_ptr, 1, 6, 0);
    end
raidpris:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(138, 100));
  critter_p_proc: |
    if ((map_var(3) == 1) and (local_var(1) == 0)) then begin
      set_global_var(633, 1);
      set_local_var(1, 1);
      float_msg(self_obj, message_str(138, 114), 0);
      give_exp_points(100);
      set_global_var(155, global_var(155) + 2);
      display_msg(message_str(138, 112));
      add_timer_event(self_obj, game_ticks(1), 1);
    end
    if ((((game_time / 10) - Time) >= 15) and (tile_distance_objs(self_obj, dude_obj) <= 4) and (local_var(3) == 0) and (global_var(633) == 0)) then begin
      float_msg(self_obj, message_str(138, 116), 6);
      Time := game_time / 10;
    end
  talk_p_proc: |
    start_gdialog(138, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(0) == 1) then begin
      call prisoner04;
    end
    else begin
      if (global_var(633) == 1) then begin
        call prisoner07;
      end
      else begin
        call prisoner00;
      end
    end
    gsay_end;
    end_dialogue;
  map_enter_p_proc: |
    if (global_var(633) == 1) then begin
      destroy_object(self_obj);
    end
    if (tile_num(self_obj) == 16305) then begin
      move_to(self_obj, 16306, 0);
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if (global_var(633) == 1) then begin
        obj_open(Cell_Door_Ptr);
        animate_move_obj_to_tile(self_obj, 10868, 1);
      end
    end
    add_timer_event(self_obj, game_ticks(1), 1);
  prisoner00: |
    gsay_reply(138, 101);
    giq_option(4, 138, 102, prisoner01, 50);
    giq_option(-3, 138, 104, prisoner01, 50);
    if (global_var(115) == 0) then begin
      giq_option(6, 138, 103, prisoner06, 50);
    end
    else begin
      giq_option(6, 138, 103, prisoner02, 50);
    end
    set_local_var(3, 1);
  prisoner01: |
    gsay_reply(138, 105);
    giq_option(6, 138, 103, prisoner02, 50);
  prisoner02: |
    gsay_reply(138, 106);
    giq_option(4, 138, 107, prisoner03, 50);
    giq_option(4, 138, 108, prisonerend, 50);
  prisoner03: |
    gsay_message(138, 109, 50);
    set_local_var(0, 1);
  prisoner04: 'gsay_message(138, 110, 50);

    '
  prisoner06: |
    gsay_reply(138, 113);
    giq_option(4, 138, 107, prisoner03, 50);
    giq_option(4, 138, 108, prisonerend, 50);
  prisoner07: |
    gsay_reply(138, 115);
    giq_option(4, 138, 111, prisonerend, 50);
  prisonerend: "[]"
ration:
  start: |
    if ((script_action == 11) and (crying == 0)) then begin
      call do_dialogue;
    end
    else begin
      if (script_action == 4) then begin
        hostile := 1;
      end
      else begin
        if (script_action == 12) then begin
          if (hostile) then begin
            hostile := 0;
            attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
          end
        end
        else begin
          if ((script_action == 21) or (script_action == 3)) then begin
            script_overrides;
            if (crying == 1) then begin
              PICK := myname;
              if (PICK == 1) then begin
                display_msg("You see Cindy crying.");
              end
              else begin
                if (PICK > 2) then begin
                  display_msg("You see Lisa crying.");
                end
                else begin
                  if (PICK > 3) then begin
                    display_msg("You see Sandy crying.");
                  end
                  else begin
                    if (PICK > 4) then begin
                      display_msg("You see Mary crying.");
                    end
                    else begin
                      if (PICK > 5) then begin
                        display_msg("You see Stacy crying.");
                      end
                      else begin
                        if (PICK > 6) then begin
                          display_msg("You see Susan crying.");
                        end
                      end
                    end
                  end
                end
              end
            end
            else begin
              PICK := myname;
              if (PICK == 1) then begin
                display_msg("You see Cindy.");
              end
              else begin
                if (PICK > 2) then begin
                  display_msg("You see Lisa.");
                end
                else begin
                  if (PICK > 3) then begin
                    display_msg("You see Sandy.");
                  end
                  else begin
                    if (PICK > 4) then begin
                      display_msg("You see Mary.");
                    end
                    else begin
                      if (PICK > 5) then begin
                        display_msg("You see Stacy.");
                      end
                      else begin
                        if (PICK > 6) then begin
                          display_msg("You see Susan.");
                        end
                      end
                    end
                  end
                end
              end
            end
          end
          else begin
            if (script_action == 18) then begin
              if (source_obj == dude_obj) then begin
                set_global_var(159, global_var(159) + 1);
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    start_gdialog(168, self_obj, 4, -1, -1);
    sayStart;
    call ration01;
    sayEnd;
    end_dialogue;
  ration01: |
    sayReply(0, "Hello, " + proto_data(obj_pid(dude_obj), 1) + ". Have you found the water chip yet?");
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption("No, not yet.", ration03);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption("I will. How are you doing?", ration04);
    end
    if (-get_critter_stat(dude_obj, 4) >= -3) then begin
      sayOption("Urug!", ration02);
    end
    if (get_critter_stat(dude_obj, 4) >= 0) then begin
      sayOption("", rationend);
    end
  ration02: |
    crying := 1;
    sayReply(0, "Oh . . . you don't understand me. I guess we really don't have much hope after all. Excuse me while I cry.");
    if (-get_critter_stat(dude_obj, 4) >= -3) then begin
      sayOption("Ugg!", rationend);
    end
    if (get_critter_stat(dude_obj, 4) >= 0) then begin
      sayOption("", rationend);
    end
  ration03: |
    PICK := random(1, 3);
    if (PICK == 1) then begin
      call ration03a;
    end
    else begin
      if (PICK > 2) then begin
        call ration03b;
      end
      else begin
        if (PICK > 3) then begin
          call ration03c;
        end
      end
    end
  ration03a: |
    sayReply(0, "Please find it before my baby dies of thirst.");
    sayOption("[Done]", rationend);
    if (get_critter_stat(dude_obj, 4) >= 0) then begin
      sayOption("", rationend);
    end
  ration03b: |
    sayReply(0, "You've got to find it! Don't let us die like this!");
    sayOption("[Done]", rationend);
    if (get_critter_stat(dude_obj, 4) >= 0) then begin
      sayOption("", rationend);
    end
  ration03c: |
    sayReply(0, "Keep trying. I believe in you. I know you will do everything you can to save us.");
    sayOption("[Done]", rationend);
    if (get_critter_stat(dude_obj, 4) >= 0) then begin
      sayOption("", rationend);
    end
  ration04: |
    sayReply(0, "I am afraid of what is happening. Someone has been stealing water and now everyone is on edge.");
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption("Who would do such a thing?", ration05);
    end
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption("What happened?", ration06);
    end
  ration05: |
    sayReply(0, "Some people have been accused and fights have broken out over it but nobody really knows.");
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption("Ok. Thanks.", rationend);
    end
    if (get_critter_stat(dude_obj, 4) >= 0) then begin
      sayOption("", rationend);
    end
  ration06: |
    sayReply(0, "Some people reported that their water had been stolen. They weren't given more water but some friends shared with them. After this everybody got very paranoid and started guarding their water. A few days later someone knocked the guard out in the ration supply area and stole water.");
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption("That is terrible! What can I do?", ration07);
    end
    if (get_critter_stat(dude_obj, 4) >= 0) then begin
      sayOption("", rationend);
    end
  ration07: |
    sayReply(0, "Maybe you can stop whoever is doing this.");
    if (get_critter_stat(dude_obj, 4) >= 4) then begin
      sayOption("I'll take a look around.", rationend);
    end
    if (get_critter_stat(dude_obj, 4) >= 0) then begin
      sayOption("", rationend);
    end
  rationend: "[]"
  get_reaction: |
    if (not(got_reaction)) then begin
      got_reaction := 1;
      reaction := reaction + ((get_critter_stat(dude_obj, 3) - 5) * 5);
      reaction := reaction + (10 * has_trait(0, dude_obj, 10));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          reaction := reaction + global_var(155);
        end
        else begin
          reaction := reaction - global_var(155);
        end
      end
      else begin
        if (badguy) then begin
          reaction := reaction - global_var(155);
        end
        else begin
          reaction := reaction + global_var(155);
        end
      end
      if (global_var(158) > 2) then begin
        reaction := reaction - 30;
      end
      if ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1)) then begin
        reaction := reaction + 20;
      end
      if ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1)) then begin
        reaction := reaction - 20;
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (reaction < 24) then begin
      reaction_level := 1;
    end
    else begin
      if (reaction < 74) then begin
        reaction_level := 2;
      end
      else begin
        reaction_level := 3;
      end
    end
  LevelToReact: |
    if (reaction_level == 1) then begin
      reaction := random(1, 24);
    end
    else begin
      if (reaction_level == 2) then begin
        reaction := random(25, 74);
      end
      else begin
        reaction := random(75, 100);
      end
    end
  UpReact: |
    reaction := reaction + 10;
    call ReactToLevel;
  DownReact: |
    reaction := reaction - 10;
    call ReactToLevel;
  BottomReact: |
    reaction_level := 1;
    reaction := 1;
  TopReact: |
    reaction := 100;
    reaction_level := 3;
  BigUpReact: |
    reaction := reaction + 25;
    call ReactToLevel;
  BigDownReact: |
    reaction := reaction - 25;
    call ReactToLevel;
  UpReactLevel: |
    reaction_level := reaction_level + 1;
    if (reaction_level > 3) then begin
      reaction_level := 3;
    end
    call LevelToReact;
  DownReactLevel: |
    reaction_level := reaction_level - 1;
    if (reaction_level < 1) then begin
      reaction_level := 1;
    end
    call LevelToReact;
  Goodbyes: |
    variable LVar0 := 0;
    LVar0 := random(1, 6);
    if (LVar0 == 1) then begin
      exit_line := "Thanks, bye.";
    end
    if (LVar0 == 2) then begin
      exit_line := "Okay, thanks.";
    end
    if (LVar0 == 3) then begin
      exit_line := "Hmm. Bye.";
    end
    if (LVar0 == 4) then begin
      exit_line := "See ya.";
    end
    if (LVar0 == 5) then begin
      exit_line := "Thanks.";
    end
    if (LVar0 == 6) then begin
      exit_line := "Okay, bye.";
    end
ratpit:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (not(local_var(0))) then begin
        if (is_success(do_check(dude_obj, 1, 0))) then begin
          display_msg(message_str(206, 100));
        end
        set_local_var(0, 1);
      end
    end
razlo:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(129, 100));
  critter_p_proc: |
    if (map_var(2) == 1) then begin
      set_local_var(10, local_var(10) + 1);
      set_map_var(2, 0);
      if (local_var(10) < 3) then begin
        float_msg(self_obj, message_str(129, 308), 2);
      end
      else begin
        HOSTILE := 1;
      end
    end
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(246) == 1) then begin
        HOSTILE := 1;
      end
    end
    if (HOSTILE) then begin
      HOSTILE := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  pickup_p_proc: 'HOSTILE := 1;

    '
  combat_p_proc: |
    if (fixed_param == 4) then begin
      round_counter := round_counter + 1;
    end
    if (round_counter > 3) then begin
      if (global_var(246) == 0) then begin
        set_global_var(246, 1);
        set_global_var(155, global_var(155) - 5);
      end
    end
  map_update_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 23);
      home_tile := 24529;
      sleep_tile := 23133;
      wake_time := 630;
      sleep_time := 2230;
      initialized := 0;
    end
  talk_p_proc: |
    MAX_HITS := get_critter_stat(dude_obj, 7);
    HITS := get_critter_stat(dude_obj, 35);
    call get_reaction;
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      set_global_var(156, 1);
      set_global_var(157, 0);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
      set_global_var(157, 1);
      set_global_var(156, 0);
    end
    if (local_var(9) == 1) then begin
      float_msg(self_obj, message_str(185, 166), 0);
    end
    else begin
      if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
        set_local_var(6, 1);
        start_gdialog(129, self_obj, 4, -1, -1);
        gsay_start;
        call razlo00n;
        gsay_end;
        end_dialogue;
      end
      else begin
        if (global_var(43) == 1) then begin
          if ((global_var(26) == 1) and (local_var(4) == 0) and (global_var(218) == 1)) then begin
            set_local_var(4, 1);
            start_gdialog(129, self_obj, 4, -1, -1);
            gsay_start;
            call razlo01;
            gsay_end;
            end_dialogue;
          end
          else begin
            start_gdialog(129, self_obj, 4, -1, -1);
            gsay_start;
            call razlo23;
            gsay_end;
            end_dialogue;
          end
        end
        else begin
          if (obj_is_carrying_obj_pid(dude_obj, 92)) then begin
            start_gdialog(129, self_obj, 4, -1, -1);
            gsay_start;
            call razlo23;
            gsay_end;
            end_dialogue;
          end
          else begin
            if ((local_var(6) == 0) and (local_var(1) >= 2)) then begin
              set_local_var(6, 1);
              start_gdialog(129, self_obj, 4, -1, -1);
              gsay_start;
              call razlo10;
              gsay_end;
              end_dialogue;
            end
            else begin
              if (local_var(6) == 0) then begin
                set_local_var(6, 1);
                start_gdialog(129, self_obj, 4, -1, -1);
                gsay_start;
                call razlo18;
                gsay_end;
                end_dialogue;
              end
              else begin
                if (global_var(26) == 3) then begin
                  call razlo09;
                end
                else begin
                  if ((global_var(26) == 2) and (local_var(5) == 0)) then begin
                    set_local_var(5, 1);
                    call razlo08;
                  end
                  else begin
                    if ((global_var(26) == 1) and (local_var(4) == 0) and (global_var(218) == 1)) then begin
                      set_local_var(4, 1);
                      start_gdialog(129, self_obj, 4, -1, -1);
                      gsay_start;
                      call razlo01;
                      gsay_end;
                      end_dialogue;
                    end
                    else begin
                      if ((global_var(26) == 1) and (global_var(218) == 1) and (local_var(4) == 1)) then begin
                        set_local_var(4, 2);
                        call razlo07;
                      end
                      else begin
                        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1)) or (global_var(158) > 2)) then begin
                          start_gdialog(129, self_obj, 4, -1, -1);
                          gsay_start;
                          call razlo00;
                          gsay_end;
                          end_dialogue;
                          display_msg(message_str(129, 103));
                        end
                        else begin
                          if (local_var(1) >= 2) then begin
                            start_gdialog(129, self_obj, 4, -1, -1);
                            gsay_start;
                            call razlo19;
                            gsay_end;
                            end_dialogue;
                          end
                          else begin
                            start_gdialog(129, self_obj, 4, -1, -1);
                            gsay_start;
                            call razlo21;
                            gsay_end;
                            end_dialogue;
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    call remove_items;
  razlo00: 'gsay_message(129, 101, 50);

    '
  razlo01: |
    gsay_reply(129, 104);
    if ((global_var(26) == 1) and (global_var(218) == 1)) then begin
      giq_option(4, 129, 105, razlo03, 50);
    end
    giq_option(4, 129, 143, razlo22, 50);
    giq_option(4, 129, 144, razlo23a, 50);
    giq_option(-3, 129, 106, razlo02, 50);
  razlo02: |
    gsay_message(129, 107, 50);
    set_local_var(4, 1);
  razlo03: |
    set_local_var(4, 1);
    gsay_reply(129, 108);
    giq_option(5, 129, 110, razlo04, 50);
    giq_option(4, 129, 109, razloend, 50);
    giq_option(5, 129, 111, razloend, 50);
  razlo04: |
    gsay_reply(129, 112);
    giq_option(4, 129, 113, razlo05, 50);
    giq_option(4, 129, 114, razlo06, 50);
  razlo05: 'gsay_message(129, 115, 50);

    '
  razlo06: |
    gsay_message(129, 116, 50);
    call givestuff;
  razlo06na: |
    gsay_message(129, 306, 50);
    call razlo06nb;
  razlo06nb: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    gsay_message(129, 307, 50);
    LVar0 := create_object_sid(49, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar1 := obj_carrying_pid_obj(dude_obj, 92);
    rm_obj_from_inven(dude_obj, LVar1);
    destroy_object(LVar1);
    if (local_var(7) == 0) then begin
      set_local_var(7, 1);
      give_exp_points(250);
      display_msg(message_str(129, 300));
    end
    gfade_out(400);
    gfade_in(400);
    game_time_advance(game_ticks(1200 * damage));
    critter_heal(dude_obj, damage);
  razlo07: 'float_msg(self_obj, message_str(129, 117), 2);

    '
  razlo08: 'float_msg(self_obj, message_str(129, 118), 7);

    '
  razlo09: 'float_msg(self_obj, message_str(129, 119), 12);

    '
  razlo10: |
    gsay_reply(129, 120);
    giq_option(4, 129, 122, razlo14, 50);
    giq_option(4, 129, 144, razlo23a, 50);
    giq_option(4, 129, 121, razloend, 50);
    giq_option(-3, 129, 123, razlo11, 50);
  razlo11: |
    gsay_message(129, 124, 50);
    damage := MAX_HITS - HITS;
    if (damage > (MAX_HITS / 4)) then begin
      call razlo14;
    end
    else begin
      call razlo12;
    end
  razlo12: 'gsay_message(129, 125, 50);

    '
  razlo14: |
    gsay_message(129, 126, 50);
    damage := MAX_HITS - HITS;
    if (damage < (MAX_HITS / 4)) then begin
      call razlowmpa;
    end
    else begin
      if (damage < (MAX_HITS / 2)) then begin
        call razlofixa;
      end
      else begin
        if (damage < (3 * MAX_HITS / 4)) then begin
          call razlofixb;
        end
        else begin
          call razlofixc;
        end
      end
    end
  Razlo17: |
    variable LVar0 := 0;
    if (damage < (MAX_HITS / 2)) then begin
      LVar0 := create_object_sid(218, 0, 0, -1);
      add_obj_to_inven(self_obj, LVar0);
    end
    else begin
      if (damage < (3 * MAX_HITS / 4)) then begin
        LVar0 := create_object_sid(219, 0, 0, -1);
        add_obj_to_inven(self_obj, LVar0);
      end
      else begin
        LVar0 := create_object_sid(220, 0, 0, -1);
        add_obj_to_inven(self_obj, LVar0);
      end
    end
    gdialog_mod_barter(0);
    gsay_message(129, 126, 50);
    call razlo08n;
  razlo18: |
    gsay_reply(129, 128);
    giq_option(4, 129, 130, razlo14, 50);
    giq_option(4, 129, 144, razlo23a, 50);
    giq_option(5, 129, 129, razloend, 50);
  razlo19: |
    gsay_reply(129, 131);
    giq_option(4, 129, 132, razlo20, 50);
    giq_option(4, 129, 143, razlo22, 50);
    giq_option(4, 129, 144, razlo23a, 50);
    giq_option(-3, 129, 134, razlo11, 50);
  razlo20: 'gsay_message(129, 135, 50);

    '
  razlo21: |
    gsay_reply(129, 136);
    giq_option(4, 129, 138, razlo22, 50);
    giq_option(4, 129, 144, razlo23a, 50);
    giq_option(-3, 129, 139, razlo11, 50);
    giq_option(4, 129, 137, razloend, 50);
  razlo22: |
    gsay_message(129, 140, 50);
    call razlo14;
  razlo23: |
    gsay_reply(129, 141);
    giq_option(4, 129, 143, razlo22, 50);
    giq_option(4, 129, 144, razlo23a, 50);
    giq_option(5, 129, 145, razlo27, 50);
    if (obj_is_carrying_obj_pid(dude_obj, 92)) then begin
      giq_option(4, 129, 146, razlo30, 50);
      giq_option(-3, 129, 303, razlo30, 50);
    end
    giq_option(4, 129, 142, razloend, 50);
    giq_option(-3, 129, 147, razlo11, 50);
  razlo23a: |
    if (local_var(8) == 1) then begin
      call razlo25;
    end
    else begin
      call razlo24;
    end
  razlo24: 'gsay_message(129, 148, 50);

    '
  razlo25: |
    gsay_message(129, 149, 50);
    if (get_poison(dude_obj) > 0) then begin
      gsay_message(129, 150, 50);
      poison(dude_obj, -get_poison(dude_obj));
      call razlo26;
    end
    else begin
      gsay_message(129, 151, 50);
    end
    poison(dude_obj, -get_poison(dude_obj));
  razlo26: 'gsay_message(129, 152, 50);

    '
  razlo27: |
    gsay_message(129, 153, 50);
    gsay_reply(129, 154);
    giq_option(5, 129, 156, razlo29, 50);
    giq_option(5, 129, 157, razlo28, 50);
    giq_option(4, 129, 155, razlo27a, 49);
  razlo27a: 'call UpReact;

    '
  razlo28: |
    gsay_reply(129, 158);
    giq_option(5, 129, 159, razloend, 50);
  razlo29: 'gsay_message(129, 160, 50);

    '
  razlo30: |
    gsay_message(129, 161, 50);
    gfade_out(400);
    gfade_in(400);
    game_time_advance(game_ticks(14400));
    set_local_var(8, 1);
    call razlo31;
  razlo31: |
    variable LVar0 := 0;
    gsay_message(129, 162, 50);
    LVar0 := create_object_sid(49, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    tail := obj_carrying_pid_obj(dude_obj, 92);
    rm_obj_from_inven(dude_obj, tail);
    destroy_object(tail);
    if (local_var(7) == 0) then begin
      set_local_var(7, 1);
      set_global_var(240, 2);
      give_exp_points(250);
      display_msg(message_str(129, 300));
    end
  razlo00n: |
    gsay_reply(129, 163);
    giq_option(4, 129, 164, razlo00n_a, 50);
    if (global_var(43) == 1) then begin
      giq_option(5, 129, 165, razlo09n, 50);
    end
    if ((global_var(26) == 1) and (global_var(218) == 1)) then begin
      giq_option(5, 129, 166, razlo15n, 50);
    end
    giq_option(-3, 129, 167, razlo01n, 50);
  razlo01n: |
    gsay_message(129, 168, 50);
    call DownReact;
  razlo02n: |
    gsay_reply(129, 169);
    giq_option(4, 129, 170, razlo04n, 50);
    giq_option(4, 129, 171, razlo03n, 50);
  razlo03n: |
    gsay_message(129, 172, 50);
    call DownReact;
  razlo04n: |
    gsay_reply(129, 173);
    giq_option(4, 129, 174, razlo05n, 50);
  razlo05n: |
    damage := MAX_HITS - HITS;
    if (damage < (MAX_HITS / 4)) then begin
      call razlowmpb;
    end
    else begin
      if (damage < (MAX_HITS / 2)) then begin
        call razlofixa;
      end
      else begin
        if (damage < (3 * MAX_HITS / 4)) then begin
          call razlofixb;
        end
        else begin
          call razlofixc;
        end
      end
    end
  razlo06n: |
    gsay_reply(129, 186);
    giq_option(4, 129, 187, Razlo17, 50);
    if (obj_is_carrying_obj_pid(dude_obj, 92)) then begin
      giq_option(4, 129, 305, razlo06na, 50);
      giq_option(-3, 129, 303, razlo06na, 50);
    end
    giq_option(4, 129, 188, razloend, 50);
    giq_option(-3, 129, 304, Razlo17, 50);
    giq_option(-3, 129, 302, razloend, 50);
  razlo08n: |
    if (obj_is_carrying_obj_pid(dude_obj, 218) or obj_is_carrying_obj_pid(dude_obj, 219) or obj_is_carrying_obj_pid(dude_obj, 220)) then begin
      call razlo14n;
    end
    else begin
      if (item_caps_total(dude_obj) >= COST) then begin
        dummyvar := item_caps_adjust(dude_obj, -COST);
        call razlo14n;
      end
      else begin
        call razlo06n;
      end
    end
  razlo09n: |
    gsay_reply(129, 190);
    giq_option(6, 129, 191, razlo10n, 50);
  razlo10n: 'gsay_message(129, 192, 50);

    '
  razlo11n: |
    gsay_reply(129, 108);
    giq_option(5, 129, 194, razlo04, 50);
    giq_option(5, 129, 195, razloend, 50);
  razlo14n: |
    gsay_message(129, 196, 50);
    gfade_out(400);
    gfade_in(400);
    game_time_advance(game_ticks(1200 * damage));
    critter_heal(dude_obj, damage);
  razlo15n: |
    if (local_var(11) == 1) then begin
      call razlo16n;
    end
    else begin
      set_local_var(11, 1);
      call razlo11n;
    end
  razlo16n: 'gsay_message(129, 197, 50);

    '
  razlowmpa: 'gsay_message(129, 175, 50);

    '
  razlowmpb: 'gsay_message(129, 176, 50);

    '
  razlofixa: |
    COST := 25;
    gsay_reply(129, 177);
    giq_option(4, 129, 178, razlo08n, 50);
    giq_option(4, 129, 179, razlo06n, 50);
    giq_option(-3, 129, 301, razlo08n, 50);
    giq_option(-3, 129, 302, razloend, 50);
  razlofixb: |
    COST := 50;
    gsay_reply(129, 180);
    giq_option(4, 129, 181, razlo08n, 50);
    giq_option(4, 129, 182, razlo06n, 50);
    giq_option(-3, 129, 301, razlo08n, 50);
    giq_option(-3, 129, 302, razloend, 50);
  razlofixc: |
    COST := 100;
    gsay_reply(129, 183);
    giq_option(4, 129, 184, razlo08n, 50);
    giq_option(4, 129, 185, razlo06n, 50);
    giq_option(-3, 129, 301, razlo08n, 50);
    giq_option(-3, 129, 302, razloend, 50);
  razloend: "[]"
  givestuff: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(40, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(71, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    if (local_var(8) == 1) then begin
      LVar0 := create_object_sid(49, 0, 0, -1);
      add_obj_to_inven(dude_obj, LVar0);
    end
  remove_items: |
    variable LVar0 := 0;
    if (obj_is_carrying_obj_pid(dude_obj, 218)) then begin
      LVar0 := obj_carrying_pid_obj(dude_obj, 218);
      rm_obj_from_inven(dude_obj, LVar0);
      destroy_object(LVar0);
    end
    if (obj_is_carrying_obj_pid(self_obj, 218)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 218);
      rm_obj_from_inven(self_obj, LVar0);
      destroy_object(LVar0);
    end
    if (obj_is_carrying_obj_pid(dude_obj, 219)) then begin
      LVar0 := obj_carrying_pid_obj(dude_obj, 219);
      rm_obj_from_inven(dude_obj, LVar0);
      destroy_object(LVar0);
    end
    if (obj_is_carrying_obj_pid(self_obj, 219)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 219);
      rm_obj_from_inven(self_obj, LVar0);
      destroy_object(LVar0);
    end
    if (obj_is_carrying_obj_pid(dude_obj, 220)) then begin
      LVar0 := obj_carrying_pid_obj(dude_obj, 220);
      rm_obj_from_inven(dude_obj, LVar0);
      destroy_object(LVar0);
    end
    if (obj_is_carrying_obj_pid(self_obj, 220)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 220);
      rm_obj_from_inven(self_obj, LVar0);
      destroy_object(LVar0);
    end
  razlo00n_a: |
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1)) or (global_var(158) > 2)) then begin
      call razlo02n;
    end
    else begin
      call razlo00;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
razor:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(278, 220));
    end
    else begin
      display_msg(message_str(278, 221));
    end
  talk_p_proc: |
    if (global_var(253) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if ((global_var(613) == 2) and (local_var(6) == 1) and (global_var(642) == 0)) then begin
        call Node000;
      end
      else begin
        if ((global_var(613) == 2) and (local_var(6) == 1) and (global_var(642) == 1)) then begin
          call Node005;
        end
        else begin
          if (global_var(642) == 3) then begin
            float_msg(self_obj, message_str(278, 318), 3);
          end
          else begin
            if ((local_var(4) == 1) and (get_critter_stat(dude_obj, 4) < 4)) then begin
              float_msg(self_obj, message_str(278, 222), 0);
            end
            else begin
              call get_reaction;
              start_gdialog(278, self_obj, -1, -1, -1);
              gsay_start;
              if (global_var(613) == 2) then begin
                if (global_var(350) == 1) then begin
                  if (global_var(353) == 1) then begin
                    call Razor45;
                  end
                  else begin
                    if (local_var(4) == 0) then begin
                      call Razor42;
                    end
                    else begin
                      call Razor48;
                    end
                  end
                end
                else begin
                  call RazorFin;
                end
                set_local_var(6, 1);
              end
              else begin
                if (global_var(614) == 9202) then begin
                  call Razor33;
                end
                else begin
                  if (global_var(612) == 9001) then begin
                    call Razor20;
                  end
                  else begin
                    if (obj_is_carrying_obj_pid(dude_obj, 238) and (global_var(265) != 2)) then begin
                      call Razor26;
                    end
                    else begin
                      if (global_var(612) == 9003) then begin
                        call Razor30;
                      end
                      else begin
                        if (global_var(353) == 1) then begin
                          call Razor46;
                        end
                        else begin
                          if (global_var(612) == 0) then begin
                            call Razor01;
                          end
                          else begin
                            if (global_var(617) == 1) then begin
                              call Razor37;
                            end
                            else begin
                              call fix00;
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
              gsay_end;
              end_dialogue;
            end
          end
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
    set_global_var(612, 9002);
  critter_p_proc: |
    if (global_var(352) == 1) then begin
      set_local_var(4, 1);
    end
    if (local_var(5) == 1) then begin
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      set_local_var(5, 0);
      set_global_var(253, 1);
    end
  pickup_p_proc: 'set_global_var(253, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      critter_add_trait(self_obj, 1, 6, 47);
      critter_add_trait(self_obj, 1, 5, 27);
      RazorPtr := self_obj;
      if (global_var(352) == 1) then begin
        set_local_var(4, 1);
      end
      Initialize := 0;
    end
  map_update_p_proc: |
    if (global_var(352) == 1) then begin
      set_local_var(4, 1);
    end
  Razor01: |
    gsay_reply(278, 100);
    giq_option(4, 278, 101, Razor02, 50);
    giq_option(4, 278, 102, Razor03, 50);
    giq_option(4, 278, 103, RazorEnd, 50);
    giq_option(-3, 278, 104, Razor41, 50);
  Razor02: |
    gsay_reply(278, 105);
    gsay_option(278, 106, Razor03, 50);
    gsay_option(278, 107, Razor04, 50);
    gsay_option(278, message_str(278, 108) + proto_data(obj_pid(dude_obj), 1) + ".", Razor05, 50);
    gsay_option(278, 109, RazorEnd, 50);
    set_local_var(4, 1);
  Razor03: |
    gsay_reply(278, 110);
    gsay_option(278, 111, Razor06, 50);
    gsay_option(278, 112, Razor07, 50);
    gsay_option(278, 300, Node006, 50);
    gsay_option(278, 113, RazorEnd, 50);
  Razor04: |
    gsay_reply(278, 114);
    gsay_option(278, 115, Razor09, 50);
    gsay_option(278, 116, Razor04a, 50);
    gsay_option(278, 238, RazorReg, 50);
    gsay_option(278, 117, RazorEnd, 50);
  Razor04a: 'call BottomReact;

    '
  Razor05: |
    gsay_reply(278, 118);
    gsay_option(278, 119, Razor08, 50);
    gsay_option(278, 120, Razor08, 50);
    gsay_option(278, 121, RazorEnd, 50);
  Razor06: |
    gsay_reply(278, 122);
    gsay_option(278, 123, Razor09, 50);
    gsay_option(278, 124, Razor10, 50);
    gsay_option(278, 125, Razor19, 50);
    gsay_option(278, 126, RazorEnd, 50);
  Razor07: |
    gsay_reply(278, 127);
    gsay_option(278, 128, Razor09, 50);
    gsay_option(278, 129, Razor19, 50);
    gsay_option(278, 130, Razor19, 50);
  Razor08: |
    gsay_reply(278, 131);
    gsay_option(278, 132, Razor04, 50);
    gsay_option(278, 133, Razor03, 50);
  Razor09: |
    gsay_reply(278, 134);
    gsay_option(278, 135, Razor11, 50);
    gsay_option(278, 136, RazorEnd, 50);
    set_global_var(613, 9101);
  Razor10: |
    gsay_reply(278, 137);
    gsay_option(278, 138, Razor12, 50);
    gsay_option(278, 139, Razor14, 50);
    gsay_option(278, 238, RazorReg, 50);
  Razor11: |
    gsay_reply(278, 140);
    gsay_option(278, 141, Razor18, 50);
    gsay_option(278, 238, RazorReg, 50);
    gsay_option(278, 142, RazorEnd, 50);
  Razor12: |
    gsay_reply(278, 143);
    gsay_option(278, 144, Razor13, 50);
    gsay_option(278, 145, RazorEnd, 50);
  Razor13: |
    gsay_reply(278, 146);
    gsay_option(278, 147, Razor14, 50);
  Razor14: |
    gsay_reply(278, 148);
    gsay_option(278, 149, Razor15, 50);
    gsay_option(278, 150, Razor09, 50);
  Razor15: |
    gsay_reply(278, 151);
    gsay_option(278, 152, Razor27, 50);
    gsay_option(278, 153, Razor17, 50);
  Razor16: |
    variable LVar0 := 0;
    gsay_reply(278, 154);
    gsay_option(278, 155, RazorEnd, 50);
    if (not(obj_carrying_pid_obj(dude_obj, 238))) then begin
      LVar0 := create_object_sid(238, 0, 0, -1);
      add_obj_to_inven(dude_obj, LVar0);
    end
    set_map_var(1, 1);
  Razor17: |
    gsay_reply(278, 156);
    gsay_option(278, 157, RazorEnd, 50);
  Razor18: |
    gsay_reply(278, 158);
    gsay_option(278, 159, RazorEnd, 50);
    set_global_var(613, 9101);
  Razor19: |
    gsay_reply(278, 160);
    gsay_option(278, 161, RazorEnd, 50);
  Razor20: |
    gsay_reply(278, 162);
    giq_option(4, 278, 163, Razor21, 50);
    giq_option(4, 278, 164, RazorEnd, 50);
    giq_option(-3, 278, 165, Razor41, 50);
  Razor21: |
    gsay_reply(278, 166);
    gsay_option(278, 167, Razor22, 50);
    gsay_option(278, 168, Razor07, 50);
    gsay_option(278, 169, RazorEnd, 50);
  Razor22: |
    gsay_reply(278, 170);
    gsay_option(278, 171, Razor22a, 50);
    gsay_option(278, 172, Razor23, 50);
  Razor22a: 'set_local_var(5, 1);

    '
  Razor23: |
    gsay_reply(278, 173);
    gsay_option(278, 174, Razor22a, 50);
    gsay_option(278, 175, Razor24, 50);
  Razor24: |
    gsay_reply(278, 176);
    gsay_option(278, 177, Razor22a, 50);
    gsay_option(278, 178, Razor25, 50);
  Razor25: |
    gsay_reply(278, 179);
    gsay_option(278, 180, Razor13, 50);
  Razor26: |
    gsay_reply(278, 181);
    giq_option(4, 278, 182, Razor29, 50);
    giq_option(-3, 278, 183, Razor41, 50);
  Razor27: |
    gsay_reply(278, 184);
    gsay_option(278, 185, Razor28, 50);
    gsay_option(278, 238, RazorReg, 50);
    gsay_option(278, 186, RazorEnd, 50);
  Razor28: |
    gsay_reply(278, 187);
    gsay_option(278, 188, Razor16, 50);
    set_global_var(613, 9101);
  Razor29: 'gsay_message(278, 189, 50);

    '
  Razor30: |
    gsay_reply(278, 190);
    giq_option(4, 278, 191, Razor31, 50);
    giq_option(-3, 278, 192, Razor41, 50);
  Razor31: |
    gsay_reply(278, 193);
    gsay_option(278, 194, Razor32, 50);
    gsay_option(278, 195, Razor19, 50);
  Razor32: |
    gsay_message(278, 196, 50);
    set_global_var(613, 9101);
  Razor33: |
    gsay_reply(278, 197);
    giq_option(4, 278, 198, Razor34, 50);
    giq_option(4, 278, 199, Razor35, 50);
    if (global_var(612) != 9003) then begin
      giq_option(4, 278, 201, Razor36, 50);
    end
    giq_option(-3, 278, 200, Razor41, 50);
  Razor34: |
    gsay_message(278, 202, 50);
    call TopReact;
    set_global_var(613, 9104);
    gfade_out(600);
    game_time_advance(10 * 60 * 60 * 8);
  Razor35: |
    gsay_message(278, 203, 50);
    call TopReact;
    set_global_var(613, 9103);
    gfade_out(600);
    game_time_advance(10 * 60 * 60 * 24);
    load_map("laadytum.map", 1);
  Razor36: |
    gsay_message(278, 204, 50);
    set_global_var(613, 9102);
  Razor37: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(278, message_str(278, 240) + " " + message_str(278, 205));
    end
    else begin
      gsay_reply(278, message_str(278, 241) + " " + message_str(278, 205));
    end
    giq_option(4, 278, 206, RazorEnd, 50);
    giq_option(4, 278, 207, RazorEnd, 50);
    if (obj_is_carrying_obj_pid(dude_obj, 238)) then begin
      giq_option(4, 278, 208, Razor38, 50);
    end
    giq_option(4, 278, 209, Razor22a, 50);
    giq_option(-3, 278, 210, Razor41, 50);
  Razor38: 'gsay_message(278, 211, 50);

    '
  Razor41: 'gsay_message(278, 218, 50);

    '
  Razor42: |
    gsay_reply(278, 224);
    giq_option(4, 278, 225, Razor43, 50);
    giq_option(-3, 278, 226, Razor41, 50);
  Razor43: |
    gsay_reply(278, 227);
    gsay_option(278, 228, Razor44, 50);
  Razor44: |
    gsay_message(278, 229, 50);
    set_global_var(155, global_var(155) + 2);
    display_msg(message_str(766, 103) + 500 + message_str(766, 104));
    give_exp_points(500);
  Razor45: |
    gsay_message(278, 230, 50);
    set_global_var(155, global_var(155) + 2);
    display_msg(message_str(766, 103) + 500 + message_str(766, 104));
    give_exp_points(500);
  Razor46: |
    gsay_reply(278, 231);
    gsay_option(278, 232, Razor46a, 50);
    gsay_option(278, 233, Razor47, 50);
  Razor46a: 'gsay_message(278, 215, 50);

    '
  Razor47: |
    gsay_reply(278, 234);
    gsay_option(278, 235, Razor47a, 50);
    gsay_option(278, 236, RazorEnd, 50);
  Razor47a: |
    gsay_message(278, 215, 50);
    set_global_var(613, 9101);
  Razor48: |
    gsay_message(278, 237, 50);
    set_global_var(155, global_var(155) + 2);
    display_msg(message_str(766, 103) + 500 + message_str(766, 104));
    give_exp_points(500);
  RazorFin: |
    if (local_var(6) == 0) then begin
      gsay_message(278, 223, 50);
    end
    if (global_var(642) == 2) then begin
      gsay_message(278, 216, 50);
    end
    if (global_var(642) == 3) then begin
      gsay_message(278, 318, 50);
    end
  RazorReg: |
    gsay_message(278, 239, 50);
    set_global_var(353, 1);
  RazorEnd: "[]"
  fix00: 'gsay_message(278, 222, 50);

    '
  Node000: |
    start_gdialog(278, self_obj, 4, -1, -1);
    gsay_start;
    gsay_reply(278, 216);
    gsay_option(278, 300, Node001, 50);
    gsay_option(278, 157, RazorEnd, 50);
    gsay_end;
    end_dialogue;
  Node001: |
    gsay_reply(278, 301);
    gsay_option(278, 302, Node002, 50);
    gsay_option(278, 303, RazorEnd, 50);
  Node002: |
    gsay_reply(278, 304);
    if (global_var(644) == 1) then begin
      gsay_option(278, 400, Node010, 50);
    end
    else begin
      gsay_option(278, 305, Node003, 50);
      gsay_option(278, 303, RazorEnd, 50);
    end
  Node003: |
    if ((global_var(265) == 2) or (global_var(614) == 9202)) then begin
      gsay_reply(278, 319);
    end
    else begin
      gsay_reply(278, 306);
    end
    gsay_option(278, 307, Node004, 50);
  Node004: 'set_global_var(642, 1);

    '
  Node005: |
    start_gdialog(278, self_obj, 4, -1, -1);
    gsay_start;
    gsay_reply(278, 308);
    if (obj_is_carrying_obj_pid(dude_obj, 114)) then begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        gsay_option(278, 310, Node007, 50);
      end
      else begin
        gsay_option(278, 3010, Node007, 50);
      end
    end
    gsay_option(278, 305, Node003, 50);
    gsay_option(278, 309, RazorEnd, 50);
    gsay_option(278, 303, RazorEnd, 50);
    gsay_end;
    end_dialogue;
  Node006: |
    gsay_message(278, 316, 50);
    call Razor01;
  Node007: |
    variable LVar0 := 0;
    LVar0 := obj_carrying_pid_obj(dude_obj, 114);
    if (LVar0) then begin
      rm_obj_from_inven(dude_obj, LVar0);
      destroy_object(LVar0);
    end
    set_global_var(642, 2);
    gsay_reply(278, 311);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_option(278, 312, Node009, 50);
    end
    else begin
      gsay_option(278, 3012, Node009, 50);
    end
    gsay_option(278, 313, Node008, 50);
  Node008: 'gsay_message(278, 314, 50);

    '
  Node009: |
    gsay_message(278, 317, 50);
    set_global_var(642, 3);
  Node010: |
    gsay_reply(278, 401);
    if (obj_is_carrying_obj_pid(dude_obj, 114)) then begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        gsay_option(278, 310, Node007, 50);
      end
      else begin
        gsay_option(278, 3010, Node007, 50);
      end
    end
    else begin
      gsay_option(278, 402, Node011, 50);
    end
  Node011: |
    gsay_reply(278, 403);
    gsay_option(278, 404, RazorEnd, 50);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
rd1init:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 62);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    if (local_var(4) > 0) then begin
      call goto07;
    end
    else begin
      start_gdialog(691, self_obj, 4, -1, -1);
      gsay_start;
      call do_dialog;
      gsay_end;
      end_dialogue;
    end
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(691, 100));
  goto00: |
    gsay_reply(691, message_str(691, 103) + proto_data(obj_pid(dude_obj), 1) + message_str(691, 104));
    giq_option(4, 691, 105, goto03, 50);
    giq_option(4, 691, 106, goto01, 50);
    giq_option(4, 691, 107, goto02, 50);
    giq_option(-3, 691, 108, goto04, 50);
  goto01: |
    gsay_reply(691, 109);
    giq_option(4, 691, 110, goto06, 50);
    giq_option(4, 691, 111, goto05, 50);
  goto02: |
    gsay_reply(691, 112);
    giq_option(4, 691, 110, goto06, 50);
    giq_option(4, 691, 111, goto05, 50);
  goto03: |
    gsay_reply(691, 113);
    giq_option(4, 691, 114, goto04, 50);
  goto04: |
    gsay_message(691, 115, 50);
    call dialog_end;
  goto05: |
    gsay_message(691, 116, 50);
    call dialog_end;
  goto06: |
    gsay_message(691, 117, 50);
    call dialog_end;
  goto07: 'float_msg(self_obj, message_str(691, random(118, 125)), 2);

    '
  gotoend: "[]"
  dialog_end: "[]"
  do_dialog: |
    set_local_var(4, 1);
    call goto00;
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
rd1scrb1:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 63);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (local_var(1) == 0) then begin
        set_local_var(1, 1);
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          call say_something;
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: 'call say_something;

    '
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(723, 101));
  say_something: |
    if (local_var(0) == 0) then begin
      set_local_var(0, 1);
      float_msg(self_obj, message_str(723, random(102, 113)), 2);
    end
    else begin
      float_msg(self_obj, message_str(723, 111), 2);
    end
rebel:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (((game_time / (10 * 60 * 60 * 24)) > map_var(5)) and (global_var(238) != 2)) then begin
        destroy_object(self_obj);
      end
      if ((game_time_hour > 1700) and (game_time_hour < 1710)) then begin
        if (global_var(238) != 2) then begin
          if (not_at_meeting) then begin
            call rebel_meeting;
          end
        end
        else begin
          animate_move_obj_to_tile(self_obj, home_tile, 0);
        end
      end
      else begin
        call sleeping;
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(6, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    if (global_var(238) != 2) then begin
      display_msg(message_str(379, 101));
    end
    else begin
      display_msg(message_str(379, 100));
    end
  map_enter_p_proc: |
    if (local_var(5) == 0) then begin
      set_local_var(5, tile_num(self_obj));
    end
    home_tile := local_var(5);
    sleep_tile := home_tile;
    sleep_time := random(1900, 1930);
    wake_time := random(700, 715);
    critter_add_trait(self_obj, 1, 6, 87);
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    call get_reaction;
    if (local_var(4) == 1) then begin
      float_msg(self_obj, message_str(185, 166), 0);
    end
    else begin
      if (local_var(6)) then begin
        float_msg(self_obj, message_str(669, random(100, 105)), 2);
      end
      else begin
        if (global_var(261)) then begin
          float_msg(self_obj, message_str(379, 139), 2);
        end
        else begin
          if (global_var(101) != 0) then begin
            call Rebel01;
          end
          else begin
            if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
              call Rebel02;
            end
            else begin
              if (local_var(1) >= 2) then begin
                start_gdialog(379, self_obj, 4, -1, -1);
                gsay_start;
                call Rebel03;
                gsay_end;
                end_dialogue;
              end
              else begin
                start_gdialog(379, self_obj, 4, -1, -1);
                gsay_start;
                call Rebel09;
                gsay_end;
                end_dialogue;
              end
            end
          end
        end
      end
    end
  timed_event_p_proc: |
    animate_move_obj_to_tile(self_obj, home_tile, 0);
    not_at_meeting := 1;
  Rebel01: |
    variable LVar0 := 0;
    LVar0 := random(1, 5);
    if (LVar0 == 1) then begin
      LVar0 := message_str(379, 105);
    end
    else begin
      if (LVar0 == 2) then begin
        LVar0 := message_str(379, 106);
      end
      else begin
        if (LVar0 == 3) then begin
          LVar0 := message_str(379, 107);
        end
        else begin
          if (LVar0 == 4) then begin
            if (get_critter_stat(dude_obj, 34) == 0) then begin
              LVar0 := message_str(379, 108);
            end
            else begin
              LVar0 := message_str(379, 109);
            end
          end
          else begin
            if (LVar0 == 5) then begin
              if (get_critter_stat(dude_obj, 34) == 0) then begin
                LVar0 := message_str(379, 110);
              end
              else begin
                LVar0 := message_str(379, 111);
              end
            end
          end
        end
      end
    end
    float_msg(self_obj, LVar0, 0);
  Rebel02: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    call DownReact;
    LVar1 := message_str(379, random(112, 115));
    float_msg(self_obj, LVar1, 2);
  Rebel03: |
    gsay_reply(379, 116);
    giq_option(4, 379, 117, Rebel04, 0);
    giq_option(4, 379, 118, Rebel05, 0);
    giq_option(-3, 379, 119, Rebel08, 0);
  Rebel04: |
    gsay_reply(379, 120);
    giq_option(4, 379, 121, RebelEnd, 0);
  Rebel05: |
    if (global_var(238) != 2) then begin
      gsay_reply(379, 122);
      giq_option(4, 379, 123, Rebel06, 0);
      giq_option(4, 379, 124, Rebel07, 0);
    end
    else begin
      gsay_reply(379, 125);
    end
    giq_option(4, 379, 126, RebelEnd, 0);
  Rebel06: |
    gsay_reply(379, 127);
    giq_option(4, 379, 128, RebelEnd, 0);
    giq_option(4, 379, 129, RebelEnd, 0);
  Rebel07: |
    gsay_reply(379, 130);
    giq_option(4, 379, 131, RebelEnd, 0);
    giq_option(4, 379, 132, Rebel06, 0);
  Rebel08: |
    gsay_reply(379, 133);
    giq_option(-3, 379, 134, RebelEnd, 0);
  Rebel09: |
    gsay_reply(379, 135);
    giq_option(4, 379, 136, RebelCombat, 0);
    giq_option(4, 379, 137, RebelEnd, 0);
    giq_option(-3, 379, 138, RebelEnd, 0);
  RebelEnd: "[]"
  RebelCombat: 'hostile := 1;

    '
  rebel_meeting: |
    if (dest_tile == 0) then begin
      dest_tile := tile_num_in_direction(18310, random(0, 5), 1);
    end
    animate_move_obj_to_tile(self_obj, dest_tile, 0);
    add_timer_event(self_obj, game_ticks(240), 0);
    if (tile_num(self_obj) == dest_tile) then begin
      not_at_meeting := 0;
    end
  sleeping: |
    if (local_var(4) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(4, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(4, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(4, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(4, 1);
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
regulatr:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(252, 100));
  talk_p_proc: |
    if ((global_var(251) == 1) or (global_var(616) == 1)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      float_msg(self_obj, message_str(252, random(134, 138)), 0);
    end
  critter_p_proc: |
    variable LVar0 := 0;
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if ((global_var(251) == 1) or (global_var(616) == 1)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    LVar0 := global_var(341);
    if ((((game_time / 10) - LVar0) >= 5) and (tile_distance_objs(self_obj, dude_obj) <= 4) and (global_var(251) == 0) and (global_var(616) == 0)) then begin
      float_msg(self_obj, message_str(252, random(134, 138)), 0);
      LVar0 := game_time / 10;
      set_global_var(341, LVar0);
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(616, 1);
    end
  destroy_p_proc: |
    set_map_var(1, map_var(1) - 1);
    if (source_obj == dude_obj) then begin
      set_global_var(616, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(160, global_var(160) + 1);
        if ((global_var(160) % 6) == 0) then begin
          set_global_var(155, global_var(155) + 1);
        end
      end
    end
    if (map_var(1) == 0) then begin
      terminate_combat;
    end
  pickup_p_proc: 'set_global_var(616, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      if (obj_is_carrying_obj_pid(self_obj, 41) == 0) then begin
        item_caps_adjust(self_obj, random(1, 10));
      end
      critter_add_trait(self_obj, 1, 6, 89);
      critter_add_trait(self_obj, 1, 5, 29);
      add_timer_event(self_obj, game_ticks(random(1, 3)), 1);
      if (local_var(4) == 0) then begin
        set_map_var(1, map_var(1) + 1);
        set_local_var(4, 1);
      end
      Initialize := 0;
    end
  timed_event_p_proc: |
    animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), random(0, 5), random(1, 5)), 0);
    add_timer_event(self_obj, game_ticks(random(1, 3)), 1);
revulse:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        GVar3 := get_critter_stat(dude_obj, 1);
        if (local_var(0) <= map_var(2)) then begin
          set_local_var(0, map_var(2) + 1);
          GVar0 := GVar3 + map_var(0);
          if (random(1, 10) < GVar0) then begin
            GVar4 := map_var(0);
            if (obj_carrying_pid_obj(dude_obj, 123)) then begin
              if (map_var(1)) then begin
                set_map_var(1, 0);
                display_msg(message_str(740, 107));
              end
            end
            else begin
              if (GVar4 == 0) then begin
                display_msg(message_str(740, 100));
                set_map_var(1, 1);
                set_map_var(0, map_var(0) + 1);
              end
              else begin
                if (GVar4 == 1) then begin
                  if (has_trait(0, dude_obj, 27)) then begin
                    GVar2 := 0;
                  end
                  else begin
                    display_msg(message_str(740, 101));
                    GVar2 := random(1, GVar3);
                    critter_dmg(dude_obj, GVar2, 0 bwor 256);
                  end
                  set_map_var(0, map_var(0) + 1);
                  GVar5 := 1;
                  call blast_party;
                end
                else begin
                  if (GVar4 == 2) then begin
                    if (has_trait(0, dude_obj, 27)) then begin
                      GVar2 := 0;
                    end
                    else begin
                      display_msg(message_str(740, 102));
                      GVar2 := random(1, GVar3) + random(1, GVar3);
                      critter_dmg(dude_obj, GVar2, 0 bwor 256);
                    end
                    set_map_var(0, map_var(0) + 1);
                    GVar5 := 2;
                    call blast_party;
                  end
                  else begin
                    if (GVar4 == 3) then begin
                      if (has_trait(0, dude_obj, 27)) then begin
                        GVar2 := 0;
                      end
                      else begin
                        display_msg(message_str(740, 103));
                        GVar2 := random(1, GVar3) + random(1, GVar3) + random(1, GVar3);
                        critter_dmg(dude_obj, GVar2, 0 bwor 256);
                      end
                      set_map_var(0, map_var(0) + 1);
                      GVar5 := 3;
                      call blast_party;
                    end
                    else begin
                      if (GVar4 == 4) then begin
                        if (has_trait(0, dude_obj, 27)) then begin
                          GVar2 := 0;
                        end
                        else begin
                          display_msg(message_str(740, 104));
                          GVar2 := random(1, GVar3) + random(1, GVar3) + random(1, GVar3);
                          critter_dmg(dude_obj, GVar2, 0 bwor 256);
                          critter_injure(dude_obj, 64);
                          GVar1 := get_critter_stat(dude_obj, 1);
                          set_critter_stat(dude_obj, 1, -1);
                        end
                        set_map_var(0, map_var(0) + 1);
                        GVar5 := 3;
                        call blast_party;
                      end
                      else begin
                        if (GVar4 == 5) then begin
                          if (has_trait(0, dude_obj, 27)) then begin
                            GVar2 := 0;
                          end
                          else begin
                            display_msg(message_str(740, 105));
                            GVar2 := 1;
                            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                              GVar2 := GVar2 + 15;
                            end
                            if (global_var(158) > 2) then begin
                              GVar2 := GVar2 + 20;
                            end
                            critter_dmg(dude_obj, GVar2, 0 bwor 256);
                            GVar1 := get_critter_stat(dude_obj, 4);
                            set_critter_stat(dude_obj, 4, -1);
                          end
                          set_map_var(0, map_var(0) + 1);
                          GVar5 := 4;
                          call blast_party;
                        end
                        else begin
                          if (GVar4 == 6) then begin
                            if (has_trait(0, dude_obj, 27)) then begin
                              GVar2 := 0;
                            end
                            else begin
                              display_msg(message_str(740, 106));
                              GVar1 := get_critter_stat(dude_obj, 1);
                              set_critter_stat(dude_obj, 1, -1);
                              GVar1 := get_critter_stat(dude_obj, 4);
                              set_critter_stat(dude_obj, 4, -1);
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  blast_party: |
    GVar2 := 1;
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      GVar2 := GVar2 + 7;
    end
    if (global_var(158) > 2) then begin
      GVar2 := GVar2 + 10;
    end
    if (global_var(118) == 2) then begin
      if (GVar5 < 4) then begin
        GVar3 := get_critter_stat(party_member_obj(16777292), 1);
        GVar2 := random(1, GVar3);
        if (GVar5 > 1) then begin
          GVar2 := GVar2 + random(1, GVar3);
        end
        if (GVar5 > 2) then begin
          GVar2 := GVar2 + random(1, GVar3);
        end
      end
      critter_dmg(party_member_obj(16777292), GVar2, 0 bwor 256);
    end
    if (global_var(121) == 2) then begin
      if (GVar5 < 4) then begin
        GVar3 := get_critter_stat(party_member_obj(16777426), 1);
        GVar2 := random(1, GVar3);
        if (GVar5 > 1) then begin
          GVar2 := GVar2 + random(1, GVar3);
        end
        if (GVar5 > 2) then begin
          GVar2 := GVar2 + random(1, GVar3);
        end
      end
      critter_dmg(party_member_obj(16777426), GVar2, 0 bwor 256);
    end
    if (global_var(244) == 2) then begin
      if (GVar5 < 4) then begin
        GVar3 := get_critter_stat(party_member_obj(16777518), 1);
        GVar2 := random(1, GVar3);
        if (GVar5 > 1) then begin
          GVar2 := GVar2 + random(1, GVar3);
        end
        if (GVar5 > 2) then begin
          GVar2 := GVar2 + random(1, GVar3);
        end
      end
      critter_dmg(party_member_obj(16777518), GVar2, 0 bwor 256);
    end
    if (global_var(26) == 5) then begin
      if (GVar5 < 4) then begin
        GVar3 := get_critter_stat(party_member_obj(16777279), 1);
        GVar2 := random(1, GVar3);
        if (GVar5 > 1) then begin
          GVar2 := GVar2 + random(1, GVar3);
        end
        if (GVar5 > 2) then begin
          GVar2 := GVar2 + random(1, GVar3);
        end
      end
      critter_dmg(party_member_obj(16777279), GVar2, 0 bwor 256);
    end
rhombus:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 81);
    end
    if (script_action == 22) then begin
      call timeforwhat;
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  do_dialogue: |
    start_gdialog(56, self_obj, 4, 20, 5);
    call get_reaction;
    gsay_start;
    MALE := get_critter_stat(dude_obj, 34) == 0;
    if (ILLEGAL) then begin
      ILLEGAL := 0;
      conmod := (get_critter_stat(dude_obj, 3) - 5) * 10;
      if (local_var(5) == 1) then begin
        call rhombus51;
      end
      else begin
        call rhombus55;
      end
    end
    else begin
      if (MAD) then begin
        if (MAD < 3) then begin
          call anger;
        end
        else begin
          call rhombus05;
        end
      end
      else begin
        call rhombus01;
      end
    end
    gsay_end;
    end_dialogue;
    if (denounce == 1) then begin
      call Remove_Player;
    end
  rhombus01: |
    gsay_reply(56, 105);
    giq_option(4, 56, 106, rhombus02, 50);
    giq_option(4, 56, 107, rhombus03, 51);
    giq_option(-3, 56, 108, rhombus32, 50);
  rhombus02: |
    gsay_reply(56, 109);
    call rhombus00;
  rhombus03: |
    call DownReact;
    gsay_reply(56, 110);
    giq_option(4, 56, 111, rhombus03_01, 50);
    giq_option(4, 56, 112, rhombus05, 51);
  rhombus03_01: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call rhombus04;
    end
    else begin
      call rhombus06;
    end
  rhombus04: |
    gsay_reply(56, 113);
    giq_option(4, 56, 114, rhombus02, 50);
    giq_option(4, 56, 115, rhombus05, 51);
  rhombus05: |
    gsay_message(56, 116, 51);
    call rhombusx1;
  rhombus06: 'call anger;

    '
  rhombus06a: |
    call DownReact;
    call rhombus06;
  rhombus07: |
    Q1 := Q1 + 1;
    if (Q1 > 4) then begin
      call anger;
    end
    else begin
      if (Q1 > 3) then begin
        call annoyed;
      end
      else begin
        if (Q1 > 1) then begin
          gsay_message(56, 179, 50);
        end
        gsay_reply(56, 118);
        giq_option(4, 56, 119, rhombus08, 50);
        giq_option(4, 56, 120, rhombus12, 50);
        giq_option(6, 56, 121, rhombus19, 50);
      end
    end
  rhombus08: |
    gsay_reply(56, 122);
    giq_option(5, 56, 123, rhombus09, 50);
    giq_option(6, 56, 124, rhombus17, 50);
    giq_option(4, 56, 125, rhombus18, 51);
  rhombus09: |
    gsay_reply(56, 126);
    giq_option(5, 56, 127, rhombus09_1, 50);
    giq_option(5, 56, 128, rhombus04, 50);
  rhombus09_1: |
    if (MALE) then begin
      call rhombus11;
    end
    else begin
      if (is_success(do_check(dude_obj, 3, -1))) then begin
        call rhombus10;
      end
      else begin
        call rhombus11;
      end
    end
  rhombus10: |
    set_local_var(6, 1);
    gsay_reply(56, 129);
    giq_option(5, 56, 130, rhombus06a, 51);
    giq_option(5, 56, 131, rhombus02, 50);
  rhombus11: |
    gsay_reply(56, 132);
    giq_option(5, 56, 133, rhombus06a, 51);
    giq_option(5, 56, 134, rhombus02, 50);
  rhombus12: |
    gsay_reply(56, 135);
    giq_option(4, 56, 136, rhombus03, 51);
    giq_option(4, 56, 137, rhombus13, 50);
  rhombus13: |
    gsay_reply(56, 138);
    giq_option(5, 56, 139, rhombus14, 50);
    giq_option(4, 56, 140, rhombus03, 51);
    giq_option(4, 56, 141, rhombus02, 50);
  rhombus14: |
    gsay_reply(56, 142);
    giq_option(5, 56, 143, rhombus15, 50);
    giq_option(5, 56, 144, rhombus03, 51);
  rhombus15: |
    gsay_reply(56, 145);
    giq_option(5, 56, 146, rhombus02, 50);
    giq_option(5, 56, 147, rhombus16, 50);
  rhombus16: 'gsay_message(56, 148, 50);

    '
  rhombus17: |
    gsay_reply(56, 149);
    giq_option(4, 56, 150, rhombus03, 51);
    giq_option(4, 56, 151, rhombus12, 50);
    giq_option(4, 56, 152, rhombus02, 50);
  rhombus18: |
    gsay_message(56, 153, 50);
    call rhombusx1;
  rhombus19: |
    gsay_reply(56, 154);
    giq_option(5, 56, 155, rhombus20, 50);
    giq_option(4, 56, 156, rhombus13, 50);
  rhombus20: |
    gsay_reply(56, 157);
    giq_option(5, 56, 158, rhombus02, 50);
  rhombus21: |
    Q2 := Q2 + 1;
    if (Q2 > 4) then begin
      call anger;
    end
    else begin
      if (Q2 > 3) then begin
        call annoyed;
      end
      else begin
        if (Q2 == 2) then begin
          gsay_message(56, 180, 50);
        end
        else begin
          if (Q2 == 3) then begin
            gsay_message(56, 179, 50);
          end
        end
        gsay_message(56, 159, 50);
        call rhombus00;
      end
    end
  rhombus22: |
    if (local_var(6) == 0) then begin
      call rhombus22a;
    end
    else begin
      call annoyed;
    end
  rhombus22a: |
    gsay_reply(56, 160);
    giq_option(4, 56, 161, rhombus09_1, 50);
    giq_option(4, 56, 162, rhombus00, 50);
  rhombus23: |
    Q4 := Q4 + 1;
    if (Q4 > 4) then begin
      call anger;
    end
    else begin
      if (Q4 > 3) then begin
        call annoyed;
      end
      else begin
        if (global_var(73) == 0) then begin
          set_global_var(73, 1);
        end
        if (global_var(75) == 0) then begin
          set_global_var(75, 1);
        end
        if (Q4 == 2) then begin
          gsay_message(56, 180, 50);
        end
        else begin
          if (Q4 == 3) then begin
            gsay_message(56, 179, 50);
          end
        end
        gsay_message(56, 163, 50);
        call rhombus00;
      end
    end
  rhombus24: |
    call DownReact;
    gsay_message(56, 164, 50);
  rhombus25: |
    call DownReact;
    gsay_message(56, 165, 50);
    call rhombusx1;
  rhombus26: |
    call DownReact;
    gsay_message(56, 166, 50);
  rhombus27: |
    call DownReact;
    gsay_reply(56, 167);
    giq_option(4, 56, 168, rhombus27_1, 50);
    giq_option(4, 56, 169, rhombusx1, 50);
  rhombus27_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call rhombus28;
    end
    else begin
      call rhombus30;
    end
  rhombus28: |
    gsay_reply(56, 170);
    giq_option(4, 56, 171, rhombus28_1, 50);
    giq_option(4, 56, 172, rhombus28_2, 50);
  rhombus28_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, -25))) then begin
      call rhombus29;
    end
    else begin
      call rhombus30;
    end
  rhombus28_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -15))) then begin
      call rhombus29;
    end
    else begin
      call rhombus30;
    end
  rhombus29: |
    gsay_reply(56, 173);
    giq_option(4, 56, 174, rhombusx2, 50);
    giq_option(4, 56, 175, rhombus05, 51);
  rhombus30: |
    gsay_message(56, 176, 50);
    call rhombusx1;
  rhombus31: 'call rhombusx1;

    '
  rhombus32: 'gsay_message(56, 177, 50);

    '
  rhombus33: 'gsay_message(56, 178, 50);

    '
  rhombus35: 'gsay_message(56, 180, 50);

    '
  rhombus37: 'gsay_message(56, 182, 50);

    '
  rhombus38: 'gsay_message(56, 183, 50);

    '
  rhombus39: 'gsay_message(56, 184, 50);

    '
  rhombus40: 'gsay_message(56, 186, 50);

    '
  rhombus41: 'gsay_message(56, 187, 50);

    '
  rhombus42: 'gsay_message(56, 188, 50);

    '
  rhombus43: 'gsay_message(56, 189, 50);

    '
  rhombus44: 'gsay_message(56, 190, 50);

    '
  rhombus45: 'gsay_message(56, 191, 50);

    '
  rhombus46: 'gsay_message(56, 192, 50);

    '
  rhombus47: 'gsay_message(56, 193, 50);

    '
  rhombus48: 'gsay_message(56, 194, 50);

    '
  rhombus51: |
    gsay_reply(56, 170);
    giq_option(4, 56, 172, rhombus51a, 50);
    giq_option(4, 56, 201, rhombus54, 51);
    giq_option(7, 56, 200, rhombus52, 49);
    giq_option(-3, 56, 108, rhombus54, 51);
  rhombus51a: |
    Test := roll_vs_skill(dude_obj, 14, conmod);
    if (is_success(Test)) then begin
      call rhombus52;
    end
    else begin
      call rhombus53;
    end
  rhombus52: |
    gsay_reply(56, 173);
    giq_option(4, 56, 202, rhombusok, 50);
    giq_option(4, 56, 203, rhombus54, 51);
  rhombus53: |
    gsay_message(56, 176, 51);
    call kickout;
  rhombus54: |
    gsay_message(56, 165, 51);
    call kickout;
  rhombus55: |
    gsay_reply(56, 167);
    giq_option(4, 56, 168, rhombus56, 51);
    giq_option(-3, 56, 108, rhombus56, 51);
  rhombus56: |
    Test := roll_vs_skill(dude_obj, 14, conmod);
    if (is_critical(Test)) then begin
      call combat;
    end
    else begin
      call kickout;
    end
  rhombusx: "[]"
  rhombusx1: 'call combat;

    '
  rhombusx2: "[]"
  rhombusok: 'critter_attempt_placement(dude_obj, 22123, 0);

    '
  anger: |
    call DownReact;
    MAD := MAD + 1;
    if (MAD == 1) then begin
      gsay_message(56, 182, 51);
    end
    else begin
      if (MAD == 2) then begin
        gsay_message(56, 117, 51);
      end
      else begin
        if (MAD == 3) then begin
          gsay_message(56, 177, 51);
          call kickout;
        end
      end
    end
  annoyed: |
    call DownReact;
    gsay_message(56, 181, 51);
  combat: 'HOSTILE := 1;

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      HOSTILE := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      HOSTILE := 0;
    end
    if (HOSTILE) then begin
      set_global_var(250, 1);
      HOSTILE := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (obj_can_see_obj(self_obj, dude_obj) and (ILLEGAL == 0)) then begin
        here := tile_num(dude_obj);
        if (tile_distance(here, 24130) < 6) then begin
          ILLEGAL := 1;
        end
        else begin
          if (tile_distance(here, 24322) < 6) then begin
            ILLEGAL := 1;
          end
        end
        if (map_var(19) > 0) then begin
          ILLEGAL := 1;
          set_map_var(19, 0);
        end
        else begin
          if ((tile_num(self_obj) == 22123) and (tile_distance(here, 22930) < 3)) then begin
            float_msg(self_obj, message_str(56, 209), 3);
          end
        end
        if (ILLEGAL) then begin
          loot := 0;
          loot := obj_carrying_pid_obj(dude_obj, 229);
          if (loot) then begin
            rm_obj_from_inven(dude_obj, loot);
            add_obj_to_inven(locker_ptr, loot);
            display_msg(message_str(56, 207));
          end
          set_local_var(5, local_var(5) + 1);
          dialogue_system_enter;
        end
      end
      else begin
        if ((local_var(7) == 1) and (tile_num(self_obj) != 22123)) then begin
          animate_move_obj_to_tile(self_obj, 22123, 0);
        end
        else begin
          if ((local_var(7) == 2) and (tile_num(self_obj) != 23928)) then begin
            animate_move_obj_to_tile(self_obj, 23928, 0);
          end
          else begin
            if (local_var(7) == 3) then begin
              if (local_var(5) > 0) then begin
                sense := 0;
              end
              else begin
                sense := 1;
              end
              if (map_var(19) > sense) then begin
                float_msg(self_obj, message_str(56, 206), 3);
                set_map_var(19, 0);
                set_local_var(7, 2);
                add_timer_event(self_obj, game_ticks(30), 1);
              end
              else begin
                if (tile_num(self_obj) != 23920) then begin
                  animate_move_obj_to_tile(self_obj, 23920, 0);
                end
              end
            end
            else begin
              if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
                if (local_var(8) == 0) then begin
                  set_local_var(8, 1);
                  set_local_var(7, 3);
                end
              end
              else begin
                set_local_var(8, 0);
                set_local_var(7, 1);
              end
            end
          end
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      HOSTILE := 1;
    end
  talk_p_proc: 'call do_dialogue;

    '
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(56, 100));
  timeforwhat: |
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      if (local_var(7) == 2) then begin
        set_local_var(7, 3);
      end
    end
  kickout: 'denounce := 1;

    '
  Remove_Player: |
    set_global_var(108, 5);
    set_global_var(583, 0);
    set_global_var(584, 0);
    set_global_var(585, 0);
    set_global_var(586, 0);
    load_map(13, 1);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
  rhombus00: |
    gsay_reply(0, 0);
    giq_option(4, 56, 101, rhombus07, 50);
    giq_option(4, 56, 102, rhombus21, 50);
    if (local_var(6) == 0) then begin
      giq_option(4, 56, 103, rhombus22, 50);
    end
    giq_option(4, 56, 104, rhombus23, 50);
    giq_option(4, 56, 174, rhombusx, 50);
  rhombus34: 'gsay_message(56, 179, 50);

    '
  rhombus39_1: 'gsay_message(56, 185, 50);

    '
  rhombus49: 'gsay_message(56, 195, 50);

    '
richie:
  start: |
    if (GVar1) then begin
      GVar1 := 0;
      Richie_Ptr := self_obj;
      critter_add_trait(self_obj, 1, 6, 73);
      critter_add_trait(self_obj, 1, 5, 1);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'GVar0 := 1;

    '
  critter_p_proc: |
    if (GVar0) then begin
      GVar0 := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      GVar0 := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if ((map_var(23) == 1) or (map_var(15) > 0) or (map_var(18) == 2)) then begin
      call Richie00;
    end
    else begin
      if (map_var(20) == 0) then begin
        set_map_var(20, 1);
        start_gdialog(599, self_obj, 4, -1, -1);
        gsay_start;
        call Richie01;
        gsay_end;
        end_dialogue;
      end
      else begin
        call Richie02;
      end
    end
    if (GVar2) then begin
      animate_move_obj_to_tile(self_obj, 27450, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(599, 100));
  Richie00: |
    float_msg(self_obj, message_str(599, 101), 2);
    call combat;
  Richie01: |
    gsay_reply(599, 102);
    giq_option(7, 599, 103, Richie01a, 50);
    giq_option(7, 599, 104, Richie01b, 50);
    giq_option(4, 599, 105, Richie06, 51);
    giq_option(4, 599, 106, Richie07, 51);
    giq_option(4, 599, 107, Richie08, 50);
    giq_option(4, 599, 108, Richie09, 51);
    giq_option(-3, 599, 109, Richie09, 50);
  Richie01a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Richie03;
    end
    else begin
      call Richie04;
    end
  Richie01b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Richie05;
    end
    else begin
      call Richie04;
    end
  Richie02: 'float_msg(self_obj, message_str(599, 110), 2);

    '
  Richie03: |
    gsay_message(599, 111, 49);
    GVar2 := 1;
  Richie04: 'gsay_message(599, 112, 51);

    '
  Richie05: |
    gsay_message(599, 113, 49);
    GVar2 := 1;
  Richie06: 'gsay_message(599, 114, 51);

    '
  Richie07: |
    gsay_message(599, 115, 51);
    call combat;
  Richie08: 'gsay_message(599, 116, 50);

    '
  Richie09: |
    gsay_reply(599, 117);
    giq_option(-3, 599, 118, Richie10, 51);
    giq_option(-3, 599, 119, Richie11, 49);
    giq_option(-3, 599, 120, Richie12, 50);
  Richie10: 'gsay_message(599, 121, 50);

    '
  Richie11: 'gsay_message(599, 123, 49);

    '
  Richie12: |
    gsay_reply(599, 123);
    giq_option(-3, 599, 124, Richie10, 51);
    giq_option(-3, 599, 125, Richie11, 49);
    giq_option(-3, 599, 126, Richie13, 50);
  Richie13: 'gsay_message(599, 127, 50);

    '
  RichieLeave: "[]"
  RichieEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'GVar3 := message_str(634, random(100, 105));

    '
ripppris:
  start: |
    if (script_action == 12) then begin
      call critter_p_proc;
    end
    else begin
      if (script_action == 18) then begin
        call destroy_p_proc;
      end
      else begin
        if (script_action == 21) then begin
          call look_at_p_proc;
        end
        else begin
          if (script_action == 11) then begin
            call talk_p_proc;
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(289, 100));
  talk_p_proc: |
    start_gdialog(289, self_obj, 4, -1, -1);
    gsay_start;
    call Prisoner01;
    gsay_end;
    end_dialogue;
  Prisoner01: |
    gsay_reply(289, 101);
    giq_option(3, 289, 102, Prisoner02, 50);
    giq_option(3, 289, 103, Prisoner02, 50);
    giq_option(3, 289, 104, Prisoner03, 50);
  Prisoner02: 'hostile := 1;

    '
  Prisoner03: |
    gsay_reply(289, 105);
    giq_option(3, 289, 106, PrisonerEnd, 50);
  PrisonerEnd: "[]"
rndcity:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 16) then begin
          call map_exit_p_proc;
        end
      end
    end
  map_enter_p_proc: |
    if (metarule(14, 0)) then begin
      dude_pos := random(0, 2);
      dude_rot := random(0, 5);
      if (dude_pos == 0) then begin
        override_map_start(100, 100, 0, dude_rot);
      end
      else begin
        if (dude_pos == 1) then begin
          override_map_start(116, 83, 0, dude_rot);
        end
        else begin
          override_map_start(92, 110, 0, dude_rot);
        end
      end
    end
    if ((global_var(32) != 1) and metarule(14, 0)) then begin
      Dude_tile := tile_num(dude_obj);
      Ranger_rerolls := has_trait(0, dude_obj, 47);
      set_global_var(334, 0);
      while(Encounter_Num == 0) do begin
        Encounter_Num := random(1, 6) + random(1, 6) + random(1, 6);
        if (get_critter_stat(dude_obj, 6) > 8) then begin
          Encounter_Num := Encounter_Num + 2;
        end
        else begin
          if (get_critter_stat(dude_obj, 6) > 7) then begin
            Encounter_Num := Encounter_Num + 1;
          end
          else begin
            if (get_critter_stat(dude_obj, 6) < 3) then begin
              Encounter_Num := Encounter_Num - 1;
            end
          end
        end
        if ((global_var(123) != 3) and (global_var(158) > 2) and random(0, 1)) then begin
          Encounter_Num := 7;
        end
        else begin
          if (Encounter_Num <= 3) then begin
            Encounter_Num := 1;
          end
          else begin
            if (Encounter_Num <= 5) then begin
              Encounter_Num := 2;
            end
            else begin
              if (Encounter_Num <= 8) then begin
                Encounter_Num := 3;
              end
              else begin
                if (Encounter_Num <= 12) then begin
                  Encounter_Num := 4;
                end
                else begin
                  if (Encounter_Num <= 15) then begin
                    Encounter_Num := 5;
                  end
                  else begin
                    Encounter_Num := 6;
                  end
                end
              end
            end
          end
        end
        if (Ranger_rerolls) then begin
          if ((Encounter_Num == 1) or (Encounter_Num == 2) or (Encounter_Num == 3) or (Encounter_Num == 3) or (Encounter_Num == 5) or (Encounter_Num == 7)) then begin
            Encounter_Num := 0;
          end
          Ranger_rerolls := Ranger_rerolls - 1;
        end
      end
      if (global_var(295)) then begin
        Encounter_Num := global_var(295);
        set_global_var(295, 0);
        display_msg("City encounter type: " + Encounter_Num);
      end
      if (Encounter_Num == 1) then begin
        call City1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call City2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call City3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call City4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call City5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call City6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
    call Lighting;
  map_update_p_proc: 'call Lighting;

    '
  map_exit_p_proc: "[]"
  stranger: |
    if (has_trait(0, dude_obj, 46) and (global_var(601) == 0) and random(0, 1)) then begin
      Critter_type := 16777520;
      Critter_script := 856;
      Critter_direction := random(0, 5);
      Outer_ring := 7;
      Inner_ring := 4;
      call Place_critter;
      Critter_direction := dude_rot + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      anim(Critter, 1000, Critter_direction);
      Item := create_object_sid(40, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, 2);
      Item := create_object_sid(25, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(21, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := item_caps_adjust(Critter, random(7, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      set_global_var(288, 23);
    end
  Lighting: |
    variable LVar0 := 0;
    LVar0 := game_time_hour;
    if ((LVar0 >= 600) and (LVar0 < 700)) then begin
      set_light_level(LVar0 - 600 + 40);
    end
    else begin
      if ((LVar0 >= 700) and (LVar0 < 1800)) then begin
        set_light_level(100);
      end
      else begin
        if ((LVar0 >= 1800) and (LVar0 < 1900)) then begin
          set_light_level(100 - (LVar0 - 1800));
        end
        else begin
          set_light_level(40);
        end
      end
    end
  Place_critter: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    Critter := create_object_sid(Critter_type, 0, 0, Critter_script);
    LVar2 := random(Inner_ring, Outer_ring);
    LVar0 := random(0, 5);
    Critter_tile := tile_num_in_direction(Dude_tile, Critter_direction, LVar2);
    LVar1 := tile_num_in_direction(Critter_tile, LVar0, LVar2 / 2);
    if ((tile_distance(Dude_tile, LVar1) <= Outer_ring) and (tile_distance(Dude_tile, LVar1) >= Inner_ring)) then begin
      Critter_tile := tile_num_in_direction(Critter_tile, LVar0, LVar2 / 2);
    end
    critter_attempt_placement(Critter, Critter_tile, 0);
  hunters: |
    Inner_ring := 8;
    Outer_ring := 5;
    group_angle := random(0, 5);
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777349;
    Critter_script := 241;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(23, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(36, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 4 * (has_trait(0, dude_obj, 40) + 1));
    Item := create_object_sid(17, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := item_caps_adjust(Critter, random(5, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    Item := create_object_sid(144, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2);
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777467;
    Critter_script := 383;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(7, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(2, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    if (random(0, 2) == 0) then begin
      Item := item_caps_adjust(Critter, random(5, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    end
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777472;
    Critter_script := 383;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(143, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(34, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 3 * (has_trait(0, dude_obj, 40) + 1));
    Item := create_object_sid(2, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(14, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2 * (has_trait(0, dude_obj, 40) + 1));
    if (random(0, 2) == 0) then begin
      Item := item_caps_adjust(Critter, random(5, 40) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    end
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777462;
    Critter_script := 383;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(18, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(31, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2 * (has_trait(0, dude_obj, 40) + 1));
    Item := create_object_sid(2, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    if (random(0, 2) == 0) then begin
      Item := item_caps_adjust(Critter, random(5, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    end
    call stranger;
  City1: |
    display_msg(message_str(244, 100));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 8;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
    Tot_Critter_A := random(2, 3);
    group_angle := random(0, 5);
    Critter_type := 16777403;
    Critter_script := 850;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2 * 2) - 2);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      if (random(0, 2) == 0) then begin
        if (random(0, 1) == 1) then begin
          Item := create_object_sid(11, 0, 0, -1);
        end
        else begin
          Item := create_object_sid(12, 0, 0, -1);
        end
      end
      else begin
        Item := create_object_sid(234, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(40, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, 1);
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(5, 20) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      end
      Item := create_object_sid(35, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, 1 + has_trait(0, dude_obj, 40));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    if (random(0, 2) == 0) then begin
      Critter_direction := random(0, 5);
      Critter_script := 854;
      Critter_type := 16777241;
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Item := create_object_sid(12, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := item_caps_adjust(Critter, random(5, 20) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    end
    call stranger;
  City2: |
    variable LVar0 := 0;
    display_msg(message_str(244, 101));
    group_angle := random(0, 5);
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      Critter := create_object_sid(33554433, 0, 0, -1);
      Critter_tile := tile_num_in_direction(Dude_tile, group_angle, 4);
      critter_attempt_placement(Critter, Critter_tile, 0);
      Critter := create_object_sid(33554433, 0, 0, -1);
      if (group_angle == 0) then begin
        Item := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Item := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Item := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Item := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Item := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Item := 2;
                end
              end
            end
          end
        end
      end
      Critter_tile := tile_num_in_direction(Dude_tile, Item, 4);
      critter_attempt_placement(Critter, Critter_tile, 0);
    end
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
    Tot_Critter_A := random(3, 6);
    Tot_Critter_B := random(3, 5);
    Critter_type := 16777419;
    Critter_script := 749;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      LVar0 := random(0, 2);
      if (LVar0 == 0) then begin
        Item := create_object_sid(18, 0, 0, -1);
      end
      else begin
        if (LVar0 == 1) then begin
          Item := create_object_sid(21, 0, 0, -1);
        end
        else begin
          Item := create_object_sid(8, 0, 0, -1);
        end
      end
      add_obj_to_inven(Critter, Item);
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(5, 25) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    victim := Critter;
    Critter_type := 16777472;
    Critter_script := 751;
    if (group_angle == 0) then begin
      group_angle := 3;
    end
    else begin
      if (group_angle == 1) then begin
        group_angle := 4;
      end
      else begin
        if (group_angle == 2) then begin
          group_angle := 5;
        end
        else begin
          if (group_angle == 3) then begin
            group_angle := 0;
          end
          else begin
            if (group_angle == 4) then begin
              group_angle := 1;
            end
            else begin
              if (group_angle == 5) then begin
                group_angle := 2;
              end
            end
          end
        end
      end
    end
    while(Tot_Critter_B) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      if (random(0, 1)) then begin
        Item := create_object_sid(4, 0, 0, -1);
      end
      else begin
        Item := create_object_sid(7, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(4, 25) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      end
      Tot_Critter_B := Tot_Critter_B - 1;
    end
    attack_setup(Critter, victim);
    call stranger;
  City3: |
    display_msg(message_str(244, 102));
    Tot_Critter_A := random(2, 4);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    group_angle := random(0, 5);
    Critter_type := 16777419;
    Critter_script := 749;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + random(0, 2 * 2) - 2;
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (Critter_direction == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (Critter_direction == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (Critter_direction == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (Critter_direction == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (Critter_direction == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (Critter_direction == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      anim(Critter, 1000, Critter_direction);
      if (random(0, 1)) then begin
        Item := create_object_sid(8, 0, 0, -1);
      end
      else begin
        Item := create_object_sid(9, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(4, 25) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_direction := group_angle + random(0, 2 * 2) - 2;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    call Place_critter;
    if (Critter_direction == 0) then begin
      Critter_direction := 3;
    end
    else begin
      if (Critter_direction == 1) then begin
        Critter_direction := 4;
      end
      else begin
        if (Critter_direction == 2) then begin
          Critter_direction := 5;
        end
        else begin
          if (Critter_direction == 3) then begin
            Critter_direction := 0;
          end
          else begin
            if (Critter_direction == 4) then begin
              Critter_direction := 1;
            end
            else begin
              if (Critter_direction == 5) then begin
                Critter_direction := 2;
              end
            end
          end
        end
      end
    end
    anim(Critter, 1000, Critter_direction);
    Item := create_object_sid(47, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := item_caps_adjust(Critter, random(18, 150) * (has_trait(0, dude_obj, 20) + 1));
    if (random(0, 1)) then begin
      Item := create_object_sid(38, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      if (has_trait(0, dude_obj, 40)) then begin
        Item := create_object_sid(38, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(6, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(31, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      if (has_trait(0, dude_obj, 40)) then begin
        Item := create_object_sid(31, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(4, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    if (start_attack == 0) then begin
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    start_attack := 1;
    call stranger;
  City4: |
    display_msg(message_str(244, 103));
    Tot_Critter_A := random(5, 15);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 1;
    group_angle := random(0, 5);
    Item := random(0, 1);
    Critter_type := 16777264;
    Critter_script := 222;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + random(0, 1 * 2) - 1;
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (Item) then begin
        if (random(0, 1)) then begin
          Critter_direction := 3;
        end
        else begin
          Critter_direction := 4;
        end
        anim(Critter, 1000, Critter_direction);
      end
      else begin
        if (random(0, 1)) then begin
          Critter_direction := 1;
        end
        else begin
          Critter_direction := 2;
        end
        anim(Critter, 1000, Critter_direction);
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    if (start_attack == 0) then begin
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    start_attack := 1;
    call stranger;
  City5: |
    display_msg(message_str(244, 104));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Tot_Critter_A := random(3, 5);
    group_angle := random(0, 5);
    Critter_type := 16777419;
    Critter_script := 749;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + random(0, 1 * 2) - 1;
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      if (random(0, 1)) then begin
        Item := create_object_sid(8, 0, 0, -1);
      end
      else begin
        Item := create_object_sid(9, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(4, 25) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777254;
    Critter_script := 749;
    Critter_direction := group_angle + random(0, 1 * 2) - 1;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(47, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := item_caps_adjust(Critter, random(19, 135) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    if (random(0, 1)) then begin
      Item := create_object_sid(38, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(6, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(31, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(4, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    if (start_attack == 0) then begin
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    start_attack := 1;
    call stranger;
  City6: |
    display_msg(message_str(244, 105));
    Tot_Critter_A := random(3, 4);
    if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
      Outer_ring := 4;
      Inner_ring := 2;
    end
    else begin
      Outer_ring := 3;
      Inner_ring := 2;
    end
    Critter_type := 16777264;
    Critter_script := 222;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 5);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    if (start_attack == 0) then begin
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    start_attack := 1;
    call stranger;
rndcoast:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 16) then begin
          call map_exit_p_proc;
        end
      end
    end
  map_enter_p_proc: |
    dude_pos := random(0, 2);
    dude_rot := random(0, 5);
    if ((global_var(32) != 1) and metarule(14, 0)) then begin
      Ranger_rerolls := has_trait(0, dude_obj, 47);
      set_global_var(334, 0);
      while(Encounter_Num == 0) do begin
        Encounter_Num := random(1, 6) + random(1, 6) + random(1, 6);
        if (get_critter_stat(dude_obj, 6) > 8) then begin
          Encounter_Num := Encounter_Num + 2;
        end
        else begin
          if (get_critter_stat(dude_obj, 6) > 7) then begin
            Encounter_Num := Encounter_Num + 1;
          end
          else begin
            if (get_critter_stat(dude_obj, 6) < 3) then begin
              Encounter_Num := Encounter_Num - 1;
            end
          end
        end
        if ((global_var(123) != 3) and (global_var(158) > 2) and random(0, 1)) then begin
          Encounter_Num := 7;
        end
        else begin
          if (Encounter_Num <= 3) then begin
            Encounter_Num := 1;
          end
          else begin
            if (Encounter_Num <= 5) then begin
              Encounter_Num := 2;
            end
            else begin
              if (Encounter_Num <= 8) then begin
                Encounter_Num := 3;
              end
              else begin
                if (Encounter_Num <= 12) then begin
                  Encounter_Num := 4;
                end
                else begin
                  if (Encounter_Num <= 15) then begin
                    Encounter_Num := 5;
                  end
                  else begin
                    Encounter_Num := 6;
                  end
                end
              end
            end
          end
        end
        if (Ranger_rerolls) then begin
          if ((Encounter_Num == 1) or (Encounter_Num == 2) or (Encounter_Num == 4) or (Encounter_Num == 5) or (Encounter_Num == 7)) then begin
            Encounter_Num := 0;
          end
          Ranger_rerolls := Ranger_rerolls - 1;
        end
      end
      if (global_var(295) > 0) then begin
        Encounter_Num := global_var(295);
        set_global_var(295, 0);
        debug_msg("Coast encounter type: " + Encounter_Num);
      end
      call choose_start;
      Dude_tile := tile_num(dude_obj);
      if (Encounter_Num == 1) then begin
        call Coast1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call Coast2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call Coast3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call Coast4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call Coast5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call Coast6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
    else begin
      if (metarule(14, 0)) then begin
        if (dude_pos == 0) then begin
          override_map_start(92, 98, 0, dude_rot);
        end
        else begin
          if (dude_pos == 1) then begin
            override_map_start(95, 109, 0, dude_rot);
          end
          else begin
            override_map_start(92, 101, 0, dude_rot);
          end
        end
      end
    end
    call Lighting;
  map_update_p_proc: 'call Lighting;

    '
  map_exit_p_proc: "[]"
  stranger: |
    if (has_trait(0, dude_obj, 46) and (global_var(601) == 0) and random(0, 1)) then begin
      Critter_type := 16777520;
      Critter_script := 856;
      Critter_direction := random(0, 1);
      Outer_ring := 7;
      Inner_ring := 4;
      call Place_critter;
      Critter_direction := dude_rot + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      anim(Critter, 1000, Critter_direction);
      Item := create_object_sid(40, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, 2);
      Item := create_object_sid(116, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := item_caps_adjust(Critter, random(7, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      set_global_var(288, 12);
    end
  Lighting: |
    variable LVar0 := 0;
    LVar0 := game_time_hour;
    if ((LVar0 >= 600) and (LVar0 < 700)) then begin
      set_light_level(LVar0 - 600 + 40);
    end
    else begin
      if ((LVar0 >= 700) and (LVar0 < 1800)) then begin
        set_light_level(100);
      end
      else begin
        if ((LVar0 >= 1800) and (LVar0 < 1900)) then begin
          set_light_level(100 - (LVar0 - 1800));
        end
        else begin
          set_light_level(40);
        end
      end
    end
  Place_critter: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    Critter := create_object_sid(Critter_type, 0, 0, Critter_script);
    LVar2 := random(Inner_ring, Outer_ring);
    if (restrict_range) then begin
      LVar0 := random(0, 2);
    end
    else begin
      LVar0 := random(0, 5);
    end
    Critter_tile := tile_num_in_direction(Dude_tile, Critter_direction, LVar2);
    LVar1 := tile_num_in_direction(Critter_tile, LVar0, LVar2 / 2);
    if ((tile_distance(Dude_tile, LVar1) <= Outer_ring) and (tile_distance(Dude_tile, LVar1) >= Inner_ring)) then begin
      Critter_tile := tile_num_in_direction(Critter_tile, LVar0, LVar2 / 2);
    end
    critter_attempt_placement(Critter, Critter_tile, 0);
  hunters: |
    Inner_ring := 8;
    Outer_ring := 5;
    group_angle := random(0, 5);
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777349;
    Critter_script := 241;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(23, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(36, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 4 * (has_trait(0, dude_obj, 40) + 1));
    Item := create_object_sid(17, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := item_caps_adjust(Critter, random(5, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    Item := create_object_sid(144, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2);
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777467;
    Critter_script := 383;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(7, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(2, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    if (random(0, 2) == 0) then begin
      Item := item_caps_adjust(Critter, random(5, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    end
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777472;
    Critter_script := 383;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(143, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(34, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 3 * (has_trait(0, dude_obj, 40) + 1));
    Item := create_object_sid(2, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(14, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2 * (has_trait(0, dude_obj, 40) + 1));
    if (random(0, 2) == 0) then begin
      Item := item_caps_adjust(Critter, random(5, 40) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    end
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777462;
    Critter_script := 383;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(18, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(31, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2 * (has_trait(0, dude_obj, 40) + 1));
    Item := create_object_sid(2, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    if (random(0, 2) == 0) then begin
      Item := item_caps_adjust(Critter, random(5, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    end
    call stranger;
  Coast1: |
    display_msg(message_str(245, 100));
    display_msg(message_str(245, 104));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 7;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 4;
    Tot_Critter_A := random(2, 4);
    Critter_type := 16777261;
    Critter_script := 953;
    if (restrict_range) then begin
      group_angle := random(0, 1);
    end
    else begin
      group_angle := random(0, 5);
    end
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 1 * 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Outer_ring := 3;
    Inner_ring := 2;
    Critter_type := 16777261;
    Critter_script := 953;
    if (restrict_range) then begin
      Critter_direction := random(0, 1);
    end
    else begin
      Critter_direction := group_angle + (random(0, 1 * 2) - 1);
    end
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Outer_ring := 6;
    Inner_ring := 3;
    Critter_type := 16777254;
    Critter_script := -1;
    if (restrict_range) then begin
      Critter_direction := random(0, 1);
    end
    else begin
      Critter_direction := random(0, 5);
    end
    call Place_critter;
    Item := create_object_sid(40, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(34, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
    Item := item_caps_adjust(Critter, random(4, 25) * (1 + (2 * has_trait(0, dude_obj, 20))));
    kill_critter(Critter, 61);
    call stranger;
  Coast2: |
    display_msg(message_str(112, 313));
    Tot_Critter_A := random(4, 7);
    if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
      Outer_ring := 6;
      Inner_ring := 3;
    end
    else begin
      Outer_ring := 4;
      Inner_ring := 3;
    end
    Critter_type := 16777284;
    Critter_script := 735;
    while(Tot_Critter_A) do begin
      Critter_direction := random(1, 2);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    call stranger;
  Coast3: |
    display_msg(message_str(245, 101));
    Outer_ring := 4;
    Inner_ring := 1;
    Tot_Critter_A := random(8, 12);
    Critter_type := 16777264;
    Critter_script := 222;
    if (restrict_range) then begin
      group_angle := random(0, 1);
    end
    else begin
      group_angle := random(0, 5);
    end
    while(Tot_Critter_A) do begin
      if (restrict_range) then begin
        Critter_direction := group_angle;
      end
      else begin
        Critter_direction := group_angle + random(0, 1 * 2) - 1;
      end
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    call stranger;
  Coast4: |
    display_msg(message_str(245, 102));
    set_global_var(290, 0);
    set_global_var(291, 0);
    set_global_var(292, 0);
    group_angle := random(0, 2);
    MapX := (Dude_tile % 200) + 8;
    MapY := (Dude_tile / 200) + 6;
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      Critter := create_object_sid(33555044, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 4) * 200) + (MapX - 2), 0);
      Critter := create_object_sid(33555044, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 6) * 200) + (MapX + 4), 0);
      Critter := create_object_sid(33554640, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 5) * 200) + (MapX - 4), 0);
      Critter := create_object_sid(33554640, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 6) * 200) + (MapX - 7), 0);
      Critter := create_object_sid(33554641, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 7) * 200) + MapX, 0);
      Critter := create_object_sid(33554640, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 4) * 200) + (MapX + 2), 0);
    end
    else begin
      Critter := create_object_sid(33554710, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 4) * 200) + (MapX - 3), 0);
      Critter := create_object_sid(33554711, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 4) * 200) + (MapX - 3), 0);
      Critter := create_object_sid(33554712, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 4) * 200) + (MapX - 3), 0);
      Critter := create_object_sid(33554866, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 4) * 200) + (MapX - 3), 0);
      Critter := create_object_sid(33554710, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 6) * 200) + (MapX + 4), 0);
      Critter := create_object_sid(33554711, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 6) * 200) + (MapX + 4), 0);
      Critter := create_object_sid(33554712, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 6) * 200) + (MapX + 4), 0);
      Critter := create_object_sid(33554866, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 6) * 200) + (MapX + 4), 0);
      Critter := create_object_sid(33554435, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 5) * 200) + (MapX + 1), 0);
      Critter := create_object_sid(33554529, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 5) * 200) + (MapX + 2), 0);
      Critter := create_object_sid(33554530, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 7) * 200) + (MapX + 1), 0);
      Critter := create_object_sid(33554528, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 2) * 200) + MapX, 0);
      Critter := create_object_sid(33554527, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 5) * 200) + (MapX - 1), 0);
      Critter := create_object_sid(33554833 + 1, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 2) * 200) + (MapX - 3), 0);
      Critter := create_object_sid(33554833 + 1, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 8) * 200) + (MapX + 5), 0);
      Critter := create_object_sid(33554833 + 2, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 4) * 200) + (MapX + 4), 0);
    end
    Outer_ring := 9;
    Inner_ring := 6;
    Tot_Critter_A := random(3, 4);
    set_global_var(289, Tot_Critter_A);
    Critter_script := 750;
    while(Tot_Critter_A) do begin
      if (random(0, 1)) then begin
        Critter_type := 16777247;
        Item := create_object_sid(7, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      else begin
        Critter_type := 16777419;
        Item := create_object_sid(21, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 1) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(6, 15) * (1 + (1 * has_trait(0, dude_obj, 20))));
      end
      if (random(0, 1)) then begin
        if (random(0, 2) == 0) then begin
          Item := create_object_sid(125, 0, 0, -1);
        end
        else begin
          Item := create_object_sid(124, 0, 0, -1);
        end
        add_obj_to_inven(Critter, Item);
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    victim := Critter;
    Critter_script := 713;
    if (group_angle == 0) then begin
      group_angle := 3;
    end
    else begin
      if (group_angle == 1) then begin
        group_angle := 4;
      end
      else begin
        if (group_angle == 2) then begin
          group_angle := 5;
        end
        else begin
          if (group_angle == 3) then begin
            group_angle := 0;
          end
          else begin
            if (group_angle == 4) then begin
              group_angle := 1;
            end
            else begin
              if (group_angle == 5) then begin
                group_angle := 2;
              end
            end
          end
        end
      end
    end
    Tot_Critter_A := random(3, 5);
    set_global_var(288, 6);
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 5);
      if (Critter_direction == 0) then begin
        Critter_type := 16777386;
      end
      else begin
        if (Critter_direction == 1) then begin
          Critter_type := 16777248;
        end
        else begin
          if (Critter_direction == 2) then begin
            Critter_type := 16777387;
          end
          else begin
            if (Critter_direction == 3) then begin
              Critter_type := 16777388;
            end
            else begin
              Critter_type := 16777236;
            end
          end
        end
      end
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(2, 4) * (1 + (1 * has_trait(0, dude_obj, 20))));
      end
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777258;
    Critter_script := 713;
    set_global_var(288, 68);
    Tot_Critter_A := random(1, 2);
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (random(0, 2) == 0) then begin
        Item := create_object_sid(163, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(2, 4) * (1 + (1 * has_trait(0, dude_obj, 20))));
      end
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777252;
    Critter_script := 713;
    set_global_var(288, 8);
    Critter_direction := group_angle + (random(0, 2) - 1);
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    call Place_critter;
    if (group_angle == 0) then begin
      Critter_direction := 3;
    end
    else begin
      if (group_angle == 1) then begin
        Critter_direction := 4;
      end
      else begin
        if (group_angle == 2) then begin
          Critter_direction := 5;
        end
        else begin
          if (group_angle == 3) then begin
            Critter_direction := 0;
          end
          else begin
            if (group_angle == 4) then begin
              Critter_direction := 1;
            end
            else begin
              if (group_angle == 5) then begin
                Critter_direction := 2;
              end
            end
          end
        end
      end
    end
    if (random(0, 2) == 0) then begin
      Critter_direction := Critter_direction + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
    end
    anim(Critter, 1000, Critter_direction);
    attack_setup(victim, Critter);
    call stranger;
  Coast5: |
    display_msg(message_str(112, 313));
    Outer_ring := 6;
    Inner_ring := 4;
    Tot_Critter_A := random(4, 6);
    Critter_type := 16777284;
    Critter_script := 735;
    if (restrict_range) then begin
      group_angle := random(1, 2);
    end
    else begin
      group_angle := random(0, 5);
    end
    while(Tot_Critter_A) do begin
      if (restrict_range) then begin
        Critter_direction := group_angle;
      end
      else begin
        Critter_direction := group_angle + random(0, 1 * 2) - 1;
      end
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    call stranger;
  Coast6: |
    display_msg(message_str(245, 103));
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      Critter := create_object_sid(33554640, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY - 4) * 200) + (MapX + 2), 0);
      Critter := create_object_sid(33554641, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 2) * 200) + (MapX + 2), 0);
      Critter := create_object_sid(33555044, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY - 1) * 200) + (MapX + 2), 0);
      Critter := create_object_sid(33554747, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 6) * 200) + (MapX + 6), 0);
    end
    else begin
      Critter := create_object_sid(33554833 + 1, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY - 3) * 200) + (MapX + 3), 0);
      Critter := create_object_sid(33554833 + 1, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 2) * 200) + (MapX + 2), 0);
      Critter := create_object_sid(33554710, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY - 1) * 200) + (MapX + 2), 0);
      Critter := create_object_sid(33554711, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY - 1) * 200) + (MapX + 2), 0);
      Critter := create_object_sid(33554712, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY - 1) * 200) + (MapX + 2), 0);
      Critter := create_object_sid(33554866, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY - 1) * 200) + (MapX + 2), 0);
      Critter := create_object_sid(33554747, 0, 0, -1);
      critter_attempt_placement(Critter, ((MapY + 6) * 200) + (MapX + 6), 0);
    end
    Critter := create_object_sid(16777229, 0, 0, 644);
    critter_attempt_placement(Critter, ((MapY + 2) * 200) + (MapX + 11), 0);
    anim(Critter, 1000, 3);
    Item := create_object_sid(7, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(109, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(18, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(31, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2);
    Item := item_caps_adjust(Critter, random(50, 100) * (has_trait(0, dude_obj, 20) + 1));
    Item := create_object_sid(81, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 3);
    Critter := create_object_sid(16777258, 0, 0, 645);
    critter_attempt_placement(Critter, ((MapY + 4) * 200) + (MapX + 10), 0);
    anim(Critter, 1000, 3);
    Item := create_object_sid(7, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(103, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := item_caps_adjust(Critter, random(2, 3) * (has_trait(0, dude_obj, 20) + 1));
  choose_start: |
    if ((Encounter_Num == 2) or (Encounter_Num == 5)) then begin
      override_map_start(92, 97, 0, dude_rot);
    end
    else begin
      if (Encounter_Num == 6) then begin
        if (cur_map_index == 20) then begin
          MapX := 113;
          MapY := 93;
          override_map_start(MapX, MapY, 0, dude_rot);
        end
        else begin
          MapX := 103;
          MapY := 94;
          override_map_start(MapX, MapY, 0, dude_rot);
        end
      end
      else begin
        if ((Encounter_Num == 4) or (Encounter_Num == 7)) then begin
          override_map_start(94, 98, 0, dude_rot);
        end
        else begin
          if (dude_pos == 0) then begin
            override_map_start(99, 102, 0, dude_rot);
          end
          else begin
            restrict_range := 1;
            if (dude_pos == 1) then begin
              override_map_start(108, 94, 0, dude_rot);
            end
            else begin
              override_map_start(111, 104, 0, dude_rot);
            end
          end
        end
      end
    end
rnddesrt:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 16) then begin
          call map_exit_p_proc;
        end
      end
    end
  map_enter_p_proc: |
    dude_rot := random(0, 5);
    set_global_var(335, 0);
    if ((global_var(32) != 1) and metarule(14, 0)) then begin
      Ranger_rerolls := has_trait(0, dude_obj, 47);
      set_global_var(334, 0);
      while(Encounter_Num == 0) do begin
        Encounter_Num := random(1, 6) + random(1, 6) + random(1, 6);
        if (get_critter_stat(dude_obj, 6) > 8) then begin
          Encounter_Num := Encounter_Num + 2;
        end
        else begin
          if (get_critter_stat(dude_obj, 6) > 6) then begin
            Encounter_Num := Encounter_Num + 1;
          end
          else begin
            if (get_critter_stat(dude_obj, 6) < 3) then begin
              Encounter_Num := Encounter_Num - 1;
            end
          end
        end
        if ((global_var(123) != 3) and (global_var(158) > 2) and random(0, 1)) then begin
          Encounter_Num := 7;
        end
        else begin
          if (Encounter_Num <= 3) then begin
            Encounter_Num := 1;
          end
          else begin
            if (Encounter_Num <= 5) then begin
              Encounter_Num := 2;
            end
            else begin
              if (Encounter_Num <= 8) then begin
                Encounter_Num := 3;
              end
              else begin
                if (Encounter_Num <= 12) then begin
                  Encounter_Num := 4;
                end
                else begin
                  if (Encounter_Num <= 15) then begin
                    Encounter_Num := 5;
                  end
                  else begin
                    Encounter_Num := 6;
                  end
                end
              end
            end
          end
        end
        if (global_var(65) == 0) then begin
          call North_table;
        end
        else begin
          if (global_var(65) == 1) then begin
            call South_table;
          end
          else begin
            if (global_var(65) == 5) then begin
              call Shady_table;
            end
            else begin
              if (global_var(65) == 6) then begin
                call Raider_table;
              end
              else begin
                if (global_var(65) == 7) then begin
                  call Junk_table;
                end
                else begin
                  if (global_var(65) == 8) then begin
                    call Hub_table;
                  end
                  else begin
                    if (global_var(65) == 9) then begin
                      call Necrop_table;
                    end
                    else begin
                      if (global_var(65) == 10) then begin
                        call Steel_table;
                      end
                      else begin
                        if (global_var(65) == 11) then begin
                          call Vats_table;
                        end
                        else begin
                          if (global_var(65) == 12) then begin
                            call Glow_table;
                          end
                          else begin
                            if (global_var(65) == 14) then begin
                              call Death_table;
                            end
                            else begin
                              if (global_var(65) == 13) then begin
                                call Bone_table;
                              end
                              else begin
                                if (random(0, 1)) then begin
                                  call North_table;
                                end
                                else begin
                                  call South_table;
                                end
                              end
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    else begin
      if (metarule(14, 0)) then begin
        dude_pos := random(0, 3);
        Dude_tile := tile_num(dude_obj);
        call Scenes;
        if (dude_pos == 0) then begin
          override_map_start(109, 72, 0, dude_rot);
        end
        else begin
          if (dude_pos == 1) then begin
            override_map_start(131, 102, 0, dude_rot);
          end
          else begin
            if (dude_pos == 2) then begin
              override_map_start(90, 112, 0, dude_rot);
            end
            else begin
              override_map_start(80, 86, 0, dude_rot);
            end
          end
        end
      end
    end
    call Lighting;
  map_update_p_proc: 'call Lighting;

    '
  map_exit_p_proc: "[]"
  stranger: |
    variable LVar0 := 1;
    if (has_trait(0, dude_obj, 46) and (global_var(601) == 0) and random(0, 1)) then begin
      Critter_type := 16777520;
      Critter_script := 856;
      Critter_direction := random(0, 5);
      Outer_ring := 7;
      Inner_ring := 4;
      call Place_critter;
      Critter_direction := dude_rot + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      anim(Critter, 1000, Critter_direction);
      Item := create_object_sid(7, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(40, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, 2);
      Item := item_caps_adjust(Critter, random(7, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      LVar0 := global_var(288);
      if (LVar0 == 1) then begin
        set_global_var(288, 10);
      end
      else begin
        if (LVar0 == 2) then begin
          set_global_var(288, 9);
        end
        else begin
          set_global_var(288, 15);
        end
      end
    end
  Lighting: |
    variable LVar0 := 0;
    LVar0 := game_time_hour;
    if ((LVar0 >= 600) and (LVar0 < 700)) then begin
      set_light_level(LVar0 - 600 + 40);
    end
    else begin
      if ((LVar0 >= 700) and (LVar0 < 1800)) then begin
        set_light_level(100);
      end
      else begin
        if ((LVar0 >= 1800) and (LVar0 < 1900)) then begin
          set_light_level(100 - (LVar0 - 1800));
        end
        else begin
          set_light_level(40);
        end
      end
    end
  choose_start: |
    dude_pos := random(0, 3);
    if (global_var(65) == 1) then begin
      if (Encounter_Num == 1) then begin
        override_map_start(93, 91, 0, 1);
      end
      else begin
        if (dude_pos == 0) then begin
          override_map_start(109, 72, 0, dude_rot);
        end
        else begin
          if (dude_pos == 1) then begin
            override_map_start(131, 102, 0, dude_rot);
          end
          else begin
            if (dude_pos == 2) then begin
              override_map_start(90, 112, 0, dude_rot);
            end
            else begin
              override_map_start(80, 86, 0, dude_rot);
            end
          end
        end
      end
    end
    else begin
      if (global_var(65) == 10) then begin
        if ((Encounter_Num == 1) or (Encounter_Num == 5) or (Encounter_Num == 6)) then begin
          override_map_start(100, 100, 0, dude_rot);
        end
        else begin
          if (dude_pos == 0) then begin
            override_map_start(109, 72, 0, dude_rot);
          end
          else begin
            if (dude_pos == 1) then begin
              override_map_start(131, 102, 0, dude_rot);
            end
            else begin
              if (dude_pos == 2) then begin
                override_map_start(90, 112, 0, dude_rot);
              end
              else begin
                override_map_start(80, 86, 0, dude_rot);
              end
            end
          end
        end
      end
      else begin
        if (dude_pos == 0) then begin
          override_map_start(109, 72, 0, dude_rot);
        end
        else begin
          if (dude_pos == 1) then begin
            override_map_start(131, 102, 0, dude_rot);
          end
          else begin
            if (dude_pos == 2) then begin
              override_map_start(90, 112, 0, dude_rot);
            end
            else begin
              override_map_start(80, 86, 0, dude_rot);
            end
          end
        end
      end
    end
    Dude_tile := tile_num(dude_obj);
    call Scenes;
  North_table: |
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 1) or (Encounter_Num == 2) or (Encounter_Num == 3) or (Encounter_Num == 4) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Northern Desert encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call North1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call North2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call North3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call North4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call North5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call North6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  South_table: |
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 2) or (Encounter_Num == 4) or (Encounter_Num == 5) or (Encounter_Num == 6) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Southern Desert encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call South1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call South2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call South3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call South4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call South5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call South6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  Shady_table: |
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 1) or (Encounter_Num == 3) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Shady Sands Desert encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call Shady1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call Shady2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call Shady3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call Shady4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call Shady5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call Shady6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  Raider_table: |
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 1) or (Encounter_Num == 3) or (Encounter_Num == 4) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Raiders Desert encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call Raider1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call Raider2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call Raider3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call Raider4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call Raider5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call Raider6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  Junk_table: |
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 1) or (Encounter_Num == 2) or (Encounter_Num == 3) or (Encounter_Num == 4) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Junk Town Desert encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call Junk1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call Junk2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call Junk3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call Junk4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call Junk5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call Junk6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  Hub_table: |
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 2) or (Encounter_Num == 3) or (Encounter_Num == 4) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Hub Desert encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call Hub1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call Hub2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call Hub3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call Hub4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call Hub5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call Hub6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  Necrop_table: |
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 2) or (Encounter_Num == 3) or (Encounter_Num == 5) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Necropolis Desert encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call Necrop1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call Necrop2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call Necrop3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call Necrop4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call Necrop5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call Necrop6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  Steel_table: |
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 1) or (Encounter_Num == 2) or (Encounter_Num == 4) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Brotherhood of Steel Desert encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call Steel1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call Steel2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call Steel3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call Steel4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call Steel5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call Steel6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  Vats_table: |
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 1) or (Encounter_Num == 2) or (Encounter_Num == 3) or (Encounter_Num == 4) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Vats Desert encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call Vats1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call Vats2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call Vats3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call Vats4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call Vats5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call Vats6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  Glow_table: |
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 1) or (Encounter_Num == 3) or (Encounter_Num == 4) or (Encounter_Num == 5) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Glow Desert encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call Glow1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call Glow2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call Glow3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call Glow4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call Glow5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call Glow6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  Bone_table: |
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 1) or (Encounter_Num == 3) or (Encounter_Num == 5) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Bone Desert encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call Bone1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call Bone2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call Bone3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call Bone4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call Bone5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call Bone6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  Death_table: |
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 1) or (Encounter_Num == 2) or (Encounter_Num == 4) or (Encounter_Num == 6) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Death Claw encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call Death1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call Death2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call Death3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call Death4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call Death5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call Death6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  North1: |
    display_msg(message_str(112, 104));
    Tot_Critter_A := random(3, 6);
    Tot_Critter_B := random(4, 8);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
    group_angle := random(0, 5);
    Critter_type := 16777227;
    Critter_script := 12;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    victim := Critter;
    Critter_script := 222;
    if (group_angle == 0) then begin
      group_angle := 3;
    end
    else begin
      if (group_angle == 1) then begin
        group_angle := 4;
      end
      else begin
        if (group_angle == 2) then begin
          group_angle := 5;
        end
        else begin
          if (group_angle == 3) then begin
            group_angle := 0;
          end
          else begin
            if (group_angle == 4) then begin
              group_angle := 1;
            end
            else begin
              if (group_angle == 5) then begin
                group_angle := 2;
              end
            end
          end
        end
      end
    end
    while(Tot_Critter_B) do begin
      if (random(0, 3) == 3) then begin
        Critter_type := 16777226;
      end
      else begin
        Critter_type := 16777378;
      end
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Tot_Critter_B := Tot_Critter_B - 1;
    end
    attack_setup(dude_obj, victim);
    attack_setup(dude_obj, Critter);
    attack_setup(Critter, victim);
    set_global_var(288, 1);
    call stranger;
  North2: |
    variable LVar0 := 0;
    Tot_Critter_A := random(1, 2);
    Tot_Critter_B := random(3, 5);
    group_angle := random(0, 5);
    if (is_success(do_check(dude_obj, 1, -2)) or has_trait(0, dude_obj, 0)) then begin
      display_msg(message_str(112, 197));
      Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 7;
      Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 5;
    end
    else begin
      display_msg(message_str(112, 105));
      LVar0 := 1;
      Outer_ring := 5;
      Inner_ring := 2;
    end
    Critter_type := 16777419;
    Critter_script := 749;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (LVar0) then begin
        anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      end
      else begin
        anim(Critter, 1000, random(0, 5));
      end
      if (random(0, 1)) then begin
        if (random(0, 1)) then begin
          Item := create_object_sid(18, 0, 0, -1);
        end
        else begin
          Item := create_object_sid(8, 0, 0, -1);
        end
      end
      else begin
        Item := create_object_sid(4, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      Item := item_caps_adjust(Critter, (random(1, 20) * has_trait(0, dude_obj, 20)) + 1);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Outer_ring := Outer_ring + 2;
    Inner_ring := Inner_ring + 2;
    while(Tot_Critter_B) do begin
      if (random(0, 1)) then begin
        Critter_type := 16777449;
      end
      else begin
        Critter_type := 16777432;
      end
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (LVar0) then begin
        anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      end
      else begin
        anim(Critter, 1000, random(0, 5));
      end
      if (random(0, 1)) then begin
        if (random(0, 1)) then begin
          Item := create_object_sid(18, 0, 0, -1);
        end
        else begin
          Item := create_object_sid(8, 0, 0, -1);
        end
      end
      else begin
        Item := create_object_sid(4, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      Item := item_caps_adjust(Critter, random(1, 25) * (has_trait(0, dude_obj, 20) + 1));
      Tot_Critter_B := Tot_Critter_B - 1;
    end
    set_global_var(288, 1);
    call stranger;
  North3: |
    display_msg(message_str(112, 106));
    Tot_Critter_A := random(4, 6);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    Critter_type := 16777227;
    Critter_script := 12;
    group_angle := random(0, 5);
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle;
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777229;
    Critter_direction := random(0, 5);
    Outer_ring := 4;
    Inner_ring := 2;
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    Item := item_caps_adjust(Critter, random(40, 100) * (has_trait(0, dude_obj, 20) + 1));
    if (random(0, 1)) then begin
      Item := create_object_sid(40, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    kill_critter(Critter, 61);
    set_global_var(288, 1);
    call stranger;
  North4: |
    display_msg(message_str(112, 107));
    Tot_Critter_A := random(2, 4);
    group_angle := random(0, 5);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    Inner_ring := get_critter_stat(dude_obj, 1) / 2;
    Critter_type := 16777227;
    Critter_script := 12;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 3 * 2) - 3);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 1);
    call stranger;
  North5: |
    display_msg(message_str(112, 108));
    Tot_Critter_A := random(2, 6);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 8;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
    Critter_script := 222;
    while(Tot_Critter_A) do begin
      if (random(0, 3) == 3) then begin
        Critter_type := 16777226;
      end
      else begin
        Critter_type := 16777378;
      end
      Critter_direction := random(0, 2);
      call Place_critter;
      anim(Critter, 1000, random(0, 5));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 1);
    call stranger;
  North6: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 6);
    if (obj_is_carrying_obj_pid(dude_obj, 126)) then begin
      display_msg(message_str(112, 125));
      destroy_object(obj_carrying_pid_obj(dude_obj, 126));
    end
    else begin
      Skill_roll := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
      if (is_success(Skill_roll)) then begin
        if (LVar0 == 1) then begin
          display_msg(message_str(112, 109));
        end
        else begin
          display_msg(message_str(112, 110) + LVar0 + message_str(112, 111));
        end
      end
      else begin
        if (is_critical(Skill_roll)) then begin
          LVar1 := random(2, 4);
          if (LVar0 == 1) then begin
            display_msg(message_str(112, 112) + LVar1 + message_str(112, 113));
          end
          else begin
            display_msg(message_str(112, 114) + LVar0 + message_str(112, 115) + LVar1 + message_str(112, 116));
          end
          critter_injure(dude_obj, 2);
        end
        else begin
          LVar1 := random(1, 2);
          if (LVar0 == 1) then begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 117));
            end
            else begin
              display_msg(message_str(112, 118) + LVar1 + message_str(112, 119));
            end
          end
          else begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 120) + LVar0 + message_str(112, 121));
            end
            else begin
              display_msg(message_str(112, 122) + LVar0 + message_str(112, 123) + LVar1 + message_str(112, 124));
            end
          end
          critter_injure(dude_obj, 2);
        end
      end
      critter_dmg(dude_obj, LVar1, 0);
      LVar0 := LVar0 * 3600;
      game_time_advance(game_ticks(LVar0));
    end
  South1: |
    variable LVar0 := 0;
    display_msg(message_str(112, 131));
    Tot_Critter_A := random(6, 10);
    Outer_ring := 7;
    Inner_ring := 10;
    Critter_type := 16777244;
    Critter_script := 941;
    while(Tot_Critter_A) do begin
      Critter_direction := 1;
      call Place_critter;
      anim(Critter, 1000, 4);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
  South2: |
    display_msg(message_str(112, 132));
    Tot_Critter_A := random(4, 6);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Critter_type := 16777227;
    Critter_script := 12;
    group_angle := random(0, 5);
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2 * 2) - 2);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 2);
    call stranger;
  South3: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 6);
    Skill_roll := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
    if (obj_is_carrying_obj_pid(dude_obj, 126)) then begin
      display_msg(message_str(112, 125));
      destroy_object(obj_carrying_pid_obj(dude_obj, 126));
    end
    else begin
      if (is_success(Skill_roll)) then begin
        if (LVar0 == 1) then begin
          display_msg(message_str(112, 109));
        end
        else begin
          display_msg(message_str(112, 110) + LVar0 + message_str(112, 111));
        end
      end
      else begin
        if (is_critical(Skill_roll)) then begin
          LVar1 := random(2, 4);
          if (LVar0 == 1) then begin
            display_msg(message_str(112, 112) + LVar1 + message_str(112, 113));
          end
          else begin
            display_msg(message_str(112, 114) + LVar0 + message_str(112, 115) + LVar1 + message_str(112, 116));
          end
          critter_injure(dude_obj, 2);
        end
        else begin
          LVar1 := random(1, 2);
          if (LVar0 == 1) then begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 117));
            end
            else begin
              display_msg(message_str(112, 118) + LVar1 + message_str(112, 119));
            end
          end
          else begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 120) + LVar0 + message_str(112, 121));
            end
            else begin
              display_msg(message_str(112, 122) + LVar0 + message_str(112, 123) + LVar1 + message_str(112, 124));
            end
          end
          critter_injure(dude_obj, 2);
        end
      end
      critter_dmg(dude_obj, LVar1, 0);
      LVar0 := LVar0 * 3600;
      game_time_advance(game_ticks(LVar0));
    end
  South4: |
    display_msg(message_str(112, 143));
    Tot_Critter_A := random(2, 5);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Critter_script := 749;
    group_angle := random(0, 5);
    while(Tot_Critter_A) do begin
      if (random(0, 1)) then begin
        Critter_type := 16777449;
      end
      else begin
        Critter_type := 16777432;
      end
      Critter_direction := group_angle + (random(0, 1 * 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      if (random(0, 1)) then begin
        if (random(0, 1)) then begin
          if (Critter_type == 16777449) then begin
            Item := create_object_sid(34, 0, 0, -1);
          end
          else begin
            Item := create_object_sid(29, 0, 0, -1);
          end
          add_obj_to_inven(Critter, Item);
          if (has_trait(0, dude_obj, 40)) then begin
            if (Critter_type == 16777449) then begin
              Item := create_object_sid(34, 0, 0, -1);
            end
            else begin
              Item := create_object_sid(29, 0, 0, -1);
            end
            add_obj_to_inven(Critter, Item);
          end
          if (Critter_type == 16777449) then begin
            Item := create_object_sid(10, 0, 0, -1);
          end
          else begin
            Item := create_object_sid(9, 0, 0, -1);
          end
        end
        else begin
          Item := create_object_sid(29, 0, 0, -1);
          add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
          Item := create_object_sid(8, 0, 0, -1);
        end
      end
      else begin
        Item := create_object_sid(7, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      Item := item_caps_adjust(Critter, random(10, 30) * (has_trait(0, dude_obj, 20) + 1));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 2);
    call stranger;
  South5: |
    display_msg(message_str(112, 144));
    Tot_Critter_A := random(4, 8);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 7;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 5;
    Critter_script := 943;
    group_angle := random(0, 5);
    while(Tot_Critter_A) do begin
      if (random(0, 4) == 4) then begin
        Critter_type := 16777226;
      end
      else begin
        Critter_type := 16777378;
      end
      Critter_direction := group_angle + (random(0, 2 * 2) - 2);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, random(0, 5));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 2);
    call stranger;
  South6: |
    display_msg(message_str(112, 145));
    Tot_Critter_A := random(3, 6);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    group_angle := random(0, 5);
    Critter_type := 16777612;
    Critter_script := 12;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2 * 2) - 2);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 2);
    call stranger;
  Shady1: |
    display_msg(message_str(112, 146));
    Tot_Critter_A := 2;
    Tot_Critter_B := random(2, 3);
    set_global_var(290, 0);
    set_global_var(291, 0);
    set_global_var(292, 0);
    set_global_var(289, Tot_Critter_B);
    set_global_var(288, 6);
    group_angle := random(0, 5);
    Outer_ring := 11;
    Inner_ring := 8;
    Critter_type := 16777255;
    Critter_script := 713;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Item := item_caps_adjust(Critter, (random(1, 12) * has_trait(0, dude_obj, 20)) + 1);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    victim := Critter;
    Critter_type := 16777449;
    Critter_script := 749;
    if (group_angle == 0) then begin
      group_angle := 3;
    end
    else begin
      if (group_angle == 1) then begin
        group_angle := 4;
      end
      else begin
        if (group_angle == 2) then begin
          group_angle := 5;
        end
        else begin
          if (group_angle == 3) then begin
            group_angle := 0;
          end
          else begin
            if (group_angle == 4) then begin
              group_angle := 1;
            end
            else begin
              if (group_angle == 5) then begin
                group_angle := 2;
              end
            end
          end
        end
      end
    end
    while(Tot_Critter_B) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Item := create_object_sid(7, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := item_caps_adjust(Critter, (random(1, 13) * has_trait(0, dude_obj, 20)) + 1);
      Tot_Critter_B := Tot_Critter_B - 1;
    end
    attack_setup(Critter, victim);
    set_global_var(288, 1);
    call stranger;
  Shady2: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 6);
    Skill_roll := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
    if (obj_is_carrying_obj_pid(dude_obj, 126)) then begin
      display_msg(message_str(112, 125));
      destroy_object(obj_carrying_pid_obj(dude_obj, 126));
    end
    else begin
      if (is_success(Skill_roll)) then begin
        if (LVar0 == 1) then begin
          display_msg(message_str(112, 109));
        end
        else begin
          display_msg(message_str(112, 110) + LVar0 + message_str(112, 111));
        end
      end
      else begin
        if (is_critical(Skill_roll)) then begin
          LVar1 := random(2, 4);
          if (LVar0 == 1) then begin
            display_msg(message_str(112, 112) + LVar1 + message_str(112, 113));
          end
          else begin
            display_msg(message_str(112, 114) + LVar0 + message_str(112, 115) + LVar1 + message_str(112, 116));
          end
          critter_injure(dude_obj, 2);
        end
        else begin
          LVar1 := random(1, 2);
          if (LVar0 == 1) then begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 117));
            end
            else begin
              display_msg(message_str(112, 118) + LVar1 + message_str(112, 119));
            end
            critter_injure(dude_obj, 2);
          end
          else begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 120) + LVar0 + message_str(112, 121));
            end
            else begin
              display_msg(message_str(112, 122) + LVar0 + message_str(112, 123) + LVar1 + message_str(112, 124));
            end
            critter_injure(dude_obj, 2);
          end
        end
      end
      critter_dmg(dude_obj, LVar1, 0);
      LVar0 := LVar0 * 3600;
      game_time_advance(game_ticks(LVar0));
    end
  Shady3: |
    display_msg(message_str(112, 169));
    Scorpions_Killed := 1;
    Tot_Critter_A := random(1, 3);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    Critter_type := 16777227;
    Critter_script := 12;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 4);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 1);
    call stranger;
  Shady4: |
    if (not(global_var(331))) then begin
      display_msg(message_str(112, 170));
    end
    else begin
      display_msg(message_str(112, 305));
    end
    Tot_Critter_B := random(4, 6);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 7;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    group_angle := dude_rot;
    set_global_var(289, 0);
    if (not(global_var(331))) then begin
      Critter_type := 16777246;
      Critter_script := 243;
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Item := create_object_sid(71, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(29, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, 2 * (has_trait(0, dude_obj, 40) + 1));
      Item := create_object_sid(30, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, 1 * (has_trait(0, dude_obj, 40) + 1));
      Item := create_object_sid(34, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, 2 * (has_trait(0, dude_obj, 40) + 1));
      Item := create_object_sid(40, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, random(0, 4));
      Item := create_object_sid(47, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, random(0, 1));
      Item := create_object_sid(81, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, random(0, 3));
      Item := item_caps_adjust(Critter, random(25, 100) * (has_trait(0, dude_obj, 20) + 1));
      victim := Critter;
    end
    else begin
      set_global_var(289, 1);
    end
    Critter_type := 16777218;
    Critter_script := 757;
    while(Tot_Critter_B) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (not(global_var(331))) then begin
        if (random(0, 1)) then begin
          Critter_direction := group_angle + (random(0, 4) - 2);
          while(Critter_direction < 0) do begin
            Critter_direction := Critter_direction + 6;
          end
          if (Critter_direction > 5) then begin
            Critter_direction := Critter_direction % 6;
          end
          anim(Critter, 1000, Critter_direction);
        end
        else begin
          anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(victim)));
        end
      end
      else begin
        anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      end
      Item := create_object_sid(10, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(34, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
      Item := item_caps_adjust(Critter, random(1, 6) * (has_trait(0, dude_obj, 20) + 1));
      Tot_Critter_B := Tot_Critter_B - 1;
    end
  Shady5: |
    display_msg(message_str(112, 171));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    Critter_direction := dude_rot;
    if (random(0, 1)) then begin
      Critter_type := 16777246;
      Critter_script := 699;
    end
    else begin
      Critter_type := 16777218;
      Critter_script := 749;
    end
    Critter_script := -1;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(8, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(29, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 1 + has_trait(0, dude_obj, 40));
    Item := create_object_sid(7, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(81, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := item_caps_adjust(Critter, random(8, 44) * (has_trait(0, dude_obj, 20) + 1));
    kill_critter(Critter, 61);
    Tot_Critter_A := random(4, 6);
    if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
      Outer_ring := 6;
      Inner_ring := 4;
    end
    else begin
      Outer_ring := 4;
      Inner_ring := 3;
    end
    Critter_type := 16777284;
    Critter_script := 735;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 5);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 1);
    call stranger;
  Shady6: |
    variable LVar0 := 2;
    display_msg(message_str(112, 172));
    Critter_direction := random(0, 5);
    money := create_object_sid(41, 0, 0, -1);
    Critter_tile := tile_num_in_direction(Dude_tile, Critter_direction, 4);
    Item := create_object_sid(71, 0, 0, -1);
    critter_attempt_placement(Item, Critter_tile, 0);
    if (get_critter_stat(dude_obj, 6) == 8) then begin
      money := 0;
      Item := create_object_sid(71, 0, 0, -1);
      critter_attempt_placement(Item, Critter_tile, 0);
      Item := create_object_sid(29, 0, 0, -1);
      critter_attempt_placement(Item, Critter_tile, 0);
      if (has_trait(0, dude_obj, 40)) then begin
        Item := create_object_sid(29, 0, 0, -1);
        critter_attempt_placement(Item, Critter_tile, 0);
      end
    end
    else begin
      if (get_critter_stat(dude_obj, 6) > 8) then begin
        Item := create_object_sid(71, 0, 0, -1);
        critter_attempt_placement(Item, Critter_tile, 0);
        if (has_trait(0, dude_obj, 40)) then begin
          LVar0 := 4;
        end
        while(LVar0) do begin
          Item := create_object_sid(29, 0, 0, -1);
          critter_attempt_placement(Item, Critter_tile, 0);
          LVar0 := LVar0 - 1;
        end
        Item := create_object_sid(8, 0, 0, -1);
        critter_attempt_placement(Item, Critter_tile, 0);
      end
      else begin
        Item := create_object_sid(71, 0, 0, -1);
        critter_attempt_placement(Item, Critter_tile, 0);
      end
    end
  Raider1: |
    variable LVar0 := 0;
    display_msg(message_str(112, 173));
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Tot_Critter_A := random(5, 7);
    Tot_Critter_B := random(2, 3);
    group_angle := random(0, 5);
    random_seed_1 := Tot_Critter_A;
    random_seed_2 := 0;
    random_seed_3 := 0;
    LVar0 := tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(7, 12));
    Item := create_object_sid(33554959, LVar0, 0, -1);
    Item := create_object_sid(33554499, tile_num_in_direction(LVar0, 1, 0), 0, -1);
    Item := create_object_sid(33554499, tile_num_in_direction(LVar0, 1, 1), 0, -1);
    Item := create_object_sid(33554499, tile_num_in_direction(LVar0, 1, 2), 0, -1);
    Item := create_object_sid(33554499, tile_num_in_direction(LVar0, 1, 3), 0, -1);
    Item := create_object_sid(33554499, tile_num_in_direction(LVar0, 1, 4), 0, -1);
    Item := create_object_sid(33554499, tile_num_in_direction(LVar0, 1, 5), 0, -1);
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      Critter := create_object_sid(33554433, 0, 0, -1);
      Critter_tile := tile_num_in_direction(Dude_tile, group_angle, 5);
      critter_attempt_placement(Critter, Critter_tile, 0);
    end
    Critter_type := 16777244;
    Critter_script := -1;
    Critter_direction := random(0, 5);
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    kill_critter(Critter, 61);
    Critter_type := 16777244;
    Critter_script := -1;
    Critter_direction := random(0, 5);
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    kill_critter(Critter, 61);
    Critter_script := 750;
    while(Tot_Critter_A) do begin
      if (random(0, 1)) then begin
        Critter_type := 16777449;
      end
      else begin
        Critter_type := 16777432;
      end
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Item := create_object_sid(4, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      if (random(0, 1)) then begin
        if (random(0, 1)) then begin
          if (Critter_type == 16777449) then begin
            Item := create_object_sid(34, 0, 0, -1);
          end
          else begin
            Item := create_object_sid(29, 0, 0, -1);
          end
          add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
          if (Critter_type == 16777449) then begin
            Item := create_object_sid(10, 0, 0, -1);
          end
          else begin
            Item := create_object_sid(9, 0, 0, -1);
          end
        end
        else begin
          Item := create_object_sid(29, 0, 0, -1);
          add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
          Item := create_object_sid(8, 0, 0, -1);
        end
      end
      else begin
        Item := create_object_sid(7, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    victim := Critter;
    if (random(0, 1)) then begin
      Critter_type := 16777449;
    end
    else begin
      Critter_type := 16777432;
    end
    Critter_script := -1;
    Critter_direction := group_angle + (random(0, 2) - 1);
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    call Place_critter;
    if (group_angle == 0) then begin
      Critter_direction := 3;
    end
    else begin
      if (group_angle == 1) then begin
        Critter_direction := 4;
      end
      else begin
        if (group_angle == 2) then begin
          Critter_direction := 5;
        end
        else begin
          if (group_angle == 3) then begin
            Critter_direction := 0;
          end
          else begin
            if (group_angle == 4) then begin
              Critter_direction := 1;
            end
            else begin
              if (group_angle == 5) then begin
                Critter_direction := 2;
              end
            end
          end
        end
      end
    end
    if (random(0, 2) == 0) then begin
      Critter_direction := Critter_direction + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
    end
    anim(Critter, 1000, Critter_direction);
    Item := create_object_sid(1, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(4, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    kill_critter(Critter, 61);
    Critter_type := 16777219;
    Critter_script := 755;
    if (group_angle == 0) then begin
      group_angle := 3;
    end
    else begin
      if (group_angle == 1) then begin
        group_angle := 4;
      end
      else begin
        if (group_angle == 2) then begin
          group_angle := 5;
        end
        else begin
          if (group_angle == 3) then begin
            group_angle := 0;
          end
          else begin
            if (group_angle == 4) then begin
              group_angle := 1;
            end
            else begin
              if (group_angle == 5) then begin
                group_angle := 2;
              end
            end
          end
        end
      end
    end
    while(Tot_Critter_B) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Item := create_object_sid(10, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(34, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      if (has_trait(0, dude_obj, 40)) then begin
        Item := create_object_sid(34, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      Tot_Critter_B := Tot_Critter_B - 1;
    end
    attack_setup(victim, Critter);
    Critter_type := 16777219;
    Critter_script := -1;
    Critter_direction := group_angle + (random(0, 2) - 1);
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    call Place_critter;
    if (group_angle == 0) then begin
      Critter_direction := 3;
    end
    else begin
      if (group_angle == 1) then begin
        Critter_direction := 4;
      end
      else begin
        if (group_angle == 2) then begin
          Critter_direction := 5;
        end
        else begin
          if (group_angle == 3) then begin
            Critter_direction := 0;
          end
          else begin
            if (group_angle == 4) then begin
              Critter_direction := 1;
            end
            else begin
              if (group_angle == 5) then begin
                Critter_direction := 2;
              end
            end
          end
        end
      end
    end
    if (random(0, 2) == 0) then begin
      Critter_direction := Critter_direction + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
    end
    anim(Critter, 1000, Critter_direction);
    Item := create_object_sid(2, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(10, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(34, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    kill_critter(Critter, 61);
    Critter_type := 16777229;
    Critter_script := 753;
    Critter_direction := random(0, 5);
    call Place_critter;
    critter_dmg(Critter, 5, 0);
    Item := item_caps_adjust(Critter, random(100, 300) * (has_trait(0, dude_obj, 20) + 1));
    if (random(1, 10) > 6) then begin
      Item := create_object_sid(47, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    if (random(1, 10) > 6) then begin
      Item := create_object_sid(40, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    if (random(1, 10) > 6) then begin
      Item := create_object_sid(78, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    if (random(1, 10) > 6) then begin
      Item := create_object_sid(84, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    set_global_var(288, 1);
    call stranger;
  Raider2: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 6);
    if (obj_is_carrying_obj_pid(dude_obj, 126)) then begin
      display_msg(message_str(112, 125));
      destroy_object(obj_carrying_pid_obj(dude_obj, 126));
    end
    else begin
      Skill_roll := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
      if (is_success(Skill_roll)) then begin
        if (LVar0 == 1) then begin
          display_msg(message_str(112, 109));
        end
        else begin
          display_msg(message_str(112, 110) + LVar0 + message_str(112, 111));
        end
      end
      else begin
        if (is_critical(Skill_roll)) then begin
          LVar1 := random(2, 4);
          if (LVar0 == 1) then begin
            display_msg(message_str(112, 112) + LVar1 + message_str(112, 113));
          end
          else begin
            display_msg(message_str(112, 114) + LVar0 + message_str(112, 115) + LVar1 + message_str(112, 116));
          end
          critter_injure(dude_obj, 2);
        end
        else begin
          LVar1 := random(1, 2);
          if (LVar0 == 1) then begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 117));
            end
            else begin
              display_msg(message_str(112, 118) + LVar1 + message_str(112, 119));
            end
            critter_injure(dude_obj, 2);
          end
          else begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 120) + LVar0 + message_str(112, 121));
            end
            else begin
              display_msg(message_str(112, 122) + LVar0 + message_str(112, 123) + LVar1 + message_str(112, 124));
            end
            critter_injure(dude_obj, 2);
          end
        end
      end
      critter_dmg(dude_obj, LVar1, 0);
      LVar0 := LVar0 * 3600;
      game_time_advance(game_ticks(LVar0));
    end
  Raider3: |
    display_msg(message_str(112, 196));
    Tot_Critter_A := random(3, 4);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Critter_type := 16777227;
    Critter_script := 12;
    while(Tot_Critter_A) do begin
      Critter_direction := random(4, 5);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 1);
    call stranger;
  Raider4: |
    display_msg(message_str(112, 197));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 3;
    Tot_Critter_A := random(4, 6);
    group_angle := random(0, 5);
    Critter_script := 749;
    while(Tot_Critter_A) do begin
      if (random(0, 1)) then begin
        if (random(0, 1)) then begin
          Critter_type := 16777449;
        end
        else begin
          Critter_type := 16777432;
        end
      end
      else begin
        Critter_type := 16777319;
      end
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Item := create_object_sid(4, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      if (random(0, 1)) then begin
        if (random(0, 1)) then begin
          if (Critter_type == 16777449) then begin
            Item := create_object_sid(10, 0, 0, -1);
          end
          else begin
            Item := create_object_sid(9, 0, 0, -1);
          end
        end
        else begin
          Item := create_object_sid(18, 0, 0, -1);
        end
      end
      else begin
        Item := create_object_sid(8, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      if (random(0, 1)) then begin
        Item := create_object_sid(124, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 1);
    call stranger;
  Raider5: |
    display_msg(message_str(112, 198));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Critter_direction := dude_rot;
    Critter_type := 16777254;
    Critter_script := 700;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(4, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    if (random(0, 1)) then begin
      if (random(0, 1)) then begin
        Item := create_object_sid(9, 0, 0, -1);
      end
      else begin
        Item := create_object_sid(18, 0, 0, -1);
      end
    end
    else begin
      Item := create_object_sid(8, 0, 0, -1);
    end
    add_obj_to_inven(Critter, Item);
    if (random(0, 1)) then begin
      Item := item_caps_adjust(Critter, random(5, 10) * (has_trait(0, dude_obj, 20) + 1));
    end
  Raider6: |
    display_msg(message_str(112, 199));
    Tot_Critter_A := random(3, 5);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Critter_script := -1;
    while(Tot_Critter_A) do begin
      if (random(0, 1)) then begin
        if (random(0, 1)) then begin
          Critter_type := 16777449;
        end
        else begin
          Critter_type := 16777432;
        end
      end
      else begin
        Critter_type := 16777319;
      end
      Critter_direction := random(0, 5);
      call Place_critter;
      anim(Critter, 1000, random(0, 5));
      kill_critter(Critter, 61);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777252;
    Critter_direction := random(0, 5);
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    kill_critter(Critter, 61);
  Junk1: |
    display_msg(message_str(112, 200));
    Tot_Critter_A := random(3, 4);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Critter_type := 16777227;
    Critter_script := 12;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 4);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 1);
    call stranger;
  Junk2: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 6);
    if (obj_is_carrying_obj_pid(dude_obj, 126)) then begin
      display_msg(message_str(112, 125));
      destroy_object(obj_carrying_pid_obj(dude_obj, 126));
    end
    else begin
      Skill_roll := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
      if (is_success(Skill_roll)) then begin
        if (LVar0 == 1) then begin
          display_msg(message_str(112, 109));
        end
        else begin
          display_msg(message_str(112, 110) + LVar0 + message_str(112, 111));
        end
      end
      else begin
        if (is_critical(Skill_roll)) then begin
          LVar1 := random(2, 4);
          if (LVar0 == 1) then begin
            display_msg(message_str(112, 112) + LVar1 + message_str(112, 113));
          end
          else begin
            display_msg(message_str(112, 114) + LVar0 + message_str(112, 115) + LVar1 + message_str(112, 116));
          end
          critter_injure(dude_obj, 2);
        end
        else begin
          LVar1 := random(1, 2);
          if (LVar0 == 1) then begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 117));
            end
            else begin
              display_msg(message_str(112, 118) + LVar1 + message_str(112, 119));
            end
            critter_injure(dude_obj, 2);
          end
          else begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 120) + LVar0 + message_str(112, 121));
            end
            else begin
              display_msg(message_str(112, 122) + LVar0 + message_str(112, 123) + LVar1 + message_str(112, 124));
            end
            critter_injure(dude_obj, 2);
          end
        end
      end
      critter_dmg(dude_obj, LVar1, 0);
      LVar0 := LVar0 * 3600;
      game_time_advance(game_ticks(LVar0));
    end
  Junk3: |
    display_msg(message_str(112, 223));
    Tot_Critter_A := random(4, 6);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    group_angle := random(0, 5);
    Critter_type := 16777379;
    Critter_script := 693;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, random(0, 5));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 1);
    call stranger;
  Junk4: |
    display_msg(message_str(112, 224));
    Tot_Critter_A := random(2, 4);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Critter_type := 16777452;
    Critter_script := 437;
    group_angle := random(0, 5);
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (random(1, 3) == 1) then begin
        anim(Critter, 1000, random(0, 5));
      end
      else begin
        anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      end
      Item := create_object_sid(4, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      if (random(0, 1)) then begin
        Item := create_object_sid(10, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
        Item := create_object_sid(34, 0, 0, -1);
        add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Item := create_object_sid(100, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
  Junk5: |
    variable LVar0 := 0;
    display_msg(message_str(112, 225));
    Tot_Critter_A := random(1, 3);
    Tot_Critter_B := random(2, 12);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    group_angle := random(0, 5);
    LVar0 := tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(7, 12));
    Scenery_Creation := create_object_sid(33554959, LVar0, 0, -1);
    Scenery_Creation_Hex := LVar0;
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 1, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 3, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 4, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 5, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 0, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 5, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 1, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    LVar0 := tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(7, 12));
    Scenery_Creation := create_object_sid(33554960, LVar0, 0, -1);
    Scenery_Creation_Hex := LVar0;
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 1, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 3, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 4, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 5, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 0, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 5, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 1, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Critter_type := 16777245;
    Critter_script := 752;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, random(0, 5));
      Item := item_caps_adjust(Critter, random(50, 150) * (has_trait(0, dude_obj, 20) + 1));
      Item := create_object_sid(30, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, random(1, 4));
      Item := create_object_sid(29, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, random(1, 4));
      Item := create_object_sid(4, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, random(1, 4));
      Item := create_object_sid(71, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, random(4, 8));
      Item := create_object_sid(127, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, random(0, 2));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777243;
    Critter_script := 755;
    while(Tot_Critter_B) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, random(0, 5));
      Item := create_object_sid(4, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      if (random(0, 1)) then begin
        Item := create_object_sid(18, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
        Item := create_object_sid(31, 0, 0, -1);
        add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
      end
      else begin
        Item := create_object_sid(8, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
        Item := create_object_sid(29, 0, 0, -1);
        add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
      end
      Tot_Critter_B := Tot_Critter_B - 1;
    end
  Junk6: |
    variable LVar0 := 2;
    variable LVar1 := 0;
    display_msg(message_str(112, 172));
    LVar1 := create_object_sid(41, 0, 0, -1);
    Critter_direction := random(0, 5);
    Critter_tile := tile_num_in_direction(Dude_tile, Critter_direction, 4);
    if (get_critter_stat(dude_obj, 6) < 3) then begin
      Item := create_object_sid(71, 0, 0, -1);
      critter_attempt_placement(Item, Critter_tile, 0);
    end
    else begin
      if (get_critter_stat(dude_obj, 6) == 8) then begin
        Item := create_object_sid(71, 0, 0, -1);
        critter_attempt_placement(Item, Critter_tile, 0);
        Item := create_object_sid(29, 0, 0, -1);
        critter_attempt_placement(Item, Critter_tile, 0);
        if (has_trait(0, dude_obj, 40)) then begin
          Item := create_object_sid(29, 0, 0, -1);
          critter_attempt_placement(Item, Critter_tile, 0);
        end
      end
      else begin
        if (get_critter_stat(dude_obj, 6) > 8) then begin
          Item := create_object_sid(71, 0, 0, -1);
          critter_attempt_placement(Item, Critter_tile, 0);
          if (has_trait(0, dude_obj, 40)) then begin
            LVar0 := 4;
          end
          while(LVar0) do begin
            Item := create_object_sid(29, 0, 0, -1);
            critter_attempt_placement(Item, Critter_tile, 0);
            LVar0 := LVar0 - 1;
          end
          Item := create_object_sid(8, 0, 0, -1);
          critter_attempt_placement(Item, Critter_tile, 0);
        end
        else begin
          Item := create_object_sid(71, 0, 0, -1);
          critter_attempt_placement(Item, Critter_tile, 0);
        end
      end
    end
  Hub1: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 6) + 2;
    if (obj_is_carrying_obj_pid(dude_obj, 126)) then begin
      display_msg(message_str(112, 125));
      destroy_object(obj_carrying_pid_obj(dude_obj, 126));
    end
    else begin
      Skill_roll := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
      if (is_success(Skill_roll)) then begin
        display_msg(message_str(112, 110) + LVar0 + message_str(112, 111));
      end
      else begin
        if (is_critical(Skill_roll)) then begin
          LVar1 := random(2, 4);
        end
        else begin
          LVar1 := random(2, 3);
        end
        display_msg(message_str(112, 114) + LVar0 + message_str(112, 115) + LVar1 + message_str(112, 116));
        critter_injure(dude_obj, 2);
      end
      critter_dmg(dude_obj, LVar1, 0);
      LVar0 := LVar0 * 3600;
      game_time_advance(game_ticks(LVar0));
    end
  Hub2: |
    display_msg(message_str(112, 133));
    Tot_Critter_A := random(3, 6);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Critter_script := 749;
    while(Tot_Critter_A) do begin
      if (random(0, 1)) then begin
        if (random(0, 1)) then begin
          Critter_type := 16777254;
        end
        else begin
          Critter_type := 16777235;
        end
      end
      else begin
        Critter_type := 16777243;
      end
      Critter_direction := random(3, 5);
      call Place_critter;
      anim(Critter, 1000, random(0, 2));
      Item := create_object_sid(4, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      if ((Critter_type != 16777243) and random(0, 1)) then begin
        Item := create_object_sid(9, 0, 0, -1);
      end
      else begin
        Item := create_object_sid(8, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      Item := item_caps_adjust(Critter, random(10, 30) * (has_trait(0, dude_obj, 20) + 1));
      if (random(0, 3) == 3) then begin
        Item := create_object_sid(40, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      if (random(0, 3) == 3) then begin
        Item := create_object_sid(87, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      if (random(0, 3) == 3) then begin
        Item := create_object_sid(81, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      if (random(0, 3) == 3) then begin
        Item := create_object_sid(103, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 2);
    call stranger;
  Hub3: |
    display_msg(message_str(112, 134));
    Tot_Critter_A := random(2, 3);
    Tot_Critter_B := random(1, 2);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Critter_type := 16777227;
    Critter_script := 12;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 4);
      call Place_critter;
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777382;
    while(Tot_Critter_B) do begin
      Critter_direction := random(0, 4);
      call Place_critter;
      Tot_Critter_B := Tot_Critter_B - 1;
    end
    set_global_var(288, 2);
    call stranger;
  Hub4: |
    display_msg(message_str(112, 135));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    Tot_Critter_A := random(4, 6);
    Critter_script := 573;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 2);
      if (random(0, 1)) then begin
        Critter_type := 16777243;
      end
      else begin
        Critter_type := 16777253;
      end
      call Place_critter;
      anim(Critter, 1000, random(3, 5));
      Item := item_caps_adjust(Critter, random(20, 50) * (has_trait(0, dude_obj, 20) + 1));
      if (random(0, 1)) then begin
        Item := create_object_sid(9, 0, 0, -1);
      end
      else begin
        Item := create_object_sid(18, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
  Hub5: |
    variable LVar0 := 0;
    display_msg(message_str(112, 136));
    LVar0 := tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(7, 9));
    Scenery_Creation := create_object_sid(33554959, LVar0, 0, -1);
    Scenery_Creation_Hex := LVar0;
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 1, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 3, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 4, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 5, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 0, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 5, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 1, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    Tot_Critter_A := random(5, 8);
    Critter_script := 755;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 2);
      if (random(0, 1)) then begin
        Critter_type := 16777243;
      end
      else begin
        Critter_type := 16777253;
      end
      call Place_critter;
      anim(Critter, 1000, random(3, 5));
      Item := item_caps_adjust(Critter, random(20, 50) * (has_trait(0, dude_obj, 20) + 1));
      if (random(0, 1)) then begin
        Item := create_object_sid(9, 0, 0, -1);
      end
      else begin
        Item := create_object_sid(18, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Critter_type := 16777229;
    Critter_script := 752;
    call Place_critter;
    Item := item_caps_adjust(Critter, random(100, 300) * (has_trait(0, dude_obj, 20) + 1));
    Item := create_object_sid(71, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, random(0, 4));
    Item := create_object_sid(81, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, random(0, 4));
    Item := create_object_sid(40, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, random(0, 2));
    Item := create_object_sid(47, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, random(0, 1));
    Item := create_object_sid(29, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, random(0, 3));
    Item := create_object_sid(30, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, random(0, 3));
    Item := create_object_sid(35, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, random(0, 2));
    Item := create_object_sid(36, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, random(0, 2));
  Hub6: |
    display_msg(message_str(112, 137));
    Tot_Critter_A := random(2, 4);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    Critter_type := 16777244;
    Critter_script := 34;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 5);
      call Place_critter;
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777386;
    Critter_script := -1;
    call Place_critter;
  Necrop1: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 6);
    if (obj_is_carrying_obj_pid(dude_obj, 126)) then begin
      display_msg(message_str(112, 125));
      destroy_object(obj_carrying_pid_obj(dude_obj, 126));
    end
    else begin
      Skill_roll := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
      if (is_success(Skill_roll)) then begin
        if (LVar0 == 1) then begin
          display_msg(message_str(112, 109));
        end
        else begin
          display_msg(message_str(112, 110) + LVar0 + message_str(112, 111));
        end
      end
      else begin
        if (is_critical(Skill_roll)) then begin
          LVar1 := random(2, 4);
          if (LVar0 == 1) then begin
            display_msg(message_str(112, 112) + LVar1 + message_str(112, 113));
          end
          else begin
            display_msg(message_str(112, 114) + LVar0 + message_str(112, 115) + LVar1 + message_str(112, 116));
          end
          critter_injure(dude_obj, 2);
        end
        else begin
          LVar1 := random(1, 2);
          if (LVar0 == 1) then begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 117));
            end
            else begin
              display_msg(message_str(112, 118) + LVar1 + message_str(112, 119));
            end
            critter_injure(dude_obj, 2);
          end
          else begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 120) + LVar0 + message_str(112, 121));
            end
            else begin
              display_msg(message_str(112, 122) + LVar0 + message_str(112, 123) + LVar1 + message_str(112, 124));
            end
            critter_injure(dude_obj, 2);
          end
        end
      end
      critter_dmg(dude_obj, LVar1, 0);
      LVar0 := LVar0 * 3600;
      game_time_advance(game_ticks(LVar0));
    end
  Necrop2: |
    display_msg(message_str(112, 126));
    Tot_Critter_A := random(2, 4);
    Tot_Critter_B := random(2, 4);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    group_angle := random(0, 5);
    Critter_script := 12;
    Dude_tile := Dude_tile + (200 * (random(0, 4) - 2));
    while(Tot_Critter_A) do begin
      if (random(0, 3) == 3) then begin
        Critter_type := 16777382;
      end
      else begin
        Critter_type := 16777227;
      end
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    victim := Critter;
    Critter_script := 222;
    if (group_angle == 0) then begin
      group_angle := 3;
    end
    else begin
      if (group_angle == 1) then begin
        group_angle := 4;
      end
      else begin
        if (group_angle == 2) then begin
          group_angle := 5;
        end
        else begin
          if (group_angle == 3) then begin
            group_angle := 0;
          end
          else begin
            if (group_angle == 4) then begin
              group_angle := 1;
            end
            else begin
              if (group_angle == 5) then begin
                group_angle := 2;
              end
            end
          end
        end
      end
    end
    while(Tot_Critter_B) do begin
      if (random(0, 2) == 2) then begin
        Critter_type := 16777226;
      end
      else begin
        Critter_type := 16777378;
      end
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Tot_Critter_B := Tot_Critter_B - 1;
    end
    attack_setup(Critter, victim);
    set_global_var(288, 1);
    call stranger;
  Necrop3: |
    display_msg(message_str(112, 127));
    Tot_Critter_A := random(2, 4);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 4;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 2;
    group_angle := random(0, 5);
    Critter_type := 16777230;
    Critter_script := 953;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 1);
    call stranger;
  Necrop4: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    display_msg(message_str(112, 128));
    Item := create_object_sid(33554653, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(5, 8)), 0, -1);
    Item := create_object_sid(33554654, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(5, 8)), 0, -1);
    Item := create_object_sid(33554747, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(5, 8)), 0, -1);
    if (random(0, 3) == 3) then begin
      LVar1 := tile_num_in_direction(tile_num(dude_obj), random(0, 5), random(0, 5));
      LVar2 := random(0, 4);
      if (LVar2 == 0) then begin
        LVar0 := create_object_sid(29, LVar1, 0, -1);
      end
      else begin
        if (LVar2 == 1) then begin
          LVar0 := create_object_sid(30, LVar1, 0, -1);
        end
        else begin
          if (LVar2 == 2) then begin
            LVar0 := create_object_sid(34, LVar1, 0, -1);
          end
          else begin
            if (LVar2 == 3) then begin
              LVar0 := create_object_sid(31, LVar1, 0, -1);
            end
            else begin
              if (LVar2 == 4) then begin
                LVar0 := create_object_sid(111, LVar1, 0, -1);
              end
            end
          end
        end
      end
    end
    LVar1 := tile_num_in_direction(tile_num(dude_obj), random(0, 5), random(3, 5));
    LVar0 := create_object_sid(33554541, LVar1, 0, -1);
    LVar1 := tile_num_in_direction(tile_num(dude_obj), random(0, 5), random(3, 5));
    LVar0 := create_object_sid(33554437, LVar1, 0, -1);
    LVar1 := tile_num_in_direction(tile_num(dude_obj), random(0, 5), random(3, 5));
    LVar0 := create_object_sid(33554524, LVar1, 0, -1);
  Necrop5: |
    display_msg(message_str(112, 127));
    Tot_Critter_A := random(1, 3);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 4;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 2;
    group_angle := random(0, 5);
    Critter_type := 16777230;
    Critter_script := 953;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 1);
    call stranger;
  Necrop6: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    display_msg(message_str(112, 130));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 4;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 2;
    if (random(0, 1)) then begin
      Critter_type := 16777254;
    end
    else begin
      Critter_type := 16777253;
    end
    Critter_script := -1;
    Critter_direction := random(0, 5);
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    if (random(0, 3) == 3) then begin
      LVar1 := create_object_sid(40, 0, 0, -1);
      add_obj_to_inven(LVar0, LVar1);
    end
    if (random(0, 3) == 3) then begin
      LVar1 := item_caps_adjust(LVar0, random(50, 100) * (has_trait(0, dude_obj, 20) + 1));
    end
    if (random(0, 3) == 3) then begin
      LVar1 := create_object_sid(8, 0, 0, -1);
      add_obj_to_inven(LVar0, LVar1);
    end
    if (random(0, 3) == 3) then begin
      LVar1 := create_object_sid(1, 0, 0, -1);
      add_obj_to_inven(LVar0, LVar1);
    end
    if (random(0, 3) == 3) then begin
      LVar1 := create_object_sid(127, 0, 0, -1);
      add_obj_to_inven(LVar0, LVar1);
    end
    if (random(0, 3) == 3) then begin
      LVar1 := create_object_sid(51, 0, 0, -1);
      add_obj_to_inven(LVar0, LVar1);
    end
    LVar1 := create_object_sid(106, 0, 0, -1);
    add_obj_to_inven(LVar0, LVar1);
    LVar1 := item_caps_adjust(LVar0, random(3, 9) * (has_trait(0, dude_obj, 20) + 1));
    kill_critter(Critter, 61);
  Steel1: |
    display_msg(message_str(112, 226));
    Tot_Critter_A := 2;
    Tot_Critter_B := 6;
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 8;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 4;
    group_angle := random(0, 5);
    random_seed_1 := 0;
    Critter_script := 759;
    if (random(0, 1)) then begin
      Critter_type := 16777491;
    end
    else begin
      Critter_type := 16777494;
    end
    Critter_direction := group_angle + (random(0, 2) - 1);
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    call Place_critter;
    if (group_angle == 0) then begin
      Critter_direction := 3;
    end
    else begin
      if (group_angle == 1) then begin
        Critter_direction := 4;
      end
      else begin
        if (group_angle == 2) then begin
          Critter_direction := 5;
        end
        else begin
          if (group_angle == 3) then begin
            Critter_direction := 0;
          end
          else begin
            if (group_angle == 4) then begin
              Critter_direction := 1;
            end
            else begin
              if (group_angle == 5) then begin
                Critter_direction := 2;
              end
            end
          end
        end
      end
    end
    if (random(0, 2) == 0) then begin
      Critter_direction := Critter_direction + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
    end
    anim(Critter, 1000, Critter_direction);
    Item := create_object_sid(28, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    victim := Critter;
    Critter_script := 758;
    while(Tot_Critter_A) do begin
      if (random(0, 1)) then begin
        Critter_type := 16777490;
      end
      else begin
        Critter_type := 16777493;
      end
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Item := create_object_sid(12, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      if (random(1, 3) == 1) then begin
        Item := create_object_sid(13, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
        Item := create_object_sid(37, 0, 0, -1);
        add_mult_objs_to_inven(Critter, Item, random(1, 3));
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777403;
    Critter_script := 850;
    if (group_angle == 0) then begin
      group_angle := 3;
    end
    else begin
      if (group_angle == 1) then begin
        group_angle := 4;
      end
      else begin
        if (group_angle == 2) then begin
          group_angle := 5;
        end
        else begin
          if (group_angle == 3) then begin
            group_angle := 0;
          end
          else begin
            if (group_angle == 4) then begin
              group_angle := 1;
            end
            else begin
              if (group_angle == 5) then begin
                group_angle := 2;
              end
            end
          end
        end
      end
    end
    while(Tot_Critter_B) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      if (random(1, 3) == 1) then begin
        Item := create_object_sid(11, 0, 0, -1);
      end
      else begin
        Item := create_object_sid(12, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      if (random(1, 2) == 1) then begin
        Item := create_object_sid(13, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
        Item := create_object_sid(37, 0, 0, -1);
        add_mult_objs_to_inven(Critter, Item, random(1, 3));
      end
      Tot_Critter_B := Tot_Critter_B - 1;
    end
    attack_setup(victim, Critter);
    set_global_var(288, 3);
    call stranger;
  Steel2: |
    display_msg(message_str(112, 227));
    Tot_Critter_A := random(6, 10);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 7;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 3;
    Critter_type := 16777612;
    Critter_script := 12;
    while(Tot_Critter_A) do begin
      Critter_direction := random(3, 5);
      call Place_critter;
      if (random(1, 3) == 1) then begin
        anim(Critter, 1000, random(0, 5));
      end
      else begin
        anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 3);
    call stranger;
  Steel3: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 6);
    if (obj_is_carrying_obj_pid(dude_obj, 126)) then begin
      display_msg(message_str(112, 125));
      destroy_object(obj_carrying_pid_obj(dude_obj, 126));
    end
    else begin
      Skill_roll := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
      if (is_success(Skill_roll)) then begin
        if (LVar0 == 1) then begin
          display_msg(message_str(112, 109));
        end
        else begin
          display_msg(message_str(112, 110) + LVar0 + message_str(112, 111));
        end
      end
      else begin
        if (is_critical(Skill_roll)) then begin
          LVar1 := random(2, 4);
          if (LVar0 == 1) then begin
            display_msg(message_str(112, 112) + LVar1 + message_str(112, 113));
          end
          else begin
            display_msg(message_str(112, 114) + LVar0 + message_str(112, 115) + LVar1 + message_str(112, 116));
          end
          critter_injure(dude_obj, 2);
        end
        else begin
          LVar1 := random(1, 2);
          if (LVar0 == 1) then begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 117));
            end
            else begin
              display_msg(message_str(112, 118) + LVar1 + message_str(112, 119));
            end
          end
          else begin
            if (LVar1 == 1) then begin
              display_msg(message_str(112, 120) + LVar0 + message_str(112, 121));
            end
            else begin
              display_msg(message_str(112, 122) + LVar0 + message_str(112, 123) + LVar1 + message_str(112, 124));
            end
            critter_injure(dude_obj, 2);
          end
        end
      end
      critter_dmg(dude_obj, LVar1, 0);
      LVar0 := LVar0 * 3600;
      game_time_advance(game_ticks(LVar0));
    end
  Steel4: |
    display_msg(message_str(112, 250));
    Tot_Critter_A := random(5, 7);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 4;
    group_angle := dude_rot;
    random_seed_1 := 0;
    if (random(0, 1)) then begin
      Critter_type := 16777491;
    end
    else begin
      Critter_type := 16777494;
    end
    Critter_script := 759;
    Critter_direction := group_angle + (random(0, 2) - 1);
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    call Place_critter;
    if (group_angle == 0) then begin
      Critter_direction := 3;
    end
    else begin
      if (group_angle == 1) then begin
        Critter_direction := 4;
      end
      else begin
        if (group_angle == 2) then begin
          Critter_direction := 5;
        end
        else begin
          if (group_angle == 3) then begin
            Critter_direction := 0;
          end
          else begin
            if (group_angle == 4) then begin
              Critter_direction := 1;
            end
            else begin
              if (group_angle == 5) then begin
                Critter_direction := 2;
              end
            end
          end
        end
      end
    end
    if (random(0, 2) == 0) then begin
      Critter_direction := Critter_direction + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
    end
    anim(Critter, 1000, Critter_direction);
    Item := create_object_sid(28, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Critter_script := 758;
    while(Tot_Critter_A) do begin
      if (random(0, 1)) then begin
        Critter_type := 16777490;
      end
      else begin
        Critter_type := 16777493;
      end
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      if (random(1, 3) == 1) then begin
        Item := create_object_sid(32, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      Item := create_object_sid(12, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
  Steel5: |
    variable LVar0 := 0;
    display_msg(message_str(112, 251));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    LVar0 := tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(7, 12));
    Scenery_Creation := create_object_sid(33554959, LVar0, 0, -1);
    Scenery_Creation_Hex := LVar0;
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 1, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 3, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 4, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 5, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 0, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 5, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 1, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    LVar0 := tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(7, 12));
    Scenery_Creation := create_object_sid(33554960, LVar0, 0, -1);
    Scenery_Creation_Hex := LVar0;
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 1, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 3, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 4, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 5, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 0, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 1) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 5, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    Scenery_Creation_Count := 0;
    while(Scenery_Creation_Count < 2) do begin
      Scenery_Creation_Hex := tile_num_in_direction(Scenery_Creation_Hex, 1, 1);
      Scenery_Creation := create_object_sid(33554499, Scenery_Creation_Hex, 0, -1);
      Scenery_Creation_Count := Scenery_Creation_Count + 1;
    end
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      Critter := create_object_sid(33554433, 0, 0, -1);
      Critter_tile := tile_num_in_direction(Dude_tile, random(0, 5), 5);
      critter_attempt_placement(Critter, Critter_tile, 0);
      Critter := create_object_sid(33554433, 0, 0, -1);
      Critter_tile := tile_num_in_direction(Dude_tile, random(0, 5), 5);
      critter_attempt_placement(Critter, Critter_tile, 0);
    end
    Tot_Critter_A := random(1, 2);
    while(Tot_Critter_A) do begin
      Critter_type := 16777244;
      Critter_script := 34;
      Critter_direction := random(0, 5);
      call Place_critter;
      anim(Critter, 1000, random(0, 5));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Tot_Critter_A := random(2, 4);
    Critter_type := 16777245;
    Critter_script := 752;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 5);
      call Place_critter;
      anim(Critter, 1000, random(0, 5));
      if (random(0, 1)) then begin
        Item := create_object_sid(71, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      if (random(0, 1)) then begin
        Item := create_object_sid(29, 0, 0, -1);
        add_mult_objs_to_inven(Critter, Item, 2 * (has_trait(0, dude_obj, 40) + 1));
      end
      if (random(0, 1)) then begin
        Item := create_object_sid(30, 0, 0, -1);
        add_mult_objs_to_inven(Critter, Item, 1 * (has_trait(0, dude_obj, 40) + 1));
      end
      if (random(0, 1)) then begin
        Item := create_object_sid(34, 0, 0, -1);
        add_mult_objs_to_inven(Critter, Item, 2 * (has_trait(0, dude_obj, 40) + 1));
      end
      if (random(0, 1)) then begin
        Item := create_object_sid(40, 0, 0, -1);
        add_mult_objs_to_inven(Critter, Item, random(0, 4));
      end
      if (random(0, 1)) then begin
        Item := create_object_sid(47, 0, 0, -1);
        add_mult_objs_to_inven(Critter, Item, random(0, 1));
      end
      if (random(0, 1)) then begin
        Item := create_object_sid(81, 0, 0, -1);
        add_mult_objs_to_inven(Critter, Item, random(0, 3));
      end
      Item := item_caps_adjust(Critter, random(12, 32) * (has_trait(0, dude_obj, 20) + 1));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Tot_Critter_B := random(6, 8);
    Critter_script := 755;
    while(Tot_Critter_B) do begin
      Critter_direction := random(0, 5);
      if (random(0, 1)) then begin
        Critter_type := 16777243;
      end
      else begin
        Critter_type := 16777238;
      end
      call Place_critter;
      anim(Critter, 1000, random(0, 5));
      Item := item_caps_adjust(Critter, random(1, 15) * (has_trait(0, dude_obj, 20) + 1));
      if (Critter_type == 16777238) then begin
        if (random(0, 1)) then begin
          Item := create_object_sid(95, 0, 0, -1);
          add_obj_to_inven(Critter, Item);
          if (has_trait(0, dude_obj, 40)) then begin
            Item := create_object_sid(95, 0, 0, -1);
            add_obj_to_inven(Critter, Item);
          end
        end
        else begin
          Item := create_object_sid(34, 0, 0, -1);
          add_obj_to_inven(Critter, Item);
          if (has_trait(0, dude_obj, 40)) then begin
            Item := create_object_sid(34, 0, 0, -1);
            add_obj_to_inven(Critter, Item);
          end
        end
      end
      else begin
        Item := create_object_sid(29, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
        if (has_trait(0, dude_obj, 40)) then begin
          Item := create_object_sid(29, 0, 0, -1);
          add_obj_to_inven(Critter, Item);
        end
        Item := create_object_sid(8, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      if (random(0, 1)) then begin
        if (random(0, 2) == 0) then begin
          Item := create_object_sid(125, 0, 0, -1);
        end
        else begin
          Item := create_object_sid(124, 0, 0, -1);
        end
        add_obj_to_inven(Critter, Item);
      end
      Tot_Critter_B := Tot_Critter_B - 1;
    end
  Steel6: |
    display_msg(message_str(112, 252));
    Tot_Critter_A := random(3, 4);
    Tot_Critter_B := random(12, 15);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 7;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 4;
    group_angle := random(0, 5);
    random_seed_1 := 0;
    Critter_script := 759;
    if (random(0, 1)) then begin
      Critter_type := 16777491;
    end
    else begin
      Critter_type := 16777494;
    end
    Critter_direction := group_angle + (random(0, 2) - 1);
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    call Place_critter;
    if (group_angle == 0) then begin
      Critter_direction := 3;
    end
    else begin
      if (group_angle == 1) then begin
        Critter_direction := 4;
      end
      else begin
        if (group_angle == 2) then begin
          Critter_direction := 5;
        end
        else begin
          if (group_angle == 3) then begin
            Critter_direction := 0;
          end
          else begin
            if (group_angle == 4) then begin
              Critter_direction := 1;
            end
            else begin
              if (group_angle == 5) then begin
                Critter_direction := 2;
              end
            end
          end
        end
      end
    end
    if (random(0, 2) == 0) then begin
      Critter_direction := Critter_direction + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
    end
    anim(Critter, 1000, Critter_direction);
    Item := create_object_sid(28, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Critter_script := 758;
    while(Tot_Critter_A) do begin
      if (random(0, 1)) then begin
        Critter_type := 16777490;
      end
      else begin
        Critter_type := 16777493;
      end
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      if (random(0, 3) == 1) then begin
        Item := create_object_sid(13, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
        Item := create_object_sid(37, 0, 0, -1);
        add_mult_objs_to_inven(Critter, Item, random(1, 3));
      end
      else begin
        Item := create_object_sid(12, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    victim := Critter;
    Critter_type := 16777254;
    Critter_script := 749;
    if (group_angle == 0) then begin
      group_angle := 3;
    end
    else begin
      if (group_angle == 1) then begin
        group_angle := 4;
      end
      else begin
        if (group_angle == 2) then begin
          group_angle := 5;
        end
        else begin
          if (group_angle == 3) then begin
            group_angle := 0;
          end
          else begin
            if (group_angle == 4) then begin
              group_angle := 1;
            end
            else begin
              if (group_angle == 5) then begin
                group_angle := 2;
              end
            end
          end
        end
      end
    end
    while(Tot_Critter_B) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Item := create_object_sid(7, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      if (random(0, 2)) then begin
        Item := create_object_sid(30, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
        if (has_trait(0, dude_obj, 40)) then begin
          Item := create_object_sid(30, 0, 0, -1);
          add_obj_to_inven(Critter, Item);
        end
        Item := create_object_sid(8, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      if (random(0, 1)) then begin
        Item := create_object_sid(40, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      Tot_Critter_B := Tot_Critter_B - 1;
    end
    attack_setup(Critter, victim);
    set_global_var(288, 3);
    call stranger;
  Vats1: |
    display_msg(message_str(112, 253));
    radiation_inc(dude_obj, random(15, 30));
    Tot_Critter_A := random(3, 4);
    Tot_Critter_B := 1;
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 3;
    Critter_type := 16777403;
    Critter_script := 850;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 2);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      if (random(0, 1) == 1) then begin
        if (random(0, 3) == 0) then begin
          Item := create_object_sid(11, 0, 0, -1);
        end
        else begin
          Item := create_object_sid(12, 0, 0, -1);
        end
      end
      else begin
        Item := create_object_sid(234, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777241;
    Critter_script := 854;
    while(Tot_Critter_B) do begin
      Critter_direction := random(0, 2);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Item := create_object_sid(12, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(35, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Tot_Critter_B := Tot_Critter_B - 1;
    end
    set_global_var(288, 3);
    call stranger;
  Vats2: |
    display_msg(message_str(112, 254));
    if (random(0, 1)) then begin
      Critter_type := 16777259;
      Critter_script := 953;
    end
    else begin
      Critter_type := 16777261;
      Critter_script := 953;
    end
    Tot_Critter_A := random(3, 5);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 2;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 2);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 3);
    call stranger;
  Vats3: |
    display_msg(message_str(112, 306));
    Tot_Critter_A := random(1, 2);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 4;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 2;
    Critter_type := 16777261;
    Critter_script := 953;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 2);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777259;
    Critter_script := 953;
    Tot_Critter_A := 1;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 2);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    Tot_Critter_A := random(2, 3);
    Critter_type := 16777403;
    Critter_script := 850;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 2);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777241;
    Critter_script := 854;
    Critter_direction := random(0, 2);
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(118, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(38, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 2);
    if (not(obj_is_carrying_obj_pid(dude_obj, 100))) then begin
      Item := create_object_sid(100, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    set_global_var(288, 3);
    call stranger;
  Vats4: |
    display_msg(message_str(112, 256));
    Tot_Critter_A := random(3, 4);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 7;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Critter_type := 16777403;
    Critter_script := 850;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 2);
      call Place_critter;
      anim(Critter, 1000, random(3, 4));
      if (random(0, 1) == 1) then begin
        if (random(0, 1) == 1) then begin
          Item := create_object_sid(11, 0, 0, -1);
        end
        else begin
          Item := create_object_sid(12, 0, 0, -1);
        end
      end
      else begin
        Item := create_object_sid(234, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777241;
    Critter_script := 854;
    Tot_Critter_B := 1;
    while(Tot_Critter_B) do begin
      Critter_direction := random(0, 2);
      call Place_critter;
      anim(Critter, 1000, random(3, 4));
      Item := create_object_sid(12, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(35, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Tot_Critter_B := Tot_Critter_B - 1;
    end
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 3;
    Critter_type := 16777261;
    Critter_script := 953;
    Critter_direction := random(0, 2);
    call Place_critter;
    anim(Critter, 1000, random(3, 4));
    set_global_var(288, 3);
    call stranger;
  Vats5: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 6);
    Skill_roll := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
    if (is_success(Skill_roll)) then begin
      if (LVar0 == 1) then begin
        display_msg(message_str(112, 109));
      end
      else begin
        display_msg(message_str(112, 110) + LVar0 + message_str(112, 111));
      end
    end
    else begin
      if (is_critical(Skill_roll)) then begin
        LVar1 := random(2, 4);
        if (LVar0 == 1) then begin
          display_msg(message_str(112, 112) + LVar1 + message_str(112, 113));
        end
        else begin
          display_msg(message_str(112, 114) + LVar0 + message_str(112, 115) + LVar1 + message_str(112, 116));
        end
        critter_injure(dude_obj, 2);
      end
      else begin
        LVar1 := random(1, 2);
        if (LVar0 == 1) then begin
          if (LVar1 == 1) then begin
            display_msg(message_str(112, 117));
          end
          else begin
            display_msg(message_str(112, 118) + LVar1 + message_str(112, 119));
          end
          critter_injure(dude_obj, 2);
        end
        else begin
          if (LVar1 == 1) then begin
            display_msg(message_str(112, 120) + LVar0 + message_str(112, 121));
          end
          else begin
            display_msg(message_str(112, 122) + LVar0 + message_str(112, 123) + LVar1 + message_str(112, 124));
          end
          critter_injure(dude_obj, 2);
        end
      end
    end
    LVar0 := LVar0 * 3600;
    game_time_advance(game_ticks(LVar0));
  Vats6: |
    display_msg(message_str(112, 279));
    Item := create_object_sid(33554804, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(8, 10)), 0, -1);
    Item := create_object_sid(33554653, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(5, 9)), 0, -1);
    Item := create_object_sid(33554654, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(5, 9)), 0, -1);
    Item := create_object_sid(33554747, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(5, 9)), 0, -1);
    Item := create_object_sid(33555207, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(5, 9)), 0, -1);
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      Item := create_object_sid(33554433, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(8, 10)), 0, -1);
      if (random(0, 1)) then begin
        Item := create_object_sid(33554433, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(8, 10)), 0, -1);
      end
    end
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    group_angle := random(0, 5);
    Critter_type := 16777403;
    Critter_script := 850;
    Tot_Critter_A := random(2, 3);
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777241;
    Critter_script := 854;
    Critter_direction := random(0, 2);
    Critter_direction := group_angle + (random(0, 2) - 1);
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(12, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(35, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 3;
    Critter_type := 16777261;
    Critter_script := 953;
    Tot_Critter_A := 2;
    if (group_angle == 0) then begin
      group_angle := 3;
    end
    else begin
      if (group_angle == 1) then begin
        group_angle := 4;
      end
      else begin
        if (group_angle == 2) then begin
          group_angle := 5;
        end
        else begin
          if (group_angle == 3) then begin
            group_angle := 0;
          end
          else begin
            if (group_angle == 4) then begin
              group_angle := 1;
            end
            else begin
              if (group_angle == 5) then begin
                group_angle := 2;
              end
            end
          end
        end
      end
    end
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 3);
    call stranger;
  Glow1: |
    variable LVar0 := 3;
    display_msg(message_str(112, 280));
    Tot_Critter_A := random(2, 3);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
    Critter_type := 16777403;
    Critter_script := 850;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 5);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    if (random(0, 1)) then begin
      Critter_type := 16777241;
      Critter_script := 854;
      Critter_direction := random(0, 5);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Item := create_object_sid(118, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      if (has_trait(0, dude_obj, 40)) then begin
        LVar0 := 5;
      end
      while(LVar0) do begin
        Item := create_object_sid(38, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
        LVar0 := LVar0 - 1;
      end
    end
    set_global_var(288, 3);
    call stranger;
  Glow2: |
    variable LVar0 := 0;
    display_msg(message_str(112, 281));
    LVar0 := game_time_hour;
    Tot_Critter_A := random(3, 5);
    if ((LVar0 > 600) and (LVar0 < 1900)) then begin
      Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 5;
      Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 2;
    end
    else begin
      Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 2;
      Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 2;
    end
    Critter_type := 16777261;
    Critter_script := 953;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 5);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    if (random(0, 1)) then begin
      Critter_direction := random(0, 4);
      Critter_type := 16777259;
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    end
    set_global_var(288, 3);
    call stranger;
  Glow3: |
    display_msg(message_str(112, 282));
    Tot_Critter_A := random(4, 8);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 8;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 5;
    Critter_type := 16777227;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 4);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Item := create_object_sid(92, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 3);
    call stranger;
  Glow4: |
    display_msg(message_str(112, 283));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 4;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 2;
    Critter_type := 16777261;
    Critter_script := 953;
    Tot_Critter_A := 1;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 2);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    radiation_inc(dude_obj, random(15, 30));
  Glow5: |
    display_msg(message_str(112, 284));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 3;
    group_angle := random(0, 5);
    Tot_Critter_A := 1 + random(0, 1);
    Critter_type := 16777261;
    Critter_script := 953;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    if (random(0, 1)) then begin
      Critter_type := 16777259;
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
    end
  Glow6: |
    display_msg(message_str(112, 285));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 2;
    Critter_script := 953;
    Critter_type := 16777259;
    Critter_direction := random(2, 5);
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    if (random(0, 1)) then begin
      Critter_type := 16777261;
      Critter_direction := random(1, 4);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    end
    set_global_var(288, 3);
    call stranger;
  Death1: |
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 8;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 8;
    if (global_var(100) != 2) then begin
      display_msg(message_str(112, 286));
      Critter_direction := random(0, 5);
      Critter_type := 16777267;
      Critter_script := 642;
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    end
    else begin
      display_msg(message_str(112, 287));
      Critter_type := 16777612;
      Critter_script := 12;
      Tot_Critter_A := random(3, 5);
      while(Tot_Critter_A) do begin
        Critter_direction := random(0, 5);
        call Place_critter;
        anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
        Tot_Critter_A := Tot_Critter_A - 1;
      end
    end
    set_global_var(288, 2);
    call stranger;
  Death2: |
    display_msg(message_str(112, 288));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 3;
    Critter_direction := random(0, 5);
    Critter_type := 16777259;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    set_global_var(288, 2);
    call stranger;
  Death3: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 6) + 2;
    if (obj_is_carrying_obj_pid(dude_obj, 126)) then begin
      display_msg(message_str(112, 125));
      destroy_object(obj_carrying_pid_obj(dude_obj, 126));
    end
    else begin
      Skill_roll := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
      if (is_success(Skill_roll)) then begin
        display_msg(message_str(112, 110) + LVar0 + message_str(112, 111));
      end
      else begin
        if (is_critical(Skill_roll)) then begin
          LVar1 := random(2, 4);
        end
        else begin
          LVar1 := random(2, 3);
        end
        display_msg(message_str(112, 114) + LVar0 + message_str(112, 115) + LVar1 + message_str(112, 116));
        critter_injure(dude_obj, 2);
      end
      critter_dmg(dude_obj, LVar1, 0);
      LVar0 := LVar0 * 3600;
      game_time_advance(game_ticks(LVar0));
    end
  Death4: |
    display_msg(message_str(112, 299));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Tot_Critter_A := random(2, 4);
    group_angle := random(0, 5);
    Critter_type := 16777227;
    Critter_script := 12;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 4) - 2);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 2);
    call stranger;
  Death5: |
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 10;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 10;
    if (1 == 1) then begin
      display_msg(message_str(112, 300));
      Critter_direction := dude_rot + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      Critter_type := 16777254;
      Critter_script := 703;
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Item := create_object_sid(18, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(4, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := item_caps_adjust(Critter, (random(20, 60) * has_trait(0, dude_obj, 20)) + 1);
      Item := create_object_sid(40, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(31, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(111, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(9, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(1, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(125, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      set_global_var(125, 1);
    end
    else begin
      display_msg(message_str(112, 301));
      Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 7;
      Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
      Critter_direction := random(0, 5);
      if (random(0, 3) == 3) then begin
        Critter_type := 16777226;
      end
      else begin
        Critter_type := 16777378;
      end
      Critter_script := 222;
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    end
    set_global_var(288, 2);
    call stranger;
  Death6: |
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    if (global_var(100) != 2) then begin
      display_msg(message_str(112, 302));
      Critter_direction := random(0, 5);
      Critter_type := 16777267;
      Critter_script := 642;
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    end
    else begin
      display_msg(message_str(112, 303));
      Critter_type := 16777227;
      Critter_script := 12;
      Tot_Critter_A := random(3, 5);
      group_angle := random(0, 5);
      while(Tot_Critter_A) do begin
        Critter_direction := group_angle + (random(0, 4) - 2);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
        call Place_critter;
        anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
        Tot_Critter_A := Tot_Critter_A - 1;
      end
    end
    set_global_var(288, 2);
    call stranger;
  Bone1: |
    display_msg(message_str(112, 307));
    Tot_Critter_A := random(2, 3);
    group_angle := random(0, 5);
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
    Critter_type := 16777403;
    Critter_script := 850;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 4) - 2);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      if (random(1, 4) == 1) then begin
        Item := create_object_sid(11, 0, 0, -1);
      end
      else begin
        Item := create_object_sid(12, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      if (random(1, 5) == 1) then begin
        Item := create_object_sid(13, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(5, 20) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    if (random(0, 1)) then begin
      Critter_type := 16777241;
      Critter_script := 854;
      Critter_direction := group_angle + (random(0, 4) - 2);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Item := create_object_sid(12, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(5, 20) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      end
    end
    set_global_var(288, 3);
    call stranger;
  Bone2: |
    variable LVar0 := 0;
    display_msg(message_str(112, 308));
    group_angle := random(0, 5);
    if ((game_time_hour >= 1900) or (game_time_hour < 600) and random(0, 1)) then begin
      Critter := create_object_sid(33555044, 0, 0, -1);
      Critter_tile := tile_num_in_direction(Dude_tile, group_angle, 4);
      critter_attempt_placement(Critter, Critter_tile, 0);
      Critter := create_object_sid(33555044, 0, 0, -1);
      if (group_angle == 0) then begin
        Item := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Item := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Item := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Item := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Item := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Item := 2;
                end
              end
            end
          end
        end
      end
      Critter_tile := tile_num_in_direction(Dude_tile, Item, 4);
      critter_attempt_placement(Critter, Critter_tile, 0);
    end
    Dude_tile := Dude_tile + (random(0, 4) - 2 + ((random(0, 2) - 1) * 200));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 4;
    Tot_Critter_A := random(3, 5);
    Tot_Critter_B := random(3, 5);
    Critter_type := 16777419;
    Critter_script := 749;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      LVar0 := random(0, 2);
      if (LVar0 == 0) then begin
        Item := create_object_sid(18, 0, 0, -1);
      end
      else begin
        if (LVar0 == 1) then begin
          Item := create_object_sid(21, 0, 0, -1);
        end
        else begin
          Item := create_object_sid(8, 0, 0, -1);
        end
      end
      add_obj_to_inven(Critter, Item);
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(5, 25) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    victim := Critter;
    Critter_type := 16777472;
    Critter_script := 751;
    if (group_angle == 0) then begin
      group_angle := 3;
    end
    else begin
      if (group_angle == 1) then begin
        group_angle := 4;
      end
      else begin
        if (group_angle == 2) then begin
          group_angle := 5;
        end
        else begin
          if (group_angle == 3) then begin
            group_angle := 0;
          end
          else begin
            if (group_angle == 4) then begin
              group_angle := 1;
            end
            else begin
              if (group_angle == 5) then begin
                group_angle := 2;
              end
            end
          end
        end
      end
    end
    while(Tot_Critter_B) do begin
      Critter_direction := group_angle + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      if (group_angle == 0) then begin
        Critter_direction := 3;
      end
      else begin
        if (group_angle == 1) then begin
          Critter_direction := 4;
        end
        else begin
          if (group_angle == 2) then begin
            Critter_direction := 5;
          end
          else begin
            if (group_angle == 3) then begin
              Critter_direction := 0;
            end
            else begin
              if (group_angle == 4) then begin
                Critter_direction := 1;
              end
              else begin
                if (group_angle == 5) then begin
                  Critter_direction := 2;
                end
              end
            end
          end
        end
      end
      if (random(0, 2) == 0) then begin
        Critter_direction := Critter_direction + (random(0, 2) - 1);
        while(Critter_direction < 0) do begin
          Critter_direction := Critter_direction + 6;
        end
        if (Critter_direction > 5) then begin
          Critter_direction := Critter_direction % 6;
        end
      end
      anim(Critter, 1000, Critter_direction);
      if (random(0, 1)) then begin
        Item := create_object_sid(4, 0, 0, -1);
      end
      else begin
        Item := create_object_sid(7, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(4, 25) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      end
      Tot_Critter_B := Tot_Critter_B - 1;
    end
    attack_setup(Critter, victim);
    set_global_var(288, 2);
    call stranger;
  Bone3: |
    display_msg(message_str(112, 309));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Tot_Critter_A := random(3, 7);
    group_angle := random(0, 5);
    Critter_type := 16777419;
    Critter_script := 749;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + random(0, 2 * 2) - 2;
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      if (random(0, 1)) then begin
        Item := create_object_sid(8, 0, 0, -1);
      end
      else begin
        Item := create_object_sid(9, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(4, 25) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777254;
    Critter_script := 749;
    Critter_direction := group_angle + random(0, 2 * 2) - 2;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(1, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(47, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := item_caps_adjust(Critter, random(25, 100) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    if (random(0, 1)) then begin
      Item := create_object_sid(38, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(6, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(31, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(4, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    set_global_var(288, 1);
    call stranger;
  Bone4: |
    display_msg(message_str(112, 310));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Tot_Critter_A := random(2, 5);
    group_angle := random(0, 5);
    Critter_type := 16777419;
    Critter_script := 749;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + random(0, 2 * 2) - 2;
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      if (random(0, 1)) then begin
        Item := create_object_sid(8, 0, 0, -1);
      end
      else begin
        Item := create_object_sid(9, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(4, 25) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777254;
    Critter_script := 749;
    Critter_direction := group_angle + random(0, 2 * 2) - 2;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(47, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := item_caps_adjust(Critter, random(25, 100) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    if (random(0, 1)) then begin
      Item := create_object_sid(38, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(6, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(31, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(4, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    set_global_var(288, 1);
    call stranger;
  Bone5: |
    display_msg(message_str(112, 311));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 6;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
    Tot_Critter_A := random(1, 3);
    group_angle := random(0, 5);
    Critter_type := 16777419;
    Critter_script := 749;
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle + random(0, 2 * 2) - 2;
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      if (random(0, 1)) then begin
        Item := create_object_sid(8, 0, 0, -1);
      end
      else begin
        Item := create_object_sid(9, 0, 0, -1);
      end
      add_obj_to_inven(Critter, Item);
      if (random(0, 2) == 0) then begin
        Item := item_caps_adjust(Critter, random(4, 25) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Critter_type := 16777254;
    Critter_script := 749;
    Critter_direction := group_angle + random(0, 2 * 2) - 2;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(1, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(47, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := item_caps_adjust(Critter, random(25, 100) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    if (random(0, 1)) then begin
      Item := create_object_sid(38, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(6, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(31, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, has_trait(0, dude_obj, 40) + 1);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(4, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    set_global_var(288, 2);
    call stranger;
  Bone6: |
    display_msg(message_str(112, 313));
    Tot_Critter_A := random(4, 6);
    if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
      Outer_ring := 6;
      Inner_ring := 3;
    end
    else begin
      Outer_ring := 4;
      Inner_ring := 3;
    end
    Critter_type := 16777284;
    Critter_script := 735;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 5);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    set_global_var(288, 1);
    call stranger;
  Scenes: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    variable LVar3 := 0;
    variable LVar4 := 0;
    Tot_Critter_A := random(3, 14);
    LVar4 := -1;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 5);
      Range := random(4, 28);
      Place_Holder := Range;
      LVar0 := tile_num_in_direction(Dude_tile, Critter_direction, Place_Holder);
      Critter_direction := random(0, 5);
      LVar0 := tile_num_in_direction(Dude_tile, Critter_direction, Place_Holder);
      LVar0 := LVar0 + (random(0, 2) - 1);
      Critter_direction := random(0, 5);
      LVar0 := tile_num_in_direction(Dude_tile, Critter_direction, Place_Holder);
      LVar0 := LVar0 + (random(0, 2) - 1);
      Critter_direction := random(0, 5);
      LVar0 := tile_num_in_direction(Dude_tile, Critter_direction, Place_Holder);
      LVar2 := random(0, 9);
      while(LVar4 == LVar2) do begin
        LVar2 := random(0, 9);
      end
      debug_msg(message_str(112, 304) + LVar2 + "");
      if (LVar2 == 0) then begin
        LVar3 := random(1, 6);
        if (LVar3 == 1) then begin
          Item := create_object_sid(33554517, 0, 0, -1);
        end
        else begin
          if (LVar3 == 2) then begin
            if (random(1, 4) == 1) then begin
              Item := create_object_sid(33554749, 0, 0, -1);
            end
            else begin
              Item := create_object_sid(33554496, 0, 0, -1);
            end
          end
          else begin
            if (LVar3 == 3) then begin
              Item := create_object_sid(33554555, 0, 0, -1);
            end
            else begin
              if (LVar3 == 4) then begin
                Item := create_object_sid(33554496, 0, 0, -1);
              end
              else begin
                if (LVar3 == 5) then begin
                  Item := create_object_sid(33554497, 0, 0, -1);
                end
                else begin
                  if (random(1, 3) == 1) then begin
                    Item := create_object_sid(33554498, 0, 0, -1);
                  end
                  else begin
                    Item := create_object_sid(33554744, 0, 0, -1);
                  end
                end
              end
            end
          end
        end
      end
      else begin
        if (LVar2 == 1) then begin
          LVar3 := random(1, 3);
          if (LVar3 == 1) then begin
            Item := create_object_sid(33554712, 0, 0, -1);
          end
          else begin
            if (LVar3 == 2) then begin
              Item := create_object_sid(33554711, 0, 0, -1);
            end
            else begin
              Item := create_object_sid(33554710, 0, 0, -1);
            end
          end
        end
        else begin
          if (LVar2 == 2) then begin
            LVar3 := random(1, 5);
            if (LVar3 == 1) then begin
              Item := create_object_sid(33554514, 0, 0, -1);
            end
            else begin
              if (LVar3 == 2) then begin
                Item := create_object_sid(33554515, 0, 0, -1);
              end
              else begin
                if (LVar3 == 3) then begin
                  Item := create_object_sid(33554516, 0, 0, -1);
                end
                else begin
                  if (LVar3 == 4) then begin
                    Item := create_object_sid(33554517, 0, 0, -1);
                  end
                  else begin
                    Item := create_object_sid(33554518, 0, 0, -1);
                  end
                end
              end
            end
          end
          else begin
            if (LVar2 == 3) then begin
              Item := create_object_sid(33554533, 0, 0, -1);
            end
            else begin
              if (LVar2 == 4) then begin
                LVar3 := random(1, 4);
                if (LVar3 == 1) then begin
                  Item := create_object_sid(33554524, 0, 0, -1);
                end
                else begin
                  if (LVar3 == 2) then begin
                    Item := create_object_sid(33554525, 0, 0, -1);
                  end
                  else begin
                    if (LVar3 == 3) then begin
                      Item := create_object_sid(33554524, 0, 0, -1);
                    end
                    else begin
                      Item := create_object_sid(33554525, 0, 0, -1);
                    end
                  end
                end
              end
              else begin
                if (LVar2 == 5) then begin
                  LVar3 := random(1, 4);
                  if (LVar3 == 1) then begin
                    Item := create_object_sid(33554534, 0, 0, -1);
                  end
                  else begin
                    if (LVar3 == 2) then begin
                      Item := create_object_sid(33554535, 0, 0, -1);
                    end
                    else begin
                      if (LVar3 == 3) then begin
                        Item := create_object_sid(33554536, 0, 0, -1);
                      end
                      else begin
                        Item := create_object_sid(33554534, 0, 0, -1);
                      end
                    end
                  end
                end
                else begin
                  if (LVar2 == 6) then begin
                    LVar3 := random(1, 3);
                    if (LVar3 == 1) then begin
                      Item := create_object_sid(33554541, 0, 0, -1);
                    end
                    else begin
                      if (LVar3 == 2) then begin
                        Item := create_object_sid(33554542, 0, 0, -1);
                      end
                      else begin
                        Item := create_object_sid(33554540, 0, 0, -1);
                      end
                    end
                  end
                  else begin
                    if (LVar2 == 7) then begin
                      LVar3 := random(1, 4);
                      if (LVar3 == 1) then begin
                        Item := create_object_sid(33554555, 0, 0, -1);
                      end
                      else begin
                        if (LVar3 == 2) then begin
                          Item := create_object_sid(33554553, 0, 0, -1);
                        end
                        else begin
                          if (LVar3 == 3) then begin
                            Item := create_object_sid(33554556, 0, 0, -1);
                          end
                          else begin
                            Item := create_object_sid(33554554, 0, 0, -1);
                          end
                        end
                      end
                    end
                    else begin
                      if (LVar2 == 8) then begin
                        LVar3 := random(1, 3);
                        if (LVar3 == 1) then begin
                          Item := create_object_sid(33554712, 0, 0, -1);
                        end
                        else begin
                          if (LVar3 == 2) then begin
                            Item := create_object_sid(33554711, 0, 0, -1);
                          end
                          else begin
                            Item := create_object_sid(33554710, 0, 0, -1);
                          end
                        end
                      end
                      else begin
                        LVar3 := random(1, 6);
                        if (LVar3 == 1) then begin
                          Item := create_object_sid(33554517, 0, 0, -1);
                        end
                        else begin
                          if (LVar3 == 2) then begin
                            if (random(1, 3) == 1) then begin
                              Item := create_object_sid(33554749, 0, 0, -1);
                            end
                            else begin
                              Item := create_object_sid(33554496, 0, 0, -1);
                            end
                          end
                          else begin
                            if (LVar3 == 3) then begin
                              Item := create_object_sid(33554555, 0, 0, -1);
                            end
                            else begin
                              if (LVar3 == 4) then begin
                                Item := create_object_sid(33554496, 0, 0, -1);
                              end
                              else begin
                                if (LVar3 == 5) then begin
                                  Item := create_object_sid(33554497, 0, 0, -1);
                                end
                                else begin
                                  if (random(1, 3) == 1) then begin
                                    Item := create_object_sid(33554498, 0, 0, -1);
                                  end
                                  else begin
                                    Item := create_object_sid(random(0, 2) + 33554710, 0, 0, -1);
                                  end
                                end
                              end
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
      LVar4 := LVar2;
      critter_attempt_placement(Item, LVar0, 0);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
  Place_critter: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    Critter := create_object_sid(Critter_type, 0, 0, Critter_script);
    Range := random(Inner_ring, Outer_ring);
    LVar0 := random(0, 5);
    Critter_tile := tile_num_in_direction(Dude_tile, Critter_direction, Range);
    LVar1 := tile_num_in_direction(Critter_tile, LVar0, Range / 2);
    if ((tile_distance(Dude_tile, LVar1) <= Outer_ring) and (tile_distance(Dude_tile, LVar1) >= Inner_ring)) then begin
      Critter_tile := tile_num_in_direction(Critter_tile, LVar0, Range / 2);
    end
    critter_attempt_placement(Critter, Critter_tile, 0);
  hunters: |
    Inner_ring := 8;
    Outer_ring := 5;
    group_angle := random(0, 5);
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777349;
    Critter_script := 241;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(23, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(36, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 4 * (has_trait(0, dude_obj, 40) + 1));
    Item := create_object_sid(17, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := item_caps_adjust(Critter, random(5, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    Item := create_object_sid(144, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2);
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777467;
    Critter_script := 383;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(7, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(2, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    if (random(0, 2) == 0) then begin
      Item := item_caps_adjust(Critter, random(5, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    end
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777472;
    Critter_script := 383;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(143, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(34, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 3 * (has_trait(0, dude_obj, 40) + 1));
    Item := create_object_sid(2, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(14, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2 * (has_trait(0, dude_obj, 40) + 1));
    if (random(0, 2) == 0) then begin
      Item := item_caps_adjust(Critter, random(5, 40) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    end
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777462;
    Critter_script := 383;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(18, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(31, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2 * (has_trait(0, dude_obj, 40) + 1));
    Item := create_object_sid(2, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    if (random(0, 2) == 0) then begin
      Item := item_caps_adjust(Critter, random(5, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    end
    call stranger;
rndmtn:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 16) then begin
          call map_exit_p_proc;
        end
      end
    end
  map_enter_p_proc: |
    dude_rot := random(0, 5);
    if ((global_var(32) != 1) and metarule(14, 0)) then begin
      Ranger_rerolls := has_trait(0, dude_obj, 47);
      set_global_var(334, 0);
      while(Encounter_Num == 0) do begin
        Encounter_Num := random(1, 6) + random(1, 6) + random(1, 6);
        if (get_critter_stat(dude_obj, 6) > 8) then begin
          Encounter_Num := Encounter_Num + 2;
        end
        else begin
          if (get_critter_stat(dude_obj, 6) > 7) then begin
            Encounter_Num := Encounter_Num + 1;
          end
          else begin
            if (get_critter_stat(dude_obj, 6) < 3) then begin
              Encounter_Num := Encounter_Num - 1;
            end
          end
        end
        if ((global_var(123) != 3) and (global_var(158) > 2) and random(0, 1)) then begin
          Encounter_Num := 7;
        end
        else begin
          if (Encounter_Num <= 3) then begin
            Encounter_Num := 1;
          end
          else begin
            if (Encounter_Num <= 5) then begin
              Encounter_Num := 2;
            end
            else begin
              if (Encounter_Num <= 8) then begin
                Encounter_Num := 3;
              end
              else begin
                if (Encounter_Num <= 12) then begin
                  Encounter_Num := 4;
                end
                else begin
                  if (Encounter_Num <= 15) then begin
                    Encounter_Num := 5;
                  end
                  else begin
                    Encounter_Num := 6;
                  end
                end
              end
            end
          end
        end
        if (global_var(65) == 2) then begin
          call North_table;
        end
        else begin
          if (global_var(65) == 3) then begin
            call South_table;
          end
          else begin
            call Vault_table;
          end
        end
      end
    end
    else begin
      if (metarule(14, 0)) then begin
        dude_pos := random(0, 2);
        if (dude_pos == 0) then begin
          override_map_start(78, 92, 0, dude_rot);
        end
        else begin
          if (dude_pos == 1) then begin
            override_map_start(95, 86, 0, dude_rot);
          end
          else begin
            override_map_start(94, 90, 0, dude_rot);
          end
        end
      end
    end
    call Lighting;
    call add_party;
  map_update_p_proc: 'call Lighting;

    '
  map_exit_p_proc: "[]"
  stranger: |
    if (has_trait(0, dude_obj, 46) and (global_var(601) == 0) and random(0, 1)) then begin
      Critter_type := 16777520;
      Critter_script := 856;
      Critter_direction := random(0, 5);
      Outer_ring := 7;
      Inner_ring := 4;
      call Place_critter;
      Critter_direction := dude_rot + (random(0, 2) - 1);
      while(Critter_direction < 0) do begin
        Critter_direction := Critter_direction + 6;
      end
      if (Critter_direction > 5) then begin
        Critter_direction := Critter_direction % 6;
      end
      anim(Critter, 1000, Critter_direction);
      Item := create_object_sid(113, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(7, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      Item := create_object_sid(40, 0, 0, -1);
      add_mult_objs_to_inven(Critter, Item, 2);
      Item := item_caps_adjust(Critter, random(7, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
      set_global_var(288, 10);
    end
  Place_critter: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    Critter := create_object_sid(Critter_type, 0, 0, Critter_script);
    LVar2 := random(Inner_ring, Outer_ring);
    LVar0 := random(0, 5);
    Critter_tile := tile_num_in_direction(Dude_tile, Critter_direction, LVar2);
    LVar1 := tile_num_in_direction(Critter_tile, LVar0, LVar2 / 2);
    if ((tile_distance(Dude_tile, LVar1) <= Outer_ring) and (tile_distance(Dude_tile, LVar1) >= Inner_ring)) then begin
      Critter_tile := tile_num_in_direction(Critter_tile, LVar0, LVar2 / 2);
    end
    critter_attempt_placement(Critter, Critter_tile, 0);
  choose_start: |
    if (global_var(65) == 2) then begin
      if (Encounter_Num == 1) then begin
        override_map_start(99, 87, 0, 2);
      end
      else begin
        if (Encounter_Num == 6) then begin
          override_map_start(81, 88, 0, 2);
        end
        else begin
          override_map_start(88, 93, 0, dude_rot);
        end
      end
    end
    else begin
      if (global_var(65) == 3) then begin
        if (Encounter_Num == 1) then begin
          override_map_start(99, 87, 0, 2);
        end
        else begin
          if (Encounter_Num == 5) then begin
            override_map_start(82, 95, 0, 2);
          end
          else begin
            if (Encounter_Num == 6) then begin
              override_map_start(81, 88, 0, 2);
            end
            else begin
              override_map_start(88, 93, 0, dude_rot);
            end
          end
        end
      end
      else begin
        if (Encounter_Num == 5) then begin
          override_map_start(99, 87, 0, 2);
        end
        else begin
          if (Encounter_Num == 6) then begin
            override_map_start(92, 93, 0, 2);
          end
          else begin
            override_map_start(88, 93, 0, dude_rot);
          end
        end
      end
    end
    Dude_tile := tile_num(dude_obj);
  Patrick: |
    display_msg(message_str(246, 121));
    Critter := create_object_sid(16777247, 0, 0, 667);
    critter_attempt_placement(Critter, Dude_tile - 4, 0);
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    CritterXpos := (Dude_tile % 200) - 4;
    CritterYpos := Dude_tile / 200;
    Critter := create_object_sid(33554810, 0, 0, -1);
    critter_attempt_placement(Critter, (CritterYpos * 200) + (CritterXpos - 3), 0);
    Critter := create_object_sid(33554800, 0, 0, -1);
    critter_attempt_placement(Critter, ((CritterYpos - 1) * 200) + (CritterXpos - 3), 0);
    Critter := create_object_sid(33554804, 0, 0, -1);
    critter_attempt_placement(Critter, ((CritterYpos + 1) * 200) + (CritterXpos - 3), 0);
    Critter := create_object_sid(180, 0, 0, -1);
    critter_attempt_placement(Critter, (CritterYpos * 200) + (CritterXpos - 2), 0);
    Item := item_caps_adjust(Critter, random(2, 6) * (has_trait(0, dude_obj, 20) + 1));
    if (random(0, 1)) then begin
      Item := create_object_sid(81, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    Critter := create_object_sid(33555207, 0, 0, -1);
    critter_attempt_placement(Critter, (CritterYpos * 200) + (CritterXpos - 4), 0);
    Critter := create_object_sid(33554745, 0, 0, -1);
    critter_attempt_placement(Critter, ((CritterYpos + 1) * 200) + (CritterXpos - 2), 0);
    Critter := create_object_sid(180, 0, 0, -1);
    critter_attempt_placement(Critter, ((CritterYpos - 2) * 200) + (CritterXpos - 2), 0);
    Item := create_object_sid(106, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, random(1, 2));
    Item := create_object_sid(124, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, random(1, 2));
    Critter := create_object_sid(33554744, 0, 0, -1);
    critter_attempt_placement(Critter, ((CritterYpos - 1) * 200) + (CritterXpos - 5), 0);
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      Critter := create_object_sid(33555044, 0, 0, -1);
      critter_attempt_placement(Critter, ((CritterYpos + 4) * 200) + (CritterXpos - 2), 0);
      Critter := create_object_sid(33554640, 0, 0, -1);
      critter_attempt_placement(Critter, ((CritterYpos + 4) * 200) + (CritterXpos - 4), 0);
      Critter := create_object_sid(124, 0, 0, -1);
      critter_attempt_placement(Critter, ((CritterYpos + 5) * 200) + (CritterXpos - 1), 0);
    end
    else begin
      Critter := create_object_sid(33554710, 0, 0, -1);
      critter_attempt_placement(Critter, ((CritterYpos + 4) * 200) + (CritterXpos - 2), 0);
      Critter := create_object_sid(33554711, 0, 0, -1);
      critter_attempt_placement(Critter, ((CritterYpos + 4) * 200) + (CritterXpos - 1), 0);
      Critter := create_object_sid(33554712, 0, 0, -1);
      critter_attempt_placement(Critter, ((CritterYpos + 4) * 200) + (CritterXpos - 3), 0);
      Critter := create_object_sid(33554866, 0, 0, -1);
      critter_attempt_placement(Critter, ((CritterYpos + 3) * 200) + (CritterXpos - 2), 0);
    end
    Critter := create_object_sid(180, 0, 0, -1);
    critter_attempt_placement(Critter, ((CritterYpos - 2) * 200) + (CritterXpos - 4), 0);
    Item := create_object_sid(18, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(31, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    if (has_trait(0, dude_obj, 40)) then begin
      Item := create_object_sid(30, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
    end
    Item := create_object_sid(1, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := item_caps_adjust(Critter, random(25, 50) * (has_trait(0, dude_obj, 20) + 1));
    Item := create_object_sid(4, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(20, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(45, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2);
    Item := create_object_sid(79, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2);
    Item := create_object_sid(75, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(144, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2);
  North_table: |
    if ((Encounter_Num == 3) and (global_var(297) != 0)) then begin
      Encounter_Num := 4;
    end
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 1) or (Encounter_Num == 2) or (Encounter_Num == 4) or (Encounter_Num == 6) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Northern mountain encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call North1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call North2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call North3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call North4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call North5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call North6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  South_table: |
    if ((Encounter_Num == 4) and (global_var(297) != 0)) then begin
      Encounter_Num := 5;
    end
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 1) or (Encounter_Num == 2) or (Encounter_Num == 5) or (Encounter_Num == 6) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Southern Mountain encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num == 1) then begin
        call South1;
      end
      else begin
        if (Encounter_Num == 2) then begin
          call South2;
        end
        else begin
          if (Encounter_Num == 3) then begin
            call South3;
          end
          else begin
            if (Encounter_Num == 4) then begin
              call South4;
            end
            else begin
              if (Encounter_Num == 5) then begin
                call South5;
              end
              else begin
                if (Encounter_Num == 6) then begin
                  call South6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  Vault_table: |
    if (Ranger_rerolls) then begin
      Ranger_rerolls := Ranger_rerolls - 1;
      if ((Encounter_Num == 1) or (Encounter_Num == 3) or (Encounter_Num == 5) or (Encounter_Num == 6) or (Encounter_Num == 7)) then begin
        Encounter_Num := 0;
      end
    end
    if (global_var(295)) then begin
      Encounter_Num := global_var(295);
      set_global_var(295, 0);
      debug_msg("Vault Mountain encounter type: " + Encounter_Num);
    end
    if (Encounter_Num) then begin
      call choose_start;
      if (Encounter_Num <= 1) then begin
        call Vault1;
      end
      else begin
        if (Encounter_Num <= 2) then begin
          call Vault2;
        end
        else begin
          if (Encounter_Num <= 3) then begin
            call Vault3;
          end
          else begin
            if (Encounter_Num <= 4) then begin
              call Vault4;
            end
            else begin
              if (Encounter_Num <= 5) then begin
                call Vault5;
              end
              else begin
                if (Encounter_Num <= 6) then begin
                  call Vault6;
                end
                else begin
                  call hunters;
                end
              end
            end
          end
        end
      end
    end
  North1: |
    variable LVar0 := 0;
    display_msg(message_str(246, 114));
    LVar0 := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
    if (is_success(LVar0)) then begin
      display_msg(message_str(246, 115));
      if (is_critical(LVar0)) then begin
        display_msg(message_str(246, 116));
        critter_heal(dude_obj, random(1, 3));
      end
    end
    else begin
      if (is_critical(LVar0)) then begin
        display_msg(message_str(246, 117));
        critter_dmg(dude_obj, random(1, 6) + 3, 0);
        critter_injure(dude_obj, 2);
      end
      else begin
        display_msg(message_str(246, 118));
        critter_dmg(dude_obj, random(1, 4), 0);
        critter_injure(dude_obj, 2);
      end
    end
  North2: |
    display_msg(message_str(246, 105));
    Tot_Critter_A := random(2, 3);
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      Outer_ring := 5;
      Inner_ring := 3;
    end
    else begin
      Outer_ring := 8;
      Inner_ring := 6;
    end
    Critter_type := 16777227;
    Critter_script := 12;
    group_angle := random(0, 3);
    if (group_angle == 3) then begin
      group_angle := 4;
    end
    if (group_angle == 2) then begin
      group_angle := 4;
    end
    while(Tot_Critter_A) do begin
      Critter_direction := group_angle;
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    call stranger;
  North3: 'call Patrick;

    '
  North4: |
    variable LVar0 := 0;
    LVar0 := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
    if (is_success(LVar0)) then begin
      display_msg(message_str(246, 106));
      Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 2;
      Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 1;
    end
    else begin
      display_msg(message_str(246, 107));
      Outer_ring := 2;
      Inner_ring := 1;
    end
    Critter_direction := dude_rot;
    Critter_type := 16777612;
    Critter_script := 12;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    critter_injure(dude_obj, 2);
    call stranger;
  North5: |
    variable LVar0 := 1;
    display_msg(message_str(246, 108));
    if (random(0, 1)) then begin
      Tot_Critter_A := random(1, 2);
    end
    else begin
      Tot_Critter_A := random(2, 4);
    end
    Outer_ring := 5;
    Inner_ring := 3;
    Critter_script := 222;
    while(Tot_Critter_A) do begin
      if (random(0, 4) == 4) then begin
        Critter_type := 16777226;
      end
      else begin
        Critter_type := 16777378;
      end
      Critter_direction := random(0, 2);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      if (LVar0) then begin
        LVar0 := random(2, 4);
        while(LVar0) do begin
          Item := create_object_sid(71, tile_num_in_direction(tile_num(Critter), random(0, 5), random(2, 4)), 0, -1);
          LVar0 := LVar0 - 1;
        end
        LVar0 := 0;
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    call stranger;
  North6: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    display_msg(message_str(246, 100));
    Tot_Critter_A := 8;
    while(Tot_Critter_A) do begin
      LVar0 := random(0, 5);
      if (LVar0 == 4) then begin
        LVar1 := 33554864;
      end
      else begin
        if (LVar0 == 5) then begin
          LVar1 := 33554864 + 1;
        end
        else begin
          LVar1 := 33554866;
        end
      end
      LVar0 := random(0, 5);
      if ((LVar0 == 5) or (LVar0 == 0)) then begin
        Item := create_object_sid(LVar1, tile_num_in_direction(Dude_tile + random(0, 8) - 4, LVar0, random(1, 6)), 0, -1);
      end
      else begin
        Item := create_object_sid(LVar1, tile_num_in_direction(Dude_tile + random(0, 8) - 4, LVar0, random(1, 9)), 0, -1);
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Tot_Critter_A := 10;
    while(Tot_Critter_A) do begin
      LVar1 := random(0, 3);
      if (LVar1 == 3) then begin
        LVar1 := 6;
      end
      LVar0 := random(0, 5);
      if ((LVar0 == 5) or (LVar0 == 0)) then begin
        Item := create_object_sid(33554861 + LVar1, tile_num_in_direction(Dude_tile + random(0, 4) - 2, LVar0, random(1, 6)), 0, -1);
      end
      else begin
        Item := create_object_sid(33554861 + LVar1, tile_num_in_direction(Dude_tile + random(0, 4) - 2, LVar0, random(1, 9)), 0, -1);
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Tot_Critter_A := 3;
    while(Tot_Critter_A) do begin
      LVar0 := random(0, 5);
      if ((LVar0 == 5) or (LVar0 == 0)) then begin
        Item := create_object_sid(33554860, tile_num_in_direction(Dude_tile + random(0, 4) - 2, LVar0, random(3, 6)), 0, -1);
      end
      else begin
        Item := create_object_sid(33554860, tile_num_in_direction(Dude_tile + random(0, 4) - 2, LVar0, random(3, 9)), 0, -1);
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    LVar0 := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
    if (1 == 1) then begin
      display_msg(message_str(246, 101));
      critter_injure(dude_obj, 2);
      if (1 == 1) then begin
        display_msg(message_str(246, 102));
        Critter_type := 16777527;
        Critter_script := -1;
        Outer_ring := 10;
        Inner_ring := 10;
        Critter_direction := 2;
        call Place_critter;
        Item := item_caps_adjust(Critter, random(10, 60) * (has_trait(0, dude_obj, 20) + 1));
        if (random(1, 4) == 4) then begin
          Item := create_object_sid(40, 0, 0, -1);
          add_obj_to_inven(Critter, Item);
        end
        if (random(1, 4) == 4) then begin
          Item := create_object_sid(8, 0, 0, -1);
          add_obj_to_inven(Critter, Item);
        end
        if (random(1, 4) == 4) then begin
          Item := create_object_sid(29, 0, 0, -1);
          add_mult_objs_to_inven(Critter, Item, 1 + has_trait(0, dude_obj, 40));
        end
        if (random(1, 4) == 4) then begin
          Item := create_object_sid(1, 0, 0, -1);
          add_obj_to_inven(Critter, Item);
        end
        kill_critter(Critter, 48);
      end
      else begin
        if (is_critical(LVar0)) then begin
          display_msg(message_str(246, 103));
          critter_dmg(dude_obj, random(1, 6) + 2, 0);
          if (random(0, 1)) then begin
            critter_injure(dude_obj, 4);
          end
          else begin
            critter_injure(dude_obj, 8);
          end
        end
        else begin
          display_msg(message_str(246, 104));
          critter_dmg(dude_obj, random(1, 4), 0);
          critter_injure(dude_obj, 2);
        end
      end
    end
  South1: |
    variable LVar0 := 0;
    display_msg(message_str(246, 114));
    LVar0 := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
    if (is_success(LVar0)) then begin
      display_msg(message_str(246, 115));
      if (is_critical(LVar0)) then begin
        display_msg(message_str(246, 116));
        critter_heal(dude_obj, random(1, 3));
      end
    end
    else begin
      if (is_critical(LVar0)) then begin
        display_msg(message_str(246, 117));
        critter_dmg(dude_obj, random(1, 6) + 3, 0);
        critter_injure(dude_obj, 2);
      end
      else begin
        display_msg(message_str(246, 118));
        critter_dmg(dude_obj, random(1, 6) - 2, 0);
        critter_injure(dude_obj, 2);
      end
    end
  South2: |
    display_msg(message_str(246, 136));
    Tot_Critter_A := random(2, 6);
    Outer_ring := 7;
    Inner_ring := 4;
    Critter_type := 16777227;
    Critter_script := 12;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 4);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    call stranger;
  South3: |
    display_msg(message_str(246, 120));
    Tot_Critter_A := random(3, 8);
    Outer_ring := 5;
    Inner_ring := 2;
    Critter_type := 16777264;
    Critter_script := 222;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 4);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    call stranger;
  South4: 'call Patrick;

    '
  South5: |
    display_msg(message_str(246, 122));
    Tot_Critter_A := 9;
    Outer_ring := 7;
    Inner_ring := 0;
    while(Tot_Critter_A) do begin
      if (random(0, 2) == 0) then begin
        Critter_type := 33554711;
      end
      else begin
        Critter_type := 33554866;
      end
      Item := create_object_sid(Critter_type, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(0, 11)), 0, -1);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Item := create_object_sid(33554514, tile_num_in_direction(Dude_tile + random(0, 4) - 2, random(0, 5), random(1, 8)), 0, -1);
    Item := create_object_sid(33554515, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(2, 7)), 0, -1);
    Item := create_object_sid(7, tile_num_in_direction(Dude_tile + random(0, 4) - 2, random(0, 5), random(3, 7)), 0, -1);
    Item := create_object_sid(4, tile_num_in_direction(Dude_tile + random(0, 4) - 2, random(0, 5), random(2, 9)), 0, -1);
    Item := create_object_sid(4, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(2, 7)), 0, -1);
    Outer_ring := 9;
    Inner_ring := 3;
    Critter_script := -1;
    Critter_type := 16777234;
    Critter_direction := random(0, 5);
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    kill_critter(Critter, 48);
    Critter_type := 16777234;
    Critter_direction := random(0, 5);
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    kill_critter(Critter, 57);
    Critter_type := 16777229;
    Critter_direction := random(0, 5);
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    kill_critter(Critter, 57);
    Critter_type := 16777229;
    Critter_direction := random(0, 5);
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    kill_critter(Critter, 48);
    Critter_type := 16777255;
    Critter_direction := random(0, 5);
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    kill_critter(Critter, 48);
    Critter_type := 16777247;
    Critter_direction := random(0, 5);
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    kill_critter(Critter, 48);
    Critter_type := 16777230;
    Critter_direction := random(0, 5);
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    kill_critter(Critter, 48);
    Critter_type := 16777229;
    Critter_direction := random(0, 5);
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    kill_critter(Critter, 57);
    if (get_critter_stat(dude_obj, 6) >= 4) then begin
      Critter_type := 16777243;
      Critter_direction := random(0, 5);
      call Place_critter;
      anim(Critter, 1000, random(0, 5));
      Item := create_object_sid(30, 0, 0, -1);
      add_obj_to_inven(Critter, Item);
      if (has_trait(0, dude_obj, 40)) then begin
        Item := create_object_sid(29, 0, 0, -1);
        add_obj_to_inven(Critter, Item);
      end
      kill_critter(Critter, 48);
    end
    if (get_critter_stat(dude_obj, 6) >= 4) then begin
      if (random(0, 1)) then begin
        Item := create_object_sid(29, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(3, 6)), 0, -1);
        if (has_trait(0, dude_obj, 40)) then begin
          Item := create_object_sid(29, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(3, 6)), 0, -1);
        end
      end
      if (random(0, 1)) then begin
        Item := create_object_sid(30, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(3, 6)), 0, -1);
        if (has_trait(0, dude_obj, 40)) then begin
          Item := create_object_sid(30, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(3, 6)), 0, -1);
        end
      end
    end
    if (get_critter_stat(dude_obj, 6) >= 9) then begin
      if (random(0, 1)) then begin
        Item := create_object_sid(8, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(3, 6)), 0, -1);
      end
      else begin
        if (random(0, 1)) then begin
          Item := create_object_sid(10, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(3, 6)), 0, -1);
        end
        else begin
          Item := create_object_sid(94, tile_num_in_direction(Dude_tile + random(0, 8) - 4, random(0, 5), random(3, 6)), 0, -1);
        end
      end
    end
    Tot_Critter_A := 0;
    if (get_critter_stat(dude_obj, 6) <= 3) then begin
      Tot_Critter_A := random(2, 4);
    end
    else begin
      if (get_critter_stat(dude_obj, 6) < 7) then begin
        Tot_Critter_A := random(1, 2);
      end
    end
    Outer_ring := 7;
    Inner_ring := 4;
    Critter_type := 16777612;
    Critter_script := 12;
    while(Tot_Critter_A) do begin
      Critter_direction := random(1, 2);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
  South6: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    display_msg(message_str(246, 100));
    Tot_Critter_A := 8;
    while(Tot_Critter_A) do begin
      LVar0 := random(0, 5);
      if (LVar0 == 4) then begin
        LVar1 := 33554864;
      end
      else begin
        if (LVar0 == 5) then begin
          LVar1 := 33554864 + 1;
        end
        else begin
          LVar1 := 33554866;
        end
      end
      LVar0 := random(0, 5);
      if ((LVar0 == 5) or (LVar0 == 0)) then begin
        Item := create_object_sid(LVar1, tile_num_in_direction(Dude_tile + random(0, 8) - 4, LVar0, random(1, 6)), 0, -1);
      end
      else begin
        Item := create_object_sid(LVar1, tile_num_in_direction(Dude_tile + random(0, 8) - 4, LVar0, random(1, 9)), 0, -1);
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Tot_Critter_A := 10;
    while(Tot_Critter_A) do begin
      LVar1 := random(0, 3);
      if (LVar1 == 3) then begin
        LVar1 := 6;
      end
      LVar0 := random(0, 5);
      if ((LVar0 == 5) or (LVar0 == 0)) then begin
        Item := create_object_sid(33554861 + LVar1, tile_num_in_direction(Dude_tile + random(0, 4) - 2, LVar0, random(1, 6)), 0, -1);
      end
      else begin
        Item := create_object_sid(33554861 + LVar1, tile_num_in_direction(Dude_tile + random(0, 4) - 2, LVar0, random(1, 9)), 0, -1);
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    Tot_Critter_A := 3;
    while(Tot_Critter_A) do begin
      LVar0 := random(0, 5);
      if ((LVar0 == 5) or (LVar0 == 0)) then begin
        Item := create_object_sid(33554860, tile_num_in_direction(Dude_tile + random(0, 4) - 2, LVar0, random(3, 6)), 0, -1);
      end
      else begin
        Item := create_object_sid(33554860, tile_num_in_direction(Dude_tile + random(0, 4) - 2, LVar0, random(3, 9)), 0, -1);
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    LVar0 := roll_vs_skill(dude_obj, 17, 20 * has_trait(0, dude_obj, 16));
    if (is_success(LVar0)) then begin
      display_msg(message_str(246, 101));
      critter_injure(dude_obj, 2);
      if (is_critical(LVar0)) then begin
        display_msg(message_str(246, 102));
        Critter_type := 16777527;
        Critter_script := -1;
        Outer_ring := 10;
        Inner_ring := 10;
        Critter_direction := 2;
        call Place_critter;
        Item := item_caps_adjust(Critter, random(10, 60) * (has_trait(0, dude_obj, 20) + 1));
        if (random(1, 4) == 4) then begin
          Item := create_object_sid(40, 0, 0, -1);
          add_obj_to_inven(Critter, Item);
        end
        if (random(1, 4) == 4) then begin
          Item := create_object_sid(8, 0, 0, -1);
          add_obj_to_inven(Critter, Item);
        end
        if (random(1, 4) == 4) then begin
          Item := create_object_sid(29, 0, 0, -1);
          add_mult_objs_to_inven(Critter, Item, 1 + has_trait(0, dude_obj, 40));
        end
        if (random(1, 4) == 4) then begin
          Item := create_object_sid(1, 0, 0, -1);
          add_obj_to_inven(Critter, Item);
        end
        kill_critter(Critter, 48);
      end
      else begin
        if (is_critical(LVar0)) then begin
          display_msg(message_str(246, 103));
          critter_dmg(dude_obj, random(1, 6) + 2, 0);
          if (random(0, 1)) then begin
            critter_injure(dude_obj, 4);
          end
          else begin
            critter_injure(dude_obj, 8);
          end
        end
        else begin
          display_msg(message_str(246, 104));
          critter_dmg(dude_obj, random(1, 4), 0);
          critter_injure(dude_obj, 2);
        end
      end
    end
  Vault1: |
    display_msg(message_str(246, 128));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 4) + 5;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 4) + 4;
    Critter_direction := random(0, 4);
    Critter_type := 16777227;
    Critter_script := 928;
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    call stranger;
  Vault2: |
    display_msg(message_str(246, 135));
    Critter_type := 16777527;
    Critter_script := -1;
    Outer_ring := 6;
    Inner_ring := 4;
    Critter_direction := 1;
    call Place_critter;
    anim(Critter, 1000, random(0, 5));
    kill_critter(Critter, 48);
    if (random(0, 1)) then begin
      Item := create_object_sid(29, 0, 0, -1);
      critter_attempt_placement(Item, tile_num(Critter), 0);
    end
    if (random(0, 1)) then begin
      Item := create_object_sid(40, 0, 0, -1);
      critter_attempt_placement(Item, tile_num(Critter), 0);
    end
  Vault3: |
    display_msg(message_str(246, 129));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 3) + 4;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 3) + 2;
    Tot_Critter_A := random(2, 3);
    Critter_script := 222;
    while(Tot_Critter_A) do begin
      if (random(0, 3) == 3) then begin
        Critter_type := 16777226;
      end
      else begin
        Critter_type := 16777378;
      end
      Critter_direction := random(0, 4);
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    call stranger;
  Vault4: |
    display_msg(message_str(246, 130));
    Outer_ring := (get_critter_stat(dude_obj, 1) / 2) + 3;
    Inner_ring := (get_critter_stat(dude_obj, 1) / 2) + 1;
    Tot_Critter_A := random(4, 8);
    Critter_type := 16777264;
    Critter_script := 222;
    while(Tot_Critter_A) do begin
      Critter_direction := random(0, 5);
      call Place_critter;
      if (random(0, 1)) then begin
        anim(Critter, 1000, random(0, 5));
      end
      else begin
        anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
      end
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    call stranger;
  Vault5: |
    variable LVar0 := 0;
    LVar0 := do_check(dude_obj, 5, 0);
    if (not(is_success(LVar0))) then begin
      if (is_critical(LVar0)) then begin
        display_msg(message_str(246, 132));
        critter_dmg(dude_obj, random(1, 3), 0);
        critter_injure(dude_obj, 2);
      end
      else begin
        display_msg(message_str(246, 133));
        critter_dmg(dude_obj, 1, 0);
        critter_injure(dude_obj, 2);
      end
    end
    else begin
      display_msg(message_str(246, 131));
      critter_injure(dude_obj, 2);
    end
  Vault6: |
    display_msg(message_str(246, 134));
    Outer_ring := 6;
    Inner_ring := 4;
    Tot_Critter_A := random(4, 6);
    Critter_type := 16777264;
    Critter_script := 934;
    while(Tot_Critter_A) do begin
      Critter_direction := 1;
      call Place_critter;
      anim(Critter, 1000, 4);
      Tot_Critter_A := Tot_Critter_A - 1;
    end
    victim := Critter;
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      Critter_type := 16777227;
      Critter_script := 12;
      Outer_ring := 10;
      Inner_ring := 9;
      Critter_direction := 1;
      call Place_critter;
      anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    end
    call stranger;
  Lighting: |
    variable LVar0 := 0;
    LVar0 := game_time_hour;
    if ((LVar0 >= 600) and (LVar0 < 700)) then begin
      set_light_level(LVar0 - 600 + 40);
    end
    else begin
      if ((LVar0 >= 700) and (LVar0 < 1800)) then begin
        set_light_level(100);
      end
      else begin
        if ((LVar0 >= 1800) and (LVar0 < 1900)) then begin
          set_light_level(100 - (LVar0 - 1800));
        end
        else begin
          set_light_level(40);
        end
      end
    end
  hunters: |
    Inner_ring := 8;
    Outer_ring := 5;
    group_angle := random(0, 5);
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777349;
    Critter_script := 241;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(23, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(36, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 4 * (has_trait(0, dude_obj, 40) + 1));
    Item := create_object_sid(17, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := item_caps_adjust(Critter, random(5, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    Item := create_object_sid(144, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2);
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777467;
    Critter_script := 383;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(7, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(2, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    if (random(0, 2) == 0) then begin
      Item := item_caps_adjust(Critter, random(5, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    end
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777472;
    Critter_script := 383;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(143, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(34, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 3 * (has_trait(0, dude_obj, 40) + 1));
    Item := create_object_sid(2, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(14, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2 * (has_trait(0, dude_obj, 40) + 1));
    if (random(0, 2) == 0) then begin
      Item := item_caps_adjust(Critter, random(5, 40) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    end
    Critter_direction := group_angle + random(0, 3 * 2) - 3;
    while(Critter_direction < 0) do begin
      Critter_direction := Critter_direction + 6;
    end
    if (Critter_direction > 5) then begin
      Critter_direction := Critter_direction % 6;
    end
    Critter_type := 16777462;
    Critter_script := 383;
    call Place_critter;
    anim(Critter, 1000, rotation_to_tile(tile_num(Critter), tile_num(dude_obj)));
    Item := create_object_sid(18, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    Item := create_object_sid(31, 0, 0, -1);
    add_mult_objs_to_inven(Critter, Item, 2 * (has_trait(0, dude_obj, 40) + 1));
    Item := create_object_sid(2, 0, 0, -1);
    add_obj_to_inven(Critter, Item);
    if (random(0, 2) == 0) then begin
      Item := item_caps_adjust(Critter, random(5, 30) * ((2 * has_trait(0, dude_obj, 20)) + 1));
    end
    call stranger;
  add_party: |
    if (global_var(26) == 5) then begin
      if (Tandi_ptr == 0) then begin
      end
      critter_add_trait(Tandi_ptr, 1, 6, 0);
    end
robctrl:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(368, 100));
  talk_p_proc: |
    start_gdialog(368, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(0) == 1) then begin
      gsay_message(368, 101, 50);
    end
    else begin
      if (local_var(1) == 1) then begin
        call Control14;
      end
      else begin
        call Control00;
      end
    end
    gsay_end;
    end_dialogue;
  use_p_proc: |
    script_overrides;
    display_msg(message_str(368, 196));
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 100) then begin
      display_msg(message_str(368, 195));
    end
  use_skill_on_p_proc: |
    if (action_being_used == 13) then begin
      script_overrides;
      display_msg(message_str(368, 197));
    end
    else begin
      if (action_being_used == 12) then begin
        script_overrides;
        dialogue_system_enter;
      end
    end
  Control00: |
    set_local_var(1, 1);
    gsay_reply(368, 102);
    giq_option(-3, 368, 103, Control01, 50);
    giq_option(4, 368, 104, Control03, 50);
    giq_option(6, 368, 105, Control03, 50);
    giq_option(8, 368, 106, Control06, 50);
  Control01: |
    gsay_reply(368, 107);
    giq_option(-3, 368, 108, Control01, 50);
    giq_option(-3, 368, 109, Control01, 50);
    giq_option(-3, 368, 110, Control02, 50);
    giq_option(-3, 368, 111, Control01, 50);
  Control02: 'gsay_message(368, 112, 50);

    '
  Control03: |
    gsay_reply(368, 113);
    giq_option(6, 368, 114, Controlend, 50);
    giq_option(6, 368, 115, Control04, 50);
    giq_option(6, 368, 116, Control06, 50);
  Control04: |
    gsay_reply(368, 117);
    giq_option(6, 368, 118, Control05, 50);
    giq_option(6, 368, 119, Control06, 50);
  Control05: |
    gsay_reply(368, 120);
    giq_option(6, 368, 121, Control06, 50);
  Control06: |
    gsay_reply(368, 122);
    giq_option(6, 368, 123, Control07, 50);
    giq_option(6, 368, 124, Control07, 50);
    giq_option(6, 368, 125, Control07, 50);
    giq_option(6, 368, 126, Control07, 50);
    giq_option(6, 368, 127, Controlend, 50);
  Control07: |
    gsay_reply(368, 128);
    giq_option(6, 368, 129, Control08, 50);
    giq_option(6, 368, 130, Control09, 50);
    giq_option(6, 368, 131, Control10, 50);
    giq_option(6, 368, 132, Control11, 50);
    giq_option(6, 368, 133, Controlend, 50);
  Control08: |
    gsay_reply(368, 134);
    giq_option(6, 368, 135, Control08a, 50);
    giq_option(6, 368, 136, Control08b, 50);
    giq_option(6, 368, 137, Control08c, 50);
  Control08a: |
    set_global_var(274, 0);
    call Control12;
  Control08b: |
    set_global_var(274, 1);
    call Control12;
  Control08c: |
    set_global_var(274, 2);
    call Control12;
  Control09: |
    gsay_reply(368, 138);
    giq_option(6, 368, 139, Control09a, 50);
    giq_option(6, 368, 140, Control09b, 50);
  Control09a: |
    set_global_var(275, 0);
    call Control12;
  Control09b: |
    set_global_var(275, 1);
    call Control12;
  Control10: |
    gsay_reply(368, 141);
    giq_option(6, 368, 142, Control10a, 50);
    giq_option(6, 368, 143, Control10b, 50);
    giq_option(6, 368, 144, Control10c, 50);
    giq_option(6, 368, 145, Control10d, 50);
    giq_option(6, 368, 146, Control10e, 50);
  Control10a: |
    set_global_var(273, 1);
    call Control12;
  Control10b: |
    set_global_var(273, 4);
    call Control12;
  Control10c: |
    set_global_var(273, 3);
    call Control12;
  Control10d: |
    set_global_var(273, 2);
    call Control12;
  Control10e: |
    set_global_var(273, 0);
    call Control12;
  Control11: |
    chance := 4 * 10;
    if (chance < 5) then begin
      chance := 5;
    end
    if (chance > 95) then begin
      chance := 95;
    end
    rndx := random(1, 100);
    if (rndx < chance) then begin
      gsay_message(368, 147, 50);
    end
    else begin
      gsay_message(368, 148, 50);
    end
  Control12: |
    gsay_reply(368, 149);
    giq_option(6, 368, 150, Control08, 50);
    giq_option(6, 368, 151, Control09, 50);
    giq_option(6, 368, 152, Control10, 50);
    giq_option(6, 368, 153, Control11, 50);
    giq_option(6, 368, 154, Controlend, 50);
  Control13: |
    gsay_reply(368, 155);
    giq_option(6, 368, 156, Control08, 50);
    giq_option(6, 368, 157, Control09, 50);
    giq_option(6, 368, 158, Control10, 50);
    giq_option(6, 368, 159, Control11, 50);
    giq_option(6, 368, 160, Controlend, 50);
  Control14: |
    gsay_reply(368, 161);
    giq_option(-3, 368, 103, Control01, 50);
    giq_option(4, 368, 104, Control03, 50);
    giq_option(6, 368, 105, Control03, 50);
    giq_option(6, 368, 163, Control13, 50);
    giq_option(6, 368, 164, Control15, 50);
    giq_option(6, 368, 165, Control16, 50);
    giq_option(6, 368, 166, Control23, 50);
    giq_option(6, 368, 167, Controlend, 50);
  Control15: |
    gsay_reply(368, 168);
    giq_option(6, 368, 169, Control13, 50);
    giq_option(6, 368, 170, Control16, 50);
    giq_option(6, 368, 171, Control23, 50);
    giq_option(6, 368, 172, Controlend, 50);
  Control16: |
    gsay_reply(368, 173);
    giq_option(6, 368, 174, Control13, 50);
    giq_option(6, 368, 175, Control16a, 50);
  Control16a: |
    if (is_success(roll_vs_skill(dude_obj, 12, 0))) then begin
      call Control17;
    end
    else begin
      call Control22;
    end
  Control17: |
    gsay_reply(368, 176);
    giq_option(6, 368, 177, Control18, 50);
    giq_option(6, 368, 178, Control19, 50);
  Control18: |
    gsay_reply(368, 179);
    giq_option(6, 368, 180, Control13, 50);
    giq_option(6, 368, 181, Controlend, 50);
  Control19: |
    gsay_reply(368, 182);
    giq_option(6, 368, 183, Control13, 50);
    giq_option(6, 368, 184, Controlend, 50);
    giq_option(6, 368, 185, Control20, 50);
  Control20: |
    gsay_reply(368, 186);
    giq_option(6, 368, 187, Control21, 50);
  Control21: |
    set_local_var(0, 1);
    gsay_message(368, 188, 50);
  Control22: 'gsay_message(368, 189, 50);

    '
  Control23: |
    gsay_reply(368, 190);
    giq_option(6, 368, 191, Control24, 50);
    giq_option(6, 368, 192, Control25, 50);
  Control24: |
    set_local_var(0, 1);
    gsay_message(368, 193, 50);
  Control25: 'gsay_message(368, 194, 50);

    '
  Controlend: "[]"
robot:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 55);
      critter_add_trait(self_obj, 1, 5, 71);
    end
    else begin
      if (script_action == 11) then begin
        call do_dialogue;
      end
      else begin
        if (script_action == 4) then begin
          HOSTILE := 1;
        end
      end
    end
    if (script_action == 12) then begin
      if (HOSTILE) then begin
        HOSTILE := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        DISGUISED := 0;
        if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
          if (metarule(16, 0) > 1) then begin
            DISGUISED := 0;
          end
          else begin
            DISGUISED := 1;
          end
        end
        if ((DISGUISED == 0) and (again == 0)) then begin
          if (tile_distance_objs(self_obj, dude_obj) < 6) then begin
            again := 1;
            dialogue_system_enter;
          end
        end
      end
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
      end
      else begin
        if (script_action == 18) then begin
          if (source_obj == dude_obj) then begin
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
              set_global_var(156, 1);
              set_global_var(157, 0);
            end
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
              set_global_var(157, 1);
              set_global_var(156, 0);
            end
            set_global_var(160, global_var(160) + 1);
            if ((global_var(160) % 6) == 0) then begin
              set_global_var(155, global_var(155) + 1);
            end
          end
        end
      end
    end
  do_dialogue: |
    set_local_var(3, 1);
    call get_reaction;
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      if (metarule(16, 0) > 1) then begin
        DISGUISED := 0;
      end
      else begin
        DISGUISED := 1;
      end
    end
    if (DISGUISED) then begin
      if (local_var(1) > 1) then begin
        call robot00;
      end
      else begin
        call robot02;
      end
    end
    else begin
      call robot01;
    end
  robot00: 'float_msg(self_obj, message_str(530, 100), 2);

    '
  robot01: |
    rndx := random(1, 4);
    if (rndx == 1) then begin
      float_msg(self_obj, message_str(530, 101), 2);
    end
    else begin
      if (rndx == 2) then begin
        float_msg(self_obj, message_str(530, 102), 2);
      end
      else begin
        if (rndx == 3) then begin
          float_msg(self_obj, message_str(530, 103), 2);
        end
        else begin
          if (rndx == 4) then begin
            float_msg(self_obj, message_str(530, 104), 2);
          end
        end
      end
    end
    call robotcbt;
  robot02: |
    float_msg(self_obj, message_str(530, 105), 2);
    call robotcbt;
  robotend: "[]"
  robotcbt: 'HOSTILE := 1;

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
romero:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(285, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(285, 103));
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(253) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
    end
  pickup_p_proc: 'set_global_var(253, 1);

    '
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(253, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  talk_p_proc: |
    if (get_critter_stat(dude_obj, 4) < 4) then begin
      display_msg(message_str(766, 175));
    end
    else begin
      start_gdialog(285, self_obj, 4, -1, -1);
      gsay_start;
      set_local_var(0, 1);
      if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
        call Romero06;
      end
      else begin
        if ((global_var(127) == 2) or (global_var(127) == 3)) then begin
          call Romero13;
        end
        else begin
          if (global_var(637) == 1) then begin
            call Romero14;
          end
          else begin
            call Romero00;
          end
        end
      end
      gsay_end;
      end_dialogue;
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      name := message_str(285, 100);
      critter_add_trait(self_obj, 1, 6, 47);
      critter_add_trait(self_obj, 1, 5, 27);
      initialized := 1;
    end
    if (global_var(127) == 3) then begin
      set_obj_visibility(self_obj, 1);
    end
  Romero00: |
    gsay_reply(285, 111);
    giq_option(4, 285, 112, Romero01, 50);
    if (global_var(127) == 0) then begin
      giq_option(4, 285, 114, Romero07, 50);
    end
    else begin
      if (global_var(127) == 1) then begin
        gsay_reply(285, 150);
        giq_option(4, 285, 151, kulon, 50);
      end
    end
    giq_option(4, 285, 115, RomeroEnd, 50);
  Romero01: |
    gsay_reply(285, 116);
    giq_option(4, 285, 117, Romero02, 50);
    giq_option(4, 285, 118, Romero03, 50);
    giq_option(4, 285, 119, Romero03, 50);
    giq_option(4, 285, 120, RomeroCombat, 50);
  Romero02: 'gsay_message(285, 121, 50);

    '
  Romero03: |
    gsay_reply(285, 122);
    giq_option(4, 285, 123, Romero04, 50);
    giq_option(4, 285, 124, RomeroCombat, 50);
    giq_option(4, 285, 125, RomeroEnd, 50);
  Romero04: |
    gsay_reply(285, 126);
    giq_option(4, 285, 127, Romero05, 50);
    giq_option(4, 285, 128, RomeroEnd, 50);
  Romero05: 'gsay_message(285, 129, 50);

    '
  Romero06: 'gsay_message(285, 130, 50);

    '
  Romero07: |
    gsay_reply(285, 131);
    giq_option(4, 285, 133, Romero09, 50);
    giq_option(4, 285, 134, Romero11, 50);
  Romero08: |
    gsay_message(285, 135, 50);
    call GiveLocket;
  Romero09: |
    gsay_reply(285, 136);
    giq_option(4, 285, 138, Romero12, 50);
    giq_option(4, 285, 139, Romero11, 50);
  Romero11: 'gsay_message(285, 143, 50);

    '
  Romero12: |
    gsay_reply(285, 144);
    giq_option(4, 285, 146, Romero08, 50);
    giq_option(4, 285, 145, Romero11, 50);
  Romero13: |
    gsay_message(285, 147, 50);
    set_global_var(127, 3);
  Romero14: 'gsay_message(285, 153, 50);

    '
  RomeroCombat: 'set_global_var(253, 1);

    '
  RomeroEnd: "[]"
  GiveLocket: |
    variable LVar0 := 0;
    set_global_var(127, 1);
    LVar0 := create_object_sid(99, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
  kulon: 'gsay_message(285, 152, 50);

    '
roomgrd:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 64);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    Pick := random(1, 6);
    if (Pick == 1) then begin
      message := message_str(619, 101);
    end
    else begin
      if (Pick == 2) then begin
        message := message_str(619, 102);
      end
      else begin
        if (Pick == 3) then begin
          message := message_str(619, 103);
        end
        else begin
          if (Pick == 4) then begin
            message := message_str(619, 104);
          end
          else begin
            if (Pick == 5) then begin
              message := message_str(619, 105);
            end
            else begin
              if (Pick == 6) then begin
                if (get_critter_stat(dude_obj, 34) == 0) then begin
                  message := message_str(619, 106);
                end
                else begin
                  message := message_str(619, 107);
                end
              end
            end
          end
        end
      end
    end
    float_msg(self_obj, message, 0);
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(619, 100));
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
rozbed:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(118, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(118, 102));
rubchip:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (local_var(0) < 1) then begin
        set_local_var(0, 1);
        display_msg(message_str(152, 101));
        display_msg(message_str(152, 100));
        play_sfx("IISXXXX1");
        float_msg(dude_obj, message_str(152, 104), 3);
        give_exp_points(500);
        display_msg(message_str(152, 102) + 500 + message_str(152, 103));
      end
    end
rubcore:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
        if (is_success(do_check(dude_obj, 4, 0))) then begin
          display_msg(message_str(153, 100));
        end
      end
    end
rufus:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(600, 100));
  critter_p_proc: |
    if (global_var(248) == 1) then begin
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(248, 1);
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(248, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 37);
      critter_add_trait(self_obj, 1, 5, 4);
    end
  talk_p_proc: 'float_msg(self_obj, message_str(600, 100 + random(1, 7)), 0);

    '
rutger:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(401, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (get_critter_stat(dude_obj, 4) < 4) then begin
      float_msg(dude_obj, message_str(401, 314), 3);
      float_msg(self_obj, message_str(401, 315), 2);
    end
    else begin
      if ((global_var(18) == 1) and (global_var(17) != 1) and (local_var(8) == 0)) then begin
        set_local_var(8, 1);
        set_local_var(4, 1);
        start_gdialog(401, self_obj, 4, -1, -1);
        gsay_start;
        call Rutger55;
        gsay_end;
        end_dialogue;
      end
      else begin
        if ((global_var(18) != 1) and (global_var(17) == 1) and (local_var(8) == 0)) then begin
          set_local_var(8, 1);
          set_local_var(4, 1);
          start_gdialog(401, self_obj, 4, -1, -1);
          gsay_start;
          call Rutger58;
          gsay_end;
          end_dialogue;
        end
        else begin
          if ((map_var(40) == 1) or (map_var(35) == 1)) then begin
            set_local_var(4, 1);
            start_gdialog(401, self_obj, 4, -1, -1);
            gsay_start;
            call Rutger74;
            gsay_end;
            end_dialogue;
          end
          else begin
            if (local_var(4) == 0) then begin
              set_local_var(4, 1);
              start_gdialog(401, self_obj, 4, -1, -1);
              gsay_start;
              call Rutger00;
              gsay_end;
              end_dialogue;
            end
            else begin
              if (map_var(34) == 0) then begin
                if (local_var(1) >= 2) then begin
                  start_gdialog(401, self_obj, 4, -1, -1);
                  gsay_start;
                  call Rutger73;
                  gsay_end;
                  end_dialogue;
                end
                else begin
                  start_gdialog(401, self_obj, 4, -1, -1);
                  gsay_start;
                  call Rutger74;
                  gsay_end;
                  end_dialogue;
                end
              end
              else begin
                if ((map_var(34) == 1) and (map_var(41) == 0)) then begin
                  call Rutger21;
                end
                else begin
                  if (map_var(41) == 3) then begin
                    start_gdialog(401, self_obj, 4, -1, -1);
                    gsay_start;
                    call Rutger54;
                    gsay_end;
                    end_dialogue;
                  end
                  else begin
                    if (map_var(41) == 4) then begin
                      start_gdialog(401, self_obj, 4, -1, -1);
                      gsay_start;
                      call Rutger56;
                      gsay_end;
                      end_dialogue;
                    end
                    else begin
                      if (local_var(6) == 0) then begin
                        if (map_var(41) == 2) then begin
                          start_gdialog(401, self_obj, 4, -1, -1);
                          gsay_start;
                          call Rutger17;
                          gsay_end;
                          end_dialogue;
                        end
                        else begin
                          if (map_var(41) == 1) then begin
                            start_gdialog(401, self_obj, 4, -1, -1);
                            gsay_start;
                            call Rutger25;
                            gsay_end;
                            end_dialogue;
                          end
                          else begin
                            if (map_var(41) == 0) then begin
                              call Rutger21;
                            end
                          end
                        end
                      end
                      else begin
                        if ((local_var(6) == 1) and (map_var(41) == 1)) then begin
                          start_gdialog(401, self_obj, 4, -1, -1);
                          gsay_start;
                          call Rutger22;
                          gsay_end;
                          end_dialogue;
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 36);
      critter_add_trait(self_obj, 1, 5, 17);
    end
  Rutger00: |
    gsay_reply(401, 101);
    if (global_var(101) != 2) then begin
      giq_option(4, 401, 102, Rutger03, 50);
    end
    if (map_var(43) == 1) then begin
      giq_option(4, 401, 103, Rutger00a, 50);
    end
    else begin
      giq_option(4, 401, 104, Rutger00a, 50);
    end
    giq_option(4, 401, 105, Rutger07, 50);
    giq_option(4, 401, 106, RutgerEnd, 50);
    giq_option(-3, 401, 107, Rutger00b, 50);
  Rutger00a: |
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      call Rutger10;
    end
    else begin
      if (global_var(158) > 2) then begin
        call Rutger11;
      end
      else begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          call Rutger15;
        end
        else begin
          if ((map_var(35) == 1) or (map_var(40) == 1)) then begin
            call Rutger75;
          end
          else begin
            call Rutger16;
          end
        end
      end
    end
  Rutger00b: |
    if (get_critter_stat(dude_obj, 0) <= 6) then begin
      call Rutger01;
    end
    else begin
      call Rutger02;
    end
  Rutger01: 'gsay_message(401, 108, 51);

    '
  Rutger02: 'gsay_message(401, 109, 50);

    '
  Rutger03: |
    gsay_reply(401, 110);
    if (global_var(71) > 0) then begin
      giq_option(4, 401, 111, Rutger04, 50);
    end
    else begin
      giq_option(4, 401, 112, Rutger04, 50);
    end
    giq_option(4, 401, 113, RutgerEnd, 50);
  Rutger04: |
    gsay_reply(401, 114);
    giq_option(4, 401, 115, Rutger05, 50);
    if (map_var(43) == 1) then begin
      giq_option(4, 401, 116, Rutger00a, 50);
    end
    else begin
      giq_option(4, 401, 117, Rutger00a, 50);
    end
    giq_option(4, 401, 118, RutgerEnd, 50);
  Rutger05: |
    gsay_reply(401, 119);
    giq_option(4, 401, 120, Rutger06, 50);
    giq_option(4, 401, 121, RutgerEnd, 50);
  Rutger06: |
    gsay_reply(401, 122);
    giq_option(4, 401, 123, Rutger07, 50);
    giq_option(4, 401, 124, RutgerEnd, 50);
  Rutger07: |
    if (local_var(5) == 0) then begin
      set_local_var(5, 1);
      gsay_reply(401, 125);
    end
    else begin
      gsay_reply(401, 126);
    end
    giq_option(4, 401, 127, Rutger08, 50);
    giq_option(4, 401, 128, RutgerEnd, 50);
    if (map_var(43) == 1) then begin
      giq_option(4, 401, 129, Rutger00a, 50);
    end
    else begin
      giq_option(4, 401, 130, Rutger00a, 50);
    end
  Rutger08: |
    gsay_reply(401, 131);
    giq_option(4, 401, 132, Rutger09, 50);
    giq_option(4, 401, 133, RutgerEnd, 50);
  Rutger09: |
    gsay_reply(401, 134);
    giq_option(4, 401, 135, RutgerEndBad, 50);
    giq_option(4, 401, 136, RutgerEnd, 50);
    if (map_var(43) == 1) then begin
      giq_option(4, 401, 129, Rutger00a, 50);
    end
    else begin
      giq_option(4, 401, 130, Rutger00a, 50);
    end
  Rutger10: |
    set_map_var(34, 1);
    gsay_message(401, 139, 50);
  Rutger11: |
    gsay_reply(401, 140);
    giq_option(4, 401, 141, Rutger11a, 50);
    giq_option(4, 401, 142, Rutger14, 50);
  Rutger11a: |
    if (is_success(do_check(dude_obj, 3, -1))) then begin
      call Rutger12;
    end
    else begin
      call Rutger13;
    end
  Rutger12: |
    set_map_var(34, 1);
    gsay_message(401, 143, 50);
  Rutger13: |
    set_map_var(34, 1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(401, 144, 51);
    end
    else begin
      gsay_message(401, 145, 51);
    end
  Rutger14: |
    set_map_var(34, 1);
    gsay_message(401, 146, 50);
  Rutger15: |
    set_map_var(34, 1);
    gsay_message(401, 147, 50);
  Rutger16: |
    set_map_var(34, 1);
    gsay_message(401, 148, 50);
  Rutger17: |
    gsay_reply(401, 149);
    giq_option(4, 401, 150, RutgerEndBad, 50);
    giq_option(4, 401, 151, Rutger17a, 50);
    giq_option(4, 401, 152, RutgerEnd, 50);
    giq_option(-3, 401, 153, Rutger18, 50);
  Rutger17a: |
    if (is_success(do_check(dude_obj, 3, 1))) then begin
      call Rutger19;
    end
    else begin
      call Rutger20;
    end
  Rutger18: 'gsay_message(401, 154, 51);

    '
  Rutger19: |
    set_map_var(41, 1);
    set_global_var(106, 1);
    set_map_var(10, 1);
    set_map_var(56, 1);
    gsay_message(401, 155, 50);
    call Rutger25;
  Rutger20: |
    set_map_var(35, 1);
    set_map_var(40, 1);
    set_map_var(10, 0);
    call BottomReact;
    gsay_message(401, 156, 51);
  Rutger21: 'float_msg(self_obj, message_str(401, 157), 2);

    '
  Rutger22: |
    gsay_reply(401, 159);
    if ((global_var(78) == 2) or (obj_is_carrying_obj_pid(dude_obj, 196) >= 1)) then begin
      giq_option(4, 401, 312, Rutger76, 50);
    end
    else begin
      giq_option(4, 401, 160, Rutger23, 50);
    end
    giq_option(4, 401, 161, Rutger26, 50);
    if (map_var(35) == 0) then begin
      giq_option(4, 401, 162, Rutger22a, 50);
    end
    giq_option(4, 401, 163, RutgerEnd, 50);
    giq_option(-3, 401, 164, Rutger24, 50);
  Rutger22a: |
    if ((map_var(41) != 3) and (map_var(41) != 4)) then begin
      call Rutger63;
    end
    else begin
      if (map_var(36) == 1) then begin
        call Rutger71;
      end
    end
  Rutger23: 'gsay_message(401, 165, 50);

    '
  Rutger24: 'gsay_message(401, 166, 51);

    '
  Rutger25: |
    set_local_var(6, 1);
    set_global_var(226, 1);
    set_map_var(33, 1);
    gsay_reply(401, 167);
    call Rutger29;
  Rutger26: |
    gsay_message(401, 168, 50);
    call Rutger25;
  Rutger27: |
    gsay_reply(401, 169);
    giq_option(4, 401, 170, Rutger28, 50);
    giq_option(4, 401, 171, Rutger30, 50);
  Rutger28: |
    gsay_reply(401, 172);
    call Rutger29;
  Rutger29: |
    if (global_var(108) != 2) then begin
      giq_option(4, 401, 173, Rutger29a, 50);
    end
    else begin
      giq_option(4, 401, 174, Rutger29b, 50);
    end
    if (map_var(8) == 1) then begin
      giq_option(4, 401, 175, Rutger38, 50);
    end
    giq_option(4, 401, 176, Rutger37, 50);
    giq_option(4, 401, 177, RutgerEnd, 50);
  Rutger29a: |
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 3) then begin
      call Rutger27;
    end
    else begin
      call Rutger31;
    end
  Rutger29b: |
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 3) then begin
      call Rutger32;
    end
    else begin
      call Rutger33;
    end
  Rutger30: |
    gsay_reply(401, 178);
    call Rutger29;
  Rutger31: |
    gsay_reply(401, 179);
    call Rutger29;
  Rutger32: |
    gsay_reply(401, 180);
    call Rutger29;
  Rutger33: |
    gsay_reply(401, 181);
    giq_option(4, 401, 182, Rutger34, 50);
    giq_option(4, 401, 183, Rutger35, 50);
    giq_option(4, 401, 184, Rutger36, 50);
  Rutger34: |
    gsay_reply(401, 185);
    call Rutger29;
  Rutger35: |
    gsay_reply(401, 186);
    call Rutger29;
  Rutger36: |
    gsay_reply(401, 187);
    call Rutger29;
  Rutger37: |
    set_map_var(10, 1);
    gsay_reply(401, 188);
    call Rutger29;
  Rutger38: |
    gsay_reply(401, 189);
    call Rutger29;
  Rutger39a: |
    if (map_var(42) == 16777267) then begin
      call Rutger49;
    end
    else begin
      if (map_var(42) == 1) then begin
        call Rutger50;
      end
      else begin
        if (map_var(42) == 2) then begin
          call Rutger51;
        end
        else begin
          call Rutger40;
        end
      end
    end
  Rutger40: |
    gsay_reply(401, 195);
    giq_option(4, 401, 196, Rutger40a, 50);
    giq_option(4, 401, 197, Rutger47, 50);
    giq_option(4, 401, 198, Rutger40b, 50);
    giq_option(4, 401, 199, Rutger41, 50);
  Rutger40a: |
    if (is_success(do_check(dude_obj, 3, 1))) then begin
      call Rutger42;
    end
    else begin
      call Rutger44;
    end
  Rutger40b: |
    if (is_success(do_check(dude_obj, 3, -2))) then begin
      call Rutger45;
    end
    else begin
      call Rutger46;
    end
  Rutger41: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(401, 200, 51);
    end
    else begin
      gsay_message(401, 201, 51);
    end
  Rutger42: |
    gsay_reply(401, 202);
    giq_option(4, 401, 203, Rutger43, 50);
    giq_option(4, 401, 204, Rutger47, 50);
    giq_option(4, 401, 205, RutgerEnd, 50);
  Rutger43: 'gsay_message(401, 206, 50);

    '
  Rutger44: 'gsay_message(401, 207, 51);

    '
  Rutger45: |
    gsay_reply(401, 208);
    giq_option(4, 401, 209, Rutger47, 50);
    giq_option(4, 401, 210, Rutger44, 50);
  Rutger46: 'gsay_message(401, 211, 51);

    '
  Rutger47: |
    gsay_reply(401, 212);
    if (obj_is_carrying_obj_pid(dude_obj, 196) >= 1) then begin
      if (global_var(100) == 2) then begin
        giq_option(4, 401, 213, Rutger48, 50);
      end
      else begin
        giq_option(4, 401, 214, Rutger48, 50);
      end
    end
    else begin
      giq_option(4, 401, 215, RutgerEnd, 50);
    end
    giq_option(4, 401, 216, RutgerEnd, 50);
    giq_option(4, 401, 217, RutgerEnd, 50);
  Rutger48: |
    variable LVar0 := 0;
    call TopReact;
    LVar0 := item_caps_adjust(dude_obj, 800);
    set_map_var(42, 2);
    set_map_var(36, 1);
    set_map_var(35, 0);
    set_map_var(40, 0);
    set_map_var(10, 1);
    set_map_var(41, 4);
    give_exp_points(1000);
    display_msg(message_str(766, 103) + 1000 + message_str(766, 104));
    set_global_var(155, global_var(155) + 5);
    gsay_message(401, 218, 49);
  Rutger49: |
    gsay_reply(401, 219);
    giq_option(4, 401, 220, Rutger40a, 50);
    giq_option(4, 401, 221, Rutger47, 50);
    giq_option(4, 401, 222, Rutger40b, 50);
    giq_option(4, 401, 223, Rutger41, 50);
  Rutger50: |
    gsay_reply(401, 224);
    giq_option(4, 401, 225, Rutger40a, 50);
    giq_option(4, 401, 226, Rutger47, 50);
    giq_option(4, 401, 227, Rutger40b, 50);
    giq_option(4, 401, 228, Rutger41, 50);
  Rutger51: |
    gsay_reply(401, 229);
    if (obj_is_carrying_obj_pid(dude_obj, 196) >= 1) then begin
      if (global_var(100) == 2) then begin
        giq_option(4, 401, 230, Rutger48, 50);
      end
      else begin
        giq_option(4, 401, 231, Rutger48, 50);
      end
    end
    else begin
      giq_option(4, 401, 232, RutgerEnd, 50);
    end
    giq_option(4, 401, 233, RutgerEnd, 50);
  Rutger54: |
    gsay_reply(401, 240);
    giq_option(4, 401, 241, Rutger39a, 50);
    giq_option(4, 401, 242, RutgerEnd, 50);
  Rutger55: |
    gsay_reply(401, 243);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 401, 244, Rutger59, 50);
    end
    else begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        giq_option(4, 401, 245, Rutger59, 50);
      end
      else begin
        giq_option(4, 401, 246, Rutger59, 50);
      end
    end
    giq_option(4, 401, 247, Rutger55a, 50);
    giq_option(4, 401, 248, RutgerEnd, 50);
    giq_option(-3, 401, 249, RutgerEnd, 50);
  Rutger55a: |
    if ((map_var(40) == 1) or (map_var(35) == 1)) then begin
      call Rutger67;
    end
    else begin
      if (global_var(206) == 5) then begin
        call RutgerLost;
      end
      else begin
        if (global_var(206) == 3) then begin
          call RutgerAbandoned;
        end
        else begin
          if (map_var(36) == 1) then begin
            call Rutger71;
          end
          else begin
            call Rutger62;
          end
        end
      end
    end
  Rutger56: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(401, 250);
    end
    else begin
      if (get_critter_stat(dude_obj, 3) >= 7) then begin
        gsay_reply(401, 252);
      end
      else begin
        gsay_reply(401, 253);
      end
    end
    giq_option(4, 401, 254, Rutger55a, 50);
    giq_option(4, 401, 255, Rutger56a, 50);
    giq_option(-3, 401, 256, Rutger24, 50);
  Rutger56a: |
    if ((global_var(18) == 1) or (global_var(17) == 1)) then begin
      call Rutger57;
    end
    else begin
      call Rutger61;
    end
  Rutger57: 'gsay_message(401, 257, 49);

    '
  Rutger58: |
    gsay_reply(401, 258);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 401, 259, Rutger60, 50);
    end
    else begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        giq_option(4, 401, 260, Rutger60, 50);
        giq_option(4, 401, 261, Rutger60, 50);
      end
      else begin
        giq_option(4, 401, 262, Rutger61, 50);
      end
    end
    giq_option(4, 401, 263, Rutger55a, 50);
    giq_option(4, 401, 248, RutgerEnd, 50);
    giq_option(-3, 401, 264, RutgerEnd, 50);
  Rutger59: 'gsay_message(401, 265, 50);

    '
  Rutger60: 'gsay_message(401, 266, 50);

    '
  Rutger61: 'gsay_message(401, 267, 50);

    '
  Rutger62: |
    gsay_reply(401, 268);
    giq_option(4, 401, 269, Rutger65, 50);
    giq_option(4, 401, 270, Rutger64, 50);
  Rutger63: |
    gsay_reply(401, 271);
    giq_option(4, 401, 272, Rutger68, 50);
    giq_option(4, 401, 273, Rutger70, 50);
    giq_option(4, 401, 274, RutgerEnd, 50);
  Rutger64: 'gsay_message(401, 275, 50);

    '
  Rutger65: |
    set_map_var(36, 1);
    gsay_message(401, 276, 50);
  Rutger67: |
    if (local_var(7) == 0) then begin
      set_local_var(7, 1);
      gsay_message(401, 279, 50);
    end
    gsay_message(401, 280, 50);
  Rutger68: |
    gsay_reply(401, 281);
    giq_option(4, 401, 282, Rutger72, 50);
    giq_option(4, 401, 283, Rutger69, 50);
    giq_option(4, 401, 284, Rutger70, 50);
  Rutger69: 'gsay_message(401, 285, 50);

    '
  Rutger70: |
    set_map_var(36, 1);
    gsay_message(401, 286, 50);
  Rutger71: |
    set_map_var(36, 1);
    gsay_message(401, 287, 50);
  Rutger72: |
    gsay_reply(401, 289);
    giq_option(4, 401, 290, RutgerEnd, 50);
    giq_option(4, 401, 291, Rutger70, 50);
  Rutger73: |
    gsay_reply(401, 292);
    if (global_var(101) != 2) then begin
      giq_option(4, 401, 294, Rutger03, 50);
    end
    if (map_var(43) == 1) then begin
      giq_option(4, 401, 295, Rutger00a, 50);
    end
    else begin
      giq_option(4, 401, 296, Rutger00a, 50);
    end
    giq_option(4, 401, 297, Rutger07, 50);
    giq_option(4, 401, 298, RutgerEnd, 50);
    giq_option(-3, 401, 299, Rutger00b, 50);
  Rutger74: |
    gsay_reply(401, random(300, 303));
    if (global_var(101) != 2) then begin
      giq_option(4, 401, 305, Rutger03, 50);
    end
    if (map_var(43) == 1) then begin
      giq_option(4, 401, 306, Rutger00a, 50);
    end
    else begin
      giq_option(4, 401, 307, Rutger00a, 50);
    end
    giq_option(4, 401, 308, Rutger07, 50);
    giq_option(4, 401, 309, RutgerEnd, 50);
    giq_option(-3, 401, 310, Rutger00b, 50);
  Rutger75: 'gsay_message(401, 311, 50);

    '
  Rutger76: 'gsay_message(401, 313, 50);

    '
  RutgerEnd: "[]"
  RutgerEndBad: 'call DownReactLevel;

    '
  RutgerAbandoned: 'gsay_message(401, 277, 50);

    '
  RutgerLost: |
    set_map_var(35, 1);
    set_map_var(10, 0);
    set_global_var(206, 6);
    gsay_message(401, 279, 50);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
sally:
  start: |
    variable LVar0 := 0;
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 79);
      set_local_var(1, 0);
      init_teams := 1;
    end
    if ((script_action == 11) and (global_var(35) < 1)) then begin
      if (global_var(306) == 0) then begin
        call do_dialogue;
      end
      else begin
        display_msg(message_str(90, 102));
      end
    end
    else begin
      if (script_action == 21) then begin
        script_overrides;
        display_msg(message_str(90, 100));
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            call Critter_Action;
          end
          else begin
            if (script_action == 18) then begin
              set_global_var(35, global_var(35) + 1);
              if (global_var(35) > global_var(551)) then begin
                set_global_var(155, global_var(155) + 3);
                set_global_var(29, 2);
                set_global_var(225, game_time / (10 * 60 * 60 * 24));
              end
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(160, global_var(160) + 1);
                if ((global_var(160) % 6) == 0) then begin
                  set_global_var(155, global_var(155) + 1);
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: 'float_msg(self_obj, message_str(90, 101), 3);

    '
  Critter_Action: |
    if ((global_var(35) > 0) and obj_can_see_obj(self_obj, dude_obj) and (global_var(306) < 1)) then begin
      Hostile := 1;
    end
    if (Hostile > 0) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if ((global_var(306) == 1) and (tile_num(self_obj) != 15507)) then begin
        animate_move_obj_to_tile(self_obj, 15507, 0);
      end
      else begin
        if ((global_var(306) == 1) and (tile_num(self_obj) == 15507)) then begin
          set_global_var(306, 2);
        end
        else begin
          if ((global_var(306) == 2) and (tile_num(self_obj) != 12536)) then begin
            animate_move_obj_to_tile(self_obj, 12536, 0);
          end
          else begin
            if ((tile_num(self_obj) == 12536) and (global_var(306) == 2)) then begin
              set_obj_visibility(self_obj, 1);
            end
          end
        end
      end
    end
sammael:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (tile_distance_objs(dude_obj, self_obj) > get_critter_stat(dude_obj, 1)) then begin
        set_obj_visibility(self_obj, 1);
      end
      else begin
        set_obj_visibility(self_obj, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(251, 1);
      critter_add_trait(self_obj, 1, 6, 49);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(251, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
      critter_add_trait(self_obj, 1, 6, 49);
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(4)) then begin
      display_msg(message_str(254, 100));
    end
    else begin
      display_msg(message_str(254, 101));
    end
  pickup_p_proc: 'set_global_var(251, 1);

    '
  map_enter_p_proc: |
    if (not(initialized)) then begin
      if ((global_var(613) == 9103) or (global_var(613) == 9102)) then begin
        critter_add_trait(self_obj, 1, 6, 0);
      end
      else begin
        critter_add_trait(self_obj, 1, 6, 49);
      end
      critter_add_trait(self_obj, 1, 5, 29);
      initialized := 1;
    end
  talk_p_proc: |
    start_gdialog(254, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4)) then begin
      call Sammael14;
    end
    else begin
      call Sammael01;
    end
    gsay_end;
    end_dialogue;
  Sammael01: |
    gsay_reply(254, 102);
    giq_option(4, 254, message_str(254, 103) + proto_data(obj_pid(dude_obj), 1) + message_str(254, 104), Sammael02, 50);
    giq_option(4, 254, 105, Sammael03, 50);
    giq_option(-3, 254, 106, Sammael15, 50);
  Sammael02: |
    set_local_var(4, 1);
    gsay_reply(254, 107);
    giq_option(4, 254, 108, Sammael04, 50);
    giq_option(4, 254, 109, Sammael05, 50);
  Sammael03: 'gsay_message(254, 110, 50);

    '
  Sammael04: |
    gsay_reply(254, 111);
    giq_option(4, 254, 112, Sammael06, 50);
    giq_option(4, 254, 113, Sammael07, 50);
    giq_option(6, 254, 114, Sammael08, 50);
    giq_option(0, 254, 115, Sammael05, 50);
  Sammael05: 'gsay_message(254, 116, 50);

    '
  Sammael06: |
    gsay_reply(254, 117);
    giq_option(4, 254, 118, Sammael07, 50);
    giq_option(6, 254, 119, Sammael08, 50);
    giq_option(4, 254, 120, Sammael05, 50);
  Sammael07: 'gsay_message(254, 121, 50);

    '
  Sammael08: |
    gsay_reply(254, 122);
    giq_option(4, 254, 123, Sammael09, 50);
    giq_option(4, 254, 124, Sammael10, 50);
    giq_option(4, 254, 125, Sammael11, 50);
    giq_option(4, 254, 126, Sammael12, 50);
    giq_option(4, 254, 127, Sammael13, 50);
    giq_option(4, 254, 128, Sammael05, 50);
  Sammael09: |
    gsay_message(254, 129, 50);
    call Sammael08;
  Sammael10: |
    gsay_message(254, 130, 50);
    gsay_message(254, 131, 50);
    call Sammael08;
  Sammael11: |
    gsay_message(254, 132, 50);
    call Sammael08;
  Sammael12: |
    gsay_message(254, 133, 50);
    call Sammael08;
  Sammael13: |
    gsay_message(254, 134, 50);
    gsay_message(254, 135, 50);
    call Sammael08;
  Sammael14: |
    gsay_reply(254, 136);
    giq_option(4, 254, 137, Sammael04, 50);
    giq_option(4, 254, 138, Sammael05, 50);
  Sammael15: 'gsay_message(254, 139, 50);

    '
sammy2:
  start: |
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if (script_action == 3) then begin
        script_overrides;
        display_msg(message_str(14, 100));
      end
      else begin
        if (script_action == 18) then begin
          set_global_var(6, 1);
        end
      end
    end
  do_dialogue: |
    start_gdialog(-1, 14, self_obj, -1, -1);
    sayMessage(0, message_str(14, 101));
    end_dialogue;
sarah:
  start: "[]"
  critter_p_proc: |
    if (map_var(8) == 3) then begin
      if (local_var(4) == 0) then begin
        if (tile_distance_objs(self_obj, dude_obj) < 12) then begin
          if (obj_can_see_obj(self_obj, dude_obj)) then begin
            dialogue_system_enter;
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  talk_p_proc: |
    if (local_var(4)) then begin
      if (map_var(8) == 3) then begin
        float_msg(self_obj, message_str(662, 105), 0);
      end
      else begin
        if ((get_critter_stat(dude_obj, 4) < 4) and (get_critter_stat(dude_obj, 34) == 0)) then begin
          float_msg(self_obj, message_str(662, 117), 0);
        end
        else begin
          if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
            call Sarah10;
          end
          else begin
            float_msg(self_obj, message_str(662, 118), 0);
          end
        end
      end
    end
    else begin
      set_local_var(4, 1);
      start_gdialog(662, self_obj, 4, -1, -1);
      gsay_start;
      if (map_var(8) == 3) then begin
        call Sarah00;
      end
      else begin
        call Sarah05;
      end
      gsay_end;
      end_dialogue;
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 67);
      initialized := 1;
    end
  Sarah00: |
    gsay_reply(662, 100);
    giq_option(-3, 662, 101, Sarah01, 51);
    giq_option(4, 662, 102, SarahEnd, 51);
    giq_option(5, 662, 103, Sarah01, 51);
    giq_option(7, 662, 104, sarah02, 51);
  Sarah01: 'gsay_message(662, 105, 51);

    '
  sarah02: |
    gsay_reply(662, 106);
    giq_option(7, 662, 107, Sarah03, 51);
    giq_option(7, 662, 108, Sarah04, 51);
  Sarah03: |
    gsay_reply(662, 109);
    giq_option(7, 662, 110, Sarah01, 51);
    giq_option(7, 662, 111, Sarah04, 51);
  Sarah04: 'gsay_message(662, 112, 51);

    '
  Sarah05: |
    gsay_reply(662, 113);
    giq_option(-3, 662, 114, Sarah06, 50);
    giq_option(4, 662, 115, Sarah07, 50);
    giq_option(6, 662, 116, Sarah09, 50);
  Sarah06: 'gsay_message(662, 117, 50);

    '
  Sarah07: |
    gsay_reply(662, 118);
    giq_option(4, 662, 119, SarahEnd, 50);
    giq_option(6, 662, 120, Sarah08, 50);
  Sarah08: |
    gsay_reply(662, 121);
    giq_option(4, 662, 119, SarahEnd, 51);
  Sarah09: 'gsay_message(662, 122, 50);

    '
  Sarah10: 'float_msg(self_obj, message_str(662, 123), 0);

    '
  SarahEnd: "[]"
saul:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  combat_p_proc: |
    if ((fixed_param == 4) and obj_can_see_obj(self_obj, dude_obj)) then begin
      GVar7 := GVar7 + 1;
    end
    if (GVar7 > 3) then begin
      if (global_var(247) == 0) then begin
        set_global_var(247, 1);
        set_global_var(155, global_var(155) - 5);
      end
    end
  critter_p_proc: |
    if (GVar5) then begin
      GVar5 := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (cur_map_index == 11) then begin
        if (fight) then begin
          fight := 0;
          GVar10 := 0;
          GVar9 := 0;
          anim(self_obj, 1000, 1);
          if (obj_can_see_obj(dude_obj, self_obj)) then begin
            gfade_out(600);
            call create_challenger;
            gfade_in(600);
          end
          else begin
            call create_challenger;
          end
          add_timer_event(self_obj, game_ticks(1), 1);
        end
      end
      if (GVar8 == 0) then begin
        call sleeping;
      end
    end
    if (global_var(627) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  description_p_proc: |
    if (is_success(do_check(dude_obj, 1, has_trait(0, dude_obj, 0)))) then begin
      display_msg(message_str(528, 102));
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(627, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
    set_global_var(169, 3);
  look_at_p_proc: |
    script_overrides;
    if (not(global_var(169))) then begin
      display_msg(message_str(528, 101));
    end
    else begin
      display_msg(message_str(528, 100));
    end
  map_enter_p_proc: |
    variable LVar0 := 0;
    if (global_var(15) == 1) then begin
      LVar0 := create_object_sid(234, 0, 0, -1);
      add_obj_to_inven(self_obj, LVar0);
      kill_critter(self_obj, 48);
    end
    GVar8 := 0;
    GVar2 := 2000;
    GVar1 := 700;
    if (cur_map_index == 11) then begin
      GVar4 := 7000;
      if ((game_time / (10 * 60 * 60 * 24) % 3) == 0) then begin
        GVar3 := 15094;
      end
      else begin
        GVar3 := 16892;
      end
    end
    if (global_var(169) == 3) then begin
      destroy_object(self_obj);
    end
    move_to(self_obj, GVar3, 0);
    critter_add_trait(self_obj, 1, 6, 15);
  map_update_p_proc: |
    if (not(combat_is_initialized)) then begin
      if ((game_time / (10 * 60 * 60 * 24) % 3) == 0) then begin
        GVar3 := 15094;
      end
      else begin
        GVar3 := 16892;
      end
      move_to(self_obj, GVar3, 0);
      if (local_var(8) == 1) then begin
        set_local_var(8, 0);
        reg_anim_animate(self_obj, 0, 0);
      end
      call sleeping;
    end
  talk_p_proc: |
    call get_reaction;
    if (local_var(4)) then begin
      float_msg(self_obj, message_str(185, 166), 0);
    end
    else begin
      if (critter_state(self_obj) bwand 1) then begin
        display_msg(message_str(528, 115));
      end
      else begin
        if (global_var(247)) then begin
          float_msg(self_obj, message_str(669, 104), 2);
        end
        else begin
          if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
            call Saul06;
          end
          else begin
            start_gdialog(528, self_obj, 4, -1, -1);
            gsay_start;
            if (global_var(169)) then begin
              call Saul23;
            end
            else begin
              call Saul07;
            end
            gsay_end;
            end_dialogue;
          end
        end
      end
    end
    if (not(global_var(557) bwand 32) and (global_var(557) bwand 8) and (global_var(557) bwand 16)) then begin
      set_global_var(557, global_var(557) + 32);
      display_msg(message_str(342, 173));
      set_global_var(155, global_var(155) + 2);
      give_exp_points(250);
    end
  timed_event_p_proc: |
    if (challenger_ptr != 0) then begin
      if (fixed_param == 1) then begin
        if (obj_pid(challenger_ptr) == 16777227) then begin
          if (random(0, 4) == 0) then begin
            GVar11 := 1;
          end
          else begin
            GVar11 := 0;
          end
        end
        else begin
          if (random(0, 2)) then begin
            GVar11 := 1;
          end
          else begin
            GVar11 := 0;
          end
        end
        call SaulBoxing;
      end
      else begin
        if (fixed_param == 2) then begin
          Saul_wins := 1;
        end
        else begin
          if (fixed_param == 3) then begin
            Saul_loses := 1;
            set_local_var(8, 1);
          end
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  Saul06: 'float_msg(self_obj, message_str(528, 104), 2);

    '
  Saul07: |
    set_global_var(169, 1);
    if (local_var(1) == 1) then begin
      gsay_reply(528, 105);
    end
    else begin
      gsay_reply(528, 106);
    end
    giq_option(4, 528, 107, Saul08, 50);
    giq_option(4, 528, 108, Saul18a, 51);
    giq_option(4, 528, message_str(528, 109) + proto_data(obj_pid(dude_obj), 1) + message_str(528, 110), Saul09, 50);
  Saul08: |
    gsay_reply(528, 111);
    giq_option(4, 528, 112, Saul18a, 51);
    giq_option(4, 528, 113, Saul11, 50);
    giq_option(4, 528, 103, SaulEnd, 50);
  Saul09: |
    if (local_var(1) == 1) then begin
      gsay_reply(528, 128);
    end
    else begin
      gsay_reply(528, 129);
    end
    if (local_var(1) == 1) then begin
      giq_option(4, 528, 130, Saul10, 50);
      giq_option(4, 528, 188, SaulCombat, 51);
    end
    giq_option(4, 528, 131, Saul10, 50);
    if (local_var(1) == 3) then begin
      giq_option(4, 528, 135, Saul11, 50);
    end
    giq_option(4, 528, 132, SaulEnd, 50);
  Saul10: |
    if (local_var(1) == 1) then begin
      gsay_reply(528, 133);
    end
    else begin
      gsay_reply(528, 134);
    end
    giq_option(4, 528, 135, Saul11, 50);
    giq_option(4, 528, 136, Saul12, 49);
    giq_option(4, 528, 132, SaulEnd, 50);
  Saul11: |
    gsay_reply(528, 137);
    giq_option(4, 528, 136, Saul12, 49);
    if (not(local_var(5))) then begin
      giq_option(4, 528, 138, Saul13, 50);
    end
    if (not(local_var(6))) then begin
      giq_option(4, 528, 139, Saul14, 50);
    end
    call Goodbyes;
    giq_option(4, 528, GVar12, SaulEnd, 50);
  Saul12: |
    call UpReact;
    if (local_var(1) == 1) then begin
      gsay_reply(528, 140);
    end
    else begin
      gsay_reply(528, 141);
      giq_option(5, 528, 142, Saul15, 49);
    end
    giq_option(4, 528, 143, Saul13, 50);
    giq_option(4, 528, 144, Saul14, 50);
    call Goodbyes;
    giq_option(4, 528, GVar12, SaulEnd, 50);
  Saul13: |
    set_local_var(5, 1);
    gsay_reply(528, 145);
    giq_option(4, 528, 146, Saul19, 50);
    giq_option(4, 528, 147, Saul14, 50);
    call Goodbyes;
    giq_option(4, 528, GVar12, SaulEnd, 50);
  Saul14: |
    set_local_var(6, 1);
    gsay_reply(528, 148);
    if (not(local_var(5))) then begin
      giq_option(4, 528, 149, Saul13, 50);
    end
    call Goodbyes;
    giq_option(4, 528, GVar12, SaulEnd, 50);
  Saul15: |
    set_local_var(7, 1);
    gsay_reply(528, 150);
    giq_option(4, 528, 151, Saul17, 50);
    giq_option(4, 528, 152, Saul18, 50);
    if (get_critter_stat(dude_obj, 4) >= 6) then begin
      giq_option(6, 528, 153, Saul16, 49);
    end
    else begin
      call Goodbyes;
      giq_option(4, 528, GVar12, SaulEnd, 50);
    end
    giq_option(6, 528, 154, Saul24, 50);
  Saul16: |
    call UpReact;
    gsay_reply(528, 155);
    giq_option(4, 528, 156, Saul18, 50);
    call Goodbyes;
    giq_option(4, 528, GVar12, SaulEnd, 50);
  Saul17: |
    set_global_var(169, 2);
    gsay_reply(528, 157);
    giq_option(4, 528, 158, Saul18, 50);
    if ((global_var(557) bwand 1) or (global_var(557) bwand 4) and not(global_var(557) bwand 64)) then begin
      giq_option(5, 528, 159, Saul20, 50);
    end
    call Goodbyes;
    giq_option(4, 528, GVar12, SaulEnd, 50);
  Saul18: |
    if (local_var(1) < 2) then begin
      gsay_reply(528, 160);
    end
    else begin
      gsay_reply(528, 161);
    end
    if (not(local_var(5))) then begin
      giq_option(4, 528, 162, Saul13, 50);
    end
    if (not(local_var(6))) then begin
      giq_option(4, 528, 163, Saul14, 50);
    end
    giq_option(4, 528, 164, Saul18a, 51);
    giq_option(4, 528, 165, SaulEnd, 50);
  Saul18a: |
    set_local_var(1, 1);
    call LevelToReact;
    call Saul09;
  Saul19: |
    gsay_reply(528, 166);
    giq_option(4, 528, 168, Saul18, 50);
    if (get_critter_stat(dude_obj, 4) >= 6) then begin
      giq_option(6, 528, 167, UpReact, 49);
    end
    else begin
      call Goodbyes;
      giq_option(4, 528, 169, SaulEnd, 50);
    end
  Saul20: |
    set_global_var(169, 2);
    if (local_var(1) == 1) then begin
      gsay_reply(528, 169);
    end
    else begin
      if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
        gsay_reply(528, message_str(528, 170) + message_str(528, 171));
        if ((global_var(557) bwand 2) or (global_var(557) bwand 8)) then begin
          if (get_critter_stat(dude_obj, 4) >= 6) then begin
            giq_option(6, 528, 172, Saul21, 49);
          end
          else begin
            giq_option(4, 528, 173, Saul22, 50);
          end
        end
      end
      else begin
        gsay_reply(528, message_str(528, 170));
      end
    end
    giq_option(4, 528, 174, Saul18, 50);
    giq_option(4, 528, 175, SaulEnd, 50);
  Saul21: |
    call UpReact;
    if (not(global_var(557) bwand 16)) then begin
      set_global_var(557, global_var(557) + 16);
    end
    gsay_message(528, 176, 49);
  Saul22: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Saul21;
    end
    else begin
      gsay_reply(528, 177);
      giq_option(4, 528, 178, Saul18, 50);
      giq_option(4, 528, 179, SaulEnd, 50);
    end
  Saul23: |
    if (local_var(1) < 2) then begin
      gsay_reply(528, 180);
    end
    else begin
      gsay_reply(528, 181);
    end
    giq_option(4, 528, 182, Saul09, 51);
    if ((global_var(557) bwand 1) or (global_var(557) bwand 4) and ((global_var(557) bwand 2) or (global_var(557) bwand 8)) and not(global_var(557) bwand 16) and not(global_var(557) bwand 64)) then begin
      giq_option(4, 528, 183, Saul20, 50);
    end
    if (not(local_var(5))) then begin
      giq_option(4, 528, 184, Saul13, 50);
    end
    call Goodbyes;
    giq_option(4, 528, GVar12, SaulEnd, 50);
  Saul24: |
    gsay_reply(528, 185);
    giq_option(4, 528, 186, SaulEnd, 0);
    giq_option(4, 528, 187, Saul18, 0);
  SaulBoxing: |
    reg_anim_func(2, self_obj);
    reg_anim_func(2, challenger_ptr);
    if (GVar11 == 1) then begin
      reg_anim_func(1, 1);
      reg_anim_animate(self_obj, 16, -1);
      if (is_success(roll_vs_skill(self_obj, 3, 0))) then begin
        if (GVar9 >= (get_critter_stat(challenger_ptr, 2) * 2)) then begin
          reg_anim_animate(challenger_ptr, 20, 4);
          reg_anim_animate(challenger_ptr, 48, -1);
          add_timer_event(self_obj, game_ticks(2), 2);
        end
        else begin
          reg_anim_animate(challenger_ptr, 14, 4);
          GVar9 := GVar9 + 1;
          add_timer_event(self_obj, game_ticks(random(1, 2)), 1);
        end
      end
      else begin
        reg_anim_animate(challenger_ptr, 13, 4);
        add_timer_event(self_obj, game_ticks(random(1, 2)), 1);
      end
      reg_anim_func(3, 0);
    end
    else begin
      reg_anim_func(1, 1);
      reg_anim_animate(challenger_ptr, 16, -1);
      if (is_success(roll_vs_skill(challenger_ptr, 3, 0))) then begin
        if (GVar10 >= (get_critter_stat(self_obj, 2) * 2)) then begin
          animate_move_obj_to_tile(self_obj, 14295, 1);
          float_msg(self_obj, message_str(528, 175), 2);
          add_timer_event(self_obj, game_ticks(2), 3);
        end
        else begin
          reg_anim_animate(self_obj, 14, 4);
          GVar10 := GVar10 + 1;
          add_timer_event(self_obj, game_ticks(random(1, 2)), 1);
        end
      end
      else begin
        reg_anim_animate(self_obj, 13, 4);
        add_timer_event(self_obj, game_ticks(random(1, 2)), 1);
      end
      reg_anim_func(3, 0);
    end
  SaulCombat: 'GVar5 := 1;

    '
  SaulEnd: "[]"
  create_challenger: |
    challenger_ptr := random(0, 4);
    if (challenger_ptr == 4) then begin
      challenger_ptr := create_object_sid(16777226, 0, 0, 963);
    end
    else begin
      if (challenger_ptr == 3) then begin
        challenger_ptr := create_object_sid(16777227, 0, 0, 963);
      end
      else begin
        if (challenger_ptr == 2) then begin
          challenger_ptr := create_object_sid(16777238, 0, 0, 963);
        end
        else begin
          if (challenger_ptr == 1) then begin
            challenger_ptr := create_object_sid(16777218, 0, 0, 963);
          end
          else begin
            if (challenger_ptr == 0) then begin
              challenger_ptr := create_object_sid(16777243, 0, 0, 963);
            end
          end
        end
      end
    end
    critter_attempt_placement(challenger_ptr, tile_num_in_direction(tile_num(self_obj), 1, 1), 0);
    anim(challenger_ptr, 1000, 4);
  sleeping: |
    if (local_var(4) == 1) then begin
      if (not(GVar0) and (game_time_hour >= GVar1) and (game_time_hour < GVar2) or (GVar0 and ((game_time_hour >= GVar1) or (game_time_hour < GVar2)))) then begin
        if (((game_time_hour - GVar1) < 10) and ((game_time_hour - GVar1) > 0)) then begin
          if (tile_num(self_obj) != GVar3) then begin
            animate_move_obj_to_tile(self_obj, GVar3, 0);
          end
          else begin
            set_local_var(4, 0);
          end
        end
        else begin
          move_to(self_obj, GVar3, elevation(self_obj));
          if (tile_num(self_obj) == GVar3) then begin
            set_local_var(4, 0);
          end
        end
      end
    end
    else begin
      if (GVar0 and (game_time_hour >= GVar2) and (game_time_hour < GVar1) or (not(GVar0) and ((game_time_hour >= GVar2) or (game_time_hour < GVar1)))) then begin
        if (((game_time_hour - GVar2) < 10) and ((game_time_hour - GVar2) > 0)) then begin
          if (tile_num(self_obj) != GVar4) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(4, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != GVar4) then begin
            move_to(self_obj, GVar4, elevation(self_obj));
          end
          else begin
            set_local_var(4, 1);
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  Goodbyes: 'GVar12 := message_str(634, random(100, 105));

    '
sbokcase:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  pickup_p_proc: |
    if (not(is_success(roll_vs_skill(dude_obj, 10, 0))) and (global_var(246) != 1)) then begin
      script_overrides;
      set_map_var(2, 1);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(122, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(122, 101));
sciroom:
  start: |
    if (script_action == 2) then begin
      if (obj_type(source_obj) == dude_obj) then begin
        if (local_var(0) == 0) then begin
          set_local_var(0, 1);
          display_msg(message_str(303, 100));
        end
      end
    end
scribea:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 63);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  ScribeARandom: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (not(LVar0)) then begin
      LVar0 := random(1, 8);
    end
    if (LVar0 > 8) then begin
      LVar0 := 1;
    end
    LVar1 := message_str(198, 101);
    if (LVar0 == 2) then begin
      LVar1 := message_str(198, 102);
    end
    else begin
      if (LVar0 == 3) then begin
        LVar1 := message_str(198, 103);
      end
      else begin
        if (LVar0 == 4) then begin
          LVar1 := message_str(198, 104);
        end
        else begin
          if (LVar0 == 5) then begin
            LVar1 := message_str(198, 105);
          end
          else begin
            if (LVar0 == 6) then begin
              LVar1 := message_str(198, 106);
            end
            else begin
              if (LVar0 == 7) then begin
                LVar1 := message_str(198, 107);
              end
              else begin
                if (LVar0 == 8) then begin
                  LVar1 := message_str(198, 108);
                end
                else begin
                  LVar0 := 1;
                end
              end
            end
          end
        end
      end
    end
    LVar0 := LVar0 + 1;
    float_msg(self_obj, LVar1, 0);
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: 'call ScribeARandom;

    '
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(198, 100));
scribeb:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 63);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  ScribeBRandom: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (not(LVar0)) then begin
      LVar0 := random(1, 15);
    end
    if (LVar0 > 15) then begin
      LVar0 := 1;
    end
    LVar1 := message_str(290, 101);
    if (LVar0 == 2) then begin
      LVar1 := message_str(290, 102);
    end
    else begin
      if (LVar0 == 3) then begin
        LVar1 := message_str(290, 103);
      end
      else begin
        if (LVar0 == 4) then begin
          LVar1 := message_str(290, 104);
        end
        else begin
          if (LVar0 == 5) then begin
            LVar1 := message_str(290, 105);
          end
          else begin
            if (LVar0 == 6) then begin
              LVar1 := message_str(290, 106);
            end
            else begin
              if (LVar0 == 7) then begin
                LVar1 := message_str(290, 107);
              end
              else begin
                if (LVar0 == 8) then begin
                  LVar1 := message_str(290, 108);
                end
                else begin
                  if (LVar0 == 9) then begin
                    LVar1 := message_str(290, 109);
                  end
                  else begin
                    if (LVar0 == 10) then begin
                      LVar1 := message_str(290, 110);
                    end
                    else begin
                      if (LVar0 == 11) then begin
                        LVar1 := message_str(290, 111);
                      end
                      else begin
                        if (LVar0 == 12) then begin
                          LVar1 := message_str(290, 112);
                        end
                        else begin
                          if (LVar0 == 13) then begin
                            LVar1 := message_str(290, 113);
                          end
                          else begin
                            if (LVar0 == 14) then begin
                              LVar1 := message_str(290, 114);
                            end
                            else begin
                              if (LVar0 == 15) then begin
                                LVar1 := message_str(290, 115);
                              end
                              else begin
                                LVar0 := 1;
                              end
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    LVar0 := LVar0 + 1;
    float_msg(self_obj, LVar1, 0);
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: 'call ScribeBRandom;

    '
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(290, 100));
scribec:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 63);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  ScribeCRandom: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (not(LVar0)) then begin
      LVar0 := random(1, 4);
    end
    if (LVar0 > 4) then begin
      LVar0 := 1;
    end
    LVar1 := message_str(381, 101) + proto_data(obj_pid(dude_obj), 1) + message_str(381, 102);
    if (LVar0 == 2) then begin
      LVar1 := message_str(381, 103) + proto_data(obj_pid(dude_obj), 1) + message_str(381, 104);
    end
    else begin
      if (LVar0 == 3) then begin
        LVar1 := message_str(381, 105);
      end
      else begin
        if (LVar0 == 4) then begin
          LVar1 := message_str(381, 106);
        end
        else begin
          LVar0 := 1;
        end
      end
    end
    LVar0 := LVar0 + 1;
    float_msg(self_obj, LVar1, 0);
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: 'call ScribeCRandom;

    '
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(381, 100));
scsupmut:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 47);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(277, 100));
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    script_overrides;
    if (herebefore) then begin
      call ScSupMut3;
    end
    else begin
      herebefore := 1;
      start_gdialog(277, self_obj, 4, -1, -1);
      gsay_start;
      call ScSupMut0;
      gsay_end;
      end_dialogue;
    end
  ScSupMut0: |
    gsay_reply(277, 101);
    giq_option(-3, 277, 102, combat, 50);
    giq_option(4, 277, 103, combat, 50);
    giq_option(4, 277, 104, ScSupMut1, 50);
    giq_option(4, 277, 105, combat, 50);
  ScSupMut1: |
    gsay_reply(277, 106);
    giq_option(4, 277, 107, combat, 50);
    giq_option(4, 277, 108, ScSupMut2, 50);
    giq_option(4, 277, 109, combat, 50);
  ScSupMut2: 'gsay_message(277, 110, 50);

    '
  ScSupMut3: 'float_msg(self_obj, message_str(277, 111), 0);

    '
  combat: 'hostile := 1;

    '
sdresser:
  start: |
    variable LVar0 := 0;
    if (script_action == 4) then begin
      call pickup_p_proc;
    end
    else begin
      if (script_action == 3) then begin
        call description_p_proc;
      end
      else begin
        if (script_action == 21) then begin
          call look_at_p_proc;
        end
      end
    end
  pickup_p_proc: |
    script_overrides;
    display_msg(message_str(120, 102));
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(120, 101));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(120, 100));
  chairend: "[]"
secdisk:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(349, 100));
    end
  use_p_proc: |
    script_overrides;
    if (local_var(0) == 1) then begin
      display_msg(message_str(349, 101));
    end
    else begin
      display_msg(message_str(349, 102));
      set_global_var(163, 1);
      set_local_var(0, 1);
      rm_obj_from_inven(dude_obj, self_obj);
      display_msg(message_str(766, 103) + "100" + message_str(766, 104));
      give_exp_points(100);
    end
secdoor:
  start: "[]"
  dude_use_door: |
    if (obj_is_locked(self_obj)) then begin
      script_overrides;
      display_msg(message_str(459, 100));
    end
  Officer_use_door: |
    if (obj_is_open(self_obj)) then begin
      obj_close(self_obj);
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
      obj_open(self_obj);
    end
  map_enter_p_proc: 'SecDoor_ptr := self_obj;

    '
  use_p_proc: |
    if (source_obj == dude_obj) then begin
      call dude_use_door;
    end
    else begin
      if (source_obj == Officer_ptr) then begin
        call Officer_use_door;
      end
    end
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 77) then begin
      script_overrides;
      if (not(obj_is_locked(self_obj))) then begin
        display_msg(message_str(459, 101));
      end
      else begin
        test := roll_vs_skill(source_obj, 9, 0);
        if (is_success(test)) then begin
          display_msg(message_str(459, 102));
          obj_unlock(self_obj);
          call give_exps;
        end
        else begin
          if (is_critical(test)) then begin
            jam_lock(self_obj);
            display_msg(message_str(459, 104));
          end
          else begin
            display_msg(message_str(459, 103));
          end
        end
      end
      if (tile_distance_objs(Officer_ptr, dude_obj) < 4) then begin
        if (not(armory_access)) then begin
          armory_access := 2;
          set_map_var(1, armory_access);
        end
      end
    end
  use_skill_on_p_proc: |
    if (action_being_used == 9) then begin
      script_overrides;
      if (not(obj_is_locked(self_obj))) then begin
        display_msg(message_str(459, 101));
      end
      else begin
        test := roll_vs_skill(source_obj, 9, -20);
        if (is_success(test)) then begin
          display_msg(message_str(459, 102));
          obj_unlock(self_obj);
          call give_exps;
        end
        else begin
          if (is_critical(test)) then begin
            jam_lock(self_obj);
            display_msg(message_str(459, 104));
          end
          else begin
            display_msg(message_str(459, 103));
          end
        end
      end
      if (tile_distance_objs(Officer_ptr, dude_obj) < 4) then begin
        if (not(armory_access)) then begin
          armory_access := 2;
          set_map_var(1, armory_access);
        end
      end
    end
  give_exps: |
    if (local_var(0) == 0) then begin
      display_msg(message_str(459, 105));
      give_exp_points(25);
      set_local_var(0, 1);
    end
semicomp:
  start: |
    if (local_var(0) == 0) then begin
      set_local_var(0, random(1, 9));
    end
    if (script_action == 21) then begin
      script_overrides;
      call search;
    end
    else begin
      if (script_action == 8) then begin
        use_skill := action_being_used;
        script_overrides;
        call skills;
      end
    end
  search: |
    if (tile_distance_objs(self_obj, dude_obj) > 3) then begin
      display_msg(message_str(418, 100));
    end
    else begin
      if (local_var(0) == 1) then begin
        display_msg(message_str(418, 102));
      end
      else begin
        if (local_var(0) == 2) then begin
          display_msg(message_str(418, 103));
        end
        else begin
          if (local_var(0) == 3) then begin
            display_msg(message_str(418, 104));
          end
          else begin
            if (local_var(0) == 4) then begin
              display_msg(message_str(418, 105));
            end
            else begin
              if (local_var(0) == 5) then begin
                display_msg(message_str(418, 106));
              end
              else begin
                if (local_var(0) == 6) then begin
                  display_msg(message_str(418, 107));
                end
                else begin
                  if (local_var(0) == 7) then begin
                    display_msg(message_str(418, 108));
                  end
                  else begin
                    if (local_var(0) == 8) then begin
                      display_msg(message_str(418, 109));
                    end
                    else begin
                      if (local_var(0) == 9) then begin
                        display_msg(message_str(418, 111));
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  skills: |
    if ((use_skill == 13) or (use_skill == 12)) then begin
      display_msg(message_str(418, 101));
    end
    else begin
      display_msg(message_str(418, 102));
    end
sentrygn:
  start: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (script_action == 2) then begin
      if ((local_var(0) == 0) and (obj_type(source_obj) == dude_obj)) then begin
        display_msg(message_str(304, 100));
        set_local_var(0, 1);
      end
      if ((local_var(1) == 0) and (obj_type(source_obj) == dude_obj) and global_var(139) and global_var(140)) then begin
        display_msg(message_str(304, 101));
        set_local_var(1, 1);
        add_timer_event(self_obj, game_ticks(7), 1);
      end
    end
    else begin
      if (script_action == 22) then begin
        LVar0 := random(1, 6) + 2;
        LVar1 := do_check(source_obj, 5, 0);
        if (is_success(LVar1)) then begin
          if (is_critical(LVar1)) then begin
            if (obj_type(source_obj) == dude_obj) then begin
              display_msg(message_str(304, 102));
            end
          end
          else begin
            if (obj_type(source_obj) == dude_obj) then begin
              display_msg(message_str(304, 103));
            end
            critter_dmg(source_obj, LVar0, 0);
            display_msg(message_str(304, 104) + LVar0 + message_str(304, 105));
          end
        end
        else begin
          if (is_critical(LVar1)) then begin
            if (obj_type(source_obj) == dude_obj) then begin
              display_msg(message_str(304, 106));
            end
            critter_dmg(source_obj, LVar0, 0);
            display_msg(message_str(304, 107) + LVar0 + message_str(304, 108));
          end
          else begin
            if (obj_type(source_obj) == dude_obj) then begin
              display_msg(message_str(304, 109));
            end
            critter_dmg(source_obj, LVar0, 0);
            display_msg(message_str(304, 110) + LVar0 + message_str(304, 111));
          end
        end
        set_local_var(1, 0);
      end
    end
set:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 78);
      initialized := 1;
    end
    else begin
      if (script_action == 22) then begin
        if (fixed_param == 1) then begin
          set_local_var(9, 1);
        end
      end
      else begin
        if (script_action == 14) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 11) then begin
            call do_dialogue;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 12) then begin
                if (global_var(249) and obj_can_see_obj(self_obj, dude_obj)) then begin
                  if (local_var(6) == 0) then begin
                    dialogue_system_enter;
                  end
                end
                if (Hostile) then begin
                  Hostile := 0;
                  set_global_var(249, 1);
                  attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
                end
                else begin
                  if (local_var(4) == 0) then begin
                    if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 6)) then begin
                      dialogue_system_enter;
                    end
                  end
                  else begin
                    if ((global_var(30) == 1) and (global_var(31) != 2)) then begin
                      if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 6)) then begin
                        dialogue_system_enter;
                      end
                    end
                  end
                end
              end
              else begin
                if ((script_action == 21) or (script_action == 3)) then begin
                  script_overrides;
                  display_msg(message_str(15, 100));
                end
                else begin
                  if (script_action == 18) then begin
                    set_global_var(553, 1);
                    if (source_obj == dude_obj) then begin
                      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                        set_global_var(156, 1);
                        set_global_var(157, 0);
                      end
                      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                        set_global_var(157, 1);
                        set_global_var(156, 0);
                      end
                      set_global_var(160, global_var(160) + 1);
                      if ((global_var(160) % 6) == 0) then begin
                        set_global_var(155, global_var(155) + 1);
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    start_gdialog(15, self_obj, 4, 15, 4);
    gsay_start;
    if (global_var(249)) then begin
      Hostile := 1;
    end
    if (Hostile) then begin
      call set49;
    end
    else begin
      if (local_var(4)) then begin
        if ((global_var(30) == 1) and (global_var(31) != 2)) then begin
          call set57;
        end
        else begin
          if (global_var(18) and (local_var(7) == 0)) then begin
            call set52;
          end
          else begin
            if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
              call set207;
            end
            else begin
              if (global_var(29) >= 1) then begin
                if (local_var(5) == 1) then begin
                  call set50;
                end
                if (global_var(60) bwand 1) then begin
                  call set42;
                end
                else begin
                  if (global_var(59) == 1) then begin
                    call set29;
                  end
                  else begin
                    if ((global_var(29) == 2) or (global_var(306) != 0)) then begin
                      call set18;
                    end
                    else begin
                      if (local_var(9)) then begin
                        call set25;
                      end
                      else begin
                        call set51;
                      end
                    end
                  end
                end
              end
              else begin
                call set51;
              end
            end
          end
        end
      end
      else begin
        add_timer_event(self_obj, game_ticks(600), 1);
        set_local_var(4, 1);
        if ((global_var(30) == 1) and (global_var(31) != 2)) then begin
          call set57;
        end
        else begin
          if (global_var(18) and (local_var(7) == 0)) then begin
            call set52;
          end
          else begin
            if ((global_var(29) == 2) or (global_var(306) != 0)) then begin
              call set30;
            end
            else begin
              if (global_var(17) != 2) then begin
                if (global_var(59) == 1) then begin
                  call set16;
                end
                else begin
                  call set00;
                end
              end
            end
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
  setend: "[]"
  setcbt: 'Hostile := 1;

    '
  settime: 'call setcbt;

    '
  set00: |
    gsay_reply(15, 101);
    giq_option(5, 15, 102, set00_2, 50);
    giq_option(4, 15, 103, set00a, 51);
    giq_option(4, 15, 104, set00b, 51);
    giq_option(-3, 15, 105, set05, 50);
  set00_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call UpReact;
      call set01;
    end
    else begin
      call BigDownReact;
      call set02;
    end
  set01: |
    gsay_reply(15, 106);
    giq_option(7, 15, 107, set09, 50);
    giq_option(4, 15, 108, set01a, 50);
    giq_option(4, 15, 109, set14, 50);
  set01a: |
    gsay_reply(15, 110);
    giq_option(0, 15, 111, set12, 50);
  set02: |
    gsay_reply(15, 112);
    giq_option(5, 15, 113, set03, 51);
    giq_option(5, 15, 114, set02a, 49);
    giq_option(0, 15, 115, set01, 50);
  set03: |
    gsay_message(15, 116, 51);
    call setcbt;
  set05: |
    gsay_reply(15, 121);
    giq_option(-3, 15, 122, set06, 50);
    giq_option(-3, 15, 123, set08, 50);
  set06: |
    set_global_var(29, 1);
    gsay_reply(15, 124);
    giq_option(4, 15, 125, setend, 50);
    giq_option(4, 15, 126, set07, 50);
    giq_option(-3, 15, 127, setend, 50);
    giq_option(-3, 15, 128, set07, 50);
  set07: |
    gsay_message(15, 129, 50);
    call setend;
  set08: |
    gsay_message(15, 130, 50);
    call settime;
  set09_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call set10;
    end
    else begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        call set03;
      end
      else begin
        call set04;
      end
    end
  set09: |
    gsay_reply(15, 131);
    giq_option(6, 15, 132, set09_2, 50);
    giq_option(4, 15, 133, set09a, 51);
    giq_option(5, 15, 134, set15, 50);
  set10: |
    gsay_reply(15, 135);
    giq_option(6, 15, 136, set10a, 50);
    giq_option(4, 15, 137, setcbt, 51);
  set10a: |
    gsay_reply(15, 138);
    giq_option(6, 15, 139, set11, 50);
  set11: |
    gsay_reply(15, 140);
    giq_option(5, 15, 141, set12, 50);
    giq_option(4, 15, 142, set08, 50);
  set12: |
    gsay_reply(15, 143);
    giq_option(4, 15, 144, set06, 50);
    giq_option(4, 15, 145, set12_2, 51);
  set12_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call set08;
    end
    else begin
      call set03;
    end
  set13: |
    gsay_reply(15, 146);
    giq_option(4, 15, 147, set06, 50);
    giq_option(4, 15, 148, set13_2, 51);
  set13_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call set08;
    end
    else begin
      call set03;
    end
  set14: |
    gsay_reply(15, 149);
    giq_option(4, 15, 150, set12, 50);
    giq_option(5, 15, 151, set15, 50);
  set15: |
    gsay_reply(15, 152);
    giq_option(4, 15, 153, set12, 50);
    giq_option(4, 15, 154, set12_2, 50);
    giq_option(4, 15, 155, set09a, 51);
  set16: |
    gsay_reply(15, 156);
    giq_option(4, 15, 157, set17, 50);
    giq_option(4, 15, 158, set03, 51);
    giq_option(-3, 15, 159, set17, 50);
    giq_option(-3, 15, 160, set03, 51);
  set17: |
    gsay_reply(15, 161);
    giq_option(7, 15, 162, set17_2, 50);
    giq_option(4, 15, 163, set06, 50);
    giq_option(4, 15, 164, set03, 51);
    giq_option(-3, 15, 159, set06, 50);
    giq_option(-3, 15, 160, set03, 51);
  set17_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call set09;
    end
    else begin
      call set03;
    end
  set18: |
    set_global_var(60, global_var(60) bwor 1);
    gsay_reply(15, 165);
    giq_option(4, 15, 166, setend, 50);
    giq_option(4, 15, 167, set18a, 51);
    giq_option(-3, 15, 168, setend, 50);
  set19_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call set20;
    end
    else begin
      call set23;
    end
  set19: |
    gsay_reply(15, 169);
    giq_option(5, 15, 170, set19_2, 50);
    giq_option(4, 15, 171, setend, 50);
    giq_option(4, 15, 172, set24, 50);
  set20: |
    gsay_reply(15, 173);
    giq_option(4, 15, 174, set21, 50);
    giq_option(4, 15, 175, setend, 50);
  set21: |
    gsay_reply(15, 176);
    giq_option(4, 15, 177, set22, 50);
    giq_option(4, 15, 178, set21a, 50);
  set21a: |
    gsay_message(15, 179, 50);
    call setend;
  set22: |
    gsay_reply(15, 180);
    giq_option(5, 15, 181, setend, 50);
  set23: |
    gsay_reply(15, 182);
    giq_option(4, 15, 183, setend, 50);
    giq_option(4, 15, 184, setcbt, 51);
  set24: |
    gsay_reply(15, 185);
    giq_option(4, 15, 186, setend, 50);
    giq_option(4, 15, 187, setcbt, 51);
  set25: |
    gsay_reply(15, 188);
    giq_option(5, 15, 189, set25_2, 50);
    giq_option(4, 15, 190, set28, 50);
    giq_option(-3, 15, 191, set28, 50);
  set25_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call set26;
    end
    else begin
      call set27;
    end
  set26: |
    set_local_var(5, 1);
    gsay_message(15, 192, 50);
    set_global_var(60, global_var(60) bwor 1);
    call setend;
  set27: |
    gsay_message(15, 193, 51);
    call setcbt;
  set28: |
    gsay_message(15, 194, 50);
    call setend;
  set29: |
    gsay_message(15, 195, 50);
    call setcbt;
  set30: |
    gsay_reply(15, 196);
    giq_option(5, 15, 197, set31, 50);
    giq_option(5, 15, 198, set34, 50);
    giq_option(4, 15, 199, set38, 50);
    giq_option(4, 15, 200, set40, 50);
    giq_option(-3, 15, 201, set41, 50);
  set31: |
    gsay_reply(15, 202);
    giq_option(5, 15, 203, set32, 50);
    giq_option(5, 15, 204, setcbt, 51);
  set32: |
    gsay_reply(15, 205);
    giq_option(4, 15, 206, setcbt, 51);
    giq_option(4, 15, 207, set33, 50);
  set33: |
    set_global_var(60, global_var(60) bwor 1);
    gsay_reply(15, 208);
    call setend;
  set34: |
    gsay_reply(15, 209);
    giq_option(5, 15, 210, set18, 50);
    giq_option(5, 15, 211, set34_2, 50);
  set34_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call set35;
    end
    else begin
      call set36;
    end
  set35: |
    gsay_message(15, 212, 50);
    call setend;
  set36: |
    set_global_var(60, global_var(60) bwor 1);
    gsay_message(15, 213, 50);
    call setend;
  set38: |
    gsay_reply(15, 214);
    giq_option(4, 15, 215, set39, 50);
    giq_option(4, 15, 216, setend, 50);
    giq_option(4, 15, 217, setcbt, 51);
  set39: |
    set_global_var(60, global_var(60) bwor 1);
    gsay_message(15, 218, 50);
    call setend;
  set40: |
    gsay_reply(15, 219);
    giq_option(4, 15, 220, set40_2, 50);
    giq_option(4, 15, 221, setcbt, 51);
  set40_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call set34;
    end
    else begin
      call set48;
    end
  set41: |
    gsay_reply(15, 222);
    giq_option(-3, 15, 223, set08, 50);
    giq_option(-3, 15, 224, setcbt, 51);
  set42: |
    gsay_reply(15, 225);
    giq_option(4, 15, 226, set42_2, 50);
    giq_option(4, 15, 227, setcbt, 51);
    giq_option(4, 15, 228, setend, 50);
    giq_option(-3, 15, 229, setend, 50);
  set43: |
    gsay_reply(15, 230);
    giq_option(7, 15, 231, set44, 50);
    giq_option(4, 15, 232, set47, 50);
    giq_option(4, 15, 233, set48, 51);
  set44: |
    gsay_reply(15, 234);
    if (is_success(do_check(dude_obj, 4, 0))) then begin
      giq_option(13, 15, 235, set46, 50);
    end
    giq_option(4, 15, 236, setend, 50);
    giq_option(4, 15, 237, set45, 50);
  set42_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call set43;
    end
    else begin
      call set48;
    end
  set45: |
    gsay_reply(15, 238);
    giq_option(4, 15, 239, setcbt, 51);
    giq_option(4, 15, 240, setend, 50);
    giq_option(4, 15, 241, set45a, 51);
  set45a: |
    gsay_message(15, 242, 51);
    call setcbt;
  set46: |
    gsay_reply(15, 243);
    giq_option(4, 15, 244, setend, 50);
    giq_option(4, 15, 245, setcbt, 51);
  set47: |
    gsay_message(15, 246, 50);
    call setend;
  set48: |
    gsay_message(15, 247, 51);
    call setcbt;
  set49: |
    if (local_var(6) != 1) then begin
      set_local_var(6, 1);
      gsay_message(15, 248, 51);
    end
    call setcbt;
  set50: |
    set_local_var(5, 2);
    gsay_reply(15, 249);
    giq_option(5, 15, 250, setend, 50);
    giq_option(5, 15, 251, setcbt, 51);
  set51: |
    gsay_message(15, 252, 50);
    call setend;
  set52: |
    set_local_var(7, 1);
    gsay_reply(15, 253);
    giq_option(4, 15, 254, set53, 49);
    giq_option(4, 15, 255, set03, 51);
    giq_option(-3, 15, 256, set52a, 49);
  set52a: |
    gsay_reply(15, 257);
    giq_option(-3, 15, 258, set53, 49);
  set53: |
    gsay_reply(15, 259);
    giq_option(5, 15, 260, set54, 50);
    giq_option(4, 15, 261, set56, 50);
    giq_option(4, 15, 262, setend, 50);
    giq_option(-3, 15, 263, set56, 50);
    giq_option(-3, 15, 264, setend, 50);
  set54: |
    gsay_reply(15, 265);
    giq_option(4, 15, 266, set55, 50);
    giq_option(4, 15, 267, set56, 50);
  set55: |
    setgone := 1;
    gsay_message(15, 268, 50);
    call setend;
  set56: |
    set_global_var(60, global_var(60) bwor 2);
    gsay_message(15, 269, 50);
    call setend;
  set57: |
    gsay_reply(15, 270);
    if (obj_is_carrying_obj_pid(dude_obj, 98)) then begin
      giq_option(6, 15, 271, set57_2, 50);
    end
    giq_option(4, 15, 272, set63, 51);
    giq_option(4, 15, 273, setcbt, 51);
    giq_option(4, 15, 274, set64, 50);
    giq_option(-3, 15, 275, set63, 50);
  set57_2: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call set58;
    end
    else begin
      call set62;
    end
  set58: |
    gsay_reply(15, 276);
    giq_option(5, 15, 277, set59, 50);
    giq_option(4, 15, 278, set60, 51);
  set59: |
    set_global_var(31, 1);
    set_global_var(227, 1);
    gsay_reply(15, 279);
    giq_option(4, 15, 280, travel, 50);
  set60: |
    gsay_reply(15, 281);
    giq_option(4, 15, 282, set06, 50);
    giq_option(4, 15, 283, setcbt, 51);
  set61: |
    gsay_message(15, 284, 51);
    call setcbt;
  set62: |
    gsay_reply(15, 285);
    giq_option(4, 15, 286, setcbt, 51);
  set63: |
    gsay_reply(15, 287);
    giq_option(4, 15, 288, setcbt, 51);
    giq_option(-3, 15, 289, setcbt, 51);
  set64: |
    gsay_reply(15, 290);
    giq_option(4, 15, 291, set63, 51);
    giq_option(4, 15, 292, set65, 50);
    giq_option(4, 15, 293, setcbt, 51);
  set65: |
    chip := obj_carrying_pid_obj(dude_obj, 55);
    if (chip != 0) then begin
      rm_obj_from_inven(dude_obj, chip);
      set_global_var(30, 0);
    end
    gsay_message(15, 294, 51);
    call BigDownReact;
  set00a: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      call set03;
    end
    else begin
      call set04;
    end
  set00b: |
    call BigDownReact;
    call set02;
  set02a: |
    call UpReact;
    call set01;
  set04: |
    gsay_reply(15, 117);
    giq_option(4, 15, 118, setcbt, 51);
    giq_option(4, 15, 119, setcbt, 51);
    giq_option(-3, 15, 120, setcbt, 51);
  set09a: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      call set03;
    end
    else begin
      call set04;
    end
  set18a: |
    call BigDownReact;
    call set19;
  set200: 'gsay_message(15, 295, 50);

    '
  set201: 'gsay_message(15, 296, 50);

    '
  set202: 'gsay_message(15, 297, 50);

    '
  set203: 'gsay_message(15, 298, 50);

    '
  set204: 'gsay_message(15, 299, 50);

    '
  set205: 'gsay_message(15, 300, 50);

    '
  set206: 'gsay_message(15, 301, 50);

    '
  set207: 'gsay_message(15, 302, 50);

    '
  set208: 'gsay_message(15, 303, 50);

    '
  set209: 'gsay_message(15, 304, 50);

    '
  set300: 'gsay_message(15, 305, 50);

    '
  set301: 'gsay_message(15, 306, 50);

    '
  set302: 'gsay_message(15, 307, 50);

    '
  set303: 'gsay_message(15, 308, 50);

    '
  set304: 'gsay_message(15, 309, 50);

    '
  set305: 'gsay_message(15, 310, 50);

    '
  set306: 'gsay_message(15, 311, 50);

    '
  set307: 'gsay_message(15, 312, 50);

    '
  set308: 'gsay_message(15, 313, 50);

    '
  set309: 'gsay_message(15, 314, 50);

    '
  set310: 'gsay_message(15, 315, 50);

    '
  set311: 'gsay_message(15, 316, 50);

    '
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      Hostile := 1;
    end
  travel: 'load_map(5, 1);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
setcoler:
  start: |
    if ((script_action == 3) or (script_action == 21)) then begin
      call see_stuff;
    end
    else begin
      if (script_action == 8) then begin
        call trap_stuff;
      end
      else begin
        if (script_action == 6) then begin
          if (local_var(1) == 0) then begin
            call find_iq;
          end
          else begin
            if (local_var(2)) then begin
              call close_cooler;
            end
            else begin
              call open_cooler;
            end
          end
        end
        else begin
          if (script_action == 4) then begin
            if (local_var(2) == 0) then begin
              script_overrides;
            end
          end
        end
      end
    end
  trap_stuff: |
    script_overrides;
    use_skill := action_being_used;
    if (local_var(0)) then begin
      if (local_var(1) == 0) then begin
        if (use_skill == 11) then begin
          call disarm_trap;
        end
        else begin
          if (use_skill == 13) then begin
            call disarm_mech;
          end
          else begin
            display_msg(message_str(92, 100));
          end
        end
      end
    end
    else begin
      call find_trap;
    end
  see_stuff: |
    script_overrides;
    display_msg(message_str(92, 109));
  find_trap: |
    if (has_skill(dude_obj, 11)) then begin
      test := roll_vs_skill(dude_obj, 11, -10);
      if (is_success(test)) then begin
        display_msg(message_str(92, 101));
        set_local_var(0, 1);
      end
      else begin
        display_msg(message_str(92, 102));
        call explode;
      end
    end
  find_iq: |
    script_overrides;
    if (local_var(0)) then begin
      call failure;
    end
    else begin
      test := do_check(dude_obj, 4, 0);
      if (is_success(test)) then begin
        display_msg(message_str(92, 101));
        set_local_var(0, 1);
      end
      else begin
        display_msg(message_str(92, 102));
        call explode;
      end
    end
  disarm_trap: |
    script_overrides;
    test := roll_vs_skill(dude_obj, 11, 10);
    if (is_success(test)) then begin
      display_msg(message_str(92, 103));
      set_local_var(1, 1);
    end
    else begin
      if (is_critical(test)) then begin
        display_msg(message_str(92, 105));
        call explode;
      end
      else begin
        display_msg(message_str(92, 104));
      end
    end
  disarm_mech: |
    script_overrides;
    test := roll_vs_skill(dude_obj, 13, 30);
    if (is_success(test)) then begin
      display_msg(message_str(92, 103));
      set_local_var(1, 1);
    end
    else begin
      if (is_critical(test)) then begin
        display_msg(message_str(92, 105));
        call explode;
      end
      else begin
        display_msg(message_str(92, 104));
      end
    end
  failure: |
    script_overrides;
    display_msg(message_str(92, 106));
    call explode;
  explode: |
    explosion(tile_num(self_obj), elevation(self_obj), 0);
    damage := random(1, 6) + random(1, 6) + random(1, 6);
    critter_dmg(dude_obj, damage, 0);
    set_local_var(1, 1);
    set_local_var(0, 1);
  close_cooler: |
    script_overrides;
    animate_stand_reverse_obj(self_obj);
    set_local_var(2, 0);
  open_cooler: |
    script_overrides;
    animate_stand_obj(self_obj);
    set_local_var(2, 1);
setdesk:
  start: |
    variable LVar0 := 0;
    if (script_action == 6) then begin
      call do_stuff;
    end
  do_stuff: |
    if (local_var(0) == 1) then begin
      display_msg(message_str(93, 100));
    end
    else begin
      display_msg(message_str(93, 101));
      set_local_var(0, 1);
    end
setdoor:
  start: |
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 3) then begin
        call description_p_proc;
      end
      else begin
        if (script_action == 23) then begin
          call map_update_p_proc;
        end
        else begin
          if (script_action == 15) then begin
            call map_enter_p_proc;
          end
          else begin
            if (script_action == 6) then begin
              call use_p_proc;
            end
            else begin
              if (script_action == 8) then begin
                call use_skill_on_p_proc;
              end
              else begin
                if (script_action == 7) then begin
                  call use_obj_on_p_proc;
                end
                else begin
                  if (script_action == 14) then begin
                    call damage_p_proc;
                  end
                end
              end
            end
          end
        end
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (is_success(do_check(dude_obj, 1, 0))) then begin
      display_msg(message_str(911, 101));
    end
    else begin
      display_msg(message_str(911, 100));
    end
  description_p_proc: |
    script_overrides;
    if ((local_var(1) == 0) and (local_var(0) == 0)) then begin
      call Locked_And_Trapped;
    end
    else begin
      if (local_var(0) == 0) then begin
        call Door_Trapped;
      end
      else begin
        if (local_var(1) == 0) then begin
          call Door_Locked;
        end
        else begin
          display_msg(message_str(911, 102));
        end
      end
    end
  use_p_proc: |
    variable LVar0 := 0;
    LVar0 := roll_vs_skill(source_obj, 11, 0);
    if ((local_var(1) == 0) and (local_var(0) == 0)) then begin
      script_overrides;
      if (is_success(LVar0)) then begin
        reg_anim_func(2, source_obj);
        if (source_obj == dude_obj) then begin
          display_msg(message_str(911, 106));
        end
        else begin
          display_msg(proto_data(obj_pid(source_obj), 1) + message_str(911, 105));
        end
      end
      else begin
        display_msg(message_str(911, 104));
        Set_Off_Trap := 1;
        explosion(tile_num(source_obj), elevation(self_obj), random(10, 30));
        set_local_var(0, 1);
        set_local_var(2, local_var(2) + 1);
        display_msg(message_str(911, 103));
      end
    end
    else begin
      if (local_var(0) == 0) then begin
        if (is_success(LVar0)) then begin
          script_overrides;
          reg_anim_func(2, source_obj);
          if (source_obj == dude_obj) then begin
            display_msg(message_str(911, 106));
          end
          else begin
            display_msg(proto_data(obj_pid(source_obj), 1) + message_str(911, 105));
          end
        end
        else begin
          display_msg(message_str(911, 104));
          Set_Off_Trap := 1;
          explosion(tile_num(source_obj), elevation(self_obj), random(10, 30));
          set_local_var(0, 1);
          set_local_var(2, local_var(2) + 1);
        end
      end
      else begin
        if (local_var(1) == 0) then begin
          script_overrides;
          display_msg(message_str(911, 103));
        end
      end
    end
  use_skill_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar1 := action_being_used;
    if ((LVar1 == 11) and (local_var(0) == 0)) then begin
      script_overrides;
      LVar0 := roll_vs_skill(source_obj, LVar1, 0);
      if (is_success(LVar0)) then begin
        reg_anim_func(2, source_obj);
        if (source_obj == dude_obj) then begin
          display_msg(message_str(911, 106));
          set_local_var(0, 1);
          display_msg(message_str(766, 103) + "50" + message_str(766, 104));
          give_exp_points(50);
        end
        else begin
          display_msg(proto_data(obj_pid(source_obj), 1) + message_str(911, 105));
        end
      end
      else begin
        display_msg(message_str(911, 104));
        Set_Off_Trap := 1;
        explosion(tile_num(source_obj), elevation(self_obj), random(10, 30));
        set_local_var(0, 1);
        set_local_var(2, local_var(2) + 1);
      end
    end
    else begin
      if ((LVar1 == 9) and (local_var(1) == 0)) then begin
        script_overrides;
        LVar0 := roll_vs_skill(source_obj, LVar1, -20);
        if (is_success(LVar0)) then begin
          set_local_var(1, 1);
          display_msg(message_str(911, 111));
          obj_unlock(self_obj);
          display_msg(message_str(766, 103) + "50" + message_str(766, 104));
          give_exp_points(50);
        end
        else begin
          if (is_critical(LVar0)) then begin
            jam_lock(self_obj);
            display_msg(message_str(911, 112));
          end
          else begin
            display_msg(message_str(911, 110));
          end
        end
      end
    end
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    LVar0 := obj_pid(obj_being_used_with);
    LVar1 := roll_vs_skill(source_obj, 11, 0);
    LVar2 := roll_vs_skill(source_obj, 9, 0);
    if (LVar0 == 84) then begin
      if ((local_var(1) == 0) and (local_var(0) == 0)) then begin
        script_overrides;
        if (is_success(LVar1)) then begin
          reg_anim_func(2, source_obj);
          if (source_obj == dude_obj) then begin
            display_msg(message_str(911, 106));
          end
          else begin
            display_msg(proto_data(obj_pid(source_obj), 1) + message_str(911, 105));
          end
        end
        else begin
          display_msg(message_str(911, 104));
          Set_Off_Trap := 1;
          explosion(tile_num(source_obj), elevation(self_obj), random(10, 30));
          set_local_var(0, 1);
          set_local_var(2, local_var(2) + 1);
        end
        display_msg(message_str(911, 108));
      end
      else begin
        if (local_var(0) == 0) then begin
          script_overrides;
          if (is_success(LVar1)) then begin
            reg_anim_func(2, source_obj);
            if (source_obj == dude_obj) then begin
              display_msg(message_str(911, 106));
            end
            else begin
              display_msg(proto_data(obj_pid(source_obj), 1) + message_str(911, 105));
            end
          end
          else begin
            display_msg(message_str(911, 104));
            Set_Off_Trap := 1;
            explosion(tile_num(source_obj), elevation(self_obj), random(10, 30));
            set_local_var(0, 1);
            set_local_var(2, local_var(2) + 1);
          end
          display_msg(message_str(911, 108));
        end
        else begin
          if (local_var(1) == 0) then begin
            script_overrides;
            if (is_success(LVar2)) then begin
              set_local_var(1, 1);
              display_msg(message_str(911, 111));
              display_msg(message_str(766, 103) + "50" + message_str(766, 104));
              give_exp_points(50);
              obj_unlock(self_obj);
            end
            else begin
              if (is_critical(LVar2)) then begin
                rm_obj_from_inven(dude_obj, LVar0);
                destroy_object(LVar0);
                jam_lock(self_obj);
                display_msg(message_str(911, 109));
              end
              else begin
                display_msg(message_str(911, 110));
              end
            end
          end
        end
      end
    end
    else begin
      script_overrides;
      LVar1 := roll_vs_skill(source_obj, 11, 0);
      if ((local_var(1) == 0) and (local_var(0) == 0)) then begin
        script_overrides;
        if (is_success(LVar1)) then begin
          reg_anim_func(2, source_obj);
          if (source_obj == dude_obj) then begin
            display_msg(message_str(911, 106));
          end
          else begin
            display_msg(proto_data(obj_pid(source_obj), 1) + message_str(911, 105));
          end
        end
        else begin
          display_msg(message_str(911, 104));
          Set_Off_Trap := 1;
          explosion(tile_num(source_obj), elevation(self_obj), random(10, 30));
          set_local_var(0, 1);
          set_local_var(2, local_var(2) + 1);
        end
      end
      else begin
        if (local_var(0) == 0) then begin
          if (is_success(LVar1)) then begin
            reg_anim_func(2, source_obj);
            if (source_obj == dude_obj) then begin
              display_msg(message_str(911, 106));
            end
            else begin
              display_msg(proto_data(obj_pid(source_obj), 1) + message_str(911, 105));
            end
          end
          else begin
            display_msg(message_str(911, 104));
            Set_Off_Trap := 1;
            explosion(tile_num(source_obj), elevation(self_obj), random(10, 30));
            set_local_var(0, 1);
            set_local_var(2, local_var(2) + 1);
          end
        end
        else begin
          if (local_var(1) == 0) then begin
            script_overrides;
            display_msg(message_str(911, 107));
          end
        end
      end
    end
  map_enter_p_proc: |
    if (local_var(1) == 0) then begin
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
  map_update_p_proc: |
    if (local_var(1) == 0) then begin
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
  damage_p_proc: |
    set_local_var(2, local_var(2) + 1);
    if (Set_Off_Trap == 0) then begin
      display_msg(message_str(911, 104));
      explosion(tile_num(self_obj), elevation(self_obj), random(20, 40));
      set_local_var(0, 1);
      Set_Off_Trap := 1;
    end
    if (local_var(2) > 1) then begin
      set_obj_visibility(self_obj, 1);
    end
  Locked_And_Trapped: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := roll_vs_skill(dude_obj, 11, 0);
    LVar1 := roll_vs_skill(dude_obj, 9, 0);
    if (is_success(LVar0)) then begin
      if (is_critical(LVar0)) then begin
        if (is_success(LVar1)) then begin
          display_msg(message_str(911, 113));
        end
        else begin
          if (is_critical(LVar1)) then begin
            display_msg(message_str(911, 114));
          end
        end
      end
      else begin
        if (is_success(LVar1)) then begin
          display_msg(message_str(911, 115));
        end
        else begin
          if (is_critical(LVar1)) then begin
            display_msg(message_str(911, 116));
          end
        end
      end
    end
    else begin
      if (is_critical(LVar0)) then begin
        if (is_success(LVar1)) then begin
          display_msg(message_str(911, 117));
        end
        else begin
          if (is_critical(LVar1)) then begin
            display_msg(message_str(911, 118));
          end
        end
      end
      else begin
        if (is_success(LVar1)) then begin
          display_msg(message_str(911, 117));
        end
        else begin
          if (is_critical(LVar1)) then begin
            display_msg(message_str(911, 118));
          end
        end
      end
    end
  Door_Locked: |
    variable LVar0 := 0;
    LVar0 := roll_vs_skill(dude_obj, 9, 0);
    if (is_success(LVar0)) then begin
      display_msg(message_str(911, 117));
    end
    else begin
      if (is_critical(LVar0)) then begin
        display_msg(message_str(911, 117));
      end
    end
  Door_Trapped: |
    variable LVar0 := 0;
    LVar0 := roll_vs_skill(dude_obj, 11, 0);
    if (is_success(LVar0)) then begin
      if (is_critical(LVar0)) then begin
        display_msg(message_str(911, 114));
      end
      else begin
        display_msg(message_str(911, 116));
      end
    end
    else begin
      if (is_critical(LVar0)) then begin
        display_msg(message_str(911, 118));
      end
      else begin
        display_msg(message_str(911, 118));
      end
    end
setdoor1:
  start: |
    variable LVar0 := 0;
    if (script_action == 21) then begin
      script_overrides;
      call see_stuff;
    end
    if (script_action == 6) then begin
      script_overrides;
      call do_stuff;
    end
    if (script_action == 7) then begin
      lockpicks := obj_being_used_with;
      script_overrides;
      call do_skill;
    end
  do_stuff: 'display_msg(message_str(94, 107));

    '
  do_skill: |
    if (has_skill(dude_obj, 9)) then begin
      testa := roll_vs_skill(dude_obj, 9, -10);
      if (is_success(testa)) then begin
        display_msg(message_str(94, 100));
        set_local_var(0, 1);
      end
      else begin
        display_msg(message_str(94, 101));
        if (is_critical(testa)) then begin
          display_msg(message_str(94, 102));
          rm_obj_from_inven(dude_obj, lockpicks);
        end
      end
    end
    else begin
      display_msg(message_str(94, 103));
    end
  see_stuff: |
    if (local_var(0) == 0) then begin
      display_msg(message_str(94, 104));
    end
    else begin
      if (local_var(2) == 1) then begin
        display_msg(message_str(94, 105));
      end
      else begin
        display_msg(message_str(94, 106));
      end
    end
  doorend: "[]"
setguard:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 42);
      initialized := 1;
    end
    if (script_action == 11) then begin
      display_msg(message_str(95, 100));
    end
    else begin
      if (script_action == 4) then begin
        Hostile := 1;
      end
      else begin
        if (script_action == 12) then begin
          if (Hostile) then begin
            Hostile := 0;
            attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
          end
        end
        else begin
          if (script_action == 18) then begin
            if (source_obj == dude_obj) then begin
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                set_global_var(156, 1);
                set_global_var(157, 0);
              end
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                set_global_var(157, 1);
                set_global_var(156, 0);
              end
              set_global_var(160, global_var(160) + 1);
              if ((global_var(160) % 6) == 0) then begin
                set_global_var(155, global_var(155) + 1);
              end
            end
          end
        end
      end
    end
seth:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(183, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  combat_p_proc: |
    if (fixed_param == 4) then begin
      round_counter := round_counter + 1;
    end
    if (round_counter > 3) then begin
      if (global_var(246) == 0) then begin
        set_global_var(246, 1);
        set_global_var(155, global_var(155) - 5);
      end
    end
  destroy_p_proc: |
    set_global_var(124, 3);
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  map_enter_p_proc: |
    if (local_var(10) == 0) then begin
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
        float_msg(self_obj, message_str(183, 204), 0);
      end
      else begin
        float_msg(self_obj, message_str(183, 205), 0);
      end
      set_local_var(10, 1);
    end
  map_update_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 24);
      home_tile := 14108;
      sleep_tile := 15925;
      wake_time := 600;
      sleep_time := 2100;
      initialized := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (local_var(9) == 1) then begin
      float_msg(self_obj, message_str(183, 320), 2);
      hostile := 1;
    end
    else begin
      if ((global_var(26) == 1) and (get_critter_stat(dude_obj, 4) > 3)) then begin
        set_global_var(218, 1);
        if (local_var(8) == 0) then begin
          set_local_var(8, 1);
          start_gdialog(183, self_obj, 4, -1, -1);
          gsay_start;
          call TanSeth00;
          gsay_end;
          end_dialogue;
        end
        else begin
          start_gdialog(183, self_obj, 4, -1, -1);
          gsay_start;
          call TanSeth01;
          gsay_end;
          end_dialogue;
        end
      end
      else begin
        if (local_var(5) == 1) then begin
          float_msg(self_obj, message_str(185, 166), 0);
        end
        else begin
          if (global_var(246) == 1) then begin
            float_msg(self_obj, message_str(183, 101), 2);
            hostile := 1;
          end
          else begin
            start_gdialog(183, self_obj, 4, -1, -1);
            gsay_start;
            call pick_start;
            gsay_end;
            end_dialogue;
          end
        end
      end
    end
  travel: |
    game_time_advance(game_ticks(60 * 30));
    if ((global_var(43) == 0) and (global_var(43) != 2)) then begin
      set_global_var(43, 1);
    end
    load_map("caves.map", 1);
  no_travel: |
    if (global_var(43) == 2) then begin
      gsay_message(183, 203, 50);
    end
    else begin
      gsay_message(183, 128, 50);
    end
  pick_start: |
    if (global_var(124) == 0) then begin
      if (local_var(1) < 2) then begin
        call Seth04;
      end
      else begin
        call Seth05;
      end
    end
    else begin
      if (global_var(43) == 2) then begin
        call BigUpReact;
        gsay_message(183, 200, 49);
        if (get_critter_stat(dude_obj, 4) > 3) then begin
          call Seth07;
        end
      end
      else begin
        if (local_var(1) < 2) then begin
          call Seth09;
        end
        else begin
          call Seth07;
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  Seth02: |
    gsay_message(183, 102, 50);
    hostile := 1;
  Seth03: |
    gsay_reply(183, 103);
    set_local_var(4, 1);
    gsay_option(183, 104, Seth13, 50);
    gsay_option(183, 105, Seth08a, 50);
  Seth04: |
    gsay_reply(183, 106);
    set_global_var(124, 1);
    giq_option(4, 183, 107, Seth02, 50);
    giq_option(4, 183, 108, Seth06, 50);
    giq_option(-3, 183, 109, Seth03, 50);
  Seth05: |
    gsay_reply(183, 110);
    set_global_var(124, 1);
    giq_option(4, 183, 111, Seth06, 50);
    giq_option(-3, 183, 112, Seth03, 50);
  Seth06: |
    gsay_reply(183, 113);
    call Seth08;
  Seth07: |
    gsay_reply(183, 114);
    call Seth08;
  Seth08: |
    if (global_var(43) == 1) then begin
      giq_option(4, 183, 115, Seth10, 50);
    end
    if (global_var(26) == 1) then begin
      giq_option(4, 183, 116, Seth11, 50);
    end
    giq_option(4, 183, 117, Seth12, 50);
    if ((local_var(4) == 1) and (global_var(43) != 2)) then begin
      giq_option(4, 183, 118, Seth13, 50);
      giq_option(-3, 183, 119, Seth13, 50);
    end
    giq_option(4, 183, 120, Seth08a, 50);
  Seth08a: |
    if (local_var(7) == 0) then begin
      set_local_var(7, 1);
      call Seth14;
    end
    else begin
      call Sethend;
    end
  Seth09: |
    gsay_reply(183, 121);
    if (global_var(43) == 1) then begin
      giq_option(4, 183, 115, Seth10, 50);
    end
    if (global_var(26) == 1) then begin
      giq_option(4, 183, 116, Seth11, 50);
    end
    giq_option(4, 183, 117, Seth12, 50);
    if (local_var(4) == 1) then begin
      giq_option(4, 183, 118, Seth13, 50);
      giq_option(-3, 183, 119, Seth13, 50);
    end
    giq_option(4, 183, 120, Seth08a, 50);
  Seth10: |
    if (global_var(43) == 2) then begin
      gsay_reply(183, 201);
    end
    else begin
      if ((global_var(239) == 0) or (global_var(240) == 0)) then begin
        gsay_reply(183, 122);
        set_global_var(239, 1);
        set_global_var(240, 1);
        display_msg(message_str(183, 133));
      end
      else begin
        gsay_reply(183, 132);
      end
    end
    set_local_var(4, 1);
    if (global_var(26) == 1) then begin
      giq_option(4, 183, 116, Seth11, 50);
    end
    giq_option(4, 183, 117, Seth12, 50);
    if (local_var(4) == 1) then begin
      giq_option(4, 183, 118, Seth13, 50);
      giq_option(-3, 183, 119, Seth13, 50);
    end
    giq_option(4, 183, 120, Seth08a, 50);
  Seth11: |
    set_global_var(69, 1);
    gsay_reply(183, 123);
    if (global_var(43) == 1) then begin
      giq_option(4, 183, 115, Seth10, 50);
    end
    giq_option(4, 183, 117, Seth12, 50);
    if (local_var(4) == 1) then begin
      giq_option(4, 183, 118, Seth13, 50);
      giq_option(-3, 183, 119, Seth13, 50);
    end
    giq_option(4, 183, 120, Seth08a, 50);
  Seth12: |
    gsay_reply(183, 124);
    giq_option(4, 183, 115, Seth10, 50);
    giq_option(4, 183, 116, Seth11, 50);
    if (local_var(4) == 1) then begin
      giq_option(4, 183, 118, Seth13, 50);
      giq_option(-3, 183, 119, Seth13, 50);
    end
    giq_option(4, 183, 120, Seth08a, 50);
  Seth13: |
    if (global_var(43) == 2) then begin
      gsay_reply(183, 202);
    end
    else begin
      gsay_reply(183, 125);
    end
    giq_option(4, 183, 126, travel, 50);
    giq_option(4, 183, 127, no_travel, 50);
    giq_option(-3, 183, 130, travel, 50);
    giq_option(-3, 183, 131, no_travel, 50);
  Seth14: 'gsay_message(183, 206, 50);

    '
  Sethend: "[]"
  TanSeth00: |
    gsay_reply(183, 300);
    giq_option(4, 183, 301, TanSeth03, 50);
    giq_option(4, 183, 302, TanSeth02, 51);
    giq_option(4, 183, 303, TanSeth02, 50);
    if (global_var(43) == 1) then begin
      giq_option(4, 183, 304, TanSeth07, 50);
    end
  TanSeth01: |
    gsay_reply(183, 305);
    giq_option(4, 183, 306, TanSeth06, 50);
    giq_option(4, 183, 307, TanSeth05, 51);
    giq_option(4, 183, 308, TanSeth06, 50);
    if (global_var(43) == 1) then begin
      giq_option(4, 183, 309, TanSeth07, 50);
    end
  TanSeth02: 'gsay_message(183, 310, 50);

    '
  TanSeth03: |
    set_global_var(69, 1);
    gsay_reply(183, 311);
    giq_option(4, 183, 312, Sethend, 50);
    giq_option(4, 183, 313, TanSeth02, 51);
    giq_option(4, 183, 314, TanSeth04, 51);
    giq_option(4, 183, 315, TanSeth02, 51);
  TanSeth04: |
    gsay_reply(183, 316);
    giq_option(4, 183, 317, TanSeth05, 51);
    giq_option(4, 183, 318, Sethend, 50);
    giq_option(4, 183, 319, TanSeth02, 51);
  TanSeth05: |
    set_local_var(9, 1);
    hostile := 1;
    gsay_message(183, 320, 51);
  TanSeth06: 'gsay_message(183, 321, 50);

    '
  TanSeth07: |
    gsay_reply(183, 322);
    giq_option(4, 183, 323, travel, 50);
    giq_option(4, 183, 324, TanSeth02, 51);
    giq_option(4, 183, 325, Sethend, 50);
seth2:
  start: |
    if (Only_once) then begin
      Only_once := 0;
      critter_add_trait(self_obj, 1, 6, 0);
      critter_add_trait(self_obj, 1, 5, 4);
      if (global_var(124) == 3) then begin
        set_obj_visibility(self_obj, 1);
      end
    end
    if (script_action == 11) then begin
      if (global_var(43) == 2) then begin
        float_msg(self_obj, message_str(197, 102), 8);
      end
      else begin
        float_msg(self_obj, message_str(197, 101), 8);
      end
    end
    else begin
      if (script_action == 12) then begin
        if (hostile) then begin
          hostile := 0;
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
        if (tile_distance_objs(self_obj, dude_obj) > 3) then begin
          animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 1), 0);
        end
      end
      else begin
        if (script_action == 4) then begin
          hostile := 1;
        end
        else begin
          if (script_action == 21) then begin
            script_overrides;
            display_msg(message_str(197, 100));
          end
          else begin
            if (script_action == 18) then begin
              set_global_var(124, 3);
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(159, global_var(159) + 1);
                if ((global_var(159) % 2) == 0) then begin
                  set_global_var(155, global_var(155) - 1);
                end
              end
            end
          end
        end
      end
    end
setsctdr:
  start: |
    if (script_action == 6) then begin
      if (source_obj == dude_obj) then begin
        if (local_var(2)) then begin
          call use_door;
        end
        if (local_var(3) == 0) then begin
          set_local_var(3, 1);
          temp := 100;
          give_exp_points(temp);
          display_msg(message_str(96, 200) + temp + message_str(96, 201));
        end
        else begin
          if (local_var(1)) then begin
            call use_door;
          end
          else begin
            if (local_var(0)) then begin
              call failure;
            end
            else begin
              call find_iq;
            end
          end
        end
      end
      else begin
        call use_door;
      end
    end
    else begin
      if (script_action == 8) then begin
        call trap_stuff;
      end
    end
  trap_stuff: |
    use_skill := action_being_used;
    if (local_var(1) == 0) then begin
      if (local_var(0)) then begin
        if (use_skill == 11) then begin
          call disarm_trap;
        end
        else begin
          if (use_skill == 13) then begin
            call disarm_mech;
          end
        end
      end
    end
    else begin
      call find_trap;
    end
  find_trap: |
    script_overrides;
    test := roll_vs_skill(dude_obj, 11, -20);
    if (is_success(test)) then begin
      display_msg(message_str(96, 100));
      set_local_var(0, 1);
    end
    else begin
      display_msg(message_str(96, 104));
      call explode;
    end
  find_iq: |
    script_overrides;
    test := do_check(dude_obj, 4, 2);
    if (is_success(test)) then begin
      display_msg(message_str(96, 100));
      set_local_var(0, 1);
    end
    else begin
      display_msg(message_str(96, 104));
      call explode;
    end
  disarm_trap: |
    script_overrides;
    test := roll_vs_skill(dude_obj, 11, 0);
    if (is_success(test)) then begin
      display_msg(message_str(96, 102));
      set_local_var(1, 1);
    end
    else begin
      if (is_critical(test)) then begin
        display_msg(message_str(96, 104));
        call explode;
      end
      else begin
        display_msg(message_str(96, 103));
      end
    end
  disarm_mech: |
    script_overrides;
    test := roll_vs_skill(dude_obj, 13, 20);
    if (is_success(test)) then begin
      display_msg(message_str(96, 102));
      set_local_var(1, 1);
    end
    else begin
      if (is_critical(test)) then begin
        display_msg(message_str(96, 104));
        call explode;
      end
      else begin
        display_msg(message_str(96, 103));
      end
    end
  failure: |
    script_overrides;
    display_msg(message_str(96, 105));
    call explode;
  explode: |
    set_local_var(1, 1);
    explosion(tile_num(self_obj), elevation(self_obj), 0);
    damage := random(1, 6) + random(1, 6) + random(1, 6) + random(1, 6) + random(1, 6) + random(1, 6);
    critter_dmg(dude_obj, damage, 0);
  use_door: |
    if (local_var(2)) then begin
      set_local_var(2, 0);
    end
    else begin
      set_local_var(2, 1);
    end
shack:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
        display_msg(message_str(196, 100));
      end
    end
shaddesk:
  start: |
    if ((script_action == 3) or (script_action == 21)) then begin
      call look_at_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(124, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(124, 100));
shadyrug:
  start: |
    variable LVar0 := 0;
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 3) then begin
        call description_p_proc;
      end
    end
  chairend: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(121, 100));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(121, 101));
shadywst:
  start: |
    if (script_action == 15) then begin
      call map_enter_p_proc;
    end
    else begin
      if (script_action == 23) then begin
        call map_update_p_proc;
      end
      else begin
        if (script_action == 16) then begin
          call map_exit_p_proc;
        end
      end
    end
  combat_p_proc: |
    script_overrides;
    gfade_out(600);
    move_to(dude_obj, 12107, 0);
    game_time_advance(game_ticks(1800));
    gfade_in(600);
  map_enter_p_proc: |
    variable LVar0 := 0;
    if (metarule(14, 0)) then begin
      display_msg(message_str(194, 101));
    end
    set_global_var(566, 1);
    if ((game_time / (10 * 60 * 60 * 24)) >= global_var(153)) then begin
      set_global_var(12, 1);
    end
    if ((days_since_visited > 1) and (map_var(4) == 0) and (global_var(26) != 2) and (global_var(26) != 1) and (global_var(26) != 3) and (global_var(43) == 2) and (global_var(115) > 0) and (global_var(26) != 5) and (global_var(114) == 0)) then begin
      set_global_var(26, 1);
      set_map_var(4, 1);
    end
    else begin
      if (global_var(26) == 5) then begin
        set_global_var(26, 2);
        if ((map_var(1) == 0) and (map_var(3) == 0)) then begin
          set_map_var(3, 1);
          set_map_var(1, 1);
          display_msg(message_str(194, 100));
          give_exp_points(400);
        end
      end
    end
    if (global_var(645) == 0) then begin
      create_object_sid(128, 31740, 0, 221);
      LVar0 := create_object_sid(16777229, 0, 0, 3);
      critter_attempt_placement(LVar0, 19709, 0);
      anim(LVar0, 1000, 5);
      set_global_var(645, 1);
    end
    call Lighting;
    call Where_To_Start;
  map_update_p_proc: 'call Lighting;

    '
  map_exit_p_proc: "[]"
  Lighting: |
    variable LVar0 := 0;
    LVar0 := game_time_hour;
    if ((LVar0 >= 600) and (LVar0 < 700)) then begin
      set_light_level(LVar0 - 600 + 40);
    end
    else begin
      if ((LVar0 >= 700) and (LVar0 < 1800)) then begin
        set_light_level(100);
      end
      else begin
        if ((LVar0 >= 1800) and (LVar0 < 1900)) then begin
          set_light_level(100 - (LVar0 - 1800));
        end
        else begin
          set_light_level(40);
        end
      end
    end
  Where_To_Start: |
    if (global_var(32) == 1) then begin
      override_map_start(107, 60, 0, 2);
    end
    else begin
      if (global_var(32) == 2) then begin
        override_map_start(65, 93, 0, 4);
      end
      else begin
        if (global_var(32) == 3) then begin
          override_map_start(107, 76, 0, 5);
        end
        else begin
          override_map_start(107, 60, 0, 2);
        end
      end
    end
shark:
  start: "[]"
  critter_p_proc: |
    if (global_var(626) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if ((global_var(282) == 1) and (local_var(6) == 0)) then begin
        add_timer_event(self_obj, game_ticks(3), 3);
        set_local_var(6, 1);
      end
      else begin
        if (global_var(555) != 2) then begin
          if (tile_num(self_obj) != dest_tile) then begin
            animate_move_obj_to_tile(self_obj, dest_tile, 0);
          end
        end
      end
    end
  damage_p_proc: |
    if ((source_obj == dude_obj) and (map_var(0) == 1)) then begin
      set_map_var(1, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(4)) then begin
      display_msg(message_str(387, 100));
    end
    else begin
      display_msg(message_str(387, 101));
    end
  map_enter_p_proc: |
    critter_add_trait(self_obj, 1, 6, 14);
    critter_add_trait(self_obj, 1, 5, 58);
    if ((global_var(555) == 2) or (global_var(282) == 1)) then begin
      move_to(self_obj, 7000, 0);
      set_obj_visibility(self_obj, 1);
      sleeping_disabled := 1;
      removal_ptr := self_obj;
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    start_gdialog(387, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4) == 0) then begin
      call Shark01;
    end
    else begin
      if (local_var(1) < 2) then begin
        call Shark08;
      end
      else begin
        call Shark06;
      end
    end
    gsay_end;
    end_dialogue;
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      waypoint := 1;
      dest_tile := 33726;
    end
    else begin
      if (fixed_param == 2) then begin
        if (Trish_ptr != 0) then begin
          attack_complex(Trish_ptr, 0, 1, 0, 0, 30000, 0, 0);
        end
      end
      else begin
        if (fixed_param == 3) then begin
          float_msg(self_obj, message_str(387, 126), 2);
          add_timer_event(self_obj, game_ticks(5), 1);
        end
      end
    end
  map_update_p_proc: |
    if ((game_time_hour >= 1600) or (game_time_hour < 300)) then begin
      set_obj_visibility(self_obj, 0);
    end
    else begin
      set_obj_visibility(self_obj, 1);
    end
  Shark01: |
    set_local_var(4, 1);
    gsay_reply(387, 103);
    giq_option(4, 387, 104, SharkCombat, 51);
    giq_option(4, 387, 105, Shark02, 50);
    giq_option(4, 387, 106, Shark03, 50);
    giq_option(5, 387, 107, Shark01a, 49);
    giq_option(-3, 387, 108, Shark05, 50);
  Shark01a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Shark04;
    end
    else begin
      call Shark03;
    end
  Shark02: |
    gsay_message(387, 109, 51);
    call SharkCombat;
  Shark03: |
    variable LVar0 := 0;
    LVar0 := message_str(387, 110);
    if (get_critter_stat(dude_obj, 34) == 1) then begin
      LVar0 := LVar0 + message_str(387, 111);
    end
    else begin
      LVar0 := LVar0 + message_str(387, 112);
    end
    gsay_reply(387, LVar0);
    giq_option(4, 387, 113, SharkCombat, 50);
  Shark04: |
    call UpReactLevel;
    gsay_reply(387, 114);
    giq_option(4, 387, 115, timed_event_p_proc, 50);
    giq_option(4, 387, 116, Shark04b, 49);
    giq_option(4, 387, 117, Shark04a, 50);
    giq_option(4, 387, 118, SharkCombat, 51);
  Shark04a: |
    if (not(is_success(roll_vs_skill(dude_obj, 14, 0)))) then begin
      call DownReactLevel;
    end
    call Shark05;
  Shark04b: |
    call UpReactLevel;
    add_timer_event(self_obj, game_ticks(3), 2);
  Shark05: 'gsay_message(387, 119, 50);

    '
  Shark06: |
    gsay_reply(387, 120);
    giq_option(4, 387, 121, Shark07, 50);
    giq_option(4, 387, 122, Shark03, 50);
    giq_option(-3, 387, 123, Shark05, 50);
  Shark07: |
    gsay_message(387, 124, 50);
    call SharkCombat;
  Shark08: |
    gsay_message(387, 125, 50);
    call SharkCombat;
  SharkCombat: 'hostile := 1;

    '
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
sherry:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (global_var(556) == 1) then begin
        if ((game_time - local_var(6)) > (10 * 60 * 60 * 24)) then begin
          critter_add_trait(self_obj, 1, 6, 16);
          set_global_var(556, 2);
          set_local_var(6, 0);
          home_tile := 18125;
          sleep_tile := 17924;
        end
      end
      if ((game_time_hour >= 700) and (game_time_hour <= 1930)) then begin
        if (tile_num(self_obj) != home_tile) then begin
          animate_move_obj_to_tile(self_obj, home_tile, 0);
        end
      end
      call sleeping;
    end
    if ((global_var(556) != 2) and (global_var(626) == 1)) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    else begin
      if ((global_var(556) == 2) and (global_var(628) == 1)) then begin
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (global_var(556) != 2) then begin
        set_global_var(626, 1);
      end
      else begin
        set_global_var(628, 1);
        set_global_var(247, 1);
        set_global_var(155, global_var(155) - 5);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(4)) then begin
      display_msg(message_str(388, 100));
    end
    else begin
      display_msg(message_str(388, 101));
    end
  map_enter_p_proc: |
    sleep_time := 2000;
    wake_time := 630;
    if ((global_var(555) == 2) and (global_var(556) != 2)) then begin
      destroy_object(self_obj);
    end
    if (global_var(556) != 2) then begin
      critter_add_trait(self_obj, 1, 6, 14);
      home_tile := 15513;
      sleep_tile := 13494;
    end
    else begin
      critter_add_trait(self_obj, 1, 6, 16);
      home_tile := 18125;
      sleep_tile := 17924;
    end
  pickup_p_proc: |
    float_msg(self_obj, message_str(388, 102), 0);
    hostile := 1;
  talk_p_proc: |
    if (local_var(5) == 1) then begin
      float_msg(self_obj, message_str(185, 166), 0);
    end
    else begin
      call get_reaction;
      start_gdialog(388, self_obj, 4, -1, -1);
      gsay_start;
      if (global_var(556) == 2) then begin
        call Sherry22;
      end
      else begin
        if (local_var(4) == 1) then begin
          call Sherry15;
        end
        else begin
          call Sherry01;
        end
      end
      gsay_end;
      end_dialogue;
    end
    if (feed_dude) then begin
      call SherryCook;
    end
  Sherry01: |
    set_local_var(4, 1);
    gsay_reply(388, 103);
    giq_option(4, 388, message_str(388, 104) + proto_data(obj_pid(dude_obj), 1) + message_str(388, 105), Sherry02, 50);
    giq_option(4, 388, 106, Sherry03, 50);
    giq_option(-3, 388, 107, Sherry04, 50);
  Sherry02: |
    gsay_reply(388, 108);
    giq_option(4, 388, 109, SherryCombat, 51);
    giq_option(4, 388, 110, SherryEnd, 50);
    giq_option(5, 388, 111, Sherry05, 50);
    giq_option(6, 388, 112, Sherry07, 50);
  Sherry03: |
    call DownReact;
    gsay_reply(388, 113);
    giq_option(4, 388, 114, SherryEnd, 50);
    giq_option(4, 388, 115, SherryCombat, 50);
  Sherry04: 'gsay_message(388, 116, 50);

    '
  Sherry05: |
    gsay_reply(388, 117);
    giq_option(4, 388, 118, Sherry11, 50);
    giq_option(4, 388, 119, SherryEnd, 50);
  Sherry07: 'gsay_message(388, 124, 51);

    '
  Sherry09: |
    set_local_var(7, 1);
    gsay_reply(388, 126);
    giq_option(4, 388, 127, Sherry10, 50);
    call Sherry13;
  Sherry10: |
    gsay_reply(388, 128);
    call Sherry13;
  Sherry11: |
    gsay_reply(388, 129);
    call Sherry13;
  Sherry12: |
    set_local_var(8, 1);
    gsay_reply(388, 130);
    giq_option(4, 388, 131, Sherry26, 50);
    call Sherry13;
  Sherry13: |
    if (not(local_var(7))) then begin
      giq_option(5, 388, 133, Sherry09, 50);
    end
    if (not(local_var(8))) then begin
      giq_option(4, 388, 132, Sherry12, 50);
    end
    if (not(local_var(9))) then begin
      giq_option(6, 388, 134, Sherry14, 50);
    end
    call Goodbyes;
    giq_option(4, 388, exit_line, SherryEnd, 50);
  Sherry14: |
    set_local_var(9, 1);
    gsay_reply(388, 135);
    call Sherry13;
  Sherry15: |
    gsay_reply(388, 136);
    giq_option(4, 388, 137, Sherry16, 50);
    if (local_var(6) == 0) then begin
      giq_option(5, 388, 138, Sherry17, 50);
    end
    call Goodbyes;
    giq_option(4, 388, exit_line, SherryEnd, 50);
  Sherry16: |
    gsay_message(388, 139, 51);
    call SherryCombat;
  Sherry17: |
    gsay_reply(388, 140);
    giq_option(4, 388, 141, SherryEnd, 50);
    giq_option(6, 388, 142, Sherry18, 50);
  Sherry18: |
    gsay_reply(388, 143);
    giq_option(4, 388, 144, SherryEnd, 50);
    giq_option(6, 388, 145, Sherry18a, 50);
  Sherry18a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Sherry19;
    end
    else begin
      call Sherry20;
    end
  Sherry19: |
    gsay_reply(388, 146);
    giq_option(6, 388, 147, Sherry21, 50);
  Sherry20: |
    call DownReact;
    gsay_message(388, 148, 51);
  Sherry21: |
    set_local_var(6, game_time);
    set_global_var(556, 1);
    gsay_message(388, 149, 50);
  Sherry22: |
    gsay_reply(388, 150);
    giq_option(4, 388, 151, SherryEnd, 50);
    giq_option(4, 388, 152, Sherry23, 50);
    giq_option(4, 388, 153, Sherry24, 50);
    if ((local_var(10) == 0) and (global_var(555) == 1)) then begin
      giq_option(4, 388, 166, Sherry27, 50);
    end
  Sherry23: |
    gsay_reply(388, 154);
    giq_option(4, 388, 155, Sherry25, 50);
    giq_option(4, 388, 156, SherryEnd, 50);
  Sherry24: 'gsay_message(388, 157, 50);

    '
  Sherry25: 'feed_dude := 1;

    '
  Sherry26: |
    gsay_reply(388, 159);
    call Sherry13;
  Sherry27: |
    set_local_var(10, 1);
    gsay_reply(388, 160);
    giq_option(4, 388, 161, Sherry27a, 50);
    giq_option(4, 388, 162, SherryEnd, 50);
    giq_option(6, 388, 163, Sherry28, 50);
  Sherry27a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Sherry28;
    end
    else begin
      call Sherry29;
    end
  Sherry28: |
    gsay_message(388, 164, 50);
    set_global_var(257, 1);
  Sherry29: 'gsay_message(388, 165, 50);

    '
  SherryCombat: 'hostile := 1;

    '
  SherryCook: |
    use_obj(dude_obj);
    float_msg(self_obj, message_str(388, 158), 0);
    critter_heal(dude_obj, 1);
    feed_dude := 0;
  SherryEnd: "[]"
  sleeping: |
    if (local_var(5) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(5, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(5, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(5, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(5, 1);
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
sid:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(602, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    call Sid00;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Sid_Ptr := self_obj;
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 37);
      critter_add_trait(self_obj, 1, 5, 4);
    end
  Sid00: |
    variable LVar0 := 0;
    LVar0 := random(1, 7);
    if (LVar0 == 1) then begin
      if ((game_time_hour >= 800) and (game_time_hour < 1200)) then begin
        float_msg(self_obj, message_str(602, 101), 8);
      end
      else begin
        if ((game_time_hour >= 1200) and (game_time_hour < 1600)) then begin
          if (get_critter_stat(dude_obj, 34) == 0) then begin
            float_msg(self_obj, message_str(602, 102), 8);
          end
          else begin
            float_msg(self_obj, message_str(602, 103), 8);
          end
        end
        else begin
          float_msg(self_obj, message_str(602, 104), 8);
        end
      end
    end
    else begin
      if (LVar0 == 2) then begin
        float_msg(self_obj, message_str(602, 105), 8);
      end
      else begin
        if (LVar0 == 3) then begin
          float_msg(self_obj, message_str(602, 106), 8);
          float_msg(Beth_Ptr, message_str(617, 374), 2);
        end
        else begin
          if (LVar0 == 4) then begin
            float_msg(self_obj, message_str(602, 107), 8);
            float_msg(Beth_Ptr, message_str(617, 375), 2);
          end
          else begin
            if (LVar0 == 5) then begin
              float_msg(self_obj, message_str(602, 108), 8);
              float_msg(Beth_Ptr, message_str(617, 376), 2);
            end
            else begin
              if (LVar0 == 6) then begin
                float_msg(self_obj, message_str(602, 109), 8);
                float_msg(Beth_Ptr, message_str(617, 377), 2);
              end
              else begin
                float_msg(self_obj, message_str(602, 110), 8);
                float_msg(Beth_Ptr, message_str(617, 378), 2);
                float_msg(self_obj, message_str(602, 111), 8);
              end
            end
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
sink:
  start: |
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 6) then begin
        call use_p_proc;
      end
      else begin
        if (script_action == 4) then begin
          call pickup_p_proc;
        end
        else begin
          if (script_action == 7) then begin
            call use_obj_on_p_proc;
          end
        end
      end
    end
  use_p_proc: |
    script_overrides;
    display_msg(message_str(739, 101));
  pickup_p_proc: 'call use_p_proc;

    '
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(739, 100));
  use_obj_on_p_proc: |
    script_overrides;
    display_msg(message_str(739, 102) + proto_data(obj_pid(obj_being_used_with), 1) + message_str(739, 103));
sinthia:
  start: |
    if (Initialized == 0) then begin
      Initialized := 1;
      Sinthia_ptr := self_obj;
    end
  critter_p_proc: |
    if (global_var(628) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if (map_var(1) == 2) then begin
      if ((local_var(6) == 0) and obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 12)) then begin
        dialogue_system_enter;
      end
    end
    if (global_var(143) == 2) then begin
      if (local_var(6) == 1) then begin
        set_map_var(0, 1);
        sleeping_disabled := 1;
        if (waypoint == 0) then begin
          dest_tile := 21097;
          waypoint := 1;
        end
        if (tile_distance(tile_num(self_obj), dest_tile) > 2) then begin
          animate_move_obj_to_tile(self_obj, dest_tile, 0);
        end
        else begin
          destroy_object(self_obj);
        end
      end
    end
  destroy_p_proc: |
    Sinthia_ptr := 0;
    set_global_var(143, 2);
    set_map_var(0, 2);
    if (source_obj == dude_obj) then begin
      set_global_var(628, 1);
      set_global_var(247, 1);
      set_global_var(155, global_var(155) - 5);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(5) == 1) then begin
      display_msg(message_str(338, 100));
    end
    else begin
      display_msg(message_str(338, 101));
    end
  map_enter_p_proc: |
    critter_add_trait(self_obj, 1, 6, 16);
    Sinthia_ptr := self_obj;
    home_tile := 17485;
    sleep_tile := 16681;
    sleep_time := 2300;
    wake_time := 1000;
    if (not(metarule(22, 0)) and (local_var(6) == 1)) then begin
      Sinthia_ptr := 0;
      destroy_object(self_obj);
    end
  talk_p_proc: |
    if (local_var(6) == 1) then begin
      display_msg(message_str(338, 171));
    end
    else begin
      if ((map_var(3) > 0) and (map_var(3) < 3) and (map_var(1) == 0)) then begin
        call Sinthia07;
      end
      else begin
        call get_reaction;
        start_gdialog(338, self_obj, 4, -1, -1);
        gsay_start;
        set_local_var(5, 1);
        if (map_var(1) == 2) then begin
          call Sinthia16;
        end
        else begin
          if ((map_var(1) == 1) and (local_var(7) == 0)) then begin
            call Sinthia17;
          end
          else begin
            if ((global_var(143) == 2) and (local_var(8) == 0)) then begin
              call Sinthia08;
            end
            else begin
              if (map_var(3) < 3) then begin
                call Sinthia00;
              end
              else begin
                if (local_var(1) < 2) then begin
                  call Sinthia29;
                end
                else begin
                  call Sinthia20;
                end
              end
            end
          end
        end
        gsay_end;
        end_dialogue;
      end
    end
    if (do_it) then begin
      call Sint;
    end
    if (remove_Raider) then begin
      if (JTRaider_ptr != 0) then begin
        set_map_var(3, 3);
        set_global_var(143, 2);
        display_msg(message_str(338, 177));
        destroy_object(JTRaider_ptr);
        JTRaider_ptr := 0;
        remove_Raider := 0;
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 2) then begin
      if ((global_var(143) != 2) and (local_var(7) == 0)) then begin
        dialogue_system_enter;
      end
    end
    else begin
      anim(self_obj, 1000, 3);
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  Sinthia00: |
    gsay_reply(338, 102);
    giq_option(4, 338, 103, SinthiaEnd, 50);
    giq_option(6, 338, 104, Sinthia00a, 50);
    giq_option(-3, 338, 105, Sinthia00b, 50);
  Sinthia00a: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      call Sinthia04;
    end
    else begin
      call Sinthia03;
    end
  Sinthia00b: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      call Sinthia01;
    end
    else begin
      call Sinthia02;
    end
  Sinthia01: 'gsay_message(338, 106, 50);

    '
  Sinthia02: 'gsay_message(338, 107, 50);

    '
  Sinthia03: 'gsay_message(338, 108, 50);

    '
  Sinthia04: |
    gsay_reply(338, 109);
    giq_option(6, 338, 110, Sinthia05, 50);
    if (global_var(5)) then begin
      giq_option(6, 338, 111, Sinthia06, 50);
    end
  Sinthia05: 'gsay_message(338, 112, 50);

    '
  Sinthia06: |
    call DownReact;
    gsay_message(338, 113, 50);
  Sinthia07: 'float_msg(self_obj, message_str(338, random(114, 117)), 7);

    '
  Sinthia08: |
    set_local_var(8, 1);
    call BigUpReact;
    gsay_reply(338, 118);
    giq_option(4, 338, 119, Sinthia10, 50);
    giq_option(5, 338, 120, Sinthia11, 50);
    giq_option(-3, 338, 121, Sinthia09, 50);
  Sinthia09: 'gsay_message(338, 122, 50);

    '
  Sinthia10: |
    call DownReact;
    gsay_message(338, 123, 50);
  Sinthia11: |
    gsay_reply(338, 124);
    giq_option(5, 338, 125, Sinthia12, 50);
    giq_option(5, 338, 126, Sinthia15, 50);
  Sinthia12: |
    gsay_reply(338, 127);
    giq_option(0, 634, 106, Sinthia12a, 49);
  Sinthia12a: |
    gsay_reply(338, 128);
    giq_option(5, 338, 129, Sinthia14, 50);
    giq_option(5, 338, 130, Sinthia13, 50);
  Sinthia13: |
    gsay_reply(338, 131);
    giq_option(0, 634, 106, Sinthia13a, 50);
  Sinthia13a: |
    if ((get_critter_stat(dude_obj, 34) == 0) or is_success(do_check(dude_obj, 3, 0))) then begin
      gsay_reply(338, 132);
      giq_option(0, 634, 106, SinOn, 49);
    end
    else begin
      gsay_message(338, 133, 49);
    end
  Sinthia14: |
    gsay_message(338, 134, 50);
    if (not(global_var(37)) and not(global_var(38))) then begin
      gsay_message(338, 136, 50);
    end
  Sinthia15: |
    gsay_reply(338, 137);
    giq_option(5, 338, 138, Sinthia14, 50);
  Sinthia16: |
    variable LVar0 := 0;
    set_local_var(6, 1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(338, 141);
    end
    else begin
      gsay_reply(338, 142);
    end
    giq_option(0, 634, 106, Sinthia16a, 50);
  Sinthia16a: |
    call BottomReact;
    dest_tile := 7521;
    gsay_message(338, 143, 50);
  Sinthia17: |
    set_local_var(7, 1);
    gsay_reply(338, 144);
    giq_option(4, 338, 145, Sinthia19, 50);
    giq_option(-3, 338, 146, Sinthia18, 50);
  Sinthia18: |
    call BottomReact;
    set_local_var(6, 1);
    gsay_message(338, 147, 50);
  Sinthia19: |
    remove_Raider := 1;
    gsay_reply(338, 148);
    giq_option(4, 338, 149, Sinthia08, 50);
  Sinthia20: |
    gsay_reply(338, 150);
    giq_option(4, 338, 151, Sinthia22, 50);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      giq_option(4, 338, 152, Sinthia20a, 50);
    end
    if (not(line23flag) and (global_var(38) == 0)) then begin
      giq_option(6, 338, 153, Sinthia23, 50);
    end
  Sinthia20a: |
    if (item_caps_total(dude_obj) >= 40) then begin
      item_caps_adjust(dude_obj, -40);
      call Sinthia27;
    end
    else begin
      call Sinthia28;
    end
  Sinthia22: 'gsay_message(338, 155, 50);

    '
  Sinthia23: |
    line23flag := 1;
    gsay_reply(338, 156);
    call SinthiaQuestions;
  Sinthia24: |
    line24flag := 1;
    gsay_reply(338, 161);
    call SinthiaQuestions;
  Sinthia25: |
    line25flag := 1;
    gsay_reply(338, 162);
    call SinthiaQuestions;
  Sinthia26: |
    line26flag := 1;
    gsay_reply(338, 163);
    call SinthiaQuestions;
  Sinthia27: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 3);
    LVar1 := message_str(338, 163 + LVar0);
    float_msg(self_obj, LVar1, 7);
    call SinOn;
  Sinthia28: |
    call DownReact;
    gsay_message(338, 167, 50);
  Sinthia29: 'gsay_message(338, 168, 50);

    '
  Sint: |
    gfade_out(600);
    game_time_advance(game_ticks(600));
    move_to(dude_obj, 18291, 0);
    if (not(is_success(do_check(dude_obj, 4, 0)))) then begin
      set_map_var(7, 1);
    end
    gfade_in(600);
    do_it := 0;
  SinOn: 'do_it := 1;

    '
  SinthiaQuestions: |
    if (not(line24flag)) then begin
      giq_option(6, 338, 157, Sinthia24, 50);
    end
    if (not(line25flag)) then begin
      giq_option(6, 338, 158, Sinthia25, 50);
    end
    if (not(line26flag)) then begin
      giq_option(6, 338, 159, Sinthia26, 50);
    end
    giq_option(6, 338, 160, SinthiaEnd, 50);
  SinthiaEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
skumdoor:
  start: "[]"
  damage_p_proc: |
    messing_with_SkumDoor := 1;
    SkumDoor_ptr := 0;
    destroy_object(self_obj);
  destroy_p_proc: |
    messing_with_SkumDoor := 1;
    SkumDoor_ptr := 0;
  map_enter_p_proc: |
    SkumDoor_ptr := self_obj;
    if ((game_time_hour > 409) and (game_time_hour < 1400)) then begin
      obj_close(self_obj);
      obj_lock(self_obj);
    end
    else begin
      obj_unlock(self_obj);
    end
    set_local_var(0, 0);
  map_update_p_proc: |
    if ((game_time_hour > 409) and (game_time_hour < 1400)) then begin
      if ((local_var(0) == 0) and not(messing_with_SkumDoor)) then begin
        obj_close(self_obj);
        obj_lock(self_obj);
      end
    end
    else begin
      obj_unlock(self_obj);
    end
  use_p_proc: |
    if (source_obj == dude_obj) then begin
      if (obj_is_locked(self_obj)) then begin
        script_overrides;
        display_msg(message_str(853, 100));
      end
    end
    else begin
      if (Neal_ptr != 0) then begin
        if (source_obj == Neal_ptr) then begin
          set_local_var(0, 0);
          if (Neal_closing_door == 0) then begin
            script_overrides;
            obj_unlock(self_obj);
            obj_open(self_obj);
          end
          else begin
            script_overrides;
            obj_close(self_obj);
            obj_lock(self_obj);
          end
          if (messing_with_SkumDoor) then begin
            messing_with_SkumDoor := 3;
          end
          else begin
            add_timer_event(Neal_ptr, game_ticks(1), 8);
          end
        end
      end
    end
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 84) then begin
      if (obj_is_locked(self_obj)) then begin
        GVar0 := roll_vs_skill(source_obj, 9, 0);
        if (is_success(GVar0)) then begin
          display_msg(message_str(853, 101));
          obj_unlock(self_obj);
          set_local_var(0, 1);
        end
        else begin
          if (is_critical(GVar0)) then begin
            display_msg(message_str(853, 103));
            jam_lock(self_obj);
          end
          else begin
            display_msg(message_str(853, 102));
          end
        end
        if (source_obj == dude_obj) then begin
          if ((game_time_hour >= 1300) and (game_time_hour < 1400)) then begin
            messing_with_SkumDoor := 1;
          end
        end
      end
      else begin
        display_msg(message_str(853, 104));
      end
    end
  use_skill_on_p_proc: |
    if (action_being_used == 9) then begin
      script_overrides;
      if (obj_is_locked(self_obj)) then begin
        GVar0 := roll_vs_skill(source_obj, action_being_used, -10);
        if (is_success(GVar0)) then begin
          display_msg(message_str(853, 101));
          obj_unlock(self_obj);
          set_local_var(0, 1);
        end
        else begin
          if (is_critical(GVar0)) then begin
            display_msg(message_str(853, 103));
            jam_lock(self_obj);
          end
          else begin
            display_msg(message_str(853, 102));
          end
        end
        if (source_obj == dude_obj) then begin
          if ((game_time_hour >= 1300) and (game_time_hour < 1400)) then begin
            messing_with_SkumDoor := 1;
          end
        end
      end
      else begin
        display_msg(message_str(853, 104));
      end
    end
slappy:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (tile_distance_objs(self_obj, dude_obj) <= 20) then begin
      if (((game_time / 10) - lastBabble) >= 10) then begin
        lastBabble := game_time / 10;
        float_msg(self_obj, message_str(842, random(101, 107)), 2);
      end
    end
    if (tile_num(self_obj) == 25131) then begin
      reg_anim_func(1, 1);
      reg_anim_obj_move_to_tile(self_obj, 25331, -1);
      reg_anim_func(3, 0);
    end
    else begin
      if (tile_num(self_obj) == 25331) then begin
        reg_anim_func(1, 1);
        reg_anim_obj_move_to_tile(self_obj, 25132, -1);
        reg_anim_func(3, 0);
      end
      else begin
        if (tile_num(self_obj) == 25132) then begin
          reg_anim_func(1, 1);
          reg_anim_obj_move_to_tile(self_obj, 24932, -1);
          reg_anim_func(3, 0);
        end
        else begin
          if (tile_num(self_obj) == 24932) then begin
            reg_anim_func(1, 1);
            reg_anim_obj_move_to_tile(self_obj, 25131, -1);
            reg_anim_func(3, 0);
          end
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (global_var(226) == 5) then begin
      call Slappy10;
    end
    else begin
      start_gdialog(842, self_obj, 4, -1, -1);
      gsay_start;
      call Slappy01;
      gsay_end;
      end_dialogue;
    end
  destroy_p_proc: 'call inc_good_critter;

    '
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(842, 100));
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 41);
      critter_add_trait(self_obj, 1, 5, 53);
    end
  Slappy01: |
    gsay_reply(842, 108);
    if (global_var(226) == 3) then begin
      giq_option(4, 842, 109, Slappy03, 50);
    end
    if (global_var(226) == 2) then begin
      giq_option(4, 842, 110, Slappy11, 50);
    end
    giq_option(4, 842, 111, Slappy04, 50);
    giq_option(4, 842, 112, Slappy05, 50);
    giq_option(-3, 842, 113, Slappy02, 50);
  Slappy02: |
    gsay_reply(842, 114);
    giq_option(-3, 842, 115, SlappyEnd, 50);
  Slappy03: |
    gsay_reply(842, 116);
    giq_option(4, 842, 117, Slappy06, 50);
    giq_option(4, 842, 118, Slappy05, 50);
    giq_option(4, 842, 119, Slappy09, 50);
  Slappy04: |
    gsay_reply(842, 120);
    giq_option(4, 842, 121, Slappy08, 50);
    giq_option(4, 842, 122, SlappyEnd, 50);
  Slappy05: |
    gsay_reply(842, 123);
    giq_option(4, 842, 124, SlappyEnd, 50);
  Slappy06: |
    gsay_reply(842, 125);
    giq_option(4, 842, 126, Slappy07, 50);
    giq_option(4, 842, 127, SlappyEnd, 50);
  Slappy07: |
    gsay_reply(842, 128);
    giq_option(4, 842, 129, SlappyClaw, 50);
    giq_option(4, 842, 130, SlappyEnd, 50);
  Slappy08: |
    gsay_reply(842, 131);
    giq_option(4, 842, 132, SlappyEnd, 50);
  Slappy09: 'gsay_message(842, 133, 50);

    '
  Slappy10: 'float_msg(self_obj, message_str(842, 134), 2);

    '
  Slappy11: |
    gsay_reply(842, 135);
    giq_option(4, 842, 136, SlappyEnd, 50);
  SlappyEnd: "[]"
  SlappyClaw: |
    if (map_var(10) == 0) then begin
      set_map_var(10, 1);
      give_exp_points(800);
      display_msg(message_str(766, 103) + 800 + message_str(766, 104));
    end
    load_map(37, 0);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  inc_good_critter: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
slummer:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 69);
      Only_Once := 0;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(391, 100));
      end
      else begin
        if (script_action == 18) then begin
          if (source_obj == dude_obj) then begin
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
              set_global_var(156, 1);
              set_global_var(157, 0);
            end
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
              set_global_var(157, 1);
              set_global_var(156, 0);
            end
            set_global_var(160, global_var(160) + 1);
            if ((global_var(160) % 6) == 0) then begin
              set_global_var(155, global_var(155) + 1);
            end
          end
        end
        else begin
          if (script_action == 4) then begin
            hostile := 1;
          end
          else begin
            if (script_action == 12) then begin
              if (hostile) then begin
                hostile := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call get_reaction;
    call weapon_check;
    start_gdialog(-1, self_obj, 4, -1, -1);
    gsay_start;
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      if (local_var(4) == 0) then begin
        if (armed == 1) then begin
          call slummer02;
        end
        else begin
          call slummer03;
        end
      end
      else begin
        set_local_var(4, 1);
        call slummer01;
      end
    end
    else begin
      set_local_var(4, 1);
      if (global_var(195) == 1) then begin
        call slummer00;
      end
      else begin
        if (armed == 1) then begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
            call slummer04;
          end
          else begin
            if ((global_var(158) > 2) or (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1)))) then begin
              call slummer06;
            end
            else begin
              call slummer05;
            end
          end
        end
        else begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
            call slummer07;
          end
          else begin
            if ((global_var(158) > 2) or (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1)))) then begin
              call slummer09;
            end
            else begin
              call slummer08;
            end
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
  social_skills: |
    script_overrides;
    call get_reaction;
    call do_dialogue;
  slummer00: 'gsay_message(391, 101, 50);

    '
  slummer01: 'gsay_message(391, 102, 50);

    '
  slummer02: |
    gsay_reply(391, 103);
    giq_option(7, 391, 104, slummer10, 50);
    giq_option(7, 391, 105, slummer11, 50);
    giq_option(4, 391, 106, slummer13, 50);
    giq_option(4, 391, 107, slummer15, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 108, slummer16, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 109, slummer18, 50);
    end
    giq_option(-3, 391, 110, slummer14, 50);
  slummer03: |
    gsay_reply(391, 111);
    giq_option(7, 391, 112, slummer03a, 50);
    giq_option(7, 391, 113, slummer20, 50);
    giq_option(4, 391, 114, slummer21, 50);
    giq_option(4, 391, 115, slummer22, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 116, slummer16, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 117, slummer17, 50);
    end
    giq_option(-3, 391, 118, slummer23, 50);
  slummer03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer19;
    end
    else begin
      call slummer49;
    end
  slummer04: |
    gsay_reply(391, 119);
    giq_option(7, 391, 120, slummer04a, 50);
    giq_option(7, 391, 121, slummer20, 50);
    giq_option(4, 391, 122, slummer26, 50);
    giq_option(4, 391, 123, slummer27, 50);
    giq_option(4, 391, 124, slummer15, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 125, slummer16, 50);
    end
    giq_option(-3, 391, 126, slummer28, 50);
  slummer04a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 20))) then begin
      call slummer25;
    end
    else begin
      call slummer49;
    end
  slummer05: |
    gsay_reply(391, 127);
    giq_option(7, 391, 128, slummer29, 50);
    giq_option(4, 391, 129, slummer30, 50);
    giq_option(4, 391, 130, slummer31, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 131, slummer16, 50);
    end
    giq_option(-3, 391, 132, slummer28, 50);
  slummer06: |
    gsay_reply(391, 133);
    giq_option(7, 391, 134, slummer29, 50);
    giq_option(4, 391, 135, slummer32, 50);
    giq_option(4, 391, 136, slummer31, 50);
    giq_option(4, 391, 137, slummer34, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 138, slummer34, 50);
    end
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 139, slummer16, 50);
    end
    giq_option(-3, 391, 140, slummer28, 50);
  slummer07: |
    gsay_reply(391, 141);
    giq_option(7, 391, 142, slummer07a, 50);
    giq_option(7, 391, 143, slummer20, 50);
    giq_option(4, 391, 144, slummer33, 50);
    giq_option(4, 391, 145, slummer16, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 146, slummer16, 50);
    end
    giq_option(-3, 391, 147, slummer35, 50);
  slummer07a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer29;
    end
    else begin
      call slummer49;
    end
  slummer08: |
    gsay_reply(391, 148);
    giq_option(7, 391, 149, slummer07a, 50);
    giq_option(7, 391, 150, slummer20, 50);
    giq_option(4, 391, 151, slummer36, 50);
    giq_option(4, 391, 152, slummer37, 50);
    giq_option(4, 391, 153, slummer15, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 154, slummer16, 50);
    end
    giq_option(-3, 391, 155, slummer35, 50);
  slummer09: 'gsay_message(391, 156, 50);

    '
  slummer10: |
    gsay_reply(391, 157);
    giq_option(7, 391, 158, slummer10a, 50);
    giq_option(7, 391, 159, slummer20, 50);
    giq_option(4, 391, 160, slummer36, 50);
    giq_option(4, 391, 161, slummer37, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 162, slummer16, 50);
    end
  slummer10a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer38;
    end
    else begin
      call slummer61;
    end
  slummer11: |
    LASHERKNOWN := 1;
    gsay_message(391, 163, 50);
  slummer12: "[]"
  slummer13: |
    gsay_reply(391, 165);
    giq_option(7, 391, 166, slummer13a, 50);
    giq_option(7, 391, 167, slummer13b, 50);
    giq_option(4, 391, 168, slummer13c, 50);
    giq_option(4, 391, 169, slummer43, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 170, slummercombat, 50);
    end
  slummer13a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call slummer42;
    end
    else begin
      call slummer43;
    end
  slummer13b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20))) then begin
      call slummer39;
    end
    else begin
      call slummer43;
    end
  slummer13c: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer14;
    end
    else begin
      call slummer43;
    end
  slummer14: 'gsay_message(391, 171, 50);

    '
  slummer15: 'gsay_message(391, 172, 50);

    '
  slummer16: |
    gsay_reply(391, 173);
    giq_option(7, 391, 174, slummer44, 50);
    giq_option(4, 391, 175, slummer45, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 176, slummercombat, 50);
    end
  slummer17: |
    gsay_reply(391, 177);
    giq_option(7, 391, 178, slummer17a, 50);
    giq_option(4, 391, 179, slummerend, 50);
    giq_option(4, 391, 180, slummercombat, 50);
  slummer17a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -30))) then begin
      call slummer46;
    end
    else begin
      call slummer49;
    end
  slummer18: 'gsay_message(391, 181, 50);

    '
  slummer19: |
    gsay_reply(391, 182);
    giq_option(7, 391, 183, slummer19a, 50);
    giq_option(7, 391, 184, slummer47, 50);
    giq_option(4, 391, 185, slummer44, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 186, slummer44, 50);
    end
  slummer19a: 'call slummer49;

    '
  slummer20: |
    set_global_var(196, 1);
    gsay_reply(391, 187);
    giq_option(7, 391, 188, slummer47, 50);
    giq_option(4, 391, 189, slummer44, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 190, slummer44, 50);
    end
  slummer21: |
    gsay_reply(391, 191);
    giq_option(7, 391, 192, slummer21a, 50);
    giq_option(7, 391, 193, slummer11, 50);
    giq_option(4, 391, 194, slummer20, 50);
    giq_option(4, 391, 195, slummer15, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 196, slummer16, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 197, slummercombat, 50);
    end
  slummer21a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer25;
    end
    else begin
      call slummer49;
    end
  slummer22: |
    LASHERKNOWN := 1;
    gsay_reply(391, 198);
    giq_option(7, 391, 199, slummer50, 50);
    giq_option(7, 391, 200, slummer49, 50);
    giq_option(4, 391, 201, slummer33, 50);
    giq_option(4, 391, 202, slummer20, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 203, slummer16, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 204, slummer44, 50);
    end
  slummer23: 'gsay_message(391, 205, 50);

    '
  slummer24: |
    set_global_var(196, 1);
    gsay_message(391, 206, 50);
  slummer25: |
    gsay_reply(391, 207);
    giq_option(7, 391, 208, slummer25a, 50);
    giq_option(7, 391, 209, slummer52, 50);
    giq_option(4, 391, 210, slummer33, 50);
    giq_option(4, 391, 211, slummer54, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 212, slummer16, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 213, slummer24, 50);
    end
  slummer25a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer51;
    end
    else begin
      call slummer49;
    end
  slummer26: |
    gsay_reply(391, 214);
    giq_option(7, 391, 215, slummer26a, 50);
    giq_option(7, 391, 216, slummer33, 50);
    giq_option(4, 391, 217, slummer55, 50);
    giq_option(4, 391, 218, slummer54, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 219, slummer24, 50);
    end
  slummer26a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer51;
    end
    else begin
      call slummer49;
    end
  slummer27: |
    gsay_reply(391, 220);
    giq_option(7, 391, 221, slummer56, 50);
    giq_option(4, 391, 222, slummer44, 50);
    giq_option(4, 391, 223, slummer57, 50);
    giq_option(4, 391, 224, slummer54, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 225, slummer16, 50);
    end
  slummer28: |
    gsay_reply(391, 226);
    giq_option(-3, 391, 227, slummer44, 50);
    giq_option(-3, 391, 228, slummer49, 50);
  slummer29: |
    gsay_reply(391, 229);
    giq_option(7, 391, 230, slummer58, 50);
    giq_option(7, 391, 231, slummer59, 50);
    giq_option(4, 391, 232, slummer01, 50);
    giq_option(4, 391, 233, slummer44, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 234, slummercombat, 50);
    end
  slummer30: 'gsay_message(391, 235, 50);

    '
  slummer31: |
    gsay_reply(391, 236);
    giq_option(7, 391, 237, slummer52, 50);
    giq_option(7, 391, 238, slummer44, 50);
    giq_option(4, 391, 239, slummer18, 50);
    giq_option(4, 391, 240, slummer20, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 241, slummer24, 50);
    end
  slummer32: |
    set_global_var(196, 1);
    LASHERKNOWN := 1;
    gsay_message(391, 242, 50);
  slummer33: |
    set_global_var(196, 1);
    gsay_reply(391, 243);
    giq_option(7, 391, 244, slummer47, 50);
    giq_option(4, 391, 245, slummer44, 50);
    giq_option(4, 391, 246, slummer45, 50);
  slummer34: |
    gsay_reply(391, 247);
    giq_option(7, 391, 248, slummer43, 50);
    giq_option(4, 391, 249, slummer60, 50);
    giq_option(4, 391, 250, slummer43, 50);
    giq_option(4, 391, 251, slummercombat, 50);
  slummer35: 'gsay_message(391, 252, 50);

    '
  slummer36: |
    gsay_reply(391, 253);
    giq_option(4, 391, 254, slummer18, 50);
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      giq_option(7, 391, 255, slummer36a, 50);
      giq_option(4, 391, 256, slummer52, 50);
    end
    else begin
      giq_option(7, 391, 257, slummer36b, 50);
      giq_option(4, 391, 258, slummer20, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 259, slummer24, 50);
    end
  slummer36a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer29;
    end
    else begin
      call slummer49;
    end
  slummer36b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer26;
    end
    else begin
      call slummer49;
    end
  slummer37: 'gsay_message(391, 260, 50);

    '
  slummer38a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer52;
    end
    else begin
      call slummer52;
    end
  slummer38: |
    gsay_reply(391, 261);
    giq_option(7, 391, 262, slummer38a, 50);
    giq_option(4, 391, 263, slummer01, 50);
    giq_option(4, 391, 264, slummer44, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 265, slummercombat, 50);
    end
  slummer39: 'gsay_message(391, 266, 50);

    '
  slummer40: 'gsay_message(391, 267, 50);

    '
  slummer41: |
    set_global_var(196, 1);
    gsay_message(391, 268, 50);
  slummer42: |
    gsay_reply(391, 269);
    giq_option(4, 391, 270, slummer44, 50);
    giq_option(4, 391, 271, slummer50, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 272, slummer49, 50);
    end
    giq_option(-3, 391, 273, slummer48, 50);
  slummer43: |
    gsay_message(391, 274, 51);
    call slummercombat;
  slummer44: 'gsay_message(391, 275, 50);

    '
  slummer45: 'gsay_message(391, 276, 50);

    '
  slummer46: |
    gsay_reply(391, 277);
    giq_option(7, 391, 278, slummer61, 50);
    giq_option(4, 391, 279, slummer41, 50);
    giq_option(4, 391, 280, slummer44, 50);
    giq_option(4, 391, 281, slummer44, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 282, slummer44, 50);
    end
  slummer47: 'gsay_message(391, 283, 50);

    '
  slummer48: 'gsay_message(391, 284, 50);

    '
  slummer49: 'gsay_message(391, 285, 50);

    '
  slummer50: 'gsay_message(391, 286, 50);

    '
  slummer51: |
    gsay_reply(391, 287);
    giq_option(7, 391, 288, slummer51a, 50);
    giq_option(7, 391, 289, slummer63, 50);
    giq_option(4, 391, 290, slummer64, 50);
    giq_option(4, 391, 291, slummer54, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 292, slummer24, 50);
    end
  slummer51a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer62;
    end
    else begin
      call slummer49;
    end
  slummer52: |
    gsay_reply(391, 293);
    giq_option(7, 391, 294, slummer52a, 50);
    giq_option(7, 391, 295, slummer53, 50);
    giq_option(4, 391, 296, slummer41, 50);
    giq_option(4, 391, 297, slummer44, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 298, slummercombat, 50);
    end
  slummer52a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer65;
    end
    else begin
      call slummer49;
    end
  slummer53: |
    set_global_var(196, 1);
    gsay_message(391, 299, 50);
  slummer54: |
    gsay_reply(391, 300);
    giq_option(7, 391, 301, slummer54a, 50);
    giq_option(4, 391, 302, slummer44, 50);
    giq_option(4, 391, 303, slummer44, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 304, slummer16, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 305, slummercombat, 50);
    end
  slummer54a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer51;
    end
    else begin
      call slummer49;
    end
  slummer55: |
    gsay_reply(391, 306);
    giq_option(7, 391, 307, slummer66, 50);
    giq_option(7, 391, 308, slummer66, 50);
    giq_option(4, 391, 309, slummer44, 50);
    giq_option(4, 391, 310, slummer41, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 311, slummer16, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 312, slummercombat, 50);
    end
  slummer56: |
    gsay_reply(391, 313);
    giq_option(7, 391, 314, slummer33, 50);
    giq_option(7, 391, 315, slummer54, 50);
    giq_option(4, 391, 316, slummer41, 50);
    giq_option(4, 391, 317, slummer44, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 318, slummer16, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 319, slummer45, 50);
    end
  slummer57: 'gsay_message(391, 320, 50);

    '
  slummer58: 'gsay_message(391, 321, 50);

    '
  slummer59: 'gsay_message(391, 322, 50);

    '
  slummer60: |
    gsay_reply(391, 323);
    giq_option(4, 391, 324, slummerdone, 50);
    giq_option(4, 391, 325, slummer40, 50);
    giq_option(4, 391, 326, slummercombat, 50);
  slummer61: 'gsay_message(391, 327, 50);

    '
  slummer62: |
    gsay_reply(391, 328);
    giq_option(7, 391, 329, slummer58, 50);
    giq_option(7, 391, 330, slummer59, 50);
    giq_option(4, 391, 331, slummer01, 50);
    giq_option(4, 391, 332, slummer44, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 333, slummercombat, 50);
    end
  slummer63: |
    gsay_reply(391, 334);
    giq_option(7, 391, 335, slummer67, 50);
    giq_option(4, 391, 336, slummer41, 50);
    giq_option(4, 391, 337, slummer44, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 338, slummer16, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 339, slummer35, 50);
    end
  slummer64: 'gsay_message(391, 340, 50);

    '
  slummer65: |
    gsay_reply(391, 341);
    giq_option(7, 391, 342, slummer65a, 50);
    giq_option(4, 391, 343, slummer41, 50);
    giq_option(4, 391, 344, slummer44, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 391, 345, slummer16, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 391, 346, slummer35, 50);
    end
  slummer65a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call slummer49;
    end
    else begin
      call slummer49;
    end
  slummer66: 'gsay_message(391, 347, 50);

    '
  slummer67: 'gsay_message(391, 348, 50);

    '
  slummerdone: 'gsay_option(391, 349, slummerend, 50);

    '
  slummerend: "[]"
  slummercombat: |
    set_global_var(195, 1);
    hostile := 1;
  weapon_check: |
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      armed := 1;
    end
    else begin
      armed := 0;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
smell:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if (local_var(0) != 1) then begin
          if (is_success(do_check(dude_obj, 1, 0))) then begin
            display_msg(message_str(97, 100));
          end
          set_local_var(0, 1);
        end
      end
    end
smitty:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(250, 100));
    end
    else begin
      display_msg(message_str(250, 101));
    end
  talk_p_proc: |
    if (global_var(251) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      if ((local_var(4) == 1) and (get_critter_stat(dude_obj, 4) < 4)) then begin
        float_msg(self_obj, message_str(250, 117), 0);
      end
      else begin
        if (local_var(5) == 2) then begin
          float_msg(self_obj, message_str(250, 131), 0);
        end
        else begin
          call get_reaction;
          start_gdialog(250, self_obj, -1, -1, -1);
          gsay_start;
          if (global_var(138) == 9303) then begin
            call Smitty11;
          end
          else begin
            if (global_var(138) == 9304) then begin
              if (local_var(5) == 0) then begin
                call Smitty12;
              end
              else begin
                if (local_var(5) == 9307) then begin
                  if (obj_is_carrying_obj_pid(dude_obj, 15)) then begin
                    call Smitty14;
                  end
                  else begin
                    call Smitty15;
                  end
                end
              end
            end
            else begin
              if (local_var(1) < 2) then begin
                DisplayMessage := 103;
                call Smitty01;
              end
              else begin
                DisplayMessage := 102;
                call Smitty01;
              end
            end
          end
          gsay_end;
          end_dialogue;
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(251, 1);
      critter_add_trait(self_obj, 1, 6, 49);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(251, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
      critter_add_trait(self_obj, 1, 6, 49);
    end
  pickup_p_proc: 'set_global_var(251, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      if (not(metarule(22, 0)) and (obj_is_carrying_obj_pid(self_obj, 41) == 0)) then begin
        item_caps_adjust(self_obj, random(500, 750));
      end
      if ((global_var(613) == 9103) or (global_var(613) == 9102)) then begin
        critter_add_trait(self_obj, 1, 6, 0);
      end
      else begin
        critter_add_trait(self_obj, 1, 6, 49);
      end
      critter_add_trait(self_obj, 1, 5, 6);
      Initialize := 0;
    end
  Smitty01: |
    gsay_reply(250, DisplayMessage);
    DisplayMessage := 112;
    if (local_var(4) == 0) then begin
      giq_option(4, 250, 104, Smitty03, 50);
    end
    if ((global_var(138) < 9303) and (global_var(138) > 2)) then begin
      giq_option(4, 250, 105, Smitty10, 50);
    end
    giq_option(4, 250, 106, Smitty02, 50);
    giq_option(4, 250, 107, Smitty04, 50);
    giq_option(4, 250, 108, Smitty06, 50);
    giq_option(-3, 250, 109, Smitty05, 50);
  Smitty02: |
    DisplayMessage := 110;
    call Smitty01;
  Smitty03: |
    set_local_var(4, 1);
    DisplayMessage := 111;
    call Smitty01;
  Smitty04: |
    gsay_reply(250, DisplayMessage);
    gsay_option(250, 113, Smitty07, 50);
    gsay_option(250, 114, Smitty08, 50);
    gsay_option(250, 115, Smitty09, 50);
    gsay_option(250, 116, Smitty06, 50);
  Smitty05: |
    set_local_var(4, 1);
    gsay_message(250, 117, 50);
  Smitty06: 'gsay_message(250, 118, 50);

    '
  Smitty07: |
    DisplayMessage := 119;
    call Smitty04;
  Smitty08: |
    DisplayMessage := 120;
    call Smitty04;
  Smitty09: |
    DisplayMessage := 121;
    call Smitty04;
  Smitty10: |
    gsay_message(250, 122, 50);
    gfade_out(600);
    game_time_advance(10 * 60 * 60);
    gfade_in(600);
    set_global_var(138, 9303);
    gsay_message(250, 123, 50);
  Smitty11: 'gsay_message(250, 124, 50);

    '
  Smitty12: |
    gsay_message(250, 125, 50);
    set_local_var(5, 9307);
    if (obj_is_carrying_obj_pid(dude_obj, 15)) then begin
      call Smitty14;
    end
  Smitty14: |
    gsay_reply(250, 127);
    gsay_option(250, 126, Smitty14a, 50);
  Smitty14a: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    gsay_message(250, 128, 50);
    LVar1 := obj_carrying_pid_obj(dude_obj, 15);
    rm_obj_from_inven(dude_obj, LVar1);
    destroy_object(LVar1);
    gfade_out(600);
    game_time_advance(10 * 60 * 60 * 2);
    gfade_in(600);
    gsay_message(250, 129, 50);
    LVar0 := create_object_sid(233, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    set_local_var(5, 2);
  Smitty15: 'gsay_message(250, 130, 50);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
smone:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 48);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 22) then begin
            if (hostile < 1) then begin
              lesson_ptr := lesson_ptr + 1;
              set_local_var(1, lesson_ptr);
              call goto00;
            end
          end
          else begin
            if (script_action == 12) then begin
              call critter_p_proc;
            end
            else begin
              if (script_action == 18) then begin
                call destroy_p_proc;
              end
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    my_tile := tile_num(self_obj);
    if (my_tile == 12098) then begin
      move_to(self_obj, 7000, 0);
    end
    else begin
      if (tile_distance(my_tile, tile_num(dude_obj)) < 12) then begin
        if (local_var(2) != 1) then begin
          set_local_var(2, 1);
          lesson_ptr := 0;
          add_timer_event(self_obj, game_ticks(1), 0);
        end
      end
    end
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      call zamin;
      if ((ARMED == 1) or (DISGUISED == 0)) then begin
        call combat;
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call zamin;
    if ((ARMED == 1) or (DISGUISED == 0)) then begin
      call combat;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: 'script_overrides;

    '
  zamin: |
    DISGUISED := 0;
    ARMED := 0;
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      ARMED := 1;
    end
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      if (metarule(16, 0) > 1) then begin
        DISGUISED := 0;
      end
      else begin
        DISGUISED := 1;
      end
    end
  goto00: |
    PICK := lesson_ptr;
    if (PICK == 1) then begin
      float_msg(self_obj, message_str(694, 101), 2);
    end
    else begin
      if (PICK == 2) then begin
        float_msg(patient, message_str(694, 102), 8);
      end
      else begin
        if (PICK == 3) then begin
          float_msg(self_obj, message_str(694, 103), 2);
        end
        else begin
          if (PICK == 4) then begin
            call goto01;
          end
          else begin
            if (PICK == 5) then begin
              call goto02;
            end
            else begin
              if (PICK == 6) then begin
                float_msg(patient, message_str(694, 108), 8);
              end
              else begin
                if (PICK == 7) then begin
                  float_msg(self_obj, message_str(694, 109), 2);
                end
                else begin
                  if (PICK == 8) then begin
                    float_msg(patient, message_str(694, 110), 8);
                  end
                  else begin
                    if (PICK == 9) then begin
                      call goto03;
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    add_timer_event(self_obj, game_ticks(3), 1);
  goto01: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      float_msg(patient, message_str(694, 104), 8);
    end
    else begin
      float_msg(patient, message_str(694, 105), 8);
    end
  goto02: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      float_msg(self_obj, message_str(694, 106), 2);
    end
    else begin
      float_msg(self_obj, message_str(694, 107), 2);
    end
  goto03: |
    lets_go := 1;
    animate_move_obj_to_tile(self_obj, 12098, 0);
smpray:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 47);
    end
    else begin
      if (script_action == 14) then begin
        if (global_var(245) == 0) then begin
          set_global_var(245, 1);
        end
      end
      else begin
        if (script_action == 21) then begin
          call look_at_p_proc;
        end
        else begin
          if (script_action == 4) then begin
            call pickup_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
            else begin
              if (script_action == 12) then begin
                call critter_p_proc;
              end
              else begin
                if (script_action == 18) then begin
                  call destroy_p_proc;
                end
              end
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call zamin;
    if (DISGUISED == 1) then begin
      if (ARMED == 0) then begin
        call goto00;
      end
      if (ARMED == 1) then begin
        call goto01;
      end
    end
    else begin
      call goto01;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: 'script_overrides;

    '
  zamin: |
    DISGUISED := 0;
    ARMED := 0;
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      ARMED := 1;
    end
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      if (metarule(16, 0) > 1) then begin
        DISGUISED := 0;
      end
      else begin
        DISGUISED := 1;
      end
    end
  goto00: 'float_msg(self_obj, message_str(711, random(101, 103)), 2);

    '
  goto01: |
    float_msg(self_obj, message_str(711, 104), 2);
    call combat;
sophia:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 63);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(319, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4)) then begin
      if (local_var(1) < 2) then begin
        call goto20;
      end
      else begin
        call goto16;
      end
    end
    else begin
      set_local_var(4, 1);
      if (map_var(0) == 1) then begin
        call goto14;
      end
      else begin
        call goto00;
      end
    end
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(319, 100));
  goto00: |
    gsay_reply(319, 301);
    giq_option(-3, 319, 302, goto01, 50);
    giq_option(4, 319, 303, goto02, 50);
    giq_option(4, 319, 304, goto03, 50);
    giq_option(4, 319, 305, goto02, 50);
    giq_option(4, 319, 306, anger, 51);
  goto01: 'gsay_message(319, 307, 51);

    '
  goto02: |
    gsay_reply(319, 308);
    if (global_var(30) != 1) then begin
      giq_option(4, 319, 309, goto04, 50);
    end
    giq_option(4, 319, 310, goto05, 50);
    giq_option(4, 319, 311, goto06, 50);
    giq_option(4, 319, 312, gotoend, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 319, 313, anger, 51);
    end
  goto03: |
    gsay_reply(319, 314);
    giq_option(4, 319, 315, gotoend, 50);
    giq_option(4, 319, 316, goto07, 50);
  goto04: |
    gsay_reply(319, 317);
    giq_option(4, 319, 318, goto07, 50);
    giq_option(4, 319, 319, goto06, 50);
    giq_option(4, 319, 320, anger, 51);
    giq_option(4, 319, 321, gotoend, 50);
  goto05: |
    gsay_reply(319, 322);
    giq_option(4, 319, 323, gotoend, 50);
    giq_option(4, 319, 324, goto08, 50);
    giq_option(4, 319, 325, goto09, 50);
  goto06: |
    gsay_reply(319, 326);
    giq_option(4, 319, 327, goto11, 50);
    giq_option(4, 319, 328, goto11, 50);
    if (local_var(6) != 1) then begin
      giq_option(4, 319, 329, goto12, 50);
    end
    giq_option(4, 319, 330, goto07, 50);
  goto07: |
    gsay_reply(319, 331);
    if (local_var(6) != 1) then begin
      giq_option(4, 319, 332, goto12, 50);
    end
    giq_option(4, 319, 333, goto09, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 319, 334, goto01, 51);
    end
    giq_option(4, 319, 335, goto05, 50);
  goto08: 'gsay_message(319, 336, 50);

    '
  goto09: |
    gsay_reply(319, 337);
    if (local_var(6) != 1) then begin
      giq_option(4, 319, 338, goto12, 49);
    end
    giq_option(4, 319, 339, DownReact, 51);
    giq_option(4, 319, 341, goto01, 51);
    giq_option(4, 319, 342, goto10, 50);
  goto10: 'gsay_message(319, 343, 50);

    '
  goto11: |
    gsay_reply(319, 344);
    giq_option(4, 319, 345, gotoend, 50);
    giq_option(4, 319, 346, goto13, 50);
    giq_option(4, 319, 347, DownReact, 51);
  goto12: |
    set_local_var(6, 1);
    item := create_object_sid(215, 0, 0, -1);
    add_obj_to_inven(dude_obj, item);
    gsay_reply(319, 348);
    giq_option(4, 319, 349, gotoend, 50);
    giq_option(4, 319, 350, DownReact, 51);
  goto13: |
    gsay_reply(319, 351);
    if (local_var(6) != 1) then begin
      giq_option(4, 319, 352, goto12, 49);
    end
    giq_option(4, 319, 349, gotoend, 50);
    giq_option(4, 319, 353, anger, 51);
  goto14: |
    gsay_reply(319, 301);
    giq_option(-3, 319, 302, goto01, 50);
    giq_option(4, 319, 303, goto02, 50);
    giq_option(4, 319, 330, goto15, 50);
    giq_option(4, 319, 306, anger, 51);
  goto15: |
    gsay_reply(319, 359);
    giq_option(4, 319, 360, goto07, 50);
    giq_option(4, 319, 361, anger, 51);
    giq_option(4, 319, 362, DownReact, 51);
  goto16: |
    gsay_reply(319, 364);
    giq_option(4, 319, 365, goto17, 50);
    giq_option(4, 319, 366, goto16b, 50);
    giq_option(4, 319, 367, gotoend, 50);
    giq_option(-3, 319, 302, goto01, 50);
  goto16b: |
    if (local_var(6) != 1) then begin
      call goto12;
    end
    else begin
      call goto18;
    end
  goto17: |
    gsay_reply(319, 368);
    giq_option(4, 319, 369, gotoend, 50);
    giq_option(4, 319, 316, goto07, 50);
  goto18: |
    gsay_reply(319, 374);
    giq_option(4, 319, 369, gotoend, 50);
    giq_option(4, 319, 350, DownReact, 51);
  goto19: |
    gsay_reply(319, 374);
    giq_option(4, 319, 369, gotoend, 50);
    giq_option(4, 319, 350, DownReact, 51);
  goto20: |
    gsay_reply(319, 377);
    giq_option(4, 319, 378, gotoend, 50);
    giq_option(4, 319, 379, goto20b, 49);
    giq_option(-3, 319, 302, goto01, 50);
  goto20b: |
    if (is_success(roll_vs_skill(dude_obj, 14, -10))) then begin
      call goto21;
    end
    else begin
      call goto01;
    end
  goto21: |
    call UpReact;
    gsay_reply(319, 380);
    giq_option(4, 319, 381, goto17, 50);
    giq_option(4, 319, 382, goto16b, 50);
    giq_option(4, 319, 383, gotoend, 50);
  anger: |
    call DownReact;
    call goto01;
  gotoend: "[]"
  gotostory: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
ssguide:
  start: |
    if (Initialize == 1) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 23);
      Initialize := 0;
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(211, 100));
  talk_p_proc: |
    if (global_var(246) == 1) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      call get_reaction;
      start_gdialog(211, self_obj, -1, -1, -1);
      gsay_start;
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
        call DialogWeapon;
      end
      else begin
        if (local_var(4) == 0) then begin
          set_local_var(4, 1);
          call DialogFirstTime;
        end
        else begin
          call DialogSubsequent;
        end
      end
      gsay_end;
      end_dialogue;
      Hurt := 0;
      Equipment := 0;
      Barter := 0;
      Bartered := 0;
      Place := 0;
      World := 0;
      Yourself := 0;
      Vault := 0;
      Vaulted := 0;
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(246) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  pickup_p_proc: |
    if (local_var(6) == 0) then begin
      float_msg(self_obj, message_str(211, 151), 2);
      set_local_var(6, 1);
    end
    else begin
      set_global_var(246, 1);
    end
  DialogWeapon: |
    gsay_reply(211, 101);
    giq_option(-3, 211, 102, DialogWeapon1, 50);
    giq_option(4, 211, 103, DialogWeapon2, 50);
    giq_option(4, 211, 104, DialogWeapon3, 50);
    giq_option(4, 211, 105, DialogWeapon4, 50);
  DialogFirstTime: |
    gsay_reply(211, 111);
    DisplayMessage := 125;
    giq_option(-3, 211, 112, DialogSpecial1, 50);
    giq_option(4, 211, 113, DialogMain5, 50);
    giq_option(4, 211, 114, DialogMain, 50);
    giq_option(5, 211, 115, DialogMain8, 50);
    if (global_var(26) == 1) then begin
      giq_option(4, 211, 116, DialogMain9, 50);
    end
    if (global_var(43) == 1) then begin
      giq_option(4, 211, 117, DialogMain10, 50);
    end
    giq_option(4, 211, 118, DialogExit, 50);
  DialogSubsequent: |
    variable LVar0 := 0;
    LVar0 := game_time_hour;
    gsay_reply(211, 144);
    DisplayMessage := 125;
    giq_option(-3, 211, 112, DialogSpecial1, 50);
    if ((LVar0 > 1800) or (LVar0 < 800)) then begin
      giq_option(4, 211, 145, DialogSpecial4, 50);
    end
    else begin
      giq_option(4, 211, 113, DialogMain5, 50);
    end
    giq_option(4, 211, 114, DialogMain, 50);
    giq_option(5, 211, 115, DialogMain8, 50);
    if (global_var(26) == 1) then begin
      giq_option(4, 211, 116, DialogMain9, 50);
    end
    if (global_var(43) == 1) then begin
      giq_option(4, 211, 117, DialogMain10, 50);
    end
    giq_option(4, 211, 118, DialogExit, 50);
  DialogExit: "[]"
  DialogWeapon1: 'gsay_message(211, 106, 50);

    '
  DialogWeapon2: |
    gsay_reply(211, 107);
    giq_option(4, 211, 108, DialogExit, 50);
  DialogWeapon3: |
    gsay_reply(211, 109);
    giq_option(4, 211, 110, DialogExit, 50);
  DialogWeapon4: |
    gsay_reply(211, 109);
    giq_option(4, 211, 110, DialogExit, 50);
  DialogMain: |
    gsay_reply(211, DisplayMessage);
    if (Hurt == 0) then begin
      giq_option(4, 211, 126, DialogMain1, 50);
    end
    if (Equipment == 0) then begin
      giq_option(4, 211, 127, DialogMain2, 50);
    end
    else begin
      if (Barter == 1) then begin
        giq_option(4, 211, 134, DialogMain6, 50);
      end
    end
    if (Place == 0) then begin
      giq_option(4, 211, 128, DialogMain3, 50);
    end
    if (World == 0) then begin
      giq_option(4, 211, 129, DialogMain4, 50);
    end
    if (Yourself == 0) then begin
      giq_option(4, 211, 130, DialogMain5, 50);
    end
    else begin
      if (Vault == 1) then begin
        giq_option(4, 211, 138, DialogMain7, 50);
      end
    end
    giq_option(4, 211, 131, DialogExit, 50);
    if ((local_var(5) == 0) and ((Hurt == 1) and (Equipment == 1) and (Place == 1) and (World == 1) and (Yourself == 1) and (Bartered == 1) and (Vaulted == 1))) then begin
      set_local_var(5, 1);
      give_exp_points(250);
      display_msg(message_str(211, 150));
    end
  DialogMain1: |
    Hurt := 1;
    DisplayMessage := 132;
    call DialogMain;
  DialogMain2: |
    Equipment := 1;
    DisplayMessage := 133;
    Barter := 1;
    call DialogMain;
  DialogMain3: |
    Place := 1;
    DisplayMessage := 135;
    call DialogMain;
  DialogMain4: |
    World := 1;
    DisplayMessage := 136;
    call DialogMain;
  DialogMain5: |
    Yourself := 1;
    DisplayMessage := 137;
    Vault := 1;
    call DialogMain;
  DialogMain6: |
    Barter := 0;
    DisplayMessage := 139;
    Bartered := 1;
    call DialogMain;
  DialogMain7: |
    Vault := 0;
    DisplayMessage := 140;
    Vaulted := 1;
    call DialogMain;
  DialogMain8: |
    DisplayMessage := 143;
    call DialogMain;
  DialogMain9: |
    DisplayMessage := 141;
    call DialogMain;
  DialogMain10: |
    DisplayMessage := 142;
    call DialogMain;
  DialogSpecial1: |
    gsay_reply(211, 119);
    giq_option(-3, 211, 120, DialogSpecial2, 50);
  DialogSpecial2: |
    gsay_reply(211, 121);
    giq_option(-3, 211, 122, DialogSpecial3, 50);
  DialogSpecial3: |
    gsay_reply(211, 123);
    giq_option(-3, 211, 124, DialogExit, 50);
  DialogSpecial4: |
    gsay_reply(211, 146);
    giq_option(4, 211, 147, DialogExit, 50);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
ssradsco:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 5, 14);
      critter_add_trait(self_obj, 1, 6, 5);
    end
  combat_p_proc: |
    if (fixed_param == 2) then begin
      if (not(is_success(do_check(dude_obj, 6, -1)))) then begin
        rndx := random(1, 6);
        poison(target_obj, rndx);
      end
    end
  critter_p_proc: |
    if ((random(1, 10) == 1) and (Start_Moving == 0)) then begin
      Start_Moving := 1;
      add_timer_event(self_obj, game_ticks(5), 1);
    end
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      hostile := 1;
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    set_global_var(2, global_var(2) - 1);
    if (global_var(2) <= 0) then begin
      set_global_var(2, 0);
      set_global_var(28, 2);
      set_global_var(43, 2);
      give_exp_points(500);
      display_msg(message_str(517, 100));
      set_global_var(155, global_var(155) + 6);
    end
  timed_event_p_proc: |
    variable LVar0 := 0;
    if (Start_Moving == 1) then begin
      LVar0 := tile_num_in_direction(tile_num(self_obj), random(0, 5), 3);
      Start_Moving := 0;
      reg_anim_func(2, self_obj);
      reg_anim_func(1, 1);
      reg_anim_obj_move_to_tile(self_obj, LVar0, -1);
      reg_anim_func(3, 0);
    end
sswell:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(14, 100));
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 127) then begin
      script_overrides;
      display_msg(message_str(14, 101));
    end
    else begin
      if (obj_pid(obj_being_used_with) == 41) then begin
        script_overrides;
        display_msg(message_str(14, 103));
        item_caps_adjust(dude_obj, -1);
      end
    end
  use_skill_on_p_proc: |
    if (action_being_used == 12) then begin
      script_overrides;
      display_msg(message_str(14, 102));
    end
staple:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(862, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    variable LVar0 := 0;
    call Get_Stuff;
    call get_reaction;
    gdialog_set_barter_mod(-50);
    if (((game_time / 10) - local_var(7)) > (60 * 60 * 24 * 3)) then begin
      set_local_var(7, game_time / 10);
      set_local_var(8, 500);
      LVar0 := item_caps_adjust(self_obj, local_var(8));
    end
    else begin
      LVar0 := item_caps_adjust(self_obj, local_var(8));
    end
    if (local_var(4) == 0) then begin
      set_local_var(4, 1);
      start_gdialog(862, self_obj, 4, -1, -1);
      gsay_start;
      call Staple00;
      gsay_end;
      end_dialogue;
    end
    else begin
      if (local_var(6) == 1) then begin
        call Staple13;
      end
      else begin
        start_gdialog(862, self_obj, 4, -1, -1);
        gsay_start;
        call Staple01;
        gsay_end;
        end_dialogue;
      end
    end
    set_local_var(8, item_caps_total(self_obj));
    LVar0 := item_caps_adjust(self_obj, -1 * local_var(8));
    call Put_Stuff;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 70);
      critter_add_trait(self_obj, 1, 5, 50);
    end
  Staple00: |
    gsay_reply(862, 102);
    call Staple02;
  Staple01: |
    gsay_reply(862, 103);
    call Staple02;
  Staple02: |
    giq_option(4, 862, 104, Staple03, 50);
    if ((global_var(101) != 2) and (local_var(5) == 0)) then begin
      giq_option(4, 862, 105, Staple04, 50);
    end
    if (global_var(615) == 1) then begin
      giq_option(4, 862, 130, Staple15, 50);
    end
    giq_option(4, 862, 106, StapleEnd, 50);
    giq_option(-3, 862, 125, Staple14, 50);
  Staple03: |
    gsay_message(862, 107, 50);
    gdialog_mod_barter(-50);
    gsay_reply(862, 127);
    giq_option(4, 862, 128, StapleEnd, 50);
    giq_option(-3, 862, 129, StapleEnd, 50);
  Staple04: |
    gsay_reply(862, 108);
    giq_option(4, 862, 109, Staple05, 50);
    giq_option(4, 862, 110, Staple06, 50);
  Staple05: |
    gsay_reply(862, 111);
    giq_option(4, 862, 112, Staple06, 50);
  Staple06: |
    gsay_reply(862, 113);
    giq_option(4, 862, 114, Staple06a, 50);
    giq_option(4, 862, 115, Staple06b, 50);
    giq_option(4, 862, 116, Staple06c, 50);
    giq_option(4, 862, 117, StapleEnd, 50);
  Staple06a: |
    if (item_caps_total(dude_obj) >= 750) then begin
      call Staple09;
    end
    else begin
      call Staple07;
    end
  Staple06b: |
    if (is_success(do_check(dude_obj, 3, 0)) or is_success(roll_vs_skill(dude_obj, 15, 0))) then begin
      if (item_caps_total(dude_obj) >= 500) then begin
        call Staple10;
      end
      else begin
        call Staple07;
      end
    end
    else begin
      call Staple07;
    end
  Staple06c: |
    if (is_success(do_check(dude_obj, 0, 0))) then begin
      call Staple11;
    end
    else begin
      call Staple08;
    end
  Staple07: 'gsay_message(862, 118, 50);

    '
  Staple08: |
    set_local_var(6, 1);
    gsay_message(862, 119, 51);
  Staple09: |
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, -750);
    gsay_message(862, 120, 50);
    call Staple12;
  Staple10: |
    variable LVar0 := 0;
    LVar0 := item_caps_adjust(dude_obj, -500);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(862, 121, 50);
    end
    else begin
      gsay_message(862, 121, 50);
    end
    call Staple12;
  Staple11: |
    set_local_var(6, 1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(862, 122, 51);
    end
    else begin
      gsay_message(862, 122, 51);
    end
    call Staple12;
  Staple12: |
    variable LVar0 := 0;
    set_local_var(5, 1);
    LVar0 := create_object_sid(230, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gsay_message(862, 123, 50);
  Staple13: 'float_msg(self_obj, message_str(862, 124), 2);

    '
  Staple14: 'gsay_message(862, 126, 50);

    '
  Staple15: |
    gsay_reply(862, 131);
    giq_option(4, 862, 114, Staple15a, 50);
    giq_option(4, 862, 117, StapleEnd, 50);
  Staple15a: |
    if (item_caps_total(dude_obj) >= 750) then begin
      call Staple16;
    end
    else begin
      call Staple17;
    end
  Staple16: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := item_caps_adjust(dude_obj, -750);
    set_global_var(615, 2);
    LVar1 := create_object_sid(237, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar1);
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(862, 132, 50);
    end
    else begin
      gsay_message(862, 1132, 50);
    end
  Staple17: 'gsay_message(862, 133, 50);

    '
  StapleEnd: "[]"
  Get_Stuff: 'move_obj_inven_to_obj(Staple_Box_Ptr, self_obj);

    '
  Put_Stuff: 'move_obj_inven_to_obj(self_obj, Staple_Box_Ptr);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
storerom:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if (local_var(0) != 1) then begin
          display_msg(message_str(99, 100));
          set_local_var(0, 1);
        end
      end
    end
super:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      init_teams := 1;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if (script_action == 4) then begin
        Hostile := 1;
      end
      else begin
        if (script_action == 12) then begin
          if (Hostile) then begin
            Hostile := 0;
            attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
          end
          else begin
            if (global_var(13) == 0) then begin
              set_obj_visibility(self_obj, 1);
            end
            else begin
              if ((game_time_hour >= 1900) or (game_time_hour < 600) and (tile_num(self_obj) != 24929)) then begin
                animate_move_obj_to_tile(self_obj, 24929, 0);
              end
              if ((game_time_hour >= 700) and (game_time_hour < 1800) and (tile_num(self_obj) != 25915)) then begin
                animate_move_obj_to_tile(self_obj, 25915, 0);
              end
            end
          end
        end
        else begin
          if (script_action == 18) then begin
            set_global_var(35, global_var(35) + 1);
            if (source_obj == dude_obj) then begin
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                set_global_var(156, 1);
                set_global_var(157, 0);
              end
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                set_global_var(157, 1);
                set_global_var(156, 0);
              end
              set_global_var(160, global_var(160) + 1);
              if ((global_var(160) % 6) == 0) then begin
                set_global_var(155, global_var(155) + 1);
              end
            end
          end
          else begin
            if (script_action == 21) then begin
              display_msg(message_str(100, 100));
            end
          end
        end
      end
    end
  do_dialogue: |
    start_gdialog(100, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(0)) then begin
      call super00;
    end
    else begin
      set_local_var(0, 1);
      call super00;
    end
    gsay_end;
    end_dialogue;
  supercbt: 'Hostile := 1;

    '
  superx: 'call supercbt;

    '
  super00: |
    gsay_reply(100, 101);
    giq_option(3, 100, 102, superx, 50);
    giq_option(3, 100, 103, supercbt, 50);
    giq_option(-3, 100, 104, supercbt, 50);
talius:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  description_p_proc: |
    if (is_success(do_check(dude_obj, 1, has_trait(0, dude_obj, 0)))) then begin
      display_msg(message_str(274, 231));
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(4)) then begin
      display_msg(message_str(274, 100));
    end
    else begin
      display_msg(message_str(274, 230));
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    script_overrides;
    if (global_var(133) == 2) then begin
      call Talius41;
    end
    else begin
      if (global_var(133) == 1) then begin
        call Talius40;
      end
      else begin
        if ((game_time_hour < 600) or (game_time_hour > 1800)) then begin
          call Talius00;
        end
        else begin
          start_gdialog(274, self_obj, 4, -1, -1);
          gsay_start;
          call Talius01;
          gsay_end;
          end_dialogue;
        end
      end
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 46);
      critter_add_trait(self_obj, 1, 5, 33);
      initialized := 1;
      if (global_var(129) == 2) then begin
        if (random(0, 1)) then begin
          kill_critter(self_obj, 59);
        end
        else begin
          kill_critter(self_obj, 57);
        end
      end
    end
  Talius00: 'float_msg(self_obj, message_str(274, 101), 0);

    '
  Talius01: |
    if (get_critter_stat(dude_obj, 34) == 1) then begin
      gsay_reply(274, 102);
    end
    else begin
      gsay_reply(274, 103);
    end
    giq_option(-3, 274, 104, Talius02, 50);
    giq_option(-3, 274, message_str(274, 105) + proto_data(obj_pid(dude_obj), 1) + message_str(274, 106) + proto_data(obj_pid(dude_obj), 1) + message_str(274, 107), Talius05, 50);
    giq_option(4, 274, message_str(274, 108) + proto_data(obj_pid(dude_obj), 1) + message_str(274, 109), Talius06, 50);
    giq_option(4, 274, 110, combat, 50);
    giq_option(4, 274, 111, Talius36, 50);
    giq_option(6, 274, message_str(274, 112) + proto_data(obj_pid(dude_obj), 1) + message_str(274, 113), Talius37, 50);
    giq_option(8, 274, 114, Talius37, 50);
  Talius02: |
    gsay_reply(274, 115);
    giq_option(-3, 274, 116, Talius03, 50);
    giq_option(-3, 274, 117, combat, 50);
  Talius03: |
    gsay_reply(274, 118);
    giq_option(-3, 274, 119, combat, 50);
    giq_option(-3, 274, 120, Talius04, 50);
  Talius04: |
    variable LVar0 := 0;
    if (local_var(5) == 0) then begin
      LVar0 := create_object_sid(53, 0, 0, -1);
      add_mult_objs_to_inven(dude_obj, LVar0, 3);
      set_local_var(5, 1);
      gsay_message(274, 121, 50);
    end
    else begin
      gsay_message(274, 232, 50);
    end
  Talius05: |
    gsay_reply(274, message_str(274, 122) + proto_data(obj_pid(dude_obj), 1) + message_str(274, 123));
    giq_option(-3, 274, 124, Talius02, 50);
    giq_option(-3, 274, 125, combat, 50);
  Talius06: |
    gsay_reply(274, 126);
    giq_option(4, 274, 127, Talius07, 50);
    giq_option(4, 274, 128, Talius31, 50);
    giq_option(4, 274, 129, Talius32, 50);
  Talius07: |
    gsay_reply(274, 130);
    giq_option(4, 274, 131, Talius08, 50);
    giq_option(4, 274, 132, Talius29, 50);
    giq_option(4, 274, 133, Talius30, 50);
    giq_option(4, 274, 134, combat, 50);
  Talius08: |
    gsay_reply(274, 135);
    giq_option(4, 274, 136, TaliusEnd, 50);
    giq_option(4, 274, 137, Talius09, 50);
    giq_option(4, 274, 138, Talius09, 50);
    giq_option(4, 274, 139, combat, 50);
  Talius09: |
    gsay_reply(274, 140);
    giq_option(4, 274, 141, Talius10, 50);
    giq_option(4, 274, 142, Talius15, 50);
    giq_option(5, 274, 143, Talius16, 50);
    giq_option(5, 274, 144, Talius17, 50);
  Talius10: |
    gsay_reply(274, 145);
    giq_option(4, 274, 146, Talius11, 50);
    giq_option(4, 274, 147, TaliusEnd, 50);
    giq_option(4, 274, 148, Talius15, 50);
    giq_option(4, 274, 149, Talius16, 50);
    giq_option(4, 274, 150, Talius17, 50);
  Talius11: |
    gsay_reply(274, 151);
    giq_option(4, 274, 152, Talius12, 50);
  Talius12: |
    gsay_reply(274, 153);
    if (local_var(6) == 0) then begin
      giq_option(4, 274, 154, Talius13, 50);
    end
    giq_option(4, 274, 155, Talius14, 50);
  Talius13: |
    variable LVar0 := 0;
    set_local_var(6, 1);
    gsay_message(274, 156, 50);
    LVar0 := create_object_sid(32, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(32, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(11, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
  Talius14: 'gsay_message(274, 157, 50);

    '
  Talius15: |
    gsay_reply(274, 158);
    giq_option(4, 274, 159, Talius16, 50);
    giq_option(4, 274, 160, Talius17, 50);
    giq_option(4, 274, 161, Talius22, 50);
    giq_option(4, 274, 162, TaliusEnd, 50);
  Talius16: |
    gsay_reply(274, message_str(274, 163) + " " + message_str(274, 164));
    giq_option(4, 274, 165, Talius17, 50);
    giq_option(4, 274, 166, Talius22, 50);
    giq_option(4, 274, 167, TaliusEnd, 50);
  Talius17: |
    gsay_message(274, 168, 50);
    gsay_reply(274, 169);
    giq_option(4, 274, 170, Talius18, 50);
    giq_option(4, 274, 171, Talius19, 50);
    giq_option(4, 274, 172, Talius21, 50);
  Talius18: |
    gsay_message(274, 173, 50);
    gsay_reply(274, 174);
    giq_option(4, 274, 175, TaliusEnd, 50);
    giq_option(4, 274, 176, TaliusEnd, 50);
    giq_option(4, 274, 177, Talius12, 50);
  Talius19: |
    gsay_message(274, 178, 50);
    gsay_reply(274, 179);
    giq_option(4, 274, 180, TaliusEnd, 50);
    if ((global_var(29) == 2) and (local_var(6) == 0)) then begin
      giq_option(4, 274, 181, Talius20, 50);
    end
  Talius20: |
    variable LVar0 := 0;
    set_local_var(6, 1);
    gsay_message(274, 182, 50);
    LVar0 := create_object_sid(11, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
  Talius21: 'gsay_message(274, 183, 50);

    '
  Talius22: |
    gsay_reply(274, 184);
    giq_option(4, 274, 185, Talius23, 50);
    giq_option(4, 274, 186, Talius26, 50);
    giq_option(4, 274, 187, Talius27, 50);
  Talius23: |
    gsay_reply(274, 188);
    giq_option(4, 274, 189, Talius24, 50);
    giq_option(4, 274, 190, Talius24, 50);
    giq_option(4, 274, 191, Talius25, 50);
  Talius24: 'gsay_message(274, 192, 50);

    '
  Talius25: 'gsay_message(274, 193, 50);

    '
  Talius26: 'gsay_message(274, 194, 50);

    '
  Talius27: |
    gsay_reply(274, 195);
    giq_option(4, 274, 196, combat, 50);
    giq_option(4, 274, 197, Talius28, 50);
  Talius28: |
    gsay_message(274, 198, 50);
    call combat;
  Talius29: |
    gsay_reply(274, 199);
    giq_option(4, 274, 200, Talius29a, 50);
    giq_option(4, 274, 201, combat, 50);
  Talius29a: 'set_global_var(133, 1);

    '
  Talius30: |
    gsay_message(274, 202, 50);
    call combat;
  Talius31: |
    gsay_message(274, 203, 50);
    gsay_reply(274, 204);
    giq_option(4, 274, 205, TaliusEnd, 50);
    giq_option(4, 274, 206, Talius09, 50);
    giq_option(4, 274, 207, Talius09, 50);
    giq_option(4, 274, 208, combat, 50);
  Talius32: |
    gsay_reply(274, 209);
    giq_option(4, 274, 210, TaliusEnd, 50);
    giq_option(4, 274, 211, Talius33, 50);
  Talius33: |
    gsay_reply(274, 212);
    giq_option(4, 274, 213, TaliusEnd, 50);
    giq_option(6, 274, 214, Talius34, 50);
  Talius34: |
    gsay_reply(274, 215);
    giq_option(6, 274, 216, TaliusEnd, 50);
    giq_option(8, 274, 217, Talius35, 50);
  Talius35: |
    gsay_reply(274, 218);
    giq_option(8, 274, 219, TaliusEnd, 50);
  Talius36: 'gsay_message(274, 220, 50);

    '
  Talius37: |
    gsay_reply(274, 221);
    giq_option(6, 274, 222, Talius38, 50);
  Talius38: |
    gsay_reply(274, 223);
    giq_option(6, 274, 224, Talius39, 50);
  Talius39: |
    gsay_reply(274, 225);
    giq_option(6, 274, 226, TaliusEnd, 50);
    giq_option(6, 274, 227, TaliusEnd, 50);
  Talius40: 'float_msg(self_obj, message_str(274, 228), 0);

    '
  Talius41: 'float_msg(self_obj, message_str(274, 229), 0);

    '
  TaliusEnd: "[]"
  combat: 'hostile := 1;

    '
talus:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 65);
      add_timer_event(self_obj, game_ticks(30), 2);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 22) then begin
            if (global_var(250) == 0) then begin
              call TalusBackground;
            end
          end
          else begin
            if (script_action == 12) then begin
              call critter_p_proc;
            end
            else begin
              if (script_action == 18) then begin
                call destroy_p_proc;
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call weapon_check;
    if (armed) then begin
      if (local_var(6) == 0) then begin
        call Talus11;
      end
      else begin
        if (local_var(6) == 1) then begin
          call Talus12;
        end
        else begin
          call Talus13;
        end
      end
    end
    else begin
      if ((global_var(109) == 2) and (local_var(8) == 0)) then begin
        if (local_var(7) == 0) then begin
          call Talus49;
        end
        else begin
          call Talus47;
        end
      end
      else begin
        if (local_var(7) == 0) then begin
          call Talus00;
        end
        else begin
          if (local_var(1) == 1) then begin
            call Talus22;
          end
          else begin
            call Talus14;
          end
        end
      end
    end
    set_local_var(7, 1);
  weapon_check: |
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      armed := 1;
    end
    else begin
      armed := 0;
    end
  set_requisition: |
    set_local_var(5, 1);
    set_map_var(17, 1);
    set_map_var(9, map_var(9) + 4);
    set_map_var(14, 1);
    set_map_var(10, 3);
  Talus00: |
    gsay_reply(318, 101);
    giq_option(8, 318, 102, Talus01, 50);
    giq_option(4, 318, 103, Talus02, 50);
    if (local_var(5) == 0) then begin
      giq_option(4, 318, 104, Talus07, 50);
    end
    giq_option(4, 318, 401, Talus28, 50);
    giq_option(4, 318, 402, Talus28, 50);
    giq_option(-3, 318, 105, TalusEnd, 50);
  Talus01: |
    gsay_reply(318, 106);
    giq_option(4, 318, 107, Talus05, 50);
    call Goodbyes;
    giq_option(4, 0, exit_line, TalusEnd, 50);
  Talus02: |
    gsay_reply(318, 108);
    giq_option(4, 318, 107, Talus05, 50);
    call Goodbyes;
    giq_option(4, 0, exit_line, TalusEnd, 50);
  Talus05: |
    gsay_reply(318, 110);
    giq_option(7, 318, 111, Talus06, 50);
    if (local_var(5) == 0) then begin
      giq_option(4, 318, 112, Talus07, 50);
    end
    giq_option(4, 318, 401, Talus28, 50);
    giq_option(4, 318, 402, Talus28, 50);
    call Goodbyes;
    giq_option(4, 0, exit_line, TalusEnd, 50);
  Talus06: |
    gsay_reply(318, 113);
    giq_option(4, 318, 115, TalusEnd, 50);
    if (local_var(5) == 0) then begin
      giq_option(4, 318, 112, Talus07, 50);
    end
  Talus07: |
    gsay_reply(318, 116);
    call set_requisition;
    giq_option(4, 318, 118, Talus08, 50);
    giq_option(4, 318, 119, Talus42, 51);
    giq_option(4, 318, 159, TalusEnd, 50);
  Talus08: |
    gsay_reply(318, 406);
    if (global_var(109) != 2) then begin
      giq_option(4, 318, 109, Talus32, 50);
    end
    giq_option(4, 318, 121, Talus09, 51);
    giq_option(4, 318, 193, TalusEnd, 50);
  Talus09: |
    set_local_var(11, 1);
    call DownReact;
    gsay_message(318, 122, 51);
  Talus10: |
    gsay_message(318, 123, 50);
    gsay_message(318, 124, 50);
    gsay_reply(318, 125);
    giq_option(4, 318, 126, TalusEnd, 50);
  Talus11: |
    gsay_message(318, 127, 50);
    set_local_var(6, local_var(6) + 1);
  Talus12: |
    gsay_message(318, 128, 50);
    set_local_var(6, local_var(6) + 1);
  Talus13: 'gsay_message(318, 129, 51);

    '
  Talus14: |
    gsay_reply(318, message_str(318, 130) + proto_data(obj_pid(dude_obj), 1) + message_str(318, 131));
    if (not(line16flag)) then begin
      giq_option(5, 318, 132, Talus16, 50);
    end
    else begin
      giq_option(5, 318, 133, Talus17, 50);
    end
    if (local_var(5) == 0) then begin
      giq_option(4, 318, 134, Talus15, 50);
    end
    else begin
      giq_option(4, 318, 135, TalusAmmo, 50);
    end
    if (local_var(11) == 1) then begin
      giq_option(4, 318, 403, Talus44, 51);
    end
    giq_option(4, 318, 404, Talus29, 50);
    giq_option(4, 318, 136, TalusEnd, 50);
    giq_option(-3, 318, 105, TalusEnd, 50);
  Talus14a: 'call Talus34;

    '
  Talus15: |
    gsay_message(318, 137, 50);
    gsay_reply(318, 138);
    call set_requisition;
    giq_option(4, 318, 118, Talus08, 50);
  Talus16: |
    line16flag := 1;
    gsay_message(318, 141, 50);
    call Talus18;
  Talus17: |
    gsay_message(318, 142, 50);
    call Talus18;
  Talus18: |
    gsay_reply(318, 143);
    giq_option(4, 318, 144, Talus19, 50);
    giq_option(4, 318, 145, Talus20, 50);
    giq_option(4, 318, 146, Talus21, 50);
  Talus19: |
    who_rhombus := 1;
    gsay_message(318, 147, 50);
    gsay_reply(318, 148);
    if (who_vree == 0) then begin
      giq_option(4, 318, 145, Talus20, 50);
    end
    if (who_maxson == 0) then begin
      giq_option(4, 318, 146, Talus21, 50);
    end
    giq_option(4, 318, 151, TalusEnd, 50);
  Talus20: |
    who_vree := 1;
    gsay_message(318, 152, 50);
    gsay_reply(318, 153);
    if (who_rhombus == 0) then begin
      giq_option(4, 318, 144, Talus19, 50);
    end
    if (who_maxson == 0) then begin
      giq_option(4, 318, 146, Talus21, 50);
    end
    giq_option(4, 318, 156, TalusEnd, 50);
  Talus21: |
    who_maxson := 1;
    gsay_reply(318, 157);
    if (who_rhombus == 0) then begin
      giq_option(4, 318, 144, Talus19, 50);
    end
    if (who_vree == 0) then begin
      giq_option(4, 318, 145, Talus20, 50);
    end
    giq_option(4, 318, 160, TalusEnd, 50);
  Talus22: |
    gsay_reply(318, 161);
    giq_option(4, 318, 162, DownReact, 51);
    giq_option(4, 318, 163, TalusEnd, 50);
    if (local_var(5) == 1) then begin
      giq_option(4, 318, 135, TalusAmmo, 50);
    end
    giq_option(-3, 318, 164, Talus24, 51);
    giq_option(-3, 318, 165, TalusEnd, 50);
  Talus23: |
    gsay_message(318, 166, 51);
    call DownReact;
  Talus24: |
    gsay_message(318, 167, 51);
    call DownReact;
  Talus25: |
    gsay_message(318, 168, 50);
    set_map_var(17, 1);
    temp := map_var(9) + 3;
    set_map_var(9, temp);
    temp := map_var(10) + 3;
    set_map_var(10, temp);
  Talus26: 'gsay_message(318, 169, 50);

    '
  Talus27: 'gsay_message(318, 170, 50);

    '
  Talus28: |
    gsay_reply(318, 149);
    giq_option(4, 318, 102, Talus02, 50);
    giq_option(4, 318, 103, Talus07, 50);
    giq_option(4, 318, 150, TalusEnd, 50);
  Talus29: |
    if (local_var(10) == 0) then begin
      set_local_var(10, 1);
      gsay_message(318, 154, 50);
    end
    else begin
      gsay_message(318, 155, 50);
    end
  Talus30: |
    call BottomReact;
    gsay_reply(318, 171);
    giq_option(4, 318, 172, Talus37, 51);
    giq_option(4, 318, 173, Talus38, 50);
    giq_option(4, 318, 174, TalusEnd, 51);
  Talus31: |
    gsay_reply(318, 175);
    giq_option(4, 318, 176, Talus35, 50);
    giq_option(4, 318, 177, BigDownReact, 51);
    giq_option(4, 318, 178, Talus31a, 50);
  Talus31a: |
    if (local_var(9) == 0) then begin
      call Talus39;
    end
    else begin
      call TalusEnd;
    end
  Talus32: |
    gsay_reply(318, 158);
    giq_option(4, 318, 176, Talus35, 50);
    giq_option(4, 318, 177, BigDownReact, 51);
    giq_option(4, 318, 178, Talus31a, 49);
  Talus33: |
    gsay_reply(318, 179);
    giq_option(4, 318, 176, Talus35, 50);
    giq_option(4, 318, 177, BigDownReact, 51);
    giq_option(4, 318, 178, Talus31a, 49);
  Talus34: 'gsay_message(318, 180, 51);

    '
  Talus35: |
    set_global_var(109, 1);
    gsay_reply(318, 181);
    giq_option(4, 318, 182, Talus31a, 49);
    giq_option(4, 318, 183, Talus46, 50);
  Talus37: 'gsay_message(318, 185, 51);

    '
  Talus38: 'gsay_message(318, 186, 51);

    '
  Talus39: 'gsay_message(318, 187, 49);

    '
  Talus40: |
    gsay_reply(318, 191);
    giq_option(4, 318, 193, TalusEnd, 50);
  Talus41: 'gsay_message(318, 194, 50);

    '
  Talus42: |
    call DownReact;
    gsay_message(318, 195, 51);
  Talus43: |
    gsay_reply(318, 196);
    giq_option(4, 318, 192, Talus41, 50);
    giq_option(4, 318, 193, TalusEnd, 50);
  Talus44: |
    call DownReact;
    gsay_message(318, 198, 51);
  Talus45: |
    call BigDownReact;
    gsay_message(318, 199, 51);
  Talus46: 'gsay_message(318, 200, 50);

    '
  Talus47: |
    gsay_reply(318, message_str(318, 201) + proto_data(obj_pid(dude_obj), 1) + message_str(318, 202));
    giq_option(4, 318, 205, Talus51, 50);
    giq_option(-3, 318, 206, Talus50, 50);
  Talus49: |
    gsay_reply(318, 207);
    giq_option(4, 318, 205, Talus51, 50);
    giq_option(-3, 318, 206, Talus50, 50);
  Talus50: 'gsay_message(318, 209, 50);

    '
  Talus51: |
    gsay_reply(318, 210);
    giq_option(4, 318, 212, Talus51a, 50);
    giq_option(4, 318, 213, Talus51b, 50);
    giq_option(4, 318, 214, Talus51c, 50);
    if (global_var(155) > 15) then begin
      giq_option(4, 318, 407, Talus51d, 50);
    end
    giq_option(4, 318, 215, TalusEnd, 50);
  Talus51a: |
    set_map_var(9, map_var(9) + 1);
    set_map_var(12, 1);
    call Talus53;
  Talus51b: |
    set_map_var(9, map_var(9) + 1);
    set_map_var(13, 1);
    call Talus53;
  Talus51c: |
    set_map_var(9, map_var(9) + 1);
    set_map_var(20, 1);
    call Talus53;
  Talus51d: |
    set_map_var(9, map_var(9) + 1);
    set_map_var(15, 1);
    call Talus53;
  Talus53: |
    set_local_var(8, 1);
    awardex := 1;
    gsay_message(318, 216, 50);
  Talus54: |
    set_local_var(9, 1);
    set_map_var(9, map_var(9) + 1);
    set_map_var(15, 1);
    gsay_message(318, message_str(318, 201) + proto_data(obj_pid(dude_obj), 1) + message_str(318, 217), 50);
  Talus55: |
    set_local_var(9, 1);
    gsay_message(318, 218, 50);
  TalusBackground: |
    variable LVar0 := 0;
    LVar0 := random(1, 5);
    if (LVar0 == 1) then begin
      LVar0 := message_str(318, 219);
    end
    else begin
      if (LVar0 == 2) then begin
        LVar0 := message_str(318, 220);
      end
      else begin
        if (LVar0 == 3) then begin
          LVar0 := message_str(318, 221);
        end
        else begin
          if (LVar0 == 4) then begin
            LVar0 := message_str(318, 222);
          end
          else begin
            if (LVar0 == 5) then begin
              LVar0 := message_str(318, 223);
            end
          end
        end
      end
    end
    float_msg(self_obj, LVar0, 0);
    add_timer_event(self_obj, game_ticks(180), 2);
  TalusAmmo: |
    if (map_var(17) > 0) then begin
      call Talus27;
    end
    else begin
      call Talus25;
    end
  TalusEnd: "[]"
  critter_p_proc: |
    if (global_var(250)) then begin
      Hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      Hostile := 0;
    end
    if (Hostile) then begin
      set_global_var(250, 1);
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      Hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (local_var(7) == 0) then begin
      if (local_var(1) == 1) then begin
        set_local_var(1, 2);
        call LevelToReact;
      end
    end
    start_gdialog(318, self_obj, 4, -1, -1);
    gsay_start;
    call do_dialogue;
    gsay_end;
    end_dialogue;
    if (awardex) then begin
      awardex := 0;
      temp := 1500;
      display_msg(message_str(318, 408) + temp + message_str(318, 409));
      set_global_var(155, global_var(155) + 1);
      give_exp_points(temp);
    end
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(318, 100));
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
  Talus36: 'gsay_message(318, 184, 51);

    '
tandi:
  start: |
    if (GVar11) then begin
      GVar11 := 0;
      if ((cur_map_index == 26) or (cur_map_index == 25)) then begin
        critter_add_trait(self_obj, 1, 6, 2);
      end
      else begin
        critter_add_trait(self_obj, 1, 6, 0);
      end
      critter_add_trait(self_obj, 1, 5, 2);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(57, 100));
  map_enter_p_proc: |
    if ((cur_map_index == 26) and (global_var(26) > 1)) then begin
      if ((global_var(32) == 2) and (global_var(264) == 3)) then begin
        party_remove(self_obj);
        set_obj_visibility(self_obj, 0);
        critter_attempt_placement(self_obj, 22086, 0);
        set_global_var(264, 4);
      end
      else begin
        if (global_var(264) >= 300) then begin
          critter_attempt_placement(self_obj, 22086, 0);
          set_global_var(264, 4);
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj) and (global_var(246) == 1) and (global_var(264) != 1)) then begin
      if (party_member_obj(16777279) != 0) then begin
        party_remove(self_obj);
      end
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (cur_map_index == 24) then begin
        if ((global_var(26) == 1) and (global_var(264) == 1)) then begin
          party_remove(self_obj);
          set_obj_visibility(self_obj, 0);
          critter_attempt_placement(self_obj, 17905, 0);
          set_global_var(264, 2);
        end
        else begin
          if ((global_var(26) == 5) and (global_var(264) == 2)) then begin
            party_add(self_obj);
            set_global_var(264, 3);
          end
        end
        if ((map_var(2) != 0) and (local_var(5) == 0)) then begin
          set_global_var(26, 5);
          set_local_var(5, 1);
          if (party_member_obj(16777279) == 0) then begin
            party_add(self_obj);
          end
        end
      end
      else begin
        if ((cur_map_index == 26) or (cur_map_index == 25)) then begin
          if (global_var(26) > 1) then begin
            bag_ptr := create_object_sid(16777262, 0, 0, 860);
            move_obj_inven_to_obj(self_obj, bag_ptr);
            move_obj_inven_to_obj(bag_ptr, self_obj);
            destroy_object(bag_ptr);
          end
          if ((global_var(26) == 1) and (global_var(264) == 0)) then begin
            party_add(self_obj);
            set_obj_visibility(self_obj, 1);
            set_global_var(264, 1);
          end
          else begin
            if ((global_var(26) > 1) and (global_var(264) == 3) and (cur_map_index == 26)) then begin
              party_remove(self_obj);
              set_obj_visibility(self_obj, 0);
              animate_move_obj_to_tile(self_obj, 16710, 1);
              set_global_var(264, 300);
            end
            else begin
              if ((global_var(264) == 300) and (tile_distance(tile_num(self_obj), 16710) >= 2)) then begin
                animate_move_obj_to_tile(self_obj, 16710, 1);
              end
              else begin
                if ((global_var(264) == 300) and (tile_distance(tile_num(self_obj), 16710) < 2)) then begin
                  set_global_var(264, 301);
                end
                else begin
                  if ((global_var(264) == 301) and (tile_distance(tile_num(self_obj), 20706) >= 2)) then begin
                    animate_move_obj_to_tile(self_obj, 20706, 1);
                  end
                  else begin
                    if ((global_var(264) == 301) and (tile_distance(tile_num(self_obj), 20706) < 2)) then begin
                      set_global_var(264, 302);
                    end
                    else begin
                      if ((global_var(264) == 302) and (tile_distance(tile_num(self_obj), 23698) >= 2)) then begin
                        animate_move_obj_to_tile(self_obj, 23698, 1);
                      end
                      else begin
                        if ((global_var(264) == 302) and (tile_distance(tile_num(self_obj), 23698) < 2)) then begin
                          set_global_var(264, 303);
                        end
                        else begin
                          if ((global_var(264) == 303) and (tile_distance(tile_num(self_obj), 22086) >= 2)) then begin
                            animate_move_obj_to_tile(self_obj, 22086, 1);
                          end
                          else begin
                            if ((global_var(264) == 303) and (tile_distance(tile_num(self_obj), 22086) < 2)) then begin
                              set_global_var(264, 4);
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
          if (obj_can_see_obj(self_obj, dude_obj) and (party_member_obj(16777279) == 0) and GVar12) then begin
            GVar12 := 0;
            attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
          end
          if ((party_member_obj(16777279) == 0) and (global_var(26) != 1) and (global_var(264) != 300)) then begin
            call TandiSchedule;
            if (random(1, 20) == 1) then begin
              animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(self_obj), random(0, 5), random(2, 4)), 0);
            end
          end
        end
      end
    end
    if ((global_var(26) == 5) and (local_var(5) == 0)) then begin
      set_local_var(5, 1);
      if (party_member_obj(16777279) == 0) then begin
        party_add(self_obj);
      end
    end
    if ((party_member_obj(16777279) != 0) and (cur_map_index != 26) and (cur_map_index != 25)) then begin
      if (tile_distance_objs(self_obj, dude_obj) > 8) then begin
        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 1), 1);
      end
      else begin
        if (tile_distance_objs(self_obj, dude_obj) > 4) then begin
          animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 3), 0);
        end
      end
    end
    else begin
      if ((global_var(26) > 1) and (cur_map_index == 25)) then begin
        if (tile_num(self_obj) != 14950) then begin
          animate_move_obj_to_tile(self_obj, 14950, 1);
        end
        else begin
          set_obj_visibility(self_obj, 1);
        end
      end
    end
  pickup_p_proc: 'GVar12 := 1;

    '
  damage_p_proc: |
    if ((source_obj == dude_obj) and ((cur_map_index == 26) or (cur_map_index == 25))) then begin
      set_global_var(246, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    set_global_var(26, 3);
    set_global_var(246, 1);
  talk_p_proc: |
    if (cur_map_index == 24) then begin
      if (global_var(26) == 5) then begin
        float_msg(self_obj, message_str(57, 208), 2);
      end
      else begin
        call get_reaction;
        start_gdialog(57, self_obj, 4, 9, 13);
        gsay_start;
        if (global_var(217) == 1) then begin
          set_global_var(218, 1);
          call tandi43;
        end
        else begin
          set_global_var(217, 1);
          call tandi37;
        end
        gsay_end;
        end_dialogue;
      end
    end
    else begin
      if ((cur_map_index == 26) or (cur_map_index == 25)) then begin
        call get_reaction;
        start_gdialog(57, self_obj, 4, 9, 9);
        gsay_start;
        if (global_var(217) == 1) then begin
          if (global_var(26) == 0) then begin
            if (get_critter_stat(dude_obj, 4) < 4) then begin
              call tandi06;
            end
            else begin
              call tandi30;
            end
          end
          else begin
            call tandi36;
          end
        end
        else begin
          set_global_var(217, 1);
          if (global_var(26) == 0) then begin
            call tandi01;
          end
          else begin
            call tandi36;
          end
        end
        gsay_end;
        end_dialogue;
      end
      else begin
        float_msg(self_obj, message_str(57, random(300, 305)), 8);
      end
    end
  tandi00: |
    giq_option(5, 57, 101, tandi15, 50);
    giq_option(4, 57, 102, tandi00_1, 50);
    giq_option(5, 57, 103, tandi23, 50);
    giq_option(4, 57, 104, tandi24, 50);
    giq_option(4, 57, 105, tandi28, 50);
  tandi00_1: |
    if (global_var(43) == 0) then begin
      call tandi20;
    end
    else begin
      if (global_var(43) == 2) then begin
        call tandi21;
      end
      else begin
        call tandi22;
      end
    end
  tandi01: |
    gsay_reply(57, 106);
    giq_option(4, 57, message_str(57, 107) + proto_data(obj_pid(dude_obj), 1) + message_str(57, 108), tandi02, 50);
    giq_option(4, 57, message_str(57, 109) + proto_data(obj_pid(dude_obj), 1) + message_str(57, 110), tandi01a, 51);
    giq_option(-3, 57, 111, tandi29, 50);
  tandi01a: |
    call DownReact;
    call tandi02;
  tandi02: |
    gsay_reply(57, 112);
    giq_option(4, 57, 113, tandi03, 50);
    giq_option(5, 57, 114, tandi14, 49);
    giq_option(4, 57, 115, tandi04, 50);
    giq_option(4, 57, 116, tandi14, 49);
  tandi03: |
    gsay_reply(57, 117);
    call tandi00;
  tandi04: |
    gsay_reply(57, 118);
    giq_option(5, 57, 119, tandi05, 50);
    giq_option(5, 57, 120, tandi12, 51);
    giq_option(4, 57, 121, tandi13, 50);
  tandi05: |
    gsay_reply(57, 122);
    giq_option(0, 57, 123, tandi03, 50);
    giq_option(0, 57, 124, tandi28, 50);
  tandi06: |
    gsay_message(57, 125, 50);
    call tandix2;
  tandi12: |
    call DownReact;
    gsay_reply(57, 126);
    call tandi00;
  tandi13: |
    gsay_reply(57, 127);
    giq_option(5, 57, 128, tandi05, 50);
    giq_option(4, 57, 129, tandi03, 50);
  tandi14: |
    gsay_reply(57, 130);
    giq_option(5, 57, 131, tandi05, 50);
    giq_option(5, 57, 132, tandi12, 51);
    giq_option(4, 57, 133, tandi13, 50);
  tandi15: |
    if (local_var(1) > 2) then begin
      gsay_reply(57, 134);
      if (global_var(71) == 0) then begin
        set_global_var(71, 1);
      end
    end
    else begin
      gsay_reply(57, 135);
    end
    giq_option(5, 57, 136, tandi16, 50);
  tandi16: |
    gsay_reply(57, 137);
    call tandi00;
  tandi20: |
    gsay_reply(57, 138);
    call tandi00;
  tandi21: |
    gsay_reply(57, 139);
    call tandi00;
  tandi22: |
    gsay_reply(57, 140);
    call tandi00;
  tandi23: |
    if (local_var(1) > 2) then begin
      gsay_reply(57, 141);
    end
    else begin
      gsay_reply(57, 142);
    end
    giq_option(4, 57, 143, tandi16, 50);
    if (local_var(1) > 2) then begin
      giq_option(4, 57, 144, tandi52, 50);
    end
  tandi24: |
    gsay_reply(57, 145);
    giq_option(5, 57, 146, tandi05, 50);
    giq_option(5, 57, 147, tandi12, 51);
    giq_option(4, 57, 148, tandi13, 50);
  tandi27: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(57, 149, 51);
    end
    else begin
      gsay_message(57, 150, 51);
    end
    call tandix2;
  tandi28: |
    if (GVar5 < 1) then begin
      GVar5 := 1;
      gsay_reply(57, 151);
      giq_option(0, 57, 152, tandix, 50);
    end
    else begin
      call tandix;
    end
  tandi29: |
    gsay_reply(57, 153);
    call tandix2;
  tandi30: |
    gsay_reply(57, 154);
    giq_option(4, 57, 155, tandi03, 50);
    giq_option(4, 57, 156, tandi28, 50);
  tandi35: |
    gsay_message(57, 157, 50);
    call tandix;
  tandi36: |
    gsay_reply(57, 158);
    giq_option(4, 57, 159, tandi03, 50);
    giq_option(6, 57, 160, tandi36a, 51);
    giq_option(4, 57, 161, tandi28, 50);
    giq_option(-3, 57, 162, tandi35, 50);
  tandi36a: |
    call BottomReact;
    call tandi27;
  tandi37: |
    gsay_reply(57, 163);
    giq_option(4, 57, message_str(57, 164) + proto_data(obj_pid(dude_obj), 1) + message_str(57, 165), tandi38, 50);
    giq_option(5, 57, 166, tandi42, 50);
    giq_option(-3, 57, 167, tandi43a, 50);
  tandi38: |
    if (global_var(114) == 1) then begin
      call tandi38a;
    end
    else begin
      call tandi38b;
    end
  tandi38a: |
    gsay_reply(57, 168);
    giq_option(4, 57, 169, tandiend, 50);
  tandi38b: |
    gsay_reply(57, 168);
    giq_option(4, 57, 169, tandi39, 50);
    giq_option(5, 57, 170, tandi42, 50);
  tandi39: |
    gsay_reply(57, 171);
    giq_option(4, 57, 172, tandi40, 50);
    giq_option(5, 57, 173, tandi41, 50);
  tandi40: |
    gsay_message(57, 174, 50);
    call tandix3;
  tandi41: |
    gsay_message(57, 175, 50);
    call tandix4;
  tandi42: |
    gsay_reply(57, 176);
    giq_option(4, 57, 177, tandi40, 50);
    giq_option(5, 57, 178, tandi41, 50);
  tandi43: |
    gsay_reply(57, 179);
    giq_option(4, 57, 180, tandi39, 50);
    giq_option(5, 57, 181, tandi42, 50);
    giq_option(-3, 57, 182, tandi43a, 50);
  tandi43a: |
    gsay_message(57, 183, 50);
    call tandix;
  tandi52: 'gsay_message(57, 193, 50);

    '
  tandix: "[]"
  tandix2: "[]"
  tandix3: 'critter_add_trait(self_obj, 1, 6, 0);

    '
  tandix4: 'critter_add_trait(self_obj, 1, 6, 0);

    '
  tandiend: "[]"
  TandiSchedule: |
    variable LVar0 := 0;
    LVar0 := game_time_hour;
    if (LVar0 == 600) then begin
      animate_move_obj_to_tile(self_obj, 18709, 0);
    end
    else begin
      if (LVar0 == 610) then begin
        animate_move_obj_to_tile(self_obj, 23232, 0);
      end
      else begin
        if (LVar0 == 615) then begin
          animate_move_obj_to_tile(self_obj, 18492, 0);
        end
        else begin
          if (LVar0 == 645) then begin
            animate_move_obj_to_tile(self_obj, 13565, 0);
          end
          else begin
            if (LVar0 == 650) then begin
              animate_move_obj_to_tile(self_obj, 15683, 0);
            end
            else begin
              if (LVar0 == 1000) then begin
                animate_move_obj_to_tile(self_obj, 18709, 0);
              end
              else begin
                if (LVar0 == 1200) then begin
                  animate_move_obj_to_tile(self_obj, 24678, 0);
                end
                else begin
                  if (LVar0 == 1300) then begin
                    animate_move_obj_to_tile(self_obj, 23232, 0);
                  end
                  else begin
                    if (LVar0 == 1305) then begin
                      animate_move_obj_to_tile(self_obj, 23701, 0);
                    end
                    else begin
                      if (LVar0 == 1600) then begin
                        animate_move_obj_to_tile(self_obj, 17279, 0);
                      end
                      else begin
                        if (LVar0 == 1900) then begin
                          animate_move_obj_to_tile(self_obj, 13565, 0);
                        end
                        else begin
                          if (LVar0 == 1905) then begin
                            animate_move_obj_to_tile(self_obj, 18709, 0);
                          end
                          else begin
                            if (LVar0 == 2100) then begin
                              animate_move_obj_to_tile(self_obj, 24678, 0);
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
tangler:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(1) == 0) then begin
      display_msg(message_str(976, 100));
    end
    else begin
      display_msg(message_str(976, 101));
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(976, 100));
  map_enter_p_proc: |
    if (metarule(22, 0) == 0) then begin
      critter_add_trait(self_obj, 1, 5, 35);
      critter_add_trait(self_obj, 1, 6, 20);
    end
    if ((global_var(643) == 1) and (days_since_visited > 1)) then begin
      set_obj_visibility(self_obj, 1);
      move_to(self_obj, 9929, 2);
      removal_ptr := self_obj;
    end
  critter_p_proc: |
    if (global_var(252) == 1) then begin
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(252, 1);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(252, 1);
      float_msg(self_obj, message_str(978, 102), 2);
    end
  destroy_p_proc: |
    variable LVar0 := 0;
    if (global_var(643) == 0) then begin
      LVar0 := create_object_sid(114, 0, 0, -1);
      add_obj_to_inven(self_obj, LVar0);
    end
    if (source_obj == dude_obj) then begin
      set_global_var(155, global_var(155) + 1);
    end
    set_global_var(644, 1);
  talk_p_proc: |
    if (local_var(0) == 0) then begin
      call Node000;
    end
    else begin
      if (global_var(643) == 1) then begin
        call Node016;
      end
      else begin
        call Node006;
      end
    end
  Node000: |
    start_gdialog(976, self_obj, 4, -1, -1);
    gsay_start;
    call Node001;
    gsay_end;
    end_dialogue;
  Node001: |
    gsay_reply(976, 200);
    giq_option(4, 976, message_str(976, 203) + (obj_name(dude_obj) + message_str(976, 2003)), Node003, 50);
    giq_option(4, 976, 210, Node005, 50);
    giq_option(4, 976, 304, Node999, 50);
    giq_option(-3, 976, 201, Node002, 50);
  Node002: 'gsay_message(976, 202, 50);

    '
  Node003: |
    set_local_var(0, 1);
    set_local_var(1, 1);
    gsay_reply(976, 204);
    giq_option(4, 976, 205, Node004, 50);
  Node004: |
    if ((has_skill(dude_obj, 14) > 59) or (global_var(156) == 1)) then begin
      gsay_reply(976, 206);
    end
    else begin
      gsay_reply(976, 207);
    end
    giq_option(4, 976, 300, Node007, 50);
    giq_option(4, 976, 209, Node005, 50);
    giq_option(4, 976, 208, Node999, 50);
  Node005: 'set_global_var(252, 1);

    '
  Node006: |
    start_gdialog(976, self_obj, 4, -1, -1);
    gsay_start;
    call Node007;
    gsay_end;
    end_dialogue;
  Node007: |
    gsay_reply(976, 301);
    if ((global_var(642) == 1) and (local_var(3) == 0)) then begin
      giq_option(4, 976, 211, Node009, 50);
    end
    giq_option(4, 976, 205, Node004, 50);
    giq_option(4, 976, 210, Node005, 50);
    giq_option(4, 976, 304, Node999, 50);
    giq_option(-3, 976, 302, Node008, 50);
  Node008: |
    set_global_var(252, 1);
    gsay_message(976, 303, 50);
  Node009: |
    if ((has_skill(dude_obj, 14) > 59) or (global_var(158) >= -50)) then begin
      gsay_reply(976, 212);
    end
    else begin
      gsay_reply(976, 213);
    end
    if ((get_critter_stat(dude_obj, 4) >= 6) and (has_skill(dude_obj, 7) > 59) or (has_skill(dude_obj, 12) > 59) or (has_skill(dude_obj, 13) > 59)) then begin
      giq_option(4, 976, 214, Node010, 50);
    end
    giq_option(4, 976, 300, Node007, 50);
    giq_option(4, 976, 209, Node005, 50);
    giq_option(4, 976, 208, Node999, 50);
  Node010: |
    if (has_skill(dude_obj, 14) > 79) then begin
      gsay_reply(976, 215);
      giq_option(7, 976, 217, Node011, 50);
      if (local_var(2) == 0) then begin
        giq_option(4, 976, 227, Node015, 50);
      end
      giq_option(4, 976, 300, Node007, 50);
    end
    else begin
      gsay_message(976, 216, 50);
      call Node005;
    end
  Node011: |
    if (has_skill(dude_obj, 14) > 89) then begin
      gsay_reply(976, 218);
      giq_option(4, 976, 219, Node012, 50);
      giq_option(4, 976, 221, Node013, 50);
    end
    else begin
      gsay_reply(976, 225);
      giq_option(4, 976, 208, Node999, 50);
      giq_option(4, 976, 226, Node005, 50);
    end
  Node012: |
    gsay_message(976, 220, 50);
    call Node005;
  Node013: |
    if (has_skill(dude_obj, 14) > 119) then begin
      gsay_reply(976, 222);
      giq_option(4, 976, 223, Node014, 50);
    end
    else begin
      gsay_message(976, 224, 50);
      call Node005;
    end
  Node014: |
    variable LVar0 := 0;
    set_local_var(3, 1);
    set_global_var(643, 1);
    gfade_out(300);
    LVar0 := create_object_sid(114, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    gfade_in(300);
    give_exp_points(2000);
    display_msg(message_str(976, 306));
  Node015: |
    if (has_skill(dude_obj, 14) > 84) then begin
      gsay_reply(976, 228);
      giq_option(4, 976, 229, Node999, 50);
      giq_option(4, 976, 300, Node007, 50);
      give_exp_points(1000);
      display_msg(message_str(976, 305));
      set_local_var(2, 1);
    end
    else begin
      gsay_reply(976, 230);
      giq_option(4, 976, 208, Node999, 50);
    end
  Node016: |
    start_gdialog(976, self_obj, 4, -1, -1);
    gsay_start;
    gsay_message(976, 307, 50);
    gsay_end;
    end_dialogue;
  Node999: "[]"
taylor:
  start: "[]"
  combat_p_proc: |
    if (fixed_param == 4) then begin
      if (elevation(self_obj) == 0) then begin
        round_counter := round_counter + 1;
        if (round_counter > 3) then begin
          if (global_var(251) == 0) then begin
            set_global_var(251, 1);
            set_global_var(155, global_var(155) - 5);
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (Tine_barter != 0) then begin
        dialogue_system_enter;
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(5, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(4)) then begin
      display_msg(message_str(256, 101));
    end
    else begin
      display_msg(message_str(256, 100));
    end
  pickup_p_proc: 'hostile := 1;

    '
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 49);
      critter_add_trait(self_obj, 1, 5, 30);
      initialized := 1;
    end
  talk_p_proc: |
    variable LVar0 := 0;
    call get_reaction;
    LVar0 := random(0, 1);
    if (Tine_barter == 0) then begin
      if (LVar0 == 1) then begin
        move_obj_inven_to_obj(AdyStor1_ptr, self_obj);
      end
      else begin
        move_obj_inven_to_obj(AdyStor2_ptr, self_obj);
      end
    end
    if (Tine_barter == -1) then begin
      float_msg(self_obj, message_str(37, 136), 2);
      hostile := 1;
    end
    else begin
      if ((Tine_barter != 0) and ((local_var(5) == 1) or (global_var(251) == 1))) then begin
        float_msg(self_obj, message_str(669, 104), 2);
      end
      else begin
        start_gdialog(256, self_obj, 4, -1, -1);
        gsay_start;
        if (Tine_barter == 1) then begin
          call Tine_barter1;
        end
        else begin
          if (Tine_barter == 2) then begin
            call Tine_barter2;
          end
          else begin
            if (local_var(4)) then begin
              call Tine07;
            end
            else begin
              call Tine01;
            end
          end
        end
        gsay_end;
        end_dialogue;
      end
    end
    if (Tine_barter == 1) then begin
      move_obj_inven_to_obj(self_obj, AdyStor1_ptr);
    end
    else begin
      if (Tine_barter == 2) then begin
        move_obj_inven_to_obj(self_obj, AdyStor2_ptr);
      end
      else begin
        if (LVar0 == 1) then begin
          move_obj_inven_to_obj(self_obj, AdyStor1_ptr);
        end
        else begin
          move_obj_inven_to_obj(self_obj, AdyStor2_ptr);
        end
      end
    end
    Tine_barter := 0;
  Tine01: |
    if (local_var(1) < 2) then begin
      gsay_reply(256, 102);
    end
    else begin
      gsay_reply(256, 103);
    end
    call Tine02;
  Tine02: |
    if (not(local_var(4))) then begin
      giq_option(4, 256, message_str(256, 104) + proto_data(obj_pid(dude_obj), 1) + message_str(256, 105), Tine04, 50);
    end
    giq_option(4, 256, 106, Tine03, 50);
    giq_option(4, 256, 107, Tine05, 50);
    giq_option(4, 256, 108, Tine08, 50);
    giq_option(0, 256, 109, Tine06, 50);
  Tine03: |
    if (local_var(1) < 2) then begin
      gsay_reply(256, 110);
    end
    else begin
      gsay_reply(256, 111);
    end
    call Tine02;
  Tine04: |
    set_local_var(4, 1);
    if (local_var(1) < 2) then begin
      gsay_reply(256, 112);
    end
    else begin
      gsay_reply(256, 113);
    end
    call Tine02;
  Tine05: |
    gdialog_mod_barter(0);
    gsay_message(256, 114, 50);
  Tine06: |
    if (local_var(1) < 2) then begin
      gsay_message(256, 115, 50);
    end
    else begin
      gsay_message(256, 116, 50);
    end
  Tine07: |
    if (local_var(1) < 2) then begin
      gsay_reply(256, 117);
    end
    else begin
      gsay_reply(256, 118);
    end
    call Tine02;
  Tine08: |
    if (local_var(0) < 2) then begin
      gsay_reply(256, 119);
    end
    else begin
      gsay_reply(256, 120);
    end
    call Tine02;
  TineBarter: |
    gdialog_mod_barter(20);
    gsay_message(634, 100, 50);
  Tine_barter1: |
    move_obj_inven_to_obj(AdyStor1_ptr, self_obj);
    gsay_reply(617, 293);
    giq_option(0, 634, 106, TineBarter, 50);
  Tine_barter2: |
    move_obj_inven_to_obj(AdyStor2_ptr, self_obj);
    gsay_reply(617, 293);
    giq_option(0, 634, 106, TineBarter, 50);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
term:
  start: |
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 6) then begin
        display_msg(message_str(725, 101));
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(725, 100));
terry:
  start: |
    if (not(init_teams)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 79);
      set_local_var(1, 0);
      init_teams := 1;
    end
    if ((script_action == 11) and (global_var(35) < 1)) then begin
      if (global_var(306) == 0) then begin
        call do_dialogue;
      end
      else begin
        display_msg(message_str(101, 109));
      end
    end
    else begin
      if (script_action == 21) then begin
        script_overrides;
        display_msg(message_str(101, 100));
      end
      else begin
        if (script_action == 4) then begin
          Hostile := 1;
        end
        else begin
          if (script_action == 12) then begin
            call Critter_Action;
          end
          else begin
            if (script_action == 18) then begin
              set_global_var(35, global_var(35) + 1);
              if (global_var(35) > global_var(551)) then begin
                set_global_var(155, global_var(155) + 3);
                set_global_var(29, 2);
                set_global_var(225, game_time / (10 * 60 * 60 * 24));
              end
              if (source_obj == dude_obj) then begin
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                  set_global_var(156, 1);
                  set_global_var(157, 0);
                end
                if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                  set_global_var(157, 1);
                  set_global_var(156, 0);
                end
                set_global_var(160, global_var(160) + 1);
                if ((global_var(160) % 6) == 0) then begin
                  set_global_var(155, global_var(155) + 1);
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: 'call terry03;

    '
  terrycbt: 'Hostile := 1;

    '
  terryend: "[]"
  terry00: |
    float_msg(self_obj, message_str(101, 101), 3);
    call terrycbt;
  terry01: |
    float_msg(self_obj, message_str(101, 105), 3);
    call terrycbt;
  terry02: |
    float_msg(self_obj, message_str(101, 106), 3);
    call terrycbt;
  terry03: 'float_msg(self_obj, message_str(101, 107), 3);

    '
  terry04: |
    float_msg(self_obj, message_str(101, 108), 3);
    call terryend;
  Critter_Action: |
    if ((global_var(35) > 0) and obj_can_see_obj(self_obj, dude_obj) and (global_var(306) < 1)) then begin
      Hostile := 1;
    end
    if (Hostile > 0) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if ((global_var(306) == 1) and (tile_num(self_obj) != 15507)) then begin
        animate_move_obj_to_tile(self_obj, 15507, 0);
      end
      else begin
        if ((global_var(306) == 1) and (tile_num(self_obj) == 15507)) then begin
          set_global_var(306, 2);
        end
        else begin
          if ((global_var(306) == 2) and (tile_num(self_obj) != 12536)) then begin
            animate_move_obj_to_tile(self_obj, 12536, 0);
          end
          else begin
            if ((tile_num(self_obj) == 12536) and (global_var(306) == 2)) then begin
              set_obj_visibility(self_obj, 1);
            end
          end
        end
      end
    end
tguard:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  combat_p_proc: |
    if (fixed_param == 4) then begin
      round_counter := round_counter + 1;
    end
    if (round_counter > 3) then begin
      if (global_var(246) == 0) then begin
        set_global_var(246, 1);
        set_global_var(155, global_var(155) - 5);
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(246) == 1) then begin
        hostile := 1;
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (obj_can_see_obj(self_obj, dude_obj) and (get_pc_stat(1) <= 5)) then begin
        if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
          if (map_var(0) == 0) then begin
            call guard11;
          end
        end
        if (global_var(246)) then begin
          hostile := 1;
        end
      end
      if (local_var(7) == 1) then begin
        if (tile_distance(tile_num(self_obj), tile_num(dude_obj)) < tile_distance(tile_num(self_obj), Warned_Tile)) then begin
          hostile := 1;
        end
      end
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(113, 100));
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(113, 100));
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      set_global_var(156, 1);
      set_global_var(157, 0);
    end
    call get_reaction;
    if (local_var(9) == 1) then begin
      float_msg(self_obj, message_str(185, 166), 0);
    end
    else begin
      if (global_var(246)) then begin
        set_local_var(4, 1);
        call guard00;
      end
      else begin
        if (global_var(26) == 1) then begin
          set_local_var(4, 1);
          call guard01;
        end
        else begin
          if ((global_var(26) == 2) and (local_var(8) == 0)) then begin
            set_local_var(4, 1);
            call guard02;
          end
          else begin
            if (global_var(26) == 3) then begin
              set_local_var(4, 1);
              call guard03;
            end
            else begin
              if (local_var(4) == 1) then begin
                if (local_var(1) < 2) then begin
                  call guard13;
                end
                else begin
                  call guard12;
                end
              end
              else begin
                set_local_var(4, 1);
                if (local_var(1) < 2) then begin
                  call guard10;
                end
                else begin
                  start_gdialog(113, self_obj, 4, -1, -1);
                  gsay_start;
                  call guard04;
                  gsay_end;
                  end_dialogue;
                end
              end
            end
          end
        end
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3) and (get_pc_stat(1) <= 5)) then begin
        hostile := 1;
        set_global_var(246, 1);
        float_msg(self_obj, message_str(113, 127), 2);
      end
      else begin
        set_map_var(0, 0);
      end
    end
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 24);
      if (local_var(10) == 0) then begin
        set_local_var(10, tile_num(self_obj));
      end
      home_tile := local_var(10);
      initialized := 1;
    end
  guard00: |
    float_msg(self_obj, message_str(113, 101), 2);
    Warned_Tile := tile_num(dude_obj);
    set_local_var(7, 1);
  guard01: 'float_msg(self_obj, message_str(113, 102), 8);

    '
  guard02: |
    float_msg(self_obj, message_str(113, 103), 8);
    set_local_var(8, 1);
    call TopReact;
  guard03: 'float_msg(self_obj, message_str(113, 104), 8);

    '
  guard04: |
    gsay_reply(113, 105);
    giq_option(4, 113, 106, guard05, 50);
    giq_option(5, 113, 107, guard07, 50);
    giq_option(-3, 113, 108, guard05, 50);
  guard05: |
    gsay_reply(113, 109);
    giq_option(4, 113, 110, guard06, 50);
    giq_option(-3, 113, 111, guardend, 50);
  guard06: |
    gsay_reply(113, 112);
    giq_option(4, 113, 114, guard06a, 50);
    giq_option(4, 113, 113, guardend, 50);
  guard07: |
    gsay_reply(113, 115);
    gsay_option(113, 126, guard07_1, 50);
  guard08: |
    gsay_reply(113, 118);
    giq_option(4, 113, 120, DownReact, 50);
    giq_option(4, 113, 119, guardend, 50);
  guard09: |
    gsay_reply(113, 121);
    call Goodbyes;
    giq_option(4, 113, exit_line, guardend, 50);
  guard10: 'float_msg(self_obj, message_str(113, 122), 2);

    '
  guard11: |
    float_msg(self_obj, message_str(113, 123), 2);
    add_timer_event(self_obj, game_ticks(15), 1);
    set_map_var(0, 1);
  guard12: 'float_msg(self_obj, message_str(113, 124), 8);

    '
  guard13: 'float_msg(self_obj, message_str(113, 125), 7);

    '
  guard06a: |
    hostile := 1;
    call BottomReact;
  guard07a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call guard09;
    end
    else begin
      call guard08;
    end
  guard07_1: |
    gsay_reply(113, 116);
    giq_option(5, 113, 117, guard07a, 50);
  guardend: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
theresa:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (((game_time / (10 * 60 * 60 * 24)) > map_var(5)) and (global_var(238) != 2)) then begin
        destroy_object(self_obj);
      end
      if ((game_time_hour >= 1700) and (game_time_hour < 1710)) then begin
        if (global_var(238) != 2) then begin
          if (not_at_meeting) then begin
            call rebel_meeting;
          end
        end
      end
      call sleeping;
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(8, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    set_global_var(238, 2);
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(378, 100));
  map_enter_p_proc: |
    if (not(local_var(4))) then begin
      set_local_var(4, tile_num(self_obj));
    end
    home_tile := local_var(4);
    critter_add_trait(self_obj, 1, 6, 87);
    sleep_tile := home_tile;
    sleep_time := 1915;
    wake_time := 715;
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (map_var(5) == 250) then begin
      set_map_var(5, (game_time / (10 * 60 * 60 * 24)) + 3);
    end
    call get_reaction;
    if (local_var(5) == 1) then begin
      float_msg(self_obj, message_str(185, 166), 0);
    end
    else begin
      if (global_var(261) or local_var(8)) then begin
        float_msg(self_obj, message_str(378, 174), 2);
      end
      else begin
        start_gdialog(378, self_obj, 4, -1, -1);
        gsay_start;
        if (global_var(101) == 2) then begin
          call Theresa24;
        end
        else begin
          if (global_var(238) == 2) then begin
            call Theresa23;
          end
          else begin
            if ((global_var(238) != 2) and (game_time_hour > 1700) and (game_time_hour < 1710)) then begin
              call Theresa15;
            end
            else begin
              if (local_var(1) >= 2) then begin
                call Theresa01;
              end
              else begin
                call Theresa14;
              end
            end
          end
        end
        gsay_end;
        end_dialogue;
      end
    end
    if (exp_flag) then begin
      exp_flag := 0;
      give_exp_points(750);
      display_msg(message_str(378, 173));
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      not_at_meeting := 1;
    end
    else begin
      if (fixed_param == 2) then begin
        call begin_meeting;
      end
      else begin
        if (fixed_param == 3) then begin
          call say_lines;
        end
        else begin
          if (fixed_param == 4) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
            add_timer_event(self_obj, game_ticks(60), 2);
          end
        end
      end
    end
  Theresa01: |
    gsay_reply(378, message_str(378, 101) + proto_data(obj_pid(dude_obj), 1) + message_str(378, 102));
    giq_option(4, 378, 103, Theresa02, 50);
    giq_option(4, 378, 104, Theresa03, 50);
    giq_option(-3, 378, 105, Theresa04, 50);
  Theresa02: |
    gsay_reply(378, 106);
    giq_option(4, 378, 107, Theresa05, 51);
    giq_option(4, 378, 108, Theresa06, 50);
    giq_option(4, 378, 109, Theresa07, 50);
    giq_option(6, 378, 110, Theresa02a, 50);
  Theresa02a: |
    variable LVar0 := 0;
    if (not(local_var(7))) then begin
      set_local_var(7, 1);
      LVar0 := roll_vs_skill(dude_obj, 14, 0);
      if (is_success(LVar0)) then begin
        call Theresa08;
      end
      else begin
        call Theresa09;
      end
    end
    else begin
      call Theresa25;
    end
  Theresa03: |
    gsay_reply(378, 111);
    giq_option(4, 378, 112, Theresa07, 50);
    giq_option(4, 378, 113, Theresa06, 50);
  Theresa04: 'gsay_message(378, 114, 50);

    '
  Theresa05: |
    call DownReact;
    gsay_reply(378, 115);
    giq_option(4, 378, 116, Theresa09, 50);
    giq_option(6, 378, 117, Theresa02a, 50);
  Theresa06: 'gsay_message(378, 118, 50);

    '
  Theresa07: |
    gsay_reply(378, 119);
    giq_option(4, 378, 120, Theresa11, 50);
    giq_option(4, 378, 121, Theresa12, 50);
  Theresa08: |
    call UpReact;
    set_global_var(238, 2);
    line := 10;
    exp_flag := 1;
    gsay_reply(378, 122);
    giq_option(4, 378, 123, TheresaEnd, 50);
  Theresa09: |
    call DownReact;
    gsay_message(378, 124, 50);
  Theresa11: |
    call DownReact;
    gsay_reply(378, 126);
    giq_option(4, 378, 127, TheresaEnd, 50);
    giq_option(6, 378, 128, Theresa02a, 50);
  Theresa12: |
    call UpReact;
    gsay_reply(378, 129);
    giq_option(4, 378, 130, Theresa13, 50);
    if (global_var(68) != 0) then begin
      giq_option(4, 378, 131, Theresa13, 50);
    end
  Theresa13: 'gsay_message(378, 132, 50);

    '
  Theresa14: 'gsay_message(378, 133, 50);

    '
  Theresa15: |
    gsay_reply(378, 134);
    giq_option(4, 378, 135, Theresa16, 51);
    giq_option(4, 378, 136, Theresa17, 50);
    giq_option(6, 378, 137, Theresa18, 50);
    giq_option(-3, 378, 138, TheresaEnd, 50);
  Theresa16: |
    call DownReact;
    gsay_reply(378, 139);
    giq_option(4, 378, 140, Theresa20, 50);
    giq_option(4, 378, 141, TheresaEnd, 50);
  Theresa17: |
    gsay_reply(378, 142);
    giq_option(4, 378, 143, Theresa19, 50);
    giq_option(6, 378, 144, Theresa21, 50);
  Theresa18: |
    gsay_reply(378, 145);
    giq_option(6, 378, 146, Theresa21, 50);
    giq_option(6, 378, 147, Theresa19, 50);
  Theresa19: |
    gsay_reply(378, 148);
    giq_option(4, 378, 149, TheresaCombat, 51);
    giq_option(4, 378, 150, TheresaEnd, 50);
  Theresa20: |
    gsay_reply(378, 151);
    giq_option(4, 378, 152, Theresa17, 50);
    giq_option(6, 378, 153, Theresa21, 50);
  Theresa21: |
    if (local_var(7)) then begin
      call Theresa25;
    end
    else begin
      set_local_var(7, 1);
      if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
        exp_flag := 1;
        set_global_var(238, 2);
        line := 10;
        gsay_message(378, 154, 50);
      end
      else begin
        gsay_reply(378, 155);
        giq_option(4, 378, 156, TheresaCombat, 51);
        giq_option(4, 378, 157, TheresaEnd, 50);
      end
    end
  Theresa23: |
    gsay_reply(378, 170);
    giq_option(4, 378, 171, TheresaEnd, 50);
    giq_option(-3, 378, 138, TheresaEnd, 50);
  Theresa24: |
    if (global_var(238) != 2) then begin
      set_global_var(238, 2);
      exp_flag := 0;
      line := 10;
    end
    gsay_message(378, 172, 50);
  Theresa25: 'gsay_message(378, 175, 50);

    '
  TheresaEnd: "[]"
  TheresaCombat: 'hostile := 1;

    '
  begin_meeting: |
    animate_move_obj_to_tile(self_obj, home_tile, 0);
    line := 1;
    add_timer_event(self_obj, game_ticks(10), 3);
  say_lines: |
    variable LVar0 := 0;
    LVar0 := message_str(378, 159 + line);
    float_msg(self_obj, LVar0, 0);
    line := line + 1;
    if (line < 11) then begin
      add_timer_event(self_obj, game_ticks(10), 3);
    end
    else begin
      add_timer_event(self_obj, game_ticks(600), 1);
    end
  rebel_meeting: |
    not_at_meeting := 0;
    add_timer_event(self_obj, game_ticks(3), 4);
  sleeping: |
    if (local_var(5) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(5, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(5, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(5, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(5, 1);
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
thomas:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 64);
      my_hex := tile_num(self_obj);
      set_map_var(1, tile_num_in_direction(my_hex, 4, 1));
      my_knife := obj_carrying_pid_obj(self_obj, 4);
      who := local_var(1);
      fell := local_var(2);
      st_fall := local_var(4);
      st_dodge := local_var(3);
      lesson_ptr := local_var(5);
      if (who < 1) then begin
        who := 0;
      end
      if (fell < 1) then begin
        fell := 0;
      end
      call prepare_for_combat;
      Student_ptr := 0;
      valid := 1;
      initialized := 1;
    end
    if (script_action == 18) then begin
      call destroy_p_proc;
    end
    if (script_action == 22) then begin
      if (global_var(250) == 0) then begin
        if ((valid == 1) and (Student_ptr != 0)) then begin
          call do_combat;
        end
        else begin
          add_timer_event(self_obj, game_ticks(5), 0);
        end
      end
    end
    else begin
      if (script_action == 12) then begin
        if (global_var(250)) then begin
          hostile := 1;
        end
        if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
          hostile := 0;
        end
        if (hostile) then begin
          set_global_var(250, 1);
          hostile := 0;
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
        if (global_var(250) == 0) then begin
          call critter_p_proc;
        end
      end
    end
  give_skill: |
    set_local_var(11, 1);
    float_msg(dude_obj, message_str(633, 301), 9);
  prepare_for_combat: |
    if (student_armed) then begin
      st_manuver0 := 41;
      st_manuver1 := 42;
      st_manuver2 := 40;
      wait3 := 0;
    end
    else begin
      st_manuver0 := 16;
      st_manuver1 := 17;
      st_manuver2 := 13;
      wait3 := 4;
    end
    if (instructor_armed) then begin
      in_manuver0 := 41;
      in_manuver1 := 42;
      in_manuver2 := 40;
      wait2 := 0;
    end
    else begin
      in_manuver0 := 16;
      in_manuver1 := 17;
      in_manuver2 := 13;
      wait2 := 4;
    end
  do_combat: |
    if (local_var(0) > 1) then begin
      if (local_var(0) == 2) then begin
        call lesson1;
      end
    end
    else begin
      if (comment) then begin
        if (random(1, 10) < comment) then begin
          call praise;
        end
        comment := 0;
      end
      if (fell > 0) then begin
        call recover_from_combat;
      end
      else begin
        phase := phase + 1;
        atk := random(0, 1);
        if (atk) then begin
          atk := 3;
        end
        x := random(1, 100);
        if (who == 0) then begin
          if (x < 81) then begin
            outcome := 0;
          end
          else begin
            if (x < 98) then begin
              comment := 3;
              outcome := 1;
            end
            else begin
              if (phase > 6) then begin
                comment := 6;
                outcome := 2;
              end
              else begin
                comment := 3;
                outcome := 1;
              end
            end
          end
        end
        else begin
          if (x < st_fall) then begin
            comment := 6;
            outcome := 2;
          end
          else begin
            if (x < st_dodge) then begin
              comment := 3;
              outcome := 0;
            end
            else begin
              comment := 4;
              st_fall := st_fall + 2;
              set_local_var(4, st_fall);
              outcome := 1;
            end
          end
        end
        sequence := atk + outcome;
        if (local_var(10)) then begin
          call do_round;
        end
        else begin
          fell := 2;
          who := 0;
          set_local_var(2, fell);
          set_local_var(1, who);
        end
        who := 1 - who;
        set_local_var(1, who);
        add_timer_event(self_obj, game_ticks(2), 0);
      end
    end
  recover_from_combat: |
    if (local_var(10) == 1) then begin
      reg_anim_func(2, self_obj);
      reg_anim_func(2, Student_ptr);
      reg_anim_func(1, 1);
      if (fell == 1) then begin
        reg_anim_animate(Student_ptr, 0, -1);
        reg_anim_animate(self_obj, 37, -1);
      end
      else begin
        reg_anim_animate(self_obj, 0, -1);
        reg_anim_animate(Student_ptr, 37, -1);
      end
      reg_anim_func(3, 0);
    end
    else begin
      set_local_var(10, 1);
    end
    set_local_var(7, 0);
    fell := 0;
    set_local_var(2, fell);
    set_local_var(0, 0);
    set_map_var(0, 0);
  pick_a_student: |
    fell := 0;
    set_local_var(2, fell);
    set_map_var(0, 0);
    temp := random(1, map_var(5));
    set_local_var(8, temp);
    if (temp == local_var(9)) then begin
      set_local_var(8, local_var(9) + 1);
      if (local_var(8) > map_var(5)) then begin
        set_local_var(8, 1);
      end
    end
    set_map_var(2, local_var(8));
    set_local_var(9, local_var(8));
    student_armed := 0;
    instructor_armed := 0;
    if (instructor_armed) then begin
      wield_obj_critter(self_obj, my_knife);
    end
    st_fall := random(5, 15) + 1;
    set_local_var(4, st_fall);
    st_dodge := random(20, 40) + 1;
    set_local_var(3, st_dodge);
  praise: |
    temp := random(0, 2);
    if (comment == 3) then begin
      float_msg(self_obj, message_str(633, 200 + temp), 3);
    end
    else begin
      if (comment == 4) then begin
        float_msg(self_obj, message_str(633, 203 + temp), 3);
      end
      else begin
        if (comment == 6) then begin
          if (fell == 2) then begin
            float_msg(self_obj, message_str(633, 206 + temp), 3);
          end
          else begin
            float_msg(self_obj, message_str(633, 209 + temp), 3);
          end
        end
      end
    end
  lesson1: |
    delay := 4;
    if (lesson_ptr < 6) then begin
      float_msg(self_obj, message_str(633, 100 + lesson_ptr), 3);
    end
    else begin
      if (lesson_ptr == 6) then begin
        who := 0;
        sequence := 0;
        delay := 2;
        call do_round;
      end
      else begin
        if (lesson_ptr == 7) then begin
          who := 0;
          sequence := 0;
          delay := 2;
          call do_round;
        end
        else begin
          if (lesson_ptr == 8) then begin
            who := 1;
            sequence := 1;
            delay := 2;
            call do_round;
          end
          else begin
            if ((lesson_ptr > 8) and (lesson_ptr < 12)) then begin
              float_msg(self_obj, message_str(633, 100 + lesson_ptr), 3);
            end
            else begin
              if (lesson_ptr == 12) then begin
                float_msg(Student_ptr, message_str(633, 112), 8);
              end
              else begin
                if (lesson_ptr == 13) then begin
                  float_msg(Student_ptr, message_str(633, 113), 8);
                end
                else begin
                  if ((lesson_ptr > 13) and (lesson_ptr < 18)) then begin
                    float_msg(self_obj, message_str(633, 100 + lesson_ptr), 3);
                  end
                  else begin
                    if (lesson_ptr == 19) then begin
                      if (obj_can_see_obj(dude_obj, self_obj)) then begin
                        call give_skill;
                      end
                      call pick_a_student;
                    end
                    else begin
                      if (lesson_ptr == 20) then begin
                        float_msg(self_obj, message_str(633, 118), 3);
                      end
                      else begin
                        if (lesson_ptr == 21) then begin
                          who := 0;
                          sequence := 0;
                          delay := 2;
                          call do_round;
                        end
                        else begin
                          if (lesson_ptr == 22) then begin
                            who := 0;
                            sequence := 0;
                            delay := 2;
                            call do_round;
                          end
                          else begin
                            if (lesson_ptr == 23) then begin
                              who := 1;
                              sequence := 0;
                              delay := 2;
                              call do_round;
                            end
                            else begin
                              if (lesson_ptr == 24) then begin
                                who := 0;
                                sequence := 0;
                                delay := 2;
                                call do_round;
                              end
                              else begin
                                if (lesson_ptr == 25) then begin
                                  float_msg(self_obj, message_str(633, 119), 3);
                                end
                                else begin
                                  if (lesson_ptr == 26) then begin
                                    float_msg(self_obj, message_str(633, 120), 3);
                                  end
                                  else begin
                                    if (lesson_ptr == 27) then begin
                                      float_msg(self_obj, message_str(633, 121), 3);
                                    end
                                    else begin
                                      if (lesson_ptr == 28) then begin
                                        float_msg(self_obj, message_str(633, 122), 3);
                                      end
                                      else begin
                                        if (lesson_ptr == 29) then begin
                                          float_msg(Student_ptr, message_str(633, 107), 8);
                                        end
                                        else begin
                                          if (lesson_ptr == 30) then begin
                                            float_msg(self_obj, message_str(633, 123), 3);
                                          end
                                          else begin
                                            if (lesson_ptr == 31) then begin
                                              float_msg(self_obj, message_str(633, 124), 3);
                                            end
                                            else begin
                                              if (lesson_ptr == 32) then begin
                                                float_msg(self_obj, message_str(633, 125), 3);
                                              end
                                              else begin
                                                if (lesson_ptr == 33) then begin
                                                  float_msg(Student_ptr, message_str(633, 126), 8);
                                                end
                                                else begin
                                                  if (lesson_ptr == 34) then begin
                                                    float_msg(self_obj, message_str(633, 127), 3);
                                                  end
                                                  else begin
                                                    if (lesson_ptr == 35) then begin
                                                      float_msg(self_obj, message_str(633, 128), 3);
                                                    end
                                                    else begin
                                                      if (lesson_ptr == 36) then begin
                                                        float_msg(self_obj, message_str(633, 108), 3);
                                                      end
                                                    end
                                                  end
                                                end
                                              end
                                            end
                                          end
                                        end
                                      end
                                    end
                                  end
                                end
                              end
                            end
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    lesson_ptr := lesson_ptr + 1;
    set_local_var(5, lesson_ptr);
    if (lesson_ptr > 36) then begin
      set_local_var(0, 0);
      set_local_var(6, 1);
      if (local_var(11) == 1) then begin
        display_msg(message_str(766, 116) + 5 + message_str(766, 120));
        critter_mod_skill(dude_obj, 3, 5);
        display_msg(message_str(766, 116) + 5 + message_str(766, 121));
        critter_mod_skill(dude_obj, 4, 5);
        display_msg(message_str(633, 300));
        give_exp_points(500);
      end
    end
    else begin
      add_timer_event(self_obj, game_ticks(delay), 0);
    end
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  critter_p_proc: |
    if (map_var(0) == 1) then begin
      if (local_var(0) < 1) then begin
        set_local_var(0, 1);
        phase := 0;
        if (obj_can_see_obj(dude_obj, self_obj)) then begin
          if (local_var(6) != 1) then begin
            lesson_ptr := 1;
            set_local_var(5, lesson_ptr);
            set_local_var(0, 2);
          end
        end
        add_timer_event(self_obj, game_ticks(5), 0);
      end
    end
    else begin
      if (local_var(7) == 0) then begin
        set_local_var(7, 1);
        call pick_a_student;
      end
    end
  do_round: |
    set_local_var(1, who);
    reg_anim_func(2, self_obj);
    reg_anim_func(2, Student_ptr);
    reg_anim_func(1, 1);
    if (who == 0) then begin
      if (student_armed) then begin
        student_armed := 0;
      end
      else begin
        if (sequence == 0) then begin
          reg_anim_animate(Student_ptr, st_manuver0, -1);
          reg_anim_animate(self_obj, in_manuver2, wait2);
        end
        else begin
          if (sequence == 1) then begin
            reg_anim_animate(Student_ptr, st_manuver0, -1);
            reg_anim_animate(self_obj, 14, 4);
          end
          else begin
            if (sequence == 2) then begin
              fell := 1;
              set_local_var(2, fell);
              reg_anim_animate(Student_ptr, st_manuver0, -1);
              reg_anim_animate(self_obj, 20, 4);
            end
            else begin
              if (sequence == 3) then begin
                reg_anim_animate(Student_ptr, st_manuver1, -1);
                reg_anim_animate(self_obj, in_manuver2, wait2 + 2);
              end
              else begin
                if (sequence == 4) then begin
                  reg_anim_animate(Student_ptr, st_manuver1, -1);
                  reg_anim_animate(self_obj, 14, 6);
                end
                else begin
                  if (sequence == 5) then begin
                    fell := 1;
                    set_local_var(2, fell);
                    reg_anim_animate(Student_ptr, st_manuver1, -1);
                    reg_anim_animate(self_obj, 20, 6);
                  end
                end
              end
            end
          end
        end
      end
    end
    else begin
      if (local_var(10) == 0) then begin
        set_local_var(10, 1);
        sequence := 5;
      end
      if (instructor_armed) then begin
        instructor_armed := 0;
      end
      else begin
        if (sequence == 0) then begin
          reg_anim_animate(self_obj, in_manuver0, -1);
          reg_anim_animate(Student_ptr, st_manuver2, wait3);
        end
        else begin
          if (sequence == 1) then begin
            reg_anim_animate(self_obj, in_manuver0, -1);
            reg_anim_animate(Student_ptr, 14, 4);
          end
          else begin
            if (sequence == 2) then begin
              fell := 2;
              set_local_var(2, fell);
              reg_anim_animate(self_obj, in_manuver0, -1);
              reg_anim_animate(Student_ptr, 20, 4);
            end
            else begin
              if (sequence == 3) then begin
                reg_anim_animate(self_obj, in_manuver1, -1);
                reg_anim_animate(Student_ptr, st_manuver2, wait3 + 2);
              end
              else begin
                if (sequence == 4) then begin
                  reg_anim_animate(self_obj, in_manuver1, -1);
                  reg_anim_animate(Student_ptr, 14, 6);
                end
                else begin
                  if (sequence == 5) then begin
                    fell := 2;
                    set_local_var(2, fell);
                    reg_anim_animate(self_obj, in_manuver1, -1);
                    reg_anim_animate(Student_ptr, 20, 6);
                  end
                end
              end
            end
          end
        end
      end
    end
    reg_anim_func(3, 0);
thomas2:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 64);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (global_var(250)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
    if (hostile) then begin
      set_global_var(250, 1);
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(685, self_obj, 4, -1, -1);
    gsay_start;
    call Do_Dialogue;
    gsay_end;
    end_dialogue;
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(685, 100));
  Do_Dialogue: |
    if (local_var(4) != 1) then begin
      set_local_var(4, 1);
      if (local_var(1) == 1) then begin
        call thomas01;
      end
      else begin
        call thomas00;
      end
    end
    else begin
      if (local_var(1) == 1) then begin
        if (local_var(6) != 0) then begin
          call thomas09;
        end
        else begin
          call thomas08;
        end
      end
      else begin
        if (local_var(6) != 0) then begin
          call thomas20;
        end
        else begin
          call thomas19;
        end
      end
    end
  thomasend: "[]"
  thomas00: |
    gsay_reply(685, 101);
    giq_option(4, 685, 102, thomas05, 50);
    giq_option(4, 685, 103, thomas06, 50);
    giq_option(4, 685, 104, thomas04, 50);
    giq_option(4, 685, 105, thomasend, 50);
    giq_option(-3, 685, 106, thomas02, 50);
  thomas01: |
    gsay_reply(685, 108);
    giq_option(4, 685, 102, thomas05, 50);
    giq_option(4, 685, 103, thomas06, 50);
    giq_option(4, 685, 104, thomas04, 50);
    giq_option(4, 685, 105, thomasend, 50);
    giq_option(-3, 685, 106, thomas02, 50);
  thomas02: 'gsay_message(685, 109, 51);

    '
  thomas03: 'gsay_message(685, 110, 51);

    '
  thomas04: 'gsay_message(685, message_str(685, 111) + proto_data(obj_pid(dude_obj),
    1) + message_str(685, 112), 51);

    '
  thomas05: 'gsay_message(685, 113, 50);

    '
  thomas06: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_reply(685, 114);
    end
    else begin
      gsay_reply(685, 115);
    end
    call thomas10;
  thomas07: |
    gsay_reply(685, 125);
    call thomas10;
  thomas08: |
    if (local_var(5) != 0) then begin
      set_local_var(5, 1);
      gsay_reply(685, 126);
    end
    else begin
      gsay_reply(685, 127);
    end
    call thomas10;
  thomas09: |
    gsay_reply(685, 125);
    giq_option(4, 685, 102, thomas05, 50);
    giq_option(4, 685, 103, thomas06, 50);
    giq_option(4, 685, 104, thomas04, 50);
    giq_option(4, 685, 105, thomas21, 50);
    giq_option(-3, 685, 107, thomas02, 50);
  thomas10: |
    giq_option(4, 685, 118, thomas11, 50);
    giq_option(4, 685, 119, thomas12, 50);
    giq_option(4, 685, 120, thomas13, 50);
    giq_option(4, 685, 121, thomas14, 50);
    giq_option(4, 685, 122, thomas15, 50);
    giq_option(4, 685, 123, thomas16, 50);
    giq_option(4, 685, 124, thomas17, 50);
    giq_option(-3, 685, 106, thomas02, 50);
  thomas11: |
    gfade_out(600);
    gfade_in(600);
    display_msg(message_str(685, 130));
    set_local_var(6, 1);
  thomas12: |
    gfade_out(600);
    gfade_in(600);
    display_msg(message_str(685, 132));
    set_local_var(6, 1);
  thomas13: |
    gfade_out(600);
    gfade_in(600);
    display_msg(message_str(685, 134));
    set_local_var(6, 1);
  thomas14: |
    gfade_out(600);
    gfade_in(600);
    display_msg(message_str(685, 135));
    set_local_var(6, 1);
  thomas15: |
    gfade_out(600);
    gfade_in(600);
    display_msg(message_str(685, 136));
    set_local_var(6, 1);
  thomas16: |
    gfade_out(600);
    gfade_in(600);
    display_msg(message_str(685, 137));
    set_local_var(6, 1);
  thomas17: 'gsay_message(685, 138, 50);

    '
  thomas18: 'gsay_message(685, 139, 51);

    '
  thomas19: |
    if (local_var(5) != 0) then begin
      set_local_var(5, 1);
      gsay_reply(685, 140);
    end
    else begin
      gsay_reply(685, 127);
    end
    call thomas10;
  thomas20: |
    gsay_reply(685, 140);
    giq_option(4, 685, 102, thomas03, 50);
    giq_option(4, 685, 103, thomas07, 50);
    giq_option(4, 685, 104, thomas04, 50);
    giq_option(4, 685, 105, thomas22, 50);
    giq_option(-3, 685, 107, thomas02, 50);
  thomas21: 'gsay_message(685, 142, 50);

    '
  thomas22: 'gsay_message(685, 143, 51);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
thorndyk:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((map_var(6) == 1) and (obj_can_see_obj(self_obj, dude_obj) == 1)) then begin
      call combat;
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    variable LVar0 := 0;
    call get_reaction;
    if (global_var(195) == 1) then begin
      call Thorn00;
    end
    else begin
      if (local_var(5) == 1) then begin
        call Thorn28;
      end
      else begin
        if (map_var(0) == 1) then begin
          call Thorn29;
        end
        else begin
          if ((global_var(158) == 1) or (global_var(156) == 1)) then begin
            call Thorn01;
          end
          else begin
            start_gdialog(603, self_obj, 4, -1, -1);
            gsay_start;
            call Thorn02;
            gsay_end;
            end_dialogue;
          end
        end
      end
    end
    if (HealPlayer == 1) then begin
      HealPlayer := 0;
      set_local_var(6, game_time / (10 * 60 * 60));
      if (PlayerYellsOuch == 1) then begin
        PlayerYellsOuch := 0;
        float_msg(dude_obj, 168, 9);
      end
      float_msg(self_obj, message_str(603, DoctorPostTreatmentResponse), 2);
      LVar0 := random(5, 15) + 10;
      critter_heal(dude_obj, LVar0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(603, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_map_var(6, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      Thorndyke_Ptr := self_obj;
      critter_add_trait(self_obj, 1, 6, 72);
      critter_add_trait(self_obj, 1, 5, 77);
    end
  flee_dude: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    while(LVar1 < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), LVar1, 3)) > LVar2) then begin
        LVar0 := tile_num_in_direction(tile_num(self_obj), LVar1, 3);
        LVar2 := tile_distance(tile_num(dude_obj), LVar0);
      end
      LVar1 := LVar1 + 1;
    end
    animate_move_obj_to_tile(self_obj, LVar0, 0);
  Thorn00: |
    float_msg(self_obj, message_str(603, 101), 2);
    call flee_dude;
  Thorn01: |
    float_msg(self_obj, message_str(603, 102), 2);
    call flee_dude;
  Thorn02: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := get_critter_stat(dude_obj, 35);
    LVar1 := get_critter_stat(dude_obj, 7);
    if (LVar0 == LVar1) then begin
      if (get_critter_stat(dude_obj, 34) == 0) then begin
        gsay_reply(603, 103);
      end
      else begin
        gsay_reply(603, 104);
      end
      giq_option(7, 603, 105, Thorn02a, 49);
      giq_option(7, 603, 106, Thorn05, 50);
      giq_option(4, 603, 107, Thorn06, 50);
      giq_option(4, 603, 108, Thorn07, 50);
      giq_option(4, 603, 109, Thorn08, 51);
      giq_option(-3, 603, 110, Thorn09, 51);
    end
    else begin
      if ((LVar0 < LVar1) and (((game_time / (10 * 60 * 60)) - local_var(6)) < 24)) then begin
        if (get_critter_stat(dude_obj, 34) == 0) then begin
          gsay_reply(603, 111);
        end
        else begin
          gsay_reply(603, 112);
        end
        giq_option(7, 603, 113, Thorn02a, 50);
        giq_option(7, 603, 114, Thorn05, 50);
        giq_option(4, 603, 115, Thorn27, 51);
        giq_option(4, 603, 116, Thorn07, 49);
        giq_option(4, 603, 117, Thorn08, 51);
        giq_option(-3, 603, 118, Thorn09, 50);
      end
      else begin
        if ((LVar0 > (LVar1 / 2)) and (((game_time / (10 * 60 * 60)) - local_var(6)) > 24)) then begin
          if (get_critter_stat(dude_obj, 34) == 0) then begin
            gsay_reply(603, 119);
          end
          else begin
            gsay_reply(603, 120);
          end
          giq_option(7, 603, 121, Thorn10, 50);
          giq_option(7, 603, 122, Thorn10, 50);
          giq_option(4, 603, 123, Thorn11, 50);
          giq_option(4, 603, 124, Thorn12, 50);
          giq_option(4, 603, 125, Thorn13, 50);
          giq_option(4, 603, 126, Thorn14, 50);
          giq_option(-3, 603, 127, Thorn15, 50);
          giq_option(-3, 603, 128, Thorn16, 50);
        end
        else begin
          if ((LVar0 < (LVar1 / 2)) and (((game_time / (10 * 60 * 60)) - local_var(6)) > 24)) then begin
            if (get_critter_stat(dude_obj, 34) == 0) then begin
              gsay_reply(603, 129);
            end
            else begin
              gsay_reply(603, 130);
            end
            giq_option(7, 603, 131, Thorn10, 50);
            giq_option(7, 603, 132, Thorn10, 50);
            giq_option(4, 603, 133, Thorn11, 50);
            giq_option(4, 603, 124, Thorn12, 50);
            giq_option(4, 603, 134, Thorn13, 50);
            giq_option(4, 603, 135, Thorn14, 50);
            giq_option(-3, 603, 136, Thorn15, 50);
            giq_option(-3, 603, 137, Thorn16, 50);
          end
        end
      end
    end
  Thorn02a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0)) == 1) then begin
      call Thorn03;
    end
    else begin
      call Thorn04;
    end
  Thorn03: |
    gsay_reply(603, 138);
    giq_option(7, 603, 139, Thorn03a, 50);
    giq_option(7, 603, 140, Thorn03b, 50);
    giq_option(7, 603, 141, Thorn05, 50);
    giq_option(4, 603, 142, Thorn07, 50);
    giq_option(4, 603, 143, Thorn19, 50);
  Thorn03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0)) == 1) then begin
      call Thorn17;
    end
    else begin
      call Thorn04;
    end
  Thorn03b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0)) == 1) then begin
      call Thorn18;
    end
    else begin
      call Thorn04;
    end
  Thorn04: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(603, 144, 50);
    end
    else begin
      gsay_message(603, 145, 50);
    end
  Thorn05: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(603, 146, 50);
    end
    else begin
      gsay_message(603, 147, 50);
    end
  Thorn06: 'gsay_message(603, 148, 50);

    '
  Thorn07: 'gsay_message(603, 149, 50);

    '
  Thorn08: 'gsay_message(603, 150, 51);

    '
  Thorn09: 'gsay_message(603, 151, 50);

    '
  Thorn10: |
    gsay_reply(603, 152);
    giq_option(7, 603, 153, Thorn20, 51);
    giq_option(7, 603, 154, Thorn20, 50);
    giq_option(4, 603, 155, Thorn11, 50);
    giq_option(4, 603, 156, Thorn12, 49);
    giq_option(4, 603, 157, Thorn13, 50);
    giq_option(4, 603, 158, Thorn14, 50);
  Thorn11: |
    gsay_reply(603, 159);
    giq_option(4, 603, 160, Thorn12, 50);
    giq_option(4, 603, 157, Thorn13, 50);
    giq_option(4, 603, 162, Thorn24, 51);
    giq_option(4, 603, 163, Thorn14, 50);
  Thorn12: |
    DoctorPostTreatmentResponse := 164;
    PlayerYellsOuch := 0;
    HealPlayer := 1;
    gsay_message(603, 161, 50);
  Thorn13: 'gsay_message(603, 165, 50);

    '
  Thorn14: 'gsay_message(603, 166, 50);

    '
  Thorn15: |
    DoctorPostTreatmentResponse := 169;
    PlayerYellsOuch := 1;
    HealPlayer := 1;
    gsay_message(603, 167, 50);
  Thorn16: 'gsay_message(603, 170, 50);

    '
  Thorn17: |
    gsay_reply(603, 171);
    giq_option(7, 603, 172, Thorn17a, 50);
    giq_option(4, 603, 173, Thorn27, 50);
    giq_option(4, 603, 174, Thorn27, 50);
    giq_option(4, 603, 175, Thorn14, 50);
  Thorn17a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0)) == 1) then begin
      call Thorn21;
    end
    else begin
      call Thorn04;
    end
  Thorn18: |
    gsay_reply(603, 176);
    giq_option(7, 603, 177, Thorn18a, 50);
    giq_option(4, 603, 178, Thorn24, 51);
    giq_option(4, 603, 179, Thorn27, 50);
    giq_option(4, 603, 180, Thorn24, 51);
    giq_option(4, 603, 181, Thorn14, 50);
  Thorn18a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0)) == 1) then begin
      call Thorn22;
    end
    else begin
      call Thorn04;
    end
  Thorn19: 'gsay_message(603, 182, 50);

    '
  Thorn20: |
    gsay_reply(603, 183);
    giq_option(7, 603, 184, Thorn23, 51);
    giq_option(4, 603, 185, Thorn24, 51);
    giq_option(4, 603, 186, Thorn12, 49);
    giq_option(4, 603, 187, Thorn13, 50);
    giq_option(4, 603, 188, Thorn14, 50);
  Thorn21: |
    gsay_reply(603, 189);
    giq_option(7, 603, 190, Thorn25, 50);
    giq_option(4, 603, 191, Thorn27, 50);
    giq_option(4, 603, 192, Thorn27, 50);
    giq_option(4, 603, 193, Thorn24, 51);
  Thorn22: |
    gsay_reply(603, 194);
    giq_option(7, 603, 195, Thorn22a, 50);
    giq_option(4, 603, 196, Thorn22b, 50);
    giq_option(4, 603, 197, Thorn27, 50);
    giq_option(4, 603, 198, Thorn27, 50);
    giq_option(4, 603, 199, Thorn24, 51);
  Thorn22a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0)) == 1) then begin
      call Thorn25;
    end
    else begin
      call Thorn04;
    end
  Thorn22b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0)) == 1) then begin
      call Thorn26;
    end
    else begin
      call Thorn04;
    end
  Thorn23: |
    set_local_var(5, 1);
    gsay_message(603, 200, 51);
  Thorn24: |
    set_local_var(5, 1);
    gsay_message(603, 201, 51);
  Thorn25: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(603, 202, 50);
    end
    else begin
      gsay_message(603, 203, 50);
    end
  Thorn26: |
    gsay_reply(603, 204);
    giq_option(7, 603, 205, Thorn27, 50);
    giq_option(4, 603, 206, Thorn07, 50);
    giq_option(4, 603, 207, Thorn24, 51);
    giq_option(4, 603, 208, Thorn24, 51);
    giq_option(4, 603, 209, Thorn27, 51);
  Thorn27: 'gsay_message(603, 210, 50);

    '
  Thorn28: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      float_msg(self_obj, message_str(603, 211), 2);
    end
    else begin
      float_msg(self_obj, message_str(603, 212), 2);
    end
  Thorn29: 'float_msg(self_obj, message_str(603, 213), 2);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
thsupmut:
  start: |
    if (ONLY_ONCE) then begin
      ONLY_ONCE := 0;
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 49);
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 21) then begin
          call look_at_p_proc;
        end
        else begin
          if (script_action == 4) then begin
            call pickup_p_proc;
          end
          else begin
            if (script_action == 11) then begin
              call talk_p_proc;
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (Hostile) then begin
      Hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    if (rndx == 0) then begin
      rndx := random(100, 109);
    end
    display_msg(message_str(265, rndx));
  pickup_p_proc: 'Hostile := 1;

    '
  talk_p_proc: |
    script_overrides;
    start_gdialog(265, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(0)) then begin
      call goto7;
    end
    else begin
      call goto0;
    end
    gsay_end;
    end_dialogue;
  goto0: |
    set_local_var(0, 1);
    gsay_reply(265, 110);
    giq_option(-3, 265, 111, goto1, 50);
    giq_option(4, 265, 112, combat, 50);
    giq_option(4, 265, 113, goto2, 50);
    giq_option(6, 265, 114, goto3, 50);
  goto1: |
    gsay_message(265, 115, 50);
    call combat;
  goto2: |
    gsay_message(265, 116, 50);
    call combat;
  goto3: |
    gsay_reply(265, 117);
    giq_option(6, 265, 118, goto4, 50);
    giq_option(6, 265, 119, goto6, 50);
  goto4: |
    gsay_reply(265, 120);
    giq_option(6, 265, 121, combat, 50);
    giq_option(6, 265, 122, combat, 50);
    giq_option(8, 265, 123, goto5, 50);
  goto5: |
    gsay_reply(265, 124);
    giq_option(8, 265, 125, combat, 50);
    giq_option(8, 265, 126, combat, 50);
  goto6: |
    gsay_message(265, 127, 50);
    call combat;
  goto7: |
    gsay_message(265, 128, 50);
    call combat;
  combat: 'Hostile := 1;

    '
  gotoend: "[]"
thug:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 29);
      critter_add_trait(self_obj, 1, 5, 11);
      if (cur_map_index != 29) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        my_script_mode := 1;
      end
      else begin
        if (global_var(123) == 3) then begin
          move_to(self_obj, 7000, 0);
          set_obj_visibility(self_obj, 1);
        end
      end
      initialized := 1;
    end
    else begin
      if (not(my_script_mode)) then begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(383, 100));
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: 'float_msg(self_obj, message_str(383, 100 + random(1, 5)), 2);

    '
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
toggle:
  start: "[]"
  use_p_proc: |
    if (global_var(262) == 0) then begin
      set_global_var(262, 1);
    end
    else begin
      set_global_var(262, 0);
    end
tolya:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 6);
      critter_add_trait(self_obj, 1, 5, 20);
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(140, 100));
  talk_p_proc: |
    if (global_var(116) == 1) then begin
      float_msg(self_obj, message_str(136, random(102, 106)), 8);
    end
    else begin
      call do_dialogue;
    end
  critter_p_proc: |
    call Critter_Action;
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: 'hostile := 1;

    '
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    set_global_var(254, 1);
    set_global_var(611, 0);
    set_global_var(115, global_var(115) - 1);
  damage_p_proc: |
    if (global_var(116) == 0) then begin
      set_global_var(254, 1);
    end
  do_dialogue: |
    set_local_var(3, 1);
    call get_reaction;
    start_gdialog(140, self_obj, 4, -1, -1);
    gsay_start;
    if (local_var(4) == 5) then begin
      call tolya10;
    end
    else begin
      set_local_var(4, local_var(4) + 1);
      call tolya00;
    end
    gsay_end;
    end_dialogue;
  tolya00: |
    gsay_reply(140, 101);
    giq_option(4, 140, message_str(140, 102) + proto_data(obj_pid(dude_obj), 1) + message_str(140, 103), tolya01, 50);
    giq_option(5, 140, 104, tolya02, 50);
    giq_option(-3, 140, 105, tolya03, 50);
  tolya01: |
    gsay_reply(140, 106);
    giq_option(4, 140, 107, tolya04, 50);
    giq_option(4, 140, 108, tolyaend, 50);
    giq_option(4, 140, 109, tolya05, 50);
  tolya02: |
    gsay_reply(140, 110);
    giq_option(4, 140, message_str(140, 111) + proto_data(obj_pid(dude_obj), 1) + message_str(140, 112), tolya07, 50);
    giq_option(4, 140, 113, combat, 50);
  tolya03: 'gsay_message(140, 114, 50);

    '
  tolya04: |
    gsay_reply(140, 115);
    giq_option(4, 140, 116, tolya06, 50);
    giq_option(4, 140, 117, tolyaend, 50);
  tolya05: |
    gsay_reply(140, 118);
    giq_option(4, 140, 119, tolya08, 50);
    giq_option(4, 140, 120, tolya09, 50);
  tolya06: |
    gsay_message(140, 121, 50);
    call combat;
  tolya07: 'gsay_message(140, 122, 50);

    '
  tolya08: |
    set_local_var(6, 1);
    if (local_var(5) == 0) then begin
      gsay_reply(140, 123);
      giq_option(4, 140, 124, tolya09, 50);
    end
    else begin
      gsay_message(140, 123, 50);
      call tolyaend;
    end
  tolya09: |
    set_local_var(5, 1);
    if (local_var(6) == 0) then begin
      gsay_reply(140, 125);
      giq_option(4, 140, 126, tolya08, 50);
    end
    else begin
      gsay_message(140, 125, 50);
      call tolyaend;
    end
  tolya10: 'gsay_message(140, 127, 50);

    '
  tolyaend: "[]"
  combat: |
    if (global_var(116) == 1) then begin
      critter_add_trait(self_obj, 1, 6, 87);
    end
    hostile := 1;
  Critter_Action: |
    variable LVar0 := 0;
    if (global_var(26) == 2) then begin
      set_global_var(254, 1);
    end
    else begin
      if (global_var(116)) then begin
        set_global_var(254, 0);
        if (tile_distance_objs(self_obj, dude_obj) < 3) then begin
          LVar0 := tile_num_in_direction(tile_num(self_obj), random(0, 5), 3);
          if (tile_distance(tile_num(self_obj), LVar0) > 2) then begin
            if (random(0, 9) == 0) then begin
              float_msg(self_obj, message_str(136, random(102, 106)), 8);
            end
            animate_move_obj_to_tile(self_obj, LVar0, 0);
          end
        end
      end
      else begin
        if (global_var(213)) then begin
          set_global_var(254, 1);
        end
        if (obj_can_see_obj(self_obj, dude_obj)) then begin
          if (global_var(214)) then begin
            set_global_var(254, 1);
          end
        end
        if (map_var(2) == 1) then begin
          set_global_var(254, 1);
        end
      end
    end
    if (global_var(254) and obj_can_see_obj(self_obj, dude_obj)) then begin
      hostile := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      hostile := 0;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
trapflor:
  start: "[]"
  spatial_p_proc: |
    if (is_success(roll_vs_skill(source_obj, 11, 0)) and (local_var(0) == 0)) then begin
      give_exp_points(25);
      reg_anim_func(2, source_obj);
      if (source_obj != dude_obj) then begin
        display_msg(proto_data(obj_pid(source_obj), 1) + message_str(509, 100));
      end
      else begin
        Passed_Times := Passed_Times + 1;
        if (Passed_Times > 2) then begin
          set_local_var(0, 1);
        end
        display_msg(message_str(509, 101));
      end
    end
    else begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
        explosion(tile_num(source_obj), elevation(source_obj), random(10, 30));
      end
    end
tread:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 78);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 13) then begin
            if (fixed_param == 2) then begin
              rndx := random(1, 6) - 5;
              if (rndx < 0) then begin
                rndx := 0;
              end
              if (rndx > 0) then begin
                radiation_inc(target_obj, rndx);
              end
            end
          end
          else begin
            if (script_action == 12) then begin
              call critter_p_proc;
            end
            else begin
              if (script_action == 18) then begin
                call destroy_p_proc;
              end
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj) and (tile_distance_objs(self_obj, dude_obj) < 6)) then begin
      float_msg(self_obj, message_str(790, 101), 2);
      hostile := 1;
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: 'float_msg(self_obj, message_str(790, 101), 2);

    '
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(790, 100));
trent:
  start: |
    if (not(initialized) and metarule(14, 0)) then begin
      critter_add_trait(self_obj, 1, 6, 35);
      critter_add_trait(self_obj, 1, 5, 2);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 14) then begin
          call damage_p_proc;
        end
        else begin
          if (script_action == 18) then begin
            call destroy_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 7) then begin
                call use_obj_on_p_proc;
              end
              else begin
                if (script_action == 11) then begin
                  call talk_p_proc;
                end
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (scared and (tile_distance_objs(self_obj, dude_obj) < 60)) then begin
      call flee_dude;
    end
    else begin
      if (not(close2dude)) then begin
        if (tile_distance_objs(dude_obj, self_obj) <= 2) then begin
          close2dude := 1;
        end
        else begin
          direction := rotation_to_tile(tile_num(dude_obj) % 200, tile_num(dude_obj) / 200);
          dest_tile := tile_num_in_direction(tile_num(dude_obj), direction, 1);
          animate_move_obj_to_tile(self_obj, dest_tile, 1);
          if ((random(1, 18) == 1) and not(calm)) then begin
            float_msg(self_obj, message_str(703, 141), 0);
          end
        end
      end
      else begin
        if (not(scared)) then begin
          if (random(1, 4) == 1) then begin
            anim(self_obj, 1000, rotation_to_tile(tile_num(self_obj), tile_num(dude_obj)));
          end
        end
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      scared := 1;
    end
    script_overrides;
    call flee_dude;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  pickup_p_proc: 'scared := 1;

    '
  use_obj_on_p_proc: |
    variable LVar0 := 0;
    if ((obj_pid(obj_being_used_with) == 81) or (obj_pid(obj_being_used_with) == 103) or (obj_pid(obj_being_used_with) == 126)) then begin
      LVar0 := obj_being_used_with;
      rm_obj_from_inven(source_obj, obj_being_used_with);
      destroy_object(LVar0);
      if (obj_is_carrying_obj_pid(self_obj, 41) == 100) then begin
        if (scared) then begin
          call Trent21;
        end
        else begin
          call Trent22;
        end
      end
      else begin
        if (scared) then begin
          call Trent23;
        end
        else begin
          call Trent24;
        end
      end
      calm := 1;
      scared := 0;
    end
  talk_p_proc: |
    if ((scared == 1) or (global_var(155) < -20)) then begin
      call Trent00;
    end
    else begin
      start_gdialog(703, self_obj, 4, -1, -1);
      gsay_start;
      call get_reaction;
      if (calm) then begin
        call Trent16;
      end
      else begin
        if (known) then begin
          call Trent02;
        end
        else begin
          call Trent01;
        end
      end
      gsay_end;
      end_dialogue;
    end
  Trent00: 'float_msg(self_obj, message_str(703, 100), 0);

    '
  Trent01: |
    known := 1;
    gsay_reply(703, 101);
    if (global_var(106) == 1) then begin
      giq_option(7, 703, 102, Trent03, 50);
    end
    giq_option(4, 703, 103, Trent04, 50);
    giq_option(4, 703, 104, Trent03, 50);
    giq_option(4, 703, 105, Trent05, 51);
    if ((global_var(101) == 0) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 703, 106, Trent06, 50);
    end
    if (global_var(100) == 1) then begin
      giq_option(4, 703, 107, Trent07, 50);
    end
    giq_option(-3, 703, 108, Trent08, 51);
  Trent02: |
    gsay_reply(703, 109);
    giq_option(4, 703, 103, Trent04, 50);
    giq_option(4, 703, 104, Trent03, 50);
  Trent03: |
    gsay_reply(703, 111);
    giq_option(4, 703, 112, Trent11, 50);
    giq_option(4, 703, 113, Trent12, 50);
    giq_option(4, 703, 114, Trent11, 50);
    giq_option(4, 703, 115, Trent13, 50);
  Trent04: |
    gsay_reply(703, 116);
    giq_option(4, 703, 117, Trent11, 50);
    giq_option(4, 703, 118, Trent14, 50);
    if (global_var(100) == 1) then begin
      giq_option(4, 703, 119, Trent07, 50);
    end
    giq_option(4, 703, 120, Trent15, 50);
  Trent05: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    calm := 0;
    scared := 1;
    gsay_message(703, 121, 51);
    if (obj_is_carrying_obj_pid(self_obj, 18)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 18);
      rm_obj_from_inven(self_obj, LVar0);
      add_obj_to_inven(dude_obj, LVar0);
    end
    if (obj_is_carrying_obj_pid(self_obj, 31)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 31);
      rm_obj_from_inven(self_obj, LVar0);
      add_obj_to_inven(dude_obj, LVar0);
    end
    if (obj_is_carrying_obj_pid(self_obj, 111)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 111);
      rm_obj_from_inven(self_obj, LVar0);
      add_obj_to_inven(dude_obj, LVar0);
    end
    if (obj_is_carrying_obj_pid(self_obj, 4)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 4);
      rm_obj_from_inven(self_obj, LVar0);
      add_obj_to_inven(dude_obj, LVar0);
    end
  Trent06: 'gsay_message(703, 122, 50);

    '
  Trent07: |
    scared := 1;
    gsay_message(703, 123, 50);
  Trent08: 'gsay_message(703, 124, 51);

    '
  Trent09: 'gsay_message(703, 125, 50);

    '
  Trent10: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(703, 142, 50);
    end
    else begin
      gsay_message(703, 143, 50);
    end
  Trent11: 'gsay_message(703, 127, 50);

    '
  Trent12: 'gsay_message(703, 128, 50);

    '
  Trent13: 'gsay_message(703, 129, 50);

    '
  Trent14: 'gsay_message(703, 130, 50);

    '
  Trent15: 'gsay_message(703, 131, 50);

    '
  Trent16: |
    gsay_reply(703, 132);
    if (global_var(106) == 1) then begin
      giq_option(7, 703, 102, Trent17, 50);
    end
    giq_option(4, 703, 103, Trent18, 50);
    giq_option(4, 703, 105, Trent05, 51);
    if ((global_var(101) == 0) and (obj_is_carrying_obj_pid(dude_obj, 55) == 0)) then begin
      giq_option(4, 703, 106, Trent19, 50);
    end
    if (global_var(100) == 1) then begin
      giq_option(4, 703, 107, Trent20, 50);
    end
    giq_option(-3, 703, 108, Trent10, 50);
  Trent17: 'gsay_message(703, 133, 50);

    '
  Trent18: 'gsay_message(703, 134, 50);

    '
  Trent19: 'gsay_message(703, 135, 50);

    '
  Trent20: 'gsay_message(703, 136, 50);

    '
  Trent21: |
    float_msg(self_obj, message_str(703, 137), 3);
    call give_money;
  Trent22: |
    float_msg(self_obj, message_str(703, 138), 3);
    call give_money;
  Trent23: |
    float_msg(self_obj, message_str(703, 138), 3);
    call give_money;
  Trent24: |
    float_msg(self_obj, message_str(703, 139), 3);
    call give_money;
  flee_dude: |
    direction := 0;
    prev_dist := 0;
    while(direction < 5) do begin
      if (tile_distance(tile_num(dude_obj), tile_num_in_direction(tile_num(self_obj), direction, 3)) > prev_dist) then begin
        dest_tile := tile_num_in_direction(tile_num(self_obj), direction, 3);
        prev_dist := tile_distance(tile_num(dude_obj), dest_tile);
      end
      direction := direction + 1;
    end
    animate_move_obj_to_tile(self_obj, dest_tile, 1);
  give_money: |
    variable LVar0 := 0;
    LVar0 := item_caps_total(self_obj);
    if (LVar0) then begin
      item_caps_adjust(self_obj, -1 * LVar0);
      item_caps_adjust(dude_obj, LVar0);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
trish:
  start: |
    if (script_action == 22) then begin
      dialogue_system_enter;
    end
  critter_p_proc: |
    if (global_var(557) bwand 64) then begin
      destroy_object(self_obj);
    end
    else begin
      call sleeping;
    end
    if (cur_map_index == 11) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        if ((map_var(0) == 1) and (map_var(1) == 1) and (tile_distance_objs(self_obj, dude_obj) < 12)) then begin
          dialogue_system_enter;
        end
      end
      if (tile_num(self_obj) != home_tile) then begin
        if ((global_var(282) == 0) or (global_var(555) == 2)) then begin
          animate_move_obj_to_tile(self_obj, home_tile, 0);
        end
      end
    end
    else begin
      if (tile_num(self_obj) != home_tile) then begin
        animate_move_obj_to_tile(self_obj, home_tile, 0);
      end
    end
    if (global_var(628) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(247, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(628, 1);
      set_global_var(247, 1);
      set_global_var(155, global_var(155) - 5);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    set_global_var(557, global_var(557) + 64);
  look_at_p_proc: |
    script_overrides;
    if ((global_var(557) bwand 1) or (global_var(557) bwand 4)) then begin
      display_msg(message_str(342, 100));
    end
    else begin
      display_msg(message_str(342, 167));
    end
  map_enter_p_proc: |
    Trish_ptr := self_obj;
    critter_add_trait(self_obj, 1, 6, 16);
    if (cur_map_index == 11) then begin
      home_tile := 20083;
      sleep_time := 330;
      wake_time := 1300;
    end
    else begin
      home_tile := 16297;
      sleep_time := 1300;
      wake_time := 330;
    end
  map_update_p_proc: |
    if (global_var(557) bwand 64) then begin
      destroy_object(self_obj);
    end
  talk_p_proc: |
    call get_reaction;
    if (local_var(4)) then begin
      float_msg(self_obj, message_str(342, 151), 0);
    end
    else begin
      if (cur_map_index == 12) then begin
        if ((global_var(169) == 3) and not(local_var(7))) then begin
          call Trish17;
        end
        else begin
          if ((global_var(169) == 2) and not(local_var(5)) and not(global_var(557) bwand 8)) then begin
            call Trish3;
          end
          else begin
            if ((global_var(557) bwand 32) and not(local_var(6))) then begin
              call Trish16;
            end
            else begin
              if (not((global_var(557) bwand 1) or (global_var(557) bwand 4))) then begin
                call Trish0;
              end
              else begin
                if ((global_var(557) bwand 4) and not(global_var(557) bwand 1)) then begin
                  call Trish11;
                end
                else begin
                  call Trish15;
                end
              end
            end
          end
        end
      end
      else begin
        if ((game_time_hour >= 1300) and (game_time_hour < 1600)) then begin
          float_msg(self_obj, message_str(342, 152), 0);
        end
        else begin
          call Trish25;
        end
      end
    end
    if (not(global_var(557) bwand 32) and (global_var(557) bwand 8) and (global_var(557) bwand 16)) then begin
      set_global_var(557, global_var(557) + 32);
      display_msg(message_str(342, 173));
      set_global_var(155, global_var(155) + 2);
      give_exp_points(250);
    end
  Trish0: |
    start_gdialog(342, self_obj, 4, -1, -1);
    gsay_start;
    if (not(global_var(557) bwand 1)) then begin
      set_global_var(557, global_var(557) + 1);
    end
    gsay_reply(342, 101);
    giq_option(-3, 342, 102, Trish1, 50);
    giq_option(4, 342, 103, Trish2, 50);
    giq_option(4, 342, 104, TrishEnd, 50);
    gsay_end;
    end_dialogue;
  Trish1: 'gsay_message(342, 105, 50);

    '
  Trish2: 'gsay_message(342, 106, 50);

    '
  Trish3: |
    start_gdialog(342, self_obj, 4, -1, -1);
    gsay_start;
    if (not(global_var(557) bwand 1)) then begin
      set_global_var(557, global_var(557) + 1);
    end
    set_local_var(5, 1);
    gsay_reply(342, 107);
    giq_option(-3, 342, 108, Trish1, 50);
    giq_option(4, 342, 109, Trish2, 50);
    giq_option(5, 342, 110, Trish4, 50);
    gsay_end;
    end_dialogue;
  Trish4: |
    if (local_var(5) == 0) then begin
      set_local_var(5, 1);
    end
    gsay_reply(342, 111);
    giq_option(5, 342, 112, Trish5, 50);
    giq_option(5, 342, 113, Trish6, 50);
  Trish5: |
    gsay_reply(342, 114);
    giq_option(5, 342, 115, Trish9, 50);
    giq_option(7, 342, 116, Trish10, 50);
  Trish6: |
    gsay_reply(342, 117);
    giq_option(5, 342, 118, Trish6a, -10);
    giq_option(5, 342, 119, Trish7, 0);
    giq_option(6, 342, 169, Trish8, 0);
  Trish6a: |
    call DownReact;
    call Trish7;
  Trish7: 'gsay_message(342, 120, 0);

    '
  Trish8: |
    variable LVar0 := 0;
    LVar0 := message_str(342, 121);
    if (not(global_var(38))) then begin
      LVar0 := LVar0 + message_str(342, 168);
    end
    gsay_message(342, LVar0, 49);
    if (not(global_var(557) bwand 8)) then begin
      set_global_var(557, global_var(557) + 8);
    end
  Trish9: |
    gsay_reply(342, 122);
    giq_option(5, 342, 123, Trish8, 50);
    giq_option(5, 342, 124, Trish7, 50);
  Trish10: |
    gsay_reply(342, 125);
    giq_option(5, 342, 126, Trish8, 50);
  Trish11: |
    if (not(global_var(557) bwand 1)) then begin
      set_global_var(557, global_var(557) + 1);
    end
    start_gdialog(342, self_obj, 4, -1, -1);
    gsay_start;
    gsay_reply(342, 127);
    giq_option(-3, 342, 128, Trish7, 50);
    giq_option(4, 342, 129, Trish12, -10);
    giq_option(5, 342, 130, Trish13, 50);
    gsay_end;
    end_dialogue;
  Trish12: |
    call DownReact;
    gsay_message(342, 131, 0);
  Trish13: |
    gsay_reply(342, 132);
    giq_option(5, 342, 133, TrishEnd, 0);
  Trish15: 'float_msg(self_obj, message_str(342, 137), 0);

    '
  Trish16: |
    if (not(global_var(557) bwand 1)) then begin
      set_global_var(557, global_var(557) + 1);
    end
    set_local_var(6, 1);
    float_msg(self_obj, message_str(342, 138), 0);
  Trish17: |
    if (not(global_var(557) bwand 1)) then begin
      set_global_var(557, global_var(557) + 1);
    end
    set_local_var(7, 1);
    float_msg(self_obj, message_str(342, 139), 0);
  Trish19: |
    gsay_reply(342, 144);
    giq_option(6, 342, 145, Trish20, 50);
    if (not(global_var(170) == 3)) then begin
      giq_option(6, 342, 146, Trish21, 50);
    end
    if ((local_var(12) == 0) and (global_var(557) bwand 2) and not(global_var(557) bwand 32) and (global_var(169) != 3)) then begin
      giq_option(6, 342, 147, Trish22, 50);
    end
    giq_option(6, 342, 148, TrishEnd, 50);
  Trish20: |
    set_local_var(10, 1);
    gsay_reply(342, 149);
    call Trish24;
  Trish21: |
    variable LVar0 := 0;
    set_local_var(11, 1);
    LVar0 := message_str(342, 154);
    if (not(global_var(37))) then begin
      LVar0 := LVar0 + message_str(342, 155);
    end
    gsay_reply(342, LVar0);
    call Trish24;
  Trish22: |
    set_local_var(12, 1);
    gsay_reply(342, 158);
    call Trish24;
  Trish24: |
    if (not(local_var(10))) then begin
      giq_option(6, 342, 145, Trish20, 50);
    end
    if (not(local_var(11))) then begin
      if (not(global_var(38))) then begin
        giq_option(6, 342, 146, Trish21, 50);
      end
    end
    if ((local_var(12) == 0) and (global_var(557) bwand 2) and not(global_var(557) bwand 32) and (global_var(169) != 3)) then begin
      giq_option(6, 342, 147, Trish22, 50);
    end
    giq_option(6, 342, 148, TrishEnd, 50);
  Trish25: |
    start_gdialog(342, self_obj, 4, -1, -1);
    gsay_start;
    if (not(global_var(557) bwand 4)) then begin
      set_global_var(557, global_var(557) + 4);
    end
    gsay_reply(342, 156);
    giq_option(4, 342, 157, Trish26, 50);
    giq_option(6, 342, 159, Trish27, 50);
    if ((global_var(169) == 2) and not(local_var(5)) and not(global_var(557) bwand 8)) then begin
      giq_option(5, 342, 110, Trish4, 50);
    end
    giq_option(4, 342, 153, TrishEnd, 50);
    giq_option(-3, 342, 170, Trish28, 50);
    gsay_end;
    end_dialogue;
  Trish26: |
    gsay_reply(342, 161);
    giq_option(4, 342, 164, TrishCola, 50);
    giq_option(4, 342, 165, TrishBeer, 50);
    giq_option(4, 342, 166, TrishBooze, 50);
    giq_option(4, 342, 153, TrishEnd, 50);
  Trish27: |
    if (local_var(1) < 2) then begin
      gsay_message(342, 160, 51);
    end
    else begin
      call Trish19;
    end
  Trish28: 'gsay_message(342, 171, 50);

    '
  TrishEnd: "[]"
  TrishCola: |
    if (item_caps_total(dude_obj) >= 3) then begin
      item_caps_adjust(dude_obj, -3);
      item := create_object_sid(106, 0, 0, -1);
      add_obj_to_inven(dude_obj, item);
      gsay_message(342, 174, 0);
    end
  TrishBeer: |
    if (item_caps_total(dude_obj) >= 5) then begin
      item_caps_adjust(dude_obj, -5);
      item := create_object_sid(124, 0, 0, -1);
      add_obj_to_inven(dude_obj, item);
      gsay_message(342, 174, 0);
    end
  TrishBooze: |
    if (item_caps_total(dude_obj) >= 20) then begin
      item_caps_adjust(dude_obj, -20);
      item := create_object_sid(125, 0, 0, -1);
      add_obj_to_inven(dude_obj, item);
      gsay_message(342, 174, 0);
    end
  sleeping: |
    if (sleep_time > wake_time) then begin
      if ((game_time_hour >= wake_time) and (game_time_hour < sleep_time)) then begin
        set_obj_visibility(self_obj, 0);
        set_local_var(4, 0);
      end
      else begin
        set_obj_visibility(self_obj, 1);
        set_local_var(4, 1);
      end
    end
    else begin
      if ((game_time_hour >= sleep_time) and (game_time_hour < wake_time)) then begin
        set_obj_visibility(self_obj, 1);
        set_local_var(4, 1);
      end
      else begin
        set_obj_visibility(self_obj, 0);
        set_local_var(4, 0);
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
trophy:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    if (global_var(286) == 0) then begin
      display_msg(message_str(527, 100));
    end
    else begin
      display_msg(message_str(527, 104));
    end
  description_p_proc: |
    script_overrides;
    if (global_var(286) == 0) then begin
      display_msg(message_str(527, 100));
    end
    else begin
      display_msg(message_str(527, 104));
    end
  use_p_proc: |
    if (global_var(286) == 0) then begin
      display_msg(message_str(527, 103));
    end
    else begin
      display_msg(message_str(527, 104));
    end
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 112) then begin
      script_overrides;
      set_global_var(286, 0);
      set_map_var(4, 0);
      rm_obj_from_inven(source_obj, obj_being_used_with);
      destroy_object(obj_being_used_with);
      reg_anim_func(2, self_obj);
      animate_stand_reverse_obj(self_obj);
    end
  use_skill_on_p_proc: |
    if (action_being_used == 10) then begin
      if (global_var(286) == 0) then begin
        script_overrides;
        set_global_var(286, 1);
        item := create_object_sid(112, 0, 0, -1);
        add_obj_to_inven(source_obj, item);
        if (is_success(roll_vs_skill(source_obj, 8, 0))) then begin
          display_msg(message_str(527, 101));
        end
        else begin
          display_msg(message_str(527, 102));
          set_map_var(4, 1);
        end
        reg_anim_func(2, self_obj);
        animate_stand_obj(self_obj);
      end
    end
troy:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 48);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 12) then begin
            call critter_p_proc;
          end
          else begin
            if (script_action == 18) then begin
              call destroy_p_proc;
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((TalkToPlayer == 1) and (tile_distance_objs(self_obj, dude_obj) <= 3)) then begin
      dialogue_system_enter;
    end
    if (map_var(3) == 1) then begin
      set_map_var(3, 0);
      TalkToPlayer := 1;
      reg_anim_func(1, 1);
      reg_anim_obj_move_to_obj(self_obj, dude_obj, -1);
      reg_anim_func(3, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    call get_reaction;
    if (TalkToPlayer == 1) then begin
      start_gdialog(604, self_obj, 4, -1, -1);
      gsay_start;
      call Troy00;
      gsay_end;
      end_dialogue;
    end
    else begin
      display_msg(message_str(604, 132));
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(604, 100));
  Troy00: |
    gsay_reply(604, 101);
    giq_option(7, 604, 102, Troy01, 50);
    giq_option(4, 604, 103, Troy01, 50);
    giq_option(4, 604, 104, Troy02, 50);
    giq_option(4, 604, 105, Troy03, 51);
    giq_option(4, 604, 106, Troy04, 51);
    giq_option(-3, 604, 107, Troy05, 50);
  Troy01: |
    gsay_reply(604, 108);
    giq_option(4, 604, 109, Troy06, 50);
    giq_option(4, 604, 110, Troy02, 50);
    giq_option(4, 604, 111, Troy03, 51);
    giq_option(4, 604, 112, Troy07, 51);
  Troy02: |
    gsay_message(604, 113, 50);
    game_time_advance(game_ticks(60 * 60 * 24 * 14));
    set_global_var(57, 1);
    load_map(32, 5);
  Troy03: |
    set_global_var(255, 1);
    gsay_message(604, 114, 50);
    call combat;
  Troy04: |
    gsay_reply(604, 115);
    giq_option(4, 604, 116, Troy02, 50);
    giq_option(4, 604, 117, Troy03, 51);
    giq_option(4, 604, 118, Troy08, 51);
    giq_option(4, 604, 119, Troy07, 51);
  Troy05: |
    gsay_reply(604, 120);
    giq_option(4, 604, 121, Troy02, 50);
    giq_option(4, 604, 122, Troy03, 50);
  Troy06: |
    gsay_reply(604, 123);
    giq_option(4, 604, 124, Troy02, 50);
    giq_option(4, 604, 125, Troy03, 51);
    giq_option(4, 604, 126, Troy07, 51);
  Troy07: |
    set_global_var(255, 1);
    gsay_message(604, 127, 51);
    call combat;
  Troy08: |
    gsay_reply(604, 128);
    giq_option(4, 604, 129, Troy02, 50);
    giq_option(4, 604, 120, Troy03, 51);
    giq_option(4, 604, 121, Troy07, 51);
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
tycho:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  look_at_p_proc: |
    script_overrides;
    if (global_var(121) > 0) then begin
      display_msg(message_str(389, 101));
    end
    else begin
      display_msg(message_str(389, 100));
    end
  description_p_proc: |
    if (not(combat_is_initialized)) then begin
      if ((global_var(121) == 2) and (tile_distance_objs(self_obj, dude_obj) > 1)) then begin
        script_overrides;
      end
      else begin
        animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(dude_obj), random(0, 5), 5), 0);
        float_msg(dude_obj, message_str(389, 2016), 3);
      end
    end
  critter_p_proc: |
    if (global_var(628) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (global_var(121) < 2) then begin
        call sleeping;
      end
      else begin
        if (global_var(121) == 2) then begin
          call follow_player;
        end
      end
    end
    if ((global_var(622) < 2) and (global_var(121) == 2)) then begin
      if ((get_pc_stat(1) - global_var(623)) > 3) then begin
        set_global_var(631, global_var(631) + (get_pc_stat(1) - global_var(623)));
        set_global_var(623, get_pc_stat(1));
      end
      if (global_var(631) > 3) then begin
        set_global_var(631, 0);
        set_global_var(622, global_var(622) + 1);
        armour_ptr := critter_inven_obj(self_obj, 0);
        armour_pid := obj_pid(armour_ptr);
        new_proto := get_proto(armour_ptr);
        tmp := create_object_sid(new_proto, tile_num(self_obj), elevation(self_obj), 389);
        anim(tmp, 1000, has_trait(1, self_obj, 10));
        inven_unwield;
        move_obj_inven_to_obj(self_obj, tmp);
        armour_ptr := obj_carrying_pid_obj(tmp, armour_pid);
        if (armour_ptr) then begin
          wield_obj_critter(tmp, armour_ptr);
        end
        party_remove(self_obj);
        party_add(tmp);
        critter_add_trait(tmp, 1, 6, 0);
        float_msg(tmp, message_str(389, 1999), 3);
        display_msg(message_str(389, 2019));
        Tycho_ptr := tmp;
        move_to(self_obj, 0, 0);
        destroy_object(self_obj);
      end
    end
  pickup_p_proc: |
    if (global_var(121) < 2) then begin
      hostile := 1;
    end
    else begin
      script_overrides;
    end
  destroy_p_proc: |
    set_global_var(121, 3);
    party_remove(self_obj);
    if (source_obj == dude_obj) then begin
      if (cur_map_index == 11) then begin
        set_global_var(628, 1);
        set_global_var(247, 1);
        set_global_var(155, global_var(155) - 5);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  map_enter_p_proc: |
    Tycho_ptr := self_obj;
    sleep_time := 2200;
    wake_time := 1600;
    home_tile := 19690;
    sleep_tile := 7000;
    if (initialized == 0) then begin
      initialized := 1;
      critter_add_trait(self_obj, 1, 5, 90);
    end
    if (obj_is_carrying_obj_pid(self_obj, 106) >= 2) then begin
      cola2_ptr := obj_carrying_pid_obj(self_obj, 106);
    end
    if (global_var(121) == 2) then begin
      critter_add_trait(self_obj, 1, 6, 0);
    end
    else begin
      critter_add_trait(self_obj, 1, 6, 16);
    end
  talk_p_proc: |
    call get_reaction;
    start_gdialog(389, self_obj, 4, -1, -1);
    gsay_start;
    if (global_var(121) == 3) then begin
      call Tycho28;
    end
    else begin
      if (global_var(121) == 2) then begin
        call Tycho22;
      end
      else begin
        if (global_var(121) == 0) then begin
          call Tycho01;
        end
        else begin
          if ((global_var(39) == 1) and (global_var(36) == 0)) then begin
            call Tycho19;
          end
          else begin
            if (local_var(1) < 2) then begin
              call Tycho14;
            end
            else begin
              call Tycho15;
            end
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
    if (global_var(121) == 2) then begin
      if (global_var(314) == 0) then begin
        display_msg(message_str(389, 173));
        give_exp_points(300);
        set_global_var(314, 1);
      end
    end
    if (bestweapon_flag == 1) then begin
      bestweapon_flag := 0;
      inven_unwield;
    end
    if (armour_flag == 1) then begin
      armour_flag := 0;
      new_proto := get_proto(armour_ptr);
      if (new_proto) then begin
        tmp := create_object_sid(new_proto, tile_num(self_obj), elevation(self_obj), 389);
        anim(tmp, 1000, has_trait(1, self_obj, 10));
        inven_unwield;
        move_obj_inven_to_obj(self_obj, tmp);
        wield_obj_critter(tmp, armour_ptr);
        party_remove(self_obj);
        party_add(tmp);
        critter_add_trait(tmp, 1, 6, 0);
        Tycho_ptr := tmp;
        move_to(self_obj, 0, 0);
        destroy_object(self_obj);
      end
    end
  use_obj_on_p_proc: |
    if (global_var(121) == 2) then begin
      item := obj_pid(obj_being_used_with);
      if ((item != 40) and (item != 47) and (item != 91)) then begin
        script_overrides;
        if (obj_item_subtype(obj_being_used_with) != 3) then begin
          rm_obj_from_inven(dude_obj, obj_being_used_with);
          add_obj_to_inven(self_obj, obj_being_used_with);
        end
        else begin
          if ((item == 8) or (item == 18) or (item == 143) or (item == 10) or (item == 94) or (item == 7) or (item == 21) or (item == 234) or (item == 235) or (item == 24) or (item == 16) or (item == 120) or (item == 242)) then begin
            rm_obj_from_inven(dude_obj, obj_being_used_with);
            add_obj_to_inven(self_obj, obj_being_used_with);
          end
          else begin
            float_msg(self_obj, message_str(634, 109), 3);
          end
        end
      end
    end
  Tycho01: |
    gsay_reply(389, 102);
    giq_option(4, 389, 103, TychoEnd, 50);
    giq_option(4, 389, 104, Tycho02, 50);
    giq_option(-3, 389, 105, Tycho03, 50);
  Tycho02: |
    if (obj_is_carrying_obj_pid(self_obj, obj_pid(cola2_ptr))) then begin
      rm_obj_from_inven(self_obj, cola2_ptr);
      add_obj_to_inven(dude_obj, cola2_ptr);
    end
    gsay_reply(389, 106);
    giq_option(4, 389, 107, Tycho04, 50);
  Tycho03: 'gsay_message(389, 108, 50);

    '
  Tycho04: |
    set_global_var(121, 1);
    gsay_reply(389, 109);
    giq_option(4, 389, 110, Tycho05, 50);
    giq_option(6, 389, 111, Tycho06, 50);
  Tycho05: |
    gsay_reply(389, 112);
    giq_option(4, 389, 113, Tycho07, 50);
    giq_option(6, 389, 114, Tycho08, 50);
  Tycho06: |
    gsay_reply(389, 115);
    if (local_var(5) != 1) then begin
      giq_option(4, 389, 116, Tycho11, 50);
    end
    giq_option(6, 389, 117, Tycho09, 50);
  Tycho07: |
    gsay_reply(389, 118);
    if (local_var(5) != 1) then begin
      giq_option(4, 389, 119, Tycho11, 50);
    end
    else begin
      call Goodbyes;
      giq_option(4, 389, exit_line, TychoEnd, 50);
    end
  Tycho08: |
    gsay_reply(389, 120);
    if (local_var(5) != 1) then begin
      giq_option(4, 389, 121, Tycho11, 50);
    end
    else begin
      call Goodbyes;
      giq_option(4, 389, exit_line, TychoEnd, 50);
    end
  Tycho09: |
    gsay_reply(389, 122);
    giq_option(4, 389, 123, Tycho10, 50);
    if (local_var(5) != 1) then begin
      giq_option(4, 389, 116, Tycho11, 50);
    end
  Tycho10: |
    gsay_reply(389, 124);
    giq_option(4, 389, 125, Tycho17, 50);
    if (local_var(5) != 1) then begin
      giq_option(4, 389, 126, Tycho11, 50);
    end
  Tycho11: |
    set_local_var(5, 1);
    gsay_reply(389, 127);
    giq_option(4, 389, message_str(389, 128) + proto_data(obj_pid(dude_obj), 1) + message_str(389, 129), Tycho12, 50);
    giq_option(4, 389, 130, Tycho13, 50);
  Tycho12: |
    call UpReact;
    gsay_message(389, 131, 50);
  Tycho13: |
    call DownReact;
    gsay_reply(389, 132);
    giq_option(4, 389, 133, TychoCombat, 50);
    giq_option(4, 389, 134, TychoEnd, 50);
  Tycho14: |
    gsay_reply(389, 135);
    giq_option(4, 389, 136, Tycho13, 50);
    giq_option(4, 389, 137, Tycho08, 50);
    giq_option(4, 389, 138, Tycho16, 50);
  Tycho15: |
    gsay_reply(389, 139);
    giq_option(4, 389, 137, Tycho08, 50);
    giq_option(4, 389, 138, Tycho16, 50);
    if (global_var(36)) then begin
      giq_option(4, 389, 140, Tycho18, 50);
    end
  Tycho16: |
    gsay_reply(389, 141);
    call Goodbyes;
    giq_option(4, 389, exit_line, TychoEnd, 50);
  Tycho17: |
    gfade_out(600);
    critter_mod_skill(dude_obj, 17, 5);
    game_time_advance(game_ticks(120));
    gsay_reply(389, 142);
    gfade_in(600);
    call Goodbyes;
    if (local_var(5) != 1) then begin
      giq_option(4, 389, exit_line, Tycho11, 50);
    end
    else begin
      giq_option(4, 389, exit_line, TychoEnd, 50);
    end
  Tycho18: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(389, 168, 49);
    end
    else begin
      gsay_message(389, 169, 49);
    end
    call TychoJoins;
  Tycho19: |
    gsay_reply(389, 144);
    giq_option(4, 389, 145, Tycho20, 50);
    giq_option(4, 389, 146, Tycho21, 50);
    giq_option(-3, 389, 105, TychoEnd, 50);
  Tycho20: 'gsay_message(389, 147, 50);

    '
  Tycho21: |
    call DownReact;
    gsay_message(389, 148, 50);
  Tycho22: |
    gsay_reply(389, 149);
    if (cur_map_index == 51) then begin
      giq_option(4, 389, 150, Tycho23, 50);
    end
    if (cur_map_index == 27) then begin
      giq_option(4, 389, 150, Tycho25, 50);
    end
    if (cur_map_index == 37) then begin
      giq_option(4, 389, 150, Tycho26, 50);
    end
    if (cur_map_index == 3) then begin
      giq_option(4, 389, 150, Tycho30, 50);
    end
    if (cur_map_index == 31) then begin
      giq_option(4, 389, 150, Tycho31, 50);
    end
    if (cur_map_index == 32) then begin
      giq_option(4, 389, 150, Tycho32, 50);
    end
    giq_option(4, 389, 151, Tycho24, 50);
    giq_option(4, 389, 164, Tycho27, 50);
    giq_option(4, 389, 2000, TychoCombatTactics, 50);
    giq_option(4, 389, 166, TychoEnd, 50);
  Tycho23: |
    gsay_message(389, 152, 50);
    call Tycho22;
  Tycho24: |
    party_remove(self_obj);
    set_global_var(121, 3);
    gsay_message(389, 153, 49);
  Tycho25: |
    gsay_message(389, 154, 49);
    call Tycho22;
  Tycho26: |
    gsay_message(389, 155, 49);
    call Tycho22;
  Tycho27: |
    gsay_message(389, 165, 49);
    call Tycho22;
  Tycho28: |
    gsay_reply(389, 170);
    giq_option(4, 389, 171, TychoJoins, 49);
    giq_option(4, 389, 172, TychoEnd, 50);
    giq_option(-3, 389, 105, TychoEnd, 50);
  Tycho30: |
    gsay_message(389, 158, 49);
    call Tycho22;
  Tycho31: |
    gsay_message(389, 157, 49);
    call Tycho22;
  Tycho32: |
    gsay_message(389, 156, 49);
    call Tycho22;
  follow_player: |
    if (tile_distance_objs(self_obj, dude_obj) > global_var(278)) then begin
      if (anim_busy(self_obj) == 0) then begin
        dest_tile := tile_num_in_direction(tile_num_in_direction(tile_num(dude_obj), rotation_to_tile(tile_num(dude_obj), tile_num(self_obj)), global_var(278)), random(0, 5), random(0, 2));
        if (tile_distance_objs(self_obj, dude_obj) > (2 * global_var(278))) then begin
          animate_move_obj_to_tile(self_obj, dest_tile, 1 bwor 16);
        end
        else begin
          animate_move_obj_to_tile(self_obj, dest_tile, 0 bwor 16);
        end
      end
    end
  TychoEnd: "[]"
  TychoCombat: 'hostile := 1;

    '
  TychoJoins: |
    if ((global_var(118) == 2) and (global_var(244) == 2) and (get_critter_stat(dude_obj, 3) <= 5)) then begin
      gsay_message(389, 2017, 50);
    end
    else begin
      if ((global_var(118) == 2) or (global_var(244) == 2) and (get_critter_stat(dude_obj, 3) <= 3)) then begin
        gsay_message(389, 2018, 50);
      end
      else begin
        call TychoJoins2;
      end
    end
  TychoJoins2: |
    set_global_var(121, 2);
    set_global_var(278, 5);
    set_global_var(623, get_pc_stat(1));
    critter_add_trait(self_obj, 1, 6, 0);
    party_add(self_obj);
  TychoClose: |
    set_global_var(278, 3);
    call Tycho22;
  TychoModerate: |
    set_global_var(278, 5);
    call Tycho22;
  TychoFar: |
    set_global_var(278, 7);
    call Tycho22;
  sleeping: |
    if (local_var(4) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(4, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(4, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(4, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(4, 1);
          end
        end
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
  TychoCombatTactics: |
    armour_ptr := get_armour_ptr;
    gsay_reply(389, 2001);
    giq_option(4, 389, 2010, TychoBestWeapon, 49);
    if (armour_ptr) then begin
      giq_option(4, 389, 2011, TychoArmour, 49);
    end
    giq_option(4, 389, 161, TychoClose, 49);
    giq_option(4, 389, 162, TychoModerate, 49);
    giq_option(4, 389, 163, TychoFar, 49);
    giq_option(4, 389, 2015, Tycho22, 49);
  TychoBestWeapon: |
    gsay_message(389, 2100, 49);
    bestweapon_flag := 1;
    call TychoCombatTactics;
  TychoArmour: |
    gsay_message(389, 2100, 49);
    armour_flag := 1;
    call TychoCombatTactics;
  get_armour_ptr: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar1 := obj_pid(critter_inven_obj(self_obj, 0));
    if (obj_is_carrying_obj_pid(self_obj, 74) and (LVar1 != 74)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 74);
    end
    if (obj_is_carrying_obj_pid(self_obj, 1) and (LVar1 != 1)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 1);
    end
    if (obj_is_carrying_obj_pid(self_obj, 113) and (LVar1 != 113)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 113);
    end
    if (obj_is_carrying_obj_pid(self_obj, 2) and (LVar1 != 2)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 2);
    end
    if (obj_is_carrying_obj_pid(self_obj, 17) and (LVar1 != 17)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 17);
    end
    if (obj_is_carrying_obj_pid(self_obj, 240) and (LVar1 != 240)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 240);
    end
    if (obj_is_carrying_obj_pid(self_obj, 239) and (LVar1 != 239)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 239);
    end
    if (obj_is_carrying_obj_pid(self_obj, 3) and (LVar1 != 3)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 3);
    end
    if (obj_is_carrying_obj_pid(self_obj, 232) and (LVar1 != 232)) then begin
      LVar0 := obj_carrying_pid_obj(self_obj, 232);
    end
    return LVar0;
  get_proto: |
    variable LVar1 := 0;
    if (obj_pid(arg0) == 74) then begin
      LVar1 := 16777556 + (9 * global_var(622));
    end
    else begin
      if (obj_pid(arg0) == 1) then begin
        LVar1 := 16777557 + (9 * global_var(622));
      end
      else begin
        if (obj_pid(arg0) == 113) then begin
          LVar1 := 16777558 + (9 * global_var(622));
        end
        else begin
          if (obj_pid(arg0) == 2) then begin
            LVar1 := 16777559 + (9 * global_var(622));
          end
          else begin
            if (obj_pid(arg0) == 17) then begin
              LVar1 := 16777560 + (9 * global_var(622));
            end
            else begin
              if (obj_pid(arg0) == 240) then begin
                LVar1 := 16777561 + (9 * global_var(622));
              end
              else begin
                if (obj_pid(arg0) == 239) then begin
                  LVar1 := 16777562 + (9 * global_var(622));
                end
                else begin
                  if (obj_pid(arg0) == 3) then begin
                    LVar1 := 16777563 + (9 * global_var(622));
                  end
                  else begin
                    if (obj_pid(arg0) == 232) then begin
                      LVar1 := 16777564 + (9 * global_var(622));
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    return LVar1;
tylier:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(309, 100));
    end
  use_skill_on_p_proc: |
    if (action_being_used == 12) then begin
      script_overrides;
      call StartDialog;
    end
  StartDialog: |
    script_overrides;
    start_gdialog(309, self_obj, 4, -1, -1);
    gsay_start;
    if (global_var(140) == 1) then begin
      call tylier01;
    end
    else begin
      call tylier08;
    end
    gsay_end;
    end_dialogue;
  tylier01: |
    gsay_reply(309, 101);
    giq_option(-3, 309, 102, tylier02, 50);
    giq_option(-3, 309, 103, tylier02, 50);
    giq_option(4, 309, 104, tylier02, 50);
    giq_option(5, 309, message_str(309, 105) + proto_data(obj_pid(dude_obj), 1) + message_str(309, 106), tylier02, 50);
    giq_option(5, 309, 107, tylier03, 50);
  tylier02: 'gsay_message(309, 108, 50);

    '
  tylier03: |
    gsay_reply(309, 109);
    giq_option(5, 309, 110, tylier04, 50);
    giq_option(5, 309, 111, tylier04, 50);
    giq_option(5, 309, 112, tylierend, 50);
  tylier04: |
    gsay_reply(309, 113);
    giq_option(5, 309, 114, tylier05, 50);
    giq_option(5, 309, 115, tylierend, 50);
    giq_option(6, 309, 116, tylier06, 50);
  tylier05: 'gsay_message(309, 117, 50);

    '
  tylier06: |
    gsay_reply(309, 108);
    giq_option(5, 309, 129, tylier05, 50);
    giq_option(5, 309, 120, tylier05, 50);
    giq_option(5, 309, 121, tylier05, 50);
    giq_option(5, 309, 122, tylier05, 50);
    if (obj_is_carrying_obj_pid(dude_obj, 191)) then begin
      giq_option(5, 309, 119, tylier07, 50);
    end
    giq_option(0, 309, 123, tylierend, 50);
  tylier07: |
    variable LVar0 := 0;
    gsay_message(309, 124, 50);
    LVar0 := obj_carrying_pid_obj(dude_obj, 191);
    if (LVar0) then begin
      rm_obj_from_inven(dude_obj, LVar0);
      destroy_object(LVar0);
    end
    give_exp_points(100);
    display_msg(message_str(309, 130));
    set_global_var(140, 2);
  tylier08: 'gsay_message(309, 128, 50);

    '
  tylierend: "[]"
undrbed:
  start: "[]"
  spatial_p_proc: |
    if (obj_type(source_obj) == dude_obj) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
        if (is_success(do_check(dude_obj, 1, 0))) then begin
          display_msg(message_str(151, 100));
        end
      end
    end
uthern:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 49);
      initialized := 1;
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (not(obj_pid(critter_inven_obj(dude_obj, 0)) == 113) and (tile_distance_objs(self_obj, dude_obj) < 10)) then begin
      float_msg(self_obj, message_str(273, 141), 2);
      call combat;
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(273, 100));
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    script_overrides;
    if (local_var(0)) then begin
      call uthern14;
    end
    else begin
      set_local_var(0, 1);
      start_gdialog(273, self_obj, 4, -1, -1);
      gsay_start;
      call uthern0;
      gsay_end;
      end_dialogue;
    end
  uthern0: |
    gsay_reply(273, 101);
    giq_option(-3, 273, 102, uthern1, 50);
    giq_option(4, 273, 103, uthern2, 50);
    giq_option(4, 273, 104, combat, 50);
    giq_option(5, 273, 105, uthern7, 50);
    giq_option(8, 273, 106, uthern13, 50);
    if (has_skill(dude_obj, 14) > 80) then begin
      giq_option(8, 273, 137, uthern15, 50);
    end
  uthern1: |
    gsay_message(273, 107, 50);
    call combat;
  uthern2: |
    gsay_reply(273, 108);
    giq_option(4, 273, 109, uthern3, 50);
    giq_option(4, 273, 110, combat, 50);
    giq_option(6, 273, 111, uthern4, 50);
  uthern3: |
    gsay_message(273, 112, 50);
    call combat;
  uthern4: |
    gsay_reply(273, 113);
    giq_option(6, 273, 114, uthern5, 50);
    giq_option(6, 273, 115, uthern6, 50);
    giq_option(6, 273, 116, combat, 50);
  uthern5: |
    gsay_message(273, 117, 50);
    call combat;
  uthern6: |
    gsay_message(273, 118, 50);
    call combat;
  uthern7: |
    gsay_reply(273, 119);
    giq_option(5, 273, 120, uthern8, 50);
    giq_option(5, 273, 121, uthern12, 50);
    giq_option(5, 273, 122, combat, 50);
  uthern8: |
    gsay_reply(273, 123);
    giq_option(5, 273, 124, uthern9, 50);
    giq_option(5, 273, 125, uthern10, 50);
    giq_option(5, 273, 126, uthern11, 50);
    giq_option(5, 273, 127, combat, 50);
  uthern9: |
    gsay_message(273, 128, 50);
    call combat;
  uthern10: |
    gsay_message(273, 129, 50);
    call combat;
  uthern11: |
    gsay_message(273, 130, 50);
    call combat;
  uthern12: |
    gsay_reply(273, 131);
    giq_option(5, 273, 132, combat, 50);
    giq_option(5, 273, 133, combat, 50);
    giq_option(5, 273, 134, combat, 50);
  uthern13: |
    gsay_message(273, 135, 50);
    call combat;
  uthern14: |
    float_msg(self_obj, message_str(273, 136), 0);
    call combat;
  uthern15: |
    gsay_reply(273, 138);
    giq_option(7, 273, 139, uthernend, 50);
    giq_option(5, 273, 140, combat, 50);
  uthernend: "[]"
  combat: 'hostile := 1;

    '
uzchair:
  start: |
    if (script_action == 6) then begin
      if (local_var(0) == 0) then begin
        script_overrides;
        set_local_var(0, 1);
        display_msg(message_str(464, 100));
        gear := create_object_sid(82, 0, 0, -1);
        add_obj_to_inven(dude_obj, gear);
      end
    end
v13comp:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  description_p_proc: 'display_msg(message_str(344, 103));

    '
  use_p_proc: |
    script_overrides;
    if ((game_time / (10 * 60 * 60 * 24)) == 0) then begin
      if (local_var(0)) then begin
        display_msg(message_str(344, 101));
        float_msg(self_obj, message_str(344, 102), 0);
      end
      else begin
        display_msg(message_str(344, 100));
        set_local_var(0, 1);
      end
      play_sfx("SLDOORSO");
    end
    else begin
      use_obj(vault_door_ptr);
    end
v13door:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  description_p_proc: 'display_msg(message_str(343, 100));

    '
  map_enter_p_proc: |
    vault_door_ptr := self_obj;
    if (obj_is_open(self_obj)) then begin
      use_obj(self_obj);
    end
  use_p_proc: |
    if (source_obj == dude_obj) then begin
      script_overrides;
      display_msg(message_str(343, 100));
    end
valtcomp:
  start: "[]"
  use_p_proc: |
    script_overrides;
    display_msg(message_str(793, 100));
  use_skill_on_p_proc: |
    if (action_being_used == 12) then begin
      script_overrides;
      if (elevation(self_obj) == 0) then begin
        display_msg(message_str(793, 102));
      end
      else begin
        display_msg(message_str(793, 101));
      end
    end
valtcore:
  start: |
    if (script_action == 2) then begin
      call spatial_p_proc;
    end
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (not(local_var(0))) then begin
        display_msg(message_str(213, 100));
        set_local_var(0, 1);
      end
    end
valtctzn:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (global_var(101) == 0) then begin
        if (local_var(5) == 0) then begin
          if ((elevation(self_obj) == elevation(WtrGrd_ptr)) and (elevation(self_obj) == elevation(dude_obj))) then begin
            if ((game_time_hour > 700) and (game_time_hour < 900)) then begin
              call get_rations;
            end
          end
        end
      end
      if (not((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
        set_local_var(5, 0);
        sleeping_disabled := 0;
      end
      if (sleeping_disabled == 0) then begin
        call sleeping;
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_local_var(7, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
    if (source_obj == dude_obj) then begin
      set_global_var(261, 1);
    end
  map_enter_p_proc: |
    if (not(local_var(4))) then begin
      set_local_var(4, tile_num(self_obj));
    end
    home_tile := local_var(4);
    critter_add_trait(self_obj, 1, 6, 1);
    call set_ration_tile;
    call set_sleep_tile;
    sleep_time := random(1900, 1930);
    wake_time := sleep_time - 1300;
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (local_var(6) == 1) then begin
      if (random(0, 1)) then begin
        float_msg(self_obj, message_str(185, 166), 0);
      end
      else begin
        display_msg(message_str(185, 167));
      end
    end
    else begin
      if (local_var(7) or global_var(261)) then begin
        float_msg(self_obj, message_str(669, 105), 0);
      end
      else begin
        if (rndx == 0) then begin
          rndx := random(101, 106);
        end
        float_msg(self_obj, message_str(130, rndx), 0);
      end
    end
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      animate_move_obj_to_tile(self_obj, tile_num_in_direction(tile_num(WtrGrd_ptr), 2, 1), 0);
      add_timer_event(self_obj, game_ticks(3), 2);
    end
    else begin
      if (fixed_param == 2) then begin
        getting_ration := 1;
        if (random(0, 1)) then begin
          float_msg(self_obj, message_str(185, 165), 0);
        end
        add_timer_event(self_obj, game_ticks(3), 3);
      end
      else begin
        if (fixed_param == 3) then begin
          recipient := 0;
          animate_move_obj_to_tile(self_obj, home_tile, 0);
        end
      end
    end
  get_rations: |
    sleeping_disabled := 1;
    if (tile_num(self_obj) != ration_tile) then begin
      if (random(0, 1)) then begin
        animate_move_obj_to_tile(self_obj, ration_tile, 0);
      end
      else begin
        animate_move_obj_to_tile(self_obj, ration_tile, 1);
      end
    end
    else begin
      if (not(recipient)) then begin
        recipient := self_obj;
        add_timer_event(self_obj, game_ticks(3), 1);
        set_local_var(5, 1);
        sleeping_disabled := 0;
      end
    end
  set_ration_tile: |
    if (elevation(self_obj) == 0) then begin
      ration_tile := tile_num_in_direction(14704, random(0, 5), random(1, 2));
    end
    else begin
      if (elevation(self_obj) == 1) then begin
        ration_tile := tile_num_in_direction(21895, random(0, 5), random(1, 2));
      end
      else begin
        if (elevation(self_obj) == 2) then begin
          ration_tile := tile_num_in_direction(22513, random(0, 5), random(1, 2));
        end
      end
    end
  set_sleep_tile: |
    if (elevation(self_obj) == 0) then begin
      sleep_tile := 7000;
    end
    else begin
      if (elevation(self_obj) == 1) then begin
        sleep_tile := home_tile;
      end
      else begin
        if (elevation(self_obj) == 2) then begin
          sleep_tile := 7000;
        end
      end
    end
  sleeping: |
    if (local_var(6) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(6, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(6, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(6, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(6, 1);
          end
        end
      end
    end
valtcupl:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 1);
      initialized := 1;
    end
    else begin
      if (script_action == 12) then begin
        call critter_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 21) then begin
            call look_at_p_proc;
          end
          else begin
            if (script_action == 4) then begin
              call pickup_p_proc;
            end
            else begin
              if (script_action == 11) then begin
                call talk_p_proc;
              end
            end
          end
        end
      end
    end
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(209, 100));
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    call get_reaction;
    start_gdialog(-1, 209, self_obj, -1, -1);
    gsay_start;
    if (local_var(4)) then begin
      if (local_var(1) < 2) then begin
        call ValtCupl07;
      end
      else begin
        call ValtCupl06;
      end
    end
    else begin
      call ValtCupl00;
    end
    gsay_end;
    end_dialogue;
  ValtCupl00: |
    set_local_var(4, 1);
    gsay_reply(209, 101);
    giq_option(4, 209, 102, ValtCupl02, 50);
    giq_option(4, 209, 103, ValtCupl03, 50);
    giq_option(5, 209, 104, ValtCupl00a, 50);
    giq_option(-3, 209, 105, ValtCupl01, 50);
  ValtCupl00a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call ValtCupl04;
    end
    else begin
      call ValtCupl01;
    end
  ValtCupl01: |
    call BigDownReact;
    gsay_message(209, 106, 51);
  ValtCupl02: |
    gsay_reply(209, 107);
    giq_option(4, 209, 108, ValtCupl01, 50);
    giq_option(4, 209, 109, ValtCupl03, 50);
  ValtCupl03: |
    call BigUpReact;
    gsay_message(209, 110, 49);
  ValtCupl04: |
    gsay_reply(209, 111);
    giq_option(5, 209, 112, ValtCupl03, 50);
    giq_option(5, 209, 113, ValtCupl05, 50);
  ValtCupl05: 'gsay_message(209, 114, 50);

    '
  ValtCupl06: 'gsay_message(209, 115, 50);

    '
  ValtCupl07: 'gsay_message(209, 116, 50);

    '
  ValtCuplEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
valtglo:
  start: |
    if (only_once) then begin
      only_once := 0;
      critter_add_trait(self_obj, 1, 6, 30);
      critter_add_trait(self_obj, 1, 5, 41);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 13) then begin
            if (fixed_param == 2) then begin
              rndx := random(1, 6) - 5;
              if (rndx < 0) then begin
                rndx := 0;
              end
              if (rndx > 0) then begin
                radiation_inc(target_obj, rndx);
              end
            end
          end
          else begin
            if (script_action == 12) then begin
              call critter_p_proc;
            end
            else begin
              if (script_action == 18) then begin
                call destroy_p_proc;
              end
            end
          end
        end
      end
    end
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    if ((global_var(30) != 0) and (global_var(31) != 2)) then begin
      float_msg(self_obj, message_str(792, 102), 2);
    end
    else begin
      display_msg(message_str(792, 101));
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(792, 100));
valtleav:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (not(local_var(0))) then begin
        if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
          display_msg(message_str(208, 101));
        end
        else begin
          display_msg(message_str(208, 100));
        end
        set_local_var(0, 1);
      end
    end
valtlock:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (not(local_var(0))) then begin
        display_msg(message_str(131, 100));
        set_local_var(0, 1);
      end
    end
valtmed:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (not(local_var(0))) then begin
        display_msg(message_str(219, 100));
        set_local_var(0, 1);
      end
    end
valtmeet:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (not(local_var(0))) then begin
        display_msg(message_str(218, 100));
        set_local_var(0, 1);
      end
    end
valtmon:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(132, 100));
  use_p_proc: |
    script_overrides;
    display_msg(message_str(132, 101));
valtop:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (not(local_var(0))) then begin
        display_msg(message_str(215, 100));
        set_local_var(0, 1);
      end
    end
valtsec:
  start: |
    if (script_action == 2) then begin
      call spatial_p_proc;
    end
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (not(local_var(0))) then begin
        display_msg(message_str(216, 100));
        set_local_var(0, 1);
      end
    end
valtstor:
  start: "[]"
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (not(local_var(0))) then begin
        display_msg(message_str(217, 100));
        set_local_var(0, 1);
      end
    end
vance:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if ((initiateDialogue == 1) and (tile_distance_objs(self_obj, dude_obj) <= 4)) then begin
      initiateDialogue := 0;
      dialogue_system_enter;
    end
    if (kickOut == 1) then begin
      kickOut := 0;
      initiateDialogue := 1;
      gfade_out(500);
      move_to(dude_obj, 16265, 0);
      gfade_in(500);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    gdialog_set_barter_mod(-20);
    if (global_var(236) == 1) then begin
      call Get_Stuff;
    end
    call get_reaction;
    if (global_var(248) == 1) then begin
      start_gdialog(822, self_obj, 4, -1, -1);
      gsay_start;
      call Vance12;
      gsay_end;
      end_dialogue;
    end
    else begin
      if (local_var(1) == 1) then begin
        start_gdialog(822, self_obj, 4, -1, -1);
        gsay_start;
        call Vance11;
        gsay_end;
        end_dialogue;
      end
      else begin
        if ((local_var(4) == 0) or (global_var(236) == 0)) then begin
          set_local_var(4, 1);
          start_gdialog(822, self_obj, 4, -1, -1);
          gsay_start;
          call Vance01;
          gsay_end;
          end_dialogue;
        end
        else begin
          start_gdialog(822, self_obj, 4, -1, -1);
          gsay_start;
          call Vance06;
          gsay_end;
          end_dialogue;
        end
      end
    end
    call Put_Stuff;
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(822, 100));
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 81);
      critter_add_trait(self_obj, 1, 5, 4);
      call Put_Stuff;
    end
  Vance01: |
    gsay_reply(822, 101);
    giq_option(-3, 822, 102, Vance05, 50);
    if (global_var(236) == 1) then begin
      giq_option(4, 822, 105, Vance05, 50);
    end
    giq_option(4, 822, 103, Vance02, 50);
    giq_option(4, 822, 104, Vance03, 50);
    giq_option(4, 822, 106, Vance04, 50);
  Vance02: |
    gsay_reply(822, 107);
    giq_option(4, 822, 108, Vance03, 50);
    giq_option(4, 822, 109, Vance02a, 50);
    giq_option(4, 822, 111, Vance04, 50);
  Vance02a: |
    if ((is_success(roll_vs_skill(dude_obj, 14, -30)) == 1) or is_success(do_check(dude_obj, 3, -3))) then begin
      call Vance05;
    end
    else begin
      call Vance03;
    end
  Vance03: |
    gsay_reply(822, 112);
    giq_option(4, 822, 113, Vance13, 51);
    giq_option(4, 822, 114, Vance14, 50);
  Vance04: |
    gsay_reply(822, 115);
    giq_option(4, 822, 116, Vance13, 51);
    giq_option(4, 822, 117, Vance14, 50);
  Vance05: 'call Barter;

    '
  Vance06: |
    gsay_reply(822, 120);
    giq_option(-3, 822, 121, Barter, 50);
    giq_option(4, 822, 122, Barter, 50);
    giq_option(4, 822, 123, Vance07, 50);
    giq_option(4, 822, 124, Vance08, 50);
    giq_option(4, 822, 125, Vance09, 50);
    giq_option(4, 822, 126, Vance15, 50);
  Vance07: |
    gsay_reply(822, 127);
    giq_option(4, 822, 128, Vance13, 51);
    giq_option(4, 822, 129, Vance14, 50);
  Vance08: |
    gsay_reply(822, 130);
    giq_option(4, 822, 131, Vance13, 51);
    giq_option(4, 822, 132, Vance10, 50);
    giq_option(4, 822, 133, Vance15, 50);
  Vance09: |
    gsay_reply(822, 134);
    giq_option(4, 822, 135, Barter, 50);
    giq_option(4, 822, 136, Vance07, 51);
    giq_option(4, 822, 137, Vance15, 50);
  Vance10: |
    gsay_reply(822, 138);
    giq_option(4, 822, 139, Barter, 50);
    giq_option(4, 822, 140, Vance15, 50);
  Vance11: |
    gsay_reply(822, 141);
    giq_option(4, 822, 142, Vance13, 51);
    giq_option(4, 822, 143, Vance14, 50);
    giq_option(4, 822, 144, Vance11a, 49);
  Vance11a: |
    if (is_success(roll_vs_skill(dude_obj, 14, -20)) == 1) then begin
      call Vance02;
    end
    else begin
      call Vance13;
    end
  Vance12: |
    gsay_reply(822, 145);
    giq_option(-3, 822, 146, Vance13, 50);
    giq_option(-3, 822, 147, Vance14, 50);
    giq_option(4, 822, 148, Vance13, 50);
    giq_option(4, 822, 149, Vance14, 50);
  Vance13: |
    call BottomReact;
    call combat;
  Vance14: 'kickOut := 1;

    '
  Vance15: "[]"
  VanceEnd: "[]"
  Barter: |
    if (global_var(236) == 0) then begin
      set_global_var(236, 1);
      call Get_Stuff;
    end
    gsay_message(822, 118, 50);
    gdialog_mod_barter(-20);
    gsay_reply(822, 150);
    giq_option(4, 822, 151, VanceEnd, 50);
    giq_option(-3, 822, 152, VanceEnd, 50);
  Get_Stuff: 'move_obj_inven_to_obj(Vance_Box_Ptr, self_obj);

    '
  Put_Stuff: 'move_obj_inven_to_obj(self_obj, Vance_Box_Ptr);

    '
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
vanhag:
  start: "[]"
  critter_p_proc: |
    if (tile_distance_objs(dude_obj, self_obj) < 12) then begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      if (global_var(57) < 1) then begin
        iseeu := 1;
      end
      if ((iseeu == 1) and (waiting == 0) and (Lt_ptr != 0) and (local_var(4) == 0)) then begin
        waiting := 1;
        add_timer_event(self_obj, game_ticks(clock), 1);
      end
    end
  destroy_p_proc: |
    sequence := 10;
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(435, 100));
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: 'float_msg(self_obj, message_str(435, 101), 0);

    '
  timed_event_p_proc: |
    waiting := 0;
    if (sequence == 0) then begin
      float_msg(Lt_ptr, message_str(435, 102), 0);
    end
    else begin
      if (sequence == 1) then begin
        float_msg(self_obj, message_str(435, 103), 0);
      end
      else begin
        if (sequence == 2) then begin
          float_msg(Lt_ptr, message_str(435, 104), 0);
        end
        else begin
          if (sequence == 3) then begin
            float_msg(self_obj, message_str(435, 105), 0);
          end
          else begin
            if (sequence == 4) then begin
              float_msg(Lt_ptr, message_str(435, 106), 0);
            end
            else begin
              if (sequence == 5) then begin
                float_msg(self_obj, message_str(435, 107), 0);
                clock := 6;
              end
              else begin
                if (sequence == 6) then begin
                  float_msg(Lt_ptr, message_str(435, 108), 0);
                  clock := 4;
                end
                else begin
                  if (sequence == 7) then begin
                    float_msg(self_obj, message_str(435, 109), 0);
                  end
                  else begin
                    if (sequence == 8) then begin
                      float_msg(Lt_ptr, message_str(435, 110), 0);
                    end
                    else begin
                      if (sequence == 9) then begin
                        float_msg(self_obj, message_str(435, 111), 0);
                        if (not(local_var(4))) then begin
                          give_exp_points(1000);
                          display_msg(message_str(435, 112));
                          set_local_var(4, 1);
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    sequence := sequence + 1;
  map_enter_p_proc: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 69);
      initialized := 1;
    end
vasquez:
  start: |
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if (script_action == 18) then begin
        if (source_obj == dude_obj) then begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
            set_global_var(156, 1);
            set_global_var(157, 0);
          end
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
            set_global_var(157, 1);
            set_global_var(156, 0);
          end
          set_global_var(159, global_var(159) + 1);
          if ((global_var(159) % 2) == 0) then begin
            set_global_var(155, global_var(155) - 1);
          end
        end
      end
      else begin
        if ((script_action == 21) or (script_action == 3)) then begin
          script_overrides;
          if (known) then begin
            display_msg(message_str(436, 100));
          end
          else begin
            display_msg(message_str(436, 101));
          end
        end
        else begin
          if (script_action == 12) then begin
            if (following) then begin
              if (((game_time / (10 * 60 * 60 * 24)) - hire_date) > 7) then begin
                call end_employment;
              end
              else begin
                call follow_player;
              end
            end
            else begin
              if (script_action == 14) then begin
                if (source_obj == dude_obj) then begin
                  if (not(warned)) then begin
                    call vasquez10;
                  end
                end
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    start_gdialog(436, self_obj, 4, -1, -1);
    gsay_start;
    if (following) then begin
      call vasquez06;
    end
    else begin
      if (known) then begin
        call vasquez07;
      end
      else begin
        call vasquez00;
      end
    end
    gsay_end;
    end_dialogue;
  end_employment: 'following := 0;

    '
  hiring: 'call vasquez05;

    '
  follow_player: |
    if (tile_distance_objs(self_obj, dude_obj) > 3) then begin
      animate_move_obj_to_tile(self_obj, tile_num(dude_obj), 0);
    end
    else begin
      if (anim_busy(self_obj)) then begin
        animate_move_obj_to_tile(self_obj, tile_num(self_obj), 0);
      end
    end
  vasquez01: 'gsay_message(436, 105, 50);

    '
  vasquez00: |
    gsay_reply(436, 102);
    giq_option(4, 436, 103, vasquez02, 50);
    giq_option(-3, 436, 104, vasquez01, 50);
  vasquezend: "[]"
  vasquez10: |
    float_msg(self_obj, message_str(436, 126), 0);
    warned := 1;
  vasquez02: |
    known := 1;
    gsay_reply(436, 106);
    giq_option(4, 436, 107, vasquez03, 50);
    giq_option(4, 436, 108, vasquezend, 50);
  vasquez03: |
    gsay_reply(436, 109);
    giq_option(4, 436, 110, hiring, 50);
    giq_option(4, 436, 111, vasquezend, 50);
  vasquez04: 'gsay_message(436, 112, 50);

    '
  vasquez05: |
    gsay_message(436, 113, 50);
    following := 1;
    hire_date := game_time / (10 * 60 * 60 * 24);
  vasquez06: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    LVar0 := random(1, 5);
    if (LVar0 == 1) then begin
      LVar1 := message_str(436, 114);
    end
    else begin
      if (LVar0 == 2) then begin
        LVar1 := message_str(436, 115);
      end
      else begin
        if (LVar0 == 3) then begin
          LVar1 := message_str(436, 116);
        end
        else begin
          if (LVar0 == 4) then begin
            LVar1 := message_str(436, 117);
          end
          else begin
            if (LVar0 == 5) then begin
              LVar1 := message_str(436, 118);
            end
          end
        end
      end
    end
    float_msg(self_obj, LVar1, 0);
  vasquez07: |
    gsay_reply(436, 119);
    giq_option(4, 436, 120, vasquez09, 50);
    giq_option(4, 436, 121, vasquezend, 50);
    giq_option(-3, 436, 122, vasquez08, 50);
  vasquez08: 'gsay_message(436, 123, 50);

    '
  vasquez09: |
    gsay_reply(436, 124);
    giq_option(4, 436, 125, hiring, 50);
vatalert:
  start: |
    if (not(initialized)) then begin
      initialized := 1;
    end
    else begin
      if (script_action == 3) then begin
        call description_p_proc;
      end
      else begin
        if (script_action == 2) then begin
          call spatial_p_proc;
        end
        else begin
          if (script_action == 8) then begin
            call use_skill_on_p_proc;
          end
        end
      end
    end
  description_p_proc: |
    variable LVar0 := 0;
    LVar0 := message_str(611, 100);
    if (not(local_var(0))) then begin
      if (not(is_success(do_check(dude_obj, 1, has_trait(0, dude_obj, 0))))) then begin
        LVar0 := message_str(611, 101);
      end
      else begin
        set_local_var(0, 1);
      end
    end
    display_msg(LVar0);
  spatial_p_proc: |
    if (map_var(7) == 0) then begin
      if (not(is_success(do_check(dude_obj, 6, 0)))) then begin
        set_global_var(146, 1);
        set_map_var(7, 1);
        display_msg(message_str(611, 102));
        move_to(self_obj, 7000, 0);
        removal_ptr := self_obj;
      end
    end
    else begin
      display_msg(message_str(611, 103));
    end
  use_skill_on_p_proc: |
    if (action_being_used == 11) then begin
      if (local_var(0)) then begin
        script_overrides;
        if (is_success(roll_vs_skill(dude_obj, 11, 0))) then begin
          display_msg(message_str(611, 104));
          move_to(self_obj, 7000, 0);
          removal_ptr := self_obj;
          set_map_var(12, 1);
        end
        else begin
          display_msg(message_str(611, 105));
        end
      end
    end
vatsign:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(362, 100));
vatteam9:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 48);
      initialized := 1;
    end
    if (script_action == 12) then begin
      call critter_p_proc;
    end
    else begin
      if (script_action == 3) then begin
        call description_p_proc;
      end
      else begin
        if (script_action == 18) then begin
          call destroy_p_proc;
        end
        else begin
          if (script_action == 4) then begin
            call pickup_p_proc;
          end
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(146)) then begin
        hostile := 1;
      end
      else begin
        if (not(obj_pid(critter_inven_obj(dude_obj, 0)) == 113)) then begin
          hostile := 1;
        end
      end
    end
  description_p_proc: 'display_msg(message_str(370, 100));

    '
  destroy_p_proc: |
    Team9_Count := Team9_Count - 1;
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  pickup_p_proc: 'hostile := 1;

    '
vatwarn:
  start: "[]"
  spatial_p_proc: |
    if (map_var(7) == 1) then begin
      display_msg(message_str(610, 100));
      float_msg(dude_obj, message_str(610, 101), 7);
    end
vboom:
  start: |
    if (not(initialized)) then begin
      initialized := 1;
    end
    else begin
      if (script_action == 3) then begin
        call description_p_proc;
      end
      else begin
        if (script_action == 21) then begin
          call look_at_p_proc;
        end
        else begin
          if (script_action == 8) then begin
            call use_skill_on_p_proc;
          end
          else begin
            if (script_action == 2) then begin
              call spatial_p_proc;
            end
          end
        end
      end
    end
  description_p_proc: |
    variable LVar0 := 0;
    script_overrides;
    LVar0 := message_str(611, 100);
    if (not(local_var(0))) then begin
      if (not(is_success(do_check(dude_obj, 1, has_trait(0, dude_obj, 0))))) then begin
        LVar0 := message_str(611, 101);
      end
      else begin
        set_local_var(0, 1);
      end
    end
    display_msg(LVar0);
  look_at_p_proc: |
    if (map_var(10) == 1) then begin
      script_overrides;
      call deallocate;
    end
  spatial_p_proc: |
    variable LVar0 := 0;
    if (map_var(10) == 1) then begin
      call deallocate;
    end
    else begin
      if (source_obj == dude_obj) then begin
        if (map_var(7) == 1) then begin
          call detonate;
        end
        else begin
          if (is_success(do_check(dude_obj, 1, has_trait(0, dude_obj, 0) - 3))) then begin
            script_overrides;
            LVar0 := message_str(613, 100);
            if (is_success(roll_vs_skill(dude_obj, 11, 10))) then begin
              LVar0 := LVar0 + message_str(613, 101);
            end
            set_local_var(0, 1);
            display_msg(LVar0);
          end
        end
      end
    end
  use_skill_on_p_proc: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    if (action_being_used == 11) then begin
      if (local_var(0)) then begin
        script_overrides;
        LVar1 := roll_vs_skill(dude_obj, 11, 10);
        if (is_success(LVar1)) then begin
          display_msg(message_str(613, 102));
          LVar0 := create_object_sid(26, 0, 0, -1);
          add_obj_to_inven(dude_obj, LVar0);
          call deallocate;
        end
        else begin
          if (is_critical(LVar1)) then begin
            display_msg(message_str(613, 103));
            call detonate;
          end
          else begin
            display_msg(message_str(613, random(104, 106)));
          end
        end
      end
    end
  deallocate: |
    move_to(self_obj, 7000, 0);
    set_map_var(10, 1);
    removal_ptr := self_obj;
  detonate: |
    variable LVar0 := 0;
    LVar0 := random(10, 20);
    explosion(tile_num(dude_obj), elevation(dude_obj), LVar0);
    call deallocate;
  plasma_death: |
    explosion(tile_num(dude_obj), elevation(dude_obj), 0);
    reg_anim_func(2, dude_obj);
    reg_anim_func(1, 1);
    reg_anim_animate(dude_obj, 32, -1);
    reg_anim_func(3, 0);
    game_ui_disable;
    add_timer_event(dude_obj, game_ticks(5), 8);
vbrokelv:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  use_p_proc: |
    script_overrides;
    reg_anim_func(2, dude_obj);
    display_msg(message_str(904, 100));
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(904, 101));
  description_p_proc: |
    script_overrides;
    display_msg(message_str(904, 102));
vcompop:
  start: |
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 8) then begin
        call use_skill_on_p_proc;
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(214, 100));
    if (global_var(101) == 2) then begin
      display_msg(message_str(214, 104));
    end
  use_skill_on_p_proc: |
    script_overrides;
    if (global_var(101) == 2) then begin
      display_msg(message_str(214, 104));
    end
    else begin
      if (action_being_used == 13) then begin
        if (is_success(roll_vs_skill(dude_obj, 13, 0))) then begin
          display_msg(message_str(214, 101));
        end
        else begin
          display_msg(message_str(214, 102));
        end
      end
      else begin
        display_msg(message_str(214, 103));
      end
    end
vconcomp:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  damage_p_proc: |
    if (global_var(17) == 0) then begin
      set_global_var(147, game_time / 10);
      set_global_var(155, global_var(155) + 5);
      set_global_var(17, 1);
      set_global_var(308, 2);
      call Update_Invasion;
      display_msg(message_str(371, 179));
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(371, 200));
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(371, 100));
  talk_p_proc: |
    if (global_var(147) == 0) then begin
      if (local_var(0) == 1) then begin
        start_gdialog(371, self_obj, 4, -1, -1);
        gsay_start;
        call VConComp01;
        gsay_end;
        end_dialogue;
      end
      else begin
        start_gdialog(371, self_obj, 4, -1, -1);
        gsay_start;
        call VConComp00;
        gsay_end;
        end_dialogue;
      end
    end
  use_p_proc: |
    script_overrides;
    if (local_var(0) == 0) then begin
      display_msg(message_str(371, 177));
    end
    else begin
      dialogue_system_enter;
    end
  use_obj_on_p_proc: |
    if (obj_pid(obj_being_used_with) == 221) then begin
      if (local_var(0) == 0) then begin
        script_overrides;
        display_msg(message_str(371, 180));
        set_local_var(0, 1);
        dialogue_system_enter;
      end
    end
  use_skill_on_p_proc: |
    if (action_being_used == 12) then begin
      script_overrides;
      if (is_success(roll_vs_skill(dude_obj, 12, 0))) then begin
        set_local_var(0, 1);
        display_msg(message_str(371, 176));
        dialogue_system_enter;
      end
      else begin
        display_msg(message_str(371, 178));
      end
      game_time_advance(game_ticks(300));
    end
  VConComp00: 'gsay_message(371, 101, 51);

    '
  VConComp01: |
    gsay_reply(371, 102);
    call VConComp01a;
  VConComp01a: |
    giq_option(4, 371, 103, VConComp02, 50);
    giq_option(4, 371, 104, VConComp11, 50);
    giq_option(4, 371, 105, VConComp32, 50);
    giq_option(4, 371, 106, VConComp05, 50);
    giq_option(1, 371, 181, VConCompEnd, 50);
  VConComp02: |
    gsay_reply(371, 140);
    giq_option(4, 371, 107, VConComp03, 50);
    giq_option(4, 371, 108, VConComp04, 50);
    giq_option(4, 371, 109, VConComp05, 50);
    giq_option(4, 371, 110, VConComp06, 50);
    giq_option(4, 371, 111, VConComp07, 50);
    giq_option(4, 371, 112, VConComp08, 50);
    giq_option(5, 371, 113, VConComp02a, 50);
    giq_option(1, 371, 181, VConCompEnd, 50);
  VConComp02a: |
    if (is_success(roll_vs_skill(dude_obj, 12, -10)) or (global_var(298) == 1)) then begin
      call VConComp09;
    end
    else begin
      call VConComp10;
    end
  VConComp03: |
    gsay_message(371, 114, 50);
    set_global_var(147, (game_time / 10) - 240);
    set_global_var(155, global_var(155) + 5);
    set_global_var(17, 1);
    set_global_var(308, 2);
  VConComp04: |
    gsay_message(371, 115, 50);
    set_global_var(155, global_var(155) + 5);
    set_global_var(147, (game_time / 10) - 30);
    set_global_var(17, 1);
    set_global_var(308, 2);
  VConComp05: |
    gsay_message(371, 116, 50);
    set_global_var(146, 1);
  VConComp06: |
    gsay_message(371, 117, 50);
    set_global_var(147, game_time / 10);
    set_global_var(155, global_var(155) + 5);
    set_global_var(17, 1);
    set_global_var(308, 2);
  VConComp07: |
    gsay_message(371, 118, 50);
    set_global_var(147, game_time / 10);
    set_global_var(155, global_var(155) + 5);
    set_global_var(17, 1);
    set_global_var(308, 2);
  VConComp08: |
    gsay_message(371, 119, 50);
    set_global_var(147, (game_time / 10) - 299);
    set_global_var(155, global_var(155) + 5);
    set_global_var(17, 1);
    set_global_var(308, 2);
  VConComp09: |
    gsay_reply(371, 120);
    giq_option(4, 371, 121, VConComp03, 50);
    giq_option(4, 371, 122, VConComp04, 50);
    giq_option(4, 371, 123, VConComp05, 50);
    giq_option(4, 371, 124, VConComp06, 50);
    giq_option(4, 371, 125, VConComp07, 50);
    giq_option(4, 371, 126, VConComp08, 50);
  VConComp10: |
    if (local_var(1) == 1) then begin
      set_global_var(146, 1);
    end
    else begin
      set_local_var(1, 1);
    end
    gsay_message(371, 127, 51);
  VConComp11: |
    gsay_reply(371, 127);
    giq_option(4, 371, 129, VConComp12, 50);
    giq_option(4, 371, 130, VConComp14, 50);
    giq_option(4, 371, 131, VConComp13, 50);
    giq_option(4, 371, 132, VConComp14, 50);
  VConComp12: |
    gsay_reply(371, 133);
    giq_option(4, 371, 134, VConComp12a, 50);
    giq_option(4, 371, 135, VConComp15, 50);
  VConComp12a: |
    set_global_var(234, 1);
    call VConComp15;
  VConComp13: |
    gsay_reply(371, 136);
    giq_option(4, 371, 134, VConComp13a, 50);
  VConComp13a: |
    set_global_var(235, 1);
    call VConComp15;
  VConComp14: |
    gsay_reply(371, 139);
    call VConComp01a;
  VConComp15: |
    gsay_reply(371, 140);
    call VConComp01a;
  VConComp16: |
    gsay_reply(371, 141);
    giq_option(6, 371, 142, VConComp17, 50);
    giq_option(4, 371, 138, VConComp15, 50);
  VConComp17: |
    gsay_reply(371, 143);
    giq_option(6, 371, 144, VConComp17a, 50);
    giq_option(6, 371, 145, VConComp17b, 50);
    giq_option(4, 371, 138, VConComp15, 50);
  VConComp17a: |
    if (is_success(roll_vs_skill(dude_obj, 12, -10))) then begin
      call VConComp18;
    end
    else begin
      call VConComp20;
    end
  VConComp17b: |
    if (is_success(roll_vs_skill(dude_obj, 7, -10))) then begin
      call VConComp18;
    end
    else begin
      call VConComp20;
    end
  VConComp18: |
    gsay_reply(371, 146);
    call VConComp18a;
  VConComp18a: |
    giq_option(6, 371, 147, VConComp22, 50);
    giq_option(6, 371, 148, VConComp19, 50);
    giq_option(4, 371, 150, VConCompEnd, 50);
  VConComp19: |
    gsay_reply(371, 151);
    giq_option(6, 371, 152, VConComp20, 50);
    giq_option(6, 371, 153, VConComp21, 50);
    giq_option(6, 371, 154, VConComp20, 50);
    giq_option(7, 371, 155, VConComp19a, 50);
  VConComp19a: |
    if (is_success(roll_vs_skill(dude_obj, 12, -10))) then begin
      call VConComp21;
    end
    else begin
      call VConComp20;
    end
  VConComp20: |
    gsay_message(371, 156, 50);
    call VConComp15;
  VConComp21: |
    gsay_reply(371, 157);
    giq_option(6, 371, 158, VConComp27, 50);
    giq_option(7, 371, 159, VConComp30, 50);
    giq_option(4, 371, 150, VConCompEnd, 50);
  VConComp22: |
    gsay_reply(371, 160);
    giq_option(4, 371, 161, VConComp23, 50);
    giq_option(4, 371, 162, VConComp24, 50);
    giq_option(4, 371, 163, VConComp25, 50);
    giq_option(4, 371, 164, VConComp26, 50);
  VConComp23: |
    gsay_reply(371, 165);
    giq_option(4, 371, 166, VConComp22, 50);
    giq_option(4, 371, 138, VConComp15, 50);
  VConComp24: |
    gsay_reply(371, 167);
    giq_option(4, 371, 166, VConComp22, 50);
    giq_option(4, 371, 138, VConComp15, 50);
  VConComp25: |
    gsay_reply(371, 168);
    giq_option(4, 371, 166, VConComp22, 50);
    giq_option(4, 371, 138, VConComp15, 50);
  VConComp26: |
    gsay_reply(371, 169);
    giq_option(4, 371, 166, VConComp22, 50);
    giq_option(4, 371, 138, VConComp15, 50);
  VConComp27: |
    gsay_reply(371, 170);
    giq_option(4, 371, 172, VConComp28, 50);
    giq_option(4, 371, 173, VConComp29, 50);
  VConComp28: |
    set_local_var(2, 1);
    gsay_reply(371, 171);
    giq_option(4, 371, 138, VConComp15, 50);
    giq_option(4, 371, 150, VConCompEnd, 50);
    display_msg(message_str(766, 103) + "100" + message_str(766, 104));
    give_exp_points(100);
  VConComp29: |
    gsay_reply(371, 146);
    call VConComp18a;
  VConComp30: |
    gsay_reply(371, 174);
    giq_option(4, 371, 172, VConComp31, 50);
    giq_option(4, 371, 173, VConComp29, 50);
  VConComp31: |
    set_local_var(2, 1);
    gsay_reply(371, 175);
    giq_option(4, 371, 138, VConComp15, 50);
    giq_option(4, 371, 150, VConCompEnd, 50);
    display_msg(message_str(766, 103) + "100" + message_str(766, 104));
    give_exp_points(100);
  VConComp32: |
    if (local_var(2) == 0) then begin
      call VConComp16;
    end
    else begin
      call VConComp14;
    end
  VConCompEnd: "[]"
  Update_Invasion: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    variable LVar3 := 0;
    variable LVar4 := 0;
    LVar0 := global_var(150) - ((global_var(150) - (game_time / (10 * 60 * 60 * 24))) / 2);
    LVar1 := global_var(151) - ((global_var(151) - (game_time / (10 * 60 * 60 * 24))) / 2);
    LVar2 := global_var(152) - ((global_var(152) - (game_time / (10 * 60 * 60 * 24))) / 2);
    LVar3 := global_var(153) - ((global_var(153) - (game_time / (10 * 60 * 60 * 24))) / 2);
    LVar4 := global_var(154) - ((global_var(154) - (game_time / (10 * 60 * 60 * 24))) / 2);
    set_global_var(150, LVar0);
    set_global_var(151, LVar1);
    set_global_var(152, LVar2);
    set_global_var(153, LVar3);
    set_global_var(154, LVar4);
vcondoor:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
    else begin
      if (script_action == 15) then begin
        call map_enter_p_proc;
      end
      else begin
        if (script_action == 6) then begin
          call use_p_proc;
        end
        else begin
          if (script_action == 7) then begin
            call use_obj_on_p_proc;
          end
          else begin
            if (script_action == 8) then begin
              call use_skill_on_p_proc;
            end
          end
        end
      end
    end
  description_p_proc: |
    script_overrides;
    display_msg(message_str(363, 100));
  map_enter_p_proc: 'obj_lock(self_obj);

    '
  use_p_proc: |
    if (obj_is_locked(self_obj)) then begin
      script_overrides;
      display_msg(message_str(363, 101));
    end
  use_obj_on_p_proc: |
    if (obj_being_used_with == 77) then begin
      script_overrides;
      if (not(obj_is_locked(self_obj))) then begin
        display_msg(message_str(363, 104));
      end
      else begin
        test := roll_vs_skill(dude_obj, 9, 0);
        if (is_success(test)) then begin
          display_msg(message_str(363, 102));
          obj_unlock(self_obj);
        end
        else begin
          if (is_critical(test)) then begin
            display_msg(message_str(363, 103));
            jam_lock(self_obj);
          end
          else begin
            display_msg(message_str(363, 106));
          end
        end
      end
    end
  use_skill_on_p_proc: |
    if (action_being_used == 9) then begin
      script_overrides;
      if (not(obj_is_locked(self_obj))) then begin
        display_msg(message_str(363, 104));
      end
      else begin
        test := roll_vs_skill(source_obj, action_being_used, -20);
        if (is_success(test)) then begin
          display_msg(message_str(363, 102));
          obj_unlock(self_obj);
        end
        else begin
          if (is_critical(test)) then begin
            display_msg(message_str(363, 103));
            jam_lock(self_obj);
          end
          else begin
            display_msg(message_str(363, 105));
          end
        end
      end
    end
victor:
  start: "[]"
  critter_p_proc: |
    if (global_var(626) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    if (global_var(555) != 2) then begin
      call sleeping;
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(4)) then begin
      display_msg(message_str(386, 100));
    end
    else begin
      display_msg(message_str(386, 101));
    end
  map_enter_p_proc: |
    home_tile := 13907;
    sleep_tile := 13097;
    sleep_time := 2203;
    wake_time := 707;
    critter_add_trait(self_obj, 1, 6, 14);
    if (global_var(555) == 2) then begin
      destroy_object(self_obj);
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (local_var(5)) then begin
      float_msg(self_obj, message_str(386, 116), 0);
    end
    else begin
      start_gdialog(386, self_obj, 4, -1, -1);
      gsay_start;
      if (local_var(4)) then begin
        call Victor06;
      end
      else begin
        call Victor01;
      end
      gsay_end;
      end_dialogue;
    end
  timed_event_p_proc: |
    if (obj_can_hear_obj(dude_obj, self_obj)) then begin
      float_msg(self_obj, message_str(386, 102), 5);
    end
    critter_dmg(self_obj, 250, 0);
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(626, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  Victor01: |
    set_local_var(4, 1);
    gsay_reply(386, 103);
    giq_option(4, 386, 104, Victor02, 50);
    giq_option(4, 386, 105, Victor03, 50);
    giq_option(-3, 386, 106, Victor07, 50);
  Victor02: |
    gsay_message(386, 107, 50);
    call VictorCombat;
  Victor03: |
    gsay_reply(386, 108);
    giq_option(4, 386, 109, Victor04, 50);
    giq_option(4, 386, 110, Victor02, 50);
    giq_option(6, 386, 111, Victor05, 50);
  Victor04: |
    gsay_message(386, 112, 50);
    call VictorCombat;
  Victor05: 'gsay_message(386, 113, 50);

    '
  Victor06: |
    gsay_reply(386, 114);
    giq_option(4, 386, 117, Victor04, 50);
    giq_option(4, 386, 118, VictorEnd, 50);
  Victor07: |
    gsay_message(386, 115, 50);
    call VictorDies;
  VictorEnd: "[]"
  VictorCombat: 'hostile := 1;

    '
  VictorDies: 'add_timer_event(self_obj, game_ticks(5), 1);

    '
  sleeping: |
    if (local_var(5) == 1) then begin
      if (not(night_person) and (game_time_hour >= wake_time) and (game_time_hour < sleep_time) or (night_person and ((game_time_hour >= wake_time) or (game_time_hour < sleep_time)))) then begin
        if (((game_time_hour - wake_time) < 10) and ((game_time_hour - wake_time) > 0)) then begin
          if (tile_num(self_obj) != home_tile) then begin
            animate_move_obj_to_tile(self_obj, home_tile, 0);
          end
          else begin
            set_local_var(5, 0);
          end
        end
        else begin
          move_to(self_obj, home_tile, elevation(self_obj));
          if (tile_num(self_obj) == home_tile) then begin
            set_local_var(5, 0);
          end
        end
      end
    end
    else begin
      if (night_person and (game_time_hour >= sleep_time) and (game_time_hour < wake_time) or (not(night_person) and ((game_time_hour >= sleep_time) or (game_time_hour < wake_time)))) then begin
        if (((game_time_hour - sleep_time) < 10) and ((game_time_hour - sleep_time) > 0)) then begin
          if (tile_num(self_obj) != sleep_tile) then begin
            animate_move_obj_to_tile(self_obj, self_obj, 0);
          end
          else begin
            set_local_var(5, 1);
          end
        end
        else begin
          if (tile_num(self_obj) != sleep_tile) then begin
            move_to(self_obj, sleep_tile, elevation(self_obj));
          end
          else begin
            set_local_var(5, 1);
          end
        end
      end
    end
vinnie:
  start: "[]"
  critter_p_proc: |
    if (global_var(626) == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if ((cur_map_index == 11) and (line160flag == 0)) then begin
        float_msg(self_obj, message_str(385, 160), 2);
        game_ui_disable;
        add_timer_event(self_obj, game_ticks(2), 1);
        line160flag := 1;
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(626, 1);
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
    if (cur_map_index == 11) then begin
      set_map_var(0, map_var(0) - 1);
    end
  look_at_p_proc: |
    script_overrides;
    if (local_var(0)) then begin
      display_msg(message_str(385, 100));
    end
    else begin
      display_msg(message_str(385, 101));
    end
  map_enter_p_proc: |
    critter_add_trait(self_obj, 1, 6, 14);
    critter_add_trait(self_obj, 1, 5, 59);
    if ((global_var(555) == 2) or ((cur_map_index == 11) and (global_var(284) == 1))) then begin
      move_to(self_obj, 7000, 0);
      set_obj_visibility(self_obj, 1);
      removal_ptr := self_obj;
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (global_var(285) == 2) then begin
      float_msg(self_obj, message_str(385, 171), 4);
    end
    else begin
      if (global_var(284) == 1) then begin
        float_msg(self_obj, message_str(385, 170), 2);
      end
      else begin
        start_gdialog(385, self_obj, 4, -1, -1);
        gsay_start;
        if (global_var(285) == 1) then begin
          call Vinnie24;
        end
        else begin
          if (local_var(2) == 1) then begin
            call Vinnie19;
          end
          else begin
            if (local_var(0) == 1) then begin
              call Vinnie10;
            end
            else begin
              call Vinnie01;
            end
          end
        end
        gsay_end;
        end_dialogue;
      end
    end
    if (local_var(1) == 1) then begin
      display_msg(message_str(385, 163));
      give_exp_points(400);
      set_global_var(155, global_var(155) - 1);
      set_local_var(1, 2);
      if (global_var(284) == 0) then begin
        set_global_var(283, (game_time / (10 * 60 * 60 * 24)) + 2);
      end
    end
    if (Vinnie_kill_Neal) then begin
      Vinnie_kill_Neal := 0;
      load_map(11, 7);
    end
    if ((global_var(283) > (game_time / (10 * 60 * 60 * 24))) and (global_var(284) == 0)) then begin
      float_msg(self_obj, message_str(385, 159), 0);
    end
  combat_p_proc: "[]"
  timed_event_p_proc: |
    if (fixed_param == 1) then begin
      game_ui_enable;
      if (map_var(1) != 0) then begin
        set_global_var(626, 1);
        float_msg(self_obj, message_str(385, 162), 2);
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      else begin
        attack_complex(Neal_ptr, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  Vinnie01: |
    set_local_var(0, 1);
    gsay_reply(385, 103);
    giq_option(4, 385, 104, Vinnie02, 50);
    giq_option(4, 385, 105, Vinnie03, 50);
    if (global_var(282) == 1) then begin
      giq_option(4, 385, 102, Vinnie01a, 50);
    end
    giq_option(-3, 385, 106, Vinnie04, 50);
  Vinnie01a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Vinnie14;
    end
    else begin
      call Vinnie15;
    end
  Vinnie02: 'gsay_message(385, 107, 51);

    '
  Vinnie03: |
    gsay_reply(385, 108);
    giq_option(4, 385, 109, VinnieEnd, 50);
    giq_option(4, 385, 110, Vinnie06, 50);
    giq_option(6, 385, 111, Vinnie05, 50);
  Vinnie04: 'gsay_message(385, 112, 50);

    '
  Vinnie05: |
    gsay_reply(385, 113);
    giq_option(4, 385, 114, VinnieEnd, 50);
    giq_option(6, 385, 115, Vinnie07, 50);
  Vinnie06: |
    gsay_message(385, 116, 51);
    call VinnieCombat;
  Vinnie07: |
    gsay_reply(385, 117);
    giq_option(4, 385, 118, VinnieEnd, 50);
    giq_option(6, 385, 119, Vinnie08, 50);
  Vinnie08: |
    gsay_reply(385, 120);
    giq_option(4, 385, 121, VinnieEnd, 50);
    if (global_var(39)) then begin
      giq_option(6, 385, 122, Vinnie09, 50);
    end
  Vinnie09: 'gsay_message(385, 123, 50);

    '
  Vinnie10: |
    gsay_reply(385, 126);
    giq_option(4, 385, 127, VinnieEnd, 50);
    if (global_var(282) == 1) then begin
      giq_option(4, 385, 102, Vinnie01a, 50);
    end
  Vinnie14: |
    gsay_reply(385, 131);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 385, 132, VinnieCombat, 51);
    end
    giq_option(4, 385, 133, Vinnie16, 50);
    giq_option(4, 385, 134, Vinnie14a, 50);
  Vinnie14a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Vinnie16;
    end
    else begin
      call Vinnie15;
    end
  Vinnie15: |
    gsay_reply(385, 135);
    giq_option(4, 385, 136, Vinnie15a, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 385, 137, VinnieCombat, 51);
    end
    giq_option(4, 385, 138, VinnieEnd, 50);
    giq_option(4, 385, 139, Vinnie03, 50);
  Vinnie15a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call Vinnie16;
    end
    else begin
      call Vinnie04;
    end
  Vinnie16: |
    gsay_reply(385, 140);
    if (global_var(284) == 1) then begin
      giq_option(4, 385, 145, Vinnie22, 49);
    end
    else begin
      if (global_var(286) == 1) then begin
        giq_option(4, 385, 144, Vinnie19, 49);
      end
      else begin
        giq_option(4, 385, 141, Vinnie17, 50);
      end
    end
    giq_option(4, 385, 142, Vinnie18, 51);
    giq_option(4, 385, 143, Vinnie04, 51);
  Vinnie17: |
    set_local_var(2, 1);
    gsay_message(385, 146, 49);
  Vinnie18: 'gsay_message(385, 147, 51);

    '
  Vinnie19: |
    gsay_reply(385, 148);
    if (obj_is_carrying_obj_pid(dude_obj, 112)) then begin
      giq_option(4, 385, 149, Vinnie20, 49);
    end
    else begin
      giq_option(4, 385, 150, Vinnie21, 51);
    end
    if (global_var(284) == 1) then begin
      giq_option(4, 385, 151, Vinnie22, 49);
    end
  Vinnie20: |
    set_local_var(2, 0);
    if (local_var(1) == 0) then begin
      set_local_var(1, 1);
    end
    if (global_var(284) == 1) then begin
      call Vinnie22;
    end
    else begin
      set_global_var(283, (game_time / (10 * 60 * 60 * 24)) + 2);
      gsay_reply(385, 152);
      giq_option(4, 385, 153, Vinnie06, 51);
      giq_option(4, 385, 154, VinnieKillNeal, 49);
      giq_option(5, 385, 155, Vinnie23, 50);
    end
  Vinnie21: 'gsay_message(385, 156, 51);

    '
  Vinnie22: |
    set_local_var(2, 0);
    set_global_var(285, 2);
    gsay_message(385, 157, 49);
  Vinnie23: |
    set_global_var(285, 1);
    gsay_message(385, 158, 50);
  Vinnie24: |
    gsay_reply(385, 165);
    giq_option(4, 385, 166, VinnieKillNeal, 49);
    giq_option(4, 385, 167, Vinnie23, 50);
    giq_option(4, 385, 168, Vinnie25, 51);
  Vinnie25: |
    gsay_message(385, 169, 51);
    call VinnieCombat;
  VinnieEnd: "[]"
  VinnieCombat: 'hostile := 1;

    '
  VinnieKillNeal: |
    set_global_var(285, 2);
    Vinnie_kill_Neal := 1;
viola:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 69);
      Only_Once := 0;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(496, 100));
      end
      else begin
        if (script_action == 18) then begin
          if (source_obj == dude_obj) then begin
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
              set_global_var(156, 1);
              set_global_var(157, 0);
            end
            if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
              set_global_var(157, 1);
              set_global_var(156, 0);
            end
            set_global_var(160, global_var(160) + 1);
            if ((global_var(160) % 6) == 0) then begin
              set_global_var(155, global_var(155) + 1);
            end
          end
        end
        else begin
          if (script_action == 4) then begin
            hostile := 1;
          end
          else begin
            if (script_action == 12) then begin
              if (hostile) then begin
                hostile := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    GENDER := get_critter_stat(dude_obj, 34);
    call weapon_check;
    start_gdialog(-1, self_obj, 4, -1, -1);
    gsay_start;
    if ((local_var(4) == 1) and (get_critter_stat(dude_obj, 4) < 4)) then begin
      gsay_message(496, 143, 51);
    end
    else begin
      if ((global_var(195) == 1) and not(obj_pid(critter_inven_obj(dude_obj, 0)) == 113)) then begin
        call viola00;
      end
      else begin
        if (TALKEDTOLAURA == 1) then begin
          if (LAURAWARNING == 0) then begin
            call viola01;
          end
          else begin
            call viola02;
          end
        end
        else begin
          if (armed == 1) then begin
            call viola03;
          end
          else begin
            if ((local_var(4) == 1) and (LAURAWARNING == 0)) then begin
              call viola04;
            end
            else begin
              if (armed == 0) then begin
                if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
                  call viola05;
                end
                else begin
                  if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                    call viola06;
                  end
                  else begin
                    if ((global_var(158) > 2) and (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1)))) then begin
                      call viola07;
                    end
                    else begin
                      call viola08;
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    set_local_var(4, 1);
    gsay_end;
    end_dialogue;
  viola00: |
    if (GENDER == 0) then begin
      gsay_reply(496, 101);
    end
    else begin
      gsay_reply(496, 102);
    end
    giq_option(7, 496, 103, viola09, 50);
    giq_option(7, 496, 104, viola10, 50);
    giq_option(4, 496, 105, viola11, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 496, 106, viola12, 50);
    end
    giq_option(4, 496, 107, violacombat, 50);
    giq_option(-3, 496, 299, violaend, 50);
    giq_option(-3, 496, 108, violacombat, 50);
  viola01: |
    LAURAWARNING := 1;
    gsay_reply(496, 109);
    giq_option(7, 496, 110, viola13, 50);
    giq_option(4, 496, 111, viola14, 50);
    giq_option(4, 496, 112, viola15, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 113, violacombat, 50);
    end
    giq_option(-3, 496, 114, violaend, 50);
  viola02: 'gsay_message(496, 115, 50);

    '
  viola03: 'gsay_message(496, 116, 50);

    '
  viola04: |
    gsay_reply(496, 117);
    giq_option(7, 496, 118, viola15, 50);
    giq_option(4, 496, 119, viola16, 50);
    giq_option(4, 496, 120, viola17, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 496, 121, viola18, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 122, viola19, 50);
    end
    giq_option(-3, 496, 299, violaend, 50);
  viola05: |
    gsay_reply(496, 123);
    giq_option(7, 496, 124, viola05a, 50);
    giq_option(4, 496, 125, viola46, 50);
    giq_option(4, 496, 126, viola47, 50);
    giq_option(4, 496, 127, viola48, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 128, viola49, 50);
    end
  viola05a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call viola44;
    end
    else begin
      call viola45;
    end
  viola06: |
    if (GENDER == 0) then begin
      gsay_reply(496, 129);
    end
    else begin
      gsay_reply(496, 130);
    end
    giq_option(7, 496, 131, viola06a, 50);
    giq_option(4, 496, 132, viola52, 50);
    giq_option(4, 496, 133, viola47, 50);
    giq_option(4, 496, 134, viola48, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 135, viola49, 50);
    end
  viola06a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call viola50;
    end
    else begin
      call viola51;
    end
  viola07: |
    if (GENDER == 0) then begin
      gsay_reply(496, 136);
    end
    else begin
      gsay_reply(496, 137);
    end
    giq_option(7, 496, 138, viola07a, 50);
    giq_option(4, 496, 139, viola52, 50);
    giq_option(4, 496, 140, viola47, 50);
    giq_option(4, 496, 141, viola48, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 142, viola49, 50);
    end
  viola07a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call viola50;
    end
    else begin
      call viola51;
    end
  viola08: |
    gsay_reply(496, 143);
    giq_option(7, 496, 144, viola08a, 50);
    giq_option(4, 496, 145, viola55, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 146, viola40, 50);
    end
    giq_option(-3, 496, 299, violaend, 50);
  viola08a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call viola53;
    end
    else begin
      call viola54;
    end
  viola09: 'gsay_message(496, 147, 50);

    '
  viola10: 'gsay_message(496, 148, 50);

    '
  viola11: 'gsay_message(496, 149, 50);

    '
  viola12: 'gsay_message(496, 150, 50);

    '
  viola13: |
    gsay_reply(496, 151);
    giq_option(7, 496, 152, viola20, 50);
    giq_option(4, 496, 153, viola21, 50);
    giq_option(4, 496, 154, viola22, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 155, viola23, 50);
    end
  viola14: |
    gsay_reply(496, 156);
    giq_option(7, 496, 157, viola16, 50);
    giq_option(4, 496, 158, viola21, 50);
    giq_option(4, 496, 159, viola22, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 160, viola23, 50);
    end
  viola15: 'gsay_message(496, 161, 50);

    '
  viola16: 'gsay_message(496, 162, 50);

    '
  viola17: 'gsay_message(496, 163, 50);

    '
  viola18: 'gsay_message(496, 164, 50);

    '
  viola19: 'gsay_message(496, 165, 50);

    '
  viola20: |
    gsay_reply(496, 166);
    giq_option(7, 496, 167, viola24, 50);
    giq_option(4, 496, 168, viola24, 50);
    giq_option(4, 496, 169, viola25, 50);
    giq_option(4, 496, 170, viola26, 50);
    giq_option(4, 496, 171, viola27, 50);
  viola21: 'gsay_message(496, 172, 50);

    '
  viola22: |
    gsay_reply(496, 173);
    giq_option(7, 496, 174, viola41, 50);
    giq_option(4, 496, 175, viola21, 50);
    giq_option(4, 496, 176, viola42, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 177, viola43, 50);
    end
  viola23: 'gsay_message(496, 178, 50);

    '
  viola24: |
    gsay_reply(496, 179);
    giq_option(7, 496, 180, viola28, 50);
    giq_option(7, 496, 181, viola29, 50);
    giq_option(4, 496, 182, viola30, 50);
    giq_option(4, 496, 183, viola31, 50);
  viola25: |
    gsay_reply(496, 184);
    giq_option(7, 496, 185, viola31, 50);
    giq_option(4, 496, 186, viola32, 50);
    giq_option(4, 496, 187, viola33, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 188, viola34, 50);
    end
  viola26: |
    gsay_reply(496, 189);
    giq_option(7, 496, 190, viola35, 50);
    giq_option(4, 496, 191, viola32, 50);
    giq_option(4, 496, 192, viola36, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 193, viola37, 50);
    end
  viola27: |
    gsay_reply(496, 194);
    giq_option(7, 496, 195, viola29, 50);
    giq_option(4, 496, 196, viola38, 50);
    giq_option(4, 496, 197, viola39, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 198, viola40, 50);
    end
  viola28: 'gsay_message(496, 199, 50);

    '
  viola29: 'gsay_message(496, 200, 50);

    '
  viola30: 'gsay_message(496, 201, 50);

    '
  viola31: 'gsay_message(496, 202, 50);

    '
  viola32: 'gsay_message(496, 203, 50);

    '
  viola33: 'gsay_message(496, 204, 50);

    '
  viola34: 'gsay_message(496, 205, 50);

    '
  viola35: 'gsay_message(496, 206, 50);

    '
  viola36: 'gsay_message(496, 207, 50);

    '
  viola37: 'gsay_message(496, 208, 50);

    '
  viola38: 'gsay_message(496, 209, 50);

    '
  viola39: 'gsay_message(496, 210, 50);

    '
  viola40: 'gsay_message(496, 211, 50);

    '
  viola41: |
    gsay_reply(496, 212);
    giq_option(7, 496, 213, viola28, 50);
    giq_option(7, 496, 214, viola29, 50);
    giq_option(4, 496, 215, viola32, 50);
    giq_option(4, 496, 216, viola30, 50);
    giq_option(4, 496, 217, viola31, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 218, viola43, 50);
    end
  viola42: |
    gsay_reply(496, 219);
    giq_option(7, 496, 220, viola28, 50);
    giq_option(7, 496, 221, viola29, 50);
    giq_option(4, 496, 222, viola32, 50);
    giq_option(4, 496, 223, viola30, 50);
    giq_option(4, 496, 224, viola31, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 225, viola43, 50);
    end
  viola43: 'gsay_message(496, 226, 50);

    '
  viola44: |
    gsay_reply(496, 227);
    giq_option(7, 496, 228, viola56, 50);
    giq_option(4, 496, 229, viola16, 50);
    giq_option(4, 496, 230, viola57, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 231, viola49, 50);
    end
  viola45: 'gsay_message(496, 232, 50);

    '
  viola46: 'gsay_message(496, 233, 50);

    '
  viola47: |
    gsay_reply(496, 234);
    giq_option(7, 496, 235, viola58, 50);
    giq_option(7, 496, 236, viola59, 50);
    giq_option(4, 496, 237, viola60, 50);
    giq_option(4, 496, 238, viola61, 50);
    giq_option(4, 496, 239, viola62, 50);
  viola48: |
    gsay_reply(496, 240);
    giq_option(7, 496, 241, viola63, 50);
    giq_option(7, 496, 242, viola64, 50);
    giq_option(4, 496, 243, viola65, 50);
    giq_option(4, 496, 244, viola66, 50);
    giq_option(4, 496, 245, viola67, 50);
  viola49: 'gsay_message(496, 246, 50);

    '
  viola50: |
    gsay_reply(496, 247);
    giq_option(7, 496, 248, viola68, 50);
    giq_option(7, 496, 249, viola69, 50);
    giq_option(7, 496, 250, viola70, 50);
    giq_option(7, 496, 251, viola49, 50);
    giq_option(7, 496, 252, viola16, 50);
  viola51: 'gsay_message(496, 253, 50);

    '
  viola52: |
    gsay_reply(496, 254);
    giq_option(7, 496, 255, viola71, 50);
    giq_option(7, 496, 256, viola72, 50);
    giq_option(4, 496, 257, viola73, 50);
    giq_option(4, 496, 258, viola74, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 496, 259, viola75, 50);
    end
  viola53: |
    gsay_reply(496, 260);
    giq_option(7, 496, 261, viola53a, 50);
    giq_option(4, 496, 262, viola52, 50);
    giq_option(4, 496, 263, viola47, 50);
    giq_option(4, 496, 264, viola48, 50);
    giq_option(4, 496, 265, viola49, 50);
  viola53a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call viola50;
    end
    else begin
      call viola51;
    end
  viola54: 'gsay_message(496, 266, 50);

    '
  viola55: 'gsay_message(496, 267, 50);

    '
  viola56: 'gsay_message(496, 268, 50);

    '
  viola57: 'gsay_message(496, 269, 50);

    '
  viola58: 'gsay_message(496, 270, 50);

    '
  viola59: 'gsay_message(496, 271, 50);

    '
  viola60: 'gsay_message(496, 272, 50);

    '
  viola61: |
    if (GENDER == 0) then begin
      gsay_message(496, 273, 50);
    end
    else begin
      gsay_message(496, 274, 50);
    end
  viola62: |
    if (GENDER == 0) then begin
      gsay_message(496, 275, 50);
    end
    else begin
      gsay_message(496, 276, 50);
    end
  viola63: 'gsay_message(496, 277, 50);

    '
  viola64: |
    gsay_reply(496, 278);
    giq_option(7, 496, 279, viola63, 50);
    giq_option(7, 496, 280, viola76, 50);
    giq_option(4, 496, 281, viola65, 50);
    giq_option(4, 496, 282, viola66, 50);
    giq_option(4, 496, 283, viola67, 50);
  viola65: 'gsay_message(496, 284, 50);

    '
  viola66: 'gsay_message(496, 285, 50);

    '
  viola67: |
    if (GENDER == 0) then begin
      gsay_message(496, 286, 50);
    end
    else begin
      gsay_message(496, 287, 50);
    end
  viola68: 'gsay_message(496, 288, 50);

    '
  viola69: 'gsay_message(496, 289, 50);

    '
  viola70: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(496, 302, 50);
    end
    else begin
      gsay_message(496, 303, 50);
    end
  viola71: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(496, 304, 50);
    end
    else begin
      gsay_message(496, 305, 50);
    end
  viola72: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(496, 306, 50);
    end
    else begin
      gsay_message(496, 307, 50);
    end
  viola73: |
    if (get_critter_stat(dude_obj, 34) == 0) then begin
      gsay_message(496, 300, 50);
    end
    else begin
      gsay_message(496, 301, 50);
    end
  viola74: 'gsay_message(496, 294, 50);

    '
  viola75: |
    if (GENDER == 0) then begin
      gsay_message(496, 295, 50);
    end
    else begin
      gsay_message(496, 296, 50);
    end
  viola76: 'gsay_message(496, 297, 50);

    '
  violadone: 'gsay_option(496, 298, violaend, 50);

    '
  violaend: "[]"
  violacombat: |
    set_global_var(195, 1);
    hostile := 1;
  weapon_check: |
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      armed := 1;
    end
    else begin
      armed := 0;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
vlaser:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
    else begin
      if (script_action == 2) then begin
        call spatial_p_proc;
      end
      else begin
        if (script_action == 8) then begin
          call use_skill_on_p_proc;
        end
      end
    end
  description_p_proc: |
    variable LVar0 := 0;
    script_overrides;
    if (not(local_var(0))) then begin
      if (is_success(do_check(dude_obj, 1, has_trait(0, dude_obj, 0) - 3))) then begin
        LVar0 := message_str(614, 101);
        if (is_success(roll_vs_skill(dude_obj, 11, 0))) then begin
          LVar0 := LVar0 + message_str(614, 102);
        end
        set_local_var(0, 1);
      end
      else begin
        LVar0 := 0;
      end
    end
    else begin
      LVar0 := message_str(614, 101);
    end
    if (LVar0 != 0) then begin
      display_msg(LVar0);
    end
  spatial_p_proc: |
    if (fired) then begin
      if (tile_num(source_obj) != tile_num(self_obj)) then begin
        fired := 0;
      end
    end
    else begin
      if (map_var(7) == 1) then begin
        if (map_var(9) == 0) then begin
          display_msg(message_str(614, 100));
          critter_dmg(source_obj, random(10, 20), 1);
          fired := 1;
        end
      end
    end
  use_skill_on_p_proc: |
    if (action_being_used == 11) then begin
      if (local_var(0) == 1) then begin
        script_overrides;
        if (is_success(roll_vs_skill(source_obj, 11, 0))) then begin
          display_msg(message_str(614, 103));
          set_map_var(9, 1);
          move_to(self_obj, 7000, 0);
          removal_ptr := self_obj;
        end
        else begin
          display_msg(message_str(614, 104));
        end
      end
    end
vmonowir:
  start: |
    if (script_action == 2) then begin
      call spatial_p_proc;
    end
    else begin
      if (script_action == 8) then begin
        call use_skill_on_p_proc;
      end
    end
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (tile_num(dude_obj) != tile_num(self_obj)) then begin
        triggered := 0;
      end
      else begin
        if (triggered == 0) then begin
          triggered := 1;
          if ((art_anim(obj_art_fid(dude_obj)) == 1) and is_success(do_check(dude_obj, 1, 0)) and is_success(do_check(dude_obj, 5, 0))) then begin
            display_msg(message_str(615, 100));
            set_map_var(13, 1);
          end
          else begin
            display_msg(message_str(615, 101));
            if (art_anim(obj_art_fid(dude_obj)) == 1) then begin
              critter_dmg(dude_obj, random(10, 20), 1);
            end
            else begin
              critter_dmg(dude_obj, random(15, 30), 1);
            end
            if (not(is_success(do_check(dude_obj, 6, 0)))) then begin
              if (random(0, 1)) then begin
                display_msg(message_str(615, 102));
                critter_injure(dude_obj, 8);
              end
              else begin
                display_msg(message_str(615, 103));
                critter_injure(dude_obj, 4);
              end
            end
          end
        end
      end
    end
  use_skill_on_p_proc: |
    if ((map_var(7) == 1) and (map_var(13) == 0)) then begin
      script_overrides;
      if (is_success(roll_vs_skill(dude_obj, 11, -20))) then begin
        display_msg(message_str(615, 104));
        set_map_var(13, 1);
        move_to(self_obj, 7000, 0);
        removal_ptr := self_obj;
      end
      else begin
        if (is_critical(test)) then begin
          display_msg(message_str(615, 106));
          critter_dmg(dude_obj, 1, 1);
        end
        else begin
          display_msg(message_str(615, 105));
        end
      end
    end
vplasma:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
    else begin
      if (script_action == 2) then begin
        call spatial_p_proc;
      end
      else begin
        if (script_action == 8) then begin
          call use_skill_on_p_proc;
        end
      end
    end
  description_p_proc: |
    variable LVar0 := 0;
    script_overrides;
    if (not(local_var(0))) then begin
      if (is_success(do_check(dude_obj, 1, has_trait(0, dude_obj, 0) - 3))) then begin
        LVar0 := message_str(612, 101);
        if (is_success(roll_vs_skill(dude_obj, 11, 0))) then begin
          LVar0 := LVar0 + message_str(612, 102);
        end
        set_local_var(0, 1);
      end
      else begin
        LVar0 := 0;
      end
    end
    else begin
      LVar0 := message_str(612, 101);
    end
    if (LVar0 != 0) then begin
      display_msg(LVar0);
    end
  spatial_p_proc: |
    if (fired) then begin
      if (tile_num(source_obj) != tile_num(self_obj)) then begin
        fired := 0;
      end
    end
    else begin
      if (map_var(7) == 1) then begin
        if (map_var(11) == 0) then begin
          display_msg(message_str(612, 100));
          critter_dmg(source_obj, random(10, 20), 3);
          fired := 1;
        end
      end
    end
  use_skill_on_p_proc: |
    if (action_being_used == 11) then begin
      if (local_var(0) == 1) then begin
        script_overrides;
        if (is_success(roll_vs_skill(source_obj, 11, 0))) then begin
          display_msg(message_str(612, 103));
          set_map_var(11, 1);
          move_to(self_obj, 7000, 0);
          removal_ptr := self_obj;
        end
        else begin
          display_msg(message_str(612, 104));
        end
      end
    end
vree:
  start: |
    if (GVar11) then begin
      GVar11 := 0;
      Vree_ptr := self_obj;
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 80);
      add_timer_event(self_obj, game_ticks(40), 1);
    end
    if (script_action == 21) then begin
      call look_at_p_proc;
    end
    else begin
      if (script_action == 4) then begin
        call pickup_p_proc;
      end
      else begin
        if (script_action == 11) then begin
          call talk_p_proc;
        end
        else begin
          if (script_action == 22) then begin
            call time_p_proc;
          end
          else begin
            if (script_action == 12) then begin
              call critter_p_proc;
            end
            else begin
              if (script_action == 18) then begin
                call destroy_p_proc;
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    start_gdialog(57, self_obj, 4, 4, 5);
    call get_reaction;
    gsay_start;
    GVar4 := get_critter_stat(dude_obj, 34) == 0;
    if (local_var(4) > 0) then begin
      if (GVar8) then begin
        call vree32;
      end
      if (GVar9) then begin
        call vree34;
      end
      if (GVar10 == 1) then begin
        call vree43;
      end
      if (GVar10 == 2) then begin
        call vree45;
      end
      if (GVar10 < 1) then begin
        if (local_var(1) > 1) then begin
          call vree17;
        end
        else begin
          call vree46;
        end
      end
    end
    else begin
      set_local_var(4, 1);
      if (local_var(1) >= 2) then begin
        call vree02;
      end
      else begin
        call vree00;
      end
    end
    gsay_end;
    end_dialogue;
  vree_end: "[]"
  vreecbt: "[]"
  vree00: |
    gsay_reply(58, 101);
    giq_option(4, 58, 102, vree00a, 49);
    giq_option(4, 58, 103, vree_end, 50);
    giq_option(4, 58, 104, vree01, 50);
    giq_option(-3, 58, 105, vree31, 50);
  vree01: |
    gsay_reply(58, 106);
    giq_option(4, 58, 107, vree_end, 50);
    giq_option(4, 58, 108, vree01a, 51);
    giq_option(4, 58, 109, vree01b, 51);
  vree02: |
    gsay_reply(58, 110);
    giq_option(4, 58, 111, vree03, 50);
    giq_option(5, 58, 112, vree17, 50);
    giq_option(-3, 58, 113, vree31, 50);
  vree03: |
    gsay_reply(58, 114);
    giq_option(4, 58, 115, vree03a, 50);
  vree03a: |
    gsay_message(58, 116, 50);
    call vree17;
  vree17: |
    gsay_reply(58, 117);
    call vree17z;
  vree17a: |
    gsay_reply(58, 118);
    call vree17z;
  vree17z: |
    if (global_var(30) != 1) then begin
      giq_option(4, 58, 119, vree48, 50);
    end
    giq_option(4, 58, 120, branch01, 50);
    giq_option(5, 58, 121, branch02, 50);
    if (obj_is_carrying_obj_pid(dude_obj, 190) or obj_is_carrying_obj_pid(dude_obj, 192) or obj_is_carrying_obj_pid(dude_obj, 193) or ((global_var(258) == 1) and (local_var(8) == 0)) or ((global_var(259) == 1) and (local_var(9) == 0)) or ((global_var(260) == 1) and (local_var(10) == 0))) then begin
      giq_option(5, 58, 402, disk01, 50);
    end
    if (local_var(5) != 1) then begin
      giq_option(6, 58, 122, branch03, 50);
    end
    if (local_var(6) == 0) then begin
      giq_option(7, 58, 123, branch04, 50);
    end
  vree18: |
    set_map_var(0, 1);
    gsay_reply(58, 124);
    giq_option(4, 58, 125, vree_end, 50);
    giq_option(4, 58, 126, vree17a, 50);
  vree19: |
    gsay_reply(58, 127);
    call vree_end;
  vree21: |
    gsay_reply(58, 128);
    if (local_var(7) == 0) then begin
      giq_option(5, 58, 129, vree22, 50);
    end
    giq_option(4, 58, 130, vree_end, 50);
    giq_option(4, 58, 131, vree17a, 50);
  vree22: |
    set_local_var(7, 1);
    gsay_message(58, 132, 50);
    add_timer_event(self_obj, game_ticks(4), 2);
  vree24: |
    gsay_message(58, 134, 50);
    call vree_end;
  vree25: |
    GVar3 := create_object_sid(109, 0, 0, -1);
    add_obj_to_inven(dude_obj, GVar3);
    gsay_reply(58, 135);
    giq_option(4, 58, 136, vree_end, 50);
    giq_option(4, 58, 137, vree17a, 50);
  vree26: |
    gsay_message(58, 138, 50);
    call vree_end;
  vree27: |
    gsay_reply(58, 139);
    giq_option(6, 58, 140, vree28, 50);
    giq_option(5, 58, 141, vree_end, 50);
    giq_option(4, 58, 142, vree17a, 50);
  vree28: |
    gsay_reply(58, 143);
    giq_option(6, 58, 144, vree_end, 50);
    giq_option(6, 58, 145, vree29, 50);
    giq_option(4, 58, 146, vree17a, 50);
  vree29: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(194, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    set_local_var(6, 1);
    set_global_var(310, 1);
    gsay_reply(58, 147);
    giq_option(4, 58, 148, vree_end, 50);
    giq_option(4, 58, 149, vree17a, 50);
  vree30: |
    gsay_message(58, 150, 50);
    call vree_end;
  vree31: |
    gsay_message(58, 151, 50);
    call vree_end;
  vree32: |
    gsay_reply(58, 152);
    giq_option(4, 58, 153, vreecbt, 51);
    giq_option(5, 58, 154, vree33, 50);
  vree33: |
    gsay_reply(58, 155);
    giq_option(4, 58, 156, vreecbt, 51);
  vree34: |
    gsay_reply(58, 157);
    giq_option(4, 58, 158, vree36, 50);
    giq_option(5, 58, 159, vree39, 50);
    giq_option(-3, 58, 160, vree35, 50);
  vree35: |
    gsay_message(58, 161, 50);
    call vree_end;
  vree36: |
    gsay_reply(58, 162);
    giq_option(5, 58, 163, vree36_1, 50);
    giq_option(4, 58, 164, vree_end, 50);
  vree36_1: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call vree37;
    end
    else begin
      call vree38;
    end
  vree37: |
    gsay_message(58, 165, 50);
    call vree_end;
  vree38: |
    gsay_message(58, 166, 50);
    call vree_end;
  vree39: |
    gsay_reply(58, 167);
    giq_option(6, 58, 168, vree40, 50);
    giq_option(6, 58, 169, vree42, 50);
  vree40: |
    gsay_reply(58, 170);
    giq_option(6, 58, 171, vree41, 50);
    giq_option(6, 58, 172, vree_end, 50);
  vree41: |
    gsay_message(58, 173, 50);
    call vree_end;
  vree42: |
    gsay_message(58, 174, 50);
    call vree_end;
  vree43: |
    gsay_reply(58, 175);
    giq_option(4, 58, 176, vree44, 50);
    giq_option(-3, 58, 177, vree35, 50);
  vree44: |
    gsay_message(58, 178, 50);
    call vree_end;
  vree45: |
    gsay_message(58, 179, 50);
    call vree45a;
  vree46: |
    gsay_reply(58, 180);
    giq_option(4, 58, 181, vree47, 50);
    giq_option(4, 58, 182, vree46a, 50);
  vree47: |
    gsay_message(58, 183, 50);
    if (local_var(1) > 2) then begin
      call vree17;
    end
    else begin
      gsay_message(58, 184, 50);
      call vree_end;
    end
  vree48: |
    gsay_reply(58, 185);
    giq_option(4, 58, 186, vree_end, 50);
    giq_option(4, 58, 187, vree17, 50);
  branch01: |
    if (local_var(1) >= 2) then begin
      call vree18;
    end
    else begin
      call vree19;
    end
  branch02: |
    if (local_var(1) > 1) then begin
      call vree21;
    end
    else begin
      call vree24;
    end
  branch03: |
    set_local_var(5, 1);
    if (local_var(1) > 1) then begin
      call vree25;
    end
    else begin
      call vree26;
    end
  branch04: |
    if (local_var(1) > 1) then begin
      call vree27;
    end
    else begin
      call vree30;
    end
  vree00a: |
    call UpReact;
    call vree_end;
  vree01a: |
    call DownReact;
    call vree_end;
  vree01b: |
    call BigDownReact;
    call vree_end;
  vree45a: |
    variable LVar0 := 0;
    LVar0 := create_object_sid(48, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(48, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(38, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    LVar0 := create_object_sid(39, 0, 0, -1);
    add_obj_to_inven(dude_obj, LVar0);
    call BigUpReact;
    call vree_end;
  vree46a: |
    call DownReact;
    call vree_end;
  disk01: |
    gsay_reply(58, 118);
    if (obj_is_carrying_obj_pid(dude_obj, 190)) then begin
      giq_option(5, 58, 403, diskEnd1, 49);
    end
    if (obj_is_carrying_obj_pid(dude_obj, 192)) then begin
      giq_option(5, 58, 404, diskEnd2, 49);
    end
    if (obj_is_carrying_obj_pid(dude_obj, 193)) then begin
      giq_option(5, 58, 405, diskEnd3, 49);
    end
    if ((global_var(258) == 1) and (local_var(8) == 0)) then begin
      giq_option(5, 58, 406, diskEnd4, 49);
    end
    if ((global_var(259) == 1) and (local_var(9) == 0)) then begin
      giq_option(5, 58, 407, diskEnd5, 49);
    end
    if ((global_var(260) == 1) and (local_var(10) == 0)) then begin
      giq_option(5, 58, 408, diskEnd6, 49);
    end
  diskEnd1: |
    variable LVar0 := 0;
    gsay_message(58, 184, 50);
    LVar0 := obj_carrying_pid_obj(dude_obj, 190);
    if (LVar0) then begin
      rm_obj_from_inven(dude_obj, LVar0);
      destroy_object(LVar0);
    end
    float_msg(self_obj, obj_name(dude_obj) + message_str(58, 409), 3);
    give_exp_points(100);
    display_msg(message_str(58, 410));
  diskEnd2: |
    variable LVar0 := 0;
    gsay_message(58, 184, 50);
    LVar0 := obj_carrying_pid_obj(dude_obj, 192);
    if (LVar0) then begin
      rm_obj_from_inven(dude_obj, LVar0);
      destroy_object(LVar0);
    end
    float_msg(self_obj, obj_name(dude_obj) + message_str(58, 409), 3);
    give_exp_points(100);
    display_msg(message_str(58, 410));
  diskEnd3: |
    variable LVar0 := 0;
    gsay_message(58, 184, 50);
    LVar0 := obj_carrying_pid_obj(dude_obj, 193);
    if (LVar0) then begin
      rm_obj_from_inven(dude_obj, LVar0);
      destroy_object(LVar0);
    end
    float_msg(self_obj, obj_name(dude_obj) + message_str(58, 409), 3);
    give_exp_points(100);
    display_msg(message_str(58, 410));
  diskEnd4: |
    set_local_var(8, 1);
    float_msg(self_obj, obj_name(dude_obj) + message_str(58, 409), 3);
    give_exp_points(100);
    display_msg(message_str(58, 410));
  diskEnd5: |
    set_local_var(9, 1);
    float_msg(self_obj, obj_name(dude_obj) + message_str(58, 409), 3);
    give_exp_points(100);
    display_msg(message_str(58, 410));
  diskEnd6: |
    set_local_var(10, 1);
    float_msg(self_obj, obj_name(dude_obj) + message_str(58, 409), 3);
    give_exp_points(100);
    display_msg(message_str(58, 410));
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(58, 100));
  talk_p_proc: 'call do_dialogue;

    '
  time_p_proc: |
    if (fixed_param == 1) then begin
      GVar0 := random(2, 3);
      if (GVar0 == 2) then begin
        use_obj(term2_ptr);
      end
      else begin
        if (GVar0 == 3) then begin
          use_obj(term3_ptr);
        end
      end
      add_timer_event(self_obj, game_ticks(40), 1);
    end
    else begin
      if (fixed_param == 2) then begin
        use_obj(term1_ptr);
        if (local_var(7) < 2) then begin
          add_timer_event(self_obj, game_ticks(4), 2);
        end
      end
      else begin
        if (fixed_param == 3) then begin
          set_local_var(7, 2);
          add_timer_event(self_obj, game_ticks(4), 1);
        end
      end
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      GVar5 := 1;
    end
  critter_p_proc: |
    if (global_var(250)) then begin
      GVar5 := 1;
    end
    if (tile_distance_objs(self_obj, dude_obj) > 12) then begin
      GVar5 := 0;
    end
    if (GVar5) then begin
      set_global_var(250, 1);
      GVar5 := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  destroy_p_proc: |
    set_global_var(250, 1);
    rm_timer_event(self_obj);
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
vreedisk:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      display_msg(message_str(348, 100));
    end
    else begin
      if (script_action == 6) then begin
        script_overrides;
        if (local_var(0) == 1) then begin
          display_msg(message_str(348, 101));
        end
        else begin
          set_local_var(0, 1);
          display_msg(message_str(348, 102));
          set_global_var(166, 1);
          display_msg(message_str(766, 103) + "100" + message_str(766, 104));
          give_exp_points(100);
        end
      end
    end
vsgteam9:
  start: |
    if (not(initialized)) then begin
      critter_add_trait(self_obj, 1, 6, 34);
      critter_add_trait(self_obj, 1, 5, 48);
      initialized := 1;
    end
    if (script_action == 12) then begin
      call critter_p_proc;
    end
    else begin
      if (script_action == 18) then begin
        call destroy_p_proc;
      end
      else begin
        if (script_action == 4) then begin
          hostile := 1;
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (hostile) then begin
        hostile := 0;
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
      else begin
        if (global_var(146) == 1) then begin
          attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
        end
        else begin
          if (not(obj_pid(critter_inven_obj(dude_obj, 0)) == 113)) then begin
            hostile := 1;
          end
        end
      end
    end
  destroy_p_proc: |
    Team9_Count := Team9_Count - 1;
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(160, global_var(160) + 1);
      if ((global_var(160) % 6) == 0) then begin
        set_global_var(155, global_var(155) + 1);
      end
    end
  pickup_p_proc: 'hostile := 1;

    '
weapsys:
  start: |
    if (script_action == 2) then begin
      if (source_obj == dude_obj) then begin
        if ((global_var(139) == 2) and global_var(140)) then begin
          if (local_var(0) == 0) then begin
            if (is_success(do_check(dude_obj, 1, 0))) then begin
              display_msg(message_str(332, 100));
            end
          end
          set_local_var(0, 1);
        end
      end
    end
wife:
  start: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 2);
      critter_add_trait(self_obj, 1, 5, 23);
    end
  critter_p_proc: |
    if (map_var(2) == 1) then begin
      set_local_var(0, local_var(0) + 1);
      set_map_var(2, 0);
      if (local_var(0) < 3) then begin
        float_msg(self_obj, message_str(129, 308), 2);
      end
      else begin
        HOSTILE := 1;
      end
    end
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(246) == 1) then begin
        HOSTILE := 1;
      end
    end
    if (HOSTILE) then begin
      HOSTILE := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  talk_p_proc: |
    if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
      call Wife00n;
    end
    else begin
      start_gdialog(119, self_obj, 4, -1, -1);
      gsay_start;
      call Wife01;
      gsay_end;
      end_dialogue;
    end
  pickup_p_proc: 'HOSTILE := 1;

    '
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(246, 1);
    end
  Wife01: |
    gsay_reply(119, 100);
    giq_option(4, 119, 101, Wife02, 50);
    giq_option(4, 119, 107, WifeEnd, 50);
    giq_option(-3, 119, 102, Wife03, 50);
  Wife02: 'gsay_message(119, 103, 50);

    '
  Wife03: 'gsay_message(119, 104, 50);

    '
  Wife00n: 'float_msg(self_obj, message_str(119, 105), 8);

    '
  WifeEnd: "[]"
wmcarvn:
  start: "[]"
  combat: 'hostile := 1;

    '
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: 'call WMDriver10;

    '
  talk_p_proc: |
    variable LVar0 := 0;
    call get_reaction;
    if (local_var(10) == 1) then begin
      if (local_var(7) < (game_time / (10 * 60 * 60 * 24 * 365))) then begin
        set_local_var(10, 0);
      end
      else begin
        if ((local_var(6) < get_month) or (local_var(6) == 12) and (get_month == 1) and ((local_var(6) != 1) or (get_month != 12))) then begin
          set_local_var(10, 0);
        end
        else begin
          if ((local_var(5) < get_day) and ((local_var(6) != 1) or (get_month != 12))) then begin
            set_local_var(10, 0);
          end
        end
      end
    end
    call RecalcDate;
    LVar0 := local_var(5);
    if (local_var(8) > 0) then begin
      call WMDriver14;
    end
    else begin
      if (map_var(2) == 0) then begin
        call WMDriver15;
      end
      else begin
        if (global_var(205) == 3) then begin
          call BottomReact;
          start_gdialog(605, self_obj, 4, -1, -1);
          gsay_start;
          call WMDriver37;
          gsay_end;
          end_dialogue;
        end
        else begin
          if (global_var(205) == 5) then begin
            start_gdialog(605, self_obj, 4, -1, -1);
            gsay_start;
            call WMDriver19;
            gsay_end;
            end_dialogue;
          end
          else begin
            if (global_var(205) == 4) then begin
              call TopReact;
              start_gdialog(605, self_obj, 4, -1, -1);
              gsay_start;
              call WMDriver27;
              gsay_end;
              end_dialogue;
            end
            else begin
              if (map_var(1) == 0) then begin
                call WMDriver00;
              end
              else begin
                if ((map_var(1) == 1) and (local_var(10) == 0)) then begin
                  start_gdialog(605, self_obj, 4, -1, -1);
                  gsay_start;
                  if (local_var(9) == 0) then begin
                    call WMDriver01;
                  end
                  else begin
                    call WMDriver03;
                  end
                  gsay_end;
                  end_dialogue;
                end
                else begin
                  if ((local_var(10) == 1) and (LVar0 == get_day)) then begin
                    start_gdialog(605, self_obj, 4, -1, -1);
                    gsay_start;
                    call WMDriver28;
                    gsay_end;
                    end_dialogue;
                  end
                  else begin
                    if ((local_var(10) == 1) and (LVar0 != get_day)) then begin
                      start_gdialog(605, self_obj, 4, -1, -1);
                      gsay_start;
                      call WMDriver29;
                      gsay_end;
                      end_dialogue;
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    set_local_var(4, 1);
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(605, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 35);
      critter_add_trait(self_obj, 1, 5, 50);
    end
  RecalcDate: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    variable LVar2 := 0;
    LVar0 := get_day;
    if ((LVar0 > 1) and (LVar0 <= 5)) then begin
      LVar0 := 5;
      LVar1 := get_month;
      LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
    end
    else begin
      if ((LVar0 > 5) and (LVar0 <= 10)) then begin
        LVar0 := 10;
        LVar1 := get_month;
        LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
      end
      else begin
        if ((LVar0 > 10) and (LVar0 <= 15)) then begin
          LVar0 := 15;
          LVar1 := get_month;
          LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
        end
        else begin
          if ((LVar0 > 15) and (LVar0 <= 20)) then begin
            LVar0 := 20;
            LVar1 := get_month;
            LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
          end
          else begin
            if ((LVar0 > 20) and (LVar0 <= 25)) then begin
              LVar0 := 25;
              LVar1 := get_month;
              LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
            end
            else begin
              if (LVar0 > 25) then begin
                LVar0 := 1;
                LVar1 := get_month;
                if (LVar1 == 12) then begin
                  LVar1 := 1;
                  LVar2 := (game_time / (10 * 60 * 60 * 24 * 365)) + 1;
                end
                else begin
                  LVar1 := LVar1 + 1;
                  LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
                end
              end
              else begin
                if (LVar0 == 1) then begin
                  LVar1 := get_month;
                  LVar2 := game_time / (10 * 60 * 60 * 24 * 365);
                end
              end
            end
          end
        end
      end
    end
    set_local_var(5, LVar0);
    set_local_var(6, LVar1);
    set_local_var(7, LVar2);
  RecalcDateString: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    call RecalcDate;
    LVar0 := local_var(6);
    LVar1 := local_var(5);
    if (LVar0 == 1) then begin
      DayString := message_str(605, 204);
    end
    else begin
      if (LVar0 == 2) then begin
        DayString := message_str(605, 205);
      end
      else begin
        if (LVar0 == 3) then begin
          DayString := message_str(605, 206);
        end
        else begin
          if (LVar0 == 4) then begin
            DayString := message_str(605, 207);
          end
          else begin
            if (LVar0 == 5) then begin
              DayString := message_str(605, 208);
            end
            else begin
              if (LVar0 == 6) then begin
                DayString := message_str(605, 209);
              end
              else begin
                if (LVar0 == 7) then begin
                  DayString := message_str(605, 210);
                end
                else begin
                  if (LVar0 == 8) then begin
                    DayString := message_str(605, 211);
                  end
                  else begin
                    if (LVar0 == 9) then begin
                      DayString := message_str(605, 212);
                    end
                    else begin
                      if (LVar0 == 10) then begin
                        DayString := message_str(605, 213);
                      end
                      else begin
                        if (LVar0 == 11) then begin
                          DayString := message_str(605, 214);
                        end
                        else begin
                          if (LVar0 == 12) then begin
                            DayString := message_str(605, 215);
                          end
                        end
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
    if (LVar1 == 1) then begin
      DayString := DayString + message_str(605, 197);
    end
    else begin
      if (LVar1 == 5) then begin
        DayString := DayString + message_str(605, 198);
      end
      else begin
        if (LVar1 == 10) then begin
          DayString := DayString + message_str(605, 199);
        end
        else begin
          if (LVar1 == 15) then begin
            DayString := DayString + message_str(605, 200);
          end
          else begin
            if (LVar1 == 20) then begin
              DayString := DayString + message_str(605, 201);
            end
            else begin
              if (LVar1 == 25) then begin
                DayString := DayString + message_str(605, 202);
              end
            end
          end
        end
      end
    end
  WMDriver00: |
    if (local_var(4) == 0) then begin
      float_msg(self_obj, message_str(605, 101), 2);
      set_local_var(4, 1);
    end
    else begin
      float_msg(self_obj, message_str(605, 102), 2);
    end
  WMDriver01: |
    if (global_var(71) == 0) then begin
      set_global_var(71, 1);
    end
    if (global_var(75) == 0) then begin
      set_global_var(75, 1);
    end
    gsay_reply(605, 103);
    giq_option(4, 605, 104, WMDriver02, 50);
    giq_option(-3, 605, 105, WMDriver02, 50);
  WMDriver02: |
    variable LVar0 := 0;
    call RecalcDateString;
    LVar0 := local_var(5);
    if (LVar0 == get_day) then begin
      gsay_reply(605, message_str(605, 106) + message_str(605, 107));
    end
    else begin
      gsay_reply(605, message_str(605, 106) + message_str(605, 108) + DayString + message_str(605, 111));
    end
    call WMDriver04;
  WMDriver03: |
    variable LVar0 := 0;
    if (local_var(1) != 1) then begin
      call RecalcDateString;
      LVar0 := local_var(5);
      if (LVar0 == get_day) then begin
        gsay_reply(605, message_str(605, 107));
      end
      else begin
        gsay_reply(605, message_str(605, 108) + DayString + message_str(605, 111));
      end
      call WMDriver04;
    end
    else begin
      gsay_reply(605, 112);
      call WMDriver04;
    end
  WMDriver04: |
    giq_option(4, 605, 113, WMDriver04a, 50);
    giq_option(4, 605, 114, WMDriver05, 50);
    giq_option(4, 605, 115, WMDriver06, 50);
    giq_option(-3, 605, 116, WMDriver07, 50);
    giq_option(-3, 605, 117, WMDriver07, 50);
  WMDriver04a: |
    variable LVar0 := 0;
    set_local_var(10, 1);
    call RecalcDate;
    LVar0 := local_var(5);
    if (LVar0 == get_day) then begin
      call WMDriver17;
    end
    else begin
      call WMDriver18;
    end
  WMDriver05: |
    set_local_var(10, 0);
    gsay_message(605, 118, 50);
  WMDriver06: |
    set_local_var(10, 0);
    gsay_message(605, 120, 50);
  WMDriver07: 'gsay_message(605, 121, 50);

    '
  WMDriver08: 'gsay_message(605, 123, 50);

    '
  WMDriver10: |
    if (local_var(8) == 0) then begin
      set_local_var(8, 1);
      set_map_var(2, 0);
      gsay_reply(605, 125);
      giq_option(4, 605, 126, WMDriver08, 50);
      giq_option(4, 605, 127, WMDriver10a, 50);
      giq_option(4, 605, 128, WMDriver31, 51);
      giq_option(-3, 605, 130, WMDriver31, 51);
    end
    else begin
      gsay_message(605, 131, 51);
      call combat;
    end
  WMDriver10a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 20)) == 1) then begin
      call WMDriver11;
    end
    else begin
      call WMDriver12;
    end
  WMDriver11: |
    set_map_var(1, 0);
    set_map_var(2, 0);
    gsay_message(605, 132, 50);
  WMDriver12: |
    gsay_message(605, 133, 51);
    call combat;
  WMDriver14: |
    if (local_var(8) > 0) then begin
      float_msg(self_obj, message_str(605, 138), 2);
    end
    else begin
      float_msg(self_obj, message_str(605, 139), 2);
      call WMDriver31;
    end
  WMDriver15: |
    variable LVar0 := 0;
    LVar0 := random(1, 4);
    if (LVar0 == 1) then begin
      float_msg(self_obj, message_str(605, 140), 2);
    end
    else begin
      if (LVar0 == 2) then begin
        float_msg(self_obj, message_str(605, 141), 2);
      end
      else begin
        if (LVar0 == 3) then begin
          float_msg(self_obj, message_str(605, 142), 2);
        end
        else begin
          if (LVar0 == 4) then begin
            float_msg(self_obj, message_str(605, 143), 2);
          end
        end
      end
    end
  WMDriver17: |
    gsay_reply(605, 145);
    call WMDriver33;
    call WMDriver20;
  WMDriver18: |
    call RecalcDateString;
    gsay_reply(605, message_str(605, 146) + DayString + message_str(605, 153));
    giq_option(4, 605, 154, WMDriver30, 50);
    giq_option(4, 605, 155, WMDriver34, 50);
  WMDriver19: |
    set_map_var(2, 0);
    set_global_var(205, 6);
    gsay_message(605, 156, 51);
  WMDriver20: |
    giq_option(4, 605, 157, WMDriver21a, 50);
    giq_option(4, 605, 158, WMDriver21b, 50);
    giq_option(4, 605, 159, WMDriver34, 50);
  WMDriver21a: |
    variable LVar0 := 0;
    set_global_var(200, 1);
    LVar0 := random(1, 7);
    if (LVar0 == 1) then begin
      gsay_message(605, 160, 50);
    end
    else begin
      if (LVar0 == 2) then begin
        gsay_message(605, 161, 50);
      end
      else begin
        if (LVar0 == 3) then begin
          gsay_message(605, 162, 50);
        end
        else begin
          if (LVar0 == 4) then begin
            gsay_message(605, 163, 50);
          end
          else begin
            if (LVar0 == 5) then begin
              gsay_message(605, 167, 50);
            end
            else begin
              if (LVar0 == 6) then begin
                gsay_message(605, 168, 50);
              end
              else begin
                if (LVar0 == 7) then begin
                  gsay_message(605, 169, 50);
                end
              end
            end
          end
        end
      end
    end
    LVar0 := do_check(dude_obj, 6, -2);
    if (is_success(LVar0)) then begin
      set_global_var(200, 2);
      set_global_var(215, 1);
      set_global_var(216, 2);
      load_map(10, 1);
    end
    else begin
      load_map(58, 3);
    end
  WMDriver21b: |
    variable LVar0 := 0;
    set_global_var(200, 1);
    LVar0 := random(1, 7);
    if (LVar0 == 1) then begin
      gsay_message(605, 160, 50);
    end
    else begin
      if (LVar0 == 2) then begin
        gsay_message(605, 161, 50);
      end
      else begin
        if (LVar0 == 3) then begin
          gsay_message(605, 162, 50);
        end
        else begin
          if (LVar0 == 4) then begin
            gsay_message(605, 163, 50);
          end
          else begin
            if (LVar0 == 5) then begin
              gsay_message(605, 164, 50);
            end
            else begin
              if (LVar0 == 6) then begin
                gsay_message(605, 165, 50);
              end
              else begin
                if (LVar0 == 7) then begin
                  gsay_message(605, 166, 50);
                end
              end
            end
          end
        end
      end
    end
    LVar0 := do_check(dude_obj, 6, -2);
    if (is_success(LVar0)) then begin
      set_global_var(200, 2);
      set_global_var(215, 1);
      set_global_var(216, 2);
      load_map(28, 1);
    end
    else begin
      load_map(56, 3);
    end
  WMDriver27: |
    gsay_reply(605, 185);
    giq_option(4, 605, 186, WMDriver04a, 50);
    giq_option(4, 605, 187, WMDriver05, 50);
    giq_option(4, 605, 188, WMDriver06, 50);
    giq_option(-3, 605, 189, WMDriver07, 50);
    giq_option(-3, 605, 190, WMDriver07, 50);
  WMDriver28: |
    gsay_reply(605, 191);
    giq_option(4, 605, 192, WMDriver17, 50);
    giq_option(4, 605, 193, WMDriver35, 50);
    giq_option(-3, 605, 194, WMDriver07, 50);
  WMDriver29: |
    variable LVar0 := 0;
    call RecalcDateString;
    LVar0 := local_var(5);
    gsay_message(605, message_str(605, 196) + DayString + message_str(605, 203) + message_str(605, 195), 50);
  WMDriver30: 'set_local_var(10, 1);

    '
  WMDriver31: 'call combat;

    '
  WMDriver33: |
    variable LVar0 := 0;
    set_local_var(10, 0);
    set_global_var(205, 1);
    LVar0 := local_var(9);
    set_local_var(9, LVar0 + 1);
  WMDriver34: 'set_local_var(10, 0);

    '
  WMDriver35: "[]"
  WMDriver37: |
    set_map_var(2, 0);
    set_global_var(205, 6);
    gsay_reply(605, 170);
    giq_option(4, 605, 171, WMDriver38, 50);
    giq_option(4, 605, 172, WMDriverEnd, 50);
    giq_option(4, 605, 173, WMDriver39, 50);
    giq_option(-3, 605, 174, WMDriver40, 50);
    giq_option(-3, 605, 175, WMDriverEnd, 50);
  WMDriver38: |
    gsay_reply(849, 177);
    giq_option(4, 605, 178, WMDriverEnd, 50);
    giq_option(4, 605, 179, combat, 51);
    giq_option(4, 605, 180, WMDriver41, 50);
    giq_option(4, 605, 181, WMDriver42, 50);
  WMDriver39: 'gsay_message(605, 176, 50);

    '
  WMDriver40: 'gsay_message(605, 182, 50);

    '
  WMDriver41: 'gsay_message(605, 183, 50);

    '
  WMDriver42: |
    set_map_var(2, 1);
    set_global_var(205, 1);
    gsay_message(605, 184, 50);
  WMDriverEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
wmgroup:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
  pickup_p_proc: |
    if (source_obj == dude_obj) then begin
      hostile := 1;
    end
  talk_p_proc: |
    variable LVar0 := 0;
    call get_reaction;
    if (map_var(2) == 1) then begin
      LVar0 := random(101, 104);
      float_msg(self_obj, message_str(833, LVar0), 2);
    end
    else begin
      LVar0 := random(105, 107);
      float_msg(self_obj, message_str(833, LVar0), 2);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(833, 100));
  damage_p_proc: |
    variable LVar0 := 0;
    LVar0 := obj_pid(source_obj);
    if (party_member_obj(LVar0) != 0) then begin
      set_global_var(248, 1);
    end
  map_enter_p_proc: |
    if (Only_Once) then begin
      Only_Once := 0;
      critter_add_trait(self_obj, 1, 6, 35);
      critter_add_trait(self_obj, 1, 5, 2);
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
women:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 44);
      critter_add_trait(self_obj, 1, 5, 5);
    end
  critter_p_proc: |
    if ((global_var(114) == 1) and (global_var(115) <= 12) or (global_var(115) <= 6)) then begin
      if (local_var(0) == 0) then begin
        set_local_var(0, 1);
        temp := 200;
        display_msg(message_str(238, 100) + temp + message_str(238, 103));
        set_global_var(155, global_var(155) + 1);
        give_exp_points(temp);
      end
    end
    else begin
      if (signal_women == 2) then begin
        signal_women := signal_women - 1;
        float_msg(self_obj, message_str(738, 101), 2);
      end
      else begin
        if (signal_women == 1) then begin
          signal_women := signal_women - 1;
          float_msg(self_obj, message_str(738, 102), 2);
        end
      end
    end
  talk_p_proc: |
    if (local_var(0) == 1) then begin
      float_msg(self_obj, message_str(738, 104), 3);
    end
    else begin
      float_msg(self_obj, message_str(738, random(102, 103)), 10);
    end
  destroy_p_proc: |
    women_killed := women_killed + 1;
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 2);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(738, 100));
workroom:
  start: |
    if (script_action == 15) then begin
      call initialize;
    end
    else begin
      if (script_action == 22) then begin
        call explode;
      end
      else begin
        if (script_action == 6) then begin
          call explode;
        end
      end
    end
  initialize: 'table_ptr := self_obj;

    '
  look_at_p_proc: "[]"
  explode: |
    new_tile := tile_num_in_direction(tile_num(self_obj), 1, 1);
    explosion(new_tile, elevation(self_obj), 0);
    float_msg(self_obj, message_str(736, random(108, 115)), 8);
wtrgrd:
  start: "[]"
  critter_p_proc: |
    if (hostile) then begin
      hostile := 0;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        if (obj_is_carrying_obj_pid(dude_obj, 126) > 3) then begin
          if (local_var(4) == 0) then begin
            set_local_var(4, 1);
            float_msg(self_obj, message_str(163, 116), 0);
          end
        end
      end
      if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
        if (tile_num(self_obj) != dest_tile) then begin
          animate_move_obj_to_tile(self_obj, dest_tile, 0);
        end
      end
      if (not((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
        on_rounds := 0;
      end
      if ((game_time_hour > 700) and (game_time_hour < 900) and not(on_rounds)) then begin
        dest_tile := 21511;
        on_rounds := 1;
        add_timer_event(self_obj, game_ticks(300), 1);
      end
      if (not((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
        if (not(asleep)) then begin
          if ((game_time_hour > 1905) and (game_time_hour < 1915)) then begin
            animate_move_obj_to_tile(self_obj, 16912, 0);
            if (tile_num(self_obj) == 16912) then begin
              move_to(self_obj, 7000, 2);
              asleep := 1;
            end
          end
          else begin
            move_to(self_obj, 7000, 2);
            asleep := 1;
          end
        end
      end
      else begin
        if ((game_time_hour > 630) and asleep) then begin
          move_to(self_obj, local_var(5), 2);
          asleep := 0;
        end
        else begin
          if ((game_time_hour > 620) and asleep) then begin
            if (elevation(self_obj) != 2) then begin
              move_to(self_obj, 16912, 2);
            end
            else begin
              animate_move_obj_to_tile(self_obj, self_obj, 0);
            end
            asleep := 0;
          end
        end
      end
      if (getting_ration) then begin
        use_obj(recipient);
        float_msg(self_obj, message_str(163, random(113, 114)), 3);
        getting_ration := 0;
      end
      if ((tile_num(self_obj) == 16912) and going_down) then begin
        move_to(self_obj, 22104, 1);
        going_down := 0;
      end
      else begin
        if (tile_num(self_obj) == 22104) then begin
          if (going_down) then begin
            move_to(self_obj, 13704, 0);
            going_down := 0;
          end
          else begin
            if (going_up) then begin
              move_to(self_obj, 16912, 2);
              going_up := 0;
            end
          end
        end
        else begin
          if ((tile_num(self_obj) == 13704) and going_up) then begin
            move_to(self_obj, 22104, 1);
            going_up := 0;
          end
        end
      end
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(261, 1);
    end
    if (source_obj == dude_obj) then begin
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_global_var(156, 1);
        set_global_var(157, 0);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_global_var(157, 1);
        set_global_var(156, 0);
      end
      set_global_var(159, global_var(159) + 1);
      if ((global_var(159) % 2) == 0) then begin
        set_global_var(155, global_var(155) - 1);
      end
    end
  look_at_p_proc: |
    script_overrides;
    display_msg(message_str(163, 100));
  map_enter_p_proc: |
    if (local_var(5) == 0) then begin
      set_local_var(5, tile_num(self_obj));
    end
    dest_tile := local_var(5);
    WtrGrd_ptr := self_obj;
    recipient := 0;
    if (not((game_time_hour >= 700) and (game_time_hour < 1800))) then begin
      move_to(self_obj, 7000, 2);
      asleep := 1;
    end
  pickup_p_proc: |
    float_msg(self_obj, message_str(163, 115), 0);
    hostile := 1;
  talk_p_proc: |
    if (global_var(261) == 1) then begin
      float_msg(self_obj, message_str(185, 102), 2);
    end
    else begin
      if (global_var(101) == 2) then begin
        float_msg(self_obj, message_str(185, 109), 0);
      end
      else begin
        if (global_var(188) == 2) then begin
          float_msg(self_obj, message_str(507, 113), 0);
        end
        else begin
          start_gdialog(163, self_obj, 4, -1, -1);
          gsay_start;
          if ((game_time / (10 * 60 * 60 * 24)) < 30) then begin
            call WtrGrd05;
          end
          else begin
            call WtrGrd01;
          end
          gsay_end;
          end_dialogue;
        end
      end
    end
  timed_event_p_proc: |
    if ((game_time_hour > 700) and (game_time_hour < 900)) then begin
      if (fixed_param == 1) then begin
        dest_tile := 16912;
        going_down := 1;
        add_timer_event(self_obj, game_ticks(60), 2);
      end
      else begin
        if (fixed_param == 2) then begin
          dest_tile := 20910;
          add_timer_event(self_obj, game_ticks(120), 3);
        end
        else begin
          if (fixed_param == 3) then begin
            dest_tile := 22104;
            going_down := 1;
            add_timer_event(self_obj, game_ticks(60), 4);
          end
          else begin
            if (fixed_param == 4) then begin
              dest_tile := 14102;
              add_timer_event(self_obj, game_ticks(120), 5);
            end
            else begin
              if (fixed_param == 5) then begin
                dest_tile := 13704;
                going_up := 1;
                add_timer_event(self_obj, game_ticks(5), 6);
              end
              else begin
                if (fixed_param == 6) then begin
                  going_up := 1;
                  add_timer_event(self_obj, game_ticks(60), 7);
                end
                else begin
                  if (fixed_param == 7) then begin
                    dest_tile := local_var(5);
                  end
                end
              end
            end
          end
        end
      end
    end
    else begin
      dest_tile := 21511;
      move_to(self_obj, 16912, 2);
    end
  WtrGrd01: |
    gsay_reply(163, message_str(163, 101) + proto_data(obj_pid(dude_obj), 1) + message_str(163, 102));
    giq_option(4, 163, 103, WtrGrd03, 50);
    giq_option(4, 163, 127, WtrGrd09, 50);
    giq_option(-3, 163, 104, WtrGrd02, 50);
  WtrGrd02: |
    gsay_reply(163, 105);
    giq_option(-3, 163, 106, WtrGrd03, 50);
  WtrGrd03: |
    gsay_reply(163, 107);
    giq_option(4, 163, 108, WtrGrd04, 50);
    giq_option(4, 163, 127, WtrGrd09, 50);
    giq_option(-3, 163, 109, WtrGrdEnd, 50);
  WtrGrd04: |
    gsay_reply(163, 110);
    giq_option(4, 163, 111, WtrGrdQuest, 50);
    giq_option(4, 163, 112, WtrGrdEnd, 50);
  WtrGrd05: |
    gsay_reply(163, message_str(163, 118) + proto_data(obj_pid(dude_obj), 1) + message_str(163, 119));
    giq_option(4, 163, 120, WtrGrd06, 50);
    giq_option(6, 163, 121, WtrGRd07, 50);
    giq_option(4, 163, 127, WtrGrd09, 50);
    giq_option(-3, 163, 104, WtrGrd02, 50);
  WtrGrd06: |
    gsay_reply(163, 122);
    giq_option(4, 163, 121, WtrGRd07, 50);
    giq_option(4, 634, 105, WtrGrdEnd, 50);
  WtrGRd07: |
    gsay_reply(163, 123);
    giq_option(4, 163, 124, WtrGRd08, 50);
  WtrGRd08: 'gsay_message(163, 125, 50);

    '
  WtrGrd09: 'gsay_message(163, 126, 50);

    '
  WtrGrdEnd: "[]"
  WtrGrdQuest: |
    if (not(global_var(188))) then begin
      set_global_var(188, 1);
    end
wtrthief:
  start: |
    if (script_action == 3) then begin
      call description_p_proc;
    end
  combat_p_proc: |
    if (fixed_param == 4) then begin
      if (Officer_ptr != 0) then begin
        critter_add_trait(Officer_ptr, 1, 6, 0);
      end
    end
  critter_p_proc: |
    variable LVar0 := 0;
    if (hostile) then begin
      hostile := 0;
      scared := 1;
      attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
    end
    else begin
      if (game_time_hour <= 600) then begin
        if (global_var(188) == 1) then begin
          if (not(got_water) and (local_var(7) == 0)) then begin
            if (not(on_the_way)) then begin
              on_the_way := 1;
              set_local_var(4, 22728);
              move_to(self_obj, 16912, 2);
              add_timer_event(self_obj, game_ticks(30), 1);
              set_local_var(6, game_time / 10 / 60 / 60);
            end
          end
        end
        if (tile_num(self_obj) != local_var(4)) then begin
          animate_move_obj_to_tile(self_obj, local_var(4), 0);
        end
      end
      else begin
        set_local_var(7, 0);
        got_water := 0;
        on_the_way := 0;
        if (obj_is_carrying_obj_pid(self_obj, 126)) then begin
          destroy_object(obj_carrying_pid_obj(self_obj, 126));
        end
      end
      if (tile_distance_objs(self_obj, VaultBox_ptr) < 4) then begin
        if (not(got_water)) then begin
          if (anim_busy(self_obj) == 0) then begin
            use_obj(VaultBox_ptr);
            got_water := 1;
            LVar0 := create_object_sid(126, 0, 0, -1);
            add_obj_to_inven(self_obj, LVar0);
            add_timer_event(self_obj, game_ticks(3), 2);
            if (obj_can_see_obj(dude_obj, self_obj)) then begin
              display_msg(message_str(461, 103));
            end
          end
        end
      end
      if (local_var(7) and (tile_num(self_obj) == 16912)) then begin
        move_to(self_obj, 7000, 0);
        set_local_var(4, 7000);
      end
      if (((game_time / 10 / 60 / 60) - local_var(6)) >= 7) then begin
        set_local_var(7, 0);
        got_water := 0;
        on_the_way := 0;
        if (obj_is_carrying_obj_pid(self_obj, 126)) then begin
          destroy_object(obj_carrying_pid_obj(self_obj, 126));
        end
      end
    end
  description_p_proc: |
    script_overrides;
    set_local_var(5, 1);
    display_msg(message_str(461, 102));
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(160, global_var(160) + 1);
        if ((global_var(160) % 6) == 0) then begin
          set_global_var(155, global_var(155) + 1);
        end
      end
      display_msg(message_str(461, 104));
      give_exp_points(500);
    end
    set_global_var(188, 2);
    if (Officer_ptr != 0) then begin
      critter_add_trait(Officer_ptr, 1, 6, 1);
    end
  look_at_p_proc: |
    script_overrides;
    if (not(local_var(5))) then begin
      set_local_var(5, is_success(do_check(self_obj, 1, has_trait(0, dude_obj, 0))));
    end
    if ((tile_distance_objs(self_obj, dude_obj) > 2) and not(local_var(5))) then begin
      display_msg(message_str(461, 100));
    end
    else begin
      display_msg(message_str(461, 101));
    end
  map_enter_p_proc: |
    WtrThief_ptr := self_obj;
    critter_add_trait(self_obj, 1, 6, 87);
    critter_add_trait(self_obj, 1, 5, 1);
    if (global_var(188) == 0) then begin
      set_obj_visibility(self_obj, 1);
    end
    else begin
      set_obj_visibility(self_obj, 0);
    end
    if (local_var(4) != 7000) then begin
      on_the_way := 1;
    end
    if (obj_is_carrying_obj_pid(self_obj, 126)) then begin
      got_water := 1;
    end
  map_update_p_proc: |
    if (global_var(188) == 0) then begin
      set_obj_visibility(self_obj, 1);
    end
    else begin
      set_obj_visibility(self_obj, 0);
    end
    if ((game_time_hour > 700) and (tile_num(self_obj) != 7000)) then begin
      move_to(self_obj, 7000, 0);
      set_local_var(4, 7000);
    end
  pickup_p_proc: 'hostile := 1;

    '
  talk_p_proc: |
    if (scared) then begin
      animate_move_obj_to_tile(self_obj, 16912, 1);
      set_local_var(4, 16912);
    end
    else begin
      start_gdialog(461, self_obj, 4, -1, -1);
      gsay_start;
      set_local_var(5, 1);
      call WtrThief01;
      gsay_end;
      end_dialogue;
      if (global_var(188) == 2) then begin
        gfade_out(600);
        move_to(self_obj, 7000, 2);
        if (Officer_ptr != 0) then begin
          move_to(Officer_ptr, 22093, 2);
          move_to(dude_obj, 22293, 2);
          anim(dude_obj, 1000, 5);
          anim(Officer_ptr, 1000, 2);
          float_msg(Officer_ptr, message_str(461, 105), 0);
        end
        gfade_in(600);
        display_msg(message_str(461, 106));
        give_exp_points(1000);
      end
      if (searched) then begin
        display_msg(message_str(461, 130));
        searched := 0;
      end
    end
  timed_event_p_proc: |
    set_local_var(7, 1);
    if (fixed_param == 1) then begin
      if (obj_can_see_obj(self_obj, dude_obj)) then begin
        set_local_var(4, 16912);
      end
      else begin
        set_local_var(4, 20706);
      end
    end
    else begin
      if (fixed_param == 2) then begin
        set_local_var(4, 16912);
      end
    end
  WtrThief01: |
    variable LVar0 := 0;
    LVar0 := message_str(461, 107);
    LVar0 := LVar0 + proto_data(obj_pid(dude_obj), 1);
    LVar0 := LVar0 + message_str(461, 108);
    gsay_reply(461, LVar0);
    giq_option(4, 461, 109, WtrThief02, 50);
    giq_option(-3, 461, 110, WtrThiefEnd, 50);
  WtrThief02: |
    gsay_reply(461, 111);
    giq_option(4, 461, 112, WtrThiefBye, 50);
    giq_option(4, 461, 113, WtrThief03, 50);
    if (global_var(188) == 1) then begin
      giq_option(4, 461, 114, WtrThief05, 50);
    end
  WtrThief03: |
    gsay_reply(461, 115);
    giq_option(4, 461, 116, WtrThief04, 50);
    giq_option(4, 461, 117, WtrThief05, 51);
  WtrThief04: |
    gsay_reply(461, 118);
    giq_option(4, 461, 119, WtrThiefBye, 50);
  WtrThief05: |
    if (got_water) then begin
      call WtrThief08;
    end
    else begin
      call WtrThief06;
    end
  WtrThief06: |
    gsay_reply(461, 120);
    giq_option(4, 461, 121, WtrThief07, 50);
  WtrThief07: 'searched := 1;

    '
  WtrThief08: |
    gsay_reply(461, 122);
    giq_option(4, 461, 123, WtrThiefEnd, 50);
    giq_option(4, 461, 124, WtrThief09, 51);
  WtrThief09: |
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      call WtrThief10;
    end
    else begin
      call WtrThief11;
    end
  WtrThief10: |
    gsay_reply(461, 125);
    giq_option(4, 461, 126, finish_quest, 50);
  WtrThief11: |
    gsay_reply(461, 127);
    giq_option(4, 461, 121, WtrThief11a, 50);
  WtrThief11a: |
    if (is_success(do_check(dude_obj, 3, 0))) then begin
      call finish_quest;
    end
    else begin
      call WtrThiefCombat;
    end
  WtrThiefCombat: 'hostile := 1;

    '
  finish_quest: 'set_global_var(188, 2);

    '
  WtrThiefBye: |
    gsay_reply(461, 128);
    giq_option(4, 461, 129, WtrThiefEnd, 50);
  WtrThiefEnd: "[]"
yourroom:
  start: |
    if (script_action == 2) then begin
      call spatial_p_proc;
    end
  spatial_p_proc: |
    if (source_obj == dude_obj) then begin
      if (not(local_var(0))) then begin
        display_msg(message_str(210, 100));
        set_local_var(0, 1);
      end
    end
zack:
  start: "[]"
  look_at_p_proc: |
    script_overrides;
    if (local_var(4) == 1) then begin
      display_msg(message_str(377, 100));
    end
    else begin
      display_msg(message_str(377, 101));
    end
  talk_p_proc: |
    variable LVar0 := 0;
    if ((global_var(617) == 1) or (get_critter_stat(dude_obj, 4) < 4)) then begin
      float_msg(self_obj, message_str(669, random(100, 105)), 2);
    end
    else begin
      BarterMod := -10;
      move_obj_inven_to_obj(Locker_Ptr, self_obj);
      if ((((game_time / (10 * 60 * 60 * 24)) - local_var(6)) >= 1) or (local_var(6) == 0)) then begin
        set_local_var(6, game_time / (10 * 60 * 60 * 24));
        set_local_var(7, 3000 + random(0, 1000));
      end
      LVar0 := item_caps_adjust(self_obj, local_var(7));
      call get_reaction;
      start_gdialog(377, self_obj, -1, -1, -1);
      gsay_start;
      if (local_var(5) == 2) then begin
        BarterMod := 15;
      end
      else begin
        if (local_var(5) == 1) then begin
          BarterMod := 5;
        end
        else begin
          BarterMod := -10;
        end
      end
      gdialog_set_barter_mod(BarterMod);
      if (local_var(4) == 0) then begin
        call Zack00;
      end
      else begin
        call Zack01;
      end
      gsay_end;
      end_dialogue;
      set_local_var(7, item_caps_total(self_obj));
      LVar0 := item_caps_adjust(self_obj, -1 * local_var(7));
      move_obj_inven_to_obj(self_obj, Locker_Ptr);
    end
  damage_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(617, 1);
    end
  destroy_p_proc: |
    if (source_obj == dude_obj) then begin
      set_global_var(617, 1);
      if (source_obj == dude_obj) then begin
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
          set_global_var(156, 1);
          set_global_var(157, 0);
        end
        if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
          set_global_var(157, 1);
          set_global_var(156, 0);
        end
        set_global_var(159, global_var(159) + 1);
        if ((global_var(159) % 2) == 0) then begin
          set_global_var(155, global_var(155) - 1);
        end
      end
    end
  critter_p_proc: |
    if (obj_can_see_obj(self_obj, dude_obj)) then begin
      if (global_var(617) == 1) then begin
        attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
      end
    end
  pickup_p_proc: 'set_global_var(617, 1);

    '
  map_enter_p_proc: |
    if (Initialize) then begin
      critter_add_trait(self_obj, 1, 6, 48);
      critter_add_trait(self_obj, 1, 5, 28);
      Initialize := 0;
    end
    if ((global_var(265) == 2) and (days_since_visited > 1)) then begin
      set_obj_visibility(self_obj, 1);
      move_to(self_obj, 3846, 1);
    end
  Zack00: |
    gsay_reply(377, 102);
    gsay_option(377, 104, ZackBarter, 50);
    gsay_option(377, 103, Zack02, 50);
    if (local_var(5) == 0) then begin
      DisplayMessage := 117;
      gsay_option(377, 105, Zack04, 50);
    end
    else begin
      if (local_var(5) == 1) then begin
        DisplayMessage := 123;
        gsay_option(377, 122, Zack05, 50);
      end
    end
    gsay_option(377, 107, ZackEnd, 50);
  Zack01: |
    gsay_reply(377, 106);
    gsay_option(377, 104, ZackBarter, 50);
    gsay_option(377, 103, Zack02, 50);
    if (local_var(5) == 0) then begin
      DisplayMessage := 117;
      gsay_option(377, 105, Zack04, 50);
    end
    else begin
      if (local_var(5) == 1) then begin
        DisplayMessage := 123;
        gsay_option(377, 122, Zack05, 50);
      end
    end
    gsay_option(377, 107, ZackEnd, 50);
  Zack02: |
    gsay_reply(377, 114);
    gsay_option(377, 115, Zack03, 50);
  Zack03: |
    gsay_reply(377, 111);
    gsay_option(377, 113, ZackBarter, 50);
  Zack04: |
    if ((global_var(265) == 9250) or (global_var(265) == 2)) then begin
      BarterMod := 15;
      set_local_var(5, 2);
      call ZackYes;
    end
    else begin
      if (global_var(614) == 9201) then begin
        BarterMod := 5;
        set_local_var(5, 1);
        call ZackYes;
      end
      else begin
        BarterMod := -10;
        call ZackNo;
      end
    end
  Zack05: |
    if (global_var(265) == 9250) then begin
      BarterMod := 15;
      set_local_var(5, 2);
      call ZackYes;
    end
    else begin
      call ZackNo;
    end
  ZackYes: |
    gsay_reply(377, 116);
    gsay_option(377, 120, ZackBarter, 50);
    gsay_option(377, 121, ZackEnd, 50);
  ZackNo: |
    gsay_reply(377, DisplayMessage);
    gsay_option(377, 119, ZackBarter, 50);
    gsay_option(377, 107, ZackEnd, 50);
  ZackBarter: |
    gdialog_mod_barter(BarterMod);
    gsay_message(377, 108, 50);
  ZackEnd: "[]"
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
zark:
  start: |
    if (Only_Once) then begin
      critter_add_trait(self_obj, 1, 6, 20);
      critter_add_trait(self_obj, 1, 5, 69);
      Only_Once := 0;
    end
    if (script_action == 11) then begin
      call do_dialogue;
    end
    else begin
      if ((script_action == 21) or (script_action == 3)) then begin
        script_overrides;
        display_msg(message_str(392, 100));
      end
      else begin
        if (script_action == 4) then begin
          hostile := 1;
        end
        else begin
          if (script_action == 18) then begin
            if (source_obj == dude_obj) then begin
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
                set_global_var(156, 1);
                set_global_var(157, 0);
              end
              if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
                set_global_var(157, 1);
                set_global_var(156, 0);
              end
              set_global_var(160, global_var(160) + 1);
              if ((global_var(160) % 6) == 0) then begin
                set_global_var(155, global_var(155) + 1);
              end
            end
          end
          else begin
            if (script_action == 12) then begin
              if (hostile) then begin
                hostile := 0;
                attack_complex(dude_obj, 0, 1, 0, 0, 30000, 0, 0);
              end
            end
          end
        end
      end
    end
  do_dialogue: |
    call weapon_check;
    start_gdialog(-1, self_obj, 4, -1, -1);
    gsay_start;
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      if (local_var(4) == 0) then begin
        if (armed == 1) then begin
          call zark14;
        end
        else begin
          call zark01;
        end
      end
      else begin
        set_local_var(4, 1);
        call zark13;
      end
    end
    else begin
      set_local_var(4, 1);
      if (global_var(195) == 1) then begin
        call zark00;
      end
      else begin
        if (armed == 1) then begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1)) or (global_var(155) > 50)) then begin
            call zark02;
          end
          else begin
            if ((global_var(158) > 2) or (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) or (global_var(155) < -50)) then begin
              call zark45;
            end
            else begin
              call zark03;
            end
          end
        end
        else begin
          if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1)) or (global_var(155) > 50)) then begin
            call zark02;
          end
          else begin
            if ((global_var(158) > 2) or (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) or (global_var(155) < -50)) then begin
              call zark45;
            end
            else begin
              call zark04;
            end
          end
        end
      end
    end
    gsay_end;
    end_dialogue;
  zark00: |
    if (GENDER == 0) then begin
      gsay_reply(392, 101);
    end
    else begin
      gsay_reply(392, 102);
    end
    giq_option(4, 392, 103, zark00a, 50);
    giq_option(4, 392, 104, zark00b, 50);
    giq_option(4, 392, 105, zark11, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 106, zark00c, 50);
    end
    giq_option(-3, 392, 107, zark11, 50);
  zark00a: |
    if (get_critter_stat(dude_obj, 0) > 7) then begin
      call zark10;
    end
    else begin
      call zark11;
    end
  zark00b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark10;
    end
    else begin
      call zark11;
    end
  zark00c: |
    if (get_critter_stat(dude_obj, 0) > 7) then begin
      call zark12;
    end
    else begin
      call zark11;
    end
  zark01: |
    gsay_reply(392, 108);
    giq_option(7, 392, 109, zark01a, 50);
    giq_option(7, 392, 110, zark39, 50);
    giq_option(4, 392, 111, zark46, 50);
    giq_option(4, 392, 112, zark08, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 113, zark12, 50);
    end
    giq_option(-3, 392, 114, zark18, 50);
  zark01a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark38;
    end
    else begin
      call zark26;
    end
  zark02: |
    gsay_reply(392, 115);
    giq_option(7, 392, 116, zark02a, 50);
    giq_option(4, 392, 117, zark25, 50);
    giq_option(4, 392, 118, zark31, 50);
    giq_option(4, 392, 119, zark46, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 392, 120, zark30, 50);
    end
    giq_option(-3, 392, 121, zark35, 50);
  zark02a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark19;
    end
    else begin
      call zark26;
    end
  zark03: |
    gsay_reply(392, 122);
    giq_option(7, 392, 123, zark03a, 50);
    giq_option(4, 392, 124, zark18, 50);
    giq_option(4, 392, 125, zark26, 50);
    giq_option(4, 392, 126, zark17, 50);
    giq_option(-3, 392, 127, zark18, 50);
  zark03a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark06;
    end
    else begin
      call zark11;
    end
  zark04: |
    gsay_reply(392, 128);
    giq_option(7, 392, 129, zark04a, 50);
    giq_option(4, 392, 130, zark26, 50);
    giq_option(4, 392, 131, zark04b, 50);
    giq_option(-3, 392, 132, zark18, 50);
  zark04a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark05;
    end
    else begin
      call zark11;
    end
  zark04b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark31;
    end
    else begin
      call zark26;
    end
  zark05: |
    set_global_var(196, 1);
    LASHERKNOWN := 1;
    gsay_reply(392, 133);
    giq_option(7, 392, 134, zark05a, 50);
    giq_option(4, 392, 135, zark31, 50);
    giq_option(4, 392, 136, zark07, 50);
  zark05a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark23;
    end
    else begin
      call zark26;
    end
  zark06: |
    gsay_reply(392, 137);
    giq_option(7, 392, 138, zark06a, 50);
    giq_option(4, 392, 139, zark06b, 50);
    giq_option(4, 392, 140, zark20, 50);
    giq_option(4, 392, 141, zark46, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 142, zark11, 50);
    end
  zark06a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark19;
    end
    else begin
      call zark26;
    end
  zark06b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark19;
    end
    else begin
      call zark11;
    end
  zark07: |
    LASHERKNOWN := 1;
    gsay_reply(392, 143);
    if (global_var(196) == 1) then begin
      giq_option(7, 392, 144, zark07a, 50);
    end
    giq_option(4, 392, 145, zark33, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 146, zark36, 50);
    end
  zark07a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark26;
    end
    else begin
      call zark26;
    end
  zark08: |
    set_global_var(196, 1);
    gsay_reply(392, 147);
    giq_option(7, 392, 148, zark08a, 50);
    giq_option(4, 392, 149, zark49, 50);
    giq_option(4, 392, 150, zark31, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 151, zark18, 50);
    end
  zark08a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark09;
    end
    else begin
      call zark18;
    end
  zark09: |
    gsay_reply(392, 152);
    giq_option(7, 392, 153, zark31, 50);
    giq_option(4, 392, 154, zark47, 50);
    giq_option(4, 392, 155, zark29, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 156, zark12, 50);
    end
  zark10: 'gsay_message(392, 157, 50);

    '
  zark11: |
    gsay_message(392, 158, 50);
    call zarkcombat;
  zark12: |
    if (GENDER == 0) then begin
      gsay_reply(392, 159);
    end
    else begin
      gsay_reply(392, 160);
    end
    giq_option(4, 392, 161, zark21, 50);
    giq_option(4, 392, 162, zark11, 50);
  zark13: 'gsay_message(392, 163, 50);

    '
  zark14: |
    gsay_reply(392, 164);
    giq_option(7, 392, 165, zark14a, 50);
    giq_option(4, 392, 166, zark18, 50);
    giq_option(4, 392, 167, zark16, 50);
    giq_option(4, 392, 168, zark17, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 169, zark16, 50);
    end
    giq_option(-3, 392, 170, zark18, 50);
  zark14a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark15;
    end
    else begin
      call zark16;
    end
  zark15: |
    gsay_reply(392, 171);
    giq_option(7, 392, 172, zark15a, 50);
    giq_option(4, 392, 173, zark15a, 50);
    giq_option(4, 392, 174, zark20, 50);
    giq_option(4, 392, 175, zark46, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 176, zark15c, 50);
    end
  zark15a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark19;
    end
    else begin
      call zark16;
    end
  zark15c: |
    if (get_critter_stat(dude_obj, 0) < 7) then begin
      call zark21;
    end
    else begin
      call zark22;
    end
  zark16: 'gsay_message(392, 177, 50);

    '
  zark17: |
    gsay_message(392, 178, 51);
    call zarkcombat;
  zark18: 'gsay_message(392, 179, 50);

    '
  zark19: |
    gsay_reply(392, 180);
    giq_option(4, 392, 181, zark19a, 50);
    giq_option(4, 392, 182, zark24, 50);
    giq_option(4, 392, 183, zark25, 50);
    giq_option(4, 392, 184, zark24, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 185, zark18, 50);
    end
  zark19a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark23;
    end
    else begin
      call zark26;
    end
  zark20: |
    set_global_var(196, 1);
    gsay_reply(392, 186);
    giq_option(7, 392, 187, zark26, 50);
    giq_option(4, 392, 188, zark27, 50);
    giq_option(4, 392, 189, zark28, 50);
    giq_option(4, 392, 190, zark29, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 392, 191, zark30, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 192, zark21, 50);
    end
  zark21: 'gsay_reply(392, 193);

    '
  zark22: |
    gsay_reply(392, 194);
    giq_option(4, 392, 195, zark19, 50);
    giq_option(4, 392, 196, zark20, 50);
    giq_option(4, 392, 197, zark31, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 198, zark21, 50);
    end
  zark23: 'gsay_message(392, 199, 50);

    '
  zark24: 'gsay_message(392, 200, 50);

    '
  zark25: 'gsay_message(392, 201, 50);

    '
  zark26: 'gsay_message(392, 202, 50);

    '
  zark27: |
    gsay_reply(392, 203);
    giq_option(7, 392, 204, zark32, 50);
    giq_option(4, 392, 205, zark33, 50);
    giq_option(4, 392, 206, zark34, 50);
    giq_option(4, 392, 207, zark35, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 208, zark21, 50);
    end
  zark28: |
    LASHERKNOWN := 1;
    gsay_reply(392, 209);
    if (global_var(196) == 1) then begin
      giq_option(7, 392, 210, zark28a, 50);
    end
    else begin
      giq_option(7, 392, 211, zark28a, 50);
    end
    giq_option(4, 392, 212, zark33, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 213, zark36, 50);
    end
  zark28a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark26;
    end
    else begin
      call zark26;
    end
  zark28b: "[]"
  zark29: 'gsay_message(392, 214, 50);

    '
  zark30: |
    gsay_reply(392, 215);
    giq_option(4, 392, 216, zark37, 50);
    giq_option(4, 392, 217, zark37, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 218, zark21, 50);
    end
  zark31: |
    set_global_var(196, 1);
    gsay_reply(392, 219);
    giq_option(7, 392, 220, zark31a, 50);
    giq_option(4, 392, 221, zark31b, 50);
    giq_option(4, 392, 222, zark28, 50);
    giq_option(4, 392, 223, zark29, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 392, 224, zark30, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 225, zark21, 50);
    end
  zark31a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark23;
    end
    else begin
      call zark26;
    end
  zark31b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark27;
    end
    else begin
      call zark26;
    end
  zark32: 'gsay_message(392, 226, 50);

    '
  zark33: 'gsay_message(392, 227, 50);

    '
  zark34: |
    set_global_var(196, 1);
    gsay_message(392, 228, 50);
  zark35: 'gsay_message(392, 229, 50);

    '
  zark36: 'gsay_message(392, 230, 50);

    '
  zark37: |
    LASHERKNOWN := 1;
    gsay_message(392, 231, 50);
  zark38: |
    gsay_reply(392, 232);
    giq_option(7, 392, 233, zark38a, 50);
    giq_option(4, 392, 234, zark38b, 50);
    giq_option(4, 392, 235, zark20, 50);
    giq_option(4, 392, 236, zark11, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 392, 237, zark30, 50);
    end
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 238, zark38c, 50);
    end
  zark38a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark19;
    end
    else begin
      call zark16;
    end
  zark38b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark19;
    end
    else begin
      call zark26;
    end
  zark38c: |
    if (get_critter_stat(dude_obj, 0) < 7) then begin
      call zark21;
    end
    else begin
      call zark22;
    end
  zark39: |
    gsay_reply(392, 239);
    giq_option(7, 392, 240, zark39a, 50);
    giq_option(7, 392, 241, zark39b, 50);
    giq_option(4, 392, 242, zark40, 50);
    giq_option(4, 392, 243, zark29, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 244, zark18, 50);
    end
  zark39a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark38;
    end
    else begin
      call zark26;
    end
  zark39b: |
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      call zark16;
    end
    else begin
      call zark25;
    end
  zark40: |
    gsay_reply(392, 245);
    giq_option(7, 392, 246, zark40a, 50);
    giq_option(7, 392, 247, zark41, 50);
    giq_option(4, 392, 248, zark42, 50);
    giq_option(4, 392, 249, zark43, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 250, zark42, 50);
    end
  zark40a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark19;
    end
    else begin
      call zark26;
    end
  zark41: |
    gsay_reply(392, 251);
    giq_option(7, 392, 252, zark25, 50);
    if (GENDER != 0) then begin
      giq_option(7, 392, 253, zark41a, 50);
    end
    else begin
      giq_option(7, 392, 254, zark41a, 50);
    end
    giq_option(4, 392, 255, zark41b, 50);
    giq_option(4, 392, 256, zark47, 50);
    if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
      giq_option(4, 392, 257, zarkcombat, 50);
    end
  zark41a: |
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      call zark42;
    end
    else begin
      call zark45;
    end
  zark41b: |
    if (obj_pid(critter_inven_obj(dude_obj, 0)) == 113) then begin
      call zark42;
    end
    else begin
      call zark45;
    end
  zark41c: 'call zarkcombat;

    '
  zark42: 'gsay_message(392, 258, 50);

    '
  zark43: 'gsay_message(392, 259, 50);

    '
  zark44: |
    gsay_reply(392, 260);
    giq_option(7, 392, 261, zark44a, 50);
    giq_option(4, 392, 262, zark44b, 50);
    giq_option(4, 392, 263, zark31, 50);
    giq_option(4, 392, 264, zark46, 50);
    if (global_var(194) == 1) then begin
      giq_option(4, 392, 265, zark30, 50);
    end
  zark44a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark19;
    end
    else begin
      call zark16;
    end
  zark44b: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark19;
    end
    else begin
      call zark26;
    end
  zark45: |
    if (GENDER == 0) then begin
      gsay_message(392, 266, 50);
    end
    else begin
      gsay_message(392, 267, 50);
    end
  zark46: 'gsay_message(392, 268, 50);

    '
  zark47: |
    gsay_reply(392, 269);
    giq_option(7, 392, 270, zark47a, 50);
    giq_option(4, 392, 271, zark48, 50);
    giq_option(4, 392, 272, zarkend, 50);
    giq_option(4, 392, 273, zarkcombat, 50);
  zark47a: |
    if (is_success(roll_vs_skill(dude_obj, 14, 0))) then begin
      call zark26;
    end
    else begin
      call zark26;
    end
  zark48: |
    gsay_message(392, 274, 50);
    call zarkcombat;
  zark49: 'gsay_message(392, 275, 50);

    '
  zarkdone: 'gsay_option(392, 276, zarkend, 50);

    '
  zarkend: "[]"
  zarkcombat: |
    set_global_var(195, 1);
    hostile := 1;
  weapon_check: |
    if ((obj_item_subtype(critter_inven_obj(dude_obj, 1)) == 3) or (obj_item_subtype(critter_inven_obj(dude_obj, 2)) == 3)) then begin
      armed := 1;
    end
    else begin
      armed := 0;
    end
  get_reaction: |
    if (local_var(2) == 0) then begin
      set_local_var(0, 50);
      set_local_var(1, 2);
      set_local_var(2, 1);
      set_local_var(0, local_var(0) + (5 * get_critter_stat(dude_obj, 3)) - 25);
      set_local_var(0, local_var(0) + (10 * has_trait(0, dude_obj, 10)));
      if (has_trait(0, dude_obj, 39)) then begin
        if (global_var(155) > 0) then begin
          set_local_var(0, local_var(0) + global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) - global_var(155));
        end
      end
      else begin
        if (local_var(3) == 1) then begin
          set_local_var(0, local_var(0) - global_var(155));
        end
        else begin
          set_local_var(0, local_var(0) + global_var(155));
        end
      end
      if (global_var(158) > 2) then begin
        set_local_var(0, local_var(0) - 30);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(160) > (3 * global_var(159))) or (global_var(157) == 1))) then begin
        set_local_var(0, local_var(0) + 20);
      end
      if (((global_var(160) + global_var(159)) >= 25) and ((global_var(159) > (2 * global_var(160))) or (global_var(156) == 1))) then begin
        set_local_var(0, local_var(0) - 20);
      end
      call ReactToLevel;
    end
  ReactToLevel: |
    if (local_var(0) <= 25) then begin
      set_local_var(1, 1);
    end
    else begin
      if (local_var(0) <= 75) then begin
        set_local_var(1, 2);
      end
      else begin
        set_local_var(1, 3);
      end
    end
  LevelToReact: |
    if (local_var(1) == 1) then begin
      set_local_var(0, random(1, 25));
    end
    else begin
      if (local_var(1) == 2) then begin
        set_local_var(0, random(26, 75));
      end
      else begin
        set_local_var(0, random(76, 100));
      end
    end
  UpReact: |
    set_local_var(0, local_var(0) + 10);
    call ReactToLevel;
  DownReact: |
    set_local_var(0, local_var(0) - 10);
    call ReactToLevel;
  BottomReact: |
    set_local_var(1, 1);
    set_local_var(0, 1);
  TopReact: |
    set_local_var(0, 100);
    set_local_var(1, 3);
  BigUpReact: |
    set_local_var(0, local_var(0) + 25);
    call ReactToLevel;
  BigDownReact: |
    set_local_var(0, local_var(0) - 25);
    call ReactToLevel;
  UpReactLevel: |
    set_local_var(1, local_var(1) + 1);
    if (local_var(1) > 3) then begin
      set_local_var(1, 3);
    end
    call LevelToReact;
  DownReactLevel: |
    set_local_var(1, local_var(1) - 1);
    if (local_var(1) < 1) then begin
      set_local_var(1, 1);
    end
    call LevelToReact;
  Goodbyes: 'exit_line := message_str(634, random(100, 105));

    '
zax:
  start: |
    if ((script_action == 21) or (script_action == 3)) then begin
      script_overrides;
      if (local_var(4) == 1) then begin
        display_msg(message_str(312, 100));
      end
      else begin
        display_msg(message_str(312, 101));
      end
    end
  talk_p_proc: |
    script_overrides;
    start_gdialog(312, self_obj, 4, -1, -1);
    gsay_start;
    call Zax01;
    gsay_end;
    end_dialogue;
  use_p_proc: 'dialogue_system_enter;

    '
  Zax01: |
    gsay_reply(312, 102);
    if (local_var(4) == 0) then begin
      giq_option(5, 312, 103, Zax02, 50);
    end
    giq_option(5, 312, 105, Zax04, 50);
    if (local_var(6) == 0) then begin
      giq_option(5, 312, 106, Zax12, 50);
    end
    if (local_var(5) == 0) then begin
      giq_option(5, 312, 104, Zax03, 50);
    end
    giq_option(5, 828, 200, Mainframe00, 50);
    giq_option(5, 312, 108, Zax13, 50);
    giq_option(-4, 312, 109, Zax05, 50);
  Zax02: |
    set_local_var(4, 1);
    gsay_reply(312, 110);
    giq_option(5, 312, 111, Zax06, 50);
    giq_option(5, 312, 112, Zax04, 50);
    giq_option(5, 312, 113, Zax07, 50);
    giq_option(7, 312, 114, Zax08, 50);
    giq_option(0, 312, 115, Zax13, 50);
  Zax03: |
    gsay_message(312, 116, 50);
    set_local_var(5, 1);
    call Zax01;
  Zax04: |
    call ZaxClearance;
    gsay_reply(828, message_str(828, 211) + message_str(828, 241) + message_str(828, 242) + message_str(828, 243));
    giq_option(7, 312, 119, Zax21, 50);
    giq_option(7, 312, 120, Zax15, 50);
    giq_option(5, 312, 121, Zax13, 50);
  Zax05: 'gsay_message(312, 122, 50);

    '
  Zax06: |
    call ZaxClearance;
    gsay_reply(312, 123);
    giq_option(5, 312, 124, Zax14, 50);
    giq_option(7, 312, 125, Zax15, 50);
    giq_option(5, 312, 126, Zax07, 50);
  Zax07: |
    gsay_reply(312, 127);
    giq_option(7, 312, 128, Zax08, 50);
    giq_option(5, 312, 121, Zax13, 50);
  Zax08: |
    gsay_message(312, 129, 50);
    gsay_reply(312, 130);
    giq_option(5, 312, 131, Zax01, 50);
    giq_option(7, 312, 132, Zax09, 50);
    giq_option(9, 312, 133, Zax11, 50);
  Zax09: |
    gsay_message(312, 134, 50);
    gsay_reply(312, 135);
    giq_option(7, 312, 136, Zax10, 50);
    giq_option(7, 312, 137, Zax01, 50);
    giq_option(9, 312, 138, Zax11, 50);
  Zax10: |
    gsay_message(312, 139, 50);
    gsay_reply(312, 140);
    giq_option(7, 312, 141, Zax01, 50);
    giq_option(9, 312, 142, Zax11, 50);
  Zax11: |
    gsay_message(312, 143, 50);
    gsay_message(312, 144, 50);
    gsay_reply(312, 145);
    giq_option(5, 312, 146, Zax01, 50);
    giq_option(5, 312, 147, Zax13, 50);
  Zax12: |
    variable LVar0 := 0;
    variable LVar1 := 0;
    gsay_message(312, 148, 50);
    gfade_out(600);
    game_time_advance(game_ticks(7200));
    LVar0 := do_check(dude_obj, 4, -8);
    LVar1 := do_check(dude_obj, 6, -7);
    gfade_in(600);
    if (is_success(LVar0) and is_success(LVar1)) then begin
      gsay_reply(312, 149);
      set_local_var(6, 1);
      give_exp_points(700);
      display_msg(message_str(766, 103) + 700 + message_str(766, 104));
    end
    else begin
      gsay_reply(312, 150);
    end
    if (local_var(6) == 0) then begin
      giq_option(5, 312, 151, Zax12, 50);
    end
    giq_option(5, 312, 152, Zax01, 50);
  Zax13: 'gsay_message(312, 153, 50);

    '
  Zax14: |
    gsay_reply(312, 154);
    giq_option(5, 312, 155, Zax13, 50);
    giq_option(5, 312, 156, Zax01, 50);
  Zax15: |
    gsay_message(312, 157, 50);
    gsay_reply(312, 158);
    giq_option(5, 312, 159, Zax16, 50);
    giq_option(7, 312, 160, Zax17, 50);
    giq_option(9, 312, 161, Zax18, 50);
  Zax16: |
    gsay_reply(312, 162);
    giq_option(5, 312, 163, Zax01, 50);
    giq_option(7, 312, 164, Zax17, 50);
    giq_option(9, 312, 165, Zax18, 50);
  Zax17: |
    gsay_reply(312, 166);
    giq_option(5, 312, 167, Zax01, 50);
    giq_option(9, 312, 168, Zax18, 50);
  Zax18: |
    gsay_message(312, 169, 50);
    gsay_message(312, 170, 50);
    gsay_message(312, 171, 50);
    gsay_message(312, 172, 50);
    gsay_reply(312, 173);
    giq_option(9, 312, 174, Zax19, 50);
    giq_option(10, 312, 175, Zax20, 50);
    giq_option(5, 312, 176, Zax01, 50);
    giq_option(5, 312, 177, Zax13, 50);
  Zax19: |
    gsay_message(312, 178, 50);
    gsay_message(312, 179, 50);
    gsay_reply(312, 180);
    giq_option(10, 312, 181, Zax20, 50);
    giq_option(5, 312, 182, Zax01, 50);
    giq_option(5, 312, 183, Zax13, 50);
  Zax20: |
    gsay_reply(312, 184);
    giq_option(9, 312, 185, Zax19, 50);
    giq_option(5, 312, 186, Zax01, 50);
    giq_option(5, 312, 187, Zax13, 50);
  Zax21: |
    gsay_reply(312, 188);
    giq_option(5, 312, 189, Zax22, 50);
    giq_option(5, 312, 190, Zax23, 50);
    giq_option(5, 312, 191, Zax24, 50);
    giq_option(5, 312, 192, Zax01, 50);
  Zax22: |
    gsay_reply(312, 193);
    giq_option(5, 312, 194, Zax23, 50);
    giq_option(5, 312, 195, Zax24, 50);
    giq_option(5, 312, 196, Zax01, 50);
    giq_option(5, 312, 197, Zax13, 50);
  Zax23: |
    gsay_reply(312, 198);
    giq_option(5, 312, 199, Zax22, 50);
    giq_option(5, 312, 200, Zax24, 50);
    giq_option(5, 312, 201, Zax01, 50);
    giq_option(5, 312, 202, Zax13, 50);
  Zax24: |
    gsay_reply(312, 203);
    giq_option(5, 312, 204, Zax22, 50);
    giq_option(5, 312, 205, Zax23, 50);
    giq_option(5, 312, 206, Zax01, 50);
    giq_option(5, 312, 207, Zax13, 50);
  ZaxClearance: |
    if (global_var(634)) then begin
      gsay_message(312, 210, 50);
      gsay_message(312, 211, 50);
      set_global_var(634, 0);
    end
  Term01: |
    gsay_reply(828, 100);
    giq_option(4, 828, 101, Term02, 50);
    giq_option(-3, 828, 102, Term10, 50);
    giq_option(0, 828, 103, Mainframe02, 50);
  Term02: |
    gsay_reply(828, 104);
    giq_option(4, 828, 105, Term03, 50);
    giq_option(4, 828, 106, Term06, 50);
    giq_option(4, 828, 107, Term01, 50);
  Term03: |
    gsay_reply(828, 108);
    giq_option(4, 828, 109, Term03a, 50);
    giq_option(4, 828, 110, Term02, 50);
  Term03a: |
    if (global_var(139) != 2) then begin
      call Term04;
    end
    else begin
      set_global_var(224, 2);
    end
  Term04: |
    gsay_reply(828, 111);
    giq_option(8, 828, 112, Term05, 50);
    giq_option(4, 828, 113, Term02, 50);
  Term05: |
    gsay_reply(828, 114);
    giq_option(4, 828, 115, Term02, 50);
  Term06: |
    gsay_reply(828, 116);
    giq_option(4, 828, 117, Term06a, 50);
    giq_option(4, 828, 118, Term02, 50);
  Term06a: 'set_global_var(224, 0);

    '
  Term09: |
    gsay_reply(828, 125);
    giq_option(-3, 828, 126, Term09a, 50);
    giq_option(4, 828, 127, Term09a, 50);
    giq_option(0, 828, 128, Mainframe02, 50);
  Term09a: 'set_global_var(224, 1);

    '
  Term10: |
    gsay_reply(828, 129);
    giq_option(-3, 828, 130, Term11, 50);
    giq_option(-3, 828, 131, Term13, 50);
    giq_option(-3, 828, 132, Term01, 50);
  Term11: |
    gsay_reply(828, 133);
    giq_option(-3, 828, 134, Term11a, 50);
    giq_option(-3, 828, 135, Term10, 50);
  Term11a: |
    if (global_var(139) != 2) then begin
      call Term12;
    end
    else begin
      set_global_var(224, 2);
    end
  Term12: |
    gsay_reply(828, 136);
    giq_option(-3, 828, 137, Term10, 50);
  Term13: |
    gsay_reply(828, 138);
    giq_option(-3, 828, 148, Term06a, 50);
    giq_option(-3, 828, 137, Term10, 50);
  Term14: |
    gsay_reply(828, 139);
    giq_option(4, 828, 140, Term14a, 50);
    giq_option(-3, 828, 141, Term15, 50);
    giq_option(-3, 828, 142, Term15, 50);
    giq_option(-3, 828, 143, Term14a, 50);
    giq_option(-3, 828, 144, Term15, 50);
    giq_option(0, 828, 145, Mainframe02, 50);
  Term14a: |
    set_global_var(224, 1);
    if (global_var(139) == 2) then begin
      call Term01;
    end
  Term15: |
    gsay_reply(828, 146);
    giq_option(0, 828, 147, Mainframe02, 50);
  TermEnd: "[]"
  TermStart: |
    if (global_var(224) == 0) then begin
      call Term14;
    end
    else begin
      if (global_var(224) == 1) then begin
        call Term01;
      end
      else begin
        call Term09;
      end
    end
  Mainframe00: |
    if (has_skill(dude_obj, 12) >= 25) then begin
      set_local_var(8, 0);
    end
    if (local_var(8) == 0) then begin
      if (local_var(7) == 1) then begin
        call Mainframe01;
      end
      else begin
        if (is_success(roll_vs_skill(dude_obj, 12, -10))) then begin
          set_local_var(7, 1);
          call Mainframe01;
        end
        else begin
          if (has_skill(dude_obj, 12) < 25) then begin
            set_local_var(8, 1);
          end
          gsay_message(828, 201, 50);
        end
      end
    end
    else begin
      gsay_message(828, 201, 50);
      display_msg(message_str(312, 300));
    end
  Mainframe01: |
    gsay_reply(828, 202);
    giq_option(4, 828, 203, Mainframe02, 50);
    giq_option(4, 828, 204, Zax01, 50);
  Mainframe02: |
    gsay_reply(828, 206);
    giq_option(4, 828, 207, Mainframe03, 50);
    giq_option(4, 828, 208, Mainframe04, 50);
    giq_option(4, 828, 209, Mainframe05, 50);
    giq_option(4, 828, 210, TermStart, 50);
    giq_option(4, 828, 204, Zax01, 50);
  Mainframe03: |
    gsay_reply(828, message_str(828, 211) + message_str(828, 241) + message_str(828, 242) + message_str(828, 243));
    giq_option(4, 828, 203, Mainframe02, 50);
    giq_option(4, 828, 205, TermEnd, 50);
  Mainframe04: |
    if ((global_var(634) == 0) and (global_var(224) == 2)) then begin
      gsay_reply(828, 212);
    end
    else begin
      gsay_reply(828, 213);
    end
    if (global_var(224) == 2) then begin
      if (global_var(634) == 0) then begin
        giq_option(4, 828, 214, Mainframe04a, 50);
      end
      else begin
        giq_option(4, 828, 215, Mainframe04a, 50);
      end
    end
    giq_option(4, 828, 203, Mainframe02, 50);
    giq_option(4, 828, 205, TermEnd, 50);
  Mainframe04a: |
    game_time_advance(game_ticks(600));
    if (has_skill(dude_obj, 12) >= 40) then begin
      set_local_var(9, 0);
    end
    if (local_var(9) == 0) then begin
      if (is_success(roll_vs_skill(dude_obj, 12, -25))) then begin
        if (global_var(634) == 0) then begin
          set_global_var(634, 1);
        end
        else begin
          set_global_var(634, 0);
        end
        if (local_var(10) == 0) then begin
          give_exp_points(100);
          display_msg(message_str(312, 213));
          display_msg(message_str(312, 214));
          set_local_var(10, 1);
          set_global_var(140, 1);
        end
        call Mainframe09;
      end
      else begin
        if (has_skill(dude_obj, 12) < 40) then begin
          set_local_var(9, 1);
        end
        call Mainframe10;
      end
    end
    else begin
      if (local_var(9) == 1) then begin
        display_msg(message_str(312, 300));
        call Mainframe10;
      end
      else begin
        call Mainframe10;
      end
    end
  Mainframe05: |
    gsay_reply(828, 216);
    giq_option(4, 828, 217, Mainframe05a, 50);
    giq_option(4, 828, 218, Mainframe05b, 50);
    giq_option(4, 828, 219, Mainframe05c, 50);
    giq_option(4, 828, 203, Mainframe02, 50);
    giq_option(4, 828, 205, TermEnd, 50);
  Mainframe05a: 'call Mainframe06;

    '
  Mainframe05b: 'call Mainframe07;

    '
  Mainframe05c: 'call Mainframe08;

    '
  Mainframe06: |
    gsay_message(828, 220, 50);
    gsay_message(828, 221, 50);
    gsay_message(828, 222, 50);
    gsay_message(828, 223, 50);
    gsay_message(828, 224, 50);
    gsay_message(828, 225, 50);
    gsay_message(828, 226, 50);
    gsay_message(828, 227, 50);
    gsay_reply(828, 228);
    giq_option(4, 828, 229, Mainframe06a, 50);
    giq_option(4, 828, 230, Mainframe05, 50);
    giq_option(4, 828, 205, TermEnd, 50);
  Mainframe06a: |
    set_global_var(260, 1);
    call Mainframe05;
  Mainframe07: |
    gsay_reply(828, message_str(828, 231) + message_str(828, 250) + message_str(828, 251) + message_str(828, 252));
    giq_option(4, 828, 229, Mainframe07a, 50);
    giq_option(4, 828, 230, Mainframe05, 50);
    giq_option(4, 828, 205, TermEnd, 50);
  Mainframe07a: |
    set_global_var(259, 1);
    call Mainframe05;
  Mainframe08: |
    gsay_message(828, message_str(828, 232) + message_str(828, 233), 50);
    gsay_message(828, message_str(828, 234) + message_str(828, 235), 50);
    gsay_reply(828, message_str(828, 236) + message_str(828, 237) + message_str(828, 238));
    giq_option(4, 828, 229, Mainframe08a, 50);
    giq_option(4, 828, 230, Mainframe05, 50);
    giq_option(4, 828, 205, TermEnd, 50);
  Mainframe08a: |
    set_global_var(258, 1);
    call Mainframe05;
  Mainframe09: |
    gsay_reply(828, 239);
    giq_option(4, 828, 203, Mainframe02, 50);
    giq_option(4, 828, 205, TermEnd, 50);
  Mainframe10: |
    game_time_advance(game_ticks(18000));
    gsay_reply(828, 240);
    giq_option(4, 828, 203, Mainframe02, 50);
    giq_option(4, 828, 205, TermEnd, 50);
